{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u7ad9\u70b9\u7531 \u8fd0\u7ef4\u6280\u672f\u5708 \u7ef4\u62a4\u3002 Ansible \u7248\u672c \u00b6 \u672c\u7ad9\u70b9\u4e2d\u7684\u793a\u4f8b\u4ee3\u7801\u4ec5\u9488\u5bf9 Ansible 2.9.6.0 \u7248\u672c\u8fdb\u884c\u4e86\u6d4b\u8bd5\u3002 \u6307\u5f15 \u00b6 \u5982\u679c\u4f60\u662f \u65b0\u624b , \u90a3\u4e48\u8bf7\u4ece Ansible \u5165\u95e8 \u5f00\u59cb\u4e86\u89e3 Ansible \u3002 \u5982\u679c\u4f60\u662f \u8fd0\u7ef4\u4eba\u5458 , \u90a3\u4e48\u8bf7\u770b\u770b Ansible \u8fdb\u9636 \u4ee5\u4fbf\u6df1\u5165\u4f7f\u7528 Ansible \u3002 \u5982\u679c\u4f60\u60f3\u5f00\u53d1 Ansible \u4ee5\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684\u529f\u80fd, \u90a3\u4e48\u8bf7\u770b\u770b Ansible \u5f00\u53d1 \u4ee5\u4fbf\u5feb\u901f\u5f00\u53d1\u4f7f\u7528\u3002 \u5982\u679c\u4f60\u60f3\u5728 WEB \u754c\u9762\u4e0a\u6267\u884c ansible , \u90a3\u4e48\u8bf7\u770b\u770b Ansible UI \u4ee5\u4fbf\u5feb\u901f\u5728 WEB \u4e2d\u4f7f\u7528\u3002 \u5982\u679c\u4f60\u60f3\u5bfb\u627e\u53ef\u4f7f\u7528\u7684 Roles , \u90a3\u4e48\u8bf7\u770b\u770b Ansible Roles \u4ee5\u4fbf\u5feb\u901f\u5e94\u7528\u3002 \u5982\u679c\u4f60\u60f3\u4e3a\u81ea\u5df1\u7684Ansible\u5b66\u4e60\u505a\u4e2a\u9636\u6bb5\u603b\u7ed3, \u4e0d\u59a8\u53bb\u8003\u53d6\u7ea2\u5e3d\u7684 Ansible \u8ba4\u8bc1 \uff0c\u90a3\u4e48\u8bf7\u770b\u770b Ansible \u8ba4\u8bc1 \u4ee5\u4fbf\u9009\u62e9\u9002\u5408\u81ea\u5df1\u7684\u8003\u8bd5\u3002 \u82e5\u60a8\u89c9\u5f97\u672c\u7ad9\u70b9\u6240\u521b\u9020\u7684\u5185\u5bb9\u5bf9\u60a8 \u6709\u6240\u5e2e\u52a9 \uff0c\u53ef\u8003\u8651\u7565\u8868\u5fc3\u610f\uff0c \u652f\u6301\u4e00\u4e0b \u3002 \u5982\u679c\u4f60\u53d1\u73b0\u6587\u7ae0 \u6709\u9519\u8bef \uff0c\u8bf7\u5728\u6587\u7ae0\u4e0b\u65b9 \u8bc4\u8bba \u5904\u6279\u8bc4\u6307\u6b63\uff0c\u6216\u8005\u63d0\u4ea4\u4e00\u4e2aPR\u5e2e\u52a9\u4fee\u6b63\u3002 \u5982\u679c\u4f60\u5728\u4f7f\u7528 Ansible \u7684\u8fc7\u7a0b\u4e2d\u5b58\u5728\u95ee\u9898\uff0c\u8bf7\u5728 \u8bba\u575b \u4e2d\u63d0\u51fa\u95ee\u9898\uff0c\u540e\u7eed\u4f1a\u6709\u7f51\u53cb\u5e2e\u5fd9\u89e3\u51b3\u3002\u5982\u679c\u4f60\u80fd\u5e2e\u52a9\u89e3\u51b3\u95ee\u9898\uff0c\u8bf7\u5e2e\u5fd9\u89e3\u51b3\u4e0b\uff0c\u5e76\u628a\u89e3\u51b3\u65b9\u6848\u56de\u590d\u5728\u5e16\u5b50\u4e2d\u3002 \u5982\u679c\u4f60\u60f3\u52a0\u5165\u7ec4\u7ec7\uff0c\u6211\u4eec\u51c6\u5907\u4e862\u4e2aQQ\u7fa4\uff0c\u53ef\u4ee5\u65b9\u4fbf\u5927\u5bb6\u5171\u540c\u4ea4\u6d41\u5b66\u4e60\u3002 Ansible \u5b66\u4e601\u7fa4 Ansible \u5b66\u4e602\u7fa4","title":"Home"},{"location":"#ansible","text":"\u672c\u7ad9\u70b9\u4e2d\u7684\u793a\u4f8b\u4ee3\u7801\u4ec5\u9488\u5bf9 Ansible 2.9.6.0 \u7248\u672c\u8fdb\u884c\u4e86\u6d4b\u8bd5\u3002","title":"Ansible \u7248\u672c"},{"location":"#_1","text":"\u5982\u679c\u4f60\u662f \u65b0\u624b , \u90a3\u4e48\u8bf7\u4ece Ansible \u5165\u95e8 \u5f00\u59cb\u4e86\u89e3 Ansible \u3002 \u5982\u679c\u4f60\u662f \u8fd0\u7ef4\u4eba\u5458 , \u90a3\u4e48\u8bf7\u770b\u770b Ansible \u8fdb\u9636 \u4ee5\u4fbf\u6df1\u5165\u4f7f\u7528 Ansible \u3002 \u5982\u679c\u4f60\u60f3\u5f00\u53d1 Ansible \u4ee5\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684\u529f\u80fd, \u90a3\u4e48\u8bf7\u770b\u770b Ansible \u5f00\u53d1 \u4ee5\u4fbf\u5feb\u901f\u5f00\u53d1\u4f7f\u7528\u3002 \u5982\u679c\u4f60\u60f3\u5728 WEB \u754c\u9762\u4e0a\u6267\u884c ansible , \u90a3\u4e48\u8bf7\u770b\u770b Ansible UI \u4ee5\u4fbf\u5feb\u901f\u5728 WEB \u4e2d\u4f7f\u7528\u3002 \u5982\u679c\u4f60\u60f3\u5bfb\u627e\u53ef\u4f7f\u7528\u7684 Roles , \u90a3\u4e48\u8bf7\u770b\u770b Ansible Roles \u4ee5\u4fbf\u5feb\u901f\u5e94\u7528\u3002 \u5982\u679c\u4f60\u60f3\u4e3a\u81ea\u5df1\u7684Ansible\u5b66\u4e60\u505a\u4e2a\u9636\u6bb5\u603b\u7ed3, \u4e0d\u59a8\u53bb\u8003\u53d6\u7ea2\u5e3d\u7684 Ansible \u8ba4\u8bc1 \uff0c\u90a3\u4e48\u8bf7\u770b\u770b Ansible \u8ba4\u8bc1 \u4ee5\u4fbf\u9009\u62e9\u9002\u5408\u81ea\u5df1\u7684\u8003\u8bd5\u3002 \u82e5\u60a8\u89c9\u5f97\u672c\u7ad9\u70b9\u6240\u521b\u9020\u7684\u5185\u5bb9\u5bf9\u60a8 \u6709\u6240\u5e2e\u52a9 \uff0c\u53ef\u8003\u8651\u7565\u8868\u5fc3\u610f\uff0c \u652f\u6301\u4e00\u4e0b \u3002 \u5982\u679c\u4f60\u53d1\u73b0\u6587\u7ae0 \u6709\u9519\u8bef \uff0c\u8bf7\u5728\u6587\u7ae0\u4e0b\u65b9 \u8bc4\u8bba \u5904\u6279\u8bc4\u6307\u6b63\uff0c\u6216\u8005\u63d0\u4ea4\u4e00\u4e2aPR\u5e2e\u52a9\u4fee\u6b63\u3002 \u5982\u679c\u4f60\u5728\u4f7f\u7528 Ansible \u7684\u8fc7\u7a0b\u4e2d\u5b58\u5728\u95ee\u9898\uff0c\u8bf7\u5728 \u8bba\u575b \u4e2d\u63d0\u51fa\u95ee\u9898\uff0c\u540e\u7eed\u4f1a\u6709\u7f51\u53cb\u5e2e\u5fd9\u89e3\u51b3\u3002\u5982\u679c\u4f60\u80fd\u5e2e\u52a9\u89e3\u51b3\u95ee\u9898\uff0c\u8bf7\u5e2e\u5fd9\u89e3\u51b3\u4e0b\uff0c\u5e76\u628a\u89e3\u51b3\u65b9\u6848\u56de\u590d\u5728\u5e16\u5b50\u4e2d\u3002 \u5982\u679c\u4f60\u60f3\u52a0\u5165\u7ec4\u7ec7\uff0c\u6211\u4eec\u51c6\u5907\u4e862\u4e2aQQ\u7fa4\uff0c\u53ef\u4ee5\u65b9\u4fbf\u5927\u5bb6\u5171\u540c\u4ea4\u6d41\u5b66\u4e60\u3002 Ansible \u5b66\u4e601\u7fa4 Ansible \u5b66\u4e602\u7fa4","title":"\u6307\u5f15"},{"location":"appreciate/","text":"\u8d5e\u8d4f\u652f\u6301 \u00b6 \u82e5\u60a8\u89c9\u5f97\u672c\u7ad9\u70b9\u6240\u521b\u9020\u7684\u5185\u5bb9\u5bf9\u60a8\u6709\u6240\u5e2e\u52a9\uff0c\u53ef\u8003\u8651\u7565\u8868\u5fc3\u610f\uff0c\u652f\u6301\u4e00\u4e0b\u3002 \u6ce8\u610f\u4e86\uff01 \u5728\u652f\u6301\u7684\u9875\u9762\uff0c\u52a1\u5fc5\u8981\u586b\u5199 Ansible + \u60a8\u7684ID \uff0c\u4ee5\u4fbf\u4e8e\u672c\u7ad9\u70b9\u5c06\u60a8\u7684\u8d5e\u8d4f\u586b\u5199\u5728\u4e0b\u5217\u4e2d\u3002 \u8d5e\u8d4f\u5217\u8868 \u00b6 ID \u91d1\u989d \u65f6\u95f4 \u5c0f\u903b\u8f91 \uffe5100.00 2020-05-23 www.dba100.com \uffe510.00 2020-05-22 \u8fde\u5c1a\u6770 \uffe550.00 2020-05-22 \u591c\u5f52\u4eba \uffe510.00 2020-05-22 fat \uffe5100.00 2020-05-22 leo \uffe550.00 2020-05-22","title":"\u8d5e\u8d4f\u652f\u6301"},{"location":"appreciate/#_1","text":"\u82e5\u60a8\u89c9\u5f97\u672c\u7ad9\u70b9\u6240\u521b\u9020\u7684\u5185\u5bb9\u5bf9\u60a8\u6709\u6240\u5e2e\u52a9\uff0c\u53ef\u8003\u8651\u7565\u8868\u5fc3\u610f\uff0c\u652f\u6301\u4e00\u4e0b\u3002 \u6ce8\u610f\u4e86\uff01 \u5728\u652f\u6301\u7684\u9875\u9762\uff0c\u52a1\u5fc5\u8981\u586b\u5199 Ansible + \u60a8\u7684ID \uff0c\u4ee5\u4fbf\u4e8e\u672c\u7ad9\u70b9\u5c06\u60a8\u7684\u8d5e\u8d4f\u586b\u5199\u5728\u4e0b\u5217\u4e2d\u3002","title":"\u8d5e\u8d4f\u652f\u6301"},{"location":"appreciate/#_2","text":"ID \u91d1\u989d \u65f6\u95f4 \u5c0f\u903b\u8f91 \uffe5100.00 2020-05-23 www.dba100.com \uffe510.00 2020-05-22 \u8fde\u5c1a\u6770 \uffe550.00 2020-05-22 \u591c\u5f52\u4eba \uffe510.00 2020-05-22 fat \uffe5100.00 2020-05-22 leo \uffe550.00 2020-05-22","title":"\u8d5e\u8d4f\u5217\u8868"},{"location":"resources/","text":"\u8d44\u6e90\u603b\u89c8 \u00b6 \u5b98\u65b9\u7f51\u7ad9: https://www.ansible.com/ Github: https://github.com/ansible/ansible \u5b98\u65b9\u6587\u6863: https://docs.ansible.com/ Tower\u6587\u6863: https://docs.ansible.com/ansible-tower/ \u767d\u76ae\u4e66: https://www.ansible.com/resources/whitepapers \u7ef4\u57fa\u767e\u79d1: https://en.wikipedia.org/wiki/Ansible_(software ) \u8bed\u6cd5 \u00b6 Jinja2 \u4e2d\u6587\u6587\u6863: http://docs.jinkan.org/docs/jinja2/ yaml\u8bed\u6cd5: http://www.yaml.org/ Roles \u00b6 \u5b98\u65b9Hub: https://galaxy.ansible.com/ https://github.com/ansible/ansible-examples https://github.com/geerlingguy https://github.com/debops https://github.com/openstack/openstack-ansible https://github.com/lework/Ansible-roles UI \u00b6 tower: https://www.ansible.com/products/tower awx: https://github.com/ansible/awx semaphore: https://github.com/ansible-semaphore/semaphore nci-ansible-ui: https://github.com/node-ci/nci-ansible-ui Books \u00b6 \u56fe\u4e66: https://www.ansible.com/resources/ebooks Ansible Configuration Management - Second Edition Ansible for DevOps Ansible Playbook Essentials Ansible - Up and Running Learning Ansible Learning Ansible 2 - Second Edition Mastering Ansible - Second Edition OpenStack Administration with Ansible Tools \u00b6 Ansible\u76f8\u5173\u5de5\u5177 Ansible cmdb - Takes the output of Ansible's fact gathering and converts it into a static HTML overview page containing system configuration information. Ansible Inventory Grapher - creates a dot file suitable for use by graphviz . Ansible Lint - Checks playbooks for practices and behaviour that could potentially be improved. Ansible Silo - Ansible in a self-contained environment via Docker. Ansigenome - Ansigenome is a command line tool designed to help you manage your Ansible roles - scan, standarize documentation and meta files, generate dependency graphs. ARA: Ansible Run Analysis - Records Ansible Playbook runs seamlessly to make them easier to visualize, understand and troubleshoot. It integrates with Ansible wherever you run it. Mitogen for Ansible - Uses the Mitogen library to execute Ansible playbooks in a more efficient way (decreases the execution time). Molecule - Testing of Ansible roles. OpsTools-ansible - The project opstools-ansible is to use Ansible to configure an environment that provides the support of OpsTools , namely centralized logging and analysis, availability monitoring, and performance monitoring. Phansible : Github - Simple generator for Vagrant projects, targeting PHP development environments. TD4A - Template designer for automation - TD4A is a visual design aid for building and testing jinja2 templates. It will combine data in yaml format with a jinja2 template and render the output. Packer Ansible Provisioner - This Provisioner can be used to automate VM Image Creation via Packer with Ansible. Excel Ansible Inventory - Turn any Excel Spreadsheet into an Ansible Inventory ansible-bundler - Turn Ansible playbooks into executable files IDE \u00b6 Ansible Vim - \u9002\u7528\u4e8e Ansible \u8bed\u6cd5 \u7684 vim \u63d2\u4ef6 VSCode extension for Ansible - \u9002\u7528\u4e8e Ansible \u7684 Visual Studio Code \u6269\u5c55 JetBrains OrchidE - OrchidE provides language support for Ansible playbooks, roles and variables.","title":"Ansible \u8d44\u6e90"},{"location":"resources/#_1","text":"\u5b98\u65b9\u7f51\u7ad9: https://www.ansible.com/ Github: https://github.com/ansible/ansible \u5b98\u65b9\u6587\u6863: https://docs.ansible.com/ Tower\u6587\u6863: https://docs.ansible.com/ansible-tower/ \u767d\u76ae\u4e66: https://www.ansible.com/resources/whitepapers \u7ef4\u57fa\u767e\u79d1: https://en.wikipedia.org/wiki/Ansible_(software )","title":"\u8d44\u6e90\u603b\u89c8"},{"location":"resources/#_2","text":"Jinja2 \u4e2d\u6587\u6587\u6863: http://docs.jinkan.org/docs/jinja2/ yaml\u8bed\u6cd5: http://www.yaml.org/","title":"\u8bed\u6cd5"},{"location":"resources/#roles","text":"\u5b98\u65b9Hub: https://galaxy.ansible.com/ https://github.com/ansible/ansible-examples https://github.com/geerlingguy https://github.com/debops https://github.com/openstack/openstack-ansible https://github.com/lework/Ansible-roles","title":"Roles"},{"location":"resources/#ui","text":"tower: https://www.ansible.com/products/tower awx: https://github.com/ansible/awx semaphore: https://github.com/ansible-semaphore/semaphore nci-ansible-ui: https://github.com/node-ci/nci-ansible-ui","title":"UI"},{"location":"resources/#books","text":"\u56fe\u4e66: https://www.ansible.com/resources/ebooks Ansible Configuration Management - Second Edition Ansible for DevOps Ansible Playbook Essentials Ansible - Up and Running Learning Ansible Learning Ansible 2 - Second Edition Mastering Ansible - Second Edition OpenStack Administration with Ansible","title":"Books"},{"location":"resources/#tools","text":"Ansible\u76f8\u5173\u5de5\u5177 Ansible cmdb - Takes the output of Ansible's fact gathering and converts it into a static HTML overview page containing system configuration information. Ansible Inventory Grapher - creates a dot file suitable for use by graphviz . Ansible Lint - Checks playbooks for practices and behaviour that could potentially be improved. Ansible Silo - Ansible in a self-contained environment via Docker. Ansigenome - Ansigenome is a command line tool designed to help you manage your Ansible roles - scan, standarize documentation and meta files, generate dependency graphs. ARA: Ansible Run Analysis - Records Ansible Playbook runs seamlessly to make them easier to visualize, understand and troubleshoot. It integrates with Ansible wherever you run it. Mitogen for Ansible - Uses the Mitogen library to execute Ansible playbooks in a more efficient way (decreases the execution time). Molecule - Testing of Ansible roles. OpsTools-ansible - The project opstools-ansible is to use Ansible to configure an environment that provides the support of OpsTools , namely centralized logging and analysis, availability monitoring, and performance monitoring. Phansible : Github - Simple generator for Vagrant projects, targeting PHP development environments. TD4A - Template designer for automation - TD4A is a visual design aid for building and testing jinja2 templates. It will combine data in yaml format with a jinja2 template and render the output. Packer Ansible Provisioner - This Provisioner can be used to automate VM Image Creation via Packer with Ansible. Excel Ansible Inventory - Turn any Excel Spreadsheet into an Ansible Inventory ansible-bundler - Turn Ansible playbooks into executable files","title":"Tools"},{"location":"resources/#ide","text":"Ansible Vim - \u9002\u7528\u4e8e Ansible \u8bed\u6cd5 \u7684 vim \u63d2\u4ef6 VSCode extension for Ansible - \u9002\u7528\u4e8e Ansible \u7684 Visual Studio Code \u6269\u5c55 JetBrains OrchidE - OrchidE provides language support for Ansible playbooks, roles and variables.","title":"IDE"},{"location":"advanced/ansible-cmdb/","text":"Ansible-cmdb \u00b6 ansible-cmdb \u83b7\u53d6Ansible facts\u6570\u636e\u7684\u8f93\u51fa\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u5305\u542b\u7cfb\u7edf\u914d\u7f6e\u4fe1\u606f\u7684\u9759\u6001HTML\u6982\u8ff0\u9875\u9762\uff08\u53ca\u5176\u4ed6\u5185\u5bb9\uff09\u3002 \u5b89\u88c5 \u00b6 yum -y install python-pip pip install ansible-cmdb \u4f7f\u7528 \u00b6 \u751f\u6210\u6240\u6709\u4e3b\u673a\u5f97facts\u4fe1\u606f ansible -m setup --tree out/ all \u751f\u6210web\u9875\u9762 ansible-cmdb out/ > overview.html \u5982\u679cfacts\u7528\u4e86\u672c\u5730\u7f13\u5b58\uff0c -f \u6307\u5b9a\u7f13\u5b58\u76ee\u5f55\u5373\u53ef\u3002 ansible-cmdb -f /path/to/facts/dir > overview.html \u4ee5\u8d44\u4ea7\u5217\u8868\u5f97\u5f62\u5f0f\u7edf\u8ba1\u51faansible\u4e3b\u673a\u4fe1\u606f\u3002 # ansible-cmdb -t txt_table --columns name,os,ip,mem,cpus out/ Name OS IP Mem CPUs --------- ---------- -------------- --- ---- localhost CentOS 7 .6 192 .168.77.130 1g 1 \u8f93\u51facsv\u683c\u5f0f\u7684\u4e3b\u673a\u4fe1\u606f\u3002 # ansible-cmdb -t csv out/ \"Name\" , \"OS\" , \"IP\" , \"Arch\" , \"Mem\" , \"MemFree\" , \"MemUsed\" , \"CPUs\" , \"Virt\" , \"Disk avail\" \"localhost\" , \"CentOS 7.6\" , \"192.168.77.130\" , \"x86_64/x86_64\" , \"1g\" , \"0g\" , \"1g\" , \"1\" , \"VMware/guest\" , \"28.0g, 0.0g\" \u8f93\u51fasql\u6587\u4ef6\uff0c\u5bfc\u5165\u6570\u636e\u5230mysql\u6216\u8005SQLite\u3002 # ansible-cmdb -t sql out/ DROP TABLE IF EXISTS hosts ; CREATE TABLE hosts ( name VARCHAR ( 255 ) , fqdn VARCHAR ( 255 ) , main_ip VARCHAR ( 15 ) , os_name VARCHAR ( 80 ) , os_version VARCHAR ( 40 ) , system VARCHAR ( 40 ) , kernel VARCHAR ( 40 ) , arch_hardware VARCHAR ( 12 ) , arch_userspace VARCHAR ( 12 ) , virt_type VARCHAR ( 20 ) , virt_role VARCHAR ( 20 ) , cpu_type VARCHAR ( 60 ) , vcpus INT, ram FLOAT, disk_total FLOAT, disk_free FLOAT ) ; INSERT INTO hosts ( name, fqdn, main_ip, os_name, os_version, system, kernel, arch_hardware, arch_userspace, virt_type, virt_role, cpu_type, vcpus, ram, disk_total, disk_free ) VALUES ( \"localhost\" , \"a23-202-231-167.deploy.static.akamaitechnologies.com\" , \"192.168.77.130\" , \"CentOS\" , \"7.6\" , \"Linux\" , \"5.1.11-1.el7.elrepo.x86_64\" , \"x86_64\" , \"x86_64\" , \"VMware\" , \"guest\" , \"Intel(R) Core(TM) i3-4160 CPU @ 3.60GHz\" , 1 , 0 .9, 29 .8, 27 .4 ) ; \u5176\u4ed6\u6a21\u677f\u683c\u5f0f\u3002 ansible-cmdb -t json out/ ansible-cmdb -t markdown out/","title":"\u4f7f\u7528 Ansible-cmdb"},{"location":"advanced/ansible-cmdb/#ansible-cmdb","text":"ansible-cmdb \u83b7\u53d6Ansible facts\u6570\u636e\u7684\u8f93\u51fa\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u5305\u542b\u7cfb\u7edf\u914d\u7f6e\u4fe1\u606f\u7684\u9759\u6001HTML\u6982\u8ff0\u9875\u9762\uff08\u53ca\u5176\u4ed6\u5185\u5bb9\uff09\u3002","title":"Ansible-cmdb"},{"location":"advanced/ansible-cmdb/#_1","text":"yum -y install python-pip pip install ansible-cmdb","title":"\u5b89\u88c5"},{"location":"advanced/ansible-cmdb/#_2","text":"\u751f\u6210\u6240\u6709\u4e3b\u673a\u5f97facts\u4fe1\u606f ansible -m setup --tree out/ all \u751f\u6210web\u9875\u9762 ansible-cmdb out/ > overview.html \u5982\u679cfacts\u7528\u4e86\u672c\u5730\u7f13\u5b58\uff0c -f \u6307\u5b9a\u7f13\u5b58\u76ee\u5f55\u5373\u53ef\u3002 ansible-cmdb -f /path/to/facts/dir > overview.html \u4ee5\u8d44\u4ea7\u5217\u8868\u5f97\u5f62\u5f0f\u7edf\u8ba1\u51faansible\u4e3b\u673a\u4fe1\u606f\u3002 # ansible-cmdb -t txt_table --columns name,os,ip,mem,cpus out/ Name OS IP Mem CPUs --------- ---------- -------------- --- ---- localhost CentOS 7 .6 192 .168.77.130 1g 1 \u8f93\u51facsv\u683c\u5f0f\u7684\u4e3b\u673a\u4fe1\u606f\u3002 # ansible-cmdb -t csv out/ \"Name\" , \"OS\" , \"IP\" , \"Arch\" , \"Mem\" , \"MemFree\" , \"MemUsed\" , \"CPUs\" , \"Virt\" , \"Disk avail\" \"localhost\" , \"CentOS 7.6\" , \"192.168.77.130\" , \"x86_64/x86_64\" , \"1g\" , \"0g\" , \"1g\" , \"1\" , \"VMware/guest\" , \"28.0g, 0.0g\" \u8f93\u51fasql\u6587\u4ef6\uff0c\u5bfc\u5165\u6570\u636e\u5230mysql\u6216\u8005SQLite\u3002 # ansible-cmdb -t sql out/ DROP TABLE IF EXISTS hosts ; CREATE TABLE hosts ( name VARCHAR ( 255 ) , fqdn VARCHAR ( 255 ) , main_ip VARCHAR ( 15 ) , os_name VARCHAR ( 80 ) , os_version VARCHAR ( 40 ) , system VARCHAR ( 40 ) , kernel VARCHAR ( 40 ) , arch_hardware VARCHAR ( 12 ) , arch_userspace VARCHAR ( 12 ) , virt_type VARCHAR ( 20 ) , virt_role VARCHAR ( 20 ) , cpu_type VARCHAR ( 60 ) , vcpus INT, ram FLOAT, disk_total FLOAT, disk_free FLOAT ) ; INSERT INTO hosts ( name, fqdn, main_ip, os_name, os_version, system, kernel, arch_hardware, arch_userspace, virt_type, virt_role, cpu_type, vcpus, ram, disk_total, disk_free ) VALUES ( \"localhost\" , \"a23-202-231-167.deploy.static.akamaitechnologies.com\" , \"192.168.77.130\" , \"CentOS\" , \"7.6\" , \"Linux\" , \"5.1.11-1.el7.elrepo.x86_64\" , \"x86_64\" , \"x86_64\" , \"VMware\" , \"guest\" , \"Intel(R) Core(TM) i3-4160 CPU @ 3.60GHz\" , 1 , 0 .9, 29 .8, 27 .4 ) ; \u5176\u4ed6\u6a21\u677f\u683c\u5f0f\u3002 ansible-cmdb -t json out/ ansible-cmdb -t markdown out/","title":"\u4f7f\u7528"},{"location":"advanced/ansible-config/","text":"Ansible \u7684\u5e38\u7528\u8bbe\u7f6e \u00b6 ansible.cfg \u00b6 \u4e0b\u5217\u5217\u51fa\u4e86\u5e38\u7528\u7684\u4e00\u4e9b\u8bbe\u7f6e\uff0c\u53ef\u7528\u4f5c\u53c2\u8003\u3002 # /etc/ansible/ansible.cfg [defaults] # Set the log_path log_path = ~/ansible.log # Additional default options for Ansible forks = 20 host_key_checking = False retry_files_enabled = False retry_files_save_path = ~/ansible-installer-retries nocows = True remote_user = root roles_path = roles/ gathering = smart fact_caching = jsonfile fact_caching_connection = $HOME/ansible/facts fact_caching_timeout = 600 callback_whitelist = profile_tasks inventory_ignore_extensions = secrets.py, .pyc, .cfg, .crt, .ini # work around privilege escalation timeouts in ansible: timeout = 30 host_key_checking = False # Uncomment to use the provided example inventory #inventory = inventory/hosts.example ansible_managed = Ansible managed: {file} modified by {uid} on {host} [inventory] # fail more helpfully when the inventory file does not parse (Ansible 2.4+) unparsed_is_failed = true # Additional ssh options for OpenShift Ansible [ssh_connection] retries = 15 pipelining = True ssh_args = -o ControlMaster=auto -o ControlPersist=600s timeout = 10 # shorten the ControlPath which is often too long; when it is, # ssh connection reuse silently fails, making everything slower. control_path = %(directory)s/%%h-%%r","title":"Ansible \u7684\u5e38\u7528\u8bbe\u7f6e"},{"location":"advanced/ansible-config/#ansible","text":"","title":"Ansible \u7684\u5e38\u7528\u8bbe\u7f6e"},{"location":"advanced/ansible-config/#ansiblecfg","text":"\u4e0b\u5217\u5217\u51fa\u4e86\u5e38\u7528\u7684\u4e00\u4e9b\u8bbe\u7f6e\uff0c\u53ef\u7528\u4f5c\u53c2\u8003\u3002 # /etc/ansible/ansible.cfg [defaults] # Set the log_path log_path = ~/ansible.log # Additional default options for Ansible forks = 20 host_key_checking = False retry_files_enabled = False retry_files_save_path = ~/ansible-installer-retries nocows = True remote_user = root roles_path = roles/ gathering = smart fact_caching = jsonfile fact_caching_connection = $HOME/ansible/facts fact_caching_timeout = 600 callback_whitelist = profile_tasks inventory_ignore_extensions = secrets.py, .pyc, .cfg, .crt, .ini # work around privilege escalation timeouts in ansible: timeout = 30 host_key_checking = False # Uncomment to use the provided example inventory #inventory = inventory/hosts.example ansible_managed = Ansible managed: {file} modified by {uid} on {host} [inventory] # fail more helpfully when the inventory file does not parse (Ansible 2.4+) unparsed_is_failed = true # Additional ssh options for OpenShift Ansible [ssh_connection] retries = 15 pipelining = True ssh_args = -o ControlMaster=auto -o ControlPersist=600s timeout = 10 # shorten the ControlPath which is often too long; when it is, # ssh connection reuse silently fails, making everything slower. control_path = %(directory)s/%%h-%%r","title":"ansible.cfg"},{"location":"advanced/ansible-lint/","text":"\u4f7f\u7528 ansible-lint \u00b6 Ansible Lint \u662f\u7528\u4e8e\u68c0\u6d4bplaybook\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u63d0\u4f9b\u5efa\u8bae\u6765\u5e2e\u52a9\u4f60\u4fee\u6b63playbook\u3002 \u5b89\u88c5 \u00b6 pip install ansible-lint \u4f7f\u7528 \u00b6 \u547d\u4ee4\u9009\u9879 ansible-lint --help Usage: ansible-lint [ options ] [ playbook.yml [ playbook2 ... ]] Options: --version \u663e\u793a\u9879\u76ee\u7248\u672c -h, --help \u663e\u793a\u5e2e\u52a9\u4fe1\u606f -L \u5217\u51fa\u6240\u6709\u89c4\u5219 -q \u8f93\u51fa\u5c11\u91cf\u4fe1\u606f -p \u4ee5pep8\u683c\u5f0f\u89e3\u6790\u7684\u8f93\u51fa --parseable-severity \u5206\u6790\u8f93\u51fa\uff0c\u5305\u62ec\u89c4\u5219\u7684\u4e25\u91cd\u6027 -r RULESDIR \u6307\u5b9a\u89c4\u5219\u76ee\u5f55\uff0c\u4f7f\u7528\u591a\u4e2a-r\u6307\u5b9a\u591a\u4e2a\u76ee\u5f55\u4f1a\u8986\u76d6\u9ed8\u8ba4\u76ee\u5f55 /usr/lib/python2.7/site-packages/ansiblelint/rules, \u4f7f\u7528-R\u5219\u4e0d\u8986\u76d6\u9ed8\u8ba4\u89c4\u5219\u76ee\u5f55 -R \u8ddf-r\u4e00\u8d77\u4f7f\u7528\u3002 -t TAGS \u4ec5\u68c0\u67e5tag\u6807\u7b7e\u7684\u4efb\u52a1 -T \u5217\u51fa\u6240\u6709tag -v \u8be6\u7ec6\u8f93\u51fa -x SKIP_LIST \u8df3\u8fc7\u6307\u5b9a\u7684id/tags\u4efb\u52a1 --nocolor \u5173\u95ed\u989c\u8272\u8f93\u51fa --force-color \u5f3a\u5236\u989c\u8272\u8f93\u51fa --exclude = EXCLUDE_PATHS \u8981\u6392\u9664\u7684\u76ee\u5f55\u6216\u6587\u4ef6\u7684\u8def\u5f84\u3002\u53ef\u591a\u6b21\u6307\u5b9a\u3002 -c C \u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\uff0c\u9ed8\u8ba4 \".ansible-lint\" \u68c0\u67e5roles \u00b6 # ansible-lint roles/os-check [ 602 ] Don 't compare to empty string roles/os-check/tasks/main.yaml:32 - check_mail_host != \"\" [602] Don' t compare to empty string roles/os-check/tasks/main.yaml:33 - check_mail_port ! = \"\" [ 602 ] Don 't compare to empty string roles/os-check/tasks/main.yaml:34 - check_mail_username != \"\" [602] Don' t compare to empty string roles/os-check/tasks/main.yaml:35 - check_mail_password ! = \"\" \u68c0\u67e5playbook \u00b6 # cat playbook.yaml --- - hosts: all tasks: - debug: msg = hello roles: - os-check # ansible-lint playbook.yaml [ 602 ] Don 't compare to empty string roles/os-check/tasks/main.yaml:32 - check_mail_host != \"\" [602] Don' t compare to empty string roles/os-check/tasks/main.yaml:33 - check_mail_port ! = \"\" [ 602 ] Don 't compare to empty string roles/os-check/tasks/main.yaml:34 - check_mail_username != \"\" [602] Don' t compare to empty string roles/os-check/tasks/main.yaml:35 - check_mail_password ! = \"\" \u6839\u636e\u89c4\u5219\u63d0\u793a\uff0c\u6765\u4fee\u6b63\u4f60\u7684playbook \u914d\u7f6e\u6587\u4ef6 \u00b6 Ansible-lint \u9ed8\u8ba4\u5bfb\u627e\u5f53\u524d\u76ee\u5f55\u7684 .ansible-lint \u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6\uff0c\u4e5f\u53ef\u6307\u5b9a -c file \u6307\u5b9a\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u3002 \u914d\u7f6e\u6587\u4ef6\u652f\u6301\u4ee5\u4e0b\u503c\uff0c\u5e76\u4e14\u5176\u529f\u80fd\u4e0e\u5bf9\u5e94\u7684CLI\u76f8\u540c exclude_paths : - ./my/excluded/directory/ - ./my/other/excluded/directory/ - ./last/excluded/directory/ parseable : true quiet : true rulesdir : - ./rule/directory/ skip_list : - skip_this_tag - and_this_one_too - skip_this_id - '401' tags : - run_this_tag use_default_rules : true verbosity : 1 \u89c4\u5219 \u00b6 \u9ed8\u8ba4\u89c4\u5219\u5b58\u5728 /usr/lib/python2.7/site-packages/ansiblelint/rules \u76ee\u5f55\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 -r \u9009\u9879\u6307\u5b9a\u89c4\u5219\u76ee\u5f55\uff0c\u548c -R \u4e00\u8d77\u4f7f\u7528\u65f6\u4fdd\u7559\u9ed8\u8ba4\u89c4\u5219\u76ee\u5f55\uff0c\u53cd\u4e4b\u66ff\u6362\u3002 \u5217\u51fa\u89c4\u5219 \u00b6 # ansible-lint -L 101 : Deprecated always_run Instead of `` always_run `` , use `` check_mode `` 102 : No Jinja2 in when `` when `` lines should not include Jinja2 variables 103 : Deprecated sudo Instead of `` sudo `` / `` sudo_user `` , use `` become `` / `` become_user `` . 104 : Using bare variables is deprecated Using bare variables is deprecated. Update your playbooks so that the environment value uses the full variable syntax `` {{ your_variable }} `` 105 : Deprecated module These are deprecated modules, some modules are kept temporarily for backwards compatibility but usage is discouraged. For more details see: https://docs.ansible.com/ansible/latest/modules/list_of_all_modules.html 201 : Trailing whitespace There should not be any trailing whitespace 202 : Octal file permissions must contain leading zero or be a string Numeric file permissions without leading zero can behave in unexpected ways. See http://docs.ansible.com/ansible/file_module.html 203 : Most files should not contain tabs Tabs can cause unexpected display issues, use spaces 204 : Lines should be no longer than 160 chars Long lines make code harder to read and code review more difficult 205 : Use \".yml\" or \".yaml\" playbook extension Playbooks should have the \".yml\" or \".yaml\" extension 206 : Variables should have spaces before and after: {{ var_name }} Variables should have spaces before and after: `` {{ var_name }} `` 301 : Commands should not change things if nothing needs doing Commands should either read information ( and thus set `` changed_when `` ) or not do something if it has already been done ( using creates/removes ) or only do it if another check has a particular result ( `` when `` ) 302 : Using command rather than an argument to e.g. file Executing a command when there are arguments to modules is generally a bad idea 303 : Using command rather than module Executing a command when there is an Ansible module is generally a bad idea 304 : Environment variables don 't work as part of command Environment variables should be passed to ``shell`` or ``command`` through environment argument 305: Use shell only when shell functionality is required Shell should only be used when piping, redirecting or chaining commands (and Ansible would be preferred for some of those!) 306: Shells that use pipes should set the pipefail option Without the pipefail option set, a shell command that implements a pipeline can fail and still return 0. If any part of the pipeline other than the terminal command fails, the whole pipeline will still return 0, which may be considered a success by Ansible. Pipefail is available in the bash shell. 401: Git checkouts must contain explicit version All version control checkouts must point to an explicit commit or tag, not just ``latest`` 402: Mercurial checkouts must contain explicit revision All version control checkouts must point to an explicit commit or tag, not just ``latest`` 403: Package installs should not use latest Package installs should use ``state=present`` with or without a version 404: Doesn' t need a relative path in role `` copy `` and `` template `` do not need to use relative path for `` src `` 501 : become_user requires become to work as expected `` become_user `` without `` become `` will not actually change user 502 : All tasks should be named All tasks should have a distinct name for readability and for `` --start-at-task `` to work 503 : Tasks that run when changed should likely be handlers If a task has a `` when: result.changed `` setting, it is effectively acting as a handler 504 : Do not use 'local_action' , use 'delegate_to: localhost' Do not use `` local_action `` , use `` delegate_to: localhost `` 601 : Don 't compare to literal True/False Use ``when: var`` rather than ``when: var == True`` (or conversely ``when: not var``) 602: Don' t compare to empty string Use `` when: var `` rather than `` when: var ! = \"\" `` ( or conversely `` when: not var `` rather than `` when: var == \"\" `` ) 701 : meta/main.yml should contain relevant info meta/main.yml should contain: `` author, description, license, min_ansible_version, platforms `` 702 : Tags must contain lowercase letters and digits only Tags must contain lowercase letters and digits only, and `` galaxy_tags `` is expected to be a list 703 : meta/main.yml default values should be changed meta/main.yml default values should be changed for : `` author, description, company, license, license `` 704 : meta/main.yml video_links should be formatted correctly Items in `` video_links `` in meta/main.yml should be dictionaries, and contain only keys `` url `` and `` title `` , and have a shared link from a supported provider \u89c4\u5219\u6807\u8bb0 \u00b6 \u4f7f\u7528\u4e0b\u5217\u7684\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u89c4\u5219\u6709\u90a3\u4e9b\u6807\u8bb0 # ansible-lint -v -T ANSIBLE0002 [ '[201]' ] ANSIBLE0004 [ '[401]' ] ANSIBLE0005 [ '[402]' ] ANSIBLE0006 [ '[303]' ] ANSIBLE0007 [ '[302]' ] ANSIBLE0008 [ '[103]' ] ANSIBLE0009 [ '[202]' ] ANSIBLE0010 [ '[403]' ] ANSIBLE0011 [ '[502]' ] ANSIBLE0012 [ '[301]' ] ANSIBLE0013 [ '[305]' ] ANSIBLE0014 [ '[304]' ] ANSIBLE0015 [ '[104]' ] ANSIBLE0016 [ '[503]' ] ANSIBLE0017 [ '[501]' ] ANSIBLE0018 [ '[101]' ] ANSIBLE0019 [ '[102]' ] behaviour [ '[503]' ] bug [ '[304]' ] command-shell [ '[301]' , '[302]' , '[303]' , '[304]' , '[306]' , '[305]' ] deprecated [ '[101]' , '[105]' , '[102]' , '[103]' , '[104]' ] formatting [ '[204]' , '[203]' , '[202]' , '[205]' , '[201]' , '[104]' , '[206]' ] idempotency [ '[301]' ] idiom [ '[602]' , '[601]' ] metadata [ '[703]' , '[701]' , '[702]' , '[704]' ] module [ '[401]' , '[402]' , '[403]' , '[404]' ] oddity [ '[501]' ] readability [ '[502]' ] repeatability [ '[401]' , '[402]' , '[403]' ] resources [ '[302]' , '[303]' ] safety [ '[305]' ] task [ '[501]' , '[502]' , '[504]' , '[503]' ] \u53ea\u68c0\u6d4b\u4e00\u4e2a\u6807\u8bb0\u89c4\u5219 ansible-lint -t idempotency playbook.yml \u6392\u9664\u89c4\u5219 ansible-lint -x readability,safety playbook.yml \u4e5f\u53ef\u4ee5\u6307\u5b9a\u89c4\u5219id ansible-lint -x ANSIBLE0011 playbook.yml \u8df3\u8fc7\u89c4\u5219 \u00b6 \u5982\u679c\u60f3\u5728\u4efb\u52a1\u4e0a\u8df3\u8fc7\u68c0\u67e5\u89c4\u5219\uff0c\u53ef\u5728\u884c\u5185\u672b\u5c3e\u52a0\u4e0a # noqa [rule_id] \u5373\u53ef\u8df3\u8fc7\u5bf9\u5e94\u7684\u89c4\u5219\u3002 - name : this would typically fire GitHasVersionRule 401 and BecomeUserWithoutBecomeRule 501 become_user : alice # noqa 401 501 git : src=/path/to/git/repo dest=checkout - name : this would typically fire LineTooLongRule 204 and VariableHasSpacesRule 206 get_url : url : http://example.com/really_long_path/really_long_path/really_long_path/really_long_path/really_long_path/really_long_path/file.conf # noqa 204 dest : \"{{dest_proj_path}}/foo.conf\" # noqa 206 \u4f7f\u7528\u547d\u4ee4\u884c\u9009\u9879\u8df3\u8fc7 ansible-lint -x readability,safety playbook.yml \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8df3\u8fc7 skip_list : - skip_this_tag - and_this_one_too - skip_this_id - '401'","title":"\u4f7f\u7528 Ansible-lint"},{"location":"advanced/ansible-lint/#ansible-lint","text":"Ansible Lint \u662f\u7528\u4e8e\u68c0\u6d4bplaybook\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u63d0\u4f9b\u5efa\u8bae\u6765\u5e2e\u52a9\u4f60\u4fee\u6b63playbook\u3002","title":"\u4f7f\u7528 ansible-lint"},{"location":"advanced/ansible-lint/#_1","text":"pip install ansible-lint","title":"\u5b89\u88c5"},{"location":"advanced/ansible-lint/#_2","text":"\u547d\u4ee4\u9009\u9879 ansible-lint --help Usage: ansible-lint [ options ] [ playbook.yml [ playbook2 ... ]] Options: --version \u663e\u793a\u9879\u76ee\u7248\u672c -h, --help \u663e\u793a\u5e2e\u52a9\u4fe1\u606f -L \u5217\u51fa\u6240\u6709\u89c4\u5219 -q \u8f93\u51fa\u5c11\u91cf\u4fe1\u606f -p \u4ee5pep8\u683c\u5f0f\u89e3\u6790\u7684\u8f93\u51fa --parseable-severity \u5206\u6790\u8f93\u51fa\uff0c\u5305\u62ec\u89c4\u5219\u7684\u4e25\u91cd\u6027 -r RULESDIR \u6307\u5b9a\u89c4\u5219\u76ee\u5f55\uff0c\u4f7f\u7528\u591a\u4e2a-r\u6307\u5b9a\u591a\u4e2a\u76ee\u5f55\u4f1a\u8986\u76d6\u9ed8\u8ba4\u76ee\u5f55 /usr/lib/python2.7/site-packages/ansiblelint/rules, \u4f7f\u7528-R\u5219\u4e0d\u8986\u76d6\u9ed8\u8ba4\u89c4\u5219\u76ee\u5f55 -R \u8ddf-r\u4e00\u8d77\u4f7f\u7528\u3002 -t TAGS \u4ec5\u68c0\u67e5tag\u6807\u7b7e\u7684\u4efb\u52a1 -T \u5217\u51fa\u6240\u6709tag -v \u8be6\u7ec6\u8f93\u51fa -x SKIP_LIST \u8df3\u8fc7\u6307\u5b9a\u7684id/tags\u4efb\u52a1 --nocolor \u5173\u95ed\u989c\u8272\u8f93\u51fa --force-color \u5f3a\u5236\u989c\u8272\u8f93\u51fa --exclude = EXCLUDE_PATHS \u8981\u6392\u9664\u7684\u76ee\u5f55\u6216\u6587\u4ef6\u7684\u8def\u5f84\u3002\u53ef\u591a\u6b21\u6307\u5b9a\u3002 -c C \u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\uff0c\u9ed8\u8ba4 \".ansible-lint\"","title":"\u4f7f\u7528"},{"location":"advanced/ansible-lint/#roles","text":"# ansible-lint roles/os-check [ 602 ] Don 't compare to empty string roles/os-check/tasks/main.yaml:32 - check_mail_host != \"\" [602] Don' t compare to empty string roles/os-check/tasks/main.yaml:33 - check_mail_port ! = \"\" [ 602 ] Don 't compare to empty string roles/os-check/tasks/main.yaml:34 - check_mail_username != \"\" [602] Don' t compare to empty string roles/os-check/tasks/main.yaml:35 - check_mail_password ! = \"\"","title":"\u68c0\u67e5roles"},{"location":"advanced/ansible-lint/#playbook","text":"# cat playbook.yaml --- - hosts: all tasks: - debug: msg = hello roles: - os-check # ansible-lint playbook.yaml [ 602 ] Don 't compare to empty string roles/os-check/tasks/main.yaml:32 - check_mail_host != \"\" [602] Don' t compare to empty string roles/os-check/tasks/main.yaml:33 - check_mail_port ! = \"\" [ 602 ] Don 't compare to empty string roles/os-check/tasks/main.yaml:34 - check_mail_username != \"\" [602] Don' t compare to empty string roles/os-check/tasks/main.yaml:35 - check_mail_password ! = \"\" \u6839\u636e\u89c4\u5219\u63d0\u793a\uff0c\u6765\u4fee\u6b63\u4f60\u7684playbook","title":"\u68c0\u67e5playbook"},{"location":"advanced/ansible-lint/#_3","text":"Ansible-lint \u9ed8\u8ba4\u5bfb\u627e\u5f53\u524d\u76ee\u5f55\u7684 .ansible-lint \u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6\uff0c\u4e5f\u53ef\u6307\u5b9a -c file \u6307\u5b9a\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u3002 \u914d\u7f6e\u6587\u4ef6\u652f\u6301\u4ee5\u4e0b\u503c\uff0c\u5e76\u4e14\u5176\u529f\u80fd\u4e0e\u5bf9\u5e94\u7684CLI\u76f8\u540c exclude_paths : - ./my/excluded/directory/ - ./my/other/excluded/directory/ - ./last/excluded/directory/ parseable : true quiet : true rulesdir : - ./rule/directory/ skip_list : - skip_this_tag - and_this_one_too - skip_this_id - '401' tags : - run_this_tag use_default_rules : true verbosity : 1","title":"\u914d\u7f6e\u6587\u4ef6"},{"location":"advanced/ansible-lint/#_4","text":"\u9ed8\u8ba4\u89c4\u5219\u5b58\u5728 /usr/lib/python2.7/site-packages/ansiblelint/rules \u76ee\u5f55\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 -r \u9009\u9879\u6307\u5b9a\u89c4\u5219\u76ee\u5f55\uff0c\u548c -R \u4e00\u8d77\u4f7f\u7528\u65f6\u4fdd\u7559\u9ed8\u8ba4\u89c4\u5219\u76ee\u5f55\uff0c\u53cd\u4e4b\u66ff\u6362\u3002","title":"\u89c4\u5219"},{"location":"advanced/ansible-lint/#_5","text":"# ansible-lint -L 101 : Deprecated always_run Instead of `` always_run `` , use `` check_mode `` 102 : No Jinja2 in when `` when `` lines should not include Jinja2 variables 103 : Deprecated sudo Instead of `` sudo `` / `` sudo_user `` , use `` become `` / `` become_user `` . 104 : Using bare variables is deprecated Using bare variables is deprecated. Update your playbooks so that the environment value uses the full variable syntax `` {{ your_variable }} `` 105 : Deprecated module These are deprecated modules, some modules are kept temporarily for backwards compatibility but usage is discouraged. For more details see: https://docs.ansible.com/ansible/latest/modules/list_of_all_modules.html 201 : Trailing whitespace There should not be any trailing whitespace 202 : Octal file permissions must contain leading zero or be a string Numeric file permissions without leading zero can behave in unexpected ways. See http://docs.ansible.com/ansible/file_module.html 203 : Most files should not contain tabs Tabs can cause unexpected display issues, use spaces 204 : Lines should be no longer than 160 chars Long lines make code harder to read and code review more difficult 205 : Use \".yml\" or \".yaml\" playbook extension Playbooks should have the \".yml\" or \".yaml\" extension 206 : Variables should have spaces before and after: {{ var_name }} Variables should have spaces before and after: `` {{ var_name }} `` 301 : Commands should not change things if nothing needs doing Commands should either read information ( and thus set `` changed_when `` ) or not do something if it has already been done ( using creates/removes ) or only do it if another check has a particular result ( `` when `` ) 302 : Using command rather than an argument to e.g. file Executing a command when there are arguments to modules is generally a bad idea 303 : Using command rather than module Executing a command when there is an Ansible module is generally a bad idea 304 : Environment variables don 't work as part of command Environment variables should be passed to ``shell`` or ``command`` through environment argument 305: Use shell only when shell functionality is required Shell should only be used when piping, redirecting or chaining commands (and Ansible would be preferred for some of those!) 306: Shells that use pipes should set the pipefail option Without the pipefail option set, a shell command that implements a pipeline can fail and still return 0. If any part of the pipeline other than the terminal command fails, the whole pipeline will still return 0, which may be considered a success by Ansible. Pipefail is available in the bash shell. 401: Git checkouts must contain explicit version All version control checkouts must point to an explicit commit or tag, not just ``latest`` 402: Mercurial checkouts must contain explicit revision All version control checkouts must point to an explicit commit or tag, not just ``latest`` 403: Package installs should not use latest Package installs should use ``state=present`` with or without a version 404: Doesn' t need a relative path in role `` copy `` and `` template `` do not need to use relative path for `` src `` 501 : become_user requires become to work as expected `` become_user `` without `` become `` will not actually change user 502 : All tasks should be named All tasks should have a distinct name for readability and for `` --start-at-task `` to work 503 : Tasks that run when changed should likely be handlers If a task has a `` when: result.changed `` setting, it is effectively acting as a handler 504 : Do not use 'local_action' , use 'delegate_to: localhost' Do not use `` local_action `` , use `` delegate_to: localhost `` 601 : Don 't compare to literal True/False Use ``when: var`` rather than ``when: var == True`` (or conversely ``when: not var``) 602: Don' t compare to empty string Use `` when: var `` rather than `` when: var ! = \"\" `` ( or conversely `` when: not var `` rather than `` when: var == \"\" `` ) 701 : meta/main.yml should contain relevant info meta/main.yml should contain: `` author, description, license, min_ansible_version, platforms `` 702 : Tags must contain lowercase letters and digits only Tags must contain lowercase letters and digits only, and `` galaxy_tags `` is expected to be a list 703 : meta/main.yml default values should be changed meta/main.yml default values should be changed for : `` author, description, company, license, license `` 704 : meta/main.yml video_links should be formatted correctly Items in `` video_links `` in meta/main.yml should be dictionaries, and contain only keys `` url `` and `` title `` , and have a shared link from a supported provider","title":"\u5217\u51fa\u89c4\u5219"},{"location":"advanced/ansible-lint/#_6","text":"\u4f7f\u7528\u4e0b\u5217\u7684\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u89c4\u5219\u6709\u90a3\u4e9b\u6807\u8bb0 # ansible-lint -v -T ANSIBLE0002 [ '[201]' ] ANSIBLE0004 [ '[401]' ] ANSIBLE0005 [ '[402]' ] ANSIBLE0006 [ '[303]' ] ANSIBLE0007 [ '[302]' ] ANSIBLE0008 [ '[103]' ] ANSIBLE0009 [ '[202]' ] ANSIBLE0010 [ '[403]' ] ANSIBLE0011 [ '[502]' ] ANSIBLE0012 [ '[301]' ] ANSIBLE0013 [ '[305]' ] ANSIBLE0014 [ '[304]' ] ANSIBLE0015 [ '[104]' ] ANSIBLE0016 [ '[503]' ] ANSIBLE0017 [ '[501]' ] ANSIBLE0018 [ '[101]' ] ANSIBLE0019 [ '[102]' ] behaviour [ '[503]' ] bug [ '[304]' ] command-shell [ '[301]' , '[302]' , '[303]' , '[304]' , '[306]' , '[305]' ] deprecated [ '[101]' , '[105]' , '[102]' , '[103]' , '[104]' ] formatting [ '[204]' , '[203]' , '[202]' , '[205]' , '[201]' , '[104]' , '[206]' ] idempotency [ '[301]' ] idiom [ '[602]' , '[601]' ] metadata [ '[703]' , '[701]' , '[702]' , '[704]' ] module [ '[401]' , '[402]' , '[403]' , '[404]' ] oddity [ '[501]' ] readability [ '[502]' ] repeatability [ '[401]' , '[402]' , '[403]' ] resources [ '[302]' , '[303]' ] safety [ '[305]' ] task [ '[501]' , '[502]' , '[504]' , '[503]' ] \u53ea\u68c0\u6d4b\u4e00\u4e2a\u6807\u8bb0\u89c4\u5219 ansible-lint -t idempotency playbook.yml \u6392\u9664\u89c4\u5219 ansible-lint -x readability,safety playbook.yml \u4e5f\u53ef\u4ee5\u6307\u5b9a\u89c4\u5219id ansible-lint -x ANSIBLE0011 playbook.yml","title":"\u89c4\u5219\u6807\u8bb0"},{"location":"advanced/ansible-lint/#_7","text":"\u5982\u679c\u60f3\u5728\u4efb\u52a1\u4e0a\u8df3\u8fc7\u68c0\u67e5\u89c4\u5219\uff0c\u53ef\u5728\u884c\u5185\u672b\u5c3e\u52a0\u4e0a # noqa [rule_id] \u5373\u53ef\u8df3\u8fc7\u5bf9\u5e94\u7684\u89c4\u5219\u3002 - name : this would typically fire GitHasVersionRule 401 and BecomeUserWithoutBecomeRule 501 become_user : alice # noqa 401 501 git : src=/path/to/git/repo dest=checkout - name : this would typically fire LineTooLongRule 204 and VariableHasSpacesRule 206 get_url : url : http://example.com/really_long_path/really_long_path/really_long_path/really_long_path/really_long_path/really_long_path/file.conf # noqa 204 dest : \"{{dest_proj_path}}/foo.conf\" # noqa 206 \u4f7f\u7528\u547d\u4ee4\u884c\u9009\u9879\u8df3\u8fc7 ansible-lint -x readability,safety playbook.yml \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8df3\u8fc7 skip_list : - skip_this_tag - and_this_one_too - skip_this_id - '401'","title":"\u8df3\u8fc7\u89c4\u5219"},{"location":"advanced/ara/","text":"\u4f7f\u7528 ARA \u8bb0\u5f55 Ansible \u6267\u884c\u7ed3\u679c \u00b6 ARA \u901a\u8fc7\u4f7f\u7528 Ansible callback plugin \u5c06 Ansible playbook \u6267\u884c\u7ed3\u679c\u4fdd\u5b58\u5230\u672c\u5730\u6216\u8fdc\u7a0b\u6570\u636e\u5e93\u3002 \u8be5\u56de\u8c03\u63d2\u4ef6\u5229\u7528\u5185\u7f6e\u7684python API\u5ba2\u6237\u7aef\u5c06\u6570\u636e\u53d1\u9001\u5230REST API\u670d\u52a1\u5668\uff0c\u8be5\u670d\u52a1\u5668\u4e0a\u7684\u6570\u636e\u548c\u6307\u6807\u53ef\u7528\u4e8e\u67e5\u8be2\uff0c\u6d4f\u89c8\uff0c\u76d1\u89c6\u6216\u96c6\u6210\u5728\u5176\u4ed6\u5de5\u5177\u548c\u754c\u9762\u4e2d\u3002 \u66f4\u591a\u4ecb\u7ecd\u89c1 ARA \u6587\u6863 \u5b89\u88c5 \u00b6 \u5b89\u88c5ansible yum -y install python36 python36-pip pip3.6 install ansible -i https://mirrors.aliyun.com/pypi/simple \u5b89\u88c5 ara server pip3 install Django == 2 .1.15 -i https://mirrors.aliyun.com/pypi/simple pip3 install \"ara[server]\" -i https://mirrors.aliyun.com/pypi/simple \u7248\u672c\u4fe1\u606f # cat /etc/centos-release CentOS Linux release 7 .6.1810 ( Core ) # python -V Python 2 .7.5 # ansible --version ansible 2 .9.9 config file = /etc/ansible/ansible.cfg configured module search path = [ '/root/.ansible/plugins/modules' , '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/local/lib/python3.6/site-packages/ansible executable location = /usr/local/bin/ansible python version = 3 .6.8 ( default, Apr 2 2020 , 13 :34:55 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] # ara-manage version [ ara ] Using settings file: /root/.ara/server/settings.yaml 2 .1.15 \u914d\u7f6e \u00b6 \u914d\u7f6e\u63d2\u4ef6 \u00b6 \u5728 ansible.cfg \u4e2d\u914d\u7f6eara\u63d2\u4ef6\u5730\u5740 # mkdir /etc/ansible # python3 -m ara.setup.ansible > /etc/ansible/ansible.cfg # cat /etc/ansible/ansible.cfg [ defaults ] callback_plugins = /usr/local/lib/python3.6/site-packages/ara/plugins/callback action_plugins = /usr/local/lib/python3.6/site-packages/ara/plugins/action lookup_plugins = /usr/local/lib/python3.6/site-packages/ara/plugins/lookup \u4e5f\u53ef\u4ee5\u4f7f\u7528\u73af\u5883\u53d8\u91cf # python3 -m ara.setup.env export ANSIBLE_CALLBACK_PLUGINS = ${ ANSIBLE_CALLBACK_PLUGINS :- }${ ANSIBLE_CALLBACK_PLUGINS +: } /usr/local/lib/python3.6/site-packages/ara/plugins/callback export ANSIBLE_ACTION_PLUGINS = ${ ANSIBLE_ACTION_PLUGINS :- }${ ANSIBLE_ACTION_PLUGINS +: } /usr/local/lib/python3.6/site-packages/ara/plugins/action export ANSIBLE_LOOKUP_PLUGINS = ${ ANSIBLE_LOOKUP_PLUGINS :- }${ ANSIBLE_LOOKUP_PLUGINS +: } /usr/local/lib/python3.6/site-packages/ara/plugins/lookup \u5728 ansible.cfg \u4e2d\u914d\u7f6eara\u63d2\u4ef6\u53c2\u6570 [ ara ] api_client = http api_server = http://192.168.77.130:9191 default_labels = dev,test \u914d\u7f6e\u7cfb\u7edf\u670d\u52a1 \u00b6 useradd ansible cat << EOF > /etc/systemd/system/ara.service [Unit] Description=ara After=network.target [Service] Type=simple User=ansible Group=ansible TimeoutStartSec=0 Restart=on-failure RestartSec=10 RemainAfterExit=yes ExecStart=/usr/local/bin/ara-manage runserver 0.0.0.0:9191 Environment=\"ARA_ALLOWED_HOSTS=['*']\" [Install] WantedBy=multi-user.target EOF systemctl daemon-reload systemctl enable --now ara \u751f\u6210\u8868 \u00b6 \u9ed8\u8ba4\u4f7f\u7528sqlite\u4f5c\u4e3a\u6570\u636e\u5e93 runuser -s /bin/bash ansible -c \"ara-manage makemigrations; ara-manage migrate\" \u6267\u884c Playbook \u00b6 playbook --- - hosts: localhost tasks: - ping: - name: Record different things ara_record: key: \"{{ item.key }}\" value: \"{{ item.value }}\" type: \"{{ item.type }}\" loop: - { key: \"log\" , value: \"error\" , type: \"text\" } - { key: \"website\" , value: \"http://domain.tld\" , type: \"url\" } \u8fd0\u884c # ansible-playbook test.yml PLAY [ localhost ] ******************************************************************************************************************************************* TASK [ Gathering Facts ] ************************************************************************************* ok: [ localhost ] TASK [ ping ] ************************************************************************************* ok: [ localhost ] TASK [ Record different things ] ************************************************************************************* changed: [ localhost ] = > ( item ={ 'key' : 'log' , 'value' : 'error' , 'type' : 'text' }) changed: [ localhost ] = > ( item ={ 'key' : 'website' , 'value' : 'http://domain.tld' , 'type' : 'url' }) PLAY RECAP ************************************************************************************* localhost : ok = 3 changed = 1 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u6253\u5f00ara web http://192.168.77.130:9191 \u9875\u9762\u5c31\u80fd\u770b\u5230\u6267\u884c\u7684playbook \u70b9\u51fb\u8fdb\u53bb\uff0c\u5c31\u80fd\u770b\u5230\u8be6\u7ec6\u4fe1\u606f \u6267\u884c ad-hoc \u00b6 export ANSIBLE_LOAD_CALLBACK_PLUGINS = 1 ansible localhost -m ping \u8bb0\u5f55ad-hoc\u7684\u4fe1\u606f","title":"\u4f7f\u7528 ARA \u8bb0\u5f55 Ansible \u6267\u884c\u7ed3\u679c"},{"location":"advanced/ara/#ara-ansible","text":"ARA \u901a\u8fc7\u4f7f\u7528 Ansible callback plugin \u5c06 Ansible playbook \u6267\u884c\u7ed3\u679c\u4fdd\u5b58\u5230\u672c\u5730\u6216\u8fdc\u7a0b\u6570\u636e\u5e93\u3002 \u8be5\u56de\u8c03\u63d2\u4ef6\u5229\u7528\u5185\u7f6e\u7684python API\u5ba2\u6237\u7aef\u5c06\u6570\u636e\u53d1\u9001\u5230REST API\u670d\u52a1\u5668\uff0c\u8be5\u670d\u52a1\u5668\u4e0a\u7684\u6570\u636e\u548c\u6307\u6807\u53ef\u7528\u4e8e\u67e5\u8be2\uff0c\u6d4f\u89c8\uff0c\u76d1\u89c6\u6216\u96c6\u6210\u5728\u5176\u4ed6\u5de5\u5177\u548c\u754c\u9762\u4e2d\u3002 \u66f4\u591a\u4ecb\u7ecd\u89c1 ARA \u6587\u6863","title":"\u4f7f\u7528 ARA \u8bb0\u5f55 Ansible \u6267\u884c\u7ed3\u679c"},{"location":"advanced/ara/#_1","text":"\u5b89\u88c5ansible yum -y install python36 python36-pip pip3.6 install ansible -i https://mirrors.aliyun.com/pypi/simple \u5b89\u88c5 ara server pip3 install Django == 2 .1.15 -i https://mirrors.aliyun.com/pypi/simple pip3 install \"ara[server]\" -i https://mirrors.aliyun.com/pypi/simple \u7248\u672c\u4fe1\u606f # cat /etc/centos-release CentOS Linux release 7 .6.1810 ( Core ) # python -V Python 2 .7.5 # ansible --version ansible 2 .9.9 config file = /etc/ansible/ansible.cfg configured module search path = [ '/root/.ansible/plugins/modules' , '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/local/lib/python3.6/site-packages/ansible executable location = /usr/local/bin/ansible python version = 3 .6.8 ( default, Apr 2 2020 , 13 :34:55 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] # ara-manage version [ ara ] Using settings file: /root/.ara/server/settings.yaml 2 .1.15","title":"\u5b89\u88c5"},{"location":"advanced/ara/#_2","text":"","title":"\u914d\u7f6e"},{"location":"advanced/ara/#_3","text":"\u5728 ansible.cfg \u4e2d\u914d\u7f6eara\u63d2\u4ef6\u5730\u5740 # mkdir /etc/ansible # python3 -m ara.setup.ansible > /etc/ansible/ansible.cfg # cat /etc/ansible/ansible.cfg [ defaults ] callback_plugins = /usr/local/lib/python3.6/site-packages/ara/plugins/callback action_plugins = /usr/local/lib/python3.6/site-packages/ara/plugins/action lookup_plugins = /usr/local/lib/python3.6/site-packages/ara/plugins/lookup \u4e5f\u53ef\u4ee5\u4f7f\u7528\u73af\u5883\u53d8\u91cf # python3 -m ara.setup.env export ANSIBLE_CALLBACK_PLUGINS = ${ ANSIBLE_CALLBACK_PLUGINS :- }${ ANSIBLE_CALLBACK_PLUGINS +: } /usr/local/lib/python3.6/site-packages/ara/plugins/callback export ANSIBLE_ACTION_PLUGINS = ${ ANSIBLE_ACTION_PLUGINS :- }${ ANSIBLE_ACTION_PLUGINS +: } /usr/local/lib/python3.6/site-packages/ara/plugins/action export ANSIBLE_LOOKUP_PLUGINS = ${ ANSIBLE_LOOKUP_PLUGINS :- }${ ANSIBLE_LOOKUP_PLUGINS +: } /usr/local/lib/python3.6/site-packages/ara/plugins/lookup \u5728 ansible.cfg \u4e2d\u914d\u7f6eara\u63d2\u4ef6\u53c2\u6570 [ ara ] api_client = http api_server = http://192.168.77.130:9191 default_labels = dev,test","title":"\u914d\u7f6e\u63d2\u4ef6"},{"location":"advanced/ara/#_4","text":"useradd ansible cat << EOF > /etc/systemd/system/ara.service [Unit] Description=ara After=network.target [Service] Type=simple User=ansible Group=ansible TimeoutStartSec=0 Restart=on-failure RestartSec=10 RemainAfterExit=yes ExecStart=/usr/local/bin/ara-manage runserver 0.0.0.0:9191 Environment=\"ARA_ALLOWED_HOSTS=['*']\" [Install] WantedBy=multi-user.target EOF systemctl daemon-reload systemctl enable --now ara","title":"\u914d\u7f6e\u7cfb\u7edf\u670d\u52a1"},{"location":"advanced/ara/#_5","text":"\u9ed8\u8ba4\u4f7f\u7528sqlite\u4f5c\u4e3a\u6570\u636e\u5e93 runuser -s /bin/bash ansible -c \"ara-manage makemigrations; ara-manage migrate\"","title":"\u751f\u6210\u8868"},{"location":"advanced/ara/#playbook","text":"playbook --- - hosts: localhost tasks: - ping: - name: Record different things ara_record: key: \"{{ item.key }}\" value: \"{{ item.value }}\" type: \"{{ item.type }}\" loop: - { key: \"log\" , value: \"error\" , type: \"text\" } - { key: \"website\" , value: \"http://domain.tld\" , type: \"url\" } \u8fd0\u884c # ansible-playbook test.yml PLAY [ localhost ] ******************************************************************************************************************************************* TASK [ Gathering Facts ] ************************************************************************************* ok: [ localhost ] TASK [ ping ] ************************************************************************************* ok: [ localhost ] TASK [ Record different things ] ************************************************************************************* changed: [ localhost ] = > ( item ={ 'key' : 'log' , 'value' : 'error' , 'type' : 'text' }) changed: [ localhost ] = > ( item ={ 'key' : 'website' , 'value' : 'http://domain.tld' , 'type' : 'url' }) PLAY RECAP ************************************************************************************* localhost : ok = 3 changed = 1 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u6253\u5f00ara web http://192.168.77.130:9191 \u9875\u9762\u5c31\u80fd\u770b\u5230\u6267\u884c\u7684playbook \u70b9\u51fb\u8fdb\u53bb\uff0c\u5c31\u80fd\u770b\u5230\u8be6\u7ec6\u4fe1\u606f","title":"\u6267\u884c Playbook"},{"location":"advanced/ara/#ad-hoc","text":"export ANSIBLE_LOAD_CALLBACK_PLUGINS = 1 ansible localhost -m ping \u8bb0\u5f55ad-hoc\u7684\u4fe1\u606f","title":"\u6267\u884c ad-hoc"},{"location":"advanced/best-practices/","text":"Ansible \u6700\u4f73\u5b9e\u8df5 \u00b6 \u4ecb\u7ecd\u4e0bansible\u5982\u4f55\u5199\u4f5c\uff0c\u5982\u4f55\u6267\u884c\uff0c\u5982\u4f55\u5728\u751f\u4ea7\u4e2d\u4f7f\u7528\u3002 \u5982\u4f55\u5199\u4f5c \u00b6 \u50cf\u5bf9\u5f85\u4ee3\u7801\u4e00\u6837\u5bf9\u5f85\u4f60\u7684ansible \u00b6 \u62e5\u6709\u7248\u672c\u63a7\u5236 \u62e5\u6709\u53ef\u91cd\u590d\u6027 \u4ece\u57fa\u672c\u7684playbook\u76ee\u5f55\u7ed3\u6784\u548c\u9759\u6001\u7684\u4e3b\u673a\u6e05\u5355\u6765\u6784\u5efaroles \u540e\u7eed\u53ef\u4ee5\u81ea\u5df1\u5f00\u53d1\u6a21\u5757\u548c\u63d2\u4ef6 \u4e0d\u8981\u4f7f\u7528\u4e2a\u6027\u5316\u7684\u4e66\u5199\u65b9\u5f0f \u00b6 \u4e3a\u4f60\u7684\u98ce\u683c\u521b\u5efa\u4e00\u4e2a\u6807\u51c6 \u4f7f\u7528\u6807\u7b7e \u4f7f\u7528\u4e00\u81f4\u7684\u7a7a\u683c\u7f29\u8fdb \u4efb\u52a1\u3001\u89d2\u8272\u3001\u53d8\u91cf\u548c\u89d2\u8272\u7684\u8bed\u4e49\u5316\u547d\u540d \u76ee\u5f55\u7ed3\u6784 \u6267\u884c\u7684\u98ce\u683c \u5148\u68c0\u67e5\u8bed\u6cd5 \u5217\u51fa\u6267\u884c\u4e3b\u673a \u5217\u51fatasks\u4efb\u52a1 \u518d\u53bb\u6267\u884c \u4e00\u4e2a\u5f88\u597d\u7684 openshift-ansible \u98ce\u683c Note python Python\u6700\u5927\u884c\u957f\u5ea6 \u6240\u6709\u884c\u4e0d\u5e94\u8d85\u8fc780\u4e2a\u5b57\u7b26\u3002 \u6240\u6709\u7684\u884c\u5fc5\u987b\u4e0d\u8d85\u8fc7120\u4e2a\u5b57\u7b26\u3002 ansible Ansible Yaml \u6587\u4ef6\u6269\u5c55\u540d\u79f0 \u6240\u6709Ansible Yaml\u6587\u4ef6\u5fc5\u987b\u662f\u4e00\u4e2a .yml \u6269\u5c55\u540d(\u800c\u4e0d\u662f .YML \uff0c .yaml \u7b49)\u3002 Ansible CLI\u53d8\u91cf \u8981\u4eceansible CLI\u4f20\u9012\u8fdb\u6765\u7684\u53d8\u91cf\u5fc5\u987b\u6709\u4e00\u4e2a cli_ \u524d\u7f00 Ansible\u5168\u5c40\u53d8\u91cf \u5168\u5c40\u53d8\u91cf\u7684\u524d\u7f00\u5fc5\u987b\u662f g_ Ansible\u89d2\u8272\u53d8\u91cf \u89d2\u8272\u53d8\u91cf\u5fc5\u987b\u6709\u81f3\u5c113\u4e2a\u5b57\u7b26\u7684\u524d\u7f00\u3002\u8bf7\u53c2\u9605\u4e0b\u9762\u7684\u7279\u5b9a\u547d\u540d\u89c4\u5219\u3002 \u89d2\u8272\u540d\u79f0\u4e2d\u5305\u542b3\u4e2a(\u6216\u66f4\u591a)\u5355\u8bcd \u4ee5\u6bcf\u4e2a\u5355\u8bcd\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u4e3a\u4f8b\u3002 3\u5b57\u7b26\u7684\u793a\u4f8b\uff1a Role name: made_up_role Prefix: mur mur_var1: value_one 4\u5b57\u7b26\u7684\u793a\u4f8b: Role name: totally_made_up_role Prefix: tmur tmur_var1: value_one \u89d2\u8272\u540d\u79f0\u4e2d\u6709\u4e24\u4e2a(\u6216\u5c11\u4e8e\u4e24\u4e2a)\u5355\u8bcd \u7f16\u4e00\u4e2a\u6709\u610f\u4e49\u7684\u524d\u7f00\u3002 1 \u5355\u8bcd\u7684\u793a\u4f8b: Role name: ansible Prefix: ans ans_var1: value_one 2 \u5355\u8bcd\u7684\u793a\u4f8b: Role name: ansible_tower Prefix: tow tow_var1: value_one \u89d2\u8272\u540d\u79f0\u524d\u7f00\u51b2\u7a81 - hosts : localhost roles : - { role : made_up_role , mur_var1 : val1 } - { role : my_uber_role , mur_var1 : val2 } \u5373\u4f7f\u4e24\u4e2a\u89d2\u8272\u90fd\u5177\u6709\u76f8\u540c\u7684\u524d\u7f00\uff08mur\uff09\uff0c\u5e76\u4e14\u5373\u4f7f\u4e24\u4e2a\u89d2\u8272\u90fd\u6709\u4e00\u4e2a\u540d\u4e3amur_var1\u7684\u53d8\u91cf\uff0c\u56e0\u4e3a \u89d2\u8272\u53d8\u91cf\u88ab\u9650\u5236\u5728\u89d2\u8272\u672c\u8eab \uff0c\u8fd9\u4e24\u4e2a\u53d8\u91cf\u4e5f\u6c38\u8fdc\u4e0d\u4f1a\u5b58\u5728\u4e8e\u5404\u81ea\u7684\u89d2\u8272\u4e4b\u5916\u3002\u610f\u5473\u7740\u8fd9\u4e0d\u662f\u95ee\u9898\u3002 \u4ec5\u5f53my_uber_role\u53d6\u51b3\u4e8emade_up_role\u65f6\u624d\u6709\u95ee\u9898\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002 \u6216\u8005\uff0c\u5982\u679c\u8fd9\u4e24\u4e2a\u89d2\u8272\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u90fd\u5305\u542b\u53e6\u4e00\u4e2a\u89d2\u8272\u3002 \u5f53\u7136\uff0c\u8fd9\u662f\u4e00\u4e2a\u6781\u4e0d\u53ef\u80fd\u53d1\u751f\u7684\u6781\u7aef\u60c5\u51b5\u3002 \u5982\u679c\u662f\u8fd9\u6837\uff0c\u8bf7\u53e6\u5f53\u5904\u7406\u3002 \u4f7f\u7528git \u00b6 \u6bcf\u4e2a\u5206\u4eab\u7684playbook\u90fd\u9700\u8981\u6709\u4e00\u81f4\u7684\u76ee\u5f55\u7ed3\u6784\uff0c\u5e76\u4e14\u4f7f\u7528git\u4ed3\u5e93\u5b58\u50a8\u8bb0\u5f55\u6bcf\u4e00\u6b21\u63d0\u4ea4\u3002 site.yml # \u4e3b\u8981\u7684playbook\uff0c\u53ef\u4ee5\u8c03\u7528\u5176\u4ed6playbook webservers.yml # webserver\u4f7f\u7528\u7684 playbook deployonce.yml # \u9002\u7528\u4e8e\u4e00\u6b21\u6027\u90e8\u7f72\u7684 playbook inventories/ production/ # \u901a\u8fc7\u4e0d\u540c\u73af\u5883\u6765\u533a\u5206\u4e3b\u673a\u6e05\u5355 hosts # \u751f\u4ea7\u670d\u52a1\u5668\u7684\u4e3b\u673a\u6e05\u5355\u6587\u4ef6 group_vars/ host_vars/ london/ # \u5176\u4ed6\u7684\u5206\u7ec4\u4e3b\u673a\u6e05\u5355 roles/ requirements.yml # \u4f9d\u8d56\u7684\u5176\u4ed6\u89d2\u8272 common/ # \u57fa\u672c\u914d\u7f6e webtier/ # \u7528\u4e8e\u7279\u5b9a\u529f\u80fd\u7684\u89d2\u8272 inventory \u00b6 \u4f7f\u7528\u522b\u540d\u7ed9\u4e3b\u673a\u8282\u70b9\u8d77\u4e00\u4e2a\u6709\u610f\u4e49\u7684\u540d\u5b57 \u4e3b\u673a \u6709\u610f\u4e49\u7684\u540d\u79f0 10.1.2.75 10.1.5.45 10.1.4.5 10.1.0.40 db1 ansible_host=10.1.2.75 db2 ansible_host=10.1.5.45 db3 ansible_host=10.1.4.5 db4 ansible_host=10.1.0.40 w14301.acme.com w17802.acme.com w19203.acme.com w19304.acme.com web1 ansible_host=w14301.acme.com web2 ansible_host=w17802.acme.com web3 ansible_host=w19203.acme.com web4 ansible_host=w19203.acme.com \u7ed9\u4e3b\u673a\u5206\u914d\u4e0d\u540c\u7528\u9014\u7684\u7ec4\uff0c\u4ee5\u4fbf\u4e8e\u4e0d\u540c\u60c5\u51b5\u4e0b\u7684\u6279\u91cf\u4f7f\u7528 # \u6309\u670d\u52a1\u7c7b\u578b [db] db[1:4] [web] web[1:4] # \u6309\u73af\u5883 [dev] db1 web1 [testing] db3 web3 [prod] db2 web2 db4 web4 # \u6309\u533a\u57df [east] db1 web1 db3 web3 [west] db2 web2 db4 web4 \u5c3d\u53ef\u80fd\u4f7f\u7528\u52a8\u6001\u6e90\u3002\u8981\u4e48\u4f5c\u4e3a\u5355\u4e00\u6765\u6e90\uff0c\u8981\u4e48\u8ba9Ansible\u7edf\u4e00\u591a\u4e2a\u6765\u6e90 \u81ea\u52a8\u4fdd\u6301\u6e05\u5355\u540c\u6b65 \u51cf\u5c11\u4eba\u4e3a\u7684\u9519\u8bef \u53d8\u5316\u53d1\u751f\u65f6\u6ca1\u6709\u5ef6\u8fdf \u8ba9\u5176\u4ed6\u4eba\u7ba1\u7406\u4e3b\u673a\u6e05\u5355 \u53d8\u91cf \u00b6 \u5408\u9002\u7684\u53d8\u91cf\u540d\u53ef\u4ee5\u4f7fplaybook\u66f4\u5177\u53ef\u8bfb\u6027\uff0c\u5e76\u907f\u514d\u53d8\u91cf\u540d\u51b2\u7a81\u3002 # \u770b\u4e0d\u61c2\u7684\u53d8\u91cf\u540d\u79f0 a : 25 data : ab data2 : abc id : 123 # \u4e00\u773c\u5c31\u80fd\u770b\u61c2\u7684\u53d8\u91cf\u7528\u9014 apache_max_keepalive : 25 apache_port : 80 tomcat_port : 8080 \u901a\u8fc7\u5c06\u89d2\u8272\u540d\u4f5c\u4e3a\u524d\u7f00\u6dfb\u52a0\u5230\u53d8\u91cf\u4e2d\u6765\u907f\u514d\u51b2\u7a81\u548c\u6df7\u6dc6\u3002 apache_max_keepalive : 25 apache_port : 80 tomcat_port : 8080 \u4e3a\u53d8\u91cf\u8bbe\u7f6e\u5728\u5408\u9002\u7684\u4f4d\u7f6e \u6839\u636e\u53d8\u91cf\u7684\u8bbe\u7f6e\uff0c\u4fee\u6539\u5730\u70b9\u548c\u65f6\u95f4\uff0c\u4e3a\u53d8\u91cf\u627e\u5230\u5408\u9002\u7684\u4f4d\u7f6e \u5c06\u903b\u8f91(\u4efb\u52a1)\u4e0e\u53d8\u91cf\u5206\u79bb\uff0c\u51cf\u5c11\u91cd\u590d\u6a21\u5f0f \u4e0d\u8981\u5229\u7528\u6bcf\u4e00\u79cd\u53ef\u80fd\u6027\u6765\u5b58\u50a8\u53d8\u91cf- \u5c06\u5176\u56fa\u5b9a\u5230\u4e00\u4e2a\u5df2\u5b9a\u4e49\u7684\u65b9\u6848\u4e2d\uff0c\u5e76\u5c3d\u53ef\u80fd\u51cf\u5c11\u5b58\u50a8\u4f4d\u7f6e playbook \u00b6 \u4f7f\u7528YAML\u8bed\u6cd5 - name : install telegraf yum : name=telegraf-{{ telegraf_version }} state=present update_cache=yes enablerepo=telegraf notify : restart telegraf - name : start telegraf service : name=telegraf state=started \u4e0a\u9762\u7684\u65b9\u5f0f\u662f\u4e0d\u53ef\u53d6\u7684\uff0c\u9700\u8981\u4f7f\u7528 KEY:VALUE \u7684\u5f62\u5f0f - name : install telegraf yum : name : \"telegraf-{{ telegraf_version }}\" state : present update_cache : yes enablerepo : telegraf notify : restart telegraf - name : start telegraf service : name : telegraf state : started \u4e0d\u8981\u5ffd\u7565\u4efb\u52a1\u540d - hosts : web name : installs and starts apache tasks : - name : install apache packages yum : name : httpd state : latest - name : starts apache service service : name : httpd enabled : yes \u4e3a\u6bcf\u4e2a\u4efb\u52a1\u6307\u5b9a name ,\u53ef\u4ee5\u53cb\u597d\u7684\u8f93\u51fa\u6267\u884c\u4fe1\u606f PLAY [ install and starts apache ] ******************************** TASK [ setup ] ******************************** ok: [ web1 ] TASK [ install apache packages ] ******************************** ok: [ web1 ] TASK [ starts apache service ] ******************************** ok: [ web1 ] \u4f7f\u7528block \u00b6 block\u53ef\u4ee5\u5e2e\u52a9\u7ec4\u7ec7\u4ee3\u7801\uff0c\u8fd8\u53ef\u4ee5\u542f\u7528\u56de\u6eda\u6216\u8f93\u51fa\u6570\u636e\u4ee5\u8fdb\u884c\u5173\u952e\u6027\u66f4\u6539\u3002 - block : copy : src : critical.conf dest : /etc/critical/crit.conf service : name : critical state : restarted rescue : command : shutdown -h now \u5982\u4f55\u6267\u884c \u00b6 \u8c03\u8bd5\u6267\u884c \u00b6 Ansible\u4e3a\u547d\u4ee4\u884c\u4ea4\u4e92\u548c\u6545\u969c\u6392\u9664\u63d0\u4f9b\u591a\u4e2a\u9009\u9879 -vvvv \u6253\u5370debug\u4fe1\u606f --step \u4e00\u6b65\u4e00\u6b65\u7684\u6267\u884c,\u6bcf\u6b21\u6267\u884c\u524d\u9700\u8981\u624b\u52a8\u786e\u8ba4(ansible-playbook \u547d\u4ee4) --check \u6267\u884c\u68c0\u67e5\uff0c\u5e76\u4e0d\u4fee\u6539\u76ee\u6807 --diff \u5bf9\u6bd4\u6267\u884c\u7ed3\u679c --start-at-task \u4ece\u54ea\u4e00\u4e2a\u4efb\u52a1\u5f00\u59cb\u6267\u884c \u5206\u6790\u8fd0\u884c\u7684\u5185\u5bb9 \u00b6 Ansible \u63d0\u4f9b\u4e86\u8bb8\u591a\u9009\u9879\u6765\u663e\u793a\u4f60\u5c06\u8981\u8fd0\u884c\u7684\u5185\u5bb9 --list-tasks \u5217\u51fa\u8fd0\u884c\u7684\u4efb\u52a1 --list-tags \u5217\u51fa\u8fd0\u884c\u7684tag --list-hosts \u5217\u51fa\u8fd0\u884c\u7684\u4e3b\u673a --syntax-check \u6267\u884c\u8bed\u6cd5\u68c0\u6d4b \u65e0\u4e3b\u673a\u6e05\u5355\u7684\u5feb\u901f\u542f\u52a8 \u00b6 \u5982\u679c\u9700\u8981\u5bf9\u4e00\u4e9b\u6ca1\u6709\u5728\u4e3b\u673a\u6e05\u5355\u4e2d\u5b9a\u4e49\u7684\u4e3b\u673a\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5feb\u901f\u542f\u52a8 \u5355\u6b21\u4efb\u52a1 ansible all -i neon.qxyz.de, -m service -a \"name=redhat state=present\" \u6267\u884cplaybook ansible-playbook -i neon.qxyz.de,neon2.qxyz.de site.yml \u6ce8\u610f\uff0c\u5355\u4e2a\u4e3b\u673a\u8981\u6709 , \u7ed3\u5c3e \u4f7f\u7528\u6b63\u786e\u7684\u5de5\u5177 \u00b6 \u5bf9\u4e8e\u670d\u52a1\uff0c\u4e0d\u80fd\u53ea\u542f\u52a8\uff0c\u8fd8\u9700\u8981\u6d4b\u8bd5 - name : start myapp service : name : myapp state : started - name : check for proper response uri : url : http://localhost/myapp return_content : yes register : result until : '\"Hello World\" in result.content' retries : 10 delay : 1 \u5c3d\u91cf\u907f\u514d\u4f7f\u7528\u547d\u4ee4\u6a21\u5757-\u59cb\u7ec8\u5148\u67e5\u627e\u5bf9\u5e94\u7684\u6a21\u5757 \u7cfb\u7edf\u547d\u4ee4 \u6a21\u5757 - name: add user command: useradd appuser - name: add user user: name: appuser state: present - name: install apache command: yum install httpd - name: install apache yum: name: httpd state: latest - name: start apache shell: | service httpd start && chkconfig httpd on - name: start apache service: name: httpd state: started enabled: yes \u6807\u8bb0\u66f4\u6539\u8fc7\u7684\u6587\u4ef6 \u5982\u679c\u672a\u6807\u8bb0\u66f4\u6539\u8fc7\u7684\u6587\u4ef6\uff0c\u5219\u53ef\u80fd\u4f1a\u610f\u5916\u8986\u76d6\u5b83\u4eec \u5c06\u6a21\u677f\u8f93\u51fa\u6587\u4ef6\u6807\u8bb0\u4e3a\u7531Ansible\u751f\u6210 \u4f7f\u7528 ansible_managed** \u53d8\u91cf\u548c\u6ce8\u91ca\u8fc7\u6ee4\u5668 {{ ansible_managed | comment }} \u4f7f\u7528 Roles \u548c Galaxy \u00b6 \u5c3d\u53ef\u80fd\u4f7f\u7528\u89d2\u8272 \uff0c \u89d2\u8272\u53ef\u4ee5\u8ba9\u4f60\u60a8\u80fd\u591f\u5c01\u88c5\u60a8\u7684\u64cd\u4f5c\u3002 \u50cfplaybook\u4e00\u6837\u2014\u2014\u8ba9\u89d2\u8272\u4e13\u6ce8\u4e8e\u76ee\u6807\u548c\u529f\u80fd \u5c06\u6bcf\u4e2a\u89d2\u8272\u5b58\u50a8\u5728\u4e13\u7528\u7684Git\u4ed3\u5e93\u4e2d \u901a\u8fc7 role/requirements.yml \u6587\u4ef6\u5305\u542b\u89d2\u8272\uff0c\u901a\u8fc7 ansible-galaxy \u5de5\u5177\u5bfc\u5165 \u9650\u5236\u89d2\u8272\u7684\u4f9d\u8d56\u6027 \u4ece galaxy \u83b7\u53d6\u89d2\u8272\uff0c\u4f46\u662f\u8981\u5c0f\u5fc3\uff0c\u5e76\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u4f7f\u7528\u5b83\u4eec galaxy \u63d0\u4f9b\u4e86\u6570\u4ee5\u5343\u8ba1\u7684\u89d2\u8272 \u89d2\u8272\u7684\u8d28\u91cf\u5dee\u5f02\u5f88\u5927 \u4e00\u5b9a\u8981\u534a\u4fe1\u534a\u7591\u5730\u63a5\u53d7\u5efa\u8bae \u9009\u62e9\u53ef\u4fe1\u6216\u77e5\u540d\u7684\u4f5c\u8005 \u6b63\u786e\u8bbf\u95ee\u76ee\u6807 \u00b6 \u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0croot\u8bbf\u95ee\u6bd4sudo - use sudo\u66f4\u96be\u8ddf\u8e2a Ansible\u53ea\u80fd\u4ee5root\u8eab\u4efd\u8fd0\u884c \u4f46\u662f\u7531\u4e8e\u767b\u5f55\u548c\u5b89\u5168\u7684\u539f\u56e0\uff0c\u901a\u5e38\u8981\u6c42\u975eroot\u8bbf\u95ee \u4f7f\u7528 become \u63d0\u6743\u65b9\u6cd5-\u6240\u4ee5Ansible\u811a\u672c\u662f\u901a\u8fc7sudo\u6267\u884c(sudo\u5f88\u5bb9\u6613\u8ddf\u8e2a) \u6700\u597d\u7684:\u521b\u5efa\u4e00\u4e2aAnsible\u4e13\u5c5e\u7528\u6237 \u4e0d\u8981\u8bd5\u56fe\u5c06sudo\u6743\u9650\u9650\u5236\u5728\u67d0\u4e9b\u547d\u4ee4\u4e2d\u2014\u2014\u90a3\u6837\u53ef\u80fd\u5bfc\u81f4Ansible\u4e0d\u80fd\u5de5\u4f5c \u8c03\u8bd5\u95ee\u9898 \u00b6 \u68c0\u67e5\u76ee\u6807\u8ba1\u7b97\u673a\u4e0a\u7684\u65e5\u5fd7 \u5728 /var/log/message \u4e2d\u5b58\u5728\u4e0b\u5217\u7684\u65e5\u5fd7\u4fe1\u606f ansible-node sshd[2395]: pam_unix(sshd:session): session opened for user liquidat by (uid=0) ansible-node ansible-yum[2399]: Invoked with name=['httpd'] list=None install_repoquery=True conf_file=None disable_gpg_check=False state=absent disablerepo=None update_cache=False enablerepo=None exclude=None \u4fdd\u7559\u4ee3\u7801\u5728\u76ee\u6807\u673a\u5668\u4e0a\u6267\u884c \u4f7f\u7528 ANSIBLE_KEEP_REMOTE_FILES \u73af\u5883\u53d8\u91cf\uff0c\u53ef\u4ee5\u4f7fansible\u4e0d\u5220\u9664\u5728\u76ee\u6807\u8282\u70b9\u7684\u4ee3\u7801 ANSIBLE_KEEP_REMOTE_FILES = 1 ansible target-node -m yum -a \"name=httpd state=absent\" \u901a\u5e38\u4ee3\u7801\u5b58\u5728\u8fdc\u7aef\u6267\u884c\u7528\u6237\u7684\u5bb6\u76ee\u5f55 .ansible/tmp \u76ee\u5f55\u4e0b\uff0c\u4f7f\u7528\u4e0b\u5217\u547d\u4ee4\u53ef\u4ee5\u518d\u6b21\u6267\u884c $ /bin/sh -c 'sudo -u $SUDO_USER /bin/sh -c \"/usr/bin/python /home/user/.ansible/tmp/...\" \u4f7f\u7528\u8c03\u8bd5\u6a21\u5757 \u53ef\u4ee5\u4f7f\u7528 debug \u6a21\u5757\u5728playbook\u4e2d\u8f93\u51fa\u4e00\u4e9b\u8c03\u8bd5\u4fe1\u606f - name : Output debug message debug : msg : \"This always displays\" - name : Output debug message debug : msg : \"This only displays with ansible-playbook -vv+\" verbosity : 2 - name : Output debug hostvars debug : var : hostvars \u5982\u4f55\u5728\u751f\u4ea7\u4e2d\u4f7f\u7528 \u00b6 \u4f7f\u7528Tower \u00b6 Tower\u662fAnsible\u5f00\u53d1\u7684 \u53ef\u4ee5\u6269\u5c55Ansible\u7684\u9650\u5236\u4ee5\u6ee1\u8db3\u4f01\u4e1a\u9700\u6c42\uff0c\u6bd4\u5982\u53ef\u6269\u5c55\u6027\uff0cAPI\uff0cRBAC\uff0c\u4e3b\u673a\u7b49 Tower\u901a\u8fc7**\u95ee\u53f7\u63d0\u793a**\u63d0\u4f9b\u7a0b\u5e8f\u5185\u5e2e\u52a9\uff0c\u5305\u62ec\u4f8b\u5b50\u6216\u94fe\u63a5\u5230\u8fdb\u4e00\u6b65\u7684\u6587\u6863 Tower\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u5206\u652f\u591a\u6b21\u5bfc\u5165\u5b58\u50a8\u5e93 \u5728\u9879\u76ee\u66f4\u65b0\u671f\u95f4\uff0cTower\u81ea\u52a8\u5bfc\u5165\u89d2\u8272 Tower\u53ef\u4ee5\u4f7f\u7528\u52a8\u6001\u548c\u667a\u80fd\u5e93\u5b58\u6e05\u5355\uff0c\u53ef\u4ee5\u5408\u5e76\u591a\u4e2a\u5e93\u5b58\u6e05\u5355\uff0c\u5e76\u8d1f\u8d23\u540c\u6b65\u548c\u7f13\u5b58 Tower\u7ed9job\u6a21\u677f\u63d0\u4f9b\u4e86\u5f88\u591a\u9009\u9879\uff0c\u6bd4\u5982\u6dfb\u52a0\u6807\u7b7e\uff0c\u68c0\u67e5\u6a21\u677f\uff0c\u6267\u884c\u540e\u901a\u77e5\u529f\u80fd\u7b49 Tower\u53ef\u4ee5\u4f7f\u591a\u4e2a\u5267\u672c\u7ec4\u5408\u6210\u4e00\u4e2a\u5de5\u4f5c\u6d41\u7a0b Tower\u63d0\u4f9b\u591a\u79df\u6237\u529f\u80fd\uff0c\u6765\u5e2e\u52a9\u56e2\u961f\u5206\u9694\u5de5\u4f5c\u73af\u5883\u3002 Tower\u63d0\u4f9b\u7684\u51ed\u8bc1\u53ea\u80fd\u7531Tower\u4f7f\u7528\uff0c\u4fdd\u8bc1\u4e86\u5b89\u5168\u6027\u3002 Tower\u53ef\u4ee5\u5728\u4f5c\u4e1a\u6210\u529f\u3001\u5931\u8d25\u6216\u603b\u662f\u5931\u8d25\u65f6\u53d1\u9001\u901a\u77e5\u2014\u4f8b\u5982\u90ae\u4ef6\u3001IRC\u3001web hook\u7b49\u7b49 \u53ef\u4ee5\u5c06\u6240\u6709\u7684\u65e5\u5fd7\u4eceTower\u53d1\u9001\u5230\u65e5\u5fd7\u5904\u7406\u4e2d\u5fc3Splunk, Loggly, ELK, REST\u7b49 Tower\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u5efa\u7acbHA\u67b6\u6784\uff0c\u4e5f\u53ef\u4ee5\u5728\u7f51\u7edc\u9694\u79bb\u7684\u5730\u65b9\u5efa\u7acb\u5355\u70b9\u3002 \u4f7f\u7528Ansible \u00b6 \u4fdd\u8bc1ansible\u7ba1\u7406\u8282\u70b9\u7684\u5b89\u5168\u6027 \u8bb0\u5f55ansible\u7684\u6267\u884c\u65e5\u5fd7 \u4f7f\u7528git\u4ed3\u5e93\u6765\u7ba1\u7406ansible\u7684playbook\uff0croles\uff0cinventory\u7b49\u7b49 \u4f7f\u7528block\u5757\u6765\u63a8\u9001\u6267\u884c\u6210\u529f\uff0c\u5931\u8d25\u7684\u901a\u77e5","title":"Ansible \u6700\u4f73\u5b9e\u8df5"},{"location":"advanced/best-practices/#ansible","text":"\u4ecb\u7ecd\u4e0bansible\u5982\u4f55\u5199\u4f5c\uff0c\u5982\u4f55\u6267\u884c\uff0c\u5982\u4f55\u5728\u751f\u4ea7\u4e2d\u4f7f\u7528\u3002","title":"Ansible \u6700\u4f73\u5b9e\u8df5"},{"location":"advanced/best-practices/#_1","text":"","title":"\u5982\u4f55\u5199\u4f5c"},{"location":"advanced/best-practices/#ansible_1","text":"\u62e5\u6709\u7248\u672c\u63a7\u5236 \u62e5\u6709\u53ef\u91cd\u590d\u6027 \u4ece\u57fa\u672c\u7684playbook\u76ee\u5f55\u7ed3\u6784\u548c\u9759\u6001\u7684\u4e3b\u673a\u6e05\u5355\u6765\u6784\u5efaroles \u540e\u7eed\u53ef\u4ee5\u81ea\u5df1\u5f00\u53d1\u6a21\u5757\u548c\u63d2\u4ef6","title":"\u50cf\u5bf9\u5f85\u4ee3\u7801\u4e00\u6837\u5bf9\u5f85\u4f60\u7684ansible"},{"location":"advanced/best-practices/#_2","text":"\u4e3a\u4f60\u7684\u98ce\u683c\u521b\u5efa\u4e00\u4e2a\u6807\u51c6 \u4f7f\u7528\u6807\u7b7e \u4f7f\u7528\u4e00\u81f4\u7684\u7a7a\u683c\u7f29\u8fdb \u4efb\u52a1\u3001\u89d2\u8272\u3001\u53d8\u91cf\u548c\u89d2\u8272\u7684\u8bed\u4e49\u5316\u547d\u540d \u76ee\u5f55\u7ed3\u6784 \u6267\u884c\u7684\u98ce\u683c \u5148\u68c0\u67e5\u8bed\u6cd5 \u5217\u51fa\u6267\u884c\u4e3b\u673a \u5217\u51fatasks\u4efb\u52a1 \u518d\u53bb\u6267\u884c \u4e00\u4e2a\u5f88\u597d\u7684 openshift-ansible \u98ce\u683c Note python Python\u6700\u5927\u884c\u957f\u5ea6 \u6240\u6709\u884c\u4e0d\u5e94\u8d85\u8fc780\u4e2a\u5b57\u7b26\u3002 \u6240\u6709\u7684\u884c\u5fc5\u987b\u4e0d\u8d85\u8fc7120\u4e2a\u5b57\u7b26\u3002 ansible Ansible Yaml \u6587\u4ef6\u6269\u5c55\u540d\u79f0 \u6240\u6709Ansible Yaml\u6587\u4ef6\u5fc5\u987b\u662f\u4e00\u4e2a .yml \u6269\u5c55\u540d(\u800c\u4e0d\u662f .YML \uff0c .yaml \u7b49)\u3002 Ansible CLI\u53d8\u91cf \u8981\u4eceansible CLI\u4f20\u9012\u8fdb\u6765\u7684\u53d8\u91cf\u5fc5\u987b\u6709\u4e00\u4e2a cli_ \u524d\u7f00 Ansible\u5168\u5c40\u53d8\u91cf \u5168\u5c40\u53d8\u91cf\u7684\u524d\u7f00\u5fc5\u987b\u662f g_ Ansible\u89d2\u8272\u53d8\u91cf \u89d2\u8272\u53d8\u91cf\u5fc5\u987b\u6709\u81f3\u5c113\u4e2a\u5b57\u7b26\u7684\u524d\u7f00\u3002\u8bf7\u53c2\u9605\u4e0b\u9762\u7684\u7279\u5b9a\u547d\u540d\u89c4\u5219\u3002 \u89d2\u8272\u540d\u79f0\u4e2d\u5305\u542b3\u4e2a(\u6216\u66f4\u591a)\u5355\u8bcd \u4ee5\u6bcf\u4e2a\u5355\u8bcd\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u4e3a\u4f8b\u3002 3\u5b57\u7b26\u7684\u793a\u4f8b\uff1a Role name: made_up_role Prefix: mur mur_var1: value_one 4\u5b57\u7b26\u7684\u793a\u4f8b: Role name: totally_made_up_role Prefix: tmur tmur_var1: value_one \u89d2\u8272\u540d\u79f0\u4e2d\u6709\u4e24\u4e2a(\u6216\u5c11\u4e8e\u4e24\u4e2a)\u5355\u8bcd \u7f16\u4e00\u4e2a\u6709\u610f\u4e49\u7684\u524d\u7f00\u3002 1 \u5355\u8bcd\u7684\u793a\u4f8b: Role name: ansible Prefix: ans ans_var1: value_one 2 \u5355\u8bcd\u7684\u793a\u4f8b: Role name: ansible_tower Prefix: tow tow_var1: value_one \u89d2\u8272\u540d\u79f0\u524d\u7f00\u51b2\u7a81 - hosts : localhost roles : - { role : made_up_role , mur_var1 : val1 } - { role : my_uber_role , mur_var1 : val2 } \u5373\u4f7f\u4e24\u4e2a\u89d2\u8272\u90fd\u5177\u6709\u76f8\u540c\u7684\u524d\u7f00\uff08mur\uff09\uff0c\u5e76\u4e14\u5373\u4f7f\u4e24\u4e2a\u89d2\u8272\u90fd\u6709\u4e00\u4e2a\u540d\u4e3amur_var1\u7684\u53d8\u91cf\uff0c\u56e0\u4e3a \u89d2\u8272\u53d8\u91cf\u88ab\u9650\u5236\u5728\u89d2\u8272\u672c\u8eab \uff0c\u8fd9\u4e24\u4e2a\u53d8\u91cf\u4e5f\u6c38\u8fdc\u4e0d\u4f1a\u5b58\u5728\u4e8e\u5404\u81ea\u7684\u89d2\u8272\u4e4b\u5916\u3002\u610f\u5473\u7740\u8fd9\u4e0d\u662f\u95ee\u9898\u3002 \u4ec5\u5f53my_uber_role\u53d6\u51b3\u4e8emade_up_role\u65f6\u624d\u6709\u95ee\u9898\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002 \u6216\u8005\uff0c\u5982\u679c\u8fd9\u4e24\u4e2a\u89d2\u8272\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u90fd\u5305\u542b\u53e6\u4e00\u4e2a\u89d2\u8272\u3002 \u5f53\u7136\uff0c\u8fd9\u662f\u4e00\u4e2a\u6781\u4e0d\u53ef\u80fd\u53d1\u751f\u7684\u6781\u7aef\u60c5\u51b5\u3002 \u5982\u679c\u662f\u8fd9\u6837\uff0c\u8bf7\u53e6\u5f53\u5904\u7406\u3002","title":"\u4e0d\u8981\u4f7f\u7528\u4e2a\u6027\u5316\u7684\u4e66\u5199\u65b9\u5f0f"},{"location":"advanced/best-practices/#git","text":"\u6bcf\u4e2a\u5206\u4eab\u7684playbook\u90fd\u9700\u8981\u6709\u4e00\u81f4\u7684\u76ee\u5f55\u7ed3\u6784\uff0c\u5e76\u4e14\u4f7f\u7528git\u4ed3\u5e93\u5b58\u50a8\u8bb0\u5f55\u6bcf\u4e00\u6b21\u63d0\u4ea4\u3002 site.yml # \u4e3b\u8981\u7684playbook\uff0c\u53ef\u4ee5\u8c03\u7528\u5176\u4ed6playbook webservers.yml # webserver\u4f7f\u7528\u7684 playbook deployonce.yml # \u9002\u7528\u4e8e\u4e00\u6b21\u6027\u90e8\u7f72\u7684 playbook inventories/ production/ # \u901a\u8fc7\u4e0d\u540c\u73af\u5883\u6765\u533a\u5206\u4e3b\u673a\u6e05\u5355 hosts # \u751f\u4ea7\u670d\u52a1\u5668\u7684\u4e3b\u673a\u6e05\u5355\u6587\u4ef6 group_vars/ host_vars/ london/ # \u5176\u4ed6\u7684\u5206\u7ec4\u4e3b\u673a\u6e05\u5355 roles/ requirements.yml # \u4f9d\u8d56\u7684\u5176\u4ed6\u89d2\u8272 common/ # \u57fa\u672c\u914d\u7f6e webtier/ # \u7528\u4e8e\u7279\u5b9a\u529f\u80fd\u7684\u89d2\u8272","title":"\u4f7f\u7528git"},{"location":"advanced/best-practices/#inventory","text":"\u4f7f\u7528\u522b\u540d\u7ed9\u4e3b\u673a\u8282\u70b9\u8d77\u4e00\u4e2a\u6709\u610f\u4e49\u7684\u540d\u5b57 \u4e3b\u673a \u6709\u610f\u4e49\u7684\u540d\u79f0 10.1.2.75 10.1.5.45 10.1.4.5 10.1.0.40 db1 ansible_host=10.1.2.75 db2 ansible_host=10.1.5.45 db3 ansible_host=10.1.4.5 db4 ansible_host=10.1.0.40 w14301.acme.com w17802.acme.com w19203.acme.com w19304.acme.com web1 ansible_host=w14301.acme.com web2 ansible_host=w17802.acme.com web3 ansible_host=w19203.acme.com web4 ansible_host=w19203.acme.com \u7ed9\u4e3b\u673a\u5206\u914d\u4e0d\u540c\u7528\u9014\u7684\u7ec4\uff0c\u4ee5\u4fbf\u4e8e\u4e0d\u540c\u60c5\u51b5\u4e0b\u7684\u6279\u91cf\u4f7f\u7528 # \u6309\u670d\u52a1\u7c7b\u578b [db] db[1:4] [web] web[1:4] # \u6309\u73af\u5883 [dev] db1 web1 [testing] db3 web3 [prod] db2 web2 db4 web4 # \u6309\u533a\u57df [east] db1 web1 db3 web3 [west] db2 web2 db4 web4 \u5c3d\u53ef\u80fd\u4f7f\u7528\u52a8\u6001\u6e90\u3002\u8981\u4e48\u4f5c\u4e3a\u5355\u4e00\u6765\u6e90\uff0c\u8981\u4e48\u8ba9Ansible\u7edf\u4e00\u591a\u4e2a\u6765\u6e90 \u81ea\u52a8\u4fdd\u6301\u6e05\u5355\u540c\u6b65 \u51cf\u5c11\u4eba\u4e3a\u7684\u9519\u8bef \u53d8\u5316\u53d1\u751f\u65f6\u6ca1\u6709\u5ef6\u8fdf \u8ba9\u5176\u4ed6\u4eba\u7ba1\u7406\u4e3b\u673a\u6e05\u5355","title":"inventory"},{"location":"advanced/best-practices/#_3","text":"\u5408\u9002\u7684\u53d8\u91cf\u540d\u53ef\u4ee5\u4f7fplaybook\u66f4\u5177\u53ef\u8bfb\u6027\uff0c\u5e76\u907f\u514d\u53d8\u91cf\u540d\u51b2\u7a81\u3002 # \u770b\u4e0d\u61c2\u7684\u53d8\u91cf\u540d\u79f0 a : 25 data : ab data2 : abc id : 123 # \u4e00\u773c\u5c31\u80fd\u770b\u61c2\u7684\u53d8\u91cf\u7528\u9014 apache_max_keepalive : 25 apache_port : 80 tomcat_port : 8080 \u901a\u8fc7\u5c06\u89d2\u8272\u540d\u4f5c\u4e3a\u524d\u7f00\u6dfb\u52a0\u5230\u53d8\u91cf\u4e2d\u6765\u907f\u514d\u51b2\u7a81\u548c\u6df7\u6dc6\u3002 apache_max_keepalive : 25 apache_port : 80 tomcat_port : 8080 \u4e3a\u53d8\u91cf\u8bbe\u7f6e\u5728\u5408\u9002\u7684\u4f4d\u7f6e \u6839\u636e\u53d8\u91cf\u7684\u8bbe\u7f6e\uff0c\u4fee\u6539\u5730\u70b9\u548c\u65f6\u95f4\uff0c\u4e3a\u53d8\u91cf\u627e\u5230\u5408\u9002\u7684\u4f4d\u7f6e \u5c06\u903b\u8f91(\u4efb\u52a1)\u4e0e\u53d8\u91cf\u5206\u79bb\uff0c\u51cf\u5c11\u91cd\u590d\u6a21\u5f0f \u4e0d\u8981\u5229\u7528\u6bcf\u4e00\u79cd\u53ef\u80fd\u6027\u6765\u5b58\u50a8\u53d8\u91cf- \u5c06\u5176\u56fa\u5b9a\u5230\u4e00\u4e2a\u5df2\u5b9a\u4e49\u7684\u65b9\u6848\u4e2d\uff0c\u5e76\u5c3d\u53ef\u80fd\u51cf\u5c11\u5b58\u50a8\u4f4d\u7f6e","title":"\u53d8\u91cf"},{"location":"advanced/best-practices/#playbook","text":"\u4f7f\u7528YAML\u8bed\u6cd5 - name : install telegraf yum : name=telegraf-{{ telegraf_version }} state=present update_cache=yes enablerepo=telegraf notify : restart telegraf - name : start telegraf service : name=telegraf state=started \u4e0a\u9762\u7684\u65b9\u5f0f\u662f\u4e0d\u53ef\u53d6\u7684\uff0c\u9700\u8981\u4f7f\u7528 KEY:VALUE \u7684\u5f62\u5f0f - name : install telegraf yum : name : \"telegraf-{{ telegraf_version }}\" state : present update_cache : yes enablerepo : telegraf notify : restart telegraf - name : start telegraf service : name : telegraf state : started \u4e0d\u8981\u5ffd\u7565\u4efb\u52a1\u540d - hosts : web name : installs and starts apache tasks : - name : install apache packages yum : name : httpd state : latest - name : starts apache service service : name : httpd enabled : yes \u4e3a\u6bcf\u4e2a\u4efb\u52a1\u6307\u5b9a name ,\u53ef\u4ee5\u53cb\u597d\u7684\u8f93\u51fa\u6267\u884c\u4fe1\u606f PLAY [ install and starts apache ] ******************************** TASK [ setup ] ******************************** ok: [ web1 ] TASK [ install apache packages ] ******************************** ok: [ web1 ] TASK [ starts apache service ] ******************************** ok: [ web1 ]","title":"playbook"},{"location":"advanced/best-practices/#block","text":"block\u53ef\u4ee5\u5e2e\u52a9\u7ec4\u7ec7\u4ee3\u7801\uff0c\u8fd8\u53ef\u4ee5\u542f\u7528\u56de\u6eda\u6216\u8f93\u51fa\u6570\u636e\u4ee5\u8fdb\u884c\u5173\u952e\u6027\u66f4\u6539\u3002 - block : copy : src : critical.conf dest : /etc/critical/crit.conf service : name : critical state : restarted rescue : command : shutdown -h now","title":"\u4f7f\u7528block"},{"location":"advanced/best-practices/#_4","text":"","title":"\u5982\u4f55\u6267\u884c"},{"location":"advanced/best-practices/#_5","text":"Ansible\u4e3a\u547d\u4ee4\u884c\u4ea4\u4e92\u548c\u6545\u969c\u6392\u9664\u63d0\u4f9b\u591a\u4e2a\u9009\u9879 -vvvv \u6253\u5370debug\u4fe1\u606f --step \u4e00\u6b65\u4e00\u6b65\u7684\u6267\u884c,\u6bcf\u6b21\u6267\u884c\u524d\u9700\u8981\u624b\u52a8\u786e\u8ba4(ansible-playbook \u547d\u4ee4) --check \u6267\u884c\u68c0\u67e5\uff0c\u5e76\u4e0d\u4fee\u6539\u76ee\u6807 --diff \u5bf9\u6bd4\u6267\u884c\u7ed3\u679c --start-at-task \u4ece\u54ea\u4e00\u4e2a\u4efb\u52a1\u5f00\u59cb\u6267\u884c","title":"\u8c03\u8bd5\u6267\u884c"},{"location":"advanced/best-practices/#_6","text":"Ansible \u63d0\u4f9b\u4e86\u8bb8\u591a\u9009\u9879\u6765\u663e\u793a\u4f60\u5c06\u8981\u8fd0\u884c\u7684\u5185\u5bb9 --list-tasks \u5217\u51fa\u8fd0\u884c\u7684\u4efb\u52a1 --list-tags \u5217\u51fa\u8fd0\u884c\u7684tag --list-hosts \u5217\u51fa\u8fd0\u884c\u7684\u4e3b\u673a --syntax-check \u6267\u884c\u8bed\u6cd5\u68c0\u6d4b","title":"\u5206\u6790\u8fd0\u884c\u7684\u5185\u5bb9"},{"location":"advanced/best-practices/#_7","text":"\u5982\u679c\u9700\u8981\u5bf9\u4e00\u4e9b\u6ca1\u6709\u5728\u4e3b\u673a\u6e05\u5355\u4e2d\u5b9a\u4e49\u7684\u4e3b\u673a\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5feb\u901f\u542f\u52a8 \u5355\u6b21\u4efb\u52a1 ansible all -i neon.qxyz.de, -m service -a \"name=redhat state=present\" \u6267\u884cplaybook ansible-playbook -i neon.qxyz.de,neon2.qxyz.de site.yml \u6ce8\u610f\uff0c\u5355\u4e2a\u4e3b\u673a\u8981\u6709 , \u7ed3\u5c3e","title":"\u65e0\u4e3b\u673a\u6e05\u5355\u7684\u5feb\u901f\u542f\u52a8"},{"location":"advanced/best-practices/#_8","text":"\u5bf9\u4e8e\u670d\u52a1\uff0c\u4e0d\u80fd\u53ea\u542f\u52a8\uff0c\u8fd8\u9700\u8981\u6d4b\u8bd5 - name : start myapp service : name : myapp state : started - name : check for proper response uri : url : http://localhost/myapp return_content : yes register : result until : '\"Hello World\" in result.content' retries : 10 delay : 1 \u5c3d\u91cf\u907f\u514d\u4f7f\u7528\u547d\u4ee4\u6a21\u5757-\u59cb\u7ec8\u5148\u67e5\u627e\u5bf9\u5e94\u7684\u6a21\u5757 \u7cfb\u7edf\u547d\u4ee4 \u6a21\u5757 - name: add user command: useradd appuser - name: add user user: name: appuser state: present - name: install apache command: yum install httpd - name: install apache yum: name: httpd state: latest - name: start apache shell: | service httpd start && chkconfig httpd on - name: start apache service: name: httpd state: started enabled: yes \u6807\u8bb0\u66f4\u6539\u8fc7\u7684\u6587\u4ef6 \u5982\u679c\u672a\u6807\u8bb0\u66f4\u6539\u8fc7\u7684\u6587\u4ef6\uff0c\u5219\u53ef\u80fd\u4f1a\u610f\u5916\u8986\u76d6\u5b83\u4eec \u5c06\u6a21\u677f\u8f93\u51fa\u6587\u4ef6\u6807\u8bb0\u4e3a\u7531Ansible\u751f\u6210 \u4f7f\u7528 ansible_managed** \u53d8\u91cf\u548c\u6ce8\u91ca\u8fc7\u6ee4\u5668 {{ ansible_managed | comment }}","title":"\u4f7f\u7528\u6b63\u786e\u7684\u5de5\u5177"},{"location":"advanced/best-practices/#roles-galaxy","text":"\u5c3d\u53ef\u80fd\u4f7f\u7528\u89d2\u8272 \uff0c \u89d2\u8272\u53ef\u4ee5\u8ba9\u4f60\u60a8\u80fd\u591f\u5c01\u88c5\u60a8\u7684\u64cd\u4f5c\u3002 \u50cfplaybook\u4e00\u6837\u2014\u2014\u8ba9\u89d2\u8272\u4e13\u6ce8\u4e8e\u76ee\u6807\u548c\u529f\u80fd \u5c06\u6bcf\u4e2a\u89d2\u8272\u5b58\u50a8\u5728\u4e13\u7528\u7684Git\u4ed3\u5e93\u4e2d \u901a\u8fc7 role/requirements.yml \u6587\u4ef6\u5305\u542b\u89d2\u8272\uff0c\u901a\u8fc7 ansible-galaxy \u5de5\u5177\u5bfc\u5165 \u9650\u5236\u89d2\u8272\u7684\u4f9d\u8d56\u6027 \u4ece galaxy \u83b7\u53d6\u89d2\u8272\uff0c\u4f46\u662f\u8981\u5c0f\u5fc3\uff0c\u5e76\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u4f7f\u7528\u5b83\u4eec galaxy \u63d0\u4f9b\u4e86\u6570\u4ee5\u5343\u8ba1\u7684\u89d2\u8272 \u89d2\u8272\u7684\u8d28\u91cf\u5dee\u5f02\u5f88\u5927 \u4e00\u5b9a\u8981\u534a\u4fe1\u534a\u7591\u5730\u63a5\u53d7\u5efa\u8bae \u9009\u62e9\u53ef\u4fe1\u6216\u77e5\u540d\u7684\u4f5c\u8005","title":"\u4f7f\u7528 Roles \u548c Galaxy"},{"location":"advanced/best-practices/#_9","text":"\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0croot\u8bbf\u95ee\u6bd4sudo - use sudo\u66f4\u96be\u8ddf\u8e2a Ansible\u53ea\u80fd\u4ee5root\u8eab\u4efd\u8fd0\u884c \u4f46\u662f\u7531\u4e8e\u767b\u5f55\u548c\u5b89\u5168\u7684\u539f\u56e0\uff0c\u901a\u5e38\u8981\u6c42\u975eroot\u8bbf\u95ee \u4f7f\u7528 become \u63d0\u6743\u65b9\u6cd5-\u6240\u4ee5Ansible\u811a\u672c\u662f\u901a\u8fc7sudo\u6267\u884c(sudo\u5f88\u5bb9\u6613\u8ddf\u8e2a) \u6700\u597d\u7684:\u521b\u5efa\u4e00\u4e2aAnsible\u4e13\u5c5e\u7528\u6237 \u4e0d\u8981\u8bd5\u56fe\u5c06sudo\u6743\u9650\u9650\u5236\u5728\u67d0\u4e9b\u547d\u4ee4\u4e2d\u2014\u2014\u90a3\u6837\u53ef\u80fd\u5bfc\u81f4Ansible\u4e0d\u80fd\u5de5\u4f5c","title":"\u6b63\u786e\u8bbf\u95ee\u76ee\u6807"},{"location":"advanced/best-practices/#_10","text":"\u68c0\u67e5\u76ee\u6807\u8ba1\u7b97\u673a\u4e0a\u7684\u65e5\u5fd7 \u5728 /var/log/message \u4e2d\u5b58\u5728\u4e0b\u5217\u7684\u65e5\u5fd7\u4fe1\u606f ansible-node sshd[2395]: pam_unix(sshd:session): session opened for user liquidat by (uid=0) ansible-node ansible-yum[2399]: Invoked with name=['httpd'] list=None install_repoquery=True conf_file=None disable_gpg_check=False state=absent disablerepo=None update_cache=False enablerepo=None exclude=None \u4fdd\u7559\u4ee3\u7801\u5728\u76ee\u6807\u673a\u5668\u4e0a\u6267\u884c \u4f7f\u7528 ANSIBLE_KEEP_REMOTE_FILES \u73af\u5883\u53d8\u91cf\uff0c\u53ef\u4ee5\u4f7fansible\u4e0d\u5220\u9664\u5728\u76ee\u6807\u8282\u70b9\u7684\u4ee3\u7801 ANSIBLE_KEEP_REMOTE_FILES = 1 ansible target-node -m yum -a \"name=httpd state=absent\" \u901a\u5e38\u4ee3\u7801\u5b58\u5728\u8fdc\u7aef\u6267\u884c\u7528\u6237\u7684\u5bb6\u76ee\u5f55 .ansible/tmp \u76ee\u5f55\u4e0b\uff0c\u4f7f\u7528\u4e0b\u5217\u547d\u4ee4\u53ef\u4ee5\u518d\u6b21\u6267\u884c $ /bin/sh -c 'sudo -u $SUDO_USER /bin/sh -c \"/usr/bin/python /home/user/.ansible/tmp/...\" \u4f7f\u7528\u8c03\u8bd5\u6a21\u5757 \u53ef\u4ee5\u4f7f\u7528 debug \u6a21\u5757\u5728playbook\u4e2d\u8f93\u51fa\u4e00\u4e9b\u8c03\u8bd5\u4fe1\u606f - name : Output debug message debug : msg : \"This always displays\" - name : Output debug message debug : msg : \"This only displays with ansible-playbook -vv+\" verbosity : 2 - name : Output debug hostvars debug : var : hostvars","title":"\u8c03\u8bd5\u95ee\u9898"},{"location":"advanced/best-practices/#_11","text":"","title":"\u5982\u4f55\u5728\u751f\u4ea7\u4e2d\u4f7f\u7528"},{"location":"advanced/best-practices/#tower","text":"Tower\u662fAnsible\u5f00\u53d1\u7684 \u53ef\u4ee5\u6269\u5c55Ansible\u7684\u9650\u5236\u4ee5\u6ee1\u8db3\u4f01\u4e1a\u9700\u6c42\uff0c\u6bd4\u5982\u53ef\u6269\u5c55\u6027\uff0cAPI\uff0cRBAC\uff0c\u4e3b\u673a\u7b49 Tower\u901a\u8fc7**\u95ee\u53f7\u63d0\u793a**\u63d0\u4f9b\u7a0b\u5e8f\u5185\u5e2e\u52a9\uff0c\u5305\u62ec\u4f8b\u5b50\u6216\u94fe\u63a5\u5230\u8fdb\u4e00\u6b65\u7684\u6587\u6863 Tower\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u5206\u652f\u591a\u6b21\u5bfc\u5165\u5b58\u50a8\u5e93 \u5728\u9879\u76ee\u66f4\u65b0\u671f\u95f4\uff0cTower\u81ea\u52a8\u5bfc\u5165\u89d2\u8272 Tower\u53ef\u4ee5\u4f7f\u7528\u52a8\u6001\u548c\u667a\u80fd\u5e93\u5b58\u6e05\u5355\uff0c\u53ef\u4ee5\u5408\u5e76\u591a\u4e2a\u5e93\u5b58\u6e05\u5355\uff0c\u5e76\u8d1f\u8d23\u540c\u6b65\u548c\u7f13\u5b58 Tower\u7ed9job\u6a21\u677f\u63d0\u4f9b\u4e86\u5f88\u591a\u9009\u9879\uff0c\u6bd4\u5982\u6dfb\u52a0\u6807\u7b7e\uff0c\u68c0\u67e5\u6a21\u677f\uff0c\u6267\u884c\u540e\u901a\u77e5\u529f\u80fd\u7b49 Tower\u53ef\u4ee5\u4f7f\u591a\u4e2a\u5267\u672c\u7ec4\u5408\u6210\u4e00\u4e2a\u5de5\u4f5c\u6d41\u7a0b Tower\u63d0\u4f9b\u591a\u79df\u6237\u529f\u80fd\uff0c\u6765\u5e2e\u52a9\u56e2\u961f\u5206\u9694\u5de5\u4f5c\u73af\u5883\u3002 Tower\u63d0\u4f9b\u7684\u51ed\u8bc1\u53ea\u80fd\u7531Tower\u4f7f\u7528\uff0c\u4fdd\u8bc1\u4e86\u5b89\u5168\u6027\u3002 Tower\u53ef\u4ee5\u5728\u4f5c\u4e1a\u6210\u529f\u3001\u5931\u8d25\u6216\u603b\u662f\u5931\u8d25\u65f6\u53d1\u9001\u901a\u77e5\u2014\u4f8b\u5982\u90ae\u4ef6\u3001IRC\u3001web hook\u7b49\u7b49 \u53ef\u4ee5\u5c06\u6240\u6709\u7684\u65e5\u5fd7\u4eceTower\u53d1\u9001\u5230\u65e5\u5fd7\u5904\u7406\u4e2d\u5fc3Splunk, Loggly, ELK, REST\u7b49 Tower\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u5efa\u7acbHA\u67b6\u6784\uff0c\u4e5f\u53ef\u4ee5\u5728\u7f51\u7edc\u9694\u79bb\u7684\u5730\u65b9\u5efa\u7acb\u5355\u70b9\u3002","title":"\u4f7f\u7528Tower"},{"location":"advanced/best-practices/#ansible_2","text":"\u4fdd\u8bc1ansible\u7ba1\u7406\u8282\u70b9\u7684\u5b89\u5168\u6027 \u8bb0\u5f55ansible\u7684\u6267\u884c\u65e5\u5fd7 \u4f7f\u7528git\u4ed3\u5e93\u6765\u7ba1\u7406ansible\u7684playbook\uff0croles\uff0cinventory\u7b49\u7b49 \u4f7f\u7528block\u5757\u6765\u63a8\u9001\u6267\u884c\u6210\u529f\uff0c\u5931\u8d25\u7684\u901a\u77e5","title":"\u4f7f\u7528Ansible"},{"location":"advanced/dynamic-hosts/","text":"ansible \u4e0d\u4ec5\u53ef\u4ee5\u4ece\u9759\u6001\u6587\u4ef6\u4e2d\u83b7\u53d6\u4e3b\u673a\u4fe1\u606f\uff0c\u8fd8\u53ef\u4ee5\u4ece\u52a8\u6001\u6e90\uff08\u5305\u62ec\u4e91\u4e3b\u673a\u8d44\u6e90\uff09\u4e2d\u83b7\u53d6\u4e3b\u673a\u6e05\u5355\u3002 \u4f7f\u7528\u52a8\u6001\u4e3b\u673a\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ea\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u811a\u672c\u6216\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u5728\u6b63\u786e\u7684\u53c2\u6570\u8f93\u5165\u65f6\u5df2\u6b63\u786e\u7684\u683c\u5f0f\u6253\u5370 json \u5b57\u7b26\u4e32\uff0c\u5c31\u80fd\u81ea\u5b9a\u4e49\u4e00\u4e2a\u63d2\u4ef6\u3002\u5f53\u7136\uff0c\u4f60\u53ef\u4ee5\u7528\u4efb\u4f55\u8bed\u8a00\u5b9e\u73b0\u8fd9\u4e2a\u811a\u672c\u3002 Note \u76ee\u524d\u5b98\u65b9\u5df2\u4e0d\u63a8\u8350\u4f7f\u7528 \u811a\u672c\u65b9\u5f0f \u6765\u52a8\u6001\u83b7\u53d6\u4e3b\u673a\u4fe1\u606f\uff0c\u63a8\u8350\u4f7f\u7528 \u63d2\u4ef6\u65b9\u5f0f \u4f7f\u7528\u52a8\u6001\u4e3b\u673a\u3002 \u811a\u672c\u7ea6\u5b9a \u00b6 \u5f53\u6211\u4eec\u5411\u811a\u672c\u8f93\u5165 --list \u53c2\u6570\u65f6\uff0c\u811a\u672c\u5fc5\u987b\u5c06\u8981\u7ba1\u7406\u7684\u6240\u6709\u7ec4\u4ee5json\u7f16\u7801\u7684\u5f62\u5f0f\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fastdout\u3002\u6bcf\u4e2a\u7ec4\u7684\u503c\u5e94\u8be5\u662f\u5305\u542b\u6bcf\u4e2a\u4e3b\u673a/ip\u7684\u5217\u8868\u4ee5\u53ca\u5b9a\u4e49\u7684\u53d8\u91cf\u3002\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u7b80\u5355\u793a\u4f8b { \"databases\" : { \"hosts\" : [ \"host1.example.com\" , \"host2.example.com\" ], \"vars\" : { \"a\" : true } }, \"webservers\" : [ \"host2.example.com\" , \"host3.example.com\" ], \"atlanta\" : { \"hosts\" : [ \"host1.example.com\" , \"host4.example.com\" , \"host5.example.com\" ], \"vars\" : { \"b\" : false }, \"children\" : [ \"marietta\" , \"5points\" ] }, \"marietta\" : [ \"host6.example.com\" ], \"5points\" : [ \"host7.example.com\" ] } databases \u662f\u4e3b\u673a\u7ec4\u540d\u79f0 hosts \u662f\u4e3b\u673a\u7ec4\u7684\u4e3b\u673a\u5217\u8868 vars \u662f\u4e3b\u673a\u7ec4\u7684\u53d8\u91cf children \u662f\u4e3b\u673a\u7ec4\u7684\u5b50\u7ec4 \u5f53\u6211\u4eec\u5411\u811a\u672c\u8f93\u5165 --host <hostname> \u53c2\u6570\u65f6\uff0c\u811a\u672c\u5fc5\u987b\u8f93\u51fa\u4e00\u4e2a\u7a7a\u7684json\u5b57\u7b26\u4e32\u6216\u4e00\u4e2a\u53d8\u91cf\u7684\u5217\u8868/\u5b57\u5178\uff0c\u4ee5\u4fbftemlates\u548cplaybook\u53ef\u4ee5\u4f7f\u7528\u3002\u8f93\u51fa\u53d8\u91cf\u662f\u53ef\u9009\u7684\uff0c\u5982\u679c\u811a\u672c\u4e0d\u5e0c\u671b\u8f93\u51fa\uff0c\u90a3\u8f93\u51fa\u4e00\u4e2a\u7a7a\u7684\u5217\u8868/\u5b57\u5178\u4e5f\u662f\u53ef\u4ee5\u7684\u3002\u4e0b\u9762\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b { \"favcolor\" : \"red\" , \"ntpserver\" : \"wolf.example.com\" , \"monitoring\" : \"pack.example.com\" } \u5b9a\u4e49hostvars\u7684\u4e3b\u673a\u53d8\u91cf\uff0c\u4e0b\u9762\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b { # results of inventory script as above go here # ... \"_meta\": { \"hostvars\": { \"moocow.example.com\": { \"asdf\": 1234 }, \"llama.example.com\": { \"asdf\": 5678 } } } } hostvars \u6307\u7684\u662f\u4e3b\u673a\u53d8\u91cf moocow.example.com \u4e3b\u673a\u540d\u79f0\uff0c\u4e0e\u4e3b\u673a\u7ec4\u5185\u7684\u540d\u79f0\u5bf9\u5e94 \"asdf\": 1234 \u4e3b\u673a\u53d8\u91cf \u603b\u4f53\u800c\u8a00\uff0c\u4e00\u4e2a\u7b80\u5355\u7684 inventory \u6570\u636e\u7ed3\u6784\u5982\u4e0b { \"all\" : { \"hosts\" : [ \"address\" ], \"vars\" : {}, }, \"_meta\" : { \"hostvars\" : { \"address\" : { \"variable_name\" : \"value\" , } }, }, \"group_name\" : [ \"address\" ] } \u7b80\u5355\u4f8b\u5b50 \u00b6 \u83b7\u53d6\u81ea\u5b9a\u4e49\u7684\u4e3b\u673a\u4fe1\u606f #!/usr/bin/env python ''' Example custom dynamic inventory script for Ansible, in Python. ''' import os import sys import argparse try : import json except ImportError : import simplejson as json class ExampleInventory ( object ): def __init__ ( self ): self . inventory = {} self . read_cli_args () # Called with `--list`. if self . args . list : self . inventory = self . example_inventory () # Called with `--host [hostname]`. elif self . args . host : # Not implemented, since we return _meta info `--list`. self . inventory = self . empty_inventory () # If no groups or vars are present, return empty inventory. else : self . inventory = self . empty_inventory () print json . dumps ( self . inventory ); # Example inventory for testing. def example_inventory ( self ): return { 'group' : { 'hosts' : [ '192.168.77.129' , '192.168.77.130' ], 'vars' : { 'ansible_ssh_user' : 'root' , 'ansible_ssh_pass' : '123456' , 'example_variable' : 'value' } }, '_meta' : { 'hostvars' : { '192.168.77.129' : { 'host_specific_var' : 'foo' }, '192.168.77.130' : { 'host_specific_var' : 'bar' } } } } # Empty inventory for testing. def empty_inventory ( self ): return { '_meta' : { 'hostvars' : {}}} # Read the command line args passed to the script. def read_cli_args ( self ): parser = argparse . ArgumentParser () parser . add_argument ( '--list' , action = 'store_true' ) parser . add_argument ( '--host' , action = 'store' ) self . args = parser . parse_args () # Get the inventory. ExampleInventory () \u672c\u811a\u672c\u4e2d example_inventory \u4e2d\u76f4\u63a5\u8fd4\u56de\u4e86\u4e00\u4e2ajson\u7ed3\u6784\uff0c\u5927\u5bb6\u53ef\u4ee5\u89e3\u6790\u5404\u79cd\u6e90\u6570\u636e\u6765\u6784\u5efajson\u7ed3\u6784\u8fd4\u56de\u5373\u53ef\u3002 \u811a\u672c\u4f7f\u7528 \u00b6 \u8d4b\u4e88\u63d2\u4ef6\u53ef\u6267\u884c\u6743\u9650 chmod +x test_inventory.py --list \u6570\u636e ./test_inventory.py --list { \"_meta\" : { \"hostvars\" : { \"192.168.77.130\" : { \"host_specific_var\" : \"foo\" } , \"192.168.77.131\" : { \"host_specific_var\" : \"bar\" } } } , \"group\" : { \"hosts\" : [ \"192.168.77.130\" , \"192.168.77.131\" ] , \"vars\" : { \"ansible_ssh_pass\" : \"123456\" , \"ansible_ssh_user\" : \"root\" , \"example_variable\" : \"value\" } } } --host \u6570\u636e [ root@node130 ~ ] # ./test_inventory.py --host 192.168.77.130 { \"host_specific_var\" : \"foo\" } [ root@node130 ~ ] # ./test_inventory.py --host 192.168.77.131 { \"host_specific_var\" : \"bar\" } \u6267\u884c ad-hoc \u547d\u4ee4 \u00b6 \u5728\u547d\u4ee4\u4e2d\u4f7f\u7528 -i \u9009\u9879\u6307\u5b9a\u811a\u672c\u8def\u5f84\u5373\u53ef\u83b7\u53d6\u52a8\u6001\u4e3b\u673a\u4fe1\u606f ansible all -i test_inventory.py -m ping 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } # ansible-playbook -i test_inventory.py test.yml PLAY [ all ] ***************************************************************************************** TASK [ ping ] ***************************************************************************************** ok: [ 192 .168.77.131 ] ok: [ 192 .168.77.130 ] PLAY RECAP ***************************************************************************************** 192 .168.77.130 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 192 .168.77.131 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u67e5\u770b\u5b9a\u4e49\u7684\u4e3b\u673a\u53d8\u91cf # ansible all -i test_inventory.py -m debug -a \"var=host_specific_var\" 192 .168.77.130 | SUCCESS = > { \"host_specific_var\" : \"foo\" } 192 .168.77.131 | SUCCESS = > { \"host_specific_var\" : \"bar\" } # ansible all -i test_inventory.py -m debug -a \"var=example_variable\" 192 .168.77.130 | SUCCESS = > { \"example_variable\" : \"value\" } 192 .168.77.131 | SUCCESS = > { \"example_variable\" : \"value\" } \u6267\u884c playbook \u00b6 # cat test_inventory_script.yml --- - hosts: all gather_facts: no tasks: - debug: var = host_specific_var - debug: var = example_variable # ansible-playbook -i test_inventory.py test_inventory_script.yml PLAY [ all ] ***************************************************************************************** TASK [ debug ] ***************************************************************************************** ok: [ 192 .168.77.130 ] = > { \"host_specific_var\" : \"foo\" } ok: [ 192 .168.77.131 ] = > { \"host_specific_var\" : \"bar\" } TASK [ debug ] ***************************************************************************************** ok: [ 192 .168.77.130 ] = > { \"example_variable\" : \"value\" } ok: [ 192 .168.77.131 ] = > { \"example_variable\" : \"value\" } PLAY RECAP ***************************************************************************************** 192 .168.77.130 : ok = 2 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 192 .168.77.131 : ok = 2 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u63d2\u4ef6\u4f7f\u7528 \u00b6 \u4f60\u53ef\u4ee5\u4f7f\u7528 inventory plugin \u6765\u83b7\u53d6\u4e91\u4e3b\u673a\u4fe1\u606f\uff0c\u4f7f\u7528\u65b9\u5f0f\u89c1 \u4f7f\u7528\u52a8\u6001\u4e3b\u673a\u7ba1\u7406\u4e91\u670d\u52a1 \u4f60\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5f00\u53d1 inventory plugin \u6765\u4ece\u6e90\u83b7\u53d6\u4e3b\u673a\u65b9\u5f0f\uff0c\u8be6\u7ec6\u4fe1\u606f\u89c1 \u4ececsv\u6e90\u83b7\u53d6\u4e3b\u673a\u4fe1\u606f","title":"\u4f7f\u7528\u52a8\u6001\u4e3b\u673a"},{"location":"advanced/dynamic-hosts/#_1","text":"\u5f53\u6211\u4eec\u5411\u811a\u672c\u8f93\u5165 --list \u53c2\u6570\u65f6\uff0c\u811a\u672c\u5fc5\u987b\u5c06\u8981\u7ba1\u7406\u7684\u6240\u6709\u7ec4\u4ee5json\u7f16\u7801\u7684\u5f62\u5f0f\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fastdout\u3002\u6bcf\u4e2a\u7ec4\u7684\u503c\u5e94\u8be5\u662f\u5305\u542b\u6bcf\u4e2a\u4e3b\u673a/ip\u7684\u5217\u8868\u4ee5\u53ca\u5b9a\u4e49\u7684\u53d8\u91cf\u3002\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u7b80\u5355\u793a\u4f8b { \"databases\" : { \"hosts\" : [ \"host1.example.com\" , \"host2.example.com\" ], \"vars\" : { \"a\" : true } }, \"webservers\" : [ \"host2.example.com\" , \"host3.example.com\" ], \"atlanta\" : { \"hosts\" : [ \"host1.example.com\" , \"host4.example.com\" , \"host5.example.com\" ], \"vars\" : { \"b\" : false }, \"children\" : [ \"marietta\" , \"5points\" ] }, \"marietta\" : [ \"host6.example.com\" ], \"5points\" : [ \"host7.example.com\" ] } databases \u662f\u4e3b\u673a\u7ec4\u540d\u79f0 hosts \u662f\u4e3b\u673a\u7ec4\u7684\u4e3b\u673a\u5217\u8868 vars \u662f\u4e3b\u673a\u7ec4\u7684\u53d8\u91cf children \u662f\u4e3b\u673a\u7ec4\u7684\u5b50\u7ec4 \u5f53\u6211\u4eec\u5411\u811a\u672c\u8f93\u5165 --host <hostname> \u53c2\u6570\u65f6\uff0c\u811a\u672c\u5fc5\u987b\u8f93\u51fa\u4e00\u4e2a\u7a7a\u7684json\u5b57\u7b26\u4e32\u6216\u4e00\u4e2a\u53d8\u91cf\u7684\u5217\u8868/\u5b57\u5178\uff0c\u4ee5\u4fbftemlates\u548cplaybook\u53ef\u4ee5\u4f7f\u7528\u3002\u8f93\u51fa\u53d8\u91cf\u662f\u53ef\u9009\u7684\uff0c\u5982\u679c\u811a\u672c\u4e0d\u5e0c\u671b\u8f93\u51fa\uff0c\u90a3\u8f93\u51fa\u4e00\u4e2a\u7a7a\u7684\u5217\u8868/\u5b57\u5178\u4e5f\u662f\u53ef\u4ee5\u7684\u3002\u4e0b\u9762\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b { \"favcolor\" : \"red\" , \"ntpserver\" : \"wolf.example.com\" , \"monitoring\" : \"pack.example.com\" } \u5b9a\u4e49hostvars\u7684\u4e3b\u673a\u53d8\u91cf\uff0c\u4e0b\u9762\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b { # results of inventory script as above go here # ... \"_meta\": { \"hostvars\": { \"moocow.example.com\": { \"asdf\": 1234 }, \"llama.example.com\": { \"asdf\": 5678 } } } } hostvars \u6307\u7684\u662f\u4e3b\u673a\u53d8\u91cf moocow.example.com \u4e3b\u673a\u540d\u79f0\uff0c\u4e0e\u4e3b\u673a\u7ec4\u5185\u7684\u540d\u79f0\u5bf9\u5e94 \"asdf\": 1234 \u4e3b\u673a\u53d8\u91cf \u603b\u4f53\u800c\u8a00\uff0c\u4e00\u4e2a\u7b80\u5355\u7684 inventory \u6570\u636e\u7ed3\u6784\u5982\u4e0b { \"all\" : { \"hosts\" : [ \"address\" ], \"vars\" : {}, }, \"_meta\" : { \"hostvars\" : { \"address\" : { \"variable_name\" : \"value\" , } }, }, \"group_name\" : [ \"address\" ] }","title":"\u811a\u672c\u7ea6\u5b9a"},{"location":"advanced/dynamic-hosts/#_2","text":"\u83b7\u53d6\u81ea\u5b9a\u4e49\u7684\u4e3b\u673a\u4fe1\u606f #!/usr/bin/env python ''' Example custom dynamic inventory script for Ansible, in Python. ''' import os import sys import argparse try : import json except ImportError : import simplejson as json class ExampleInventory ( object ): def __init__ ( self ): self . inventory = {} self . read_cli_args () # Called with `--list`. if self . args . list : self . inventory = self . example_inventory () # Called with `--host [hostname]`. elif self . args . host : # Not implemented, since we return _meta info `--list`. self . inventory = self . empty_inventory () # If no groups or vars are present, return empty inventory. else : self . inventory = self . empty_inventory () print json . dumps ( self . inventory ); # Example inventory for testing. def example_inventory ( self ): return { 'group' : { 'hosts' : [ '192.168.77.129' , '192.168.77.130' ], 'vars' : { 'ansible_ssh_user' : 'root' , 'ansible_ssh_pass' : '123456' , 'example_variable' : 'value' } }, '_meta' : { 'hostvars' : { '192.168.77.129' : { 'host_specific_var' : 'foo' }, '192.168.77.130' : { 'host_specific_var' : 'bar' } } } } # Empty inventory for testing. def empty_inventory ( self ): return { '_meta' : { 'hostvars' : {}}} # Read the command line args passed to the script. def read_cli_args ( self ): parser = argparse . ArgumentParser () parser . add_argument ( '--list' , action = 'store_true' ) parser . add_argument ( '--host' , action = 'store' ) self . args = parser . parse_args () # Get the inventory. ExampleInventory () \u672c\u811a\u672c\u4e2d example_inventory \u4e2d\u76f4\u63a5\u8fd4\u56de\u4e86\u4e00\u4e2ajson\u7ed3\u6784\uff0c\u5927\u5bb6\u53ef\u4ee5\u89e3\u6790\u5404\u79cd\u6e90\u6570\u636e\u6765\u6784\u5efajson\u7ed3\u6784\u8fd4\u56de\u5373\u53ef\u3002","title":"\u7b80\u5355\u4f8b\u5b50"},{"location":"advanced/dynamic-hosts/#_3","text":"\u8d4b\u4e88\u63d2\u4ef6\u53ef\u6267\u884c\u6743\u9650 chmod +x test_inventory.py --list \u6570\u636e ./test_inventory.py --list { \"_meta\" : { \"hostvars\" : { \"192.168.77.130\" : { \"host_specific_var\" : \"foo\" } , \"192.168.77.131\" : { \"host_specific_var\" : \"bar\" } } } , \"group\" : { \"hosts\" : [ \"192.168.77.130\" , \"192.168.77.131\" ] , \"vars\" : { \"ansible_ssh_pass\" : \"123456\" , \"ansible_ssh_user\" : \"root\" , \"example_variable\" : \"value\" } } } --host \u6570\u636e [ root@node130 ~ ] # ./test_inventory.py --host 192.168.77.130 { \"host_specific_var\" : \"foo\" } [ root@node130 ~ ] # ./test_inventory.py --host 192.168.77.131 { \"host_specific_var\" : \"bar\" }","title":"\u811a\u672c\u4f7f\u7528"},{"location":"advanced/dynamic-hosts/#ad-hoc","text":"\u5728\u547d\u4ee4\u4e2d\u4f7f\u7528 -i \u9009\u9879\u6307\u5b9a\u811a\u672c\u8def\u5f84\u5373\u53ef\u83b7\u53d6\u52a8\u6001\u4e3b\u673a\u4fe1\u606f ansible all -i test_inventory.py -m ping 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } # ansible-playbook -i test_inventory.py test.yml PLAY [ all ] ***************************************************************************************** TASK [ ping ] ***************************************************************************************** ok: [ 192 .168.77.131 ] ok: [ 192 .168.77.130 ] PLAY RECAP ***************************************************************************************** 192 .168.77.130 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 192 .168.77.131 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u67e5\u770b\u5b9a\u4e49\u7684\u4e3b\u673a\u53d8\u91cf # ansible all -i test_inventory.py -m debug -a \"var=host_specific_var\" 192 .168.77.130 | SUCCESS = > { \"host_specific_var\" : \"foo\" } 192 .168.77.131 | SUCCESS = > { \"host_specific_var\" : \"bar\" } # ansible all -i test_inventory.py -m debug -a \"var=example_variable\" 192 .168.77.130 | SUCCESS = > { \"example_variable\" : \"value\" } 192 .168.77.131 | SUCCESS = > { \"example_variable\" : \"value\" }","title":"\u6267\u884c ad-hoc \u547d\u4ee4"},{"location":"advanced/dynamic-hosts/#playbook","text":"# cat test_inventory_script.yml --- - hosts: all gather_facts: no tasks: - debug: var = host_specific_var - debug: var = example_variable # ansible-playbook -i test_inventory.py test_inventory_script.yml PLAY [ all ] ***************************************************************************************** TASK [ debug ] ***************************************************************************************** ok: [ 192 .168.77.130 ] = > { \"host_specific_var\" : \"foo\" } ok: [ 192 .168.77.131 ] = > { \"host_specific_var\" : \"bar\" } TASK [ debug ] ***************************************************************************************** ok: [ 192 .168.77.130 ] = > { \"example_variable\" : \"value\" } ok: [ 192 .168.77.131 ] = > { \"example_variable\" : \"value\" } PLAY RECAP ***************************************************************************************** 192 .168.77.130 : ok = 2 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 192 .168.77.131 : ok = 2 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0","title":"\u6267\u884c playbook"},{"location":"advanced/dynamic-hosts/#_4","text":"\u4f60\u53ef\u4ee5\u4f7f\u7528 inventory plugin \u6765\u83b7\u53d6\u4e91\u4e3b\u673a\u4fe1\u606f\uff0c\u4f7f\u7528\u65b9\u5f0f\u89c1 \u4f7f\u7528\u52a8\u6001\u4e3b\u673a\u7ba1\u7406\u4e91\u670d\u52a1 \u4f60\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5f00\u53d1 inventory plugin \u6765\u4ece\u6e90\u83b7\u53d6\u4e3b\u673a\u65b9\u5f0f\uff0c\u8be6\u7ec6\u4fe1\u606f\u89c1 \u4ececsv\u6e90\u83b7\u53d6\u4e3b\u673a\u4fe1\u606f","title":"\u63d2\u4ef6\u4f7f\u7528"},{"location":"advanced/dynamic-inventory/","text":"\u4f7f\u7528\u52a8\u6001\u4e3b\u673a\u6e05\u5355 \u00b6 \u5982\u679c\u4f60\u7684 Ansible \u4e3b\u673a\u6e05\u5355\u968f\u65f6\u95f4\u800c\u53d8\u52a8\uff0c\u968f\u7740\u4e3b\u673a\u5f00\u542f\u548c\u5173\u95ed\uff0c\u4ee5\u54cd\u5e94\u4e1a\u52a1\u9700\u6c42\u3002\u90a3\u4e48\u9759\u6001\u914d\u7f6e\u7684\u4e3b\u673a\u6e05\u5355\u5df2\u7ecf\u6ee1\u8db3\u4e0d\u4e86\u4f60\u7684\u73b0\u72b6\u3002 Ansible \u652f\u6301\u4e24\u79cd\u65b9\u5f0f\u6765\u5b9e\u73b0\u52a8\u6001\u7684\u4e3b\u673a\u6e05\u5355: Inventory \u63d2\u4ef6\u548c Inventory \u811a\u672c\u3002 Inventory \u63d2\u4ef6\u662f\u968f\u7740Ansible\u6838\u5fc3\u4ee3\u7801\u66f4\u65b0\u7684\u6700\u65b0\u4ee3\u7801\u3002\u5bf9\u4e8e\u52a8\u6001\u4e3b\u673a\u6e05\u5355\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 Inventory \u63d2\u4ef6 \u800c\u4e0d\u662f\u811a\u672c\u3002\u60a8\u53ef\u4ee5\u7f16\u5199\u81ea\u5df1\u7684\u63d2\u4ef6\u6765\u8fde\u63a5\u5230\u5176\u4ed6\u52a8\u6001\u4e3b\u673a\u6e05\u5355\u6e90\u3002 Inventory \u63d2\u4ef6 \u00b6 \u901a\u8fc7 ansible-doc \u547d\u4ee4\u53ef\u5217\u51fa\u5f53\u524d\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 # ansible-doc -t inventory -l nmap Uses nmap to find hosts to target host_list Parses a 'host list' string hcloud Ansible dynamic inventory plugin for the Hetzner Cloud openstack OpenStack inventory source vultr Vultr inventory source aws_ec2 EC2 inventory source cloudscale cloudscale.ch inventory source virtualbox virtualbox inventory source constructed Uses Jinja2 to construct vars and groups based on existing inventory k8s Kubernetes ( K8s ) inventory source generator Uses Jinja2 to construct hosts and groups from patterns script Executes an inventory script that returns JSON vmware_vm_inventory VMware Guest inventory source linode Ansible dynamic inventory plugin for Linode docker_machine Docker Machine inventory source yaml Uses a specific YAML file as an inventory source online Online inventory source azure_rm Azure Resource Manager inventory plugin docker_swarm Ansible dynamic inventory plugin for Docker swarm nodes advanced_host_list Parses a 'host list' with ranges foreman foreman inventory source auto Loads and executes an inventory plugin specified in a YAML config kubevirt KubeVirt inventory source gitlab_runners Ansible dynamic inventory plugin for GitLab runners netbox NetBox inventory source gcp_compute Google Cloud Compute Engine inventory source aws_rds rds instance source openshift OpenShift inventory source toml Uses a specific TOML file as an inventory source tower Ansible dynamic inventory plugin for Ansible Tower scaleway Scaleway inventory source ini Uses an Ansible INI file as inventory source Tips inventory \u63d2\u4ef6\u7684\u6587\u4ef6\u9ed8\u8ba4\u5b58\u50a8\u5728 /lib/python2.7/site-packages/ansible/plugins/inventory/ \u76ee\u5f55\u4e2d\u3002 AWS EC2 \u52a8\u6001\u6e05\u5355 \u00b6 \u4f7f\u7528 Inventory \u63d2\u4ef6 \u00b6 \u5b89\u88c5\u4f9d\u8d56 \u00b6 pip install boto3 \u5f00\u542f\u63d2\u4ef6 \u00b6 \u5927\u591a\u6570\u968fAnsible\u81ea\u5e26\u7684\u63d2\u4ef6\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u7981\u7528\u7684\uff0c\u9700\u8981\u5728\u4f60\u7684 Ansible .cfg \u6587\u4ef6\u4e2d\u52a0\u5165\u767d\u540d\u5355\u624d\u80fd\u6b63\u5e38\u8fd0\u884c\u3002 [inventory] enable_plugins = host_list, script, auto, yaml, ini, toml, aws_ec2 \u914d\u7f6e\u63d2\u4ef6 \u00b6 \u4f7f\u7528inventory\u63d2\u4ef6\u65f6\uff0c\u9700\u8981\u914d\u7f6e\u4e00\u4e2ayaml\u6587\u4ef6\u6765\u63cf\u8ff0\u4f7f\u7528\u7684\u63d2\u4ef6\u548c\u63d2\u4ef6\u9009\u9879\u3002\u4f8b\u5982 aws_ec2 inventory\u63d2\u4ef6\u5fc5\u987b\u4ee5 aws_ec2.(yml|yaml) \u7ed3\u5c3e\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u3002 # hosts_aws_ec2.yml plugin : aws_ec2 # aws regions : - cn-north-1 # aws_profile: default aws_access_key : 'aws_access_key_id' aws_secrets_key : 'aws_secret_access_key' # cache cache : True cache_plugin : jsonfile cache_prefix : aws-ec2 cache_timeout : 7200 cache_connection : /tmp/aws_inventory # \u5ffd\u7565403\u9519\u8bef strict_permissions : False # \u81ea\u5b9a\u4e49\u7ec4 keyed_groups : # Add e.g. x86_64 hosts to an arch_x86_64 group - prefix : arch key : 'architecture' # Add hosts to tag_Name_Value groups for each Name/Value tag pair - prefix : tag key : tags # Add hosts to e.g. instance_type_z3_tiny - prefix : instance_type key : instance_type # Create security_groups_sg_abcd1234 group for each SG - key : 'security_groups|json_query(\"[].group_id\")' prefix : 'security_groups' # Create a group for each value of the Application tag - key : tags.Application separator : '' # Create a group per region e.g. aws_region_us_east_2 - key : placement.region prefix : aws_region # Create a group (or groups) based on the value of a custom tag \"Role\" and add them to a metagroup called \"project\" - key : tags['Role'] prefix : foo parent_group : \"project\" # \u4e3b\u673a\u540d\u53d8\u91cf hostnames : - tag:Name - ip-address - dns-name - private-ip-address # \u8bbe\u7f6e\u53d8\u91cf compose : ansible_host : public_ip_address # ansible_ssh_user: root # ansible_ssh_pass: 123456 aws_access_key \u6307\u5b9aaws\u8bbf\u95eekey\uff0caws_secrets_key \u6307\u5b9aaws\u8bbf\u95ee\u79d8\u94a5, \u66f4\u591a\u53c2\u6570\u89c1 aws_ec2 \u63d2\u4ef6\u5e2e\u52a9 \u83b7\u53d6\u4e3b\u673a\u5217\u8868 \u00b6 ansible-inventory -i hosts_aws_ec2.yml --graph \u6267\u884c\u547d\u4ee4 \u00b6 ansible -i hosts_aws_ec2.yml tag_Env_test -m ping tag_Env_test \u662f\u5305\u542b Env:test \u6807\u7b7e\u7684\u4e3b\u673a\u7ec4\u3002\u4e3b\u673a\u8ba4\u8bc1\u53ef\u4f7f\u7528ssh\u5bc6\u94a5\u8ba4\u8bc1\uff0c\u6216\u8005\u5728 compose \u4e2d\u6307\u5b9a\u8fde\u63a5\u7528\u6237\u548c\u5bc6\u7801\u3002 \u5237\u65b0 Inventory Cache \u00b6 \u5728\u6307\u5b9a\u4e86 cache: True \u65f6\uff0cInventory\u4fe1\u606f\u4f1a\u5b58\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5982\u679c\u60f3\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u4e24\u79cd\u65b9\u5f0f \u624b\u52a8\u7684\u5220\u9664\u7f13\u5b58\u4fe1\u606f, \u6bd4\u5982\u5220\u9664\u7f13\u5b58\u6587\u4ef6 rm -f /tmp/aws_inventory/aws_ec2* \u4f7f\u7528 ansible-playbook --flush-cache \u547d\u4ee4\u6765\u5237\u65b0 \u4f7f\u7528 Inventory \u811a\u672c \u00b6 \u76ee\u524d\u5df2\u4e0d\u5efa\u8bae\u4f7f\u7528 \u4f7f\u7528 EC2 external inventory \u5916\u90e8\u811a\u672c\u6765\u83b7\u53d6AWS EC2\u4e3b\u673a\u7684\u4fe1\u606f\u3002 \u4e0b\u8f7d\u811a\u672c \u00b6 wget https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/ec2.py wget https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/ec2.ini chmod +x ec2.py Note ec2.py \u811a\u672c\u662f\u4f7f\u7528Boto EC2\u5e93\u7f16\u5199\u7684\uff0c\u5e76\u5c06\u5411AWS\u67e5\u8be2\u60a8\u6b63\u5728\u8fd0\u884c\u7684Amazon EC2\u5b9e\u4f8b\u3002 ec2.ini \u6587\u4ef6\u662f ec2.py \u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u7528\u4e8e\u9650\u5236Ansible\u7684\u8bbf\u95ee\u8303\u56f4\u3002 \u5b89\u88c5\u4f9d\u8d56 \u00b6 pip install boto \u914d\u7f6e ec2.ini \u00b6 [ec2] regions = cn-north-1 regions_exclude = destination_variable = public_dns_name hostname_variable = tag_Name vpc_destination_variable = ip_address route53 = False all_instances = False all_rds_instances = False include_rds_clusters = False all_elasticache_replication_groups = False all_elasticache_clusters = False all_elasticache_nodes = False cache_path = ~/.ansible/tmp cache_max_age = 3600 nested_groups = False replace_dash_in_groups = True expand_csv_tags = False group_by_instance_id = True group_by_region = True group_by_availability_zone = True group_by_aws_account = False group_by_ami_id = True group_by_instance_type = True group_by_instance_state = False group_by_platform = True group_by_key_pair = True group_by_vpc_id = True group_by_security_group = True group_by_tag_keys = True group_by_tag_none = True group_by_route53_names = True group_by_rds_engine = True group_by_rds_parameter_group = True group_by_elasticache_engine = True group_by_elasticache_cluster = True group_by_elasticache_parameter_group = True group_by_elasticache_replication_group = True stack_filters = False [credentials] aws_access_key_id = aws_access_key_id aws_secret_access_key = aws_secret_access_key \u83b7\u53d6\u4e3b\u673a\u5217\u8868 \u00b6 ./ec2.py --list \u6267\u884c\u547d\u4ee4 \u00b6 ansible -i ec2.py tag_Env_test -m ping tag_Env_test \u662f\u5305\u542b Env:test \u6807\u7b7e\u7684\u4e3b\u673a\u7ec4\u3002\u4e3b\u673a\u8ba4\u8bc1\u53ef\u4f7f\u7528ssh\u5bc6\u94a5\u8ba4\u8bc1\uff0c\u6216\u8005\u5728 compose \u4e2d\u6307\u5b9a\u8fde\u63a5\u7528\u6237\u548c\u5bc6\u7801\u3002 \u5237\u65b0 Inventory Cache \u00b6 \u5728\u6307\u5b9a\u4e86 cache: True \u65f6\uff0cInventory\u4fe1\u606f\u4f1a\u5b58\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5982\u679c\u60f3\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u4e09\u79cd\u65b9\u5f0f \u624b\u52a8\u7684\u5220\u9664\u7f13\u5b58\u4fe1\u606f, \u6bd4\u5982\u5220\u9664\u7f13\u5b58\u6587\u4ef6 rm -f /tmp/aws_inventory/aws_ec2* \u4f7f\u7528 ansible-playbook --flush-cache \u547d\u4ee4\u6765\u5237\u65b0 \u4f7f\u7528 ./ec2.py --refresh-cache \u547d\u4ee4\u6765\u5237\u65b0 Alicloud ECS \u52a8\u6001\u6e05\u5355 \u00b6 \u4f7f\u7528 Inventory \u63d2\u4ef6 \u00b6 \u76ee\u524d ansible_alicloud \u53ea\u652f\u6301\u5728 python3 \u73af\u5883\u8fd0\u884c \u5b89\u88c5\u4f9d\u8d56 \u00b6 sudo pip install ansible_alicloud # \u76ee\u524d\u5b89\u88c5\u5305\u4e0d\u5305\u542binventory\u63d2\u4ef6\uff0c\u9700\u8981\u5355\u72ec\u4e0b\u8f7d wget https://raw.githubusercontent.com/alibaba/ansible-provider/master/lib/ansible/plugins/inventory/alicloud_ecs.py -O /usr/lib/python2.7/site-packages/ansible/plugins/inventory/alicloud_ecs.py \u5f00\u542f\u63d2\u4ef6 \u00b6 \u5927\u591a\u6570\u968fAnsible\u81ea\u5e26\u7684\u63d2\u4ef6\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u7981\u7528\u7684\uff0c\u9700\u8981\u5728\u4f60\u7684 Ansible .cfg \u6587\u4ef6\u4e2d\u52a0\u5165\u767d\u540d\u5355\u624d\u80fd\u6b63\u5e38\u8fd0\u884c\u3002 [inventory] enable_plugins = host_list, script, auto, yaml, ini, toml, alicloud_ecs \u914d\u7f6e\u63d2\u4ef6 \u00b6 \u4f7f\u7528inventory\u63d2\u4ef6\u65f6\uff0c\u9700\u8981\u914d\u7f6e\u4e00\u4e2ayaml\u6587\u4ef6\u6765\u63cf\u8ff0\u4f7f\u7528\u7684\u63d2\u4ef6\u548c\u63d2\u4ef6\u9009\u9879\u3002\u4f8b\u5982 aws_ec2 inventory\u63d2\u4ef6\u5fc5\u987b\u4ee5 alicloud.(yml|yaml) \u7ed3\u5c3e\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u3002 plugin: alicloud_ecs regions: - cn-beijing alicloud_access_key: alicloud_access_key alicloud_secret_key: alicloud_secret_key hostnames: - public_ip_address keyed_groups: # add hosts to instance_type groups - prefix: instance_type key: instance_type # add hosts to instance_name groups - key: instance_name prefix: name cache: true cache_plugin: jsonfile cache_timeout: 7200 cache_connection: /tmp/alicloud_inventory cache_prefix: alicloud_ecs strict: true compose: ansible_host: public_ip_address \u83b7\u53d6\u4e3b\u673a\u5217\u8868 \u00b6 ansible-inventory -i hosts_alicloud.yml --graph \u6267\u884c\u547d\u4ee4 \u00b6 ansible -i hosts_alicloud.yml tag_Env_test -m ping tag_Env_test \u662f\u5305\u542b Env:test \u6807\u7b7e\u7684\u4e3b\u673a\u7ec4\u3002\u4e3b\u673a\u8ba4\u8bc1\u53ef\u4f7f\u7528ssh\u5bc6\u94a5\u8ba4\u8bc1\uff0c\u6216\u8005\u5728 compose \u4e2d\u6307\u5b9a\u8fde\u63a5\u7528\u6237\u548c\u5bc6\u7801\u3002 \u5237\u65b0 Inventory Cache \u00b6 \u5728\u6307\u5b9a\u4e86 cache: True \u65f6\uff0cInventory\u4fe1\u606f\u4f1a\u5b58\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5982\u679c\u60f3\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u4e24\u79cd\u65b9\u5f0f \u624b\u52a8\u7684\u5220\u9664\u7f13\u5b58\u4fe1\u606f, \u6bd4\u5982\u5220\u9664\u7f13\u5b58\u6587\u4ef6 rm -f /tmp/alicloud_inventory/alicloud_ecs* \u4f7f\u7528 ansible-playbook --flush-cache \u547d\u4ee4\u6765\u5237\u65b0 \u4f7f\u7528 Inventory \u811a\u672c \u00b6 \u76ee\u524d\u5df2\u4e0d\u5efa\u8bae\u4f7f\u7528 \u4f7f\u7528 ECS external inventory \u5916\u90e8\u811a\u672c\u6765\u83b7\u53d6AWS EC2\u4e3b\u673a\u7684\u4fe1\u606f\u3002 \u4e0b\u8f7d\u811a\u672c \u00b6 wget https://raw.githubusercontent.com/alibaba/ansible-provider/2c9a81bf3d5d3f3e049e06479e1972e61b92c02c/contrib/inventory/alicloud.py wget https://raw.githubusercontent.com/alibaba/ansible-provider/2c9a81bf3d5d3f3e049e06479e1972e61b92c02c/contrib/inventory/alicloud.ini chmod +x alicloud.py \u811a\u672c\u53ea\u652f\u6301\u5728 python3 \u73af\u5883\u8fd0\u884c \u5982\u679c\u8981\u5728python2\u4e2d\u8fd0\u884c\uff0c\u9700\u5c06configparser\u5e93\u5f15\u7528\u4fee\u6b63\u4e0b import sys if sys.version_info[0] == 2: import ConfigParser as configparser else: import configparser \u5b89\u88c5\u4f9d\u8d56 \u00b6 pip install configparser \u914d\u7f6e alicloud.ini \u00b6 [ecs] regions = all destination_variable = public_ip_address hostname_variable = instance_id all_instances = True cache_path = /tmp/alicloud_inventory/ cache_max_age = 7200 nested_groups = False replace_dash_in_groups = True expand_csv_tags = False group_by_instance_id = True group_by_region = True group_by_availability_zone = True group_by_image_id = True group_by_instance_type = True group_by_vpc_id = True group_by_vswitch_id = True group_by_security_group = True group_by_tag_keys = True group_by_tag_none = True [credentials] alicloud_access_key = alicloud_access_key alicloud_secret_key = alicloud_secret_key \u83b7\u53d6\u4e3b\u673a\u5217\u8868 \u00b6 ./alicloud.py --list \u6267\u884c\u547d\u4ee4 \u00b6 ansible -i alicloud.py tag_Env_test -m ping tag_Env_test \u662f\u5305\u542b Env:test \u6807\u7b7e\u7684\u4e3b\u673a\u7ec4\u3002\u4e3b\u673a\u8ba4\u8bc1\u53ef\u4f7f\u7528ssh\u5bc6\u94a5\u8ba4\u8bc1\uff0c\u6216\u8005\u5728 compose \u4e2d\u6307\u5b9a\u8fde\u63a5\u7528\u6237\u548c\u5bc6\u7801\u3002 \u5237\u65b0 Inventory Cache \u00b6 \u5728\u6307\u5b9a\u4e86 cache: True \u65f6\uff0cInventory\u4fe1\u606f\u4f1a\u5b58\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5982\u679c\u60f3\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u4e09\u79cd\u65b9\u5f0f \u624b\u52a8\u7684\u5220\u9664\u7f13\u5b58\u4fe1\u606f, \u6bd4\u5982\u5220\u9664\u7f13\u5b58\u6587\u4ef6 rm -f /tmp/alicloud_inventory/* \u4f7f\u7528 ansible-playbook --flush-cache \u547d\u4ee4\u6765\u5237\u65b0s \u4f7f\u7528 ./alicloud.py --refresh-cache \u547d\u4ee4\u6765\u5237\u65b0 OpenStack \u52a8\u6001\u6e05\u5355 \u00b6 \u4f7f\u7528 Inventory \u63d2\u4ef6 \u00b6 \u5b89\u88c5\u4f9d\u8d56 \u00b6 \u65b0\u7248\u672c\u4e0d\u652f\u6301 python2 \u73af\u5883\u4e86\u3002 # python 2 pip install openstacksdk == 0 .39.0 # python 3 pip install openstacksdk \u5f00\u542f\u63d2\u4ef6 \u00b6 \u5927\u591a\u6570\u968fAnsible\u81ea\u5e26\u7684\u63d2\u4ef6\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u7981\u7528\u7684\uff0c\u9700\u8981\u5728\u4f60\u7684 Ansible.cfg \u6587\u4ef6\u4e2d\u52a0\u5165\u767d\u540d\u5355\u624d\u80fd\u6b63\u5e38\u8fd0\u884c\u3002 [inventory] enable_plugins = host_list, script, auto, yaml, ini, toml, openstack \u914d\u7f6e\u63d2\u4ef6 \u00b6 \u4f7f\u7528inventory\u63d2\u4ef6\u65f6\uff0c\u9700\u8981\u914d\u7f6e\u4e00\u4e2ayaml\u6587\u4ef6\u6765\u63cf\u8ff0\u4f7f\u7528\u7684\u63d2\u4ef6\u548c\u63d2\u4ef6\u9009\u9879\u3002\u4f8b\u5982 aws_ec2 inventory\u63d2\u4ef6\u5fc5\u987b\u4ee5 (openstack|cloud).(yml|yaml) \u7ed3\u5c3e\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u3002 plugin: openstack inventory_hostname: name private: yes fail_on_errors: yes expand_hostvars: yes cache: true cache_plugin: jsonfile cache_connection: /tmp/openstack-inventory cache_prefix: openstack_host keyed_groups: - prefix: '' key: openstack.metadata.vm_role compose: cloud: \"openstack\" Source OpenStack RC \u6587\u4ef6 \u00b6 \u53ef\u5728 OpenStack WEB\u7ba1\u7406\u754c\u9762\u4e0b\u8f7dRC\u6587\u4ef6 export OS_AUTH_URL = http://hosts:5000/v3/ # With the addition of Keystone we have standardized on the term **project** # as the entity that owns the resources. export OS_PROJECT_ID = OS_PROJECT_ID export OS_PROJECT_NAME = \"admin\" export OS_USER_DOMAIN_NAME = \"Default\" if [ -z \" $OS_USER_DOMAIN_NAME \" ] ; then unset OS_USER_DOMAIN_NAME ; fi export OS_PROJECT_DOMAIN_ID = \"default\" if [ -z \" $OS_PROJECT_DOMAIN_ID \" ] ; then unset OS_PROJECT_DOMAIN_ID ; fi export OS_USERNAME = \"admin\" read -sr OS_PASSWORD_INPUT export OS_PASSWORD = $OS_PASSWORD_INPUT export OS_REGION_NAME = \"RegionOne\" if [ -z \" $OS_REGION_NAME \" ] ; then unset OS_REGION_NAME ; fi export OS_INTERFACE = public export OS_IDENTITY_API_VERSION = 3 \u83b7\u53d6\u4e3b\u673a\u5217\u8868 \u00b6 ansible-inventory -i hosts_openstack.yml --graph \u6267\u884c\u547d\u4ee4 \u00b6 ansible -i hosts_openstack.yml zone1 -m ping \u5237\u65b0 Inventory Cache \u00b6 \u5728\u6307\u5b9a\u4e86 cache: True \u65f6\uff0cInventory\u4fe1\u606f\u4f1a\u5b58\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5982\u679c\u60f3\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u4e24\u79cd\u65b9\u5f0f \u624b\u52a8\u7684\u5220\u9664\u7f13\u5b58\u4fe1\u606f, \u6bd4\u5982\u5220\u9664\u7f13\u5b58\u6587\u4ef6 rm -f /tmp/openstack_inventory/* \u4f7f\u7528 ansible-playbook --flush-cache \u547d\u4ee4\u6765\u5237\u65b0 \u4f7f\u7528 Inventory \u811a\u672c \u00b6 \u76ee\u524d\u5df2\u4e0d\u5efa\u8bae\u4f7f\u7528 \u4f7f\u7528 ECS external inventory \u5916\u90e8\u811a\u672c\u6765\u83b7\u53d6AWS EC2\u4e3b\u673a\u7684\u4fe1\u606f\u3002 \u4e0b\u8f7d\u811a\u672c \u00b6 wget https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/openstack_inventory.py wget https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/openstack.yml -O /etc/ansible/openstack.yml chmod +x openstack_inventory.py \u5b89\u88c5\u4f9d\u8d56 \u00b6 # python 2 pip install openstacksdk == 0 .39.0 # python 3 pip install openstacksdk \u914d\u7f6e openstack.yml \u00b6 \u914d\u7f6e\u6587\u4ef6\u9700\u653e\u7f6e\u5728 /etc/ansible/openstack.yml clouds : defaults : auth : auth_url : http://hosts:5000/v3/ password : password project_domain_id : default project_name : admin user_domain_id : default username : admin identity_api_version : '3' region_name : RegionOne volume_api_version : '2' ansible : use_hostnames : True expand_hostvars : False fail_on_errors : True \u83b7\u53d6\u4e3b\u673a\u5217\u8868 \u00b6 ./openstack_inventory.py --list \u6267\u884c\u547d\u4ee4 \u00b6 ansible -i openstack_inventory.py zone3 -m ping \u5237\u65b0 Inventory Cache \u00b6 \u5728\u6307\u5b9a\u4e86 cache: True \u65f6\uff0cInventory\u4fe1\u606f\u4f1a\u5b58\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5982\u679c\u60f3\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u4e09\u79cd\u65b9\u5f0f \u624b\u52a8\u7684\u5220\u9664\u7f13\u5b58\u4fe1\u606f, \u6bd4\u5982\u5220\u9664\u7f13\u5b58\u6587\u4ef6 rm -f ~/.cache/openstack/ansible-inventory.cache* \u4f7f\u7528 ansible-playbook --flush-cache \u547d\u4ee4\u6765\u5237\u65b0s \u4f7f\u7528 ./openstack_inventory.py --refresh-cache \u547d\u4ee4\u6765\u5237\u65b0","title":"\u4f7f\u7528\u52a8\u6001\u4e3b\u673a\u7ba1\u7406\u4e91\u670d\u52a1"},{"location":"advanced/dynamic-inventory/#_1","text":"\u5982\u679c\u4f60\u7684 Ansible \u4e3b\u673a\u6e05\u5355\u968f\u65f6\u95f4\u800c\u53d8\u52a8\uff0c\u968f\u7740\u4e3b\u673a\u5f00\u542f\u548c\u5173\u95ed\uff0c\u4ee5\u54cd\u5e94\u4e1a\u52a1\u9700\u6c42\u3002\u90a3\u4e48\u9759\u6001\u914d\u7f6e\u7684\u4e3b\u673a\u6e05\u5355\u5df2\u7ecf\u6ee1\u8db3\u4e0d\u4e86\u4f60\u7684\u73b0\u72b6\u3002 Ansible \u652f\u6301\u4e24\u79cd\u65b9\u5f0f\u6765\u5b9e\u73b0\u52a8\u6001\u7684\u4e3b\u673a\u6e05\u5355: Inventory \u63d2\u4ef6\u548c Inventory \u811a\u672c\u3002 Inventory \u63d2\u4ef6\u662f\u968f\u7740Ansible\u6838\u5fc3\u4ee3\u7801\u66f4\u65b0\u7684\u6700\u65b0\u4ee3\u7801\u3002\u5bf9\u4e8e\u52a8\u6001\u4e3b\u673a\u6e05\u5355\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 Inventory \u63d2\u4ef6 \u800c\u4e0d\u662f\u811a\u672c\u3002\u60a8\u53ef\u4ee5\u7f16\u5199\u81ea\u5df1\u7684\u63d2\u4ef6\u6765\u8fde\u63a5\u5230\u5176\u4ed6\u52a8\u6001\u4e3b\u673a\u6e05\u5355\u6e90\u3002","title":"\u4f7f\u7528\u52a8\u6001\u4e3b\u673a\u6e05\u5355"},{"location":"advanced/dynamic-inventory/#inventory","text":"\u901a\u8fc7 ansible-doc \u547d\u4ee4\u53ef\u5217\u51fa\u5f53\u524d\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 # ansible-doc -t inventory -l nmap Uses nmap to find hosts to target host_list Parses a 'host list' string hcloud Ansible dynamic inventory plugin for the Hetzner Cloud openstack OpenStack inventory source vultr Vultr inventory source aws_ec2 EC2 inventory source cloudscale cloudscale.ch inventory source virtualbox virtualbox inventory source constructed Uses Jinja2 to construct vars and groups based on existing inventory k8s Kubernetes ( K8s ) inventory source generator Uses Jinja2 to construct hosts and groups from patterns script Executes an inventory script that returns JSON vmware_vm_inventory VMware Guest inventory source linode Ansible dynamic inventory plugin for Linode docker_machine Docker Machine inventory source yaml Uses a specific YAML file as an inventory source online Online inventory source azure_rm Azure Resource Manager inventory plugin docker_swarm Ansible dynamic inventory plugin for Docker swarm nodes advanced_host_list Parses a 'host list' with ranges foreman foreman inventory source auto Loads and executes an inventory plugin specified in a YAML config kubevirt KubeVirt inventory source gitlab_runners Ansible dynamic inventory plugin for GitLab runners netbox NetBox inventory source gcp_compute Google Cloud Compute Engine inventory source aws_rds rds instance source openshift OpenShift inventory source toml Uses a specific TOML file as an inventory source tower Ansible dynamic inventory plugin for Ansible Tower scaleway Scaleway inventory source ini Uses an Ansible INI file as inventory source Tips inventory \u63d2\u4ef6\u7684\u6587\u4ef6\u9ed8\u8ba4\u5b58\u50a8\u5728 /lib/python2.7/site-packages/ansible/plugins/inventory/ \u76ee\u5f55\u4e2d\u3002","title":"Inventory \u63d2\u4ef6"},{"location":"advanced/dynamic-inventory/#aws-ec2","text":"","title":"AWS EC2 \u52a8\u6001\u6e05\u5355"},{"location":"advanced/dynamic-inventory/#inventory_1","text":"","title":"\u4f7f\u7528 Inventory \u63d2\u4ef6"},{"location":"advanced/dynamic-inventory/#_2","text":"pip install boto3","title":"\u5b89\u88c5\u4f9d\u8d56"},{"location":"advanced/dynamic-inventory/#_3","text":"\u5927\u591a\u6570\u968fAnsible\u81ea\u5e26\u7684\u63d2\u4ef6\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u7981\u7528\u7684\uff0c\u9700\u8981\u5728\u4f60\u7684 Ansible .cfg \u6587\u4ef6\u4e2d\u52a0\u5165\u767d\u540d\u5355\u624d\u80fd\u6b63\u5e38\u8fd0\u884c\u3002 [inventory] enable_plugins = host_list, script, auto, yaml, ini, toml, aws_ec2","title":"\u5f00\u542f\u63d2\u4ef6"},{"location":"advanced/dynamic-inventory/#_4","text":"\u4f7f\u7528inventory\u63d2\u4ef6\u65f6\uff0c\u9700\u8981\u914d\u7f6e\u4e00\u4e2ayaml\u6587\u4ef6\u6765\u63cf\u8ff0\u4f7f\u7528\u7684\u63d2\u4ef6\u548c\u63d2\u4ef6\u9009\u9879\u3002\u4f8b\u5982 aws_ec2 inventory\u63d2\u4ef6\u5fc5\u987b\u4ee5 aws_ec2.(yml|yaml) \u7ed3\u5c3e\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u3002 # hosts_aws_ec2.yml plugin : aws_ec2 # aws regions : - cn-north-1 # aws_profile: default aws_access_key : 'aws_access_key_id' aws_secrets_key : 'aws_secret_access_key' # cache cache : True cache_plugin : jsonfile cache_prefix : aws-ec2 cache_timeout : 7200 cache_connection : /tmp/aws_inventory # \u5ffd\u7565403\u9519\u8bef strict_permissions : False # \u81ea\u5b9a\u4e49\u7ec4 keyed_groups : # Add e.g. x86_64 hosts to an arch_x86_64 group - prefix : arch key : 'architecture' # Add hosts to tag_Name_Value groups for each Name/Value tag pair - prefix : tag key : tags # Add hosts to e.g. instance_type_z3_tiny - prefix : instance_type key : instance_type # Create security_groups_sg_abcd1234 group for each SG - key : 'security_groups|json_query(\"[].group_id\")' prefix : 'security_groups' # Create a group for each value of the Application tag - key : tags.Application separator : '' # Create a group per region e.g. aws_region_us_east_2 - key : placement.region prefix : aws_region # Create a group (or groups) based on the value of a custom tag \"Role\" and add them to a metagroup called \"project\" - key : tags['Role'] prefix : foo parent_group : \"project\" # \u4e3b\u673a\u540d\u53d8\u91cf hostnames : - tag:Name - ip-address - dns-name - private-ip-address # \u8bbe\u7f6e\u53d8\u91cf compose : ansible_host : public_ip_address # ansible_ssh_user: root # ansible_ssh_pass: 123456 aws_access_key \u6307\u5b9aaws\u8bbf\u95eekey\uff0caws_secrets_key \u6307\u5b9aaws\u8bbf\u95ee\u79d8\u94a5, \u66f4\u591a\u53c2\u6570\u89c1 aws_ec2 \u63d2\u4ef6\u5e2e\u52a9","title":"\u914d\u7f6e\u63d2\u4ef6"},{"location":"advanced/dynamic-inventory/#_5","text":"ansible-inventory -i hosts_aws_ec2.yml --graph","title":"\u83b7\u53d6\u4e3b\u673a\u5217\u8868"},{"location":"advanced/dynamic-inventory/#_6","text":"ansible -i hosts_aws_ec2.yml tag_Env_test -m ping tag_Env_test \u662f\u5305\u542b Env:test \u6807\u7b7e\u7684\u4e3b\u673a\u7ec4\u3002\u4e3b\u673a\u8ba4\u8bc1\u53ef\u4f7f\u7528ssh\u5bc6\u94a5\u8ba4\u8bc1\uff0c\u6216\u8005\u5728 compose \u4e2d\u6307\u5b9a\u8fde\u63a5\u7528\u6237\u548c\u5bc6\u7801\u3002","title":"\u6267\u884c\u547d\u4ee4"},{"location":"advanced/dynamic-inventory/#inventory-cache","text":"\u5728\u6307\u5b9a\u4e86 cache: True \u65f6\uff0cInventory\u4fe1\u606f\u4f1a\u5b58\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5982\u679c\u60f3\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u4e24\u79cd\u65b9\u5f0f \u624b\u52a8\u7684\u5220\u9664\u7f13\u5b58\u4fe1\u606f, \u6bd4\u5982\u5220\u9664\u7f13\u5b58\u6587\u4ef6 rm -f /tmp/aws_inventory/aws_ec2* \u4f7f\u7528 ansible-playbook --flush-cache \u547d\u4ee4\u6765\u5237\u65b0","title":"\u5237\u65b0 Inventory  Cache"},{"location":"advanced/dynamic-inventory/#inventory_2","text":"\u76ee\u524d\u5df2\u4e0d\u5efa\u8bae\u4f7f\u7528 \u4f7f\u7528 EC2 external inventory \u5916\u90e8\u811a\u672c\u6765\u83b7\u53d6AWS EC2\u4e3b\u673a\u7684\u4fe1\u606f\u3002","title":"\u4f7f\u7528 Inventory \u811a\u672c"},{"location":"advanced/dynamic-inventory/#_7","text":"wget https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/ec2.py wget https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/ec2.ini chmod +x ec2.py Note ec2.py \u811a\u672c\u662f\u4f7f\u7528Boto EC2\u5e93\u7f16\u5199\u7684\uff0c\u5e76\u5c06\u5411AWS\u67e5\u8be2\u60a8\u6b63\u5728\u8fd0\u884c\u7684Amazon EC2\u5b9e\u4f8b\u3002 ec2.ini \u6587\u4ef6\u662f ec2.py \u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u7528\u4e8e\u9650\u5236Ansible\u7684\u8bbf\u95ee\u8303\u56f4\u3002","title":"\u4e0b\u8f7d\u811a\u672c"},{"location":"advanced/dynamic-inventory/#_8","text":"pip install boto","title":"\u5b89\u88c5\u4f9d\u8d56"},{"location":"advanced/dynamic-inventory/#ec2ini","text":"[ec2] regions = cn-north-1 regions_exclude = destination_variable = public_dns_name hostname_variable = tag_Name vpc_destination_variable = ip_address route53 = False all_instances = False all_rds_instances = False include_rds_clusters = False all_elasticache_replication_groups = False all_elasticache_clusters = False all_elasticache_nodes = False cache_path = ~/.ansible/tmp cache_max_age = 3600 nested_groups = False replace_dash_in_groups = True expand_csv_tags = False group_by_instance_id = True group_by_region = True group_by_availability_zone = True group_by_aws_account = False group_by_ami_id = True group_by_instance_type = True group_by_instance_state = False group_by_platform = True group_by_key_pair = True group_by_vpc_id = True group_by_security_group = True group_by_tag_keys = True group_by_tag_none = True group_by_route53_names = True group_by_rds_engine = True group_by_rds_parameter_group = True group_by_elasticache_engine = True group_by_elasticache_cluster = True group_by_elasticache_parameter_group = True group_by_elasticache_replication_group = True stack_filters = False [credentials] aws_access_key_id = aws_access_key_id aws_secret_access_key = aws_secret_access_key","title":"\u914d\u7f6eec2.ini"},{"location":"advanced/dynamic-inventory/#_9","text":"./ec2.py --list","title":"\u83b7\u53d6\u4e3b\u673a\u5217\u8868"},{"location":"advanced/dynamic-inventory/#_10","text":"ansible -i ec2.py tag_Env_test -m ping tag_Env_test \u662f\u5305\u542b Env:test \u6807\u7b7e\u7684\u4e3b\u673a\u7ec4\u3002\u4e3b\u673a\u8ba4\u8bc1\u53ef\u4f7f\u7528ssh\u5bc6\u94a5\u8ba4\u8bc1\uff0c\u6216\u8005\u5728 compose \u4e2d\u6307\u5b9a\u8fde\u63a5\u7528\u6237\u548c\u5bc6\u7801\u3002","title":"\u6267\u884c\u547d\u4ee4"},{"location":"advanced/dynamic-inventory/#inventory-cache_1","text":"\u5728\u6307\u5b9a\u4e86 cache: True \u65f6\uff0cInventory\u4fe1\u606f\u4f1a\u5b58\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5982\u679c\u60f3\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u4e09\u79cd\u65b9\u5f0f \u624b\u52a8\u7684\u5220\u9664\u7f13\u5b58\u4fe1\u606f, \u6bd4\u5982\u5220\u9664\u7f13\u5b58\u6587\u4ef6 rm -f /tmp/aws_inventory/aws_ec2* \u4f7f\u7528 ansible-playbook --flush-cache \u547d\u4ee4\u6765\u5237\u65b0 \u4f7f\u7528 ./ec2.py --refresh-cache \u547d\u4ee4\u6765\u5237\u65b0","title":"\u5237\u65b0 Inventory  Cache"},{"location":"advanced/dynamic-inventory/#alicloud-ecs","text":"","title":"Alicloud ECS \u52a8\u6001\u6e05\u5355"},{"location":"advanced/dynamic-inventory/#inventory_3","text":"\u76ee\u524d ansible_alicloud \u53ea\u652f\u6301\u5728 python3 \u73af\u5883\u8fd0\u884c","title":"\u4f7f\u7528 Inventory \u63d2\u4ef6"},{"location":"advanced/dynamic-inventory/#_11","text":"sudo pip install ansible_alicloud # \u76ee\u524d\u5b89\u88c5\u5305\u4e0d\u5305\u542binventory\u63d2\u4ef6\uff0c\u9700\u8981\u5355\u72ec\u4e0b\u8f7d wget https://raw.githubusercontent.com/alibaba/ansible-provider/master/lib/ansible/plugins/inventory/alicloud_ecs.py -O /usr/lib/python2.7/site-packages/ansible/plugins/inventory/alicloud_ecs.py","title":"\u5b89\u88c5\u4f9d\u8d56"},{"location":"advanced/dynamic-inventory/#_12","text":"\u5927\u591a\u6570\u968fAnsible\u81ea\u5e26\u7684\u63d2\u4ef6\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u7981\u7528\u7684\uff0c\u9700\u8981\u5728\u4f60\u7684 Ansible .cfg \u6587\u4ef6\u4e2d\u52a0\u5165\u767d\u540d\u5355\u624d\u80fd\u6b63\u5e38\u8fd0\u884c\u3002 [inventory] enable_plugins = host_list, script, auto, yaml, ini, toml, alicloud_ecs","title":"\u5f00\u542f\u63d2\u4ef6"},{"location":"advanced/dynamic-inventory/#_13","text":"\u4f7f\u7528inventory\u63d2\u4ef6\u65f6\uff0c\u9700\u8981\u914d\u7f6e\u4e00\u4e2ayaml\u6587\u4ef6\u6765\u63cf\u8ff0\u4f7f\u7528\u7684\u63d2\u4ef6\u548c\u63d2\u4ef6\u9009\u9879\u3002\u4f8b\u5982 aws_ec2 inventory\u63d2\u4ef6\u5fc5\u987b\u4ee5 alicloud.(yml|yaml) \u7ed3\u5c3e\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u3002 plugin: alicloud_ecs regions: - cn-beijing alicloud_access_key: alicloud_access_key alicloud_secret_key: alicloud_secret_key hostnames: - public_ip_address keyed_groups: # add hosts to instance_type groups - prefix: instance_type key: instance_type # add hosts to instance_name groups - key: instance_name prefix: name cache: true cache_plugin: jsonfile cache_timeout: 7200 cache_connection: /tmp/alicloud_inventory cache_prefix: alicloud_ecs strict: true compose: ansible_host: public_ip_address","title":"\u914d\u7f6e\u63d2\u4ef6"},{"location":"advanced/dynamic-inventory/#_14","text":"ansible-inventory -i hosts_alicloud.yml --graph","title":"\u83b7\u53d6\u4e3b\u673a\u5217\u8868"},{"location":"advanced/dynamic-inventory/#_15","text":"ansible -i hosts_alicloud.yml tag_Env_test -m ping tag_Env_test \u662f\u5305\u542b Env:test \u6807\u7b7e\u7684\u4e3b\u673a\u7ec4\u3002\u4e3b\u673a\u8ba4\u8bc1\u53ef\u4f7f\u7528ssh\u5bc6\u94a5\u8ba4\u8bc1\uff0c\u6216\u8005\u5728 compose \u4e2d\u6307\u5b9a\u8fde\u63a5\u7528\u6237\u548c\u5bc6\u7801\u3002","title":"\u6267\u884c\u547d\u4ee4"},{"location":"advanced/dynamic-inventory/#inventory-cache_2","text":"\u5728\u6307\u5b9a\u4e86 cache: True \u65f6\uff0cInventory\u4fe1\u606f\u4f1a\u5b58\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5982\u679c\u60f3\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u4e24\u79cd\u65b9\u5f0f \u624b\u52a8\u7684\u5220\u9664\u7f13\u5b58\u4fe1\u606f, \u6bd4\u5982\u5220\u9664\u7f13\u5b58\u6587\u4ef6 rm -f /tmp/alicloud_inventory/alicloud_ecs* \u4f7f\u7528 ansible-playbook --flush-cache \u547d\u4ee4\u6765\u5237\u65b0","title":"\u5237\u65b0 Inventory  Cache"},{"location":"advanced/dynamic-inventory/#inventory_4","text":"\u76ee\u524d\u5df2\u4e0d\u5efa\u8bae\u4f7f\u7528 \u4f7f\u7528 ECS external inventory \u5916\u90e8\u811a\u672c\u6765\u83b7\u53d6AWS EC2\u4e3b\u673a\u7684\u4fe1\u606f\u3002","title":"\u4f7f\u7528 Inventory \u811a\u672c"},{"location":"advanced/dynamic-inventory/#_16","text":"wget https://raw.githubusercontent.com/alibaba/ansible-provider/2c9a81bf3d5d3f3e049e06479e1972e61b92c02c/contrib/inventory/alicloud.py wget https://raw.githubusercontent.com/alibaba/ansible-provider/2c9a81bf3d5d3f3e049e06479e1972e61b92c02c/contrib/inventory/alicloud.ini chmod +x alicloud.py \u811a\u672c\u53ea\u652f\u6301\u5728 python3 \u73af\u5883\u8fd0\u884c \u5982\u679c\u8981\u5728python2\u4e2d\u8fd0\u884c\uff0c\u9700\u5c06configparser\u5e93\u5f15\u7528\u4fee\u6b63\u4e0b import sys if sys.version_info[0] == 2: import ConfigParser as configparser else: import configparser","title":"\u4e0b\u8f7d\u811a\u672c"},{"location":"advanced/dynamic-inventory/#_17","text":"pip install configparser","title":"\u5b89\u88c5\u4f9d\u8d56"},{"location":"advanced/dynamic-inventory/#alicloudini","text":"[ecs] regions = all destination_variable = public_ip_address hostname_variable = instance_id all_instances = True cache_path = /tmp/alicloud_inventory/ cache_max_age = 7200 nested_groups = False replace_dash_in_groups = True expand_csv_tags = False group_by_instance_id = True group_by_region = True group_by_availability_zone = True group_by_image_id = True group_by_instance_type = True group_by_vpc_id = True group_by_vswitch_id = True group_by_security_group = True group_by_tag_keys = True group_by_tag_none = True [credentials] alicloud_access_key = alicloud_access_key alicloud_secret_key = alicloud_secret_key","title":"\u914d\u7f6ealicloud.ini"},{"location":"advanced/dynamic-inventory/#_18","text":"./alicloud.py --list","title":"\u83b7\u53d6\u4e3b\u673a\u5217\u8868"},{"location":"advanced/dynamic-inventory/#_19","text":"ansible -i alicloud.py tag_Env_test -m ping tag_Env_test \u662f\u5305\u542b Env:test \u6807\u7b7e\u7684\u4e3b\u673a\u7ec4\u3002\u4e3b\u673a\u8ba4\u8bc1\u53ef\u4f7f\u7528ssh\u5bc6\u94a5\u8ba4\u8bc1\uff0c\u6216\u8005\u5728 compose \u4e2d\u6307\u5b9a\u8fde\u63a5\u7528\u6237\u548c\u5bc6\u7801\u3002","title":"\u6267\u884c\u547d\u4ee4"},{"location":"advanced/dynamic-inventory/#inventory-cache_3","text":"\u5728\u6307\u5b9a\u4e86 cache: True \u65f6\uff0cInventory\u4fe1\u606f\u4f1a\u5b58\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5982\u679c\u60f3\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u4e09\u79cd\u65b9\u5f0f \u624b\u52a8\u7684\u5220\u9664\u7f13\u5b58\u4fe1\u606f, \u6bd4\u5982\u5220\u9664\u7f13\u5b58\u6587\u4ef6 rm -f /tmp/alicloud_inventory/* \u4f7f\u7528 ansible-playbook --flush-cache \u547d\u4ee4\u6765\u5237\u65b0s \u4f7f\u7528 ./alicloud.py --refresh-cache \u547d\u4ee4\u6765\u5237\u65b0","title":"\u5237\u65b0 Inventory  Cache"},{"location":"advanced/dynamic-inventory/#openstack","text":"","title":"OpenStack \u52a8\u6001\u6e05\u5355"},{"location":"advanced/dynamic-inventory/#inventory_5","text":"","title":"\u4f7f\u7528 Inventory \u63d2\u4ef6"},{"location":"advanced/dynamic-inventory/#_20","text":"\u65b0\u7248\u672c\u4e0d\u652f\u6301 python2 \u73af\u5883\u4e86\u3002 # python 2 pip install openstacksdk == 0 .39.0 # python 3 pip install openstacksdk","title":"\u5b89\u88c5\u4f9d\u8d56"},{"location":"advanced/dynamic-inventory/#_21","text":"\u5927\u591a\u6570\u968fAnsible\u81ea\u5e26\u7684\u63d2\u4ef6\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u7981\u7528\u7684\uff0c\u9700\u8981\u5728\u4f60\u7684 Ansible.cfg \u6587\u4ef6\u4e2d\u52a0\u5165\u767d\u540d\u5355\u624d\u80fd\u6b63\u5e38\u8fd0\u884c\u3002 [inventory] enable_plugins = host_list, script, auto, yaml, ini, toml, openstack","title":"\u5f00\u542f\u63d2\u4ef6"},{"location":"advanced/dynamic-inventory/#_22","text":"\u4f7f\u7528inventory\u63d2\u4ef6\u65f6\uff0c\u9700\u8981\u914d\u7f6e\u4e00\u4e2ayaml\u6587\u4ef6\u6765\u63cf\u8ff0\u4f7f\u7528\u7684\u63d2\u4ef6\u548c\u63d2\u4ef6\u9009\u9879\u3002\u4f8b\u5982 aws_ec2 inventory\u63d2\u4ef6\u5fc5\u987b\u4ee5 (openstack|cloud).(yml|yaml) \u7ed3\u5c3e\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u3002 plugin: openstack inventory_hostname: name private: yes fail_on_errors: yes expand_hostvars: yes cache: true cache_plugin: jsonfile cache_connection: /tmp/openstack-inventory cache_prefix: openstack_host keyed_groups: - prefix: '' key: openstack.metadata.vm_role compose: cloud: \"openstack\"","title":"\u914d\u7f6e\u63d2\u4ef6"},{"location":"advanced/dynamic-inventory/#source-openstack-rc","text":"\u53ef\u5728 OpenStack WEB\u7ba1\u7406\u754c\u9762\u4e0b\u8f7dRC\u6587\u4ef6 export OS_AUTH_URL = http://hosts:5000/v3/ # With the addition of Keystone we have standardized on the term **project** # as the entity that owns the resources. export OS_PROJECT_ID = OS_PROJECT_ID export OS_PROJECT_NAME = \"admin\" export OS_USER_DOMAIN_NAME = \"Default\" if [ -z \" $OS_USER_DOMAIN_NAME \" ] ; then unset OS_USER_DOMAIN_NAME ; fi export OS_PROJECT_DOMAIN_ID = \"default\" if [ -z \" $OS_PROJECT_DOMAIN_ID \" ] ; then unset OS_PROJECT_DOMAIN_ID ; fi export OS_USERNAME = \"admin\" read -sr OS_PASSWORD_INPUT export OS_PASSWORD = $OS_PASSWORD_INPUT export OS_REGION_NAME = \"RegionOne\" if [ -z \" $OS_REGION_NAME \" ] ; then unset OS_REGION_NAME ; fi export OS_INTERFACE = public export OS_IDENTITY_API_VERSION = 3","title":"Source OpenStack RC \u6587\u4ef6"},{"location":"advanced/dynamic-inventory/#_23","text":"ansible-inventory -i hosts_openstack.yml --graph","title":"\u83b7\u53d6\u4e3b\u673a\u5217\u8868"},{"location":"advanced/dynamic-inventory/#_24","text":"ansible -i hosts_openstack.yml zone1 -m ping","title":"\u6267\u884c\u547d\u4ee4"},{"location":"advanced/dynamic-inventory/#inventory-cache_4","text":"\u5728\u6307\u5b9a\u4e86 cache: True \u65f6\uff0cInventory\u4fe1\u606f\u4f1a\u5b58\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5982\u679c\u60f3\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u4e24\u79cd\u65b9\u5f0f \u624b\u52a8\u7684\u5220\u9664\u7f13\u5b58\u4fe1\u606f, \u6bd4\u5982\u5220\u9664\u7f13\u5b58\u6587\u4ef6 rm -f /tmp/openstack_inventory/* \u4f7f\u7528 ansible-playbook --flush-cache \u547d\u4ee4\u6765\u5237\u65b0","title":"\u5237\u65b0 Inventory  Cache"},{"location":"advanced/dynamic-inventory/#inventory_6","text":"\u76ee\u524d\u5df2\u4e0d\u5efa\u8bae\u4f7f\u7528 \u4f7f\u7528 ECS external inventory \u5916\u90e8\u811a\u672c\u6765\u83b7\u53d6AWS EC2\u4e3b\u673a\u7684\u4fe1\u606f\u3002","title":"\u4f7f\u7528 Inventory \u811a\u672c"},{"location":"advanced/dynamic-inventory/#_25","text":"wget https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/openstack_inventory.py wget https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/openstack.yml -O /etc/ansible/openstack.yml chmod +x openstack_inventory.py","title":"\u4e0b\u8f7d\u811a\u672c"},{"location":"advanced/dynamic-inventory/#_26","text":"# python 2 pip install openstacksdk == 0 .39.0 # python 3 pip install openstacksdk","title":"\u5b89\u88c5\u4f9d\u8d56"},{"location":"advanced/dynamic-inventory/#openstackyml","text":"\u914d\u7f6e\u6587\u4ef6\u9700\u653e\u7f6e\u5728 /etc/ansible/openstack.yml clouds : defaults : auth : auth_url : http://hosts:5000/v3/ password : password project_domain_id : default project_name : admin user_domain_id : default username : admin identity_api_version : '3' region_name : RegionOne volume_api_version : '2' ansible : use_hostnames : True expand_hostvars : False fail_on_errors : True","title":"\u914d\u7f6eopenstack.yml"},{"location":"advanced/dynamic-inventory/#_27","text":"./openstack_inventory.py --list","title":"\u83b7\u53d6\u4e3b\u673a\u5217\u8868"},{"location":"advanced/dynamic-inventory/#_28","text":"ansible -i openstack_inventory.py zone3 -m ping","title":"\u6267\u884c\u547d\u4ee4"},{"location":"advanced/dynamic-inventory/#inventory-cache_5","text":"\u5728\u6307\u5b9a\u4e86 cache: True \u65f6\uff0cInventory\u4fe1\u606f\u4f1a\u5b58\u5728\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5982\u679c\u60f3\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u4e09\u79cd\u65b9\u5f0f \u624b\u52a8\u7684\u5220\u9664\u7f13\u5b58\u4fe1\u606f, \u6bd4\u5982\u5220\u9664\u7f13\u5b58\u6587\u4ef6 rm -f ~/.cache/openstack/ansible-inventory.cache* \u4f7f\u7528 ansible-playbook --flush-cache \u547d\u4ee4\u6765\u5237\u65b0s \u4f7f\u7528 ./openstack_inventory.py --refresh-cache \u547d\u4ee4\u6765\u5237\u65b0","title":"\u5237\u65b0 Inventory  Cache"},{"location":"advanced/optimization/","text":"Ansible \u4f18\u5316 \u00b6 Ansible \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6ca1\u6709\u505a\u4efb\u4f55\u7684\u4f18\u5316\u3002\u901a\u8fc7\u4e0b\u5217\u7684\u51e0\u79cd\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5728\u6267\u884c\u6548\u7387\uff0c\u65f6\u95f4\u4e0a\u505a\u8fdb\u4e00\u6b65\u7684\u4f18\u5316\u3002 Profile_tasks \u00b6 \u5f00\u542fAnsible\u4efb\u52a1\u7684\u6267\u884c\u65f6\u95f4, \u53ef\u6709\u52a9\u4e8e\u6211\u4eec\u4e86\u89e3playbook\u4e2d\u7684task\u4efb\u52a1\u6267\u884c\u65f6\u95f4\uff0c\u4ee5\u4fbf\u4e8e\u540e\u7eed\u4f18\u5316\u3002 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [defaults] callback_whitelist = timer, profile_tasks Fork \u00b6 Ansible \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5e76\u884c\u6267\u884c\u7684\u6570\u91cf\u662f 5 \uff0c\u5bf9\u4e8e\u8f83\u591a\u7684\u8282\u70b9\uff0c\u5c31\u9700\u8981\u6269\u5927\u8fd9\u4e2a\u5e76\u884c\u6570\u91cf\u3002 Fork \u6570\u91cf\u8d8a\u5927\u5bf9\u63a7\u5236\u8282\u70b9\u7684cpu\u6d88\u8017\u8d8a\u9ad8\u3002 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [defaults] forks = 20 Poll_interval \u00b6 \u964d\u4f4e\u8f6e\u8be2\u95f4\u9694\u65f6\u95f4\uff0c\u6709\u52a9\u4e8e\u52a0\u5feb\u83b7\u53d6\u4efb\u52a1\u7ed3\u679c\u3002 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [defaults] poll_interval = 1 internal_poll_interval = 0.001 Fact cache \u00b6 \u5c06 Facts \u4fe1\u606f\u7b2c\u4e00\u6b21\u6536\u96c6\u540e\u7f13\u5b58\u5230memory\u6216\u8005redis\u6216\u8005\u6587\u4ef6\u4e2d\uff0c\u4ece\u800c\u4e3a\u540e\u7eed\u6267\u884c\u51cf\u5c11\u6536\u96c6\u65f6\u95f4\u3002 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [defaults] fact_caching = jsonfile fact_caching_connection = /tmp/.ansible_fact_cache Gather_subset \u00b6 \u53ef\u9009\u62e9\u6027\u7684\u6536\u96c6network,hardware\u7b49\u4fe1\u606f\uff0c\u800c\u4e0d\u662f\u5168\u90e8 \u5728 ansible.cfg \u4e2d\u914d\u7f6e # \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d,\u6392\u9664\u6536\u96c6 [defaults] gather_subset = !hardware \u4e5f\u53ef\u4ee5\u5728\u5728play\u4e2d\u5b9a\u4e49 # \u4e0d\u6536\u96c6\u6570\u636e - hosts : whatever gather_facts : no # \u53ea\u6536\u96c6minimal - hosts : all gather_facts : False pre_tasks : - setup : gather_subset : - '!all' SSH \u8fde\u63a5\u53c2\u6570 \u00b6 \u589e\u52a0control_path\u7684\u4f7f\u7528\u65f6\u95f4 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [ssh_connection] ssh_args = -o ControlMaster=auto -o ControlPersist=1800s \u9ed8\u8ba4ssh\u7684\u8ba4\u8bc1\u65b9\u5f0f\u4f1a\u6709 -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey , \u5982\u679c\u53ea\u6709publickey\u4e00\u79cd\u65b9\u5f0f\u8ba4\u8bc1\uff0c\u53ef\u4ee5\u53ea\u6307\u5b9apublickey -o PreferredAuthentications=publickey Control_path \u00b6 \u5f00\u542fssh socket\u6301\u4e45\u5316\uff0c\u590d\u7528ssh\u8fde\u63a5\u3002 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [ssh_connection] control_path = %(directory)s/ansible-ssh-%%h-%%p-%%r Pipelinling \u00b6 \u5f00\u542fssh pipelining,\u5ba2\u6237\u7aef\u4ece\u7ba1\u9053\u4e2d\u8bfb\u53d6\u6267\u884c\u6e32\u67d3\u540e\u7684\u811a\u672c\uff0c\u800c\u4e0d\u662f\u5728\u5ba2\u6237\u7aef\u521b\u5efa\u4e34\u65f6\u6587\u4ef6\u3002 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [ssh_connection] pipelining = True Serial \u00b6 \u5c06play_hosts\u4e2d\u4e3b\u673a\u518d\u5206\u6279\u6267\u884c,\u964d\u4f4e\u63a7\u5236\u673a\u7684cpu\u4f7f\u7528 - hosts : whatever serial\uff1a50% Strategy \u00b6 \u9ed8\u8ba4linear,\u6bcf\u4e2a\u4e3b\u673a\u7684\u5355\u4e2atask\u6267\u884c\u5b8c\u6210\u4f1a\u7b49\u5f85\u5176\u4ed6\u90fd\u5b8c\u6210\u540e\u518d\u6267\u884c\u4e0b\u4e2a\u4efb\u52a1\uff0c\u8bbe\u7f6efree\u53ef\u4e0d\u7b49\u5f85\u5176\u4ed6\u4e3b\u673a\u3002 - hosts : web-servers strategy : linear mitogen strategy \u63d2\u4ef6 \u00b6 \u63d0\u9ad8ansible\u7684\u6267\u884c\u6548\u7387\uff0c\u6bd4\u539f\u751f\u6267\u884c\u901f\u5ea6\u63d0\u9ad81.25x-7x\uff0cCPU\u51cf\u5c112\u500d\u7684\u4f7f\u7528\u3002 \u4e0b\u8f7d wget https://networkgenomics.com/try/mitogen-0.2.9.tar.gz tar zxf mitogen-0.2.9.tar.gz /path/to/ \u5728 ansible.cfg \u4e2d\u914d\u7f6e [defaults] strategy_plugins = /path/to/mitogen-0.2.9/ansible_mitogen/plugins/strategy strategy = mitogen_linear \u4e5f\u53ef\u5728play\u4e2d\u8bbe\u7f6e - hosts : web-servers strategy : mitogen_linear \u6267\u884c ANSIBLE_STRATEGY_PLUGINS = /path/to/mitogen-0.2.9/ansible_mitogen/plugins/strategy ansible-playbook test.yaml \u66f4\u591a\u5185\u5bb9\u89c1 mitogen\u4ecb\u7ecd","title":"Ansible \u4f18\u5316"},{"location":"advanced/optimization/#ansible","text":"Ansible \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6ca1\u6709\u505a\u4efb\u4f55\u7684\u4f18\u5316\u3002\u901a\u8fc7\u4e0b\u5217\u7684\u51e0\u79cd\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5728\u6267\u884c\u6548\u7387\uff0c\u65f6\u95f4\u4e0a\u505a\u8fdb\u4e00\u6b65\u7684\u4f18\u5316\u3002","title":"Ansible \u4f18\u5316"},{"location":"advanced/optimization/#profile_tasks","text":"\u5f00\u542fAnsible\u4efb\u52a1\u7684\u6267\u884c\u65f6\u95f4, \u53ef\u6709\u52a9\u4e8e\u6211\u4eec\u4e86\u89e3playbook\u4e2d\u7684task\u4efb\u52a1\u6267\u884c\u65f6\u95f4\uff0c\u4ee5\u4fbf\u4e8e\u540e\u7eed\u4f18\u5316\u3002 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [defaults] callback_whitelist = timer, profile_tasks","title":"Profile_tasks"},{"location":"advanced/optimization/#fork","text":"Ansible \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5e76\u884c\u6267\u884c\u7684\u6570\u91cf\u662f 5 \uff0c\u5bf9\u4e8e\u8f83\u591a\u7684\u8282\u70b9\uff0c\u5c31\u9700\u8981\u6269\u5927\u8fd9\u4e2a\u5e76\u884c\u6570\u91cf\u3002 Fork \u6570\u91cf\u8d8a\u5927\u5bf9\u63a7\u5236\u8282\u70b9\u7684cpu\u6d88\u8017\u8d8a\u9ad8\u3002 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [defaults] forks = 20","title":"Fork"},{"location":"advanced/optimization/#poll_interval","text":"\u964d\u4f4e\u8f6e\u8be2\u95f4\u9694\u65f6\u95f4\uff0c\u6709\u52a9\u4e8e\u52a0\u5feb\u83b7\u53d6\u4efb\u52a1\u7ed3\u679c\u3002 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [defaults] poll_interval = 1 internal_poll_interval = 0.001","title":"Poll_interval"},{"location":"advanced/optimization/#fact-cache","text":"\u5c06 Facts \u4fe1\u606f\u7b2c\u4e00\u6b21\u6536\u96c6\u540e\u7f13\u5b58\u5230memory\u6216\u8005redis\u6216\u8005\u6587\u4ef6\u4e2d\uff0c\u4ece\u800c\u4e3a\u540e\u7eed\u6267\u884c\u51cf\u5c11\u6536\u96c6\u65f6\u95f4\u3002 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [defaults] fact_caching = jsonfile fact_caching_connection = /tmp/.ansible_fact_cache","title":"Fact cache"},{"location":"advanced/optimization/#gather_subset","text":"\u53ef\u9009\u62e9\u6027\u7684\u6536\u96c6network,hardware\u7b49\u4fe1\u606f\uff0c\u800c\u4e0d\u662f\u5168\u90e8 \u5728 ansible.cfg \u4e2d\u914d\u7f6e # \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d,\u6392\u9664\u6536\u96c6 [defaults] gather_subset = !hardware \u4e5f\u53ef\u4ee5\u5728\u5728play\u4e2d\u5b9a\u4e49 # \u4e0d\u6536\u96c6\u6570\u636e - hosts : whatever gather_facts : no # \u53ea\u6536\u96c6minimal - hosts : all gather_facts : False pre_tasks : - setup : gather_subset : - '!all'","title":"Gather_subset"},{"location":"advanced/optimization/#ssh","text":"\u589e\u52a0control_path\u7684\u4f7f\u7528\u65f6\u95f4 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [ssh_connection] ssh_args = -o ControlMaster=auto -o ControlPersist=1800s \u9ed8\u8ba4ssh\u7684\u8ba4\u8bc1\u65b9\u5f0f\u4f1a\u6709 -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey , \u5982\u679c\u53ea\u6709publickey\u4e00\u79cd\u65b9\u5f0f\u8ba4\u8bc1\uff0c\u53ef\u4ee5\u53ea\u6307\u5b9apublickey -o PreferredAuthentications=publickey","title":"SSH \u8fde\u63a5\u53c2\u6570"},{"location":"advanced/optimization/#control_path","text":"\u5f00\u542fssh socket\u6301\u4e45\u5316\uff0c\u590d\u7528ssh\u8fde\u63a5\u3002 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [ssh_connection] control_path = %(directory)s/ansible-ssh-%%h-%%p-%%r","title":"Control_path"},{"location":"advanced/optimization/#pipelinling","text":"\u5f00\u542fssh pipelining,\u5ba2\u6237\u7aef\u4ece\u7ba1\u9053\u4e2d\u8bfb\u53d6\u6267\u884c\u6e32\u67d3\u540e\u7684\u811a\u672c\uff0c\u800c\u4e0d\u662f\u5728\u5ba2\u6237\u7aef\u521b\u5efa\u4e34\u65f6\u6587\u4ef6\u3002 \u5728 ansible.cfg \u4e2d\u914d\u7f6e [ssh_connection] pipelining = True","title":"Pipelinling"},{"location":"advanced/optimization/#serial","text":"\u5c06play_hosts\u4e2d\u4e3b\u673a\u518d\u5206\u6279\u6267\u884c,\u964d\u4f4e\u63a7\u5236\u673a\u7684cpu\u4f7f\u7528 - hosts : whatever serial\uff1a50%","title":"Serial"},{"location":"advanced/optimization/#strategy","text":"\u9ed8\u8ba4linear,\u6bcf\u4e2a\u4e3b\u673a\u7684\u5355\u4e2atask\u6267\u884c\u5b8c\u6210\u4f1a\u7b49\u5f85\u5176\u4ed6\u90fd\u5b8c\u6210\u540e\u518d\u6267\u884c\u4e0b\u4e2a\u4efb\u52a1\uff0c\u8bbe\u7f6efree\u53ef\u4e0d\u7b49\u5f85\u5176\u4ed6\u4e3b\u673a\u3002 - hosts : web-servers strategy : linear","title":"Strategy"},{"location":"advanced/optimization/#mitogen-strategy","text":"\u63d0\u9ad8ansible\u7684\u6267\u884c\u6548\u7387\uff0c\u6bd4\u539f\u751f\u6267\u884c\u901f\u5ea6\u63d0\u9ad81.25x-7x\uff0cCPU\u51cf\u5c112\u500d\u7684\u4f7f\u7528\u3002 \u4e0b\u8f7d wget https://networkgenomics.com/try/mitogen-0.2.9.tar.gz tar zxf mitogen-0.2.9.tar.gz /path/to/ \u5728 ansible.cfg \u4e2d\u914d\u7f6e [defaults] strategy_plugins = /path/to/mitogen-0.2.9/ansible_mitogen/plugins/strategy strategy = mitogen_linear \u4e5f\u53ef\u5728play\u4e2d\u8bbe\u7f6e - hosts : web-servers strategy : mitogen_linear \u6267\u884c ANSIBLE_STRATEGY_PLUGINS = /path/to/mitogen-0.2.9/ansible_mitogen/plugins/strategy ansible-playbook test.yaml \u66f4\u591a\u5185\u5bb9\u89c1 mitogen\u4ecb\u7ecd","title":"mitogen strategy \u63d2\u4ef6"},{"location":"advanced/practice/jenkins-and-ansible/","text":"\u5728 Jenkins \u4e2d\u4f7f\u7528 Ansible \u00b6 \u5728 Jenkins \u4e2d\u4f7f\u7528 Ansible \u547d\u4ee4\uff0c\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a \u4f7f\u7528 shell \u6267\u884cansible\u547d\u4ee4 \u4f7f\u7528 ansible \u63d2\u4ef6\u6267\u884cansible\u547d\u4ee4 \u672c\u8282\u5c06\u4ecb\u7ecd ansible \u63d2\u4ef6\u7684\u4f7f\u7528\u65b9\u6cd5 \u8282\u70b9\u64cd\u4f5c \u00b6 \u4ee5 centos7 \u7cfb\u7edf\u4e3a\u4f8b \u5b89\u88c5 jenkins sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat/jenkins.repo sudo rpm --import https://pkg.jenkins.io/redhat/jenkins.io.key yum install -y java-1.8.0-openjdk jenkins systemctl enable jenkins systemctl start jenkins \u5b89\u88c5 ansible yum -y install ansible \u914d\u7f6e ansible #\u3000/etc/ansible/ansible.cfg [defaults] # Set the log_path log_path = ~/ansible.log # Additional default options for Ansible forks = 20 host_key_checking = False retry_files_enabled = False retry_files_save_path = ~/ansible-installer-retries nocows = True remote_user = root roles_path = /etc/ansible/roles/ gathering = smart fact_caching = jsonfile fact_caching_connection = $HOME/ansible/facts fact_caching_timeout = 600 callback_whitelist = profile_tasks inventory_ignore_extensions = secrets.py, .pyc, .cfg, .crt, .ini # work around privilege escalation timeouts in ansible: timeout = 30 # Uncomment to use the provided example inventory #inventory = inventory/hosts.example [inventory] # fail more helpfully when the inventory file does not parse (Ansible 2.4+) unparsed_is_failed = true # Additional ssh options for OpenShift Ansible [ssh_connection] retries = 15 pipelining = True ssh_args = -o ControlMaster=auto -o ControlPersist=600s timeout = 10 # shorten the ControlPath which is often too long; when it is, # ssh connection reuse silently fails, making everything slower. control_path = %(directory)s/%%h-%%r Jenkins \u64cd\u4f5c \u00b6 \u83b7\u53d6\u521d\u59cb\u5bc6\u7801 # cat /var/lib/jenkins/secrets/initialAdminPassword b3da24e53afd46b9962aebd6b8409d6d \u8bbf\u95eeWEB\u9875\u9762 http://192.168.77.131:8080/ ,\u8f93\u5165\u521d\u59cb\u5bc6\u7801\u540e\uff0c\u5b89\u88c5\u5e38\u7528\u63d2\u4ef6\u3002 \u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u8fdb\u5165jenkins\u7ba1\u7406\u754c\u9762\uff0c\u5b89\u88c5ansible\u63d2\u4ef6 \u5728 \"Manage Jenkins\" => \"Manage Plugins\" ==> \"\u53ef\u9009\u63d2\u4ef6\" \u754c\u9762\uff0c\u8f93\u5165 ansible \u7b5b\u9009\u63d2\u4ef6\uff0c\u9009\u4e2d Ansible \u63d2\u4ef6\u540e\uff0c\u76f4\u63a5\u5b89\u88c5\u5373\u53ef\u3002 4. \u8bbe\u7f6eansible\u5de5\u5177 \u5728 \"Manage Jenkins\" => \"Global Tool Configuration\" => \"Ansible\" \u9009\u9879\u4e2d\uff0c\u8bbe\u7f6eansible\u7684\u6267\u884c\u8def\u5f84 \u4e0d\u8bbe\u7f6e\u7684\u8bdd\uff0c\u4f1a\u9009\u53d6\u7cfb\u7edf\u7684\u53ef\u6267\u884c\u8def\u5f84 Ansible \u4efb\u52a1 \u00b6 \u6267\u884c ad-hoc \u00b6 \u521b\u5efa\u4e00\u4e2afreestyle\u7c7b\u578b\u7684\u4efb\u52a1 \u5728\u4efb\u52a1\u4e2d\u7684\u6784\u5efa\u9636\u6bb5\uff0c\u9009\u62e9\u4f7f\u7528 Invoke Ansible Ad-Hoc Command \u8bbe\u7f6e\u5b8c\u540e\uff0c\u8fd0\u884c\u4efb\u52a1\u5373\u53ef\u3002 Started by user admin Running as SYSTEM Building in workspace /var/lib/jenkins/workspace/test_ansible [test_ansible] $ /usr/bin/ansible all -i /tmp/inventory1167656924170839709.ini -m ping -f 5 192.168.77.131 | SUCCESS => { \"changed\": false, \"ping\": \"pong\" } Finished: SUCCESS \u989c\u8272\u8f93\u51fa\u9700\u8981\u5b89\u88c5 AnsiColor \u63d2\u4ef6\u663e\u793a\uff0c\u5e76\u5728\u4efb\u52a1\u4e2d\u9009\u4e2d\"Color ANSI Console Output\"\u9009\u9879\uff0c\u4ee5\u4fbf\u5f00\u542f\u989c\u8272\u8f93\u51fa Note \u6ce8\u610f: \u6b64\u65f6\u8fd0\u884cansible\u547d\u4ee4\u7684\u7528\u6237\u662f jenkins\u8fd0\u884c\u7528\u6237 \u3002 \u6267\u884c playbook \u00b6 \u521b\u5efa\u4e00\u4e2afreestyle\u7c7b\u578b\u7684\u4efb\u52a1 \u5728\u4efb\u52a1\u4e2d\u7684\u6784\u5efa\u9636\u6bb5\uff0c\u9009\u62e9\u4f7f\u7528 Invoke Ansible Playbook # /etc/ansible/hosts 192.168.77.131 ansible_ssh_user=root ansible_ssh_pass=123456 # /etc/ansible/test.yml --- - hosts: 192.168.77.131 gather_facts: no tasks: - name: ping ping: - name: Jenkins Environment Variables debug: msg: \"{{ lookup('env','BUILD_TAG') }}\" \u8bbe\u7f6e\u5b8c\u540e\uff0c\u8fd0\u884c\u4efb\u52a1\u5373\u53ef\u3002 Started by user admin Running as SYSTEM Building in workspace /var/lib/jenkins/workspace/ansible_playbook [ansible_playbook] $ /usr/bin/ansible-playbook /etc/ansible/test.yml -i /etc/ansible/hosts -l all -f 5 PLAY [192.168.77.131] ********************************************************** TASK [ping] ******************************************************************** Monday 20 April 2020 18:16:35 +0800 (0:00:00.055) 0:00:00.055 ********** ok: [192.168.77.131] TASK [Jenkins Environment Variables] ******************************************* Monday 20 April 2020 18:16:36 +0800 (0:00:00.740) 0:00:00.796 ********** ok: [192.168.77.131] => { \"msg\": \"jenkins-ansible_playbook-1\" } PLAY RECAP ********************************************************************* 192.168.77.131 : ok=2 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 Monday 20 April 2020 18:16:36 +0800 (0:00:00.184) 0:00:00.980 ********** =============================================================================== ping -------------------------------------------------------------------- 0.74s Jenkins Environment Variables ------------------------------------------- 0.18s Finished: SUCCESS Pipeline \u4f7f\u7528 pipeline { agent any stages { stage('build') { steps { sh 'touch .ansible' ansiColor('xterm') { ansiblePlaybook( installation: 'Ansible', playbook: '/etc/ansible/test.yml', inventory: '/etc/ansible/hosts', limit: 'all', forks: 5, becomeUser: null, sudoUser: null, colorized: true) } } } } } sh 'touch .ansible' \u662f\u4e3a\u4e86\u8ba9job\u521b\u5efa\u5de5\u4f5c\u7a7a\u95f4\uff0c\u5982\u679c\u6ca1\u6709\u6587\u4ef6\u53d8\u52a8\u7684\u8bdd\uff0cjob\u662f\u4e0d\u521b\u5efa\u5de5\u4f5c\u7a7a\u95f4\u7684\u3002 job\u8f93\u51fa Started by user admin Running in Durability level: MAX_SURVIVABILITY [Pipeline] Start of Pipeline [Pipeline] node Running on Jenkins in /var/lib/jenkins/workspace/ansible_pipe [Pipeline] { [Pipeline] stage [Pipeline] { (build) [Pipeline] sh + touch .ansible [Pipeline] ansiColor [Pipeline] { [Pipeline] ansiblePlaybook [ansible_pipe] $ /usr/bin/ansible-playbook /etc/ansible/test.yml -i /etc/ansible/hosts -l all -f 1 PLAY [192.168.77.131] ********************************************************** TASK [ping] ******************************************************************** Monday 20 April 2020 18:25:49 +0800 (0:00:00.041) 0:00:00.041 ********** ok: [192.168.77.131] TASK [Jenkins Environment Variables] ******************************************* Monday 20 April 2020 18:25:50 +0800 (0:00:01.036) 0:00:01.078 ********** ok: [192.168.77.131] => { \"msg\": \"jenkins-ansible_pipe-5\" } PLAY RECAP ********************************************************************* 192.168.77.131 : ok=2 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 Monday 20 April 2020 18:25:50 +0800 (0:00:00.057) 0:00:01.136 ********** =============================================================================== ping -------------------------------------------------------------------- 1.04s Jenkins Environment Variables ------------------------------------------- 0.06s [Pipeline] } [Pipeline] // ansiColor [Pipeline] } [Pipeline] // stage [Pipeline] } [Pipeline] // node [Pipeline] End of Pipeline Finished: SUCCESS","title":"\u5728 Jenkins \u4e2d\u4f7f\u7528 Ansible"},{"location":"advanced/practice/jenkins-and-ansible/#jenkins-ansible","text":"\u5728 Jenkins \u4e2d\u4f7f\u7528 Ansible \u547d\u4ee4\uff0c\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a \u4f7f\u7528 shell \u6267\u884cansible\u547d\u4ee4 \u4f7f\u7528 ansible \u63d2\u4ef6\u6267\u884cansible\u547d\u4ee4 \u672c\u8282\u5c06\u4ecb\u7ecd ansible \u63d2\u4ef6\u7684\u4f7f\u7528\u65b9\u6cd5","title":"\u5728 Jenkins \u4e2d\u4f7f\u7528 Ansible"},{"location":"advanced/practice/jenkins-and-ansible/#_1","text":"\u4ee5 centos7 \u7cfb\u7edf\u4e3a\u4f8b \u5b89\u88c5 jenkins sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat/jenkins.repo sudo rpm --import https://pkg.jenkins.io/redhat/jenkins.io.key yum install -y java-1.8.0-openjdk jenkins systemctl enable jenkins systemctl start jenkins \u5b89\u88c5 ansible yum -y install ansible \u914d\u7f6e ansible #\u3000/etc/ansible/ansible.cfg [defaults] # Set the log_path log_path = ~/ansible.log # Additional default options for Ansible forks = 20 host_key_checking = False retry_files_enabled = False retry_files_save_path = ~/ansible-installer-retries nocows = True remote_user = root roles_path = /etc/ansible/roles/ gathering = smart fact_caching = jsonfile fact_caching_connection = $HOME/ansible/facts fact_caching_timeout = 600 callback_whitelist = profile_tasks inventory_ignore_extensions = secrets.py, .pyc, .cfg, .crt, .ini # work around privilege escalation timeouts in ansible: timeout = 30 # Uncomment to use the provided example inventory #inventory = inventory/hosts.example [inventory] # fail more helpfully when the inventory file does not parse (Ansible 2.4+) unparsed_is_failed = true # Additional ssh options for OpenShift Ansible [ssh_connection] retries = 15 pipelining = True ssh_args = -o ControlMaster=auto -o ControlPersist=600s timeout = 10 # shorten the ControlPath which is often too long; when it is, # ssh connection reuse silently fails, making everything slower. control_path = %(directory)s/%%h-%%r","title":"\u8282\u70b9\u64cd\u4f5c"},{"location":"advanced/practice/jenkins-and-ansible/#jenkins","text":"\u83b7\u53d6\u521d\u59cb\u5bc6\u7801 # cat /var/lib/jenkins/secrets/initialAdminPassword b3da24e53afd46b9962aebd6b8409d6d \u8bbf\u95eeWEB\u9875\u9762 http://192.168.77.131:8080/ ,\u8f93\u5165\u521d\u59cb\u5bc6\u7801\u540e\uff0c\u5b89\u88c5\u5e38\u7528\u63d2\u4ef6\u3002 \u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u8fdb\u5165jenkins\u7ba1\u7406\u754c\u9762\uff0c\u5b89\u88c5ansible\u63d2\u4ef6 \u5728 \"Manage Jenkins\" => \"Manage Plugins\" ==> \"\u53ef\u9009\u63d2\u4ef6\" \u754c\u9762\uff0c\u8f93\u5165 ansible \u7b5b\u9009\u63d2\u4ef6\uff0c\u9009\u4e2d Ansible \u63d2\u4ef6\u540e\uff0c\u76f4\u63a5\u5b89\u88c5\u5373\u53ef\u3002 4. \u8bbe\u7f6eansible\u5de5\u5177 \u5728 \"Manage Jenkins\" => \"Global Tool Configuration\" => \"Ansible\" \u9009\u9879\u4e2d\uff0c\u8bbe\u7f6eansible\u7684\u6267\u884c\u8def\u5f84 \u4e0d\u8bbe\u7f6e\u7684\u8bdd\uff0c\u4f1a\u9009\u53d6\u7cfb\u7edf\u7684\u53ef\u6267\u884c\u8def\u5f84","title":"Jenkins \u64cd\u4f5c"},{"location":"advanced/practice/jenkins-and-ansible/#ansible","text":"","title":"Ansible \u4efb\u52a1"},{"location":"advanced/practice/jenkins-and-ansible/#ad-hoc","text":"\u521b\u5efa\u4e00\u4e2afreestyle\u7c7b\u578b\u7684\u4efb\u52a1 \u5728\u4efb\u52a1\u4e2d\u7684\u6784\u5efa\u9636\u6bb5\uff0c\u9009\u62e9\u4f7f\u7528 Invoke Ansible Ad-Hoc Command \u8bbe\u7f6e\u5b8c\u540e\uff0c\u8fd0\u884c\u4efb\u52a1\u5373\u53ef\u3002 Started by user admin Running as SYSTEM Building in workspace /var/lib/jenkins/workspace/test_ansible [test_ansible] $ /usr/bin/ansible all -i /tmp/inventory1167656924170839709.ini -m ping -f 5 192.168.77.131 | SUCCESS => { \"changed\": false, \"ping\": \"pong\" } Finished: SUCCESS \u989c\u8272\u8f93\u51fa\u9700\u8981\u5b89\u88c5 AnsiColor \u63d2\u4ef6\u663e\u793a\uff0c\u5e76\u5728\u4efb\u52a1\u4e2d\u9009\u4e2d\"Color ANSI Console Output\"\u9009\u9879\uff0c\u4ee5\u4fbf\u5f00\u542f\u989c\u8272\u8f93\u51fa Note \u6ce8\u610f: \u6b64\u65f6\u8fd0\u884cansible\u547d\u4ee4\u7684\u7528\u6237\u662f jenkins\u8fd0\u884c\u7528\u6237 \u3002","title":"\u6267\u884c ad-hoc"},{"location":"advanced/practice/jenkins-and-ansible/#playbook","text":"\u521b\u5efa\u4e00\u4e2afreestyle\u7c7b\u578b\u7684\u4efb\u52a1 \u5728\u4efb\u52a1\u4e2d\u7684\u6784\u5efa\u9636\u6bb5\uff0c\u9009\u62e9\u4f7f\u7528 Invoke Ansible Playbook # /etc/ansible/hosts 192.168.77.131 ansible_ssh_user=root ansible_ssh_pass=123456 # /etc/ansible/test.yml --- - hosts: 192.168.77.131 gather_facts: no tasks: - name: ping ping: - name: Jenkins Environment Variables debug: msg: \"{{ lookup('env','BUILD_TAG') }}\" \u8bbe\u7f6e\u5b8c\u540e\uff0c\u8fd0\u884c\u4efb\u52a1\u5373\u53ef\u3002 Started by user admin Running as SYSTEM Building in workspace /var/lib/jenkins/workspace/ansible_playbook [ansible_playbook] $ /usr/bin/ansible-playbook /etc/ansible/test.yml -i /etc/ansible/hosts -l all -f 5 PLAY [192.168.77.131] ********************************************************** TASK [ping] ******************************************************************** Monday 20 April 2020 18:16:35 +0800 (0:00:00.055) 0:00:00.055 ********** ok: [192.168.77.131] TASK [Jenkins Environment Variables] ******************************************* Monday 20 April 2020 18:16:36 +0800 (0:00:00.740) 0:00:00.796 ********** ok: [192.168.77.131] => { \"msg\": \"jenkins-ansible_playbook-1\" } PLAY RECAP ********************************************************************* 192.168.77.131 : ok=2 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 Monday 20 April 2020 18:16:36 +0800 (0:00:00.184) 0:00:00.980 ********** =============================================================================== ping -------------------------------------------------------------------- 0.74s Jenkins Environment Variables ------------------------------------------- 0.18s Finished: SUCCESS Pipeline \u4f7f\u7528 pipeline { agent any stages { stage('build') { steps { sh 'touch .ansible' ansiColor('xterm') { ansiblePlaybook( installation: 'Ansible', playbook: '/etc/ansible/test.yml', inventory: '/etc/ansible/hosts', limit: 'all', forks: 5, becomeUser: null, sudoUser: null, colorized: true) } } } } } sh 'touch .ansible' \u662f\u4e3a\u4e86\u8ba9job\u521b\u5efa\u5de5\u4f5c\u7a7a\u95f4\uff0c\u5982\u679c\u6ca1\u6709\u6587\u4ef6\u53d8\u52a8\u7684\u8bdd\uff0cjob\u662f\u4e0d\u521b\u5efa\u5de5\u4f5c\u7a7a\u95f4\u7684\u3002 job\u8f93\u51fa Started by user admin Running in Durability level: MAX_SURVIVABILITY [Pipeline] Start of Pipeline [Pipeline] node Running on Jenkins in /var/lib/jenkins/workspace/ansible_pipe [Pipeline] { [Pipeline] stage [Pipeline] { (build) [Pipeline] sh + touch .ansible [Pipeline] ansiColor [Pipeline] { [Pipeline] ansiblePlaybook [ansible_pipe] $ /usr/bin/ansible-playbook /etc/ansible/test.yml -i /etc/ansible/hosts -l all -f 1 PLAY [192.168.77.131] ********************************************************** TASK [ping] ******************************************************************** Monday 20 April 2020 18:25:49 +0800 (0:00:00.041) 0:00:00.041 ********** ok: [192.168.77.131] TASK [Jenkins Environment Variables] ******************************************* Monday 20 April 2020 18:25:50 +0800 (0:00:01.036) 0:00:01.078 ********** ok: [192.168.77.131] => { \"msg\": \"jenkins-ansible_pipe-5\" } PLAY RECAP ********************************************************************* 192.168.77.131 : ok=2 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 Monday 20 April 2020 18:25:50 +0800 (0:00:00.057) 0:00:01.136 ********** =============================================================================== ping -------------------------------------------------------------------- 1.04s Jenkins Environment Variables ------------------------------------------- 0.06s [Pipeline] } [Pipeline] // ansiColor [Pipeline] } [Pipeline] // stage [Pipeline] } [Pipeline] // node [Pipeline] End of Pipeline Finished: SUCCESS","title":"\u6267\u884c playbook"},{"location":"advanced/practice/snippets/","text":"Ansible Task \u7247\u6bb5 \u00b6 \u600e\u4e48\u4e3a\u4efb\u52a1\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf \u00b6 - name : set environment shell : echo $PATH $SOME >> /tmp/a.txt environment : PATH : '{{ ansible_env.PATH }}:/thingy/bin' SOME : value \u4e0d\u540c\u7684\u7528\u6237\u767b\u5f55\u4e0d\u540c\u7684\u4e3b\u673a \u00b6 \u5728\u4e3b\u673a\u6e05\u5355\u91cc\u8bbe\u7f6e [webservers] asdf.example.com ansible_port=5000 ansible_user=alice ansible_pass=123456 jkl.example.com ansible_port=5001 ansible_user=bob ansible_pass=654321 \u4e5f\u53ef\u4ee5\u6307\u5b9a\u8fde\u63a5\u7c7b\u578b [testcluster] localhost ansible_connection=local /path/to/chroot1 ansible_connection=chroot foo.example.com bar.example.com \u901a\u8fc7\u8df3\u8f6c\u4e3b\u673a\u8bbf\u95ee\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a \u00b6 # ansible \u514d\u5bc6\u767b\u5f55\u8df3\u677f\u673a ansible_ssh_common_args: '-o ProxyCommand=\"ssh -W %h:%p -q user@gateway.example.com\"' ansible_ssh_common_args: '-o ProxyCommand=\"sshpass -f /etc/tpasswd ssh xx@10.10.10.1 -p 66677 nc %h %p\"' ansible_ssh_common_args=\"-o ProxyCommand='ssh -W %h:%p -q -p 20343 root@11.11.11.11'\" ansible_ssh_common_args=\"-o ProxyCommand=\\\"ssh -qay -p 20343 root@11.11.11.11 'nc %h %p'\\\"\" ansible_ssh_common_args=\"-o ProxyCommand=\\\"sshpass -p '123456' ssh -qay -p 20343 root@11.11.11.11 'nc %h %p'\\\"\" # \u8df3\u677f\u673asshd\u914d\u7f6e MaxStartups 1000 LoginGraceTime 0 # ansible.cfg timeout = 60 ssh_args=-C -o ControlMaster=auto -o ControlPersist=5m -F /etc/ansible/prod/ssh_config retries = 1 #\u3000ssh_config Host 47.111.162.118 User root Hostname 47.111.162.118 ProxyCommand none BatchMode yes Host 172.16.99.* User root ServerAliveInterval 60 TCPKeepAlive yes ProxyCommand ssh -qaY -p 20343 root@47.111.162.118 nc %h %p ForwardAgent yes \u5173\u95ed cowsay \u529f\u80fd \u00b6 export ANSIBLE_NOCOWS=1 \u5173\u95ed ssh \u5728\u9996\u6b21\u8fde\u63a5\u65f6\u51fa\u73b0\u68c0\u67e5 keys \u7684\u63d0\u793a \u00b6 export ANSIBLE_HOST_KEY_CHECKING=False \u67e5\u770b\u4e3b\u673a\u540d\u7684\u6240\u6709\u6e05\u5355\u53d8\u91cf \u00b6 ansible -m debug -a \"var=hostvars['hostname']\" localhost \u901a\u8fc7\u62fc\u63a5\u5b57\u7b26\u4e32\uff0c\u6765\u83b7\u53d6\u63a5\u53e3 ip \u5730\u5740 \u00b6 {{ hostvars[inventory_hostname]['ansible_' + which_interface]['ipv4']['address'] }} \u83b7\u53d6\u7ec4\u4e2d\u7b2c\u4e00\u4e2a\u4e3b\u673a\u7684 ip \u5730\u5740 \u00b6 {{ hostvars[groups['webservers'][0]]['ansible_eth0']['ipv4']['address'] }} \u5728\u4efb\u52a1\u4e2d\u8bbe\u7f6e\u53d8\u91cf \u00b6 - set_fact: headnode={{ groups[['webservers'][0]] }} - debug: msg={{ headnode}} \u5982\u4f55\u83b7\u53d6 shell \u53d8\u91cf \u00b6 vars: local_home: \"{{ lookup('env','HOME') }}\" tasks: - debug: var=local_home \u5728ansible1.4\u7248\u672c\u4ee5\u4e0a\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\u83b7\u53d6 - debug: var=ansible_env.HOME \u5728\u6a21\u677f\u4e2d\u5982\u4f55\u904d\u5386\u67d0\u4e00\u7ec4\u5185\u7684\u6240\u6709\u4e3b\u673a\uff1f \u00b6 {% for host in groups['db_servers'] %} {{ host }} {% endfor %} \u83b7\u53d6 ip \u5730\u5740 \u00b6 {% for host in groups['db_servers'] %} {{ hostvars[host]['ansible_eth0']['ipv4']['address'] }} {% endfor %} {{ ansible_default_ipv4 }} service \u6a21\u5757\u542f\u52a8\u670d\u52a1\u6ca1\u6548\u679c\uff1f \u00b6 \u9996\u5148\u68c0\u67e5\u4e0bservice httpd status\u7684\u4fe1\u606f\uff0c\u662f\u4e0d\u662f\u6709 httpd is stopped \u8fd9\u79cd\u5b57\u7b26\uff0c\u6ca1\u6709\u7684\u8bdd\uff0c\u5728\u670d\u52a1\u542f\u52a8\u811a\u672c\u91cc\uff0c\u5728case\u8bed\u53e5\u91cc\u6dfb\u52a0\u4ee5\u4e0b\u65b9\u6cd5 status) status -p ${pidfile} $httpd RETVAL=$? ;; # bash\u53d8\u91cf httpd=${HTTPD-/usr/sbin/httpd} pidfile=${PIDFILE-/var/run/httpd/httpd.pid} \u4ece\u800c\u8fbe\u5230service http status\u6709stopped\u7684\u5b57\u6837\u3002 \u9012\u5f52\u76ee\u5f55\u4e2d\u7684\u6a21\u7248\u6587\u4ef6 \u00b6 - name: Copying the templated jinja2 files template: src={{item}} dest={{RUN_TIME}}/{{ item | regex_replace(role_path+'/templates','') | regex_replace('\\.j2', '') }} with_items: \"{{ lookup('pipe','find {{role_path}}/templates -type f').split('\\n') }}\" \u6307\u5b9a python \u7248\u672c \u00b6 - hosts: servers vars: - ansible_python_interpreter: /usr/bin/python2.6.6 \u8fdc\u7a0b\u904d\u5386\u62f7\u8d1d\u6587\u4ef6\u3002 \u00b6 - name : get files in /path/ shell : ls /path/* register: path_files - name: fetch these back to the local Ansible host for backup purposes fetch: src : /path/\"{{item}}\" dest: /path/to/backups/ with_items: \"{{ path_files.stdout_lines }}\" \u4f7f\u7528\u7cfb\u7edf\u5176\u4ed6\u7528\u6237\u6267\u884c\u547d\u4ee4 \u00b6 ansible node1 -m shell -a \"touch /tmp/12345\" --become-user=hadoop --become - command: touch /tmp/1234567 become: true become_user: hadoop \u83b7\u53d6\u4e3b\u673a\u6e05\u5355\u4e2d\u7ec4\u7684 ip \u5730\u5740 \u00b6 - shell: \"ping -c 1 {{item}} | grep icmp_seq | gawk -F'[()]' '{print $2}'\" with_inventory_hostnames: test2 register: testip - debug: \"msg={{ item.stdout }}\" with_items: \"{{ testip.results }}\" \u4fdd\u7559 ansbile \u8fdc\u7a0b\u6267\u884c\u7684\u6a21\u5757\u6587\u4ef6\uff0c\u5e76\u8c03\u8bd5\u6a21\u5757 \u00b6 \u6dfb\u52a0ANSIBLE_KEEP_REMOTE_FILES=\u73af\u5883\u53d8\u91cf $ ANSIBLE_KEEP_REMOTE_FILES=1 ansible localhost -m ping -a 'data=debugging_session' -vvv sing module file /usr/lib/python2.6/site-packages/ansible/modules/core/system/ping.py <localhost> ESTABLISH LOCAL CONNECTION FOR USER: root <localhost> EXEC /bin/sh -c '( umask 77 && mkdir -p \"` echo ~/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932 `\" && echo ansible-tmp-1489477306.61-275734926719932=\"` echo ~/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932 `\" ) && sleep 0' <localhost> PUT /tmp/tmpv4EenK TO /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py <localhost> EXEC /bin/sh -c 'chmod u+x /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py && sleep 0' <localhost> EXEC /bin/sh -c '/usr/bin/python /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py && sleep 0' localhost | SUCCESS => { \"changed\": false, \"invocation\": { \"module_args\": { \"data\": \"debugging_session\" }, \"module_name\": \"ping\" }, \"ping\": \"debugging_session\" } \u6a21\u5757\u6587\u4ef6\u662f\u7531base64\u7f16\u7801\u7684\u5b57\u7b26\u4e32\u6587\u4ef6\uff0c\u53ef\u4f7f\u7528explode\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u6210\u53ef\u6267\u884c\u7684python\u6587\u4ef6 $ python /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py explode Module expanded into: /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/debug_dir $ tree /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/debug_dir/ /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/debug_dir/ \u251c\u2500\u2500 ansible \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2514\u2500\u2500 module_utils \u2502 \u251c\u2500\u2500 basic.py \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u251c\u2500\u2500 pycompat24.py \u2502 \u251c\u2500\u2500 six.py \u2502 \u2514\u2500\u2500 _text.py \u251c\u2500\u2500 ansible_module_ping.py \u2514\u2500\u2500 args ansible_module_ping.py \u662f\u6a21\u5757\u672c\u8eab\u7684\u4ee3\u7801\u3002 args\u6587\u4ef6\u5305\u542b\u4e00\u4e2aJSON\u5b57\u7b26\u4e32\u3002 \u8be5\u5b57\u7b26\u4e32\u662f\u4e00\u4e2a\u5305\u542b\u6a21\u5757\u53c2\u6570\u548c\u5176\u4ed6\u53d8\u91cf\u7684\u5b57\u5178\u3002 ansible\u76ee\u5f55\u5305\u542b\u7531ansible_module_ping\u6a21\u5757\u4f7f\u7528\u7684ansible.module_utils\u7684\u4ee3\u7801\u6587\u4ef6\u3002 \u5982\u679c\u4fee\u6539\u4e86`debug_dir`\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\u4e4b\u540e\uff0c\u9700\u8981\u4f7f\u7528execute\u6267\u884c\u4ee3\u7801 $ python /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py execute {\"invocation\": {\"module_args\": {\"data\": \"debugging_session\"}}, \"changed\": false, \"ping\": \"debugging_session\"} 18. \u5982\u679c\u60f3\u4f7f\u6240\u6709\u7684notfiy\u4efb\u52a1\u5728\u67d0\u4e00\u4f4d\u7f6e\u6267\u884c\u3002\u53ea\u9700\u589e\u52a0\u4e00\u4e2a - meta: flush_handlers \u5217\u5982 - hosts: localhost gather_facts: no tasks: - command: echo 123 notify: test1 - meta: flush_handlers - debug: msg=\"789\" handlers: - name: test1 debug: msg=\"456\" \u6b64\u4efb\u52a1\u7684\u8fd4\u56de\u72b6\u6001\u5fc5\u987b\u4e3achanged\u72b6\u6001\uff0c\u624d\u4f1a\u6267\u884chandlers\u91cc\u7684\u4efb\u52a1\u3002 \u63d0\u5347\u6743\u9650 \u00b6 Ansible ad-hoc\u547d\u4ee4 ansible -i hosts node1 -m shell -a \"whoami\" --become --become-method=su --become-user=root --ask-su-pass SU password: 192.168.77.130 | SUCCESS | rc=0 >> root Ansible-playbook\u547d\u4ee4 cat test.yml --- - hosts: node1 gather_facts: no tasks: - name: I'm become to root. shell: whoami register: w become: true become_user: \"root\" become_method: \"su\" - debug: var=w.stdout [root@base ~]# ansible-playbook -i hosts test.yml --ask-su-pass SUDO password: PLAY [node1] **************************************************************************************************************************************** TASK [I'm become to root.] ************************************************************************************************************************** changed: [192.168.77.130] TASK [debug] **************************************************************************************************************************************** ok: [192.168.77.130] => { \"w.stdout\": \"root\" } PLAY RECAP ****************************************************************************************************************************************** 192.168.77.130 : ok=2 changed=1 unreachable=0 failed=0 \u5982\u679c\u4e0d\u60f3\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u8f93\u5165\u63d0\u5347\u7528\u6237\u7684\u5bc6\u7801\uff0c\u53ef\u4ee5\u5728hosts\u6587\u4ef6\u4e2d\u914d\u7f6eansible_become_pass\u53d8\u91cf\u8bbe\u7f6e\u5bc6\u7801\u3002 # cat hosts [node1] 192.168.77.130 ansible_ssh_user=test ansible_ssh_pass=123456 ansible_become_pass=123456 \u53c2\u6570\u89e3\u91ca become \u5f00\u542f\u63d0\u5347\u6743\u9650 become-method \u63d0\u5347\u6743\u9650\u7684\u65b9\u5f0f\uff0c\u6709sudo\uff0csu\uff0crunas\u7b49\u3002 become-user \u63d0\u5347\u6743\u9650\u7684\u7528\u6237 ansible_become_pass \u63d0\u5347\u6743\u9650\u7684\u7528\u6237\u5bc6\u7801 ask-su-pass \u544a\u8bc9\u7a0b\u5e8f\u63d0\u5347\u6743\u9650\u7684\u7528\u6237\u5bc6\u7801 \u53d8\u91cf\u5d4c\u5957 \u00b6 \u5728\u52a8\u6001\u53d6\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u6211\u4eec\u7b2c\u4e00\u65f6\u95f4\u5c31\u4f1a\u5199\u51fa\" {{ t_var[{{n}}]}} \"\u7684\u5f15\u7528\u547d\u4ee4\uff0c\u4f46\u8fd9\u7c7b\u5f15\u7528\u5728 jinja2 \u7684\u8bed\u6cd5\u4e2d\u662f\u9519\u8bef\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u5217\u65b9\u5f0f\u89e3\u51b3\u6b64\u5f15\u7528\u95ee\u9898\u3002 - hosts: localhost gather_facts: no vars: - t_var: ['1','2'] - n: \"1\" tasks: - shell: \"echo {% if n %} {% set number = n | int %} {{ t_var[number]}} {% endif %}\" \u53e6\u5916\u4e00\u4e2a - hosts: dev remote_user: root gather_facts: false tasks: - name: get dir path and port info shell: cat /data/info.txt register: info - name: get the last num shell: cat /data/num register: num - name: test shell: echo {{ info.stdout.split(',')[num.stdout|int].split(':')[0] }} >/tmp/test.txt \u73af\u5883\u53d8\u91cf\u627e\u4e0d\u5230\u7684\u95ee\u9898 \u00b6 \u6211\u4eec\u5728ansible\u76f4\u63a5\u6267\u884c\u547d\u4ee4\uff0c\u4e0d\u5e26\u6709\u7edd\u5bf9\u8def\u5f84\uff0c\u5c31\u4f1a\u62a5\u51fa\u627e\u4e0d\u5230\u547d\u4ee4\u7684\u63d0\u793a\u4fe1\u606f\uff1a ansible node2 -m shell -a \"openresty -v\" 192.168.77.130 | FAILED | rc=127 >> /bin/sh: openresty: \u672a\u627e\u5230\u547d\u4ee4 \u6b64\u65f6\u6211\u4eec\u5e94\u8be5\u4f7f\u7528\u4e0b\u5217\u547d\u4ee4\u907f\u514d\u3002 ansible node2 -m shell -a \"source /etc/profile; openresty -v\" 192.168.77.130 | SUCCESS | rc=0 >> nginx version: openresty/1.11.2.3 ansible \u7684ssh\u767b\u9646\u5c5e\u4e8e\u4ea4\u4e92\u5f0f\u7684\u975e\u767b\u9646shell \u83b7\u53d6 redis \u7684 info \u4fe1\u606f \u00b6 - hosts: localhost gather_facts: false tasks: - name: \"query redis info\" expect: command: \"telnet 106.14.183.68 6379\" responses: \"Escape\": - \"auth test\\ninfo\\nquit\\n\" ignore_errors: true register: result - name: \"show the variable\" debug: var: result \u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728 \u00b6 - name: install | Check if Mysql file is already configured. stat: path=/tmp/123 register: file_result - name: install | Create software files path. file: path=/tmp/123 state=directory when: not file_result.stat.exists \u4e0d\u663e\u793a\u5931\u8d25\u5185\u5bb9 \u00b6 \u5728\u6267\u884c task \u65f6\uff0c\u6709\u4e9b\u65f6\u5019\u4e0d\u5e0c\u671b\u6a21\u5757\u62a5\u51fa fatal \u7684\u9519\u8bef\u4fe1\u606f\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 failed_when \u5173\u952e\u5b57\u4f7f task \u6c38\u4e0d\u5931\u8d25,\u5728\u4f7f\u7528 register \u5173\u952e\u5b57\u8bb0\u5f55\u6a21\u5757\u7684\u4fe1\u606f\uff0c\u4fbf\u4e8e\u540e\u7eed\u4efb\u52a1\u4f7f\u7528. changed_when \u662f\u6c38\u4e0d\u6539\u53d8\uff0c no_log \u662f\u4e0d\u8bb0\u5f55\u65e5\u5fd7\u3002 - name : \u68c0\u67e5\u4e3b\u673a\u8fde\u63a5\u72b6\u6001 wait_for_connection : connect_timeout : 1 timeout : 3 register : host_status failed_when : false changed_when : false no_log : true - name : \u7ed3\u675f\u8fd0\u884c\u8fde\u63a5\u5931\u8d25\u7684\u4e3b\u673a meta : end_host when : host_status.msg is defined and host_status.msg is search('SSH Error') \u5b9e\u73b0 try catch \u529f\u80fd \u00b6 block \u4e2d\u7684\u4efb\u52a1\u6b63\u5e38\u6267\u884c\uff0c\u5982\u679c\u6709\u4efb\u4f55\u9519\u8bef\uff0c\u5219\u8be5 rescue \u90e8\u5206\u5c06\u6267\u884c\u3002always \u65e0\u8bba block \u548c rescue \u90e8\u5206\u4e2d\u4ee5\u524d\u53d1\u751f\u8fc7\u6216\u6ca1\u6709\u53d1\u751f\u8fc7\u4ec0\u4e48\u9519\u8bef\uff0c\u8be5\u90e8\u5206\u90fd\u5c06\u8fd0\u884c\u3002 - name : \u6355\u6349\u9519\u8bef block : - debug : msg : '\u6b63\u5e38\u6267\u884c' - name : \u5f3a\u884c\u9519\u8bef command : /bin/false - debug : msg : '\u7531\u4e8e\u4e0a\u8ff0\u4efb\u52a1\u5931\u8d25\uff0c\u4ece\u4e0d\u6267\u884c' rescue : - debug : msg : '\u53d1\u73b0\u4e00\u4e2a\u9519\u8bef' - name : \u5728\u6062\u590d\u8fc7\u7a0b\u4e2d\u5f3a\u884c\u5931\u8d25 command : /bin/false - debug : msg : '\u6062\u590d\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\u65f6,\u4e5f\u4ece\u4e0d\u6267\u884c' always : - debug : msg : \"\u603b\u662f\u6267\u884c\" # \u4f7f\u7528handlers tasks : - name : \u5c1d\u8bd5\u5e76\u4f18\u96c5\u5730\u56de\u6eda block : - debug : msg : '\u6b63\u5e38\u6267\u884c' changed_when : yes notify : \u5373\u4f7f\u53d1\u751f\u9519\u8bef\u65f6\u4e5f\u6267\u884c - command : /bin/false rescue : - name : \u786e\u4fdd\u6240\u6709task\u90fd\u8fd0\u884c meta : flush_handlers handlers : - name : \u5373\u4f7f\u53d1\u751f\u9519\u8bef\u65f6\u4e5f\u6267\u884c debug : msg : '\u8be5task\u5728\u9519\u8bef\u65f6\u8fd0\u884c' \u5faa\u73af\u5b57\u5178\u4e2d key \u7684 value \u503c \u00b6 \u4f7f\u7528 dict2items \u5c06\u5b57\u5178\u53d8\u6210 list, \u7136\u540e\u4f7f\u7528 subelements \u83b7\u53d6 vlaue \u5b50\u5143\u7d20 - hosts : localhost gather_facts : no vars : test : host1 : - cmd1 - cmd2 host2 : - cmd1 - cmd2 - cmd3 tasks : - name : test debug : msg : 'Key={{ item.0.key }} value={{ item.1 }}' loop : \"{{ test | dict2items | subelements('value') }}\" \u5c06\u5b57\u5178\u4e2d\u5b58\u5728\u7684 key \u90a3\u4e00\u9879\u7684\u5176\u4ed6 key \u7684 value \u62fc\u63a5\u6210\u5b57\u7b26\u4e32 \u00b6 selectattr()\u901a\u8fc7\u5bf9\u6bcf\u4e2a\u5bf9\u8c61\u7684\u6307\u5b9a\u5c5e\u6027\u5e94\u7528\u6d4b\u8bd5\u6765\u8fc7\u6ee4\u5bf9\u8c61\u5e8f\u5217\u3002map()\u8fc7\u6ee4\u5668\u8fd4\u56de\u5728\u524d\u4e00\u6b65\u4e2d\u8bb0\u5f55\u7684\u6240\u6709\u5bf9\u8c61\u7684 name \u5c5e\u6027,list \u5c06\u524d\u4e00\u6b65\u7684\u7ed3\u679c\u53d8\u6210\u5217\u8868,join \u5c06\u524d\u4e00\u6b65\u7684\u5217\u8868\u62fc\u63a5\u6210\u5b57\u7b26\u4e32 --- - hosts : test gather_facts : false vars : - test : - { 'name' : 'test1' } - { 'name' : 'test2' , 'hello' : 'world' } - { 'name' : 'test3' } - { 'name' : 'test4' , 'hello' : 'world' } - { 'name' : 'test5' , 'hello' : 'world' } - { 'name' : 'test6' } tasks : - debug : var=test - debug : msg={{ test | selectattr(\"hello\",'defined') | map(attribute='name') | list | join(',') }} \u6bd4\u8f83\u590d\u6742\u7684,\u62fc\u63a5\u5217\u8868\u4e2d\u7684\u6570\u636e - hosts : 192.168.77.132 gather_facts : false vars : - test : - { 'name' : 'test0' , 'facts' : { 'vars' : {} } } - { 'name' : 'test1' , 'facts' : { 'vars' : { 'name' : [ '1' , '2' ] } } } - { 'name' : 'test2' , 'facts' : { 'vars' : { 'name' : [ '3' ] } } } - { 'name' : 'test3' } - { 'name' : 'test4' , 'facts' : { 'vars' : { 'name' : [ '4' ] } } } - { 'name' : 'test5' , 'facts' : { 'vars' : { 'name' : [ '5' , '6' ] } } } - { 'name' : 'test6' , 'facts' : {} } - { 'name' : 'test7' , 'facts' : { 'vars' : {} } } - { 'name' : 'test8' , 'facts' : { 'vars' : {} } } - { 'name' : 'test9' } tasks : - debug : var=test - debug : msg : |- {%- for t in test | selectattr('facts.vars.name','defined') | map(attribute='facts.vars.name') | reject('equalto', [])-%} {%- for i in t -%} {{i}} {%-if not loop.last-%},{%-endif-%} {%-endfor-%} {%-if not loop.last-%},{%-endif-%} {%-endfor-%} # \u4e0d\u4f7f\u7528for\u5faa\u73af - debug : msg={{ test | selectattr('facts.vars.name','defined') | map(attribute='facts.vars.name') | list | flatten }} \u6309\u987a\u5e8f\u6267\u884c\u547d\u4ee4 \u00b6 \u6709\u65f6\uff0c\u6211\u4eec\u5728\u96c6\u7fa4\u4e2d\u9700\u8981\u6309\u987a\u5e8f\u6267\u884c\u67d0\u4e9b\u547d\u4ee4\uff0c\u4e0d\u80fd\u5e76\u884c\u6267\u884c\uff0c\u8fd9\u65f6\u53ef\u4ee5\u4f7f\u7528delegate_to\u548c\u5faa\u73af\u63a7\u5236\u6765\u914d\u5408\u4f7f\u7528\u8fbe\u5230\u76ee\u7684\uff0c\u4e0b\u5217\u6848\u4f8b\u662f\u6bcf\u6b21\u5faa\u73af\u5230\u4e3b\u673a\u6267\u884c\u547d\u4ee4\uff0c\u5faa\u73af\u95f4\u9694\u65f6\u95f4\u4e3a2\u79d2\u4e00\u6b21\u3002 --- - hosts: 192.168.77.130 192.168.77.131 192.168.77.132 tasks: - name: test shell: date delegate_to: \"{{ item }}\" run_once: true with_items: - \"{{ play_hosts }}\" loop_control: pause: 2 \u4e0b\u5217\u662f \u672c\u672b \u63d0\u4f9b\u7684 \u5728 shell \u6a21\u5757\u4e2d\u4f7f\u7528\u811a\u672c\u5199\u6cd5\u4e0e jinja2 \u00b6 # \u6211\u4eec\u77e5\u9053\uff0c\u4efb\u4f55\u80fd\u5199\u53d8\u91cf\u7684\u5730\u65b9\u90fd\u80fd\u5d4c\u5957 jinja2 \u8868\u8fbe\u5f0f # \u800c shell \u6a21\u5757\u4e2d\u7684\u5185\u5bb9\u5230\u5ba2\u6237\u7aef\u6e32\u67d3\u540e\u4e5f\u662f\u4e00\u4e2a\u53ef\u6267\u884c\u811a\u672c # \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5728 shell \u5185\u7f16\u5199\u6bd4\u5e73\u65f6\u66f4\u590d\u6742\u7684\u811a\u672c --- - name : Run shell shell : |- {% if foo is defined %} mkdir -p /tmp/{{ foo }} {% else %} if [[ ! ${foo} ]];then mkdir -p /var/lib/{{ bar }} echo 'success' else echo 'falure' fi {% endif %} \u5c55\u5f00 jinja2 \u4e2d\u7684\u4e00\u884c\u7684\u8868\u8fbe\u5f0f \u00b6 ## # \u5728\u4f7f\u7528 jiaja2 if \u5224\u65ad\u4e00\u4e2a\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u9632\u6b62\u7a7a\u683c\u8ddf\u6362\u884c\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u5199\u5728\u4e00\u884c\u5224\u65ad\uff0c\u4f46\u662f\u5c55\u793a\u5374\u4e0d\u592a\u53cb\u597d - set_fact : GET_REPO : \"{% if ENV == 'UAT' %}git@192.168.1.24:xnph-devops/conf-test.git{% else %}git@192.168.1.24:xnph-devops/conf.git{% endif %}\" # \u4e00\u884c\u5197\u957f\u7684\u8868\u8fbe\u5f0f\u770b\u7740\u5f88\u4e0d\u76f4\u89c2\uff0c\u6211\u4eec\u53ef\u4ee5\u501f\u52a9 jinja2 \u7684\u2018-\u2019\u5b9e\u73b0\u6362\u884c\u5199\uff0c\u5e76\u5ffd\u7565\u6362\u884c\u7b26 # \u5176\u4e2d\uff1a # |- \u4e3a\u5757\u6807\u7b7e\u5ffd\u7565\u6362\u884c # {%- -%} \u4e3a\u5ffd\u7565\u6362\u884c --- - set_fact : GIT_REPO : |- { % - if ENV == 'UAT' -% } git@192.168.1.24:xnph-devops/conf-test.git { % - else -% } git@192.168.1.24:xnph-devops/conf.git { % - endif -% } \u7b80\u6613\u7684 jinja2 'if else'\u8868\u8fbe\u5f0f \u00b6 # \u6211\u4eec\u5728\u7f16\u5199 jinja2 if else \u7684\u8868\u8fbe\u5f0f\u65f6\uff0c\u901a\u5e38\u90fd\u662f\u50cf\u8fd9\u6837\u7684\uff1a # \u4e0b\u9762\u4f8b\u5b50\uff0c\u7d22\u5f15 ID \u5c0f\u4e8e 3 \u7684\u90fd\u5206\u914d\u4e3a master --- - set_fact : role : >- { % - if ansible_play_hosts.index(inventory_hostname) < 3 -% } master { % - else -% } slave { % - endif -% } ## # \u6211\u4eec\u5229\u7528 python \u7279\u6027\uff0c\u53ef\u4ee5\u7b80\u5199\u5982\u4e0b\uff1a - set_fact : role : \"{{ ['slave','master'][ansible_play_hosts.index(inventory_hostname) < 3] }}\" # \u5373\uff0c\u5148\u5224\u65ad ansible_play_hosts.index(inventory_hostname) < 3 \u662f\u5426\u6210\u7acb\uff0c # \u5982\u679c\u6210\u7acb\uff0c\u5373 true\uff0c\u5931\u8d25\u4e3a false # \u800c python \u4e2d true==>1,false==>0 # \u518d\u53d6['slave','master']\u5217\u8868\u7d22\u5f15 # \u5176\u4e2d ansible_play_hosts \u4e3a\u5f53\u524d\u4efb\u52a1\u6267\u884c\u7684\u6240\u6709\u4e3b\u673a \u83b7\u53d6\u5f53\u524d\u65f6\u95f4 \u00b6 # \u5728 setup \u4e2d\u5176\u5b9e\u6709\u65f6\u95f4\u5b57\u6bb5\uff0c\u4f46\u662f\u88ab\u62c6\u5206\uff0c\u6216\u8005\u683c\u5f0f\u95ee\u9898\u4e0d\u597d\u5904\u7406\uff0c\u6211\u4eec\u901a\u8fc7\u5185\u7f6e\u65b9\u6cd5\u80fd\u66f4\u4fbf\u6377\u7684\u83b7\u53d6 # 2019-07-02:11 # \u683c\u5f0f\u53ef\u4ee5\u81ea\u5b9a\u4e49 - set_fact : datetime : \"{{ '%Y-%d-%m:%H' | strftime() }}\" # \u4f46\u662f\u8fd9\u6837\u53d6\u7684\u65f6\u95f4\u5728\u5ba2\u6237\u7aef\u65f6\u95f4\u51fa\u73b0\u4e0d\u4e00\u81f4\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u51fa\u73b0\u95ee\u9898\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u901a\u8fc7\u53e6\u5916\u4e00\u4e2a\u529e\u6cd5 # \u5373\uff1a\u901a\u8fc7 lookup \u63d2\u4ef6(lookup \u63d2\u4ef6\u5de5\u4f5c\u5728\u63a7\u5236\u7aef\u672c\u673a)\uff0c\u7edf\u4e00\u83b7\u53d6\u672c\u673a\u65f6\u95f4 - set_fact : datetime : \"{{ lookup('pipe','date +%Y-%d-%m:%H') }}\" \u5355\u72ec\u53d8\u91cf\u5d4c\u5957 \u00b6 ## # \u5047\u8bbe\u6211\u4eec\u6709\u5982\u4e0b playbook: - hosts : group_a vars : foo_var : foo bar_var : bar tasks : - debug : msg=\"I like the {{ {{ key }}\\_var }}\" # \u4ee5\u4e0a\u6267\u884c\u5fc5\u7136\u662f\u56de\u62a5\u9519\u7684\uff0c # \u5176\u4e2d{{ key }}\u662f\u6211\u4eec\u60f3\u901a\u8fc7\u52a8\u6001\u4f20\u5165 foo \u6216\u8005 bar \u6765\u83b7\u53d6 foo_var \u6216\u8005 bar_var \u7684\u503c # \u4e3a\u6b64\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 lookup \u7684 vars \u63d2\u4ef6\u6765\u67e5\u5230\u76ee\u7684,\u6539\u9020\u5982\u4e0b\uff1a --- - hosts : group_a vars : foo_var : foo bar_var : bar tasks : - debug : msg=\"I like the {{ lookup('vars', key + '_var') }}\" # \u6267\u884c\u4f20\u5165 key=foo ansible-playbook test.yml -e 'key=foo' \u5b57\u5178\u53d8\u91cf\u5d4c\u5957 \u00b6 ## # \u5047\u8bbe\u6211\u4eec\u6709\u5982\u4e0b playbook - hosts : group_a vars : project : foo : foo_value bar : bar_value tasks : - debug : msg=\"I like the {{ project.{{ key }} }}\" # \u5f53\u7136\uff0c\u4ee5\u4e0a\u6267\u884c\u662f\u4f1a\u62a5\u9519\u7684\uff0c # \u5176\u4e2d{{ key }}\u5373\u4e3a\u6211\u60f3\u901a\u8fc7\u52a8\u6001\u4f20\u5165 foo \u6216\u8005 bar \u6765\u83b7\u53d6 project \u4e0b\u7684\u952e\u503c # \u4e3a\u6b64\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u5199\uff1a --- - hosts : group_a vars : project : foo : foo_value bar : bar_value tasks : - debug : msg=\"I like the {{ project[key] }}\" # \u6267\u884c\u4f20\u5165 key=foo ansible-playbook test.yml -e 'key=foo' \u9650\u5236\u5fc5\u987b\u6307\u5b9a\u81f3\u5c11\u4e00\u4e2a tags \u624d\u80fd\u8fd0\u884c\u4efb\u52a1 \u00b6 # \u6211\u4eec\u5bf9\u591a\u4e2a\u4efb\u52a1\u505a\u4e86 tags,\u800c\u6211\u4eec\u8fd0\u884c\u4efb\u52a1\u800c\u4e0d\u6307\u5b9a-t \u65f6\uff0c\u9ed8\u8ba4\u4f1a\u8fd0\u884c\u6240\u6709\u7684\u4efb\u52a1 # \u6709\u65f6\u5019\u8fd9\u5e76\u4e0d\u662f\u6211\u4eec\u6240\u671f\u671b\u7684\uff0c\u6240\u4ee5\u60f3\u5f53\u4e0d\u6307\u5b9a tags \u65f6\u5019\u4e0d\u8fd0\u884c\u540e\u9762\u7684\u4efb\u52a1 --- - hosts : localhost gather_facts : false tasks : - fail : msg : \"\u4f60\u5fc5\u987b\u6307\u5b9a\u4e00\u4e2a tags[-t]\" when : \"ansible_run_tags == ['all']\" run_once : true - debug : msg='hello {{ ansible_run_tags }}' tags : - abc # \u5373\uff0c\u53ea\u8981 ansible_run_tags \u9ed8\u8ba4\u503c\u4e3a['all']\u65f6\uff0c\u4efb\u52a1\u5c31\u76f4\u63a5\u5931\u8d25 \\$ ansible-playbook abc.yml PLAY [localhost] ******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\******* TASK [fail] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* fatal : [localhost] : FAILED! => {\"changed\" : false, \"msg\" : \"\u4f60\u5fc5\u987b\u6307\u5b9a\u4e00\u4e2a tags[-t]\"} PLAY RECAP ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* localhost : ok=0 changed=0 unreachable=0 failed=1 # \u5176\u4e2d\uff1a # ansible_run_tags \u4e3a ansible \u5185\u7f6e\u53d8\u91cf\uff0c\u9ed8\u8ba4\u503c\u4e3a['all'] 9.\u8bbf\u95ee\u5176\u4ed6\u4e3b\u673a\u7684\u53d8\u91cf ## # A \u4e3b\u673a\u6709\u53d8\u91cf foo=archive,B \u4e3b\u673a\u60f3\u4f7f\u7528 A \u4e3b\u673a\u7684{{ foo }}\u600e\u4e48\u529e\u5462\uff1f - hosts : A:B tasks : - debug : msg={{ hostvars['A']['foo'] }} # \u5927\u90e8\u5206\u7684\u53d8\u91cf\u5bf9\u8c61\u90fd\u5b58\u653e\u5728 hostvars \u4e2d \u8ba1\u7b97\u4e0d\u540c\u4e3b\u673a\u4e2d\u76f8\u540c\u53d8\u91cf\u7684\u548c \u00b6 # \u4ec0\u4e48\u610f\u601d\u5462\uff0c\u5373\uff0c\u6709 N \u4e3b\u673a\uff0c\u6709\u76f8\u540c\u7684\u53d8\u91cf score,\u4f46\u662f\u503c\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u73b0\u5728\u60f3\u8ba1\u7b97\u5b83\u4eec\u7684 score \u548c # \u5047\u5b9a inventory \u5982\u4e0b\uff1a \\$ cat inventory.ini [public] 10.18.12.213 score=77 10.18.16.166 score=100 10.18.16.167 score=81 10.18.16.168 score=56 # \u8ba1\u7b97 score \u7684\u548c - hosts : localhost tasks : - debug : msg={{ ansible_play_hosts_all | map('extract',hostvars,'score') | sum }} # \u6267\u884c\u7ed3\u679c \\$ ansible-playbook -i inventory.ini score_sum.yml PLAY [public] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* TASK [Gathering Facts] ******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\******* ok : [10.18.16.167] ok : [10.18.16.166] ok : [10.18.16.168] ok : [10.18.12.213] TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [10.18.12.213] => { \"msg\" : \"314\" } ok : [10.18.16.166] => { \"msg\" : \"314\" } ok : [10.18.16.167] => { \"msg\" : \"314\" } ok : [10.18.16.168] => { \"msg\" : \"314\" } PLAY RECAP ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* 10.18.12.213 : ok=2 changed=0 unreachable=0 failed=0 10.18.16.166 : ok=2 changed=0 unreachable=0 failed=0 10.18.16.167 : ok=2 changed=0 unreachable=0 failed=0 10.18.16.168 : ok=2 changed=0 unreachable=0 failed=0 # \u5176\u4ed6\u4f8b\u5b50\uff1a # \u83b7\u53d6\u6240\u6709\u4e3b\u673a\u7684\u5e8f\u5217\u53f7\uff0c\u5e76\u4ee5','\u8fde\u63a5 - debug : msg={{ ansible_play_hosts_all | map('extract',hostvars,'ansible_product_serial') | join(',') }} # \u83b7\u53d6\u6240\u6709\u4e3b\u673a\u5185\u5b58\u7684\u603b\u548c - debug : msg={{ ansible_play_hosts_all | map('extract',hostvars,'ansible_memtotal_mb') | sum }} # \u5176\u4e2d\uff1a # ansible_play_hosts_all \u4e3a\u5f53\u524d\u4efb\u52a1\u6267\u884c\u7684\u6240\u6709\u4e3b\u673a # map \u65b9\u6cd5\u53c2\u8003 python map # sum \u4e3a\u8ba1\u7b97 list \u7684\u548c \u4f7f\u7528\u672c\u5730\u547d\u4ee4\u7684\u503c\u4f5c\u4e3a\u5faa\u73af\u53c2\u6570 \u00b6 # \u4f7f\u7528 ls /tmp \u7684\u8f93\u51fa\u4f5c\u4e3a loop \u5faa\u73af\u7684\u503c # \u5176\u4e2d\uff1aq == query # query \u4e0e lookup \u90fd\u5de5\u4f5c\u5728\u672c\u673a --- - hosts : localhost gather_facts : tasks : - debug : msg={{ item }} loop : \"{{ q('lines','ls /tmp/') }}\" \u5d4c\u5957\u4e24\u4e2a\u5217\u8868\u7684\u5faa\u73af\u4efb\u52a1 \u00b6 # \u5047\u5b9a\u6709 2 \u4e2a\u5217\u8868 # a_list: [1,2] # b_list: ['jack', 'green', 'apple'] # \u9700\u8981\u5d4c\u5957\u5faa\u73af\u8f93\u51fa\uff1a # jack-1,,green-1,apple-1,jack-2,green-2... --- - hosts : localhost vars : a_list : [1,2] b_list : ['jack', 'green', 'apple'] gather_facts : false tasks : - debug : msg=\"{{ item[1] }}-{{ item[0] }}\" loop : \"{{ a_list | product(b_list) | list }}\" \\$ ansible-playbook loops.yml PLAY [localhost] ******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\******* TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [localhost] => (item=[1, u'jack']) => { \"msg\" : \"jack-1\" } ok : [localhost] => (item=[1, u'green']) => { \"msg\" : \"green-1\" } ok : [localhost] => (item=[1, u'apple']) => { \"msg\" : \"apple-1\" } ok : [localhost] => (item=[2, u'jack']) => { \"msg\" : \"jack-2\" } ok : [localhost] => (item=[2, u'green']) => { \"msg\" : \"green-2\" } ok : [localhost] => (item=[2, u'apple']) => { \"msg\" : \"apple-2\" } PLAY RECAP ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* localhost : ok=1 changed=0 unreachable=0 failed=0 \u5168\u5c40\u4efb\u52a1\u6eda\u52a8\u6267\u884c \u00b6 # \u5bf9\u4e8e\u5168\u5c40\u4efb\u52a1\u6eda\u52a8\u6267\u884c # \u8bbe\u7f6e serial \u4e3a 1\uff0c\u6216\u8005\u5176\u4ed6\u7684\u6570\u503c\uff0c\u4f1a\u6309\u8fd9\u4e2a\u6570\u91cf\u7684\u4e3b\u673a\u53bb\u6eda\u52a8\u6267\u884c\u4efb\u52a1 # \u6bcf\u4e2a\u4efb\u52a1\u7ed3\u5c3e\u4f1a\u505c\u987f 5s,\u518d\u4e0b\u4e00\u4e2a\u4e3b\u673a - hosts : public serial : 1 gather_facts : false tasks : - name : I\\'m the first task debug : msg=\"hello {{ inventory_hostname }}\" - name : Sleep task wait_for : delay : 5 when : (ansible_play_hosts_all.index[-1] != inventory_hostname) # \u5bf9\u4e8e\u6700\u540e\u4e00\u53f0\u4e3b\u673a\uff0c\u662f\u4e0d\u9700\u8981\u6267\u884c wait_for \u4efb\u52a1\u7684\uff0c\u6240\u4ee5\u5224\u65ad\u6700\u540e\u4e00\u53f0\u4e3b\u673a\u8df3\u8fc7 wait_for # \u5176\u4e2d\uff1a # serial \u4e3a\u6eda\u52a8\u6267\u884c\u7684\u5173\u952e\u5b57\uff0c\u53ef\u4ee5\u662f\u6570\u503c\u6216\u8005\u767e\u5206\u6bd4(%) # ansible_play_hosts_all \u4e3a\u5f53\u524d\u4efb\u52a1\u6267\u884c\u7684\u6240\u6709\u4e3b\u673a # inventory_hostname \u4e3a\u5404\u4e2a\u4e3b\u673a\u81ea\u5df1 \u90e8\u5206\u4efb\u52a1\u6eda\u52a8\u6267\u884c \u00b6 # \u628a\u9700\u8981\u6eda\u52a8\u6267\u884c\u7684\u4efb\u52a1\u653e\u5165 include_tasks \u4e2d\uff0c # \u5229\u7528 loop \u5faa\u73af\u6240\u6709\u5f53\u524d\u6267\u884c\u7684\u4e3b\u673a(ansible_play_hosts_all),\u5373: # \u53ea\u6709\u653e\u5165 other.yml \u7684\u4efb\u52a1\u4f1a\u4e00\u53f0\u4e00\u53f0\u6267\u884c # \u8bbe\u7f6e run_once \u907f\u514d\u6bcf\u4e2a\u4e3b\u673a\u90fd\u591a\u6b21\u91cd\u590d\u6267\u884c --- - hosts : public tasks : - debug : msg=\"I'm the Top public task\" - include_tasks : other.yml loop : \"{{ ansible_play_hosts_all }}\" loop_control : loop_var : target_host run_once : true ## # other.yml - block : - shell : hostname -I register : res - debug : msg=\"I'm {{ res.stdout }}\" delegate_to : \"{{ target_host }}\" # \u5176\u4e2d: # ansible_play_hosts_all \u4e3a\u524d\u671f\u6267\u884c\u7684\u6240\u6709 host # loop_control \u7684 loop_var \u628a item \u8d4b\u503c\u7ed9 target_host,\u5373\uff0ctarget_host==item,\u9632\u6b62 other \u91cc\u5176\u4ed6\u4efb\u52a1\u8c03\u7528 loop\uff0citem \u53d8\u91cf\u51b2\u7a81 # run_once:\u6bcf\u4e2a\u5faa\u73af\u5bf9\u8c61\u53ea\u5141\u8bb8\u4e00\u6b21\uff0c\u4e0d\u8bbe\u7f6e\u7684\u8bdd\uff0c\u4f1a\u91cd\u590d\u8fd0\u884c # delegate_to \u59d4\u6d3e\u4efb\u52a1 # \u53e6\u5916\uff0c\u8be5\u65b9\u6cd5\u6709\u4e2a\u7f3a\u70b9\u662f\u7531\u4e8e\u59d4\u6d3e\u8005\u90fd\u662f\u7b2c\u4e00\u53f0\u4e3b\u673a\uff0c\u5bf9\u5e94\u7684 facts \u53d8\u91cf\u90fd\u662f\u8be5\u59d4\u6d3e\u8005\u7684\uff0c\u6240\u4ee5\u6ca1\u6cd5\u4f7f\u7528\u5176\u4ed6\u4e3b\u673a\u7684\u5185\u7f6e\u53d8\u91cf # \u6545\u6848\u4f8b\u4e2d\u4e5f\u662f\u4f7f\u7528 register+shell \u6765\u83b7\u53d6\u7684\u4e3b\u673a\u540d\uff0c\u800c\u4e0d\u662f{{ inventory_hostname }} # \u6267\u884c\u7ed3\u679c\uff1a \\$ ansible-playbook rolling.yml PLAY [public] ******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\******* TASK [Gathering Facts] ******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\******* ok : [10.18.16.167] ok : [10.18.16.166] ok : [10.18.16.168] ok : [10.18.12.213] TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [10.18.12.213] => { \"msg\" : \"I'm the Top public task\" } ok : [10.18.16.167] => { \"msg\" : \"I'm the Top public task\" } ok : [10.18.16.166] => { \"msg\" : \"I'm the Top public task\" } ok : [10.18.16.168] => { \"msg\" : \"I'm the Top public task\" } TASK [include_tasks] ******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\******* included : /tmp/other.yml for 10.18.12.213 included : /tmp/other.yml for 10.18.12.213 included : /tmp/other.yml for 10.18.12.213 included : /tmp/other.yml for 10.18.12.213 TASK [shell] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* changed : [10.18.12.213 -> 10.18.12.213] TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [10.18.12.213 -> 10.18.12.213] => { \"msg\" : \"I'm 10.18.12.213 \" } TASK [shell] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* changed : [10.18.12.213 -> 10.18.16.166] TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [10.18.12.213 -> 10.18.16.166] => { \"msg\" : \"I'm 10.18.16.166 \" } TASK [shell] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* changed : [10.18.12.213 -> 10.18.16.167] TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [10.18.12.213 -> 10.18.16.167] => { \"msg\" : \"I'm 10.18.16.167 \" } TASK [shell] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* changed : [10.18.12.213 -> 10.18.16.168] TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [10.18.12.213 -> 10.18.16.168] => { \"msg\" : \"I'm 10.18.16.168 \" } PLAY RECAP ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* 10.18.12.213 : ok=14 changed=4 unreachable=0 failed=0 10.18.16.166 : ok=2 changed=0 unreachable=0 failed=0 10.18.16.167 : ok=2 changed=0 unreachable=0 failed=0 10.18.16.168 : ok=2 changed=0 unreachable=0 failed=0 \u5728 when \u91cc\u4f7f\u7528 jinja2 \u8868\u8fbe\u5f0f \u00b6 # \u5728 when \u91cc\u662f\u53ef\u4ee5\u4f7f\u7528 jinja2 \u8868\u8fbe\u5f0f\u7684\uff0c\u53ea\u8981\u683c\u5f0f\u89c4\u8303\u5373\u53ef\u3002 # \u4e00\u884c\u8868\u8fbe\u5f0f\uff1a --- - hosts : target_host tasks : - name : Show debug debug : msg='\u6761\u4ef6\u6ee1\u8db3\u4f60\u5c31\u4f1a\u770b\u5230\u6211\u3002' when : '{% if def_a_var|d(\"abc\") == \"abc\" %}{{ foo | d(\"true\") }}{% endif %}' ## # \u7b49\u4ef7\u7684\u5c55\u5f00\u8868\u8fbe\u5f0f - hosts : target_host tasks : - name : Show debug debug : msg='\u6761\u4ef6\u6ee1\u8db3\u4f60\u5c31\u4f1a\u770b\u5230\u6211\u3002' when : |- { % - if def_a_var|d(\"abc\") == \"abc\" -% } {{ foo | d(\"true\") }} { % - endif -% } # \u6267\u884c\uff08\u4f1a\u6709\u8b66\u544a\u63d0\u793a\uff09: ansible-playbook test.yml PLAY [localhost] ********************************\\*\\*\\*\\*********************************\\*\\*\\*\\*********************************\\*\\*\\*\\********************************* TASK [Gathering Facts] ********************************\\*\\*********************************\\*\\*********************************\\*\\********************************* ok : [localhost] TASK [Show debug] ********************************\\*\\*\\*\\*********************************\\*\\*\\*********************************\\*\\*\\*\\********************************* [ WARNING ] : when statements should not include jinja2 templating delimiters such as {{ }} or {% %}. Found : {% if def_a_var|d(\"abc\") == \"abc\" %}{{ foo | d(\"true\") }}{% endif %} ok : [localhost] => { \"msg\" : \"\u6761\u4ef6\u6ee1\u8db3\u4f60\u5c31\u4f1a\u770b\u5230\u6211\u3002\" } PLAY RECAP **********************************\\*\\*\\*\\***********************************\\*\\***********************************\\*\\*\\*\\*********************************** localhost : ok=2 changed=0 unreachable=0 failed=0 \u53d8\u91cf\u4f7f\u7528\u951a\u5b9a\u548c\u522b\u540d \u00b6 # \u901a\u5e38\u6211\u4eec\u5728\u5b9a\u4e49\u591a\u4e2a\u7c7b\u4f3c\u53d8\u91cf\u65f6\uff0c\u4e0d\u540c\u53d8\u91cf\u6709\u5b9a\u4e49\u76f8\u540c\u7684\u5185\u5bb9 # \u6bd4\u5982\uff1a --- - hosts : localhost vars : project_1 : port : 8080 jvm : '-Xms1G -Xmx1G' run_user : devops root : /data/project_1 project_2 : port : 8080 jvm : '-Xms1G -Xmx1G' run_user : devops root : /data/project_2 tasks : - debug : var=project_1 - debug : var=project_2 # \u53ef\u4ee5\u770b\u5230`project_2`\u4e2d\u7684\u5f88\u591a\u952e\u503c\u90fd\u8ddf`project_1`\u4e2d\u662f\u4e00\u6837\u7684\uff0c # \u90a3\u4e48\u6211\u4eec\u6709\u4ec0\u4e48\u529e\u6cd5\u7b80\u5316\u5462\uff1f # \u5bf9\u6b64\uff0cyaml \u4e2d\u63d0\u4f9b\u4e86'&'\u6765\u63cf\u5b9a\u4e00\u4e2a\u53d8\u91cf\uff0c\u5e76\u7ed9\u63cf\u5b9a\u7684\u53d8\u91cf\u8bbe\u7f6e\u4e00\u4e2a\u522b\u540d\uff0c # \u5176\u4ed6\u53d8\u91cf\u8981\u5f15\u7528\u951a\u5b9a\u53d8\u91cf\u7684\u503c\uff0c\u9700\u8981\u518d\u4f7f\u7528'<<'\u6765\u5f15\u7528\u5e76\u7528\\*\u6307\u5411\u8bbe\u7f6e\u7684\u522b\u540d # \u53e6\u5916\uff0c\u5177\u6709\u76f8\u540c\u952e\u7684\u53d8\u91cf\u4f1a\u88ab\u540e\u8005\u8986\u76d6 # \u5373\uff1aproject_2 \u7684 root \u4f1a\u8986\u76d6\u5f15\u7528 project_1 \u7684 root # \u4fee\u6539\u5982\u4e0b\uff1a --- - hosts : localhost vars : project_1 : &conf_anchor port : 8080 jvm : '-Xms1G -Xmx1G' run_user : devops root : /data/project_1 project_2 : << : \\*conf_anchor root : /data/project_2 tasks : - debug : var=project_1 - debug : var=project_2 # \u5176\u4e2d\uff1a # & \u4e3a\u951a\u5b9a\u6807\u8bc6 # conf_anchor \u4e3a\u8bbe\u7f6e\u7684\u522b\u540d # << \u4e3a\u5408\u5e76\u952e # \\* \u4e3a\u5f15\u7528\u7b26 # \u6267\u884c\u5982\u4e0b\uff08\u53d8\u91cf\u8986\u76d6\u4f1a\u6709\u8b66\u544a\uff09\uff1a \\$ ansible-playbook anchor.yml [ WARNING ] : While constructing a mapping from /tmp/anchor.yml, line 10, column 7, found a duplicate dict key (root). Using last defined value only. PLAY [localhost] ********************************************************************\\*\\*\\*\\********************************************************************* TASK [Gathering Facts] ******************************************************************\\*\\******************************************************************* ok : [localhost] TASK [debug] **********************************************************************\\*\\*\\*\\*********************************************************************** ok : [localhost] => { \"project_1\" : { \"jvm\" : \"-Xms1G -Xmx1G\" , \"port\" : 8080 , \"root\" : \"/data/project_1\" , \"run_user\" : \"devops\" } } TASK [debug] **********************************************************************\\*\\*\\*\\*********************************************************************** ok : [localhost] => { \"project_2\" : { \"jvm\" : \"-Xms1G -Xmx1G\" , \"port\" : 8080 , \"root\" : \"/data/project_2\" , \"run_user\" : \"devops\" } } PLAY RECAP ************************************************************************\\*\\************************************************************************* localhost : ok=3 changed=0 unreachable=0 failed=0 \u5f15\u7528\u951a\u5b9a\u53d8\u91cf \u00b6 - hosts : localhost vars : app : version : &my_version 1.1.1 name : - \"app_name\" - \\*my_version tasks : debug : msg : app version is \"{{ app.name | join('-') }}\". # \u6267\u884c \\$ ansible-playbook app.yml PLAY [localhost] ********************************************************************\\*\\*\\********************************************************************* TASK [Gathering Facts] ******************************************************************\\******************************************************************* ok : [localhost] TASK [debug] **********************************************************************\\*\\*\\*********************************************************************** ok : [localhost] => { \"msg\" : \"app version is \\\"app_name-1.1.1\\\".\" } PLAY RECAP ************************************************************************\\************************************************************************* localhost : ok=2 changed=0 unreachable=0 failed=0 \u5408\u5e76\u591a\u4e2a\u5b57\u5178 \u00b6 - hosts : localhost vars : center : &C x : 1 y : 2 round : &R r : 3.1415 big : << : [*C,*R] g : 3x10e tasks : - debug : var=big # \u6267\u884c\uff1a ansible-playbook muti.yml PLAY [localhost] ********************************************************************\\*\\*\\********************************************************************* TASK [Gathering Facts] ******************************************************************\\******************************************************************* ok : [localhost] TASK [debug] **********************************************************************\\*\\*\\*********************************************************************** ok : [localhost] => { \"big\" : { \"g\" : \"3x10e\" , \"r\" : 3.1415 , \"x\" : 1 , \"y\" : 2 } } PLAY RECAP ************************************************************************\\************************************************************************* localhost : ok=2 changed=0 unreachable=0 failed=0 \u5b9a\u4e49\u5e26\u7a7a\u683c\u7684 key \u00b6 # yaml \u662f\u76f4\u63a5\u53ef\u4ee5\u5b9a\u4e49\u5e26\u7a7a\u683c\u7684\u53d8\u91cf\u7684 # \u6216\u8005\u4f60\u53ef\u4ee5\u7528?:\u7684\u65b9\u5f0f # \u4e24\u8005\u5b8c\u5168\u7b49\u4ef7\u7684\u3002 - hosts : localhost vars : my_vars : # \u76f4\u63a5\u5b9a\u4e49 'this is a key1' : 'this is a value1' # \u6216\u8005\u4f7f\u7528?:\u7684\u65b9\u5f0f ? 'this is a key2' : 'this is a value2' tasks : - debug : var=my_vars # \u6267\u884c \\$ ansible-playbook space_var.yml PLAY [localhost] ******************************************************************************\\*\\******************************************************************************* TASK [Gathering Facts] **************************************************************************\\*\\*\\*\\*************************************************************************** ok : [localhost] TASK [debug] ********************************************************************************\\*\\********************************************************************************* ok : [localhost] => { \"my_vars\" : { \"this is a key1\" : \"this is a value1\" , \"this is a key2\" : \"this is a value2\" } } PLAY RECAP ********************************************************************************\\*\\*\\*\\********************************************************************************* localhost : ok=2 changed=0 unreachable=0 failed=0 \u5b9a\u4e49\u53d8\u91cf\u65f6\uff0c\u8bbe\u7f6e\u7c7b\u578b \u00b6 # \u5176\u5b9e\u5728\u5b9a\u4e49\u53d8\u91cf\u65f6\uff0c\u6211\u4eec\u662f\u53ef\u4ee5\u8bbe\u7f6e\u7c7b\u578b\u7684\u3002 # \u5f53\u7136\uff0c\u4f60\u5728\u52a0\u5f15\u53f7\u4e0e\u4e0d\u52a0\u5f15\u53f7\u65f6\u5c31\u80fd\u89e3\u51b3\u5927\u591a\u7684\u5b9a\u4e49\u95ee\u9898 - hosts : localhost vars : type_vars : is_str : !!str 9111 is_int : !!int '8081' is_float : !!float 2019 is_bool : !!bool 'yes' tasks : - debug : var=type_vars # \u6267\u884c\uff1a \\$ ansible-playbook type_vars.yml PLAY [localhost] ******************************************************************************\\*\\******************************************************************************* TASK [Gathering Facts] **************************************************************************\\*\\*\\*\\*************************************************************************** ok : [localhost] TASK [debug] ********************************************************************************\\*\\********************************************************************************* ok : [localhost] => { \"type_vars\" : { \"is_bool\" : true , \"is_float\" : 2019.0 , \"is_int\" : 8081 , \"is_str\" : \"9111\" } } PLAY RECAP ********************************************************************************\\*\\*\\*\\********************************************************************************* localhost : ok=2 changed=0 unreachable=0 failed=0 \u6570\u5b57\u7cbe\u5ea6 \u00b6 # \u5229\u7528 format \u53ef\u4ee5\u4fdd\u7559\u7cbe\u5ea6 \\$ ansible localhost -m debug -a \"msg={{ '%0.2f -- %0.3f -- %d'| format(123,2.7,4.44) }}\" localhost | SUCCESS => { \"msg\" : \"123.00 -- 2.700 -- 4\" } \u5faa\u73af(\u591a\u5b9e\u4f8b)\u4efb\u52a1\u89e6\u53d1 handlers \u91cd\u542f\u4efb\u52a1 \u00b6 # \u6211\u4eec\u5728\u4f7f\u7528ansible\u90e8\u7f72\u591a\u5b9e\u4f8b\u4efb\u52a1\u65f6 # \u591a\u4e2a\u5b9e\u4f8b\u5b8c\u6210\u540e\u9700\u8981\u89e6\u53d1handler\u4efb\u52a1\u6765\u91cd\u542f\u5404\u4e2a\u5b9e\u4f8b\uff08\u5b9e\u4f8b\u540d\u79f0\u901a\u5e38\u662f\u52a8\u6001/\u4e0d\u56fa\u5b9a\u7684\uff09\uff0c # \u800c\u901a\u5e38\u5b9e\u4f8b\u7684\u670d\u52a1\u540d\u79f0\u662f\u6709\u533a\u522b\u7684\uff0c\u800c\u4e14\u662f\u6309\u9700\u91cd\u542f(\u6ee1\u8db3\u72b6\u6001\u53d8\u5316)\uff0c\u9010\u4e2a\u91cd\u542f # \u6211\u4eec\u53ef\u4ee5\u501f\u52a9json_query\u7684filter\u7279\u6027\u6765\u83b7\u53d6changed\u72b6\u6001\u6ee1\u8db3\u6761\u4ef6\u7684\u5b9e\u4f8b\u6765\u5faa\u73af\u91cd\u542f # \u5982\uff0c\u5b9e\u4f8b\u53d8\u91cf\u5982\u4e0b: --- vars : redis_ins_port : - 6379 - 6380 - 6381 # \u6211\u4eec\u8981\u5faa\u73af\u590d\u5236\u5b9e\u4f8b\u6a21\u677f\u5230\u5ba2\u6237\u7aef\uff0c\u89e6\u53d1handler\u540e\u53ea\u91cd\u542f\u53d1\u751f\u53d8\u5316\u7684\u5b9e\u4f8b # \u590d\u5236\u6a21\u677f\u5e76\u5c06\u4efb\u52a1\u72b6\u6001\u6ce8\u518c\u5230\u53d8\u91cf - name : template : src=redis.conf.j2 dest=/etc/redis/redis_{{ server_port }}.conf\" loop_control : loop_var : server_port loop : \"{{ redis_ins_port }}\" register : task_status notify : - Restart redis # handler\u4efb\u52a1 # \u5176\u4e2d\uff0cjson_query\u4e3a\u67e5\u8be2task_status\u4e2dchanged\u7684\u72b6\u6001\u4e3atrue\u7684\u6240\u6709server_port --- - name : Restart redis systemd : name=redis_{{ item }} state=restarted\" loop : \"{{ task_status | json_query('results[?changed].server_port') }} \u4fee\u6539\u5217\u8868\u5185\u7684\u6240\u6709\u5b57\u6bb5\u503c\uff0c\u751f\u6210\u65b0\u7684\u5217\u8868 \u00b6 # \u6211\u4eec\u5728\u521b\u5efa\u4f8b\u5982mongodb replicasets\u65f6\uff0c\u4f7f\u7528\u6a21\u5757\u793a\u4f8b\u5982\u4e0b\uff1a # Create a replicaset called 'rs0' with the 3 provided members - name : Ensure replicaset rs0 exists mongodb_replicaset : login_host : localhost login_user : admin login_password : admin replica_set : rs0 members : - mongodb1:27017 - mongodb2:27017 - mongodb3:27017 when:ansible_play_hosts.index(inventory_hostname) == 0 # \u5bf9\u4e8e\u5176\u4e2d\u7684member\u5982\u4f55\u80fd\u4e0d\u56fa\u5b9a\u901a\u8fc7\u65b9\u6cd5\u81ea\u52a8\u521b\u5efa\u5462\uff1f # \u8bd5\u60f3\uff0c\u6211\u4eec\u5df2\u7ecf\u6709\u4e86\u6267\u884c\u7684\u4e3b\u673a\u5217\u8868ansible_play_hosts # (\u867d\u7136\u91cc\u9762\u7684\u503c\u53ef\u80fd\u662f\u522b\u540d,\u5373\uff1ainventory_hostname) # \u4f46\u662f\u8fd9\u4e2a\u5217\u8868\u4e48\u6709\u5bf9\u5e94\u7684\u7aef\u53e3\uff0c\u5373\u6211\u4eec\u9700\u8981\u4fee\u6539\u5217\u8868\u91cc\u7684\u6bcf\u4e00\u9879\uff0c\u6dfb\u52a0\u4e00\u4e2a\u7aef\u53e3\u5373\u53ef # \u50cf\u8fd9\u6837\uff1a['10.18.1.190:27017','10.18.1.191:27017','10.18.1.192:27017'] # \u6539\u52a8\u5982\u4e0b\uff1a - name : Ensure replicaset rs0 exists mongodb_replicaset : login_host : localhost login_user : admin login_password : admin replica_set : rs0 members : >- {{ anible_play_hosts | map('extract' , hostvars , 'ansible_default_ipv4' ) | list | json_query(' [ * ] .address') |map('regex_replace' , '(.*)' , '\\\\1:' + '27017' | list }} when : ansible_play_hosts.index(inventory_hostname) == 0 # \u5176\u4e2d: # ansible_play_hosts\u4e3a\u5f53\u524d\u6267\u884c\u7684\u6240\u6709\u4e3b\u673a\u5217\u8868 # \u7b2c\u4e00\u4e2amap extract\u4e3a\u63d0\u53d6hostvars\u4e2d\u6bcf\u4e2aansible_play_hosts\u7684\u503c\u4f5c\u4e3a\u952e\uff0c\u5e76\u53d6ansible_default_ipv4,\u5c31\u50cf\uff1ahostvars[inventory_hostname]['ansible_default_ipv4'] # list\u628amap\u5bf9\u8c61\u8f6c\u6362\u6210\u5217\u8868 # json_query\u628a\u5217\u8868\u5185\u6bcf\u4e2aaddress\u63d0\u53d6\u51fa\u6765\u53d8\u6210\u65b0\u7684\u5217\u8868,\u5230\u6b64\u662f\u4e3a\u4e86\u63d0\u53d6IP\u5730\u5740\u5217\u8868\uff0c\u5f53\u7136\uff0c\u4f60ansible_play_hosts\u662fIP\u5730\u5740\u7684\u8bdd\u53ef\u4ee5\u4e0d\u7528\u8fd9\u4e48\u9ebb\u70e6 # \u7b2c\u4e8c\u4e2amap regex_replace\u628a\u6bcf\u4e2aIP\u5730\u5740\u53d8\u6210IP+:27017\uff0c # \u6700\u540e\u518d\u628a\u6211\u4eec\u7684map\u5bf9\u8c61\u8f6c\u6210list\uff0c\u5f97\u5230\u6211\u4eec\u60f3\u8981\u7684\uff1a['10.18.1.190:27017','10.18.1.191:27017','10.18.1.192:27017'] \u7ed9\u96c6\u7fa4\u4e3b\u673a\u81ea\u52a8\u5206\u914d ID/\u89d2\u8272 \u00b6 \u4f7f\u7528\u4e3b\u673a\u53d8\u91cf [ cluster ] node01 ansible_host=10.18.1.190 id=1 role=master node02 ansible_host=10.18.1.191 id=2 role=slave node03 ansible_host=10.18.1.192 id=3 role=slave \u4f7f\u7528\u6267\u884c\u4e3b\u673a\u5217\u8868\u7684\u7d22\u5f15\u5b9a\u4e49 ID, \u9700\u8981\u540c\u65f6\u6267\u884c\u96c6\u7fa4\u4e3b\u673a # hosts [ cluster ] node01 ansible_host=10.18.1.190 node02 ansible_host=10.18.1.191 node03 ansible_host=10.18.1.192 # tasks --- - hosts : cluster gather_facts : false tasks : # ansible_play_hosts_all\u662f\u5f53\u524d\u6267\u884c\u7684\u6240\u6709\u4e3b\u673a\u5217\u8868\uff0c\u7c7b\u578b\u4e3a\u6709\u5e8flist, # inventory_hostname\u4e3a\u5404\u81ea\u6267\u884c\u4e3b\u673a\u7684\u540d\u5b57 # \u5373\uff1a\u5728list\u4e2d\u627e\u51fa\u5404\u81ea\u540d\u5b57\u7684\u7d22\u5f15\u505a\u4e3aID\u503c - set_fact : id={{ ansible_play_hosts_all.index(inventory_hostname) }} # \u4f7f\u7528id\u65f6\u5019\u8bf7\u8f6c\u6362\u6210\u6574\u578b\uff0cset_fact\u4e0d\u4f1a\u5e2e\u4f60\u8f6c\u6362\u6570\u636e\u7c7b\u578b - debug : msg=\"{{ inventory_hostname }} --> ID --> {{ id | int }}\" # \u9012\u589e10 - set_fact : id={{ ansible_play_hosts_all.index(inventory_hostname) * 10 }} # \u9012\u51cf5 - set_fact : id={{ 100 - ansible_play_hosts_all.index(inventory_hostname) * 5 }} \u5b9a\u4e49\u89d2\u8272 --- - hosts : cluster gather_facts : false tasks : # \u8fd9\u91cc\u4e3a\u4e86\u66f4\u597d\u7684\u5c55\u793a\uff0c\u4f7f\u7528\u4e86>\u6362\u884c\u8bed\u53e5 - set_fact : role : >- {# \u5373\uff0c\u7d22\u5f15ID\u5c0f\u4e8e3\u7684\u90fd\u5206\u914d\u4e3amaster #} {%- if ansible_play_hosts_all.index(inventory_hostname) < 3 -%} master {%- else -%} slave {%- endif -%} - debug : msg=\"{{ inventory_hostname }} --> role --> {{ role }}\" \u65e2\u5206\u914d id \u53c8\u5206\u914d\u89d2\u8272 --- - hosts : cluster gather_facts : false tasks : - set_fact : id={{ ansible_play_hosts_all.index(inventory_hostname) }} # id\u5c0f\u4e8e3\u7684\u90fd\u89c6\u4e3amaster,\u8bb0\u5f97\u8981\u8f6c\u6362\u4e3a\u6574\u5f62\uff0cset_fact\u4e0d\u4f1a\u5e2e\u4f60\u5904\u7406\u6570\u636e\u7c7b\u578b # PS: \u8fd9\u91cc\u7528\u4e86python\u7684\u5c0f\u6280\u5de7\uff0c\u7528jinja2\u7684if\u53bb\u5224\u65ad\u4e5f\u662f\u4e00\u6837\u7684 - set_fact : role : \"{{ ['slave','master'][id|int<3] }}\" - debug : msg=\"ID--> {{ id | int }}, role --> {{ role }}\"","title":"Ansible Task\u7247\u6bb5"},{"location":"advanced/practice/snippets/#ansible-task","text":"","title":"Ansible Task \u7247\u6bb5"},{"location":"advanced/practice/snippets/#_1","text":"- name : set environment shell : echo $PATH $SOME >> /tmp/a.txt environment : PATH : '{{ ansible_env.PATH }}:/thingy/bin' SOME : value","title":"\u600e\u4e48\u4e3a\u4efb\u52a1\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf"},{"location":"advanced/practice/snippets/#_2","text":"\u5728\u4e3b\u673a\u6e05\u5355\u91cc\u8bbe\u7f6e [webservers] asdf.example.com ansible_port=5000 ansible_user=alice ansible_pass=123456 jkl.example.com ansible_port=5001 ansible_user=bob ansible_pass=654321 \u4e5f\u53ef\u4ee5\u6307\u5b9a\u8fde\u63a5\u7c7b\u578b [testcluster] localhost ansible_connection=local /path/to/chroot1 ansible_connection=chroot foo.example.com bar.example.com","title":"\u4e0d\u540c\u7684\u7528\u6237\u767b\u5f55\u4e0d\u540c\u7684\u4e3b\u673a"},{"location":"advanced/practice/snippets/#_3","text":"# ansible \u514d\u5bc6\u767b\u5f55\u8df3\u677f\u673a ansible_ssh_common_args: '-o ProxyCommand=\"ssh -W %h:%p -q user@gateway.example.com\"' ansible_ssh_common_args: '-o ProxyCommand=\"sshpass -f /etc/tpasswd ssh xx@10.10.10.1 -p 66677 nc %h %p\"' ansible_ssh_common_args=\"-o ProxyCommand='ssh -W %h:%p -q -p 20343 root@11.11.11.11'\" ansible_ssh_common_args=\"-o ProxyCommand=\\\"ssh -qay -p 20343 root@11.11.11.11 'nc %h %p'\\\"\" ansible_ssh_common_args=\"-o ProxyCommand=\\\"sshpass -p '123456' ssh -qay -p 20343 root@11.11.11.11 'nc %h %p'\\\"\" # \u8df3\u677f\u673asshd\u914d\u7f6e MaxStartups 1000 LoginGraceTime 0 # ansible.cfg timeout = 60 ssh_args=-C -o ControlMaster=auto -o ControlPersist=5m -F /etc/ansible/prod/ssh_config retries = 1 #\u3000ssh_config Host 47.111.162.118 User root Hostname 47.111.162.118 ProxyCommand none BatchMode yes Host 172.16.99.* User root ServerAliveInterval 60 TCPKeepAlive yes ProxyCommand ssh -qaY -p 20343 root@47.111.162.118 nc %h %p ForwardAgent yes","title":"\u901a\u8fc7\u8df3\u8f6c\u4e3b\u673a\u8bbf\u95ee\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a"},{"location":"advanced/practice/snippets/#cowsay","text":"export ANSIBLE_NOCOWS=1","title":"\u5173\u95ed cowsay \u529f\u80fd"},{"location":"advanced/practice/snippets/#ssh-keys","text":"export ANSIBLE_HOST_KEY_CHECKING=False","title":"\u5173\u95ed ssh \u5728\u9996\u6b21\u8fde\u63a5\u65f6\u51fa\u73b0\u68c0\u67e5 keys \u7684\u63d0\u793a"},{"location":"advanced/practice/snippets/#_4","text":"ansible -m debug -a \"var=hostvars['hostname']\" localhost","title":"\u67e5\u770b\u4e3b\u673a\u540d\u7684\u6240\u6709\u6e05\u5355\u53d8\u91cf"},{"location":"advanced/practice/snippets/#ip","text":"{{ hostvars[inventory_hostname]['ansible_' + which_interface]['ipv4']['address'] }}","title":"\u901a\u8fc7\u62fc\u63a5\u5b57\u7b26\u4e32\uff0c\u6765\u83b7\u53d6\u63a5\u53e3 ip \u5730\u5740"},{"location":"advanced/practice/snippets/#ip_1","text":"{{ hostvars[groups['webservers'][0]]['ansible_eth0']['ipv4']['address'] }}","title":"\u83b7\u53d6\u7ec4\u4e2d\u7b2c\u4e00\u4e2a\u4e3b\u673a\u7684 ip \u5730\u5740"},{"location":"advanced/practice/snippets/#_5","text":"- set_fact: headnode={{ groups[['webservers'][0]] }} - debug: msg={{ headnode}}","title":"\u5728\u4efb\u52a1\u4e2d\u8bbe\u7f6e\u53d8\u91cf"},{"location":"advanced/practice/snippets/#shell","text":"vars: local_home: \"{{ lookup('env','HOME') }}\" tasks: - debug: var=local_home \u5728ansible1.4\u7248\u672c\u4ee5\u4e0a\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\u83b7\u53d6 - debug: var=ansible_env.HOME","title":"\u5982\u4f55\u83b7\u53d6 shell \u53d8\u91cf"},{"location":"advanced/practice/snippets/#_6","text":"{% for host in groups['db_servers'] %} {{ host }} {% endfor %}","title":"\u5728\u6a21\u677f\u4e2d\u5982\u4f55\u904d\u5386\u67d0\u4e00\u7ec4\u5185\u7684\u6240\u6709\u4e3b\u673a\uff1f"},{"location":"advanced/practice/snippets/#ip_2","text":"{% for host in groups['db_servers'] %} {{ hostvars[host]['ansible_eth0']['ipv4']['address'] }} {% endfor %} {{ ansible_default_ipv4 }}","title":"\u83b7\u53d6 ip \u5730\u5740"},{"location":"advanced/practice/snippets/#service","text":"\u9996\u5148\u68c0\u67e5\u4e0bservice httpd status\u7684\u4fe1\u606f\uff0c\u662f\u4e0d\u662f\u6709 httpd is stopped \u8fd9\u79cd\u5b57\u7b26\uff0c\u6ca1\u6709\u7684\u8bdd\uff0c\u5728\u670d\u52a1\u542f\u52a8\u811a\u672c\u91cc\uff0c\u5728case\u8bed\u53e5\u91cc\u6dfb\u52a0\u4ee5\u4e0b\u65b9\u6cd5 status) status -p ${pidfile} $httpd RETVAL=$? ;; # bash\u53d8\u91cf httpd=${HTTPD-/usr/sbin/httpd} pidfile=${PIDFILE-/var/run/httpd/httpd.pid} \u4ece\u800c\u8fbe\u5230service http status\u6709stopped\u7684\u5b57\u6837\u3002","title":"service \u6a21\u5757\u542f\u52a8\u670d\u52a1\u6ca1\u6548\u679c\uff1f"},{"location":"advanced/practice/snippets/#_7","text":"- name: Copying the templated jinja2 files template: src={{item}} dest={{RUN_TIME}}/{{ item | regex_replace(role_path+'/templates','') | regex_replace('\\.j2', '') }} with_items: \"{{ lookup('pipe','find {{role_path}}/templates -type f').split('\\n') }}\"","title":"\u9012\u5f52\u76ee\u5f55\u4e2d\u7684\u6a21\u7248\u6587\u4ef6"},{"location":"advanced/practice/snippets/#python","text":"- hosts: servers vars: - ansible_python_interpreter: /usr/bin/python2.6.6","title":"\u6307\u5b9a python \u7248\u672c"},{"location":"advanced/practice/snippets/#_8","text":"- name : get files in /path/ shell : ls /path/* register: path_files - name: fetch these back to the local Ansible host for backup purposes fetch: src : /path/\"{{item}}\" dest: /path/to/backups/ with_items: \"{{ path_files.stdout_lines }}\"","title":"\u8fdc\u7a0b\u904d\u5386\u62f7\u8d1d\u6587\u4ef6\u3002"},{"location":"advanced/practice/snippets/#_9","text":"ansible node1 -m shell -a \"touch /tmp/12345\" --become-user=hadoop --become - command: touch /tmp/1234567 become: true become_user: hadoop","title":"\u4f7f\u7528\u7cfb\u7edf\u5176\u4ed6\u7528\u6237\u6267\u884c\u547d\u4ee4"},{"location":"advanced/practice/snippets/#ip_3","text":"- shell: \"ping -c 1 {{item}} | grep icmp_seq | gawk -F'[()]' '{print $2}'\" with_inventory_hostnames: test2 register: testip - debug: \"msg={{ item.stdout }}\" with_items: \"{{ testip.results }}\"","title":"\u83b7\u53d6\u4e3b\u673a\u6e05\u5355\u4e2d\u7ec4\u7684 ip \u5730\u5740"},{"location":"advanced/practice/snippets/#ansbile","text":"\u6dfb\u52a0ANSIBLE_KEEP_REMOTE_FILES=\u73af\u5883\u53d8\u91cf $ ANSIBLE_KEEP_REMOTE_FILES=1 ansible localhost -m ping -a 'data=debugging_session' -vvv sing module file /usr/lib/python2.6/site-packages/ansible/modules/core/system/ping.py <localhost> ESTABLISH LOCAL CONNECTION FOR USER: root <localhost> EXEC /bin/sh -c '( umask 77 && mkdir -p \"` echo ~/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932 `\" && echo ansible-tmp-1489477306.61-275734926719932=\"` echo ~/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932 `\" ) && sleep 0' <localhost> PUT /tmp/tmpv4EenK TO /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py <localhost> EXEC /bin/sh -c 'chmod u+x /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py && sleep 0' <localhost> EXEC /bin/sh -c '/usr/bin/python /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py && sleep 0' localhost | SUCCESS => { \"changed\": false, \"invocation\": { \"module_args\": { \"data\": \"debugging_session\" }, \"module_name\": \"ping\" }, \"ping\": \"debugging_session\" } \u6a21\u5757\u6587\u4ef6\u662f\u7531base64\u7f16\u7801\u7684\u5b57\u7b26\u4e32\u6587\u4ef6\uff0c\u53ef\u4f7f\u7528explode\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u6210\u53ef\u6267\u884c\u7684python\u6587\u4ef6 $ python /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py explode Module expanded into: /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/debug_dir $ tree /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/debug_dir/ /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/debug_dir/ \u251c\u2500\u2500 ansible \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2514\u2500\u2500 module_utils \u2502 \u251c\u2500\u2500 basic.py \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u251c\u2500\u2500 pycompat24.py \u2502 \u251c\u2500\u2500 six.py \u2502 \u2514\u2500\u2500 _text.py \u251c\u2500\u2500 ansible_module_ping.py \u2514\u2500\u2500 args ansible_module_ping.py \u662f\u6a21\u5757\u672c\u8eab\u7684\u4ee3\u7801\u3002 args\u6587\u4ef6\u5305\u542b\u4e00\u4e2aJSON\u5b57\u7b26\u4e32\u3002 \u8be5\u5b57\u7b26\u4e32\u662f\u4e00\u4e2a\u5305\u542b\u6a21\u5757\u53c2\u6570\u548c\u5176\u4ed6\u53d8\u91cf\u7684\u5b57\u5178\u3002 ansible\u76ee\u5f55\u5305\u542b\u7531ansible_module_ping\u6a21\u5757\u4f7f\u7528\u7684ansible.module_utils\u7684\u4ee3\u7801\u6587\u4ef6\u3002 \u5982\u679c\u4fee\u6539\u4e86`debug_dir`\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\u4e4b\u540e\uff0c\u9700\u8981\u4f7f\u7528execute\u6267\u884c\u4ee3\u7801 $ python /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py execute {\"invocation\": {\"module_args\": {\"data\": \"debugging_session\"}}, \"changed\": false, \"ping\": \"debugging_session\"} 18. \u5982\u679c\u60f3\u4f7f\u6240\u6709\u7684notfiy\u4efb\u52a1\u5728\u67d0\u4e00\u4f4d\u7f6e\u6267\u884c\u3002\u53ea\u9700\u589e\u52a0\u4e00\u4e2a - meta: flush_handlers \u5217\u5982 - hosts: localhost gather_facts: no tasks: - command: echo 123 notify: test1 - meta: flush_handlers - debug: msg=\"789\" handlers: - name: test1 debug: msg=\"456\" \u6b64\u4efb\u52a1\u7684\u8fd4\u56de\u72b6\u6001\u5fc5\u987b\u4e3achanged\u72b6\u6001\uff0c\u624d\u4f1a\u6267\u884chandlers\u91cc\u7684\u4efb\u52a1\u3002","title":"\u4fdd\u7559 ansbile \u8fdc\u7a0b\u6267\u884c\u7684\u6a21\u5757\u6587\u4ef6\uff0c\u5e76\u8c03\u8bd5\u6a21\u5757"},{"location":"advanced/practice/snippets/#_10","text":"Ansible ad-hoc\u547d\u4ee4 ansible -i hosts node1 -m shell -a \"whoami\" --become --become-method=su --become-user=root --ask-su-pass SU password: 192.168.77.130 | SUCCESS | rc=0 >> root Ansible-playbook\u547d\u4ee4 cat test.yml --- - hosts: node1 gather_facts: no tasks: - name: I'm become to root. shell: whoami register: w become: true become_user: \"root\" become_method: \"su\" - debug: var=w.stdout [root@base ~]# ansible-playbook -i hosts test.yml --ask-su-pass SUDO password: PLAY [node1] **************************************************************************************************************************************** TASK [I'm become to root.] ************************************************************************************************************************** changed: [192.168.77.130] TASK [debug] **************************************************************************************************************************************** ok: [192.168.77.130] => { \"w.stdout\": \"root\" } PLAY RECAP ****************************************************************************************************************************************** 192.168.77.130 : ok=2 changed=1 unreachable=0 failed=0 \u5982\u679c\u4e0d\u60f3\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u8f93\u5165\u63d0\u5347\u7528\u6237\u7684\u5bc6\u7801\uff0c\u53ef\u4ee5\u5728hosts\u6587\u4ef6\u4e2d\u914d\u7f6eansible_become_pass\u53d8\u91cf\u8bbe\u7f6e\u5bc6\u7801\u3002 # cat hosts [node1] 192.168.77.130 ansible_ssh_user=test ansible_ssh_pass=123456 ansible_become_pass=123456 \u53c2\u6570\u89e3\u91ca become \u5f00\u542f\u63d0\u5347\u6743\u9650 become-method \u63d0\u5347\u6743\u9650\u7684\u65b9\u5f0f\uff0c\u6709sudo\uff0csu\uff0crunas\u7b49\u3002 become-user \u63d0\u5347\u6743\u9650\u7684\u7528\u6237 ansible_become_pass \u63d0\u5347\u6743\u9650\u7684\u7528\u6237\u5bc6\u7801 ask-su-pass \u544a\u8bc9\u7a0b\u5e8f\u63d0\u5347\u6743\u9650\u7684\u7528\u6237\u5bc6\u7801","title":"\u63d0\u5347\u6743\u9650"},{"location":"advanced/practice/snippets/#_11","text":"\u5728\u52a8\u6001\u53d6\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u6211\u4eec\u7b2c\u4e00\u65f6\u95f4\u5c31\u4f1a\u5199\u51fa\" {{ t_var[{{n}}]}} \"\u7684\u5f15\u7528\u547d\u4ee4\uff0c\u4f46\u8fd9\u7c7b\u5f15\u7528\u5728 jinja2 \u7684\u8bed\u6cd5\u4e2d\u662f\u9519\u8bef\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u5217\u65b9\u5f0f\u89e3\u51b3\u6b64\u5f15\u7528\u95ee\u9898\u3002 - hosts: localhost gather_facts: no vars: - t_var: ['1','2'] - n: \"1\" tasks: - shell: \"echo {% if n %} {% set number = n | int %} {{ t_var[number]}} {% endif %}\" \u53e6\u5916\u4e00\u4e2a - hosts: dev remote_user: root gather_facts: false tasks: - name: get dir path and port info shell: cat /data/info.txt register: info - name: get the last num shell: cat /data/num register: num - name: test shell: echo {{ info.stdout.split(',')[num.stdout|int].split(':')[0] }} >/tmp/test.txt","title":"\u53d8\u91cf\u5d4c\u5957"},{"location":"advanced/practice/snippets/#_12","text":"\u6211\u4eec\u5728ansible\u76f4\u63a5\u6267\u884c\u547d\u4ee4\uff0c\u4e0d\u5e26\u6709\u7edd\u5bf9\u8def\u5f84\uff0c\u5c31\u4f1a\u62a5\u51fa\u627e\u4e0d\u5230\u547d\u4ee4\u7684\u63d0\u793a\u4fe1\u606f\uff1a ansible node2 -m shell -a \"openresty -v\" 192.168.77.130 | FAILED | rc=127 >> /bin/sh: openresty: \u672a\u627e\u5230\u547d\u4ee4 \u6b64\u65f6\u6211\u4eec\u5e94\u8be5\u4f7f\u7528\u4e0b\u5217\u547d\u4ee4\u907f\u514d\u3002 ansible node2 -m shell -a \"source /etc/profile; openresty -v\" 192.168.77.130 | SUCCESS | rc=0 >> nginx version: openresty/1.11.2.3 ansible \u7684ssh\u767b\u9646\u5c5e\u4e8e\u4ea4\u4e92\u5f0f\u7684\u975e\u767b\u9646shell","title":"\u73af\u5883\u53d8\u91cf\u627e\u4e0d\u5230\u7684\u95ee\u9898"},{"location":"advanced/practice/snippets/#redis-info","text":"- hosts: localhost gather_facts: false tasks: - name: \"query redis info\" expect: command: \"telnet 106.14.183.68 6379\" responses: \"Escape\": - \"auth test\\ninfo\\nquit\\n\" ignore_errors: true register: result - name: \"show the variable\" debug: var: result","title":"\u83b7\u53d6 redis \u7684 info \u4fe1\u606f"},{"location":"advanced/practice/snippets/#_13","text":"- name: install | Check if Mysql file is already configured. stat: path=/tmp/123 register: file_result - name: install | Create software files path. file: path=/tmp/123 state=directory when: not file_result.stat.exists","title":"\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728"},{"location":"advanced/practice/snippets/#_14","text":"\u5728\u6267\u884c task \u65f6\uff0c\u6709\u4e9b\u65f6\u5019\u4e0d\u5e0c\u671b\u6a21\u5757\u62a5\u51fa fatal \u7684\u9519\u8bef\u4fe1\u606f\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 failed_when \u5173\u952e\u5b57\u4f7f task \u6c38\u4e0d\u5931\u8d25,\u5728\u4f7f\u7528 register \u5173\u952e\u5b57\u8bb0\u5f55\u6a21\u5757\u7684\u4fe1\u606f\uff0c\u4fbf\u4e8e\u540e\u7eed\u4efb\u52a1\u4f7f\u7528. changed_when \u662f\u6c38\u4e0d\u6539\u53d8\uff0c no_log \u662f\u4e0d\u8bb0\u5f55\u65e5\u5fd7\u3002 - name : \u68c0\u67e5\u4e3b\u673a\u8fde\u63a5\u72b6\u6001 wait_for_connection : connect_timeout : 1 timeout : 3 register : host_status failed_when : false changed_when : false no_log : true - name : \u7ed3\u675f\u8fd0\u884c\u8fde\u63a5\u5931\u8d25\u7684\u4e3b\u673a meta : end_host when : host_status.msg is defined and host_status.msg is search('SSH Error')","title":"\u4e0d\u663e\u793a\u5931\u8d25\u5185\u5bb9"},{"location":"advanced/practice/snippets/#try-catch","text":"block \u4e2d\u7684\u4efb\u52a1\u6b63\u5e38\u6267\u884c\uff0c\u5982\u679c\u6709\u4efb\u4f55\u9519\u8bef\uff0c\u5219\u8be5 rescue \u90e8\u5206\u5c06\u6267\u884c\u3002always \u65e0\u8bba block \u548c rescue \u90e8\u5206\u4e2d\u4ee5\u524d\u53d1\u751f\u8fc7\u6216\u6ca1\u6709\u53d1\u751f\u8fc7\u4ec0\u4e48\u9519\u8bef\uff0c\u8be5\u90e8\u5206\u90fd\u5c06\u8fd0\u884c\u3002 - name : \u6355\u6349\u9519\u8bef block : - debug : msg : '\u6b63\u5e38\u6267\u884c' - name : \u5f3a\u884c\u9519\u8bef command : /bin/false - debug : msg : '\u7531\u4e8e\u4e0a\u8ff0\u4efb\u52a1\u5931\u8d25\uff0c\u4ece\u4e0d\u6267\u884c' rescue : - debug : msg : '\u53d1\u73b0\u4e00\u4e2a\u9519\u8bef' - name : \u5728\u6062\u590d\u8fc7\u7a0b\u4e2d\u5f3a\u884c\u5931\u8d25 command : /bin/false - debug : msg : '\u6062\u590d\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\u65f6,\u4e5f\u4ece\u4e0d\u6267\u884c' always : - debug : msg : \"\u603b\u662f\u6267\u884c\" # \u4f7f\u7528handlers tasks : - name : \u5c1d\u8bd5\u5e76\u4f18\u96c5\u5730\u56de\u6eda block : - debug : msg : '\u6b63\u5e38\u6267\u884c' changed_when : yes notify : \u5373\u4f7f\u53d1\u751f\u9519\u8bef\u65f6\u4e5f\u6267\u884c - command : /bin/false rescue : - name : \u786e\u4fdd\u6240\u6709task\u90fd\u8fd0\u884c meta : flush_handlers handlers : - name : \u5373\u4f7f\u53d1\u751f\u9519\u8bef\u65f6\u4e5f\u6267\u884c debug : msg : '\u8be5task\u5728\u9519\u8bef\u65f6\u8fd0\u884c'","title":"\u5b9e\u73b0 try catch \u529f\u80fd"},{"location":"advanced/practice/snippets/#key-value","text":"\u4f7f\u7528 dict2items \u5c06\u5b57\u5178\u53d8\u6210 list, \u7136\u540e\u4f7f\u7528 subelements \u83b7\u53d6 vlaue \u5b50\u5143\u7d20 - hosts : localhost gather_facts : no vars : test : host1 : - cmd1 - cmd2 host2 : - cmd1 - cmd2 - cmd3 tasks : - name : test debug : msg : 'Key={{ item.0.key }} value={{ item.1 }}' loop : \"{{ test | dict2items | subelements('value') }}\"","title":"\u5faa\u73af\u5b57\u5178\u4e2d key \u7684 value \u503c"},{"location":"advanced/practice/snippets/#key-key-value","text":"selectattr()\u901a\u8fc7\u5bf9\u6bcf\u4e2a\u5bf9\u8c61\u7684\u6307\u5b9a\u5c5e\u6027\u5e94\u7528\u6d4b\u8bd5\u6765\u8fc7\u6ee4\u5bf9\u8c61\u5e8f\u5217\u3002map()\u8fc7\u6ee4\u5668\u8fd4\u56de\u5728\u524d\u4e00\u6b65\u4e2d\u8bb0\u5f55\u7684\u6240\u6709\u5bf9\u8c61\u7684 name \u5c5e\u6027,list \u5c06\u524d\u4e00\u6b65\u7684\u7ed3\u679c\u53d8\u6210\u5217\u8868,join \u5c06\u524d\u4e00\u6b65\u7684\u5217\u8868\u62fc\u63a5\u6210\u5b57\u7b26\u4e32 --- - hosts : test gather_facts : false vars : - test : - { 'name' : 'test1' } - { 'name' : 'test2' , 'hello' : 'world' } - { 'name' : 'test3' } - { 'name' : 'test4' , 'hello' : 'world' } - { 'name' : 'test5' , 'hello' : 'world' } - { 'name' : 'test6' } tasks : - debug : var=test - debug : msg={{ test | selectattr(\"hello\",'defined') | map(attribute='name') | list | join(',') }} \u6bd4\u8f83\u590d\u6742\u7684,\u62fc\u63a5\u5217\u8868\u4e2d\u7684\u6570\u636e - hosts : 192.168.77.132 gather_facts : false vars : - test : - { 'name' : 'test0' , 'facts' : { 'vars' : {} } } - { 'name' : 'test1' , 'facts' : { 'vars' : { 'name' : [ '1' , '2' ] } } } - { 'name' : 'test2' , 'facts' : { 'vars' : { 'name' : [ '3' ] } } } - { 'name' : 'test3' } - { 'name' : 'test4' , 'facts' : { 'vars' : { 'name' : [ '4' ] } } } - { 'name' : 'test5' , 'facts' : { 'vars' : { 'name' : [ '5' , '6' ] } } } - { 'name' : 'test6' , 'facts' : {} } - { 'name' : 'test7' , 'facts' : { 'vars' : {} } } - { 'name' : 'test8' , 'facts' : { 'vars' : {} } } - { 'name' : 'test9' } tasks : - debug : var=test - debug : msg : |- {%- for t in test | selectattr('facts.vars.name','defined') | map(attribute='facts.vars.name') | reject('equalto', [])-%} {%- for i in t -%} {{i}} {%-if not loop.last-%},{%-endif-%} {%-endfor-%} {%-if not loop.last-%},{%-endif-%} {%-endfor-%} # \u4e0d\u4f7f\u7528for\u5faa\u73af - debug : msg={{ test | selectattr('facts.vars.name','defined') | map(attribute='facts.vars.name') | list | flatten }}","title":"\u5c06\u5b57\u5178\u4e2d\u5b58\u5728\u7684 key \u90a3\u4e00\u9879\u7684\u5176\u4ed6 key \u7684 value \u62fc\u63a5\u6210\u5b57\u7b26\u4e32"},{"location":"advanced/practice/snippets/#_15","text":"\u6709\u65f6\uff0c\u6211\u4eec\u5728\u96c6\u7fa4\u4e2d\u9700\u8981\u6309\u987a\u5e8f\u6267\u884c\u67d0\u4e9b\u547d\u4ee4\uff0c\u4e0d\u80fd\u5e76\u884c\u6267\u884c\uff0c\u8fd9\u65f6\u53ef\u4ee5\u4f7f\u7528delegate_to\u548c\u5faa\u73af\u63a7\u5236\u6765\u914d\u5408\u4f7f\u7528\u8fbe\u5230\u76ee\u7684\uff0c\u4e0b\u5217\u6848\u4f8b\u662f\u6bcf\u6b21\u5faa\u73af\u5230\u4e3b\u673a\u6267\u884c\u547d\u4ee4\uff0c\u5faa\u73af\u95f4\u9694\u65f6\u95f4\u4e3a2\u79d2\u4e00\u6b21\u3002 --- - hosts: 192.168.77.130 192.168.77.131 192.168.77.132 tasks: - name: test shell: date delegate_to: \"{{ item }}\" run_once: true with_items: - \"{{ play_hosts }}\" loop_control: pause: 2 \u4e0b\u5217\u662f \u672c\u672b \u63d0\u4f9b\u7684","title":"\u6309\u987a\u5e8f\u6267\u884c\u547d\u4ee4"},{"location":"advanced/practice/snippets/#shell-jinja2","text":"# \u6211\u4eec\u77e5\u9053\uff0c\u4efb\u4f55\u80fd\u5199\u53d8\u91cf\u7684\u5730\u65b9\u90fd\u80fd\u5d4c\u5957 jinja2 \u8868\u8fbe\u5f0f # \u800c shell \u6a21\u5757\u4e2d\u7684\u5185\u5bb9\u5230\u5ba2\u6237\u7aef\u6e32\u67d3\u540e\u4e5f\u662f\u4e00\u4e2a\u53ef\u6267\u884c\u811a\u672c # \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5728 shell \u5185\u7f16\u5199\u6bd4\u5e73\u65f6\u66f4\u590d\u6742\u7684\u811a\u672c --- - name : Run shell shell : |- {% if foo is defined %} mkdir -p /tmp/{{ foo }} {% else %} if [[ ! ${foo} ]];then mkdir -p /var/lib/{{ bar }} echo 'success' else echo 'falure' fi {% endif %}","title":"\u5728 shell \u6a21\u5757\u4e2d\u4f7f\u7528\u811a\u672c\u5199\u6cd5\u4e0e jinja2"},{"location":"advanced/practice/snippets/#jinja2","text":"## # \u5728\u4f7f\u7528 jiaja2 if \u5224\u65ad\u4e00\u4e2a\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u9632\u6b62\u7a7a\u683c\u8ddf\u6362\u884c\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u5199\u5728\u4e00\u884c\u5224\u65ad\uff0c\u4f46\u662f\u5c55\u793a\u5374\u4e0d\u592a\u53cb\u597d - set_fact : GET_REPO : \"{% if ENV == 'UAT' %}git@192.168.1.24:xnph-devops/conf-test.git{% else %}git@192.168.1.24:xnph-devops/conf.git{% endif %}\" # \u4e00\u884c\u5197\u957f\u7684\u8868\u8fbe\u5f0f\u770b\u7740\u5f88\u4e0d\u76f4\u89c2\uff0c\u6211\u4eec\u53ef\u4ee5\u501f\u52a9 jinja2 \u7684\u2018-\u2019\u5b9e\u73b0\u6362\u884c\u5199\uff0c\u5e76\u5ffd\u7565\u6362\u884c\u7b26 # \u5176\u4e2d\uff1a # |- \u4e3a\u5757\u6807\u7b7e\u5ffd\u7565\u6362\u884c # {%- -%} \u4e3a\u5ffd\u7565\u6362\u884c --- - set_fact : GIT_REPO : |- { % - if ENV == 'UAT' -% } git@192.168.1.24:xnph-devops/conf-test.git { % - else -% } git@192.168.1.24:xnph-devops/conf.git { % - endif -% }","title":"\u5c55\u5f00 jinja2 \u4e2d\u7684\u4e00\u884c\u7684\u8868\u8fbe\u5f0f"},{"location":"advanced/practice/snippets/#jinja2-if-else","text":"# \u6211\u4eec\u5728\u7f16\u5199 jinja2 if else \u7684\u8868\u8fbe\u5f0f\u65f6\uff0c\u901a\u5e38\u90fd\u662f\u50cf\u8fd9\u6837\u7684\uff1a # \u4e0b\u9762\u4f8b\u5b50\uff0c\u7d22\u5f15 ID \u5c0f\u4e8e 3 \u7684\u90fd\u5206\u914d\u4e3a master --- - set_fact : role : >- { % - if ansible_play_hosts.index(inventory_hostname) < 3 -% } master { % - else -% } slave { % - endif -% } ## # \u6211\u4eec\u5229\u7528 python \u7279\u6027\uff0c\u53ef\u4ee5\u7b80\u5199\u5982\u4e0b\uff1a - set_fact : role : \"{{ ['slave','master'][ansible_play_hosts.index(inventory_hostname) < 3] }}\" # \u5373\uff0c\u5148\u5224\u65ad ansible_play_hosts.index(inventory_hostname) < 3 \u662f\u5426\u6210\u7acb\uff0c # \u5982\u679c\u6210\u7acb\uff0c\u5373 true\uff0c\u5931\u8d25\u4e3a false # \u800c python \u4e2d true==>1,false==>0 # \u518d\u53d6['slave','master']\u5217\u8868\u7d22\u5f15 # \u5176\u4e2d ansible_play_hosts \u4e3a\u5f53\u524d\u4efb\u52a1\u6267\u884c\u7684\u6240\u6709\u4e3b\u673a","title":"\u7b80\u6613\u7684 jinja2 'if else'\u8868\u8fbe\u5f0f"},{"location":"advanced/practice/snippets/#_16","text":"# \u5728 setup \u4e2d\u5176\u5b9e\u6709\u65f6\u95f4\u5b57\u6bb5\uff0c\u4f46\u662f\u88ab\u62c6\u5206\uff0c\u6216\u8005\u683c\u5f0f\u95ee\u9898\u4e0d\u597d\u5904\u7406\uff0c\u6211\u4eec\u901a\u8fc7\u5185\u7f6e\u65b9\u6cd5\u80fd\u66f4\u4fbf\u6377\u7684\u83b7\u53d6 # 2019-07-02:11 # \u683c\u5f0f\u53ef\u4ee5\u81ea\u5b9a\u4e49 - set_fact : datetime : \"{{ '%Y-%d-%m:%H' | strftime() }}\" # \u4f46\u662f\u8fd9\u6837\u53d6\u7684\u65f6\u95f4\u5728\u5ba2\u6237\u7aef\u65f6\u95f4\u51fa\u73b0\u4e0d\u4e00\u81f4\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u51fa\u73b0\u95ee\u9898\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u901a\u8fc7\u53e6\u5916\u4e00\u4e2a\u529e\u6cd5 # \u5373\uff1a\u901a\u8fc7 lookup \u63d2\u4ef6(lookup \u63d2\u4ef6\u5de5\u4f5c\u5728\u63a7\u5236\u7aef\u672c\u673a)\uff0c\u7edf\u4e00\u83b7\u53d6\u672c\u673a\u65f6\u95f4 - set_fact : datetime : \"{{ lookup('pipe','date +%Y-%d-%m:%H') }}\"","title":"\u83b7\u53d6\u5f53\u524d\u65f6\u95f4"},{"location":"advanced/practice/snippets/#_17","text":"## # \u5047\u8bbe\u6211\u4eec\u6709\u5982\u4e0b playbook: - hosts : group_a vars : foo_var : foo bar_var : bar tasks : - debug : msg=\"I like the {{ {{ key }}\\_var }}\" # \u4ee5\u4e0a\u6267\u884c\u5fc5\u7136\u662f\u56de\u62a5\u9519\u7684\uff0c # \u5176\u4e2d{{ key }}\u662f\u6211\u4eec\u60f3\u901a\u8fc7\u52a8\u6001\u4f20\u5165 foo \u6216\u8005 bar \u6765\u83b7\u53d6 foo_var \u6216\u8005 bar_var \u7684\u503c # \u4e3a\u6b64\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 lookup \u7684 vars \u63d2\u4ef6\u6765\u67e5\u5230\u76ee\u7684,\u6539\u9020\u5982\u4e0b\uff1a --- - hosts : group_a vars : foo_var : foo bar_var : bar tasks : - debug : msg=\"I like the {{ lookup('vars', key + '_var') }}\" # \u6267\u884c\u4f20\u5165 key=foo ansible-playbook test.yml -e 'key=foo'","title":"\u5355\u72ec\u53d8\u91cf\u5d4c\u5957"},{"location":"advanced/practice/snippets/#_18","text":"## # \u5047\u8bbe\u6211\u4eec\u6709\u5982\u4e0b playbook - hosts : group_a vars : project : foo : foo_value bar : bar_value tasks : - debug : msg=\"I like the {{ project.{{ key }} }}\" # \u5f53\u7136\uff0c\u4ee5\u4e0a\u6267\u884c\u662f\u4f1a\u62a5\u9519\u7684\uff0c # \u5176\u4e2d{{ key }}\u5373\u4e3a\u6211\u60f3\u901a\u8fc7\u52a8\u6001\u4f20\u5165 foo \u6216\u8005 bar \u6765\u83b7\u53d6 project \u4e0b\u7684\u952e\u503c # \u4e3a\u6b64\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u5199\uff1a --- - hosts : group_a vars : project : foo : foo_value bar : bar_value tasks : - debug : msg=\"I like the {{ project[key] }}\" # \u6267\u884c\u4f20\u5165 key=foo ansible-playbook test.yml -e 'key=foo'","title":"\u5b57\u5178\u53d8\u91cf\u5d4c\u5957"},{"location":"advanced/practice/snippets/#tags","text":"# \u6211\u4eec\u5bf9\u591a\u4e2a\u4efb\u52a1\u505a\u4e86 tags,\u800c\u6211\u4eec\u8fd0\u884c\u4efb\u52a1\u800c\u4e0d\u6307\u5b9a-t \u65f6\uff0c\u9ed8\u8ba4\u4f1a\u8fd0\u884c\u6240\u6709\u7684\u4efb\u52a1 # \u6709\u65f6\u5019\u8fd9\u5e76\u4e0d\u662f\u6211\u4eec\u6240\u671f\u671b\u7684\uff0c\u6240\u4ee5\u60f3\u5f53\u4e0d\u6307\u5b9a tags \u65f6\u5019\u4e0d\u8fd0\u884c\u540e\u9762\u7684\u4efb\u52a1 --- - hosts : localhost gather_facts : false tasks : - fail : msg : \"\u4f60\u5fc5\u987b\u6307\u5b9a\u4e00\u4e2a tags[-t]\" when : \"ansible_run_tags == ['all']\" run_once : true - debug : msg='hello {{ ansible_run_tags }}' tags : - abc # \u5373\uff0c\u53ea\u8981 ansible_run_tags \u9ed8\u8ba4\u503c\u4e3a['all']\u65f6\uff0c\u4efb\u52a1\u5c31\u76f4\u63a5\u5931\u8d25 \\$ ansible-playbook abc.yml PLAY [localhost] ******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\******* TASK [fail] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* fatal : [localhost] : FAILED! => {\"changed\" : false, \"msg\" : \"\u4f60\u5fc5\u987b\u6307\u5b9a\u4e00\u4e2a tags[-t]\"} PLAY RECAP ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* localhost : ok=0 changed=0 unreachable=0 failed=1 # \u5176\u4e2d\uff1a # ansible_run_tags \u4e3a ansible \u5185\u7f6e\u53d8\u91cf\uff0c\u9ed8\u8ba4\u503c\u4e3a['all'] 9.\u8bbf\u95ee\u5176\u4ed6\u4e3b\u673a\u7684\u53d8\u91cf ## # A \u4e3b\u673a\u6709\u53d8\u91cf foo=archive,B \u4e3b\u673a\u60f3\u4f7f\u7528 A \u4e3b\u673a\u7684{{ foo }}\u600e\u4e48\u529e\u5462\uff1f - hosts : A:B tasks : - debug : msg={{ hostvars['A']['foo'] }} # \u5927\u90e8\u5206\u7684\u53d8\u91cf\u5bf9\u8c61\u90fd\u5b58\u653e\u5728 hostvars \u4e2d","title":"\u9650\u5236\u5fc5\u987b\u6307\u5b9a\u81f3\u5c11\u4e00\u4e2a tags \u624d\u80fd\u8fd0\u884c\u4efb\u52a1"},{"location":"advanced/practice/snippets/#_19","text":"# \u4ec0\u4e48\u610f\u601d\u5462\uff0c\u5373\uff0c\u6709 N \u4e3b\u673a\uff0c\u6709\u76f8\u540c\u7684\u53d8\u91cf score,\u4f46\u662f\u503c\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u73b0\u5728\u60f3\u8ba1\u7b97\u5b83\u4eec\u7684 score \u548c # \u5047\u5b9a inventory \u5982\u4e0b\uff1a \\$ cat inventory.ini [public] 10.18.12.213 score=77 10.18.16.166 score=100 10.18.16.167 score=81 10.18.16.168 score=56 # \u8ba1\u7b97 score \u7684\u548c - hosts : localhost tasks : - debug : msg={{ ansible_play_hosts_all | map('extract',hostvars,'score') | sum }} # \u6267\u884c\u7ed3\u679c \\$ ansible-playbook -i inventory.ini score_sum.yml PLAY [public] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* TASK [Gathering Facts] ******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\******* ok : [10.18.16.167] ok : [10.18.16.166] ok : [10.18.16.168] ok : [10.18.12.213] TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [10.18.12.213] => { \"msg\" : \"314\" } ok : [10.18.16.166] => { \"msg\" : \"314\" } ok : [10.18.16.167] => { \"msg\" : \"314\" } ok : [10.18.16.168] => { \"msg\" : \"314\" } PLAY RECAP ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* 10.18.12.213 : ok=2 changed=0 unreachable=0 failed=0 10.18.16.166 : ok=2 changed=0 unreachable=0 failed=0 10.18.16.167 : ok=2 changed=0 unreachable=0 failed=0 10.18.16.168 : ok=2 changed=0 unreachable=0 failed=0 # \u5176\u4ed6\u4f8b\u5b50\uff1a # \u83b7\u53d6\u6240\u6709\u4e3b\u673a\u7684\u5e8f\u5217\u53f7\uff0c\u5e76\u4ee5','\u8fde\u63a5 - debug : msg={{ ansible_play_hosts_all | map('extract',hostvars,'ansible_product_serial') | join(',') }} # \u83b7\u53d6\u6240\u6709\u4e3b\u673a\u5185\u5b58\u7684\u603b\u548c - debug : msg={{ ansible_play_hosts_all | map('extract',hostvars,'ansible_memtotal_mb') | sum }} # \u5176\u4e2d\uff1a # ansible_play_hosts_all \u4e3a\u5f53\u524d\u4efb\u52a1\u6267\u884c\u7684\u6240\u6709\u4e3b\u673a # map \u65b9\u6cd5\u53c2\u8003 python map # sum \u4e3a\u8ba1\u7b97 list \u7684\u548c","title":"\u8ba1\u7b97\u4e0d\u540c\u4e3b\u673a\u4e2d\u76f8\u540c\u53d8\u91cf\u7684\u548c"},{"location":"advanced/practice/snippets/#_20","text":"# \u4f7f\u7528 ls /tmp \u7684\u8f93\u51fa\u4f5c\u4e3a loop \u5faa\u73af\u7684\u503c # \u5176\u4e2d\uff1aq == query # query \u4e0e lookup \u90fd\u5de5\u4f5c\u5728\u672c\u673a --- - hosts : localhost gather_facts : tasks : - debug : msg={{ item }} loop : \"{{ q('lines','ls /tmp/') }}\"","title":"\u4f7f\u7528\u672c\u5730\u547d\u4ee4\u7684\u503c\u4f5c\u4e3a\u5faa\u73af\u53c2\u6570"},{"location":"advanced/practice/snippets/#_21","text":"# \u5047\u5b9a\u6709 2 \u4e2a\u5217\u8868 # a_list: [1,2] # b_list: ['jack', 'green', 'apple'] # \u9700\u8981\u5d4c\u5957\u5faa\u73af\u8f93\u51fa\uff1a # jack-1,,green-1,apple-1,jack-2,green-2... --- - hosts : localhost vars : a_list : [1,2] b_list : ['jack', 'green', 'apple'] gather_facts : false tasks : - debug : msg=\"{{ item[1] }}-{{ item[0] }}\" loop : \"{{ a_list | product(b_list) | list }}\" \\$ ansible-playbook loops.yml PLAY [localhost] ******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\******* TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [localhost] => (item=[1, u'jack']) => { \"msg\" : \"jack-1\" } ok : [localhost] => (item=[1, u'green']) => { \"msg\" : \"green-1\" } ok : [localhost] => (item=[1, u'apple']) => { \"msg\" : \"apple-1\" } ok : [localhost] => (item=[2, u'jack']) => { \"msg\" : \"jack-2\" } ok : [localhost] => (item=[2, u'green']) => { \"msg\" : \"green-2\" } ok : [localhost] => (item=[2, u'apple']) => { \"msg\" : \"apple-2\" } PLAY RECAP ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* localhost : ok=1 changed=0 unreachable=0 failed=0","title":"\u5d4c\u5957\u4e24\u4e2a\u5217\u8868\u7684\u5faa\u73af\u4efb\u52a1"},{"location":"advanced/practice/snippets/#_22","text":"# \u5bf9\u4e8e\u5168\u5c40\u4efb\u52a1\u6eda\u52a8\u6267\u884c # \u8bbe\u7f6e serial \u4e3a 1\uff0c\u6216\u8005\u5176\u4ed6\u7684\u6570\u503c\uff0c\u4f1a\u6309\u8fd9\u4e2a\u6570\u91cf\u7684\u4e3b\u673a\u53bb\u6eda\u52a8\u6267\u884c\u4efb\u52a1 # \u6bcf\u4e2a\u4efb\u52a1\u7ed3\u5c3e\u4f1a\u505c\u987f 5s,\u518d\u4e0b\u4e00\u4e2a\u4e3b\u673a - hosts : public serial : 1 gather_facts : false tasks : - name : I\\'m the first task debug : msg=\"hello {{ inventory_hostname }}\" - name : Sleep task wait_for : delay : 5 when : (ansible_play_hosts_all.index[-1] != inventory_hostname) # \u5bf9\u4e8e\u6700\u540e\u4e00\u53f0\u4e3b\u673a\uff0c\u662f\u4e0d\u9700\u8981\u6267\u884c wait_for \u4efb\u52a1\u7684\uff0c\u6240\u4ee5\u5224\u65ad\u6700\u540e\u4e00\u53f0\u4e3b\u673a\u8df3\u8fc7 wait_for # \u5176\u4e2d\uff1a # serial \u4e3a\u6eda\u52a8\u6267\u884c\u7684\u5173\u952e\u5b57\uff0c\u53ef\u4ee5\u662f\u6570\u503c\u6216\u8005\u767e\u5206\u6bd4(%) # ansible_play_hosts_all \u4e3a\u5f53\u524d\u4efb\u52a1\u6267\u884c\u7684\u6240\u6709\u4e3b\u673a # inventory_hostname \u4e3a\u5404\u4e2a\u4e3b\u673a\u81ea\u5df1","title":"\u5168\u5c40\u4efb\u52a1\u6eda\u52a8\u6267\u884c"},{"location":"advanced/practice/snippets/#_23","text":"# \u628a\u9700\u8981\u6eda\u52a8\u6267\u884c\u7684\u4efb\u52a1\u653e\u5165 include_tasks \u4e2d\uff0c # \u5229\u7528 loop \u5faa\u73af\u6240\u6709\u5f53\u524d\u6267\u884c\u7684\u4e3b\u673a(ansible_play_hosts_all),\u5373: # \u53ea\u6709\u653e\u5165 other.yml \u7684\u4efb\u52a1\u4f1a\u4e00\u53f0\u4e00\u53f0\u6267\u884c # \u8bbe\u7f6e run_once \u907f\u514d\u6bcf\u4e2a\u4e3b\u673a\u90fd\u591a\u6b21\u91cd\u590d\u6267\u884c --- - hosts : public tasks : - debug : msg=\"I'm the Top public task\" - include_tasks : other.yml loop : \"{{ ansible_play_hosts_all }}\" loop_control : loop_var : target_host run_once : true ## # other.yml - block : - shell : hostname -I register : res - debug : msg=\"I'm {{ res.stdout }}\" delegate_to : \"{{ target_host }}\" # \u5176\u4e2d: # ansible_play_hosts_all \u4e3a\u524d\u671f\u6267\u884c\u7684\u6240\u6709 host # loop_control \u7684 loop_var \u628a item \u8d4b\u503c\u7ed9 target_host,\u5373\uff0ctarget_host==item,\u9632\u6b62 other \u91cc\u5176\u4ed6\u4efb\u52a1\u8c03\u7528 loop\uff0citem \u53d8\u91cf\u51b2\u7a81 # run_once:\u6bcf\u4e2a\u5faa\u73af\u5bf9\u8c61\u53ea\u5141\u8bb8\u4e00\u6b21\uff0c\u4e0d\u8bbe\u7f6e\u7684\u8bdd\uff0c\u4f1a\u91cd\u590d\u8fd0\u884c # delegate_to \u59d4\u6d3e\u4efb\u52a1 # \u53e6\u5916\uff0c\u8be5\u65b9\u6cd5\u6709\u4e2a\u7f3a\u70b9\u662f\u7531\u4e8e\u59d4\u6d3e\u8005\u90fd\u662f\u7b2c\u4e00\u53f0\u4e3b\u673a\uff0c\u5bf9\u5e94\u7684 facts \u53d8\u91cf\u90fd\u662f\u8be5\u59d4\u6d3e\u8005\u7684\uff0c\u6240\u4ee5\u6ca1\u6cd5\u4f7f\u7528\u5176\u4ed6\u4e3b\u673a\u7684\u5185\u7f6e\u53d8\u91cf # \u6545\u6848\u4f8b\u4e2d\u4e5f\u662f\u4f7f\u7528 register+shell \u6765\u83b7\u53d6\u7684\u4e3b\u673a\u540d\uff0c\u800c\u4e0d\u662f{{ inventory_hostname }} # \u6267\u884c\u7ed3\u679c\uff1a \\$ ansible-playbook rolling.yml PLAY [public] ******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\******* TASK [Gathering Facts] ******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\******* ok : [10.18.16.167] ok : [10.18.16.166] ok : [10.18.16.168] ok : [10.18.12.213] TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [10.18.12.213] => { \"msg\" : \"I'm the Top public task\" } ok : [10.18.16.167] => { \"msg\" : \"I'm the Top public task\" } ok : [10.18.16.166] => { \"msg\" : \"I'm the Top public task\" } ok : [10.18.16.168] => { \"msg\" : \"I'm the Top public task\" } TASK [include_tasks] ******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\*******\\*\\*\\*\\******* included : /tmp/other.yml for 10.18.12.213 included : /tmp/other.yml for 10.18.12.213 included : /tmp/other.yml for 10.18.12.213 included : /tmp/other.yml for 10.18.12.213 TASK [shell] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* changed : [10.18.12.213 -> 10.18.12.213] TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [10.18.12.213 -> 10.18.12.213] => { \"msg\" : \"I'm 10.18.12.213 \" } TASK [shell] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* changed : [10.18.12.213 -> 10.18.16.166] TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [10.18.12.213 -> 10.18.16.166] => { \"msg\" : \"I'm 10.18.16.166 \" } TASK [shell] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* changed : [10.18.12.213 -> 10.18.16.167] TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [10.18.12.213 -> 10.18.16.167] => { \"msg\" : \"I'm 10.18.16.167 \" } TASK [shell] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* changed : [10.18.12.213 -> 10.18.16.168] TASK [debug] ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* ok : [10.18.12.213 -> 10.18.16.168] => { \"msg\" : \"I'm 10.18.16.168 \" } PLAY RECAP ********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\*********\\*\\********* 10.18.12.213 : ok=14 changed=4 unreachable=0 failed=0 10.18.16.166 : ok=2 changed=0 unreachable=0 failed=0 10.18.16.167 : ok=2 changed=0 unreachable=0 failed=0 10.18.16.168 : ok=2 changed=0 unreachable=0 failed=0","title":"\u90e8\u5206\u4efb\u52a1\u6eda\u52a8\u6267\u884c"},{"location":"advanced/practice/snippets/#when-jinja2","text":"# \u5728 when \u91cc\u662f\u53ef\u4ee5\u4f7f\u7528 jinja2 \u8868\u8fbe\u5f0f\u7684\uff0c\u53ea\u8981\u683c\u5f0f\u89c4\u8303\u5373\u53ef\u3002 # \u4e00\u884c\u8868\u8fbe\u5f0f\uff1a --- - hosts : target_host tasks : - name : Show debug debug : msg='\u6761\u4ef6\u6ee1\u8db3\u4f60\u5c31\u4f1a\u770b\u5230\u6211\u3002' when : '{% if def_a_var|d(\"abc\") == \"abc\" %}{{ foo | d(\"true\") }}{% endif %}' ## # \u7b49\u4ef7\u7684\u5c55\u5f00\u8868\u8fbe\u5f0f - hosts : target_host tasks : - name : Show debug debug : msg='\u6761\u4ef6\u6ee1\u8db3\u4f60\u5c31\u4f1a\u770b\u5230\u6211\u3002' when : |- { % - if def_a_var|d(\"abc\") == \"abc\" -% } {{ foo | d(\"true\") }} { % - endif -% } # \u6267\u884c\uff08\u4f1a\u6709\u8b66\u544a\u63d0\u793a\uff09: ansible-playbook test.yml PLAY [localhost] ********************************\\*\\*\\*\\*********************************\\*\\*\\*\\*********************************\\*\\*\\*\\********************************* TASK [Gathering Facts] ********************************\\*\\*********************************\\*\\*********************************\\*\\********************************* ok : [localhost] TASK [Show debug] ********************************\\*\\*\\*\\*********************************\\*\\*\\*********************************\\*\\*\\*\\********************************* [ WARNING ] : when statements should not include jinja2 templating delimiters such as {{ }} or {% %}. Found : {% if def_a_var|d(\"abc\") == \"abc\" %}{{ foo | d(\"true\") }}{% endif %} ok : [localhost] => { \"msg\" : \"\u6761\u4ef6\u6ee1\u8db3\u4f60\u5c31\u4f1a\u770b\u5230\u6211\u3002\" } PLAY RECAP **********************************\\*\\*\\*\\***********************************\\*\\***********************************\\*\\*\\*\\*********************************** localhost : ok=2 changed=0 unreachable=0 failed=0","title":"\u5728 when \u91cc\u4f7f\u7528 jinja2 \u8868\u8fbe\u5f0f"},{"location":"advanced/practice/snippets/#_24","text":"# \u901a\u5e38\u6211\u4eec\u5728\u5b9a\u4e49\u591a\u4e2a\u7c7b\u4f3c\u53d8\u91cf\u65f6\uff0c\u4e0d\u540c\u53d8\u91cf\u6709\u5b9a\u4e49\u76f8\u540c\u7684\u5185\u5bb9 # \u6bd4\u5982\uff1a --- - hosts : localhost vars : project_1 : port : 8080 jvm : '-Xms1G -Xmx1G' run_user : devops root : /data/project_1 project_2 : port : 8080 jvm : '-Xms1G -Xmx1G' run_user : devops root : /data/project_2 tasks : - debug : var=project_1 - debug : var=project_2 # \u53ef\u4ee5\u770b\u5230`project_2`\u4e2d\u7684\u5f88\u591a\u952e\u503c\u90fd\u8ddf`project_1`\u4e2d\u662f\u4e00\u6837\u7684\uff0c # \u90a3\u4e48\u6211\u4eec\u6709\u4ec0\u4e48\u529e\u6cd5\u7b80\u5316\u5462\uff1f # \u5bf9\u6b64\uff0cyaml \u4e2d\u63d0\u4f9b\u4e86'&'\u6765\u63cf\u5b9a\u4e00\u4e2a\u53d8\u91cf\uff0c\u5e76\u7ed9\u63cf\u5b9a\u7684\u53d8\u91cf\u8bbe\u7f6e\u4e00\u4e2a\u522b\u540d\uff0c # \u5176\u4ed6\u53d8\u91cf\u8981\u5f15\u7528\u951a\u5b9a\u53d8\u91cf\u7684\u503c\uff0c\u9700\u8981\u518d\u4f7f\u7528'<<'\u6765\u5f15\u7528\u5e76\u7528\\*\u6307\u5411\u8bbe\u7f6e\u7684\u522b\u540d # \u53e6\u5916\uff0c\u5177\u6709\u76f8\u540c\u952e\u7684\u53d8\u91cf\u4f1a\u88ab\u540e\u8005\u8986\u76d6 # \u5373\uff1aproject_2 \u7684 root \u4f1a\u8986\u76d6\u5f15\u7528 project_1 \u7684 root # \u4fee\u6539\u5982\u4e0b\uff1a --- - hosts : localhost vars : project_1 : &conf_anchor port : 8080 jvm : '-Xms1G -Xmx1G' run_user : devops root : /data/project_1 project_2 : << : \\*conf_anchor root : /data/project_2 tasks : - debug : var=project_1 - debug : var=project_2 # \u5176\u4e2d\uff1a # & \u4e3a\u951a\u5b9a\u6807\u8bc6 # conf_anchor \u4e3a\u8bbe\u7f6e\u7684\u522b\u540d # << \u4e3a\u5408\u5e76\u952e # \\* \u4e3a\u5f15\u7528\u7b26 # \u6267\u884c\u5982\u4e0b\uff08\u53d8\u91cf\u8986\u76d6\u4f1a\u6709\u8b66\u544a\uff09\uff1a \\$ ansible-playbook anchor.yml [ WARNING ] : While constructing a mapping from /tmp/anchor.yml, line 10, column 7, found a duplicate dict key (root). Using last defined value only. PLAY [localhost] ********************************************************************\\*\\*\\*\\********************************************************************* TASK [Gathering Facts] ******************************************************************\\*\\******************************************************************* ok : [localhost] TASK [debug] **********************************************************************\\*\\*\\*\\*********************************************************************** ok : [localhost] => { \"project_1\" : { \"jvm\" : \"-Xms1G -Xmx1G\" , \"port\" : 8080 , \"root\" : \"/data/project_1\" , \"run_user\" : \"devops\" } } TASK [debug] **********************************************************************\\*\\*\\*\\*********************************************************************** ok : [localhost] => { \"project_2\" : { \"jvm\" : \"-Xms1G -Xmx1G\" , \"port\" : 8080 , \"root\" : \"/data/project_2\" , \"run_user\" : \"devops\" } } PLAY RECAP ************************************************************************\\*\\************************************************************************* localhost : ok=3 changed=0 unreachable=0 failed=0","title":"\u53d8\u91cf\u4f7f\u7528\u951a\u5b9a\u548c\u522b\u540d"},{"location":"advanced/practice/snippets/#_25","text":"- hosts : localhost vars : app : version : &my_version 1.1.1 name : - \"app_name\" - \\*my_version tasks : debug : msg : app version is \"{{ app.name | join('-') }}\". # \u6267\u884c \\$ ansible-playbook app.yml PLAY [localhost] ********************************************************************\\*\\*\\********************************************************************* TASK [Gathering Facts] ******************************************************************\\******************************************************************* ok : [localhost] TASK [debug] **********************************************************************\\*\\*\\*********************************************************************** ok : [localhost] => { \"msg\" : \"app version is \\\"app_name-1.1.1\\\".\" } PLAY RECAP ************************************************************************\\************************************************************************* localhost : ok=2 changed=0 unreachable=0 failed=0","title":"\u5f15\u7528\u951a\u5b9a\u53d8\u91cf"},{"location":"advanced/practice/snippets/#_26","text":"- hosts : localhost vars : center : &C x : 1 y : 2 round : &R r : 3.1415 big : << : [*C,*R] g : 3x10e tasks : - debug : var=big # \u6267\u884c\uff1a ansible-playbook muti.yml PLAY [localhost] ********************************************************************\\*\\*\\********************************************************************* TASK [Gathering Facts] ******************************************************************\\******************************************************************* ok : [localhost] TASK [debug] **********************************************************************\\*\\*\\*********************************************************************** ok : [localhost] => { \"big\" : { \"g\" : \"3x10e\" , \"r\" : 3.1415 , \"x\" : 1 , \"y\" : 2 } } PLAY RECAP ************************************************************************\\************************************************************************* localhost : ok=2 changed=0 unreachable=0 failed=0","title":"\u5408\u5e76\u591a\u4e2a\u5b57\u5178"},{"location":"advanced/practice/snippets/#key","text":"# yaml \u662f\u76f4\u63a5\u53ef\u4ee5\u5b9a\u4e49\u5e26\u7a7a\u683c\u7684\u53d8\u91cf\u7684 # \u6216\u8005\u4f60\u53ef\u4ee5\u7528?:\u7684\u65b9\u5f0f # \u4e24\u8005\u5b8c\u5168\u7b49\u4ef7\u7684\u3002 - hosts : localhost vars : my_vars : # \u76f4\u63a5\u5b9a\u4e49 'this is a key1' : 'this is a value1' # \u6216\u8005\u4f7f\u7528?:\u7684\u65b9\u5f0f ? 'this is a key2' : 'this is a value2' tasks : - debug : var=my_vars # \u6267\u884c \\$ ansible-playbook space_var.yml PLAY [localhost] ******************************************************************************\\*\\******************************************************************************* TASK [Gathering Facts] **************************************************************************\\*\\*\\*\\*************************************************************************** ok : [localhost] TASK [debug] ********************************************************************************\\*\\********************************************************************************* ok : [localhost] => { \"my_vars\" : { \"this is a key1\" : \"this is a value1\" , \"this is a key2\" : \"this is a value2\" } } PLAY RECAP ********************************************************************************\\*\\*\\*\\********************************************************************************* localhost : ok=2 changed=0 unreachable=0 failed=0","title":"\u5b9a\u4e49\u5e26\u7a7a\u683c\u7684 key"},{"location":"advanced/practice/snippets/#_27","text":"# \u5176\u5b9e\u5728\u5b9a\u4e49\u53d8\u91cf\u65f6\uff0c\u6211\u4eec\u662f\u53ef\u4ee5\u8bbe\u7f6e\u7c7b\u578b\u7684\u3002 # \u5f53\u7136\uff0c\u4f60\u5728\u52a0\u5f15\u53f7\u4e0e\u4e0d\u52a0\u5f15\u53f7\u65f6\u5c31\u80fd\u89e3\u51b3\u5927\u591a\u7684\u5b9a\u4e49\u95ee\u9898 - hosts : localhost vars : type_vars : is_str : !!str 9111 is_int : !!int '8081' is_float : !!float 2019 is_bool : !!bool 'yes' tasks : - debug : var=type_vars # \u6267\u884c\uff1a \\$ ansible-playbook type_vars.yml PLAY [localhost] ******************************************************************************\\*\\******************************************************************************* TASK [Gathering Facts] **************************************************************************\\*\\*\\*\\*************************************************************************** ok : [localhost] TASK [debug] ********************************************************************************\\*\\********************************************************************************* ok : [localhost] => { \"type_vars\" : { \"is_bool\" : true , \"is_float\" : 2019.0 , \"is_int\" : 8081 , \"is_str\" : \"9111\" } } PLAY RECAP ********************************************************************************\\*\\*\\*\\********************************************************************************* localhost : ok=2 changed=0 unreachable=0 failed=0","title":"\u5b9a\u4e49\u53d8\u91cf\u65f6\uff0c\u8bbe\u7f6e\u7c7b\u578b"},{"location":"advanced/practice/snippets/#_28","text":"# \u5229\u7528 format \u53ef\u4ee5\u4fdd\u7559\u7cbe\u5ea6 \\$ ansible localhost -m debug -a \"msg={{ '%0.2f -- %0.3f -- %d'| format(123,2.7,4.44) }}\" localhost | SUCCESS => { \"msg\" : \"123.00 -- 2.700 -- 4\" }","title":"\u6570\u5b57\u7cbe\u5ea6"},{"location":"advanced/practice/snippets/#handlers","text":"# \u6211\u4eec\u5728\u4f7f\u7528ansible\u90e8\u7f72\u591a\u5b9e\u4f8b\u4efb\u52a1\u65f6 # \u591a\u4e2a\u5b9e\u4f8b\u5b8c\u6210\u540e\u9700\u8981\u89e6\u53d1handler\u4efb\u52a1\u6765\u91cd\u542f\u5404\u4e2a\u5b9e\u4f8b\uff08\u5b9e\u4f8b\u540d\u79f0\u901a\u5e38\u662f\u52a8\u6001/\u4e0d\u56fa\u5b9a\u7684\uff09\uff0c # \u800c\u901a\u5e38\u5b9e\u4f8b\u7684\u670d\u52a1\u540d\u79f0\u662f\u6709\u533a\u522b\u7684\uff0c\u800c\u4e14\u662f\u6309\u9700\u91cd\u542f(\u6ee1\u8db3\u72b6\u6001\u53d8\u5316)\uff0c\u9010\u4e2a\u91cd\u542f # \u6211\u4eec\u53ef\u4ee5\u501f\u52a9json_query\u7684filter\u7279\u6027\u6765\u83b7\u53d6changed\u72b6\u6001\u6ee1\u8db3\u6761\u4ef6\u7684\u5b9e\u4f8b\u6765\u5faa\u73af\u91cd\u542f # \u5982\uff0c\u5b9e\u4f8b\u53d8\u91cf\u5982\u4e0b: --- vars : redis_ins_port : - 6379 - 6380 - 6381 # \u6211\u4eec\u8981\u5faa\u73af\u590d\u5236\u5b9e\u4f8b\u6a21\u677f\u5230\u5ba2\u6237\u7aef\uff0c\u89e6\u53d1handler\u540e\u53ea\u91cd\u542f\u53d1\u751f\u53d8\u5316\u7684\u5b9e\u4f8b # \u590d\u5236\u6a21\u677f\u5e76\u5c06\u4efb\u52a1\u72b6\u6001\u6ce8\u518c\u5230\u53d8\u91cf - name : template : src=redis.conf.j2 dest=/etc/redis/redis_{{ server_port }}.conf\" loop_control : loop_var : server_port loop : \"{{ redis_ins_port }}\" register : task_status notify : - Restart redis # handler\u4efb\u52a1 # \u5176\u4e2d\uff0cjson_query\u4e3a\u67e5\u8be2task_status\u4e2dchanged\u7684\u72b6\u6001\u4e3atrue\u7684\u6240\u6709server_port --- - name : Restart redis systemd : name=redis_{{ item }} state=restarted\" loop : \"{{ task_status | json_query('results[?changed].server_port') }}","title":"\u5faa\u73af(\u591a\u5b9e\u4f8b)\u4efb\u52a1\u89e6\u53d1 handlers \u91cd\u542f\u4efb\u52a1"},{"location":"advanced/practice/snippets/#_29","text":"# \u6211\u4eec\u5728\u521b\u5efa\u4f8b\u5982mongodb replicasets\u65f6\uff0c\u4f7f\u7528\u6a21\u5757\u793a\u4f8b\u5982\u4e0b\uff1a # Create a replicaset called 'rs0' with the 3 provided members - name : Ensure replicaset rs0 exists mongodb_replicaset : login_host : localhost login_user : admin login_password : admin replica_set : rs0 members : - mongodb1:27017 - mongodb2:27017 - mongodb3:27017 when:ansible_play_hosts.index(inventory_hostname) == 0 # \u5bf9\u4e8e\u5176\u4e2d\u7684member\u5982\u4f55\u80fd\u4e0d\u56fa\u5b9a\u901a\u8fc7\u65b9\u6cd5\u81ea\u52a8\u521b\u5efa\u5462\uff1f # \u8bd5\u60f3\uff0c\u6211\u4eec\u5df2\u7ecf\u6709\u4e86\u6267\u884c\u7684\u4e3b\u673a\u5217\u8868ansible_play_hosts # (\u867d\u7136\u91cc\u9762\u7684\u503c\u53ef\u80fd\u662f\u522b\u540d,\u5373\uff1ainventory_hostname) # \u4f46\u662f\u8fd9\u4e2a\u5217\u8868\u4e48\u6709\u5bf9\u5e94\u7684\u7aef\u53e3\uff0c\u5373\u6211\u4eec\u9700\u8981\u4fee\u6539\u5217\u8868\u91cc\u7684\u6bcf\u4e00\u9879\uff0c\u6dfb\u52a0\u4e00\u4e2a\u7aef\u53e3\u5373\u53ef # \u50cf\u8fd9\u6837\uff1a['10.18.1.190:27017','10.18.1.191:27017','10.18.1.192:27017'] # \u6539\u52a8\u5982\u4e0b\uff1a - name : Ensure replicaset rs0 exists mongodb_replicaset : login_host : localhost login_user : admin login_password : admin replica_set : rs0 members : >- {{ anible_play_hosts | map('extract' , hostvars , 'ansible_default_ipv4' ) | list | json_query(' [ * ] .address') |map('regex_replace' , '(.*)' , '\\\\1:' + '27017' | list }} when : ansible_play_hosts.index(inventory_hostname) == 0 # \u5176\u4e2d: # ansible_play_hosts\u4e3a\u5f53\u524d\u6267\u884c\u7684\u6240\u6709\u4e3b\u673a\u5217\u8868 # \u7b2c\u4e00\u4e2amap extract\u4e3a\u63d0\u53d6hostvars\u4e2d\u6bcf\u4e2aansible_play_hosts\u7684\u503c\u4f5c\u4e3a\u952e\uff0c\u5e76\u53d6ansible_default_ipv4,\u5c31\u50cf\uff1ahostvars[inventory_hostname]['ansible_default_ipv4'] # list\u628amap\u5bf9\u8c61\u8f6c\u6362\u6210\u5217\u8868 # json_query\u628a\u5217\u8868\u5185\u6bcf\u4e2aaddress\u63d0\u53d6\u51fa\u6765\u53d8\u6210\u65b0\u7684\u5217\u8868,\u5230\u6b64\u662f\u4e3a\u4e86\u63d0\u53d6IP\u5730\u5740\u5217\u8868\uff0c\u5f53\u7136\uff0c\u4f60ansible_play_hosts\u662fIP\u5730\u5740\u7684\u8bdd\u53ef\u4ee5\u4e0d\u7528\u8fd9\u4e48\u9ebb\u70e6 # \u7b2c\u4e8c\u4e2amap regex_replace\u628a\u6bcf\u4e2aIP\u5730\u5740\u53d8\u6210IP+:27017\uff0c # \u6700\u540e\u518d\u628a\u6211\u4eec\u7684map\u5bf9\u8c61\u8f6c\u6210list\uff0c\u5f97\u5230\u6211\u4eec\u60f3\u8981\u7684\uff1a['10.18.1.190:27017','10.18.1.191:27017','10.18.1.192:27017']","title":"\u4fee\u6539\u5217\u8868\u5185\u7684\u6240\u6709\u5b57\u6bb5\u503c\uff0c\u751f\u6210\u65b0\u7684\u5217\u8868"},{"location":"advanced/practice/snippets/#id","text":"\u4f7f\u7528\u4e3b\u673a\u53d8\u91cf [ cluster ] node01 ansible_host=10.18.1.190 id=1 role=master node02 ansible_host=10.18.1.191 id=2 role=slave node03 ansible_host=10.18.1.192 id=3 role=slave \u4f7f\u7528\u6267\u884c\u4e3b\u673a\u5217\u8868\u7684\u7d22\u5f15\u5b9a\u4e49 ID, \u9700\u8981\u540c\u65f6\u6267\u884c\u96c6\u7fa4\u4e3b\u673a # hosts [ cluster ] node01 ansible_host=10.18.1.190 node02 ansible_host=10.18.1.191 node03 ansible_host=10.18.1.192 # tasks --- - hosts : cluster gather_facts : false tasks : # ansible_play_hosts_all\u662f\u5f53\u524d\u6267\u884c\u7684\u6240\u6709\u4e3b\u673a\u5217\u8868\uff0c\u7c7b\u578b\u4e3a\u6709\u5e8flist, # inventory_hostname\u4e3a\u5404\u81ea\u6267\u884c\u4e3b\u673a\u7684\u540d\u5b57 # \u5373\uff1a\u5728list\u4e2d\u627e\u51fa\u5404\u81ea\u540d\u5b57\u7684\u7d22\u5f15\u505a\u4e3aID\u503c - set_fact : id={{ ansible_play_hosts_all.index(inventory_hostname) }} # \u4f7f\u7528id\u65f6\u5019\u8bf7\u8f6c\u6362\u6210\u6574\u578b\uff0cset_fact\u4e0d\u4f1a\u5e2e\u4f60\u8f6c\u6362\u6570\u636e\u7c7b\u578b - debug : msg=\"{{ inventory_hostname }} --> ID --> {{ id | int }}\" # \u9012\u589e10 - set_fact : id={{ ansible_play_hosts_all.index(inventory_hostname) * 10 }} # \u9012\u51cf5 - set_fact : id={{ 100 - ansible_play_hosts_all.index(inventory_hostname) * 5 }} \u5b9a\u4e49\u89d2\u8272 --- - hosts : cluster gather_facts : false tasks : # \u8fd9\u91cc\u4e3a\u4e86\u66f4\u597d\u7684\u5c55\u793a\uff0c\u4f7f\u7528\u4e86>\u6362\u884c\u8bed\u53e5 - set_fact : role : >- {# \u5373\uff0c\u7d22\u5f15ID\u5c0f\u4e8e3\u7684\u90fd\u5206\u914d\u4e3amaster #} {%- if ansible_play_hosts_all.index(inventory_hostname) < 3 -%} master {%- else -%} slave {%- endif -%} - debug : msg=\"{{ inventory_hostname }} --> role --> {{ role }}\" \u65e2\u5206\u914d id \u53c8\u5206\u914d\u89d2\u8272 --- - hosts : cluster gather_facts : false tasks : - set_fact : id={{ ansible_play_hosts_all.index(inventory_hostname) }} # id\u5c0f\u4e8e3\u7684\u90fd\u89c6\u4e3amaster,\u8bb0\u5f97\u8981\u8f6c\u6362\u4e3a\u6574\u5f62\uff0cset_fact\u4e0d\u4f1a\u5e2e\u4f60\u5904\u7406\u6570\u636e\u7c7b\u578b # PS: \u8fd9\u91cc\u7528\u4e86python\u7684\u5c0f\u6280\u5de7\uff0c\u7528jinja2\u7684if\u53bb\u5224\u65ad\u4e5f\u662f\u4e00\u6837\u7684 - set_fact : role : \"{{ ['slave','master'][id|int<3] }}\" - debug : msg=\"ID--> {{ id | int }}, role --> {{ role }}\"","title":"\u7ed9\u96c6\u7fa4\u4e3b\u673a\u81ea\u52a8\u5206\u914d ID/\u89d2\u8272"},{"location":"advanced/security/","text":"Ansible \u63a7\u5236\u8282\u70b9\u5b89\u5168\u8bbe\u7f6e \u00b6 Ansible \u63a7\u5236\u8282\u70b9\u4f5c\u4e3a\u7ba1\u7406\u5176\u4ed6\u670d\u52a1\u5668\u7684\u603b\u63a7\u5236\u5668\uff0c\u5176\u6240\u5904\u7684\u670d\u52a1\u5668\u5fc5\u5b9a\u5b58\u5728\u5927\u91cf\u7684\u5bc6\u7801\u4fe1\u606f\u6216\u79d8\u94a5\uff0c\u6216\u8005\u6709\u6743\u8fde\u63a5\u8fdc\u7a0b\u670d\u52a1\u5668\u3002\u90a3\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u63a7\u5236\u7aef\u6709\u5b89\u5168\u9690\u60a3\uff0c\u4ece\u800c\u843d\u5230\u4ed6\u4eba\u4e4b\u624b\uff0c\u540e\u679c\u4e0d\u582a\u8bbe\u60f3\u3002\u90a3\u6211\u4eec\u600e\u4e48\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\uff0c\u505a\u597d\u5b89\u5168\u7b56\u7565\u662f\u5173\u952e\u3002 \u4e0b\u9762\u6211\u5217\u51fa\u4e86\u4e00\u4e9b\u5b89\u5168\u7b56\u7565\uff1a \u670d\u52a1\u5668\u4e0d\u653e\u7f6e\u5728\u516c\u7f51\u73af\u5883\u3002 \u4e0d\u5b89\u88c5\u4efb\u4f55\u670d\u52a1\uff0c\u53ea\u5f00\u542fssh\u7aef\u53e3\u3002 \u9650\u5236\u7ba1\u7406\u4eba\u5458\u767b\u5f55\u7684ip\u5730\u5740\u3002 \u52a0\u5bc6\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\uff0c\u9632\u6b62\u4fe1\u606f\u6cc4\u9732\u3002 \u547d\u4ee4\u5ba1\u8ba1\u3002 ssh\u767b\u5f55\u4e8c\u6b21\u9a8c\u8bc1\u3002 ... \u4e0b\u9762\u662f\u662f\u4e0a\u9762\u5b89\u5168\u7b56\u7565\u7684\u5b9e\u65bd\u65b9\u6cd5\uff1a \u8282\u70b9\u5b89\u5168: \u9632\u706b\u5899\u8bbe\u7f6e \u8282\u70b9\u5b89\u5168: ssh\u767b\u5f55\u4e8c\u6b21\u9a8c\u8bc1 \u8282\u70b9\u5b89\u5168: \u547d\u4ee4\u5ba1\u8ba1 \u8282\u70b9\u5b89\u5168: \u52a0\u5bc6\u4e3b\u673a\u6e05\u5355","title":"Ansible \u63a7\u5236\u8282\u70b9\u5b89\u5168"},{"location":"advanced/security/#ansible","text":"Ansible \u63a7\u5236\u8282\u70b9\u4f5c\u4e3a\u7ba1\u7406\u5176\u4ed6\u670d\u52a1\u5668\u7684\u603b\u63a7\u5236\u5668\uff0c\u5176\u6240\u5904\u7684\u670d\u52a1\u5668\u5fc5\u5b9a\u5b58\u5728\u5927\u91cf\u7684\u5bc6\u7801\u4fe1\u606f\u6216\u79d8\u94a5\uff0c\u6216\u8005\u6709\u6743\u8fde\u63a5\u8fdc\u7a0b\u670d\u52a1\u5668\u3002\u90a3\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u63a7\u5236\u7aef\u6709\u5b89\u5168\u9690\u60a3\uff0c\u4ece\u800c\u843d\u5230\u4ed6\u4eba\u4e4b\u624b\uff0c\u540e\u679c\u4e0d\u582a\u8bbe\u60f3\u3002\u90a3\u6211\u4eec\u600e\u4e48\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\uff0c\u505a\u597d\u5b89\u5168\u7b56\u7565\u662f\u5173\u952e\u3002 \u4e0b\u9762\u6211\u5217\u51fa\u4e86\u4e00\u4e9b\u5b89\u5168\u7b56\u7565\uff1a \u670d\u52a1\u5668\u4e0d\u653e\u7f6e\u5728\u516c\u7f51\u73af\u5883\u3002 \u4e0d\u5b89\u88c5\u4efb\u4f55\u670d\u52a1\uff0c\u53ea\u5f00\u542fssh\u7aef\u53e3\u3002 \u9650\u5236\u7ba1\u7406\u4eba\u5458\u767b\u5f55\u7684ip\u5730\u5740\u3002 \u52a0\u5bc6\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\uff0c\u9632\u6b62\u4fe1\u606f\u6cc4\u9732\u3002 \u547d\u4ee4\u5ba1\u8ba1\u3002 ssh\u767b\u5f55\u4e8c\u6b21\u9a8c\u8bc1\u3002 ... \u4e0b\u9762\u662f\u662f\u4e0a\u9762\u5b89\u5168\u7b56\u7565\u7684\u5b9e\u65bd\u65b9\u6cd5\uff1a \u8282\u70b9\u5b89\u5168: \u9632\u706b\u5899\u8bbe\u7f6e \u8282\u70b9\u5b89\u5168: ssh\u767b\u5f55\u4e8c\u6b21\u9a8c\u8bc1 \u8282\u70b9\u5b89\u5168: \u547d\u4ee4\u5ba1\u8ba1 \u8282\u70b9\u5b89\u5168: \u52a0\u5bc6\u4e3b\u673a\u6e05\u5355","title":"Ansible \u63a7\u5236\u8282\u70b9\u5b89\u5168\u8bbe\u7f6e"},{"location":"advanced/security/audit/","text":"\u670d\u52a1\u5668\u547d\u4ee4\u5ba1\u8ba1 \u00b6 \u670d\u52a1\u5668\u8bb0\u5f55\u547d\u4ee4 \u00b6 \u5b9e\u73b0\u8be5\u529f\u80fd\u8981\u6c42\u5982\u4e0b: 1.\u63a5\u53d7\u5ba1\u8ba1\u7684\u767b\u5f55\u7528\u6237\u9ed8\u8ba4shell\u5fc5\u987b\u4e3abash 2.bash\u7248\u672c\u81f3\u5c113.00\u6216\u4ee5\u4e0a \u9700\u8981\u8be5\u8981\u6c42\u7684\u539f\u56e0\u662f\u5b9e\u73b0\u529f\u80fd\u7684\u65b9\u6cd5\u9700\u8981\u7528\u5230history\u547d\u4ee4\u7684HISTTIMEFORMAT\u53d8\u91cf\u548cPROMPT_COMMAND\u53d8\u91cf. \u5bf9\u4e8e\u5176\u4ed6\u7684shell\u6211\u5e76\u672a\u6d4b\u8bd5.\u5982\u679c\u5176\u4ed6shell\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u53d8\u91cf\u7684\u529f\u80fd\u90a3\u4e48\u7406\u8bba\u4e0a\u4e5f\u53ef\u4ee5\u4f7f\u7528. \u5b9e\u73b0\u65b9\u6cd5\u5982\u4e0b: \u4f7f\u7528root\u7528\u6237\u64cd\u4f5c # 1.\u521b\u5efa\u4e00\u4e2a\u5ba1\u8ba1\u65e5\u5fd7\u6587\u4ef6 mkdir /var/log/shell_audit touch /var/log/shell_audit/audit.log # 2.\u5c06\u65e5\u5fd7\u6587\u4ef6\u6240\u6709\u8005\u8d4b\u4e88\u4e00\u4e2a\u6700\u4f4e\u6743\u9650\u7684\u7528\u6237 chown nobody:nobody /var/log/shell_audit/audit.log # 3.\u7ed9\u8be5\u65e5\u5fd7\u6587\u4ef6\u8d4b\u4e88\u6240\u6709\u4eba\u7684\u5199\u6743\u9650 chmod 002 /var/log/shell_audit/audit.log # 4.\u8bbe\u7f6e\u6587\u4ef6\u6743\u9650,\u4f7f\u6240\u6709\u7528\u6237\u5bf9\u8be5\u6587\u4ef6\u53ea\u6709\u8ffd\u52a0\u6743\u9650 chattr +a /var/log/shell_audit/audit.log # 5.\u7f16\u8f91/etc/profile, \u5728\u672b\u5c3e\u6dfb\u52a0\u4e0b\u9762\u5185\u5bb9 HISTSIZE = 2048 HISTTIMEFORMAT = \"%Y/%m/%d %T \" ; export HISTTIMEFORMAT export HISTORY_FILE = /var/log/shell_audit/audit.log export PROMPT_COMMAND = '{ code=$?;thisHistID=`history 1|awk \"{print \\\\$1}\"`;lastCommand=`history 1| awk \"{\\\\$1=\\\"\\\" ;print}\"`;user=`id -un`;whoStr=(`who -u am i`);realUser=${whoStr[0]};logDay=${whoStr[2]};logTime=${whoStr[3]};pid=${whoStr[5]};ip=${whoStr[6]};if [ ${thisHistID}x != ${lastHistID}x ];then echo -E `date \"+%Y/%m/%d %H:%M:%S\"` $user\\($realUser\\)@$ip[PID:$pid][LOGIN:$logDay $logTime] --- [$PWD]$lastCommand [$code];lastHistID=$thisHistID;fi; } >> $HISTORY_FILE' # \u91cd\u65b0\u767b\u5f55\u540e,\u5373\u53ef\u770b\u5230/var/log/shell_audit/audit.log\u5237\u65b0\u7684\u5b9e\u65f6\u65e5\u5fd7 2017 /07/08 16 :12:00 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :12:00 whoami [ 0 ] 2017 /07/08 16 :17:41 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :17:41 logrotate -vf /etc/logrotate.d/shell_audit [ 0 ] 2017 /07/08 16 :19:18 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :19:17 last [ 0 ] 2017 /07/08 16 :19:19 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :19:19 list [ 127 ] 2017 /07/08 16 :19:21 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :19:21 what [ 127 ] 2017 /07/08 16 :19:32 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :19:29 top [ 0 ] 2017 /07/08 16 :19:35 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :19:35 ps aux [ 0 ] # 2017/07/08 16:12:00 \u8bb0\u5f55\u65f6\u95f4/\u547d\u4ee4\u6267\u884c\u5b8c\u6210\u65f6\u95f4 # root(root) \u6267\u884c\u547d\u4ee4\u7684\u7528\u6237(\u6700\u521d\u767b\u5f55\u7684\u7528\u6237) # @(192.168.77.1) \u767b\u5f55\u7684IP # [PID:127876] \u6700\u521d\u767b\u5f55\u65f6\u7684LOGIN\u4ea7\u751f\u7684PID # [LOGIN:2017-07-08 15:55] \u547d\u4ee4\u6267\u884c\u5f00\u59cb\u7684\u65f6\u95f4 # [/root] \u547d\u4ee4\u6267\u884c\u7684\u5f53\u524d\u76ee\u5f55 # 2017/07/08 16:12:00 \u547d\u4ee4\u6267\u884c\u5f00\u59cb\u7684\u65f6\u95f4 # whoami \u6267\u884c\u7684\u547d\u4ee4 # [0] \u547d\u4ee4\u8fd4\u56de\u7684\u72b6\u6001\u7801 # 6. \u8bbe\u7f6eaudit.log\u7684\u65e5\u5fd7\u8f6e\u6362 ~ ] # cat /etc/logrotate.d/shell_audit /var/log/shell_audit/audit.log { weekly missingok dateext rotate 100 sharedscripts prerotate /usr/bin/chattr -a /var/log/shell_audit/audit.log endscript sharedscripts postrotate /bin/touch /var/log/shell_audit/audit.log /bin/chmod 002 /var/log/shell_audit/audit.log /bin/chown nobody:nobody /var/log/shell_audit/audit.log /usr/bin/chattr +a /var/log/shell_audit/audit.log endscript } # \u53ef\u4ee5\u6d4b\u8bd5\u4e00\u4e0b\uff01\u521a\u8dd1\u8fc7\u4e86\u4e00\u6b21\u3002 ~ ] # logrotate -vf /etc/logrotate.d/shell_audit reading config file /etc/logrotate.d/shell_audit reading config info for /var/log/shell_audit/audit.log Handling 1 logs rotating pattern: /var/log/shell_audit/audit.log forced from command line ( 100 rotations ) empty log files are rotated, old logs are removed considering log /var/log/shell_audit/audit.log log needs rotating rotating log /var/log/shell_audit/audit.log, log->rotateCount is 100 dateext suffix '-20170708' glob pattern '-[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]' glob finding old rotated logs failed running prerotate script renaming /var/log/shell_audit/audit.log to /var/log/shell_audit/audit.log-20170708 running postrotate script \u5ba2\u6237\u7aef\u8bb0\u5f55\u65e5\u5fd7 \u00b6 \u6211\u4eec\u5728\u4f7f\u7528xshell\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u65e5\u5fd7\u8bb0\u5f55\u3002 \u91cd\u65b0\u8fde\u63a5\uff0c\u5728xshell\u7a97\u53e3\u8f93\u5165\u547d\u4ee4\uff0c\u8be5\u8be5\u7a97\u53e3\u7684\u6240\u6709\u4fe1\u606f\u90fd\u4f1a\u8bb0\u5f55\u5230\u65e5\u5fd7\u6587\u4ef6\u4e2d\u3002","title":"- \u8282\u70b9\u5b89\u5168: \u547d\u4ee4\u5ba1\u8ba1"},{"location":"advanced/security/audit/#_1","text":"","title":"\u670d\u52a1\u5668\u547d\u4ee4\u5ba1\u8ba1"},{"location":"advanced/security/audit/#_2","text":"\u5b9e\u73b0\u8be5\u529f\u80fd\u8981\u6c42\u5982\u4e0b: 1.\u63a5\u53d7\u5ba1\u8ba1\u7684\u767b\u5f55\u7528\u6237\u9ed8\u8ba4shell\u5fc5\u987b\u4e3abash 2.bash\u7248\u672c\u81f3\u5c113.00\u6216\u4ee5\u4e0a \u9700\u8981\u8be5\u8981\u6c42\u7684\u539f\u56e0\u662f\u5b9e\u73b0\u529f\u80fd\u7684\u65b9\u6cd5\u9700\u8981\u7528\u5230history\u547d\u4ee4\u7684HISTTIMEFORMAT\u53d8\u91cf\u548cPROMPT_COMMAND\u53d8\u91cf. \u5bf9\u4e8e\u5176\u4ed6\u7684shell\u6211\u5e76\u672a\u6d4b\u8bd5.\u5982\u679c\u5176\u4ed6shell\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u53d8\u91cf\u7684\u529f\u80fd\u90a3\u4e48\u7406\u8bba\u4e0a\u4e5f\u53ef\u4ee5\u4f7f\u7528. \u5b9e\u73b0\u65b9\u6cd5\u5982\u4e0b: \u4f7f\u7528root\u7528\u6237\u64cd\u4f5c # 1.\u521b\u5efa\u4e00\u4e2a\u5ba1\u8ba1\u65e5\u5fd7\u6587\u4ef6 mkdir /var/log/shell_audit touch /var/log/shell_audit/audit.log # 2.\u5c06\u65e5\u5fd7\u6587\u4ef6\u6240\u6709\u8005\u8d4b\u4e88\u4e00\u4e2a\u6700\u4f4e\u6743\u9650\u7684\u7528\u6237 chown nobody:nobody /var/log/shell_audit/audit.log # 3.\u7ed9\u8be5\u65e5\u5fd7\u6587\u4ef6\u8d4b\u4e88\u6240\u6709\u4eba\u7684\u5199\u6743\u9650 chmod 002 /var/log/shell_audit/audit.log # 4.\u8bbe\u7f6e\u6587\u4ef6\u6743\u9650,\u4f7f\u6240\u6709\u7528\u6237\u5bf9\u8be5\u6587\u4ef6\u53ea\u6709\u8ffd\u52a0\u6743\u9650 chattr +a /var/log/shell_audit/audit.log # 5.\u7f16\u8f91/etc/profile, \u5728\u672b\u5c3e\u6dfb\u52a0\u4e0b\u9762\u5185\u5bb9 HISTSIZE = 2048 HISTTIMEFORMAT = \"%Y/%m/%d %T \" ; export HISTTIMEFORMAT export HISTORY_FILE = /var/log/shell_audit/audit.log export PROMPT_COMMAND = '{ code=$?;thisHistID=`history 1|awk \"{print \\\\$1}\"`;lastCommand=`history 1| awk \"{\\\\$1=\\\"\\\" ;print}\"`;user=`id -un`;whoStr=(`who -u am i`);realUser=${whoStr[0]};logDay=${whoStr[2]};logTime=${whoStr[3]};pid=${whoStr[5]};ip=${whoStr[6]};if [ ${thisHistID}x != ${lastHistID}x ];then echo -E `date \"+%Y/%m/%d %H:%M:%S\"` $user\\($realUser\\)@$ip[PID:$pid][LOGIN:$logDay $logTime] --- [$PWD]$lastCommand [$code];lastHistID=$thisHistID;fi; } >> $HISTORY_FILE' # \u91cd\u65b0\u767b\u5f55\u540e,\u5373\u53ef\u770b\u5230/var/log/shell_audit/audit.log\u5237\u65b0\u7684\u5b9e\u65f6\u65e5\u5fd7 2017 /07/08 16 :12:00 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :12:00 whoami [ 0 ] 2017 /07/08 16 :17:41 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :17:41 logrotate -vf /etc/logrotate.d/shell_audit [ 0 ] 2017 /07/08 16 :19:18 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :19:17 last [ 0 ] 2017 /07/08 16 :19:19 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :19:19 list [ 127 ] 2017 /07/08 16 :19:21 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :19:21 what [ 127 ] 2017 /07/08 16 :19:32 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :19:29 top [ 0 ] 2017 /07/08 16 :19:35 root ( root ) @ ( 192 .168.77.1 )[ PID:127876 ][ LOGIN:2017-07-08 15 :55 ] --- [ /root ] 2017 /07/08 16 :19:35 ps aux [ 0 ] # 2017/07/08 16:12:00 \u8bb0\u5f55\u65f6\u95f4/\u547d\u4ee4\u6267\u884c\u5b8c\u6210\u65f6\u95f4 # root(root) \u6267\u884c\u547d\u4ee4\u7684\u7528\u6237(\u6700\u521d\u767b\u5f55\u7684\u7528\u6237) # @(192.168.77.1) \u767b\u5f55\u7684IP # [PID:127876] \u6700\u521d\u767b\u5f55\u65f6\u7684LOGIN\u4ea7\u751f\u7684PID # [LOGIN:2017-07-08 15:55] \u547d\u4ee4\u6267\u884c\u5f00\u59cb\u7684\u65f6\u95f4 # [/root] \u547d\u4ee4\u6267\u884c\u7684\u5f53\u524d\u76ee\u5f55 # 2017/07/08 16:12:00 \u547d\u4ee4\u6267\u884c\u5f00\u59cb\u7684\u65f6\u95f4 # whoami \u6267\u884c\u7684\u547d\u4ee4 # [0] \u547d\u4ee4\u8fd4\u56de\u7684\u72b6\u6001\u7801 # 6. \u8bbe\u7f6eaudit.log\u7684\u65e5\u5fd7\u8f6e\u6362 ~ ] # cat /etc/logrotate.d/shell_audit /var/log/shell_audit/audit.log { weekly missingok dateext rotate 100 sharedscripts prerotate /usr/bin/chattr -a /var/log/shell_audit/audit.log endscript sharedscripts postrotate /bin/touch /var/log/shell_audit/audit.log /bin/chmod 002 /var/log/shell_audit/audit.log /bin/chown nobody:nobody /var/log/shell_audit/audit.log /usr/bin/chattr +a /var/log/shell_audit/audit.log endscript } # \u53ef\u4ee5\u6d4b\u8bd5\u4e00\u4e0b\uff01\u521a\u8dd1\u8fc7\u4e86\u4e00\u6b21\u3002 ~ ] # logrotate -vf /etc/logrotate.d/shell_audit reading config file /etc/logrotate.d/shell_audit reading config info for /var/log/shell_audit/audit.log Handling 1 logs rotating pattern: /var/log/shell_audit/audit.log forced from command line ( 100 rotations ) empty log files are rotated, old logs are removed considering log /var/log/shell_audit/audit.log log needs rotating rotating log /var/log/shell_audit/audit.log, log->rotateCount is 100 dateext suffix '-20170708' glob pattern '-[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]' glob finding old rotated logs failed running prerotate script renaming /var/log/shell_audit/audit.log to /var/log/shell_audit/audit.log-20170708 running postrotate script","title":"\u670d\u52a1\u5668\u8bb0\u5f55\u547d\u4ee4"},{"location":"advanced/security/audit/#_3","text":"\u6211\u4eec\u5728\u4f7f\u7528xshell\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u65e5\u5fd7\u8bb0\u5f55\u3002 \u91cd\u65b0\u8fde\u63a5\uff0c\u5728xshell\u7a97\u53e3\u8f93\u5165\u547d\u4ee4\uff0c\u8be5\u8be5\u7a97\u53e3\u7684\u6240\u6709\u4fe1\u606f\u90fd\u4f1a\u8bb0\u5f55\u5230\u65e5\u5fd7\u6587\u4ef6\u4e2d\u3002","title":"\u5ba2\u6237\u7aef\u8bb0\u5f55\u65e5\u5fd7"},{"location":"advanced/security/filter-command/","text":"\u8fc7\u6ee4\u5371\u9669\u547d\u4ee4 \u00b6 \u6279\u91cf\u6267\u884c\u547d\u4ee4\u65f6\uff0c\u9700\u8981\u628a\u4e00\u4e9b\u5371\u9669\u547d\u4ee4\u5c4f\u853d\u6389\uff0c\u4ece\u800c\u5c06\u964d\u4f4e\u4f7f\u7528\u4eba\u5458\u7684\u8bef\u64cd\u4f5c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.9.6.0 os Centos 7.7 X64 python 2.7.5 \u9700\u8981\u8fc7\u6ee4\u89c4\u5219\u7684\u6a21\u5757 \u00b6 command shell script raw \u9700\u8981\u8fc7\u6ee4\u7684\u547d\u4ee4 \u00b6 rm -rf / halt poweroff reboot shutdown -h now shutdown -r now \u7f16\u5199\u8fc7\u6ee4\u4ee3\u7801 \u00b6 \u6211\u4eec\u5728\u89e3\u6790\u5b8ctask\u540e\u8fdb\u884c\u8fc7\u6ee4\uff0c\u8fd9\u5c31\u662f /usr/lib/python2.7/site-packages/ansible/playbook/play.py \u4e2d\u7684Play\u7c7b\u7684load\u65b9\u6cd5 \u6211\u4eec\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u6dfb\u52a0filter_cmd\u65b9\u6cd5\uff0c\u8fdb\u884c\u8fc7\u6ee4\u547d\u4ee4\u3002 def filter_cmd ( data ): filter_modules = ( 'command' , 'shell' , 'script' , 'raw' ) filter_commands = ( 'rm -rf /' , 'halt' , 'poweroff' , 'reboot' , 'shutdown -h now' , 'shutdown -r now' ) filter_commands = map ( lambda x : x . replace ( ' ' , '' ) . lower (), filter_commands ) for t in data [ 'tasks' ]: if 'action' in t : if t [ 'action' ][ 'module' ] in filter_modules : if t [ 'action' ][ 'args' ][ '_raw_params' ] . replace ( ' ' , '' ) . lower () in filter_commands : raise AnsibleParserError ( \"Refused to execute the [ %s ] command in the [ %s ] module.\" % ( t [ 'action' ][ 'args' ][ '_raw_params' ], t [ 'action' ][ 'module' ])) else : for m in filter_modules : if m in t : args = parse_kv ( t [ m ], check_raw = True ) if args [ '_raw_params' ] . replace ( ' ' , '' ) . lower () in filter_commands : raise AnsibleParserError ( \"Refused to execute the [ %s ] command in the [ %s ] module.\" % ( t [ m ], m )) \u5728Play\u7c7b\u7684load\u65b9\u6cd5\u4e2d\u5f15\u7528filter_cmd\u8fc7\u6ee4\u547d\u4ee4 \u5728 p = Play() \u4e0a\u65b9\u6dfb\u52a0 filter_cmd(data) @staticmethod def load ( data , variable_manager = None , loader = None ): if ( 'name' not in data or data [ 'name' ] is None ) and 'hosts' in data : if isinstance ( data [ 'hosts' ], list ): data [ 'name' ] = ',' . join ( data [ 'hosts' ]) else : data [ 'name' ] = data [ 'hosts' ] filter_cmd ( data ) p = Play () return p . load_data ( data , variable_manager = variable_manager , loader = loader ) \u5728\u6587\u4ef6\u9876\u90e8\u5f15\u5165\u9700\u8981\u7684\u6a21\u5757 from ansible.parsing.splitter import parse_kv \u6d4b\u8bd5ansible \u00b6 [ root@master ansible ] # ansible node1 -m shell -a 'halt' ERROR! Refused to execute the [ halt ] command in the [ shell ] module. [ root@master ansible ] # ansible node1 -m shell -a 'rm -rf /' ERROR! Refused to execute the [ rm -rf / ] command in the [ shell ] module. [ root@master ansible ] # ansible node1 -m command -a 'shutdown -r now' ERROR! Refused to execute the [ shutdown -r now ] command in the [ command ] module. [ root@master ansible ] # ansible localhost -m command -a 'echo shutdown -r now' localhost | SUCCESS | rc = 0 >> shutdown -r now \u6d4b\u8bd5ansible-playbook \u00b6 \u4f7f\u7528rm\u5220\u9664/ [ root@master ansible ] # cat test_filter.yml --- - hosts: node1 tasks: - name: test command: \"Rm -rf / chdir=/tmp/ creates=/tmp/a.txt\" [ root@master ansible ] # ansible-playbook test_filter.yml ERROR! Refused to execute the [ Rm -rf / chdir = /tmp/ creates = /tmp/a.txt ] command in the [ command ] module. \u5173\u673a [ root@master ansible ] # cat test_filter.yml --- - hosts: node1 tasks: - name: test shell: \"shutdown -r now\" [ root@master ansible ] # ansible-playbook test_filter.yml ERROR! Refused to execute the [ shutdown -r now ] command in the [ shell ] module. \u6d4b\u8bd5\u6b63\u5e38\u901a\u8fc7\u3002 \u672c\u6b21\u6d4b\u8bd5\u8fc7\u6ee4\u53ea\u662f\u7ed9\u5927\u5bb6\u63d0\u4f9b\u4e00\u4e2a\u601d\u8def\uff0c\u5e76\u975e\u662f\u4e00\u4e2a\u5b8c\u7f8e\u7684\uff0c\u6709\u5f88\u591a\u4e1c\u897f\u5927\u5bb6\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u8fdb\u884c\u66f4\u6539\u3002","title":"\u8fc7\u6ee4 Ansible \u5371\u9669\u6307\u4ee4"},{"location":"advanced/security/filter-command/#_1","text":"\u6279\u91cf\u6267\u884c\u547d\u4ee4\u65f6\uff0c\u9700\u8981\u628a\u4e00\u4e9b\u5371\u9669\u547d\u4ee4\u5c4f\u853d\u6389\uff0c\u4ece\u800c\u5c06\u964d\u4f4e\u4f7f\u7528\u4eba\u5458\u7684\u8bef\u64cd\u4f5c\u3002","title":"\u8fc7\u6ee4\u5371\u9669\u547d\u4ee4"},{"location":"advanced/security/filter-command/#_2","text":"ansible 2.9.6.0 os Centos 7.7 X64 python 2.7.5","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"advanced/security/filter-command/#_3","text":"command shell script raw","title":"\u9700\u8981\u8fc7\u6ee4\u89c4\u5219\u7684\u6a21\u5757"},{"location":"advanced/security/filter-command/#_4","text":"rm -rf / halt poweroff reboot shutdown -h now shutdown -r now","title":"\u9700\u8981\u8fc7\u6ee4\u7684\u547d\u4ee4"},{"location":"advanced/security/filter-command/#_5","text":"\u6211\u4eec\u5728\u89e3\u6790\u5b8ctask\u540e\u8fdb\u884c\u8fc7\u6ee4\uff0c\u8fd9\u5c31\u662f /usr/lib/python2.7/site-packages/ansible/playbook/play.py \u4e2d\u7684Play\u7c7b\u7684load\u65b9\u6cd5 \u6211\u4eec\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u6dfb\u52a0filter_cmd\u65b9\u6cd5\uff0c\u8fdb\u884c\u8fc7\u6ee4\u547d\u4ee4\u3002 def filter_cmd ( data ): filter_modules = ( 'command' , 'shell' , 'script' , 'raw' ) filter_commands = ( 'rm -rf /' , 'halt' , 'poweroff' , 'reboot' , 'shutdown -h now' , 'shutdown -r now' ) filter_commands = map ( lambda x : x . replace ( ' ' , '' ) . lower (), filter_commands ) for t in data [ 'tasks' ]: if 'action' in t : if t [ 'action' ][ 'module' ] in filter_modules : if t [ 'action' ][ 'args' ][ '_raw_params' ] . replace ( ' ' , '' ) . lower () in filter_commands : raise AnsibleParserError ( \"Refused to execute the [ %s ] command in the [ %s ] module.\" % ( t [ 'action' ][ 'args' ][ '_raw_params' ], t [ 'action' ][ 'module' ])) else : for m in filter_modules : if m in t : args = parse_kv ( t [ m ], check_raw = True ) if args [ '_raw_params' ] . replace ( ' ' , '' ) . lower () in filter_commands : raise AnsibleParserError ( \"Refused to execute the [ %s ] command in the [ %s ] module.\" % ( t [ m ], m )) \u5728Play\u7c7b\u7684load\u65b9\u6cd5\u4e2d\u5f15\u7528filter_cmd\u8fc7\u6ee4\u547d\u4ee4 \u5728 p = Play() \u4e0a\u65b9\u6dfb\u52a0 filter_cmd(data) @staticmethod def load ( data , variable_manager = None , loader = None ): if ( 'name' not in data or data [ 'name' ] is None ) and 'hosts' in data : if isinstance ( data [ 'hosts' ], list ): data [ 'name' ] = ',' . join ( data [ 'hosts' ]) else : data [ 'name' ] = data [ 'hosts' ] filter_cmd ( data ) p = Play () return p . load_data ( data , variable_manager = variable_manager , loader = loader ) \u5728\u6587\u4ef6\u9876\u90e8\u5f15\u5165\u9700\u8981\u7684\u6a21\u5757 from ansible.parsing.splitter import parse_kv","title":"\u7f16\u5199\u8fc7\u6ee4\u4ee3\u7801"},{"location":"advanced/security/filter-command/#ansible","text":"[ root@master ansible ] # ansible node1 -m shell -a 'halt' ERROR! Refused to execute the [ halt ] command in the [ shell ] module. [ root@master ansible ] # ansible node1 -m shell -a 'rm -rf /' ERROR! Refused to execute the [ rm -rf / ] command in the [ shell ] module. [ root@master ansible ] # ansible node1 -m command -a 'shutdown -r now' ERROR! Refused to execute the [ shutdown -r now ] command in the [ command ] module. [ root@master ansible ] # ansible localhost -m command -a 'echo shutdown -r now' localhost | SUCCESS | rc = 0 >> shutdown -r now","title":"\u6d4b\u8bd5ansible"},{"location":"advanced/security/filter-command/#ansible-playbook","text":"\u4f7f\u7528rm\u5220\u9664/ [ root@master ansible ] # cat test_filter.yml --- - hosts: node1 tasks: - name: test command: \"Rm -rf / chdir=/tmp/ creates=/tmp/a.txt\" [ root@master ansible ] # ansible-playbook test_filter.yml ERROR! Refused to execute the [ Rm -rf / chdir = /tmp/ creates = /tmp/a.txt ] command in the [ command ] module. \u5173\u673a [ root@master ansible ] # cat test_filter.yml --- - hosts: node1 tasks: - name: test shell: \"shutdown -r now\" [ root@master ansible ] # ansible-playbook test_filter.yml ERROR! Refused to execute the [ shutdown -r now ] command in the [ shell ] module. \u6d4b\u8bd5\u6b63\u5e38\u901a\u8fc7\u3002 \u672c\u6b21\u6d4b\u8bd5\u8fc7\u6ee4\u53ea\u662f\u7ed9\u5927\u5bb6\u63d0\u4f9b\u4e00\u4e2a\u601d\u8def\uff0c\u5e76\u975e\u662f\u4e00\u4e2a\u5b8c\u7f8e\u7684\uff0c\u6709\u5f88\u591a\u4e1c\u897f\u5927\u5bb6\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u8fdb\u884c\u66f4\u6539\u3002","title":"\u6d4b\u8bd5ansible-playbook"},{"location":"advanced/security/firewall/","text":"\u9632\u706b\u5899\u8bbe\u7f6e \u00b6 \u89c4\u5219 \u00b6 \u53ea\u5f00\u542fssh\u7aef\u53e3\u3002 \u9650\u5236\u7ba1\u7406\u4eba\u5458\u767b\u5f55\u7684ip\u5730\u5740\u3002 Iptables \u00b6 # \u6e05\u9664\u6240\u6709\u89c4\u5219 iptables -F iptables -X iptables -Z # \u6dfb\u52a0\u89c4\u5219\uff0c\u53ea\u5141\u8bb8192.168.77.1\u5730\u5740\u8bbf\u95ee22\u7aef\u53e3\uff0c\u5176\u4ed6\u4e00\u5f8b\u7981\u6b62\u3002 iptables -I INPUT -s 192 .168.77.1/32 -p tcp --dport 22 -j ACCEPT iptables -A INPUT -p tcp --dport 22 -j DROP iptables -A INPUT -p icmp -j DROP iptables -P INPUT DROP # \u4fdd\u5b58\u914d\u7f6e\u5e76\u91cd\u542fiptables\u670d\u52a1 /etc/init.d/iptables save /etc/init.d/iptables restart Firewalld \u00b6 # \u6dfb\u52a0\u89c4\u5219\uff0c\u53ea\u5141\u8bb8192.168.77.1\u5730\u5740\u8bbf\u95ee22\u7aef\u53e3\uff0c\u5176\u4ed6\u4e00\u5f8b\u7981\u6b62\u3002 firewall-cmd --permanent --add-rich-rule = ' rule family=\"ipv4\" source address=\"192.168.77.1/32\" port protocol=\"tcp\" port=\"22\" accept' # \u91cd\u8f7d\u914d\u7f6e firewall-cmd --reload ufw \u00b6 # \u5f00\u542f ufw enbale # \u6dfb\u52a0\u89c4\u5219\uff0c\u53ea\u5141\u8bb8192.168.77.1\u5730\u5740\u8bbf\u95ee22\u7aef\u53e3\uff0c\u5176\u4ed6\u4e00\u5f8b\u7981\u6b62\u3002 ufw allow proto tcp from 192 .168.77.1 port 22 # \u6dfb\u52a0\u9ed8\u8ba4\u89c4\u5219\u4e3a\u7981\u7528 ufw default deny","title":"- \u8282\u70b9\u5b89\u5168: \u9632\u706b\u5899\u8bbe\u7f6e"},{"location":"advanced/security/firewall/#_1","text":"","title":"\u9632\u706b\u5899\u8bbe\u7f6e"},{"location":"advanced/security/firewall/#_2","text":"\u53ea\u5f00\u542fssh\u7aef\u53e3\u3002 \u9650\u5236\u7ba1\u7406\u4eba\u5458\u767b\u5f55\u7684ip\u5730\u5740\u3002","title":"\u89c4\u5219"},{"location":"advanced/security/firewall/#iptables","text":"# \u6e05\u9664\u6240\u6709\u89c4\u5219 iptables -F iptables -X iptables -Z # \u6dfb\u52a0\u89c4\u5219\uff0c\u53ea\u5141\u8bb8192.168.77.1\u5730\u5740\u8bbf\u95ee22\u7aef\u53e3\uff0c\u5176\u4ed6\u4e00\u5f8b\u7981\u6b62\u3002 iptables -I INPUT -s 192 .168.77.1/32 -p tcp --dport 22 -j ACCEPT iptables -A INPUT -p tcp --dport 22 -j DROP iptables -A INPUT -p icmp -j DROP iptables -P INPUT DROP # \u4fdd\u5b58\u914d\u7f6e\u5e76\u91cd\u542fiptables\u670d\u52a1 /etc/init.d/iptables save /etc/init.d/iptables restart","title":"Iptables"},{"location":"advanced/security/firewall/#firewalld","text":"# \u6dfb\u52a0\u89c4\u5219\uff0c\u53ea\u5141\u8bb8192.168.77.1\u5730\u5740\u8bbf\u95ee22\u7aef\u53e3\uff0c\u5176\u4ed6\u4e00\u5f8b\u7981\u6b62\u3002 firewall-cmd --permanent --add-rich-rule = ' rule family=\"ipv4\" source address=\"192.168.77.1/32\" port protocol=\"tcp\" port=\"22\" accept' # \u91cd\u8f7d\u914d\u7f6e firewall-cmd --reload","title":"Firewalld"},{"location":"advanced/security/firewall/#ufw","text":"# \u5f00\u542f ufw enbale # \u6dfb\u52a0\u89c4\u5219\uff0c\u53ea\u5141\u8bb8192.168.77.1\u5730\u5740\u8bbf\u95ee22\u7aef\u53e3\uff0c\u5176\u4ed6\u4e00\u5f8b\u7981\u6b62\u3002 ufw allow proto tcp from 192 .168.77.1 port 22 # \u6dfb\u52a0\u9ed8\u8ba4\u89c4\u5219\u4e3a\u7981\u7528 ufw default deny","title":"ufw"},{"location":"advanced/security/ssh-2step/","text":"ssh\u767b\u5f55\u4e8c\u6b21\u9a8c\u8bc1 \u00b6 \u672c\u6b21\u4e8c\u6b21\u8ba4\u8bc1\u65b9\u5f0f\u4f7f\u7528 Google \u8eab\u4efd\u9a8c\u8bc1\u5668 \u8d44\u6e90 \u00b6 \u8c37\u6b4c\u8eab\u4efd\u9a8c\u8bc1\u5668pam https://github.com/google/google-authenticator-libpam \u79fb\u52a8app\u6e90\u7801 https://github.com/google/google-authenticator Google \u8eab\u4efd\u9a8c\u8bc1\u5668\u5546\u5e97\u5730\u5740 https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2 Google \u8eab\u4efd\u9a8c\u8bc1\u5668app\u4e0b\u8f7d\u5730\u5740 https://storage.evozi.com/apk/dl/16/09/05/com.google.android.apps.authenticator2.apk?h=4FgH1NXU1UokEVwXN5sVBw&t=1499507124 \u670d\u52a1\u5668\u914d\u7f6e \u00b6 \u540c\u6b65\u65f6\u95f4 /usr/sbin/ntpdate asia.pool.ntp.org >>/var/log/ntpdate.log \u5b89\u88c5\u4f9d\u8d56\u5305 yum install pam-devel make gcc-c++ wget -y \u4e0b\u8f7d\u8c37\u6b4c\u8eab\u4efd\u9a8c\u8bc1\u5668\u5305 wget https://github.com/google/google-authenticator-libpam/archive/1.03.tar.gz \u7f16\u8bd1\u5b89\u88c5 tar zxf 1 .03.tar.gz cd google-authenticator-libpam-1.03/ ./bootstrap.sh ./configure make make install \u590d\u5236google \u8eab\u4efd\u9a8c\u8bc1\u5668pam\u6a21\u5757\u5230\u7cfb\u7edf\u4e0b cp /usr/local/lib/security/pam_google_authenticator.so /lib64/security/ \u4fee\u6539ssh\u7684pam\u767b\u5f55\u6a21\u5757\u4e3apam_google_authenticator.so # cat /etc/pam.d/sshd #%PAM-1.0 #auth required pam_sepermit.so auth required pam_google_authenticator.so auth include password-auth account required pam_nologin.so account include password-auth password include password-auth # pam_selinux.so close should be the first session rule session required pam_selinux.so close session required pam_loginuid.so # pam_selinux.so open should only be followed by sessions to be executed in the user context session required pam_selinux.so open env_params session optional pam_keyinit.so force revoke session include password-auth \u4fee\u6539ChallengeResponseAuthentication \u4e3ayes sed -i 's#^ChallengeResponseAuthentication no#ChallengeResponseAuthentication yes#' /etc/ssh/sshd_config \u751f\u6210key\uff0c\u624b\u673aapp\u4e0a\u6dfb\u52a0\u8d26\u6237\u6240\u9700\u8981\u7684\u3002 ./google-authenticator Do you want authentication tokens to be time-based ( y/n ) y https://www.google.com/chart?chs = 200x200 & chld = M | 0 & cht = qr & chl = otpauth://totp/root@node1%3Fsecret%3D6GY7RPMXCVWN6HHVSSX4XM3WWssuer%3Dnode1 ## \u4e8c\u7ef4\u7801 Your new secret key is: 6GY7RPMXCVWN6HHVSSX4XM3WWI ## \u5bc6\u94a5 Your verification code is 467014 Your emergency scratch codes are: ##\u540e\u5907\u9a8c\u8bc1\u7801\u4fdd\u5b58\u597d\uff0c\u6c38\u4e45\u53ef\u7528\u3002 66339556 56534014 64738014 23546970 43468735 Do you want me to update your \"/root/.google_authenticator\" file? ( y/n ) y ## \u914d\u7f6e\u6587\u4ef6 Do you want to disallow multiple uses of the same authentication token? This restricts you to one login about every 30s, but it increases your chances to notice or even prevent man-in-the-middle attacks ( y/n ) y By default, tokens are good for 30 seconds. In order to compensate for possible time-skew between the client and the server, we allow an extra token before and after the current time. If you experience problems with poor time synchronization, you can increase the window from its default size of +-1min ( window size of 3 ) to about +-4min ( window size of 17 acceptable tokens ) . Do you want to do so? ( y/n ) y If the computer that you are logging into isn ' t hardened against brute-force login attempts, you can enable rate-limiting for the authentication module. By default, this limits attackers to no more than 3 login attempts every 30s. Do you want to enable rate-limiting ( y/n ) y \u91cd\u542fssh\u670d\u52a1 service sshd restart \u91cd\u542f\u540e\uff0c\u4e0d\u8981\u5173\u95ed\u5f53\u524d\u7a97\u53e3\uff0c\u4ee5\u514d\u914d\u7f6e\u9519\u8bef\u51fa\u73b0\u767b\u5f55\u4e0d\u4e86\u670d\u52a1\u5668\u3002 \u624b\u673a\u7aef\u914d\u7f6e \u00b6 \u672c\u6b21\u4f7f\u7528\u5b89\u5353\u624b\u673a\uff0c\u4e0b\u8f7dapp\u5e76\u5b89\u88c5\u3002\u82f9\u679c\u624b\u673a\u5728\u82f9\u679c\u5546\u5e97\u91cc\u641c\u7d22google authenticator\u5e76\u5b89\u88c5\u3002 \u6dfb\u52a0\u5e10\u53f7 \u8f93\u5165\u521a\u624d\u751f\u6210\u7684key \u70b9\u51fb\u6dfb\u52a0 \u8fd9\u65f6\uff0c\u70b9\u51fb\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u6ca1\u7f8e30\u79d2\u4e00\u6b21\u53d8\u6362\u7684\u9a8c\u8bc1\u7801 ssh\u547d\u4ee4\u767b\u5f55 \u00b6 [ root@master ~ ] # ssh 192.168.77.129 Verification code: # \u5148\u8f93\u5165app\u4e0a\u7684\u9a8c\u8bc1\u7801 Password: # \u5728\u8f93\u5165root\u5bc6\u7801 Last login: Sat Jul 8 15 :55:59 2017 from 192 .168.77.1 [ root@node1 ~ ] # ifconfig eth0 eth0 Link encap:Ethernet HWaddr 00 :0C:29:7D:D4:7A inet addr:192.168.77.129 Bcast:192.168.77.255 Mask:255.255.255.0 inet6 addr: fe80::20c:29ff:fe7d:d47a/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:275309 errors:0 dropped:0 overruns:0 frame:0 TX packets:165531 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:298600746 ( 284 .7 MiB ) TX bytes:24281004 ( 23 .1 MiB ) xshell\u5ba2\u6237\u7aef\u767b\u5f55 \u00b6 \u8bbe\u7f6e\u767b\u9646\u65b9\u6cd5\u4e3aKeyboard Interactive \u5148\u8f93\u5165\u8c37\u6b4c\u9a8c\u8bc1\u7801 \u518d\u8f93\u5165root\u5bc6\u7801 \u6210\u529f\u767b\u5f55","title":"- \u8282\u70b9\u5b89\u5168: ssh\u767b\u5f55\u4e8c\u6b21\u9a8c\u8bc1"},{"location":"advanced/security/ssh-2step/#ssh","text":"\u672c\u6b21\u4e8c\u6b21\u8ba4\u8bc1\u65b9\u5f0f\u4f7f\u7528 Google \u8eab\u4efd\u9a8c\u8bc1\u5668","title":"ssh\u767b\u5f55\u4e8c\u6b21\u9a8c\u8bc1"},{"location":"advanced/security/ssh-2step/#_1","text":"\u8c37\u6b4c\u8eab\u4efd\u9a8c\u8bc1\u5668pam https://github.com/google/google-authenticator-libpam \u79fb\u52a8app\u6e90\u7801 https://github.com/google/google-authenticator Google \u8eab\u4efd\u9a8c\u8bc1\u5668\u5546\u5e97\u5730\u5740 https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2 Google \u8eab\u4efd\u9a8c\u8bc1\u5668app\u4e0b\u8f7d\u5730\u5740 https://storage.evozi.com/apk/dl/16/09/05/com.google.android.apps.authenticator2.apk?h=4FgH1NXU1UokEVwXN5sVBw&t=1499507124","title":"\u8d44\u6e90"},{"location":"advanced/security/ssh-2step/#_2","text":"\u540c\u6b65\u65f6\u95f4 /usr/sbin/ntpdate asia.pool.ntp.org >>/var/log/ntpdate.log \u5b89\u88c5\u4f9d\u8d56\u5305 yum install pam-devel make gcc-c++ wget -y \u4e0b\u8f7d\u8c37\u6b4c\u8eab\u4efd\u9a8c\u8bc1\u5668\u5305 wget https://github.com/google/google-authenticator-libpam/archive/1.03.tar.gz \u7f16\u8bd1\u5b89\u88c5 tar zxf 1 .03.tar.gz cd google-authenticator-libpam-1.03/ ./bootstrap.sh ./configure make make install \u590d\u5236google \u8eab\u4efd\u9a8c\u8bc1\u5668pam\u6a21\u5757\u5230\u7cfb\u7edf\u4e0b cp /usr/local/lib/security/pam_google_authenticator.so /lib64/security/ \u4fee\u6539ssh\u7684pam\u767b\u5f55\u6a21\u5757\u4e3apam_google_authenticator.so # cat /etc/pam.d/sshd #%PAM-1.0 #auth required pam_sepermit.so auth required pam_google_authenticator.so auth include password-auth account required pam_nologin.so account include password-auth password include password-auth # pam_selinux.so close should be the first session rule session required pam_selinux.so close session required pam_loginuid.so # pam_selinux.so open should only be followed by sessions to be executed in the user context session required pam_selinux.so open env_params session optional pam_keyinit.so force revoke session include password-auth \u4fee\u6539ChallengeResponseAuthentication \u4e3ayes sed -i 's#^ChallengeResponseAuthentication no#ChallengeResponseAuthentication yes#' /etc/ssh/sshd_config \u751f\u6210key\uff0c\u624b\u673aapp\u4e0a\u6dfb\u52a0\u8d26\u6237\u6240\u9700\u8981\u7684\u3002 ./google-authenticator Do you want authentication tokens to be time-based ( y/n ) y https://www.google.com/chart?chs = 200x200 & chld = M | 0 & cht = qr & chl = otpauth://totp/root@node1%3Fsecret%3D6GY7RPMXCVWN6HHVSSX4XM3WWssuer%3Dnode1 ## \u4e8c\u7ef4\u7801 Your new secret key is: 6GY7RPMXCVWN6HHVSSX4XM3WWI ## \u5bc6\u94a5 Your verification code is 467014 Your emergency scratch codes are: ##\u540e\u5907\u9a8c\u8bc1\u7801\u4fdd\u5b58\u597d\uff0c\u6c38\u4e45\u53ef\u7528\u3002 66339556 56534014 64738014 23546970 43468735 Do you want me to update your \"/root/.google_authenticator\" file? ( y/n ) y ## \u914d\u7f6e\u6587\u4ef6 Do you want to disallow multiple uses of the same authentication token? This restricts you to one login about every 30s, but it increases your chances to notice or even prevent man-in-the-middle attacks ( y/n ) y By default, tokens are good for 30 seconds. In order to compensate for possible time-skew between the client and the server, we allow an extra token before and after the current time. If you experience problems with poor time synchronization, you can increase the window from its default size of +-1min ( window size of 3 ) to about +-4min ( window size of 17 acceptable tokens ) . Do you want to do so? ( y/n ) y If the computer that you are logging into isn ' t hardened against brute-force login attempts, you can enable rate-limiting for the authentication module. By default, this limits attackers to no more than 3 login attempts every 30s. Do you want to enable rate-limiting ( y/n ) y \u91cd\u542fssh\u670d\u52a1 service sshd restart \u91cd\u542f\u540e\uff0c\u4e0d\u8981\u5173\u95ed\u5f53\u524d\u7a97\u53e3\uff0c\u4ee5\u514d\u914d\u7f6e\u9519\u8bef\u51fa\u73b0\u767b\u5f55\u4e0d\u4e86\u670d\u52a1\u5668\u3002","title":"\u670d\u52a1\u5668\u914d\u7f6e"},{"location":"advanced/security/ssh-2step/#_3","text":"\u672c\u6b21\u4f7f\u7528\u5b89\u5353\u624b\u673a\uff0c\u4e0b\u8f7dapp\u5e76\u5b89\u88c5\u3002\u82f9\u679c\u624b\u673a\u5728\u82f9\u679c\u5546\u5e97\u91cc\u641c\u7d22google authenticator\u5e76\u5b89\u88c5\u3002 \u6dfb\u52a0\u5e10\u53f7 \u8f93\u5165\u521a\u624d\u751f\u6210\u7684key \u70b9\u51fb\u6dfb\u52a0 \u8fd9\u65f6\uff0c\u70b9\u51fb\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u6ca1\u7f8e30\u79d2\u4e00\u6b21\u53d8\u6362\u7684\u9a8c\u8bc1\u7801","title":"\u624b\u673a\u7aef\u914d\u7f6e"},{"location":"advanced/security/ssh-2step/#ssh_1","text":"[ root@master ~ ] # ssh 192.168.77.129 Verification code: # \u5148\u8f93\u5165app\u4e0a\u7684\u9a8c\u8bc1\u7801 Password: # \u5728\u8f93\u5165root\u5bc6\u7801 Last login: Sat Jul 8 15 :55:59 2017 from 192 .168.77.1 [ root@node1 ~ ] # ifconfig eth0 eth0 Link encap:Ethernet HWaddr 00 :0C:29:7D:D4:7A inet addr:192.168.77.129 Bcast:192.168.77.255 Mask:255.255.255.0 inet6 addr: fe80::20c:29ff:fe7d:d47a/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:275309 errors:0 dropped:0 overruns:0 frame:0 TX packets:165531 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:298600746 ( 284 .7 MiB ) TX bytes:24281004 ( 23 .1 MiB )","title":"ssh\u547d\u4ee4\u767b\u5f55"},{"location":"advanced/security/ssh-2step/#xshell","text":"\u8bbe\u7f6e\u767b\u9646\u65b9\u6cd5\u4e3aKeyboard Interactive \u5148\u8f93\u5165\u8c37\u6b4c\u9a8c\u8bc1\u7801 \u518d\u8f93\u5165root\u5bc6\u7801 \u6210\u529f\u767b\u5f55","title":"xshell\u5ba2\u6237\u7aef\u767b\u5f55"},{"location":"advanced/security/vault-hosts/","text":"\u52a0\u5bc6\u4e3b\u673a\u6e05\u5355 \u00b6 \u4e3b\u673a\u6e05\u5355\u6e90\u6587\u4ef6 \u00b6 [root@master ansible]# cat /etc/ansible/hosts2 [node1] 192.168.77.129 ansible_ssh_pass=123456 [node2] 192.168.77.130 ansible_ssh_pass=123456 [node3] 192.168.77.131 ansible_ssh_pass=123456 \u4f7f\u75281234567\u5bc6\u7801\u8fdb\u884c\u52a0\u5bc6\u4e3b\u673a\u6e05\u5355 \u00b6 [root@master ansible]# ansible-vault encrypt /etc/ansible/hosts2 New Vault password: Confirm New Vault password: Encryption successful \u518d\u6b21\u53bb\u67e5\u770bhosts2\u7684\u6587\u4ef6\u5185\u5bb9\u65f6\uff0c\u5185\u5bb9\u662f\u5df2\u7ecf\u52a0\u5bc6\u8fc7\u7684\u4e86 [root@master ansible]# cat /etc/ansible/hosts2 $ANSIBLE_VAULT;1.1;AES256 39623561303563343739653030366332363466353462363632336433346537376263326331643338 6531636436633334633533363664663266393939613938650a656261396661633732353536353339 61663162323861613032376463326566393034653963633038303162626135303463303233373130 3437363561323131320a376665383735613961616537333266353565386237373433393162386332 35313265303137616438353964316662646136623665633132393566333465333563383438643431 36376366633735366564383735656434373436326238343363383132373931353839333139333131 31323437393232306437363563366662613139386635356161396630376439343832346662393136 65353537643761376230653965393864643333356338386537343061306166396137343664346561 65663630306134623362383065316134353062323636326231396630313761326631373862653836 65623161633837306536616432646236646261656232626135396631666166636632643465383663 653832366630616363336566626432353164 \u7f16\u8f91\u52a0\u5bc6\u540e\u7684\u4e3b\u673a\u6e05\u5355\u6587\u4ef6 \u00b6 [root@master ~]# ansible-vault edit /etc/ansible/hosts2 --ask-vault-pass Vault password: \u4f7f\u7528\u52a0\u5bc6\u6587\u4ef6\u8fd0\u884c\u4efb\u52a1 \u00b6 \u8fd0\u884cansible\u65f6\uff0c\u4f1a\u63d0\u793a\u89e3\u5bc6\u9519\u8bef [root@master ansible]# ansible -i /etc/ansible/hosts2 node1 -m ping ERROR! Attempted to read \"/etc/ansible/hosts2\" as YAML: Decryption failed on /etc/ansible/hosts2 Attempted to read \"/etc/ansible/hosts2\" as ini file: Decryption failed on /etc/ansible/hosts2 \u8fd9\u65f6\uff0c\u6211\u4eec\u9700\u8981\u8f93\u5165\u52a0\u5bc6\u7684\u5bc6\u7801\uff0c\u624d\u53ef\u4ee5\u8fd0\u884c\u547d\u4ee4\u3002 [root@master ansible]# ansible -i /etc/ansible/hosts2 node1 -m ping --ask-vault-pass Vault password: 192.168.77.129 | SUCCESS => { \"changed\": false, \"ping\": \"pong\" } [root@master ansible]# ansible-playbook -i /etc/ansible/hosts2 test.yml --ask-vault-pass Vault password: PLAY [node1] ******************************************************************************************************************* TASK [command] ***************************************************************************************************************** changed: [192.168.77.129] RUNNING HANDLER [test1] ******************************************************************************************************** ok: [192.168.77.129] => { \"changed\": false, \"msg\": \"456\" } PLAY RECAP ********************************************************************************************************************* 192.168.77.129 : ok=2 changed=1 unreachable=0 failed=0","title":"- \u8282\u70b9\u5b89\u5168: \u52a0\u5bc6\u4e3b\u673a\u6e05\u5355"},{"location":"advanced/security/vault-hosts/#_1","text":"","title":"\u52a0\u5bc6\u4e3b\u673a\u6e05\u5355"},{"location":"advanced/security/vault-hosts/#_2","text":"[root@master ansible]# cat /etc/ansible/hosts2 [node1] 192.168.77.129 ansible_ssh_pass=123456 [node2] 192.168.77.130 ansible_ssh_pass=123456 [node3] 192.168.77.131 ansible_ssh_pass=123456","title":"\u4e3b\u673a\u6e05\u5355\u6e90\u6587\u4ef6"},{"location":"advanced/security/vault-hosts/#1234567","text":"[root@master ansible]# ansible-vault encrypt /etc/ansible/hosts2 New Vault password: Confirm New Vault password: Encryption successful \u518d\u6b21\u53bb\u67e5\u770bhosts2\u7684\u6587\u4ef6\u5185\u5bb9\u65f6\uff0c\u5185\u5bb9\u662f\u5df2\u7ecf\u52a0\u5bc6\u8fc7\u7684\u4e86 [root@master ansible]# cat /etc/ansible/hosts2 $ANSIBLE_VAULT;1.1;AES256 39623561303563343739653030366332363466353462363632336433346537376263326331643338 6531636436633334633533363664663266393939613938650a656261396661633732353536353339 61663162323861613032376463326566393034653963633038303162626135303463303233373130 3437363561323131320a376665383735613961616537333266353565386237373433393162386332 35313265303137616438353964316662646136623665633132393566333465333563383438643431 36376366633735366564383735656434373436326238343363383132373931353839333139333131 31323437393232306437363563366662613139386635356161396630376439343832346662393136 65353537643761376230653965393864643333356338386537343061306166396137343664346561 65663630306134623362383065316134353062323636326231396630313761326631373862653836 65623161633837306536616432646236646261656232626135396631666166636632643465383663 653832366630616363336566626432353164","title":"\u4f7f\u75281234567\u5bc6\u7801\u8fdb\u884c\u52a0\u5bc6\u4e3b\u673a\u6e05\u5355"},{"location":"advanced/security/vault-hosts/#_3","text":"[root@master ~]# ansible-vault edit /etc/ansible/hosts2 --ask-vault-pass Vault password:","title":"\u7f16\u8f91\u52a0\u5bc6\u540e\u7684\u4e3b\u673a\u6e05\u5355\u6587\u4ef6"},{"location":"advanced/security/vault-hosts/#_4","text":"\u8fd0\u884cansible\u65f6\uff0c\u4f1a\u63d0\u793a\u89e3\u5bc6\u9519\u8bef [root@master ansible]# ansible -i /etc/ansible/hosts2 node1 -m ping ERROR! Attempted to read \"/etc/ansible/hosts2\" as YAML: Decryption failed on /etc/ansible/hosts2 Attempted to read \"/etc/ansible/hosts2\" as ini file: Decryption failed on /etc/ansible/hosts2 \u8fd9\u65f6\uff0c\u6211\u4eec\u9700\u8981\u8f93\u5165\u52a0\u5bc6\u7684\u5bc6\u7801\uff0c\u624d\u53ef\u4ee5\u8fd0\u884c\u547d\u4ee4\u3002 [root@master ansible]# ansible -i /etc/ansible/hosts2 node1 -m ping --ask-vault-pass Vault password: 192.168.77.129 | SUCCESS => { \"changed\": false, \"ping\": \"pong\" } [root@master ansible]# ansible-playbook -i /etc/ansible/hosts2 test.yml --ask-vault-pass Vault password: PLAY [node1] ******************************************************************************************************************* TASK [command] ***************************************************************************************************************** changed: [192.168.77.129] RUNNING HANDLER [test1] ******************************************************************************************************** ok: [192.168.77.129] => { \"changed\": false, \"msg\": \"456\" } PLAY RECAP ********************************************************************************************************************* 192.168.77.129 : ok=2 changed=1 unreachable=0 failed=0","title":"\u4f7f\u7528\u52a0\u5bc6\u6587\u4ef6\u8fd0\u884c\u4efb\u52a1"},{"location":"basic/Ad-hoc/","text":"6. \u4f7f\u7528 ad-hoc \u547d\u4ee4 \u00b6 Ansible ad-hoc \u547d\u4ee4\u4f7f\u7528 /usr/bin/ansible \u547d\u4ee4\u884c\u5de5\u5177\u6765\u81ea\u52a8\u5316\u4e00\u4e2a\u6216\u591a\u4e2a\u53d7\u7ba1\u8282\u70b9\u4e0a\u7684\u5355\u4e2a\u4efb\u52a1\u3002 \u4e34\u65f6\u547d\u4ee4\u65e2\u5feb\u901f\u53c8\u7b80\u5355\uff0c\u4f46\u4e0d\u53ef\u91cd\u7528\u3002 ad-hoc \u547d\u4ee4 \u00b6 ansible [ pattern ] -m [ module ] -a \"[module options]\" \u6267\u884c\u7ed3\u679c\u8bf4\u660e rc: \u547d\u4ee4\u8fd4\u56de\u7801\uff080\u8868\u793a\u6210\u529f\uff09 ad-hoc \u793a\u4f8b \u00b6 \u6267\u884cshell\u547d\u4ee4 \u00b6 command \u00b6 \u91cd\u542f\u670d\u52a1\u5668 ansible servers -a \"reboot\" \u4e0d\u6307\u5b9a -m \u6a21\u5757\u65f6\uff0c\u5c06\u4f7f\u7528ansible\u7684\u9ed8\u8ba4\u6a21\u5757command\uff0c\u5b83\u4e0d\u4f1a\u901a\u8fc7shell\u8fdb\u884c\u5904\u7406\uff0c\u6240\u4ee5\u50cf $HOME \u548c\u50cf \u201c<\u201d \uff0c \u201c>\u201d \uff0c \u201c|\u201d \uff0c \u201c;\u201d \u548c \u201c\uff06\u201d \u5c06\u4e0d\u5de5\u4f5c \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAnsible\u4f7f\u75285\u4e2a\u5e76\u53d1\u8fdb\u7a0b\u3002 \u5982\u679c\u4f60\u8981\u6269\u5927\u5e76\u53d1\uff0c\u4f7f\u7528 -f 10 \u53c2\u6570\u6307\u5b9a\u6570\u91cf\u5373\u53ef\u3002 ansible servers -a \"reboot\" -f 10 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAnsible\u8fde\u63a5\u8fdc\u7aef\u7528\u6237\u662f\u5f53\u524d\u7528\u6237\uff0c\u4f7f\u7528 -u \u53c2\u6570\u53ef\u4ee5\u4fee\u6539 ansible servers -a \"reboot\" -f 10 -u root \u5982\u679c\u8fd0\u884c\u7528\u6237\u6ca1\u6709\u6743\u9650\u6267\u884c\uff0c\u4f7f\u7528 --become \u53ef\u4ee5\u63d0\u5347\u6743\u9650,\u9ed8\u8ba4\u662f sudo \u65b9\u5f0f ansible servers -a \"reboot\" -f 10 -u root --become ansible servers -a \"reboot\" -f 10 -u test --become --become-method sudo --become-user root --ask-become-pass --become-method \u6307\u5b9a\u63d0\u5347\u65b9\u5f0f\uff0c --become-user \u6307\u5b9a\u63d0\u5347\u7528\u6237 --ask-become-pass \u544a\u77e5\u63d0\u5347\u5bc6\u7801 shell \u00b6 \u83b7\u53d6web\u7ec4\u91cc\u5f97eth0\u63a5\u53e3\u4fe1\u606f ansible web -m shell -a \"ifconfig eth0|grep addr\" raw \u00b6 \u5982\u679c\u8bf4\u8fdc\u7a0b\u4e3b\u673a\u6ca1\u6709 python \u6a21\u5757\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 raw \u6a21\u5757\u6267\u884c\u547d\u4ee4 ansible web -m raw -a \"ifconfig eth0|grep addr\" script \u00b6 \u6267\u884c\u811a\u672c ansible web -m script -a ip.sh \u5c06\u672c\u5730\u811a\u672c\u4f20\u9001\u5230\u8fdc\u7a0b\u8282\u70b9\u4e0a\u8fd0\u884c \u6587\u4ef6\u7ba1\u7406 \u00b6 copy \u00b6 \u62f7\u8d1d\u672c\u5730\u7684/etc/hosts \u6587\u4ef6\u5230web\u7ec4\u6240\u6709\u4e3b\u673a\u7684/tmp/hosts\uff08\u7a7a\u76ee\u5f55\u9664\u5916\uff09 ansible web -m copy -a \"src=/etc/hosts dest=/tmp/hosts\" \u62f7\u8d1d\u672c\u5730\u7684ntp\u6587\u4ef6\u5230\u76ee\u7684\u5730\u5740\uff0c\u8bbe\u7f6e\u5176\u7528\u6237\u53ca\u6743\u9650\uff0c\u5982\u679c\u76ee\u6807\u5730\u5740\u5b58\u5728\u76f8\u540c\u7684\u6587\u4ef6\uff0c\u5219\u5907\u4efd\u6e90\u6587\u4ef6\u3002 ansible web -m copy -a \"src=/mine/ntp.conf dest=/etc/ntp.conf owner=root group=root mode=644 backup=yes force=yes\" fetch \u00b6 \u4ece\u8fdc\u7aef\u670d\u52a1\u5668\u62f7\u8d1d\u5230\u672c\u673a ansible web -m fetch -a \"src=/etc/hosts dest=/tmp/temp_hosts flat=yes\" file \u00b6 \u66f4\u6539\u6587\u4ef6\u7684\u7528\u6237\u53ca\u6743\u9650 ansible web -m file -a \"dest=/tmp/a.txt mode=600 owner=user group=user\" \u521b\u5efa\u76ee\u5f55\uff0c\u7c7b\u4f3cmkdir -p ansible web -m file -a \"dest=/tmp/test mode=755 owner=user group=user state=directory\" \u5220\u9664\u6587\u4ef6\u6216\u8005\u76ee\u5f55 ansible web -m file -a \"dest=/tmp/test state=absent\" \u521b\u5efa\u8f6f\u8fde\u63a5\uff0c\u5e76\u8bbe\u7f6e\u6240\u5c5e\u7528\u6237\u548c\u7528\u6237\u7ec4 ansible web -m file -a \"src=/file/to/link/to dest=/path/to/symlink owner=user group=user state=link\" touch \u4e00\u4e2a\u6587\u4ef6\u5e76\u6dfb\u52a0\u7528\u6237\u8bfb\u5199\u6743\u9650\uff0c\u7528\u6237\u7ec4\u53bb\u9664\u5199\u6267\u884c\u6743\u9650\uff0c\u5176\u4ed6\u7ec4\u51cf\u53bb\u8bfb\u5199\u6267\u884c\u6743\u9650 ansible web -m file -a \"path=/etc/foo.conf state=touch mode='u+rw,g-wx,o-rwx'\" unarchive \u00b6 \u5c06\u672c\u5730\u7684\u538b\u7f29\u6587\u4ef6\u89e3\u538b\u5230\u76ee\u6807\u4e3b\u673a ansible web -m unarchive -a \"src=foo.tgz dest=/opt/foo\u201c \u7ba1\u7406\u8f6f\u4ef6\u5305 \u00b6 apt\u3001yum \u6a21\u5757\u5206\u8868\u7528\u4e8e\u7ba1\u7406Ubuntu \u7cfb\u5217\u548cRedHat \u7cfb\u5217\u7cfb\u7edf\u8f6f\u4ef6\u5305 apt \u00b6 \u66f4\u65b0\u4ed3\u5e93\u7f13\u5b58\uff0c\u5e76\u5b89\u88c5\"foo\" ansible web -m apt -a \"name=foo update_cache=yes\" \u5220\u9664 \"foo\" ansible web -m apt -a \"name=foo state=absent\" \u5b89\u88c5 \"foo\" ansible web -m apt -a \"name=foo state=present\" \u5b89\u88c5 1.0\u7248\u672c\u7684 \"foo\" ansible web -m apt -a \"name=foo=1.00 state=present\" \u5b89\u88c5\u6700\u65b0\u5f97\"foo\" ansible web -m apt -a \"name=foo state=latest\" \u6ce8\u91ca\uff1aAnsible \u652f\u6301\u5f88\u591a\u64cd\u4f5c\u7cfb\u7edf\u7684\u8f6f\u4ef6\u5305\u7ba1\u7406\uff0c\u4f7f\u7528\u65f6-m \u6307\u5b9a\u76f8\u5e94\u7684\u8f6f\u4ef6\u5305\u7ba1\u7406\u5de5\u5177\u6a21\u5757\uff0c\u5982\u679c\u6ca1\u6709\u8fd9\u6837\u7684\u6a21\u5757\uff0c\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49\u7c7b\u4f3c\u7684\u6a21\u5757\u6216\u8005\u4f7f\u7528command \u6a21\u5757\u6765\u5b89\u88c5\u8f6f\u4ef6\u5305 yum \u00b6 \u5b89\u88c5 \u6700\u65b0\u7684 Apache ansible web -m yum -a \"name=httpd state=latest\" \u5220\u9664apache ansible web -m yum -a \"name=httpd state=absent\" \u4ecetesting \u4ed3\u5e93\u4e2d\u5b89\u88c5\u6700\u540e\u4e00\u4e2a\u7248\u672c\u5f97apache ansible web -m yum -a \"name=httpd enablerepo=testing state=present\" \u66f4\u65b0\u6240\u6709\u7684\u5305 ansible web -m yum -a \"name=* state=latest\" \u5b89\u88c5\u8fdc\u7a0b\u7684rpm\u5305 ansible web -m yum -a \"name=http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm state=present\" \u5b89\u88c5 'Development tools' \u5305\u7ec4 ansible web -m yum -a \"name='@Development tools' state=present\" package \u00b6 \u4f7f\u7528\u8fdc\u7a0b\u4e3b\u673a\u7684\u5305\u7ba1\u7406\u5668\u8fdb\u884c\u5b89\u88c5\uff0c\u5378\u8f7d\uff0c\u66f4\u65b0\u8f6f\u4ef6\u3002\u76f8\u5bf9\u4e8e apt , yum \u800c\u8a00\uff0c\u517c\u5bb9\u6027\u66f4\u597d\u3002 \u5b89\u88c5ntpdate ansible web -m package -a \"name=ntpdate stat=present\" \u7528\u6237\u548c\u7528\u6237\u7ec4 \u00b6 user \u00b6 \u6dfb\u52a0\u7528\u6237 'user'\u5e76\u8bbe\u7f6e\u5176 uid \u548c\u4e3b\u8981\u7684\u7ec4'admin' ansible web -m user -a \"name=user comment='I am user' uid=1040 group=admin\" \u6dfb\u52a0\u7528\u6237 'user'\u5e76\u8bbe\u7f6e\u5176\u767b\u9646shell\uff0c\u5e76\u5c06\u5176\u5047\u5982admins\u548cdevelopers\u7ec4 ansible web -m user -a \"name=user shell=/bin/bash groups=admins,developers append=yes\" \u5220\u9664\u7528\u6237 'user' ansible web -m user -a \"name=user state=absent remove=yes\" \u521b\u5efa user \u7528\u6237\u5f97 2048-bit SSH key\uff0c\u5e76\u5b58\u653e\u5728 ~user/.ssh/id_rsa ansible web -m user -a \"name=user generate_ssh_key=yes ssh_key_bits=2048 ssh_key_file=.ssh/id_rsa\" \u8bbe\u7f6e\u7528\u6237\u8fc7\u671f\u65e5\u671f ansible web -m user -a \"name=user shell=/bin/zsh groups=nobdy expires=1422403387\" \u521b\u5efa test \u7ec4\uff0c\u5e76\u8bbe\u7f6e gid \u4e3a1000 ansible web -m group -a \"name=test gid=1000 state=present\" \u5220\u9664 test \u7ec4 ansible web -m group -a \"name=test state=absent\" \u7248\u672c\u63a7\u5236 \u00b6 git \u00b6 Ansible \u6a21\u5757\u80fd\u591f\u901a\u77e5\u53d8\u66f4\uff0c\u5f53\u4ee3\u7801\u66f4\u65b0\u65f6\uff0c\u53ef\u4ee5\u544a\u8bc9 Ansible \u505a\u4e00\u4e9b\u7279\u5b9a\u7684\u4efb\u52a1\uff0c\u6bd4\u5982\u4ecegit \u90e8\u7f72\u4ee3\u7801\u7136\u540e\u91cd\u542f apache \u670d\u52a1\u7b49 ansible web -m git -a \"repo=https://github.com/Icinga/icinga2.git dest=/tmp/myapp version=HEAD\" \u670d\u52a1\u7ba1\u7406 \u00b6 service \u00b6 \u786e\u4fdd web \u7ec4\u6240\u6709\u4e3b\u673a\u7684 httpd \u662f\u542f\u52a8\u7684 ansible web -m service -a \"name=httpd state=started\" \u91cd\u542f web \u7ec4\u6240\u6709\u4e3b\u673a\u7684httpd \u670d\u52a1 ansible web -m service -a \"name=httpd state=restarted\" \u786e\u4fddweb\u7ec4\u6240\u6709\u4e3b\u673a\u7684httpd \u662f\u5173\u95ed\u7684 ansible web -m service -a \"name=httpd state=stopped\" systemd \u00b6 \u542f\u52a8\u670d\u52a1 ansible web -m systemd -a \"state=started name=httpd\" \u91cd\u8f7d\u914d\u7f6e ansible web -m systemd -a \"daemon_reload=yes\" \u9632\u706b\u5899\u7ba1\u7406 \u00b6 iptables \u00b6 \u5141\u8bb8tcp 22\u7aef\u53e3\u901a\u8fc7 ansible all -m iptables -a \"chain=INPUT destination_port=22 protocol=tcp jump=ACCEPT\" firewalld \u00b6 \u8fd0\u884chttps\u7aef\u53e3\u901a\u8fc7 ansible all -m firewalld -a \"service=https permanent=yes state=enabled\" \u6587\u4ef6\u5185\u5bb9\u64cd\u4f5c \u00b6 lineinfile \u00b6 \u5f00\u542fselinux\uff0c \u66ff\u6362\u4ee5SELINUX=\u5f00\u5934\u7684\u884c\uff0c\u5982\u679c\u6ca1\u6709\u5339\u914d\u5230\uff0c\u5219\u65b0\u589e\u4e00\u6761\u6570\u636e\u3002 ansible all -m lineinfile -a \"dest=/etc/selinux/config regexp=^SELINUX= line=SELINUX=enforcing\" \u5220\u9664\u4ee5SELINUX=\u5f00\u5934\u7684\u884c ansible all -m lineinfile -a \"dest=/tmp/config regexp=^SELINUX= state=absent\" \u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u5411\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u884c ansible all -m lineinfile -a \"dest=/tmp/config line='test'\" replace \u00b6 \u66ff\u6362\u6587\u4ef6\u5185\u5bb9 ansible all -m replace -a \"dest=/etc/selinux/config regexp=^SELINUX=disabled replace=SELINUX=enforcing\" \u5b9a\u65f6\u4efb\u52a1 \u00b6 \u6bcf\u59295\u70b9\uff0c2\u70b9\u5f97\u65f6\u5019\u6267\u884c ls -alh > /dev/null ansible test -m cron -a \"name='check dirs' minute='0' hour='5,2' job='ls -alh > /dev/null'\" \u641c\u96c6\u7cfb\u7edf\u4fe1\u606f \u00b6 \u641c\u96c6\u4e3b\u673a\u7684\u6240\u6709\u7cfb\u7edf\u4fe1\u606f ansible all -m setup \u641c\u96c6\u7cfb\u7edf\u4fe1\u606f\u5e76\u4ee5\u4e3b\u673a\u540d\u4e3a\u6587\u4ef6\u540d\u5206\u522b\u4fdd\u5b58\u5728/tmp/facts \u76ee\u5f55 ansible all -m setup --tree /tmp/facts \u641c\u96c6\u548c\u5185\u5b58\u76f8\u5173\u7684\u4fe1\u606f ansible all -m setup -a 'filter=ansible_*_mb' \u641c\u96c6\u7f51\u5361\u4fe1\u606f ansible all -m setup -a 'filter=ansible_eth[0-2]' \u6307\u5b9a\u8fde\u63a5\u65b9\u5f0f \u00b6 ansible all -i 'centos,' -c docker -m shell -a 'ps aux' ansible all -i 'centos,' -c local -m shell -a 'ifconfig' \u540e\u53f0\u8fd0\u884c \u00b6 \u957f\u65f6\u95f4\u8fd0\u884c\u7684\u64cd\u4f5c\u53ef\u4ee5\u653e\u5230\u540e\u53f0\u6267\u884c\uff0cansible \u4f1a\u68c0\u67e5\u4efb\u52a1\u7684\u72b6\u6001\uff1b\u5728\u4e3b\u673a\u4e0a\u6267\u884c\u7684\u540c\u4e00\u4e2a\u4efb \u52a1\u4f1a\u5206\u914d\u540c\u4e00\u4e2ajob ID \u540e\u53f0\u6267\u884c\u547d\u4ee43600s\uff0c-B \u8868\u793a\u540e\u53f0\u6267\u884c\u7684\u65f6\u95f4 ansible all -B 3600 -a \"/usr/bin/long_running_operation --do-stuff\" \u68c0\u67e5\u4efb\u52a1\u7684\u72b6\u6001 ansible all -m async_status -a \"jid=123456789\" \u540e\u53f0\u6267\u884c\u547d\u4ee4\u6700\u5927\u65f6\u95f4\u662f1800s \u537330 \u5206\u949f\uff0c-P \u6bcf60s \u68c0\u67e5\u4e0b\u72b6\u6001\u9ed8\u8ba415s ansible all -B 1800 -P 60 -a \"/usr/bin/long_running_operation --do-stuff\" \u7ec3\u4e60 \u00b6 \u5927\u5bb6\u901a\u8fc7\u4e0b\u5217\u547d\u4ee4\u6765\u67e5\u770b\u5e2e\u52a9\uff0c\u7ec3\u4e60\u4e0b\u8868\u683c\u4e2d\u5e38\u7528\u6a21\u5757\u7684\u4f7f\u7528\u3002 ansible-doc file \u7c7b\u578b \u6a21\u5757 \u6587\u4ef6\u64cd\u4f5c stat find file lineinfile blockinfile template replace \u5305\u7ba1\u7406 apt gem npm pip yum package easy_install rpm_key \u4f20\u8f93 fetch copy unarchive get_url \u7528\u6237\u7ec4 user group \u6587\u4ef6\u5305\u542b import_tasks include_tasks include_vars mysql\u6570\u636e\u5e93 mysql_db mysql_replication mysql_user \u670d\u52a1 service systemd supervisorctl \u68c0\u67e5 uri wait_for \u5176\u4ed6 debug fail selinux set_fact sysctl authorized_key","title":"6. \u4f7f\u7528 ad-hoc \u547d\u4ee4"},{"location":"basic/Ad-hoc/#6-ad-hoc","text":"Ansible ad-hoc \u547d\u4ee4\u4f7f\u7528 /usr/bin/ansible \u547d\u4ee4\u884c\u5de5\u5177\u6765\u81ea\u52a8\u5316\u4e00\u4e2a\u6216\u591a\u4e2a\u53d7\u7ba1\u8282\u70b9\u4e0a\u7684\u5355\u4e2a\u4efb\u52a1\u3002 \u4e34\u65f6\u547d\u4ee4\u65e2\u5feb\u901f\u53c8\u7b80\u5355\uff0c\u4f46\u4e0d\u53ef\u91cd\u7528\u3002","title":"6. \u4f7f\u7528 ad-hoc \u547d\u4ee4"},{"location":"basic/Ad-hoc/#ad-hoc","text":"ansible [ pattern ] -m [ module ] -a \"[module options]\" \u6267\u884c\u7ed3\u679c\u8bf4\u660e rc: \u547d\u4ee4\u8fd4\u56de\u7801\uff080\u8868\u793a\u6210\u529f\uff09","title":"ad-hoc \u547d\u4ee4"},{"location":"basic/Ad-hoc/#ad-hoc_1","text":"","title":"ad-hoc \u793a\u4f8b"},{"location":"basic/Ad-hoc/#shell","text":"","title":"\u6267\u884cshell\u547d\u4ee4"},{"location":"basic/Ad-hoc/#command","text":"\u91cd\u542f\u670d\u52a1\u5668 ansible servers -a \"reboot\" \u4e0d\u6307\u5b9a -m \u6a21\u5757\u65f6\uff0c\u5c06\u4f7f\u7528ansible\u7684\u9ed8\u8ba4\u6a21\u5757command\uff0c\u5b83\u4e0d\u4f1a\u901a\u8fc7shell\u8fdb\u884c\u5904\u7406\uff0c\u6240\u4ee5\u50cf $HOME \u548c\u50cf \u201c<\u201d \uff0c \u201c>\u201d \uff0c \u201c|\u201d \uff0c \u201c;\u201d \u548c \u201c\uff06\u201d \u5c06\u4e0d\u5de5\u4f5c \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAnsible\u4f7f\u75285\u4e2a\u5e76\u53d1\u8fdb\u7a0b\u3002 \u5982\u679c\u4f60\u8981\u6269\u5927\u5e76\u53d1\uff0c\u4f7f\u7528 -f 10 \u53c2\u6570\u6307\u5b9a\u6570\u91cf\u5373\u53ef\u3002 ansible servers -a \"reboot\" -f 10 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAnsible\u8fde\u63a5\u8fdc\u7aef\u7528\u6237\u662f\u5f53\u524d\u7528\u6237\uff0c\u4f7f\u7528 -u \u53c2\u6570\u53ef\u4ee5\u4fee\u6539 ansible servers -a \"reboot\" -f 10 -u root \u5982\u679c\u8fd0\u884c\u7528\u6237\u6ca1\u6709\u6743\u9650\u6267\u884c\uff0c\u4f7f\u7528 --become \u53ef\u4ee5\u63d0\u5347\u6743\u9650,\u9ed8\u8ba4\u662f sudo \u65b9\u5f0f ansible servers -a \"reboot\" -f 10 -u root --become ansible servers -a \"reboot\" -f 10 -u test --become --become-method sudo --become-user root --ask-become-pass --become-method \u6307\u5b9a\u63d0\u5347\u65b9\u5f0f\uff0c --become-user \u6307\u5b9a\u63d0\u5347\u7528\u6237 --ask-become-pass \u544a\u77e5\u63d0\u5347\u5bc6\u7801","title":"command"},{"location":"basic/Ad-hoc/#shell_1","text":"\u83b7\u53d6web\u7ec4\u91cc\u5f97eth0\u63a5\u53e3\u4fe1\u606f ansible web -m shell -a \"ifconfig eth0|grep addr\"","title":"shell"},{"location":"basic/Ad-hoc/#raw","text":"\u5982\u679c\u8bf4\u8fdc\u7a0b\u4e3b\u673a\u6ca1\u6709 python \u6a21\u5757\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 raw \u6a21\u5757\u6267\u884c\u547d\u4ee4 ansible web -m raw -a \"ifconfig eth0|grep addr\"","title":"raw"},{"location":"basic/Ad-hoc/#script","text":"\u6267\u884c\u811a\u672c ansible web -m script -a ip.sh \u5c06\u672c\u5730\u811a\u672c\u4f20\u9001\u5230\u8fdc\u7a0b\u8282\u70b9\u4e0a\u8fd0\u884c","title":"script"},{"location":"basic/Ad-hoc/#_1","text":"","title":"\u6587\u4ef6\u7ba1\u7406"},{"location":"basic/Ad-hoc/#copy","text":"\u62f7\u8d1d\u672c\u5730\u7684/etc/hosts \u6587\u4ef6\u5230web\u7ec4\u6240\u6709\u4e3b\u673a\u7684/tmp/hosts\uff08\u7a7a\u76ee\u5f55\u9664\u5916\uff09 ansible web -m copy -a \"src=/etc/hosts dest=/tmp/hosts\" \u62f7\u8d1d\u672c\u5730\u7684ntp\u6587\u4ef6\u5230\u76ee\u7684\u5730\u5740\uff0c\u8bbe\u7f6e\u5176\u7528\u6237\u53ca\u6743\u9650\uff0c\u5982\u679c\u76ee\u6807\u5730\u5740\u5b58\u5728\u76f8\u540c\u7684\u6587\u4ef6\uff0c\u5219\u5907\u4efd\u6e90\u6587\u4ef6\u3002 ansible web -m copy -a \"src=/mine/ntp.conf dest=/etc/ntp.conf owner=root group=root mode=644 backup=yes force=yes\"","title":"copy"},{"location":"basic/Ad-hoc/#fetch","text":"\u4ece\u8fdc\u7aef\u670d\u52a1\u5668\u62f7\u8d1d\u5230\u672c\u673a ansible web -m fetch -a \"src=/etc/hosts dest=/tmp/temp_hosts flat=yes\"","title":"fetch"},{"location":"basic/Ad-hoc/#file","text":"\u66f4\u6539\u6587\u4ef6\u7684\u7528\u6237\u53ca\u6743\u9650 ansible web -m file -a \"dest=/tmp/a.txt mode=600 owner=user group=user\" \u521b\u5efa\u76ee\u5f55\uff0c\u7c7b\u4f3cmkdir -p ansible web -m file -a \"dest=/tmp/test mode=755 owner=user group=user state=directory\" \u5220\u9664\u6587\u4ef6\u6216\u8005\u76ee\u5f55 ansible web -m file -a \"dest=/tmp/test state=absent\" \u521b\u5efa\u8f6f\u8fde\u63a5\uff0c\u5e76\u8bbe\u7f6e\u6240\u5c5e\u7528\u6237\u548c\u7528\u6237\u7ec4 ansible web -m file -a \"src=/file/to/link/to dest=/path/to/symlink owner=user group=user state=link\" touch \u4e00\u4e2a\u6587\u4ef6\u5e76\u6dfb\u52a0\u7528\u6237\u8bfb\u5199\u6743\u9650\uff0c\u7528\u6237\u7ec4\u53bb\u9664\u5199\u6267\u884c\u6743\u9650\uff0c\u5176\u4ed6\u7ec4\u51cf\u53bb\u8bfb\u5199\u6267\u884c\u6743\u9650 ansible web -m file -a \"path=/etc/foo.conf state=touch mode='u+rw,g-wx,o-rwx'\"","title":"file"},{"location":"basic/Ad-hoc/#unarchive","text":"\u5c06\u672c\u5730\u7684\u538b\u7f29\u6587\u4ef6\u89e3\u538b\u5230\u76ee\u6807\u4e3b\u673a ansible web -m unarchive -a \"src=foo.tgz dest=/opt/foo\u201c","title":"unarchive"},{"location":"basic/Ad-hoc/#_2","text":"apt\u3001yum \u6a21\u5757\u5206\u8868\u7528\u4e8e\u7ba1\u7406Ubuntu \u7cfb\u5217\u548cRedHat \u7cfb\u5217\u7cfb\u7edf\u8f6f\u4ef6\u5305","title":"\u7ba1\u7406\u8f6f\u4ef6\u5305"},{"location":"basic/Ad-hoc/#apt","text":"\u66f4\u65b0\u4ed3\u5e93\u7f13\u5b58\uff0c\u5e76\u5b89\u88c5\"foo\" ansible web -m apt -a \"name=foo update_cache=yes\" \u5220\u9664 \"foo\" ansible web -m apt -a \"name=foo state=absent\" \u5b89\u88c5 \"foo\" ansible web -m apt -a \"name=foo state=present\" \u5b89\u88c5 1.0\u7248\u672c\u7684 \"foo\" ansible web -m apt -a \"name=foo=1.00 state=present\" \u5b89\u88c5\u6700\u65b0\u5f97\"foo\" ansible web -m apt -a \"name=foo state=latest\" \u6ce8\u91ca\uff1aAnsible \u652f\u6301\u5f88\u591a\u64cd\u4f5c\u7cfb\u7edf\u7684\u8f6f\u4ef6\u5305\u7ba1\u7406\uff0c\u4f7f\u7528\u65f6-m \u6307\u5b9a\u76f8\u5e94\u7684\u8f6f\u4ef6\u5305\u7ba1\u7406\u5de5\u5177\u6a21\u5757\uff0c\u5982\u679c\u6ca1\u6709\u8fd9\u6837\u7684\u6a21\u5757\uff0c\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49\u7c7b\u4f3c\u7684\u6a21\u5757\u6216\u8005\u4f7f\u7528command \u6a21\u5757\u6765\u5b89\u88c5\u8f6f\u4ef6\u5305","title":"apt"},{"location":"basic/Ad-hoc/#yum","text":"\u5b89\u88c5 \u6700\u65b0\u7684 Apache ansible web -m yum -a \"name=httpd state=latest\" \u5220\u9664apache ansible web -m yum -a \"name=httpd state=absent\" \u4ecetesting \u4ed3\u5e93\u4e2d\u5b89\u88c5\u6700\u540e\u4e00\u4e2a\u7248\u672c\u5f97apache ansible web -m yum -a \"name=httpd enablerepo=testing state=present\" \u66f4\u65b0\u6240\u6709\u7684\u5305 ansible web -m yum -a \"name=* state=latest\" \u5b89\u88c5\u8fdc\u7a0b\u7684rpm\u5305 ansible web -m yum -a \"name=http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm state=present\" \u5b89\u88c5 'Development tools' \u5305\u7ec4 ansible web -m yum -a \"name='@Development tools' state=present\"","title":"yum"},{"location":"basic/Ad-hoc/#package","text":"\u4f7f\u7528\u8fdc\u7a0b\u4e3b\u673a\u7684\u5305\u7ba1\u7406\u5668\u8fdb\u884c\u5b89\u88c5\uff0c\u5378\u8f7d\uff0c\u66f4\u65b0\u8f6f\u4ef6\u3002\u76f8\u5bf9\u4e8e apt , yum \u800c\u8a00\uff0c\u517c\u5bb9\u6027\u66f4\u597d\u3002 \u5b89\u88c5ntpdate ansible web -m package -a \"name=ntpdate stat=present\"","title":"package"},{"location":"basic/Ad-hoc/#_3","text":"","title":"\u7528\u6237\u548c\u7528\u6237\u7ec4"},{"location":"basic/Ad-hoc/#user","text":"\u6dfb\u52a0\u7528\u6237 'user'\u5e76\u8bbe\u7f6e\u5176 uid \u548c\u4e3b\u8981\u7684\u7ec4'admin' ansible web -m user -a \"name=user comment='I am user' uid=1040 group=admin\" \u6dfb\u52a0\u7528\u6237 'user'\u5e76\u8bbe\u7f6e\u5176\u767b\u9646shell\uff0c\u5e76\u5c06\u5176\u5047\u5982admins\u548cdevelopers\u7ec4 ansible web -m user -a \"name=user shell=/bin/bash groups=admins,developers append=yes\" \u5220\u9664\u7528\u6237 'user' ansible web -m user -a \"name=user state=absent remove=yes\" \u521b\u5efa user \u7528\u6237\u5f97 2048-bit SSH key\uff0c\u5e76\u5b58\u653e\u5728 ~user/.ssh/id_rsa ansible web -m user -a \"name=user generate_ssh_key=yes ssh_key_bits=2048 ssh_key_file=.ssh/id_rsa\" \u8bbe\u7f6e\u7528\u6237\u8fc7\u671f\u65e5\u671f ansible web -m user -a \"name=user shell=/bin/zsh groups=nobdy expires=1422403387\" \u521b\u5efa test \u7ec4\uff0c\u5e76\u8bbe\u7f6e gid \u4e3a1000 ansible web -m group -a \"name=test gid=1000 state=present\" \u5220\u9664 test \u7ec4 ansible web -m group -a \"name=test state=absent\"","title":"user"},{"location":"basic/Ad-hoc/#_4","text":"","title":"\u7248\u672c\u63a7\u5236"},{"location":"basic/Ad-hoc/#git","text":"Ansible \u6a21\u5757\u80fd\u591f\u901a\u77e5\u53d8\u66f4\uff0c\u5f53\u4ee3\u7801\u66f4\u65b0\u65f6\uff0c\u53ef\u4ee5\u544a\u8bc9 Ansible \u505a\u4e00\u4e9b\u7279\u5b9a\u7684\u4efb\u52a1\uff0c\u6bd4\u5982\u4ecegit \u90e8\u7f72\u4ee3\u7801\u7136\u540e\u91cd\u542f apache \u670d\u52a1\u7b49 ansible web -m git -a \"repo=https://github.com/Icinga/icinga2.git dest=/tmp/myapp version=HEAD\"","title":"git"},{"location":"basic/Ad-hoc/#_5","text":"","title":"\u670d\u52a1\u7ba1\u7406"},{"location":"basic/Ad-hoc/#service","text":"\u786e\u4fdd web \u7ec4\u6240\u6709\u4e3b\u673a\u7684 httpd \u662f\u542f\u52a8\u7684 ansible web -m service -a \"name=httpd state=started\" \u91cd\u542f web \u7ec4\u6240\u6709\u4e3b\u673a\u7684httpd \u670d\u52a1 ansible web -m service -a \"name=httpd state=restarted\" \u786e\u4fddweb\u7ec4\u6240\u6709\u4e3b\u673a\u7684httpd \u662f\u5173\u95ed\u7684 ansible web -m service -a \"name=httpd state=stopped\"","title":"service"},{"location":"basic/Ad-hoc/#systemd","text":"\u542f\u52a8\u670d\u52a1 ansible web -m systemd -a \"state=started name=httpd\" \u91cd\u8f7d\u914d\u7f6e ansible web -m systemd -a \"daemon_reload=yes\"","title":"systemd"},{"location":"basic/Ad-hoc/#_6","text":"","title":"\u9632\u706b\u5899\u7ba1\u7406"},{"location":"basic/Ad-hoc/#iptables","text":"\u5141\u8bb8tcp 22\u7aef\u53e3\u901a\u8fc7 ansible all -m iptables -a \"chain=INPUT destination_port=22 protocol=tcp jump=ACCEPT\"","title":"iptables"},{"location":"basic/Ad-hoc/#firewalld","text":"\u8fd0\u884chttps\u7aef\u53e3\u901a\u8fc7 ansible all -m firewalld -a \"service=https permanent=yes state=enabled\"","title":"firewalld"},{"location":"basic/Ad-hoc/#_7","text":"","title":"\u6587\u4ef6\u5185\u5bb9\u64cd\u4f5c"},{"location":"basic/Ad-hoc/#lineinfile","text":"\u5f00\u542fselinux\uff0c \u66ff\u6362\u4ee5SELINUX=\u5f00\u5934\u7684\u884c\uff0c\u5982\u679c\u6ca1\u6709\u5339\u914d\u5230\uff0c\u5219\u65b0\u589e\u4e00\u6761\u6570\u636e\u3002 ansible all -m lineinfile -a \"dest=/etc/selinux/config regexp=^SELINUX= line=SELINUX=enforcing\" \u5220\u9664\u4ee5SELINUX=\u5f00\u5934\u7684\u884c ansible all -m lineinfile -a \"dest=/tmp/config regexp=^SELINUX= state=absent\" \u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u5411\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u884c ansible all -m lineinfile -a \"dest=/tmp/config line='test'\"","title":"lineinfile"},{"location":"basic/Ad-hoc/#replace","text":"\u66ff\u6362\u6587\u4ef6\u5185\u5bb9 ansible all -m replace -a \"dest=/etc/selinux/config regexp=^SELINUX=disabled replace=SELINUX=enforcing\"","title":"replace"},{"location":"basic/Ad-hoc/#_8","text":"\u6bcf\u59295\u70b9\uff0c2\u70b9\u5f97\u65f6\u5019\u6267\u884c ls -alh > /dev/null ansible test -m cron -a \"name='check dirs' minute='0' hour='5,2' job='ls -alh > /dev/null'\"","title":"\u5b9a\u65f6\u4efb\u52a1"},{"location":"basic/Ad-hoc/#_9","text":"\u641c\u96c6\u4e3b\u673a\u7684\u6240\u6709\u7cfb\u7edf\u4fe1\u606f ansible all -m setup \u641c\u96c6\u7cfb\u7edf\u4fe1\u606f\u5e76\u4ee5\u4e3b\u673a\u540d\u4e3a\u6587\u4ef6\u540d\u5206\u522b\u4fdd\u5b58\u5728/tmp/facts \u76ee\u5f55 ansible all -m setup --tree /tmp/facts \u641c\u96c6\u548c\u5185\u5b58\u76f8\u5173\u7684\u4fe1\u606f ansible all -m setup -a 'filter=ansible_*_mb' \u641c\u96c6\u7f51\u5361\u4fe1\u606f ansible all -m setup -a 'filter=ansible_eth[0-2]'","title":"\u641c\u96c6\u7cfb\u7edf\u4fe1\u606f"},{"location":"basic/Ad-hoc/#_10","text":"ansible all -i 'centos,' -c docker -m shell -a 'ps aux' ansible all -i 'centos,' -c local -m shell -a 'ifconfig'","title":"\u6307\u5b9a\u8fde\u63a5\u65b9\u5f0f"},{"location":"basic/Ad-hoc/#_11","text":"\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u64cd\u4f5c\u53ef\u4ee5\u653e\u5230\u540e\u53f0\u6267\u884c\uff0cansible \u4f1a\u68c0\u67e5\u4efb\u52a1\u7684\u72b6\u6001\uff1b\u5728\u4e3b\u673a\u4e0a\u6267\u884c\u7684\u540c\u4e00\u4e2a\u4efb \u52a1\u4f1a\u5206\u914d\u540c\u4e00\u4e2ajob ID \u540e\u53f0\u6267\u884c\u547d\u4ee43600s\uff0c-B \u8868\u793a\u540e\u53f0\u6267\u884c\u7684\u65f6\u95f4 ansible all -B 3600 -a \"/usr/bin/long_running_operation --do-stuff\" \u68c0\u67e5\u4efb\u52a1\u7684\u72b6\u6001 ansible all -m async_status -a \"jid=123456789\" \u540e\u53f0\u6267\u884c\u547d\u4ee4\u6700\u5927\u65f6\u95f4\u662f1800s \u537330 \u5206\u949f\uff0c-P \u6bcf60s \u68c0\u67e5\u4e0b\u72b6\u6001\u9ed8\u8ba415s ansible all -B 1800 -P 60 -a \"/usr/bin/long_running_operation --do-stuff\"","title":"\u540e\u53f0\u8fd0\u884c"},{"location":"basic/Ad-hoc/#_12","text":"\u5927\u5bb6\u901a\u8fc7\u4e0b\u5217\u547d\u4ee4\u6765\u67e5\u770b\u5e2e\u52a9\uff0c\u7ec3\u4e60\u4e0b\u8868\u683c\u4e2d\u5e38\u7528\u6a21\u5757\u7684\u4f7f\u7528\u3002 ansible-doc file \u7c7b\u578b \u6a21\u5757 \u6587\u4ef6\u64cd\u4f5c stat find file lineinfile blockinfile template replace \u5305\u7ba1\u7406 apt gem npm pip yum package easy_install rpm_key \u4f20\u8f93 fetch copy unarchive get_url \u7528\u6237\u7ec4 user group \u6587\u4ef6\u5305\u542b import_tasks include_tasks include_vars mysql\u6570\u636e\u5e93 mysql_db mysql_replication mysql_user \u670d\u52a1 service systemd supervisorctl \u68c0\u67e5 uri wait_for \u5176\u4ed6 debug fail selinux set_fact sysctl authorized_key","title":"\u7ec3\u4e60"},{"location":"basic/Ansible-command/","text":"7. \u719f\u6089 ansible \u547d\u4ee4 \u00b6 \u672c\u6587\u4ee5 Ansible \u7248\u672c 2.9.6 \u4e3a\u51c6 ansible \u00b6 ansible \u547d\u4ee4\u662f **Ansible**\u7684\u6838\u5fc3\u90e8\u5206\uff0c\u5176\u4e3b\u8981\u7528\u4e8e\u6267\u884cad-hoc\u547d\u4ee4\uff0c\u5373\u5355\u6761\u547d\u4ee4\u3002\u9ed8\u8ba4\u540e\u9762\u9700\u8981\u8ddf\u4e3b\u673a\u548c\u9009\u9879\u90e8\u5206\uff0c\u9ed8\u8ba4\u4e0d\u6307\u5b9a\u6a21\u5757\u65f6\uff0c\u4f7f\u7528\u7684\u662fcommand\u6a21\u5757\u3002 # ansible --help usage: ansible [ -h ] [ --version ] [ -v ] [ -b ] [ --become-method BECOME_METHOD ] [ --become-user BECOME_USER ] [ -K ] [ -i INVENTORY ] [ --list-hosts ] [ -l SUBSET ] [ -P POLL_INTERVAL ] [ -B SECONDS ] [ -o ] [ -t TREE ] [ -k ] [ --private-key PRIVATE_KEY_FILE ] [ -u REMOTE_USER ] [ -c CONNECTION ] [ -T TIMEOUT ] [ --ssh-common-args SSH_COMMON_ARGS ] [ --sftp-extra-args SFTP_EXTRA_ARGS ] [ --scp-extra-args SCP_EXTRA_ARGS ] [ --ssh-extra-args SSH_EXTRA_ARGS ] [ -C ] [ --syntax-check ] [ -D ] [ -e EXTRA_VARS ] [ --vault-id VAULT_IDS ] [ --ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES ] [ -f FORKS ] [ -M MODULE_PATH ] [ --playbook-dir BASEDIR ] [ -a MODULE_ARGS ] [ -m MODULE_NAME ] pattern \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e pattern \u4e3b\u673a\u5339\u914d \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --ask-vault-pass \u63d0\u793a\u8f93\u5165vault \u5bc6\u7801\u3002 --list-hosts \u8f93\u51fa\u5339\u914d\u4e3b\u673a\u7684\u5217\u8868\u3002 --playbook-dir BASEDIR \u6307\u5b9aplaybook\u76ee\u5f55\uff0c\u4e3a role , group_vars/etc \u6307\u5b9a\u76f8\u5bf9\u8def\u5f84 --syntax-check \u5bf9playbook\u8fdb\u884c\u8bed\u6cd5\u68c0\u67e5\uff0c\u4e14\u4e0d\u6267\u884cplaybook\u3002 --vault-id=VAULT_IDS \u6807\u8bc6\u4f7f\u7528\u7684vault id --vault-password-file=VAULT_PASSWORD_FILE \u6307\u5b9avault\u5bc6\u7801\u6587\u4ef6 --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u4fe1\u606f -B SECONDS, --background SECONDS \u5f02\u6b65\u8fd0\u884c\u65f6\uff0c\u591a\u957f\u65f6\u95f4\u8d85\u65f6\u3002 -C, --check \u53ea\u662f\u6d4b\u8bd5\u4e00\u4e0b\u4f1a\u6539\u53d8\u4ec0\u4e48\u5185\u5bb9\uff0c\u4e0d\u4f1a\u771f\u6b63\u53bb\u6267\u884c;\u76f8\u53cd,\u8bd5\u56fe\u9884\u6d4b\u4e00\u4e9b\u53ef\u80fd\u53d1\u751f\u7684\u53d8\u5316\u3002 -D, --diff \u5f53\u66f4\u6539\u6587\u4ef6\u548c\u6a21\u677f\u65f6\uff0c\u663e\u793a\u8fd9\u4e9b\u6587\u4ef6\u5f97\u5dee\u5f02\uff0c\u6bd4--check\u6548\u679c\u597d\u3002 -M MODULE_PATH, --module-path MODULE_PATH \u8981\u6267\u884c\u7684\u6a21\u5757\u7684\u8def\u5f84\uff0c\u9ed8\u8ba4\u8def\u5f84 ~/.ansible/plugins/modules:/usr/share/ansible/plu<br/> gins/modules) -P POLL_INTERVAL, --poll POLL_INTERVAL \u8bbe\u7f6e\u8f6e\u8be2\u95f4\u9694\uff0c\u9ed8\u8ba415\u79d2 -a MODULE_ARGS, --args MODULE_ARGS \u6307\u5b9a\u6a21\u5757\u53c2\u6570 -e EXTRA_VARS, --extra-vars EXTRA_VARS \u6dfb\u52a0\u9644\u52a0\u53d8\u91cf\uff0c\u6bd4\u5982key=value\uff0cyaml\uff0cjson\u683c\u5f0f\u3002\u4f7f\u7528 @ \u6307\u5b9a\u6587\u4ef6 -f FORKS, --forks FORKS \u6307\u5b9a\u5b9a\u8981\u4f7f\u7528\u7684\u5e76\u884c\u8fdb\u7a0b\u6570\uff0c\u9ed8\u8ba4\u4e3a5\u4e2a\u3002 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f\u3002 -i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY \u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u6216\u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\uff0c\u9ed8\u8ba4\u4e3a/etc/ansible/hosts\u3002 -l SUBSET, --limit SUBSET \u8fdb\u4e00\u6b65\u9650\u5236\u6240\u9009\u4e3b\u673a/\u7ec4\u6a21\u5f0f\uff0c\u53ea\u6267\u884c -l \u540e\u7684\u4e3b\u673a\u548c\u7ec4\u3002 -m MODULE_NAME, --module-name MODULE_NAME \u8981\u6267\u884c\u7684\u6a21\u5757\uff0c\u9ed8\u8ba4\u4e3acommand\u3002 -o, --one-line \u538b\u7f29\u8f93\u51fa\uff0c\u5c1d\u8bd5\u5c06\u6240\u6709\u5185\u5bb9\u90fd\u5728\u4e00\u884c\u4e0a\u8f93\u51fa\u3002 -t TREE, --tree \u6307\u5b9atree\u7684\u8f93\u51fa\u76ee\u5f55 -v, --verbose \u8f93\u51fa\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f7f\u7528-vvv\u83b7\u5f97\u66f4\u591a\uff0c-vvvv \u542f\u7528\u8fde\u63a5\u8c03\u8bd5 \u7279\u6743\u5347\u7ea7\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --become-method=BECOME_METHOD \u6743\u9650\u5347\u7ea7\u65b9\u6cd5\u4f7f\u7528 \uff0c\u9ed8\u8ba4\u4e3asudo\uff0c\u6709\u6548\u9009\u62e9\uff1a[sudo | su | pbrun | pfexec | runas | doas | dzdo] --become-user=BECOME_USER \u4f7f\u7528\u54ea\u4e2a\u7528\u6237\u8fd0\u884c\uff0c\u9ed8\u8ba4\u4e3aroot -K, --ask-become-pass \u63d0\u4f9b\u6743\u9650\u63d0\u5347\u5bc6\u7801 -b, --become \u8fd0\u884c\u6743\u9650\u63d0\u5347 \u8fde\u63a5\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE \u79c1\u94a5\u8def\u5f84\uff0c\u4f7f\u7528\u8fd9\u4e2a\u6587\u4ef6\u6765\u9a8c\u8bc1\u8fde\u63a5 --scp-extra-args SCP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 scp \uff0c\u4f8b\u5982 -l --sftp-extra-args SFTP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 sftp \uff0c\u4f8b\u5982 -f --ssh-common-args SSH_COMMON_ARGS \u6307\u5b9a\u8981\u4f20\u9012\u7ed9sftp / scp / ssh\u7684\u901a\u7528\u53c2\u6570\uff08\u4f8b\u5982 ProxyCommand\uff09 --ssh-extra-args SSH_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 ssh \uff0c\u4f8b\u5982 -R -T TIMEOUT, --timeout=TIMEOUT \u6307\u5b9a\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u662f10S -c CONNECTION, --connection=CONNECTION \u6307\u5b9a\u8fde\u63a5\u7c7b\u578b\uff0c\u9ed8\u8ba4smart -k, --ask-pass \u8981\u6c42\u7528\u6237\u8f93\u5165\u8bf7\u6c42\u8fde\u63a5\u5bc6\u7801 -u REMOTE_USER, --user=REMOTE_USER \u6307\u5b9a\u8fde\u63a5\u7528\u6237 \u793a\u4f8b \uff1a ansible all -m ping ansible 192 .168.77.* -m ping ansible all -m command -a ifconfig ansible all -m shell -a \"ifconfig eth0 |grep 'inet addr' \" ansible -i \"192.168.77.129,192.168.77.130\" 192 .168.77.129 -m ping ansible -i hosts all --list-host ansible -i hosts -l 192 .168.77.130 all -m ping -t /tmp -vvvv ansible web -l @retry_hosts.txt --list-hosts ansible all -i 192 .168.77.133, -m ping -k ansible-console \u00b6 \u4ea4\u4e92\u5f0f\u547d\u4ee4\u6267\u884c\u754c\u9762 # ansible-console --help usage: ansible-console [ -h ] [ --version ] [ -v ] [ -b ] [ --become-method BECOME_METHOD ] [ --become-user BECOME_USER ] [ -K ] [ -i INVENTORY ] [ --list-hosts ] [ -l SUBSET ] [ -k ] [ --private-key PRIVATE_KEY_FILE ] [ -u REMOTE_USER ] [ -c CONNECTION ] [ -T TIMEOUT ] [ --ssh-common-args SSH_COMMON_ARGS ] [ --sftp-extra-args SFTP_EXTRA_ARGS ] [ --scp-extra-args SCP_EXTRA_ARGS ] [ --ssh-extra-args SSH_EXTRA_ARGS ] [ -C ] [ --syntax-check ] [ -D ] [ --vault-id VAULT_IDS ] [ --ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES ] [ -f FORKS ] [ -M MODULE_PATH ] [ --playbook-dir BASEDIR ] [ --step ] [ pattern ] \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e pattern \u4e3b\u673a\u5339\u914d \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --ask-vault-pass \u63d0\u793a\u8f93\u5165vault \u5bc6\u7801\u3002 --list-hosts \u8f93\u51fa\u5339\u914d\u4e3b\u673a\u7684\u5217\u8868\u3002 --playbook-dir BASEDIR \u6307\u5b9aplaybook\u76ee\u5f55\uff0c\u4e3a role , group_vars/etc \u6307\u5b9a\u76f8\u5bf9\u8def\u5f84 --step \u4e00\u6b65\u4e00\u6b65\u7684\u8fd0\u884c\uff0c\u6bcf\u4e2a\u4efb\u52a1\u90fd\u4f1a\u5faa\u73af\u662f\u5426\u6267\u884c --syntax-check \u5bf9playbook\u8fdb\u884c\u8bed\u6cd5\u68c0\u67e5\uff0c\u4e14\u4e0d\u6267\u884cplaybook\u3002 --vault-id=VAULT_IDS \u6807\u8bc6\u4f7f\u7528\u7684vault id --vault-password-file=VAULT_PASSWORD_FILE \u6307\u5b9avault\u5bc6\u7801\u6587\u4ef6 --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u4fe1\u606f -C, --check \u53ea\u662f\u6d4b\u8bd5\u4e00\u4e0b\u4f1a\u6539\u53d8\u4ec0\u4e48\u5185\u5bb9\uff0c\u4e0d\u4f1a\u771f\u6b63\u53bb\u6267\u884c;\u76f8\u53cd,\u8bd5\u56fe\u9884\u6d4b\u4e00\u4e9b\u53ef\u80fd\u53d1\u751f\u7684\u53d8\u5316\u3002 -D, --diff \u5f53\u66f4\u6539\u6587\u4ef6\u548c\u6a21\u677f\u65f6\uff0c\u663e\u793a\u8fd9\u4e9b\u6587\u4ef6\u5f97\u5dee\u5f02\uff0c\u6bd4--check\u6548\u679c\u597d\u3002 -M MODULE_PATH, --module-path MODULE_PATH \u8981\u6267\u884c\u7684\u6a21\u5757\u7684\u8def\u5f84\uff0c\u9ed8\u8ba4\u8def\u5f84 ~/.ansible/plugins/modules:/usr/share/ansible/plu<br/> gins/modules) -f FORKS, --forks FORKS \u6307\u5b9a\u5b9a\u8981\u4f7f\u7528\u7684\u5e76\u884c\u8fdb\u7a0b\u6570\uff0c\u9ed8\u8ba4\u4e3a5\u4e2a\u3002 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f\u3002 -i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY \u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u6216\u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\uff0c\u9ed8\u8ba4\u4e3a/etc/ansible/hosts\u3002 -l SUBSET, --limit SUBSET \u8fdb\u4e00\u6b65\u9650\u5236\u6240\u9009\u4e3b\u673a/\u7ec4\u6a21\u5f0f\uff0c\u53ea\u6267\u884c -l \u540e\u7684\u4e3b\u673a\u548c\u7ec4\u3002 -v, --verbose \u8f93\u51fa\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f7f\u7528-vvv\u83b7\u5f97\u66f4\u591a\uff0c-vvvv \u542f\u7528\u8fde\u63a5\u8c03\u8bd5 \u7279\u6743\u5347\u7ea7\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --become-method=BECOME_METHOD \u6743\u9650\u5347\u7ea7\u65b9\u6cd5\u4f7f\u7528 \uff0c\u9ed8\u8ba4\u4e3asudo\uff0c\u6709\u6548\u9009\u62e9\uff1a[sudo | su | pbrun | pfexec | runas | doas | dzdo] --become-user=BECOME_USER \u4f7f\u7528\u54ea\u4e2a\u7528\u6237\u8fd0\u884c\uff0c\u9ed8\u8ba4\u4e3aroot -K, --ask-become-pass \u63d0\u4f9b\u6743\u9650\u63d0\u5347\u5bc6\u7801 -b, --become \u8fd0\u884c\u6743\u9650\u63d0\u5347 \u8fde\u63a5\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE \u79c1\u94a5\u8def\u5f84\uff0c\u4f7f\u7528\u8fd9\u4e2a\u6587\u4ef6\u6765\u9a8c\u8bc1\u8fde\u63a5 --scp-extra-args SCP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 scp \uff0c\u4f8b\u5982 -l --sftp-extra-args SFTP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 sftp \uff0c\u4f8b\u5982 -f --ssh-common-args SSH_COMMON_ARGS \u6307\u5b9a\u8981\u4f20\u9012\u7ed9sftp / scp / ssh\u7684\u901a\u7528\u53c2\u6570\uff08\u4f8b\u5982 ProxyCommand\uff09 --ssh-extra-args SSH_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 ssh \uff0c\u4f8b\u5982 -R -T TIMEOUT, --timeout=TIMEOUT \u6307\u5b9a\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u662f10S -c CONNECTION, --connection=CONNECTION \u6307\u5b9a\u8fde\u63a5\u7c7b\u578b\uff0c\u9ed8\u8ba4smart -k, --ask-pass \u8981\u6c42\u7528\u6237\u8f93\u5165\u8bf7\u6c42\u8fde\u63a5\u5bc6\u7801 -u REMOTE_USER, --user=REMOTE_USER \u6307\u5b9a\u8fde\u63a5\u7528\u6237 \u793a\u4f8b\uff1a ansible-console all -i 192 .168.77.133, -m ping -k root@all ( 1 )[ f:5 ] $ ping 192 .168.77.133 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } ansible-doc \u00b6 \u8be5\u6307\u4ee4\u7528\u4e8e\u67e5\u770b\u6a21\u5757\u4fe1\u606f\uff0c\u5e38\u7528\u53c2\u6570\u6709\u4e24\u4e2a-l \u548c -s # ansible-doc --help usage: ansible-doc [ -h ] [ --version ] [ -v ] [ -M MODULE_PATH ] [ --playbook-dir BASEDIR ] [ -t { become,cache,callback,cliconf,connection,httpapi,inventory,lookup,netconf,shell,module,strategy,vars }] [ -j ] [ -F | -l | -s | --metadata-dump ] [ plugin [ plugin ... ]] \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e plugin \u63d2\u4ef6 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --metadata-dump \u83b7\u53d6\u6240\u6709\u63d2\u4ef6\u7684metadata json\u6570\u636e --playbook-dir BASEDIR \u6307\u5b9aplaybook\u76ee\u5f55\uff0c\u4e3a role , group_vars/etc \u6307\u5b9a\u76f8\u5bf9\u8def\u5f84 --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u4fe1\u606f -F, --list_files \u663e\u793a\u63d2\u4ef6\u540d\u79f0\u53ca\u5176\u6e90\u6587\u4ef6\uff0c\u4e0d\u663e\u793a\u6458\u8981 -h, --help \u663e\u793a\u5e2e\u52a9\u6587\u4ef6 -j, --json \u4f7f\u7528json\u683c\u5f0f\u8f93\u51fa -l, --list \u5217\u51fa\u53ef\u7528\u7684\u63d2\u4ef6 -s, --snippet \u663e\u793a\u6307\u5b9a\u63d2\u4ef6\u7684 playbook \u6458\u8981 -t \u6307\u5b9a\u63d2\u4ef6\u7c7b\u578b\uff0c\u9ed8\u8ba4 module \u793a\u4f8b\uff1a ansible-doc -l ansible-doc yum ansible-doc yum -s ansible-doc -t cache -l ansible-doc -t become -l ansible-galaxy \u00b6 ansible-galaxy \u6307\u4ee4\u7528\u4e8e\u65b9\u4fbf\u7684\u4ecehttps://galaxy.ansible.com/ \u7ad9\u70b9\u4e0b\u8f7d\u7b2c\u4e09\u65b9\u6269\u5c55\u6a21\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u5f62\u8c61\u7684\u7406\u89e3\u5176\u7c7b\u4f3c\u4e8ecentos\u4e0b\u7684yum\u3001python\u4e0b\u7684pip\u6216easy_install # ansible-galaxy --help usage: ansible-galaxy [ -h ] [ --version ] [ -v ] TYPE ... \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e collection \u7ba1\u7406Ansible Galaxy\u3002 role \u7ba1\u7406Ansible Galaxy role\u3002 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u53f7 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f -v, --verbose \u8be6\u7ec6\u6a21\u5f0f\uff08-vvv\u8868\u793a\u66f4\u591a\uff0c-vvvv\u8868\u793a\u542f\u7528\u8fde\u63a5\u8c03\u8bd5\uff09 \u793a\u4f8b\uff1a ansible-galaxy search tomcat # \u641c\u7d22\u89d2\u8272 ansible-galaxy install aeriscloud.docker #\u4e0b\u8f7d\u89d2\u8272 ansible-galaxy list ragingbal.tomcat ansible-galaxy info ragingbal.tomcat ansible-galaxy init abc # \u521b\u5efa\u89d2\u8272\u6a21\u677f # \u5b89\u88c5\u7684role\u5728 /root/.ansible/roles/ ansible-playbook \u00b6 \u5bf9\u4e8e\u9700\u53cd\u590d\u6267\u884c\u7684\u3001\u8f83\u4e3a\u590d\u6742\u7684\u4efb\u52a1\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49 Playbook \u6765\u641e\u5b9a\u3002Playbook \u662f Ansible \u771f\u6b63\u5f3a\u5927\u7684\u5730\u65b9\uff0c\u5b83\u5141\u8bb8\u4f7f\u7528\u53d8\u91cf\u3001\u6761\u4ef6\u3001\u5faa\u73af\u3001\u4ee5\u53ca\u6a21\u677f\uff0c\u4e5f\u80fd\u901a\u8fc7\u89d2\u8272 \u53ca\u5305\u542b\u6307\u4ee4\u6765\u91cd\u7528\u65e2\u6709\u5185\u5bb9\u3002 # ansible-playbook --help usage: ansible-playbook [ -h ] [ --version ] [ -v ] [ -k ] [ --private-key PRIVATE_KEY_FILE ] [ -u REMOTE_USER ] [ -c CONNECTION ] [ -T TIMEOUT ] [ --ssh-common-args SSH_COMMON_ARGS ] [ --sftp-extra-args SFTP_EXTRA_ARGS ] [ --scp-extra-args SCP_EXTRA_ARGS ] [ --ssh-extra-args SSH_EXTRA_ARGS ] [ --force-handlers ] [ --flush-cache ] [ -b ] [ --become-method BECOME_METHOD ] [ --become-user BECOME_USER ] [ -K ] [ -t TAGS ] [ --skip-tags SKIP_TAGS ] [ -C ] [ --syntax-check ] [ -D ] [ -i INVENTORY ] [ --list-hosts ] [ -l SUBSET ] [ -e EXTRA_VARS ] [ --vault-id VAULT_IDS ] [ --ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES ] [ -f FORKS ] [ -M MODULE_PATH ] [ --list-tasks ] [ --list-tags ] [ --step ] [ --start-at-task START_AT_TASK ] playbook [ playbook ... ] \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e playbook playbook\u6587\u4ef6 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --ask-vault-pass \u63d0\u793a\u8f93\u5165vault \u5bc6\u7801\u3002 --flush-cache \u6e05\u9664fact\u7f13\u5b58 --force-handlers \u5982\u679c\u4efb\u52a1\u5931\u8d25\uff0c\u4e5f\u8981\u8fd0\u884chandlers --list-hosts \u8f93\u51fa\u5339\u914d\u4e3b\u673a\u7684\u5217\u8868\u3002 --list-tags \u5217\u51fa\u6240\u6709\u53ef\u7528\u7684\u6807\u7b7e --list-tasks \u5217\u51fa\u5c06\u8981\u6267\u884c\u7684\u6240\u6709\u4efb\u52a1 --skip-tags=SKIP_TAGS \u8df3\u8fc7\u8fd0\u884c\u6807\u8bb0\u6b64\u6807\u7b7e\u7684\u4efb\u52a1 -start-at-task=START_AT_TASK \u5728\u6b64\u4efb\u52a1\u5904\u5f00\u59cb\u8fd0\u884c --step \u4e00\u6b65\u4e00\u6b65\u7684\u6267\u884c\uff1a\u5728\u8fd0\u884c\u4e4b\u524d\u786e\u8ba4\u6bcf\u4e2a\u4efb\u52a1 --syntax-check \u5bf9playbook\u8fdb\u884c\u8bed\u6cd5\u68c0\u67e5\uff0c\u4e14\u4e0d\u6267\u884cplaybook\u3002 --vault-id=VAULT_IDS \u6807\u8bc6\u4f7f\u7528\u7684vault id --vault-password-file=VAULT_PASSWORD_FILE \u6307\u5b9avault\u5bc6\u7801\u6587\u4ef6 --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u4fe1\u606f -C, --check \u53ea\u662f\u6d4b\u8bd5\u4e00\u4e0b\u4f1a\u6539\u53d8\u4ec0\u4e48\u5185\u5bb9\uff0c\u4e0d\u4f1a\u771f\u6b63\u53bb\u6267\u884c;\u76f8\u53cd,\u8bd5\u56fe\u9884\u6d4b\u4e00\u4e9b\u53ef\u80fd\u53d1\u751f\u7684\u53d8\u5316\u3002 -D, --diff \u5f53\u66f4\u6539\u6587\u4ef6\u548c\u6a21\u677f\u65f6\uff0c\u663e\u793a\u8fd9\u4e9b\u6587\u4ef6\u5f97\u5dee\u5f02\uff0c\u6bd4--check\u6548\u679c\u597d\u3002 -M MODULE_PATH, --module-path MODULE_PATH \u8981\u6267\u884c\u7684\u6a21\u5757\u7684\u8def\u5f84\uff0c\u9ed8\u8ba4\u8def\u5f84 ~/.ansible/plugins/modules:/usr/share/ansible/plu<br/> gins/modules) -e EXTRA_VARS, --extra-vars EXTRA_VARS \u6dfb\u52a0\u9644\u52a0\u53d8\u91cf\uff0c\u6bd4\u5982key=value\uff0cyaml\uff0cjson\u683c\u5f0f\u3002\u4f7f\u7528 @ \u6307\u5b9a\u6587\u4ef6 -f FORKS, --forks FORKS \u6307\u5b9a\u5b9a\u8981\u4f7f\u7528\u7684\u5e76\u884c\u8fdb\u7a0b\u6570\uff0c\u9ed8\u8ba4\u4e3a5\u4e2a\u3002 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f\u3002 -i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY \u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u6216\u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\uff0c\u9ed8\u8ba4\u4e3a/etc/ansible/hosts\u3002 -l SUBSET, --limit SUBSET \u8fdb\u4e00\u6b65\u9650\u5236\u6240\u9009\u4e3b\u673a/\u7ec4\u6a21\u5f0f\uff0c\u53ea\u6267\u884c -l \u540e\u7684\u4e3b\u673a\u548c\u7ec4\u3002 -t TAGS, --tags TAGS \u8fd0\u884c\u6307\u5b9a\u7684\u5e26\u6709tags\u4efb\u52a1 -v, --verbose \u8f93\u51fa\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f7f\u7528-vvv\u83b7\u5f97\u66f4\u591a\uff0c-vvvv \u542f\u7528\u8fde\u63a5\u8c03\u8bd5 \u7279\u6743\u5347\u7ea7\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --become-method=BECOME_METHOD \u6743\u9650\u5347\u7ea7\u65b9\u6cd5\u4f7f\u7528 \uff0c\u9ed8\u8ba4\u4e3asudo\uff0c\u6709\u6548\u9009\u62e9\uff1a[sudo | su | pbrun | pfexec | runas | doas | dzdo] --become-user=BECOME_USER \u4f7f\u7528\u54ea\u4e2a\u7528\u6237\u8fd0\u884c\uff0c\u9ed8\u8ba4\u4e3aroot -K, --ask-become-pass \u63d0\u4f9b\u6743\u9650\u63d0\u5347\u5bc6\u7801 -b, --become \u8fd0\u884c\u6743\u9650\u63d0\u5347 \u8fde\u63a5\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE \u79c1\u94a5\u8def\u5f84\uff0c\u4f7f\u7528\u8fd9\u4e2a\u6587\u4ef6\u6765\u9a8c\u8bc1\u8fde\u63a5 --scp-extra-args SCP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 scp \uff0c\u4f8b\u5982 -l --sftp-extra-args SFTP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 sftp \uff0c\u4f8b\u5982 -f --ssh-common-args SSH_COMMON_ARGS \u6307\u5b9a\u8981\u4f20\u9012\u7ed9sftp / scp / ssh\u7684\u901a\u7528\u53c2\u6570\uff08\u4f8b\u5982 ProxyCommand\uff09 --ssh-extra-args SSH_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 ssh \uff0c\u4f8b\u5982 -R -T TIMEOUT, --timeout=TIMEOUT \u6307\u5b9a\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u662f10S -c CONNECTION, --connection=CONNECTION \u6307\u5b9a\u8fde\u63a5\u7c7b\u578b\uff0c\u9ed8\u8ba4smart -k, --ask-pass \u8981\u6c42\u7528\u6237\u8f93\u5165\u8bf7\u6c42\u8fde\u63a5\u5bc6\u7801 -u REMOTE_USER, --user=REMOTE_USER \u6307\u5b9a\u8fde\u63a5\u7528\u6237 \u793a\u4f8b\uff1a ansible-playbook -i hosts ssh-addkey.yml # \u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u6587\u4ef6 ansible-playbook -i hosts ssh-addkey.yml --list-tags # \u5217\u51fatags ansible-playbook -i hosts ssh-addkey.yml -t install # \u6267\u884cinstall\u6807\u7b7e\u7684\u4efb\u52a1 ansible-playbook -i hosts ssh-addkey.yml -t install -e a = 1 # \u6307\u5b9a\u53d8\u91cf ansible-pull \u00b6 pull\u6a21\u5f0f\u5728\u88ab\u914d\u7f6e\u7684\u673a\u5668\u4e0a\u8fd0\u884c\uff0c\u901f\u5ea6\u5f88\u5feb\u3002\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u4f60\u9700\u8981\u63d0\u4f9b\u4e00\u4e2agit\u4ed3\u5e93\u6765\u4f9bAnsible\u4e0b\u8f7d\u6765\u914d\u7f6e\u4f60\u7684\u673a\u5668\u3002 # ansible-pull --help usage: ansible-pull [ -h ] [ --version ] [ -v ] [ -k ] [ --private-key PRIVATE_KEY_FILE ] [ -u REMOTE_USER ] [ -c CONNECTION ] [ -T TIMEOUT ] [ --ssh-common-args SSH_COMMON_ARGS ] [ --sftp-extra-args SFTP_EXTRA_ARGS ] [ --scp-extra-args SCP_EXTRA_ARGS ] [ --ssh-extra-args SSH_EXTRA_ARGS ] [ --vault-id VAULT_IDS ] [ --ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES ] [ -e EXTRA_VARS ] [ -t TAGS ] [ --skip-tags SKIP_TAGS ] [ -i INVENTORY ] [ --list-hosts ] [ -l SUBSET ] [ -M MODULE_PATH ] [ -K ] [ --purge ] [ -o ] [ -s SLEEP ] [ -f ] [ -d DEST ] [ -U URL ] [ --full ] [ -C CHECKOUT ] [ --accept-host-key ] [ -m MODULE_NAME ] [ --verify-commit ] [ --clean ] [ --track-subs ] [ --check ] [ --diff ] [ playbook.yml [ playbook.yml ... ]] \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e playbook playbook\u6587\u4ef6 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --accept-host-key \u6307\u5b9a\u4ed3\u5e93\u7684\u4e3b\u673a\u79d8\u94a5 --ask-vault-pass \u63d0\u793a\u8f93\u5165vault \u5bc6\u7801\u3002 --check \u53ea\u505a\u68c0\u67e5\uff0c\u4e0d\u505a\u66f4\u6539 --clean \u5de5\u4f5c\u5b58\u50a8\u5e93\u4e2d\u7684\u5df2\u4fee\u6539\u6587\u4ef6\u5c06\u88ab\u5220\u9664 --diff \u66f4\u6539\uff08\u5c0f\u7684\uff09\u6587\u4ef6\u548c\u6a21\u677f\u65f6\uff0c\u663e\u793a\u8fd9\u4e9b\u6587\u4ef6\u4e2d\u7684\u5dee\u5f02 --full \u5b8c\u6574\u514b\u9686 --list-hosts \u8f93\u51fa\u5339\u914d\u4e3b\u673a\u5217\u8868 --purge \u8fd0\u884c\u540e\u6e05\u9664 --skip-tags SKIP_TAGS \u8df3\u8fc7\u8fd0\u884c\u6807\u8bb0\u6b64\u6807\u7b7e\u7684\u4efb\u52a1 --track-subs \u6a21\u5757\u5c06\u8ddf\u8e2a\u6700\u65b0\u7684\u53d8\u5316\u3002 \u8fd9\u76f8\u5f53\u4e8e\u6307\u5b9a--remote\u6807\u5fd7\u6765git\u5b50\u6a21\u5757\u66f4\u65b0 --vault-id=VAULT_IDS \u6807\u8bc6\u4f7f\u7528\u7684vault id --vault-password-file=VAULT_PASSWORD_FILE \u6307\u5b9avault\u5bc6\u7801\u6587\u4ef6 --verify-commit \u9a8c\u8bc1\u5df2\u68c0\u51fa\u63d0\u4ea4\u7684GPG\u7b7e\u540d\uff0c\u5982\u679c\u5931\u8d25\u5219\u4e2d\u6b62\u8fd0\u884c\u5267\u672c\u3002 --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u4fe1\u606f -C CHECKOUT, --checkout=CHECKOUT \u6307\u5b9a\u514b\u9686\u7684\u5206\u652f -M MODULE_PATH, --module-path MODULE_PATH \u8981\u6267\u884c\u7684\u6a21\u5757\u7684\u8def\u5f84\uff0c\u9ed8\u8ba4\u8def\u5f84 ~/.ansible/plugins/modules:/usr/share/ansible/plu<br/> gins/modules) -U URL, --url URL playbook\u4ed3\u5e93\u7684\u5730\u5740 -d DEST, --directory DEST \u6307\u5b9a\u68c0\u51fa\u76ee\u5f55 -e EXTRA_VARS, --extra-vars EXTRA_VARS \u6dfb\u52a0\u9644\u52a0\u53d8\u91cf\uff0c\u6bd4\u5982key=value\uff0cyaml\uff0cjson\u683c\u5f0f\u3002\u4f7f\u7528 @ \u6307\u5b9a\u6587\u4ef6 -f FORKS, --forks FORKS \u6307\u5b9a\u5b9a\u8981\u4f7f\u7528\u7684\u5e76\u884c\u8fdb\u7a0b\u6570\uff0c\u9ed8\u8ba4\u4e3a5\u4e2a\u3002 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f\u3002 -i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY \u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u6216\u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\uff0c\u9ed8\u8ba4\u4e3a/etc/ansible/hosts\u3002 -l SUBSET, --limit SUBSET \u8fdb\u4e00\u6b65\u9650\u5236\u6240\u9009\u4e3b\u673a/\u7ec4\u6a21\u5f0f\uff0c\u53ea\u6267\u884c -l \u540e\u7684\u4e3b\u673a\u548c\u7ec4\u3002 -m MODULE_NAME, --module-name MODULE_NAME \u4ed3\u5e93\u6a21\u5757\u540d\u79f0\uff0c\u53ef\u9009\u503c('git', 'subversion', 'hg', 'bzr')\u9ed8\u8ba4\u4e3agit\u3002 -o, --only-if-changed \u5f53\u5b58\u50a8\u5e93\u5df2\u66f4\u65b0\u65f6\u624d\u8fd0\u884c\u5267\u672c -s SLEEP, --sleep SLEEP \u6307\u5b9a\u7761\u7720\u65f6\u95f4 -t TAGS, --tags TAGS \u8fd0\u884c\u6307\u5b9a\u7684\u5e26\u6709tags\u4efb\u52a1 -v, --verbose \u8f93\u51fa\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f7f\u7528-vvv\u83b7\u5f97\u66f4\u591a\uff0c-vvvv \u542f\u7528\u8fde\u63a5\u8c03\u8bd5 \u7279\u6743\u5347\u7ea7\u9009\u9879 \u53c2\u6570 \u8bf4\u660e -K, --ask-become-pass \u63d0\u4f9b\u6743\u9650\u63d0\u5347\u5bc6\u7801 \u8fde\u63a5\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE \u79c1\u94a5\u8def\u5f84\uff0c\u4f7f\u7528\u8fd9\u4e2a\u6587\u4ef6\u6765\u9a8c\u8bc1\u8fde\u63a5 --scp-extra-args SCP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 scp \uff0c\u4f8b\u5982 -l --sftp-extra-args SFTP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 sftp \uff0c\u4f8b\u5982 -f --ssh-common-args SSH_COMMON_ARGS \u6307\u5b9a\u8981\u4f20\u9012\u7ed9sftp / scp / ssh\u7684\u901a\u7528\u53c2\u6570\uff08\u4f8b\u5982 ProxyCommand\uff09 --ssh-extra-args SSH_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 ssh \uff0c\u4f8b\u5982 -R -T TIMEOUT, --timeout=TIMEOUT \u6307\u5b9a\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u662f10S -c CONNECTION, --connection=CONNECTION \u6307\u5b9a\u8fde\u63a5\u7c7b\u578b\uff0c\u9ed8\u8ba4smart -K, --ask-become-pass \u8981\u6c42\u7528\u6237\u8f93\u5165\u8bf7\u6c42\u8fde\u63a5\u5bc6\u7801 -u REMOTE_USER, --user=REMOTE_USER \u6307\u5b9a\u8fde\u63a5\u7528\u6237 \u793a\u4f8b\uff1a ansible-pull -o -C master -d /tmp/pull -i /tmp/pull/hosts -U https://github.com/lework/Ansible-Pull-Example.git ansible-config \u00b6 \u7f16\u8f91\u7ba1\u7406ansible\u914d\u7f6e # ansible-config --help usage: ansible-config [ -h ] [ --version ] [ -v ] { list,dump,view } ... \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e list \u663e\u793a\u6240\u6709\u7684\u53c2\u6570\u914d\u7f6e dump dump\u914d\u7f6e view \u67e5\u770b\u914d\u7f6e\u6587\u4ef6 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u53f7 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f -v, --verbose \u8be6\u7ec6\u6a21\u5f0f\uff08-vvv\u8868\u793a\u66f4\u591a\uff0c-vvvv\u8868\u793a\u542f\u7528\u8fde\u63a5\u8c03\u8bd5\uff09 \u793a\u4f8b\uff1a ansible-config view ansible-config list ansible-config dump ansible-inventory \u00b6 \u67e5\u770b\u4e3b\u673a\u6e05\u5355\u4fe1\u606f # ansible-inventory --help usage: ansible-inventory [ -h ] [ --version ] [ -v ] [ -i INVENTORY ] [ --vault-id VAULT_IDS ] [ --ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES ] [ --playbook-dir BASEDIR ] [ --list ] [ --host HOST ] [ --graph ] [ -y ] [ --toml ] [ --vars ] [ --export ] [ --output OUTPUT_FILE ] [ host | group ] \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e host/group \u4e3b\u673a/\u4e3b\u673a\u7ec4 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --accept-host-key \u6307\u5b9a\u4ed3\u5e93\u7684\u4e3b\u673a\u79d8\u94a5 --export \u5bfc\u51fa\u4fe1\u606f\uff0c\u4e0e--list\u6216--graph\u4e00\u8d77\u4f7f\u7528 --output OUTPUT_FILE \u5bfc\u51fa\u4fe1\u606f\u5230\u6587\u4ef6\uff0c\u4e0e--list\u6216--graph\u4e00\u8d77\u4f7f\u7528 --playbook-dir BASEDIR \u6307\u5b9aplaybook\u76ee\u5f55\uff0c\u4e3a role , group_vars/etc \u6307\u5b9a\u76f8\u5bf9\u8def\u5f84 --toml \u4f7f\u7528toml\u683c\u5f0f\u8f93\u51fa,\u9ed8\u8ba4\u662fjson\u683c\u5f0f --vars \u8f93\u51fa\u53d8\u91cf\u4fe1\u606f\uff0c\u4e0e--list\u6216--graph\u4e00\u8d77\u4f7f\u7528 --vault-id=VAULT_IDS \u6807\u8bc6\u4f7f\u7528\u7684vault id --vault-password-file=VAULT_PASSWORD_FILE \u6307\u5b9avault\u5bc6\u7801\u6587\u4ef6 --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u4fe1\u606f -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f\u3002 -i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY \u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u6216\u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\uff0c\u9ed8\u8ba4\u4e3a/etc/ansible/hosts\u3002 -v, --verbose \u8f93\u51fa\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f7f\u7528-vvv\u83b7\u5f97\u66f4\u591a\uff0c-vvvv \u542f\u7528\u8fde\u63a5\u8c03\u8bd5 -y, --yaml \u4f7f\u7528yaml\u683c\u5f0f\u8f93\u51fa,\u9ed8\u8ba4\u662fjson\u683c\u5f0f \u52a8\u4f5c\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --graph \u521b\u5efa\u4e3b\u673a\u6e05\u5355\u56fe --host HOST \u8f93\u51fa\u4e3b\u673a\u6e05\u5355\u4fe1\u606f --list \u4ee5json\u7684\u683c\u5f0f\u8f93\u51fa\u6240\u6709\u4e3b\u673a\u6e05\u5355\u4fe1\u606f \u793a\u4f8b\uff1a ansible-inventory --export --graph ansible-inventory -i /etc/ansible/hosts --export --list ansible-inventory --host = 192 .168.1.100 ansible-inventory --vars --list ``` ## ansible-vault ansible-vault\u4e3b\u8981\u5e94\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\u4e2d\u542b\u6709\u654f\u611f\u4fe1\u606f\uff0c\u53c8\u4e0d\u5e0c\u671b\u4ed6\u80fd\u88ab\u4eba\u770b\u5230\uff0cvault\u53ef\u4ee5\u5e2e\u4f60\u52a0\u5bc6/\u89e3\u5bc6\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u3002\u8fd9\u79cdplaybook\u6587\u4ef6\u5728\u6267\u884c\u65f6\uff0c\u9700\u8981\u52a0\u4e0a ` --ask-vault-pass ` \u53c2\u6570\uff0c\u540c\u6837\u9700\u8981\u8f93\u5165\u5bc6\u7801\u540e\u624d\u80fd\u6b63\u5e38\u6267\u884c\u3002 ``` bash # ansible-vault --help usage: ansible-vault [ -h ] [ --version ] [ -v ] { create,decrypt,edit,view,encrypt,encrypt_string,rekey } ... \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e create \u521b\u5efa\u52a0\u5bc6\u6587\u4ef6 decrypt \u89e3\u5bc6\u6587\u4ef6 edit \u7f16\u8f91\u52a0\u5bc6\u6587\u4ef6 view \u67e5\u770b\u52a0\u5bc6\u6587\u4ef6 encrypt \u52a0\u5bc6\u6587\u4ef6 encrypt_string \u8f93\u51fa\u52a0\u5bc6\u5b57\u7b26\u4e32 rekey \u91cd\u65b0\u52a0\u5bc6\u6587\u4ef6 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u53f7 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f -v, --verbose \u8be6\u7ec6\u6a21\u5f0f\uff08-vvv\u8868\u793a\u66f4\u591a\uff0c-vvvv\u8868\u793a\u542f\u7528\u8fde\u63a5\u8c03\u8bd5\uff09 \u793a\u4f8b\uff1a ansible-vault create # /tmp/123 \u521b\u5efa\u52a0\u5bc6\u6587\u4ef6 ansible-vault view # /tmp/123 \u67e5\u770b\u52a0\u5bc6\u6587\u4ef6 ansible-vault encrypt # /tmp/abc \u52a0\u5bc6\u6587\u4ef6 ansible-vault decrypt # /tmp/abc \u89e3\u5bc6\u6587\u4ef6 ansible-vault edit # /tmp/abc \u7f16\u8f91\u52a0\u5bc6\u6587\u4ef6 ansible-vault encrypt_string '123' # \u8f93\u51fa\u52a0\u5bc6\u5b57\u7b26\u4e32","title":"7. \u719f\u6089 ansible \u547d\u4ee4"},{"location":"basic/Ansible-command/#7-ansible","text":"\u672c\u6587\u4ee5 Ansible \u7248\u672c 2.9.6 \u4e3a\u51c6","title":"7. \u719f\u6089 ansible \u547d\u4ee4"},{"location":"basic/Ansible-command/#ansible","text":"ansible \u547d\u4ee4\u662f **Ansible**\u7684\u6838\u5fc3\u90e8\u5206\uff0c\u5176\u4e3b\u8981\u7528\u4e8e\u6267\u884cad-hoc\u547d\u4ee4\uff0c\u5373\u5355\u6761\u547d\u4ee4\u3002\u9ed8\u8ba4\u540e\u9762\u9700\u8981\u8ddf\u4e3b\u673a\u548c\u9009\u9879\u90e8\u5206\uff0c\u9ed8\u8ba4\u4e0d\u6307\u5b9a\u6a21\u5757\u65f6\uff0c\u4f7f\u7528\u7684\u662fcommand\u6a21\u5757\u3002 # ansible --help usage: ansible [ -h ] [ --version ] [ -v ] [ -b ] [ --become-method BECOME_METHOD ] [ --become-user BECOME_USER ] [ -K ] [ -i INVENTORY ] [ --list-hosts ] [ -l SUBSET ] [ -P POLL_INTERVAL ] [ -B SECONDS ] [ -o ] [ -t TREE ] [ -k ] [ --private-key PRIVATE_KEY_FILE ] [ -u REMOTE_USER ] [ -c CONNECTION ] [ -T TIMEOUT ] [ --ssh-common-args SSH_COMMON_ARGS ] [ --sftp-extra-args SFTP_EXTRA_ARGS ] [ --scp-extra-args SCP_EXTRA_ARGS ] [ --ssh-extra-args SSH_EXTRA_ARGS ] [ -C ] [ --syntax-check ] [ -D ] [ -e EXTRA_VARS ] [ --vault-id VAULT_IDS ] [ --ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES ] [ -f FORKS ] [ -M MODULE_PATH ] [ --playbook-dir BASEDIR ] [ -a MODULE_ARGS ] [ -m MODULE_NAME ] pattern \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e pattern \u4e3b\u673a\u5339\u914d \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --ask-vault-pass \u63d0\u793a\u8f93\u5165vault \u5bc6\u7801\u3002 --list-hosts \u8f93\u51fa\u5339\u914d\u4e3b\u673a\u7684\u5217\u8868\u3002 --playbook-dir BASEDIR \u6307\u5b9aplaybook\u76ee\u5f55\uff0c\u4e3a role , group_vars/etc \u6307\u5b9a\u76f8\u5bf9\u8def\u5f84 --syntax-check \u5bf9playbook\u8fdb\u884c\u8bed\u6cd5\u68c0\u67e5\uff0c\u4e14\u4e0d\u6267\u884cplaybook\u3002 --vault-id=VAULT_IDS \u6807\u8bc6\u4f7f\u7528\u7684vault id --vault-password-file=VAULT_PASSWORD_FILE \u6307\u5b9avault\u5bc6\u7801\u6587\u4ef6 --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u4fe1\u606f -B SECONDS, --background SECONDS \u5f02\u6b65\u8fd0\u884c\u65f6\uff0c\u591a\u957f\u65f6\u95f4\u8d85\u65f6\u3002 -C, --check \u53ea\u662f\u6d4b\u8bd5\u4e00\u4e0b\u4f1a\u6539\u53d8\u4ec0\u4e48\u5185\u5bb9\uff0c\u4e0d\u4f1a\u771f\u6b63\u53bb\u6267\u884c;\u76f8\u53cd,\u8bd5\u56fe\u9884\u6d4b\u4e00\u4e9b\u53ef\u80fd\u53d1\u751f\u7684\u53d8\u5316\u3002 -D, --diff \u5f53\u66f4\u6539\u6587\u4ef6\u548c\u6a21\u677f\u65f6\uff0c\u663e\u793a\u8fd9\u4e9b\u6587\u4ef6\u5f97\u5dee\u5f02\uff0c\u6bd4--check\u6548\u679c\u597d\u3002 -M MODULE_PATH, --module-path MODULE_PATH \u8981\u6267\u884c\u7684\u6a21\u5757\u7684\u8def\u5f84\uff0c\u9ed8\u8ba4\u8def\u5f84 ~/.ansible/plugins/modules:/usr/share/ansible/plu<br/> gins/modules) -P POLL_INTERVAL, --poll POLL_INTERVAL \u8bbe\u7f6e\u8f6e\u8be2\u95f4\u9694\uff0c\u9ed8\u8ba415\u79d2 -a MODULE_ARGS, --args MODULE_ARGS \u6307\u5b9a\u6a21\u5757\u53c2\u6570 -e EXTRA_VARS, --extra-vars EXTRA_VARS \u6dfb\u52a0\u9644\u52a0\u53d8\u91cf\uff0c\u6bd4\u5982key=value\uff0cyaml\uff0cjson\u683c\u5f0f\u3002\u4f7f\u7528 @ \u6307\u5b9a\u6587\u4ef6 -f FORKS, --forks FORKS \u6307\u5b9a\u5b9a\u8981\u4f7f\u7528\u7684\u5e76\u884c\u8fdb\u7a0b\u6570\uff0c\u9ed8\u8ba4\u4e3a5\u4e2a\u3002 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f\u3002 -i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY \u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u6216\u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\uff0c\u9ed8\u8ba4\u4e3a/etc/ansible/hosts\u3002 -l SUBSET, --limit SUBSET \u8fdb\u4e00\u6b65\u9650\u5236\u6240\u9009\u4e3b\u673a/\u7ec4\u6a21\u5f0f\uff0c\u53ea\u6267\u884c -l \u540e\u7684\u4e3b\u673a\u548c\u7ec4\u3002 -m MODULE_NAME, --module-name MODULE_NAME \u8981\u6267\u884c\u7684\u6a21\u5757\uff0c\u9ed8\u8ba4\u4e3acommand\u3002 -o, --one-line \u538b\u7f29\u8f93\u51fa\uff0c\u5c1d\u8bd5\u5c06\u6240\u6709\u5185\u5bb9\u90fd\u5728\u4e00\u884c\u4e0a\u8f93\u51fa\u3002 -t TREE, --tree \u6307\u5b9atree\u7684\u8f93\u51fa\u76ee\u5f55 -v, --verbose \u8f93\u51fa\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f7f\u7528-vvv\u83b7\u5f97\u66f4\u591a\uff0c-vvvv \u542f\u7528\u8fde\u63a5\u8c03\u8bd5 \u7279\u6743\u5347\u7ea7\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --become-method=BECOME_METHOD \u6743\u9650\u5347\u7ea7\u65b9\u6cd5\u4f7f\u7528 \uff0c\u9ed8\u8ba4\u4e3asudo\uff0c\u6709\u6548\u9009\u62e9\uff1a[sudo | su | pbrun | pfexec | runas | doas | dzdo] --become-user=BECOME_USER \u4f7f\u7528\u54ea\u4e2a\u7528\u6237\u8fd0\u884c\uff0c\u9ed8\u8ba4\u4e3aroot -K, --ask-become-pass \u63d0\u4f9b\u6743\u9650\u63d0\u5347\u5bc6\u7801 -b, --become \u8fd0\u884c\u6743\u9650\u63d0\u5347 \u8fde\u63a5\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE \u79c1\u94a5\u8def\u5f84\uff0c\u4f7f\u7528\u8fd9\u4e2a\u6587\u4ef6\u6765\u9a8c\u8bc1\u8fde\u63a5 --scp-extra-args SCP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 scp \uff0c\u4f8b\u5982 -l --sftp-extra-args SFTP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 sftp \uff0c\u4f8b\u5982 -f --ssh-common-args SSH_COMMON_ARGS \u6307\u5b9a\u8981\u4f20\u9012\u7ed9sftp / scp / ssh\u7684\u901a\u7528\u53c2\u6570\uff08\u4f8b\u5982 ProxyCommand\uff09 --ssh-extra-args SSH_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 ssh \uff0c\u4f8b\u5982 -R -T TIMEOUT, --timeout=TIMEOUT \u6307\u5b9a\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u662f10S -c CONNECTION, --connection=CONNECTION \u6307\u5b9a\u8fde\u63a5\u7c7b\u578b\uff0c\u9ed8\u8ba4smart -k, --ask-pass \u8981\u6c42\u7528\u6237\u8f93\u5165\u8bf7\u6c42\u8fde\u63a5\u5bc6\u7801 -u REMOTE_USER, --user=REMOTE_USER \u6307\u5b9a\u8fde\u63a5\u7528\u6237 \u793a\u4f8b \uff1a ansible all -m ping ansible 192 .168.77.* -m ping ansible all -m command -a ifconfig ansible all -m shell -a \"ifconfig eth0 |grep 'inet addr' \" ansible -i \"192.168.77.129,192.168.77.130\" 192 .168.77.129 -m ping ansible -i hosts all --list-host ansible -i hosts -l 192 .168.77.130 all -m ping -t /tmp -vvvv ansible web -l @retry_hosts.txt --list-hosts ansible all -i 192 .168.77.133, -m ping -k","title":"ansible"},{"location":"basic/Ansible-command/#ansible-console","text":"\u4ea4\u4e92\u5f0f\u547d\u4ee4\u6267\u884c\u754c\u9762 # ansible-console --help usage: ansible-console [ -h ] [ --version ] [ -v ] [ -b ] [ --become-method BECOME_METHOD ] [ --become-user BECOME_USER ] [ -K ] [ -i INVENTORY ] [ --list-hosts ] [ -l SUBSET ] [ -k ] [ --private-key PRIVATE_KEY_FILE ] [ -u REMOTE_USER ] [ -c CONNECTION ] [ -T TIMEOUT ] [ --ssh-common-args SSH_COMMON_ARGS ] [ --sftp-extra-args SFTP_EXTRA_ARGS ] [ --scp-extra-args SCP_EXTRA_ARGS ] [ --ssh-extra-args SSH_EXTRA_ARGS ] [ -C ] [ --syntax-check ] [ -D ] [ --vault-id VAULT_IDS ] [ --ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES ] [ -f FORKS ] [ -M MODULE_PATH ] [ --playbook-dir BASEDIR ] [ --step ] [ pattern ] \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e pattern \u4e3b\u673a\u5339\u914d \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --ask-vault-pass \u63d0\u793a\u8f93\u5165vault \u5bc6\u7801\u3002 --list-hosts \u8f93\u51fa\u5339\u914d\u4e3b\u673a\u7684\u5217\u8868\u3002 --playbook-dir BASEDIR \u6307\u5b9aplaybook\u76ee\u5f55\uff0c\u4e3a role , group_vars/etc \u6307\u5b9a\u76f8\u5bf9\u8def\u5f84 --step \u4e00\u6b65\u4e00\u6b65\u7684\u8fd0\u884c\uff0c\u6bcf\u4e2a\u4efb\u52a1\u90fd\u4f1a\u5faa\u73af\u662f\u5426\u6267\u884c --syntax-check \u5bf9playbook\u8fdb\u884c\u8bed\u6cd5\u68c0\u67e5\uff0c\u4e14\u4e0d\u6267\u884cplaybook\u3002 --vault-id=VAULT_IDS \u6807\u8bc6\u4f7f\u7528\u7684vault id --vault-password-file=VAULT_PASSWORD_FILE \u6307\u5b9avault\u5bc6\u7801\u6587\u4ef6 --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u4fe1\u606f -C, --check \u53ea\u662f\u6d4b\u8bd5\u4e00\u4e0b\u4f1a\u6539\u53d8\u4ec0\u4e48\u5185\u5bb9\uff0c\u4e0d\u4f1a\u771f\u6b63\u53bb\u6267\u884c;\u76f8\u53cd,\u8bd5\u56fe\u9884\u6d4b\u4e00\u4e9b\u53ef\u80fd\u53d1\u751f\u7684\u53d8\u5316\u3002 -D, --diff \u5f53\u66f4\u6539\u6587\u4ef6\u548c\u6a21\u677f\u65f6\uff0c\u663e\u793a\u8fd9\u4e9b\u6587\u4ef6\u5f97\u5dee\u5f02\uff0c\u6bd4--check\u6548\u679c\u597d\u3002 -M MODULE_PATH, --module-path MODULE_PATH \u8981\u6267\u884c\u7684\u6a21\u5757\u7684\u8def\u5f84\uff0c\u9ed8\u8ba4\u8def\u5f84 ~/.ansible/plugins/modules:/usr/share/ansible/plu<br/> gins/modules) -f FORKS, --forks FORKS \u6307\u5b9a\u5b9a\u8981\u4f7f\u7528\u7684\u5e76\u884c\u8fdb\u7a0b\u6570\uff0c\u9ed8\u8ba4\u4e3a5\u4e2a\u3002 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f\u3002 -i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY \u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u6216\u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\uff0c\u9ed8\u8ba4\u4e3a/etc/ansible/hosts\u3002 -l SUBSET, --limit SUBSET \u8fdb\u4e00\u6b65\u9650\u5236\u6240\u9009\u4e3b\u673a/\u7ec4\u6a21\u5f0f\uff0c\u53ea\u6267\u884c -l \u540e\u7684\u4e3b\u673a\u548c\u7ec4\u3002 -v, --verbose \u8f93\u51fa\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f7f\u7528-vvv\u83b7\u5f97\u66f4\u591a\uff0c-vvvv \u542f\u7528\u8fde\u63a5\u8c03\u8bd5 \u7279\u6743\u5347\u7ea7\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --become-method=BECOME_METHOD \u6743\u9650\u5347\u7ea7\u65b9\u6cd5\u4f7f\u7528 \uff0c\u9ed8\u8ba4\u4e3asudo\uff0c\u6709\u6548\u9009\u62e9\uff1a[sudo | su | pbrun | pfexec | runas | doas | dzdo] --become-user=BECOME_USER \u4f7f\u7528\u54ea\u4e2a\u7528\u6237\u8fd0\u884c\uff0c\u9ed8\u8ba4\u4e3aroot -K, --ask-become-pass \u63d0\u4f9b\u6743\u9650\u63d0\u5347\u5bc6\u7801 -b, --become \u8fd0\u884c\u6743\u9650\u63d0\u5347 \u8fde\u63a5\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE \u79c1\u94a5\u8def\u5f84\uff0c\u4f7f\u7528\u8fd9\u4e2a\u6587\u4ef6\u6765\u9a8c\u8bc1\u8fde\u63a5 --scp-extra-args SCP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 scp \uff0c\u4f8b\u5982 -l --sftp-extra-args SFTP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 sftp \uff0c\u4f8b\u5982 -f --ssh-common-args SSH_COMMON_ARGS \u6307\u5b9a\u8981\u4f20\u9012\u7ed9sftp / scp / ssh\u7684\u901a\u7528\u53c2\u6570\uff08\u4f8b\u5982 ProxyCommand\uff09 --ssh-extra-args SSH_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 ssh \uff0c\u4f8b\u5982 -R -T TIMEOUT, --timeout=TIMEOUT \u6307\u5b9a\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u662f10S -c CONNECTION, --connection=CONNECTION \u6307\u5b9a\u8fde\u63a5\u7c7b\u578b\uff0c\u9ed8\u8ba4smart -k, --ask-pass \u8981\u6c42\u7528\u6237\u8f93\u5165\u8bf7\u6c42\u8fde\u63a5\u5bc6\u7801 -u REMOTE_USER, --user=REMOTE_USER \u6307\u5b9a\u8fde\u63a5\u7528\u6237 \u793a\u4f8b\uff1a ansible-console all -i 192 .168.77.133, -m ping -k root@all ( 1 )[ f:5 ] $ ping 192 .168.77.133 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" }","title":"ansible-console"},{"location":"basic/Ansible-command/#ansible-doc","text":"\u8be5\u6307\u4ee4\u7528\u4e8e\u67e5\u770b\u6a21\u5757\u4fe1\u606f\uff0c\u5e38\u7528\u53c2\u6570\u6709\u4e24\u4e2a-l \u548c -s # ansible-doc --help usage: ansible-doc [ -h ] [ --version ] [ -v ] [ -M MODULE_PATH ] [ --playbook-dir BASEDIR ] [ -t { become,cache,callback,cliconf,connection,httpapi,inventory,lookup,netconf,shell,module,strategy,vars }] [ -j ] [ -F | -l | -s | --metadata-dump ] [ plugin [ plugin ... ]] \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e plugin \u63d2\u4ef6 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --metadata-dump \u83b7\u53d6\u6240\u6709\u63d2\u4ef6\u7684metadata json\u6570\u636e --playbook-dir BASEDIR \u6307\u5b9aplaybook\u76ee\u5f55\uff0c\u4e3a role , group_vars/etc \u6307\u5b9a\u76f8\u5bf9\u8def\u5f84 --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u4fe1\u606f -F, --list_files \u663e\u793a\u63d2\u4ef6\u540d\u79f0\u53ca\u5176\u6e90\u6587\u4ef6\uff0c\u4e0d\u663e\u793a\u6458\u8981 -h, --help \u663e\u793a\u5e2e\u52a9\u6587\u4ef6 -j, --json \u4f7f\u7528json\u683c\u5f0f\u8f93\u51fa -l, --list \u5217\u51fa\u53ef\u7528\u7684\u63d2\u4ef6 -s, --snippet \u663e\u793a\u6307\u5b9a\u63d2\u4ef6\u7684 playbook \u6458\u8981 -t \u6307\u5b9a\u63d2\u4ef6\u7c7b\u578b\uff0c\u9ed8\u8ba4 module \u793a\u4f8b\uff1a ansible-doc -l ansible-doc yum ansible-doc yum -s ansible-doc -t cache -l ansible-doc -t become -l","title":"ansible-doc"},{"location":"basic/Ansible-command/#ansible-galaxy","text":"ansible-galaxy \u6307\u4ee4\u7528\u4e8e\u65b9\u4fbf\u7684\u4ecehttps://galaxy.ansible.com/ \u7ad9\u70b9\u4e0b\u8f7d\u7b2c\u4e09\u65b9\u6269\u5c55\u6a21\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u5f62\u8c61\u7684\u7406\u89e3\u5176\u7c7b\u4f3c\u4e8ecentos\u4e0b\u7684yum\u3001python\u4e0b\u7684pip\u6216easy_install # ansible-galaxy --help usage: ansible-galaxy [ -h ] [ --version ] [ -v ] TYPE ... \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e collection \u7ba1\u7406Ansible Galaxy\u3002 role \u7ba1\u7406Ansible Galaxy role\u3002 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u53f7 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f -v, --verbose \u8be6\u7ec6\u6a21\u5f0f\uff08-vvv\u8868\u793a\u66f4\u591a\uff0c-vvvv\u8868\u793a\u542f\u7528\u8fde\u63a5\u8c03\u8bd5\uff09 \u793a\u4f8b\uff1a ansible-galaxy search tomcat # \u641c\u7d22\u89d2\u8272 ansible-galaxy install aeriscloud.docker #\u4e0b\u8f7d\u89d2\u8272 ansible-galaxy list ragingbal.tomcat ansible-galaxy info ragingbal.tomcat ansible-galaxy init abc # \u521b\u5efa\u89d2\u8272\u6a21\u677f # \u5b89\u88c5\u7684role\u5728 /root/.ansible/roles/","title":"ansible-galaxy"},{"location":"basic/Ansible-command/#ansible-playbook","text":"\u5bf9\u4e8e\u9700\u53cd\u590d\u6267\u884c\u7684\u3001\u8f83\u4e3a\u590d\u6742\u7684\u4efb\u52a1\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49 Playbook \u6765\u641e\u5b9a\u3002Playbook \u662f Ansible \u771f\u6b63\u5f3a\u5927\u7684\u5730\u65b9\uff0c\u5b83\u5141\u8bb8\u4f7f\u7528\u53d8\u91cf\u3001\u6761\u4ef6\u3001\u5faa\u73af\u3001\u4ee5\u53ca\u6a21\u677f\uff0c\u4e5f\u80fd\u901a\u8fc7\u89d2\u8272 \u53ca\u5305\u542b\u6307\u4ee4\u6765\u91cd\u7528\u65e2\u6709\u5185\u5bb9\u3002 # ansible-playbook --help usage: ansible-playbook [ -h ] [ --version ] [ -v ] [ -k ] [ --private-key PRIVATE_KEY_FILE ] [ -u REMOTE_USER ] [ -c CONNECTION ] [ -T TIMEOUT ] [ --ssh-common-args SSH_COMMON_ARGS ] [ --sftp-extra-args SFTP_EXTRA_ARGS ] [ --scp-extra-args SCP_EXTRA_ARGS ] [ --ssh-extra-args SSH_EXTRA_ARGS ] [ --force-handlers ] [ --flush-cache ] [ -b ] [ --become-method BECOME_METHOD ] [ --become-user BECOME_USER ] [ -K ] [ -t TAGS ] [ --skip-tags SKIP_TAGS ] [ -C ] [ --syntax-check ] [ -D ] [ -i INVENTORY ] [ --list-hosts ] [ -l SUBSET ] [ -e EXTRA_VARS ] [ --vault-id VAULT_IDS ] [ --ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES ] [ -f FORKS ] [ -M MODULE_PATH ] [ --list-tasks ] [ --list-tags ] [ --step ] [ --start-at-task START_AT_TASK ] playbook [ playbook ... ] \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e playbook playbook\u6587\u4ef6 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --ask-vault-pass \u63d0\u793a\u8f93\u5165vault \u5bc6\u7801\u3002 --flush-cache \u6e05\u9664fact\u7f13\u5b58 --force-handlers \u5982\u679c\u4efb\u52a1\u5931\u8d25\uff0c\u4e5f\u8981\u8fd0\u884chandlers --list-hosts \u8f93\u51fa\u5339\u914d\u4e3b\u673a\u7684\u5217\u8868\u3002 --list-tags \u5217\u51fa\u6240\u6709\u53ef\u7528\u7684\u6807\u7b7e --list-tasks \u5217\u51fa\u5c06\u8981\u6267\u884c\u7684\u6240\u6709\u4efb\u52a1 --skip-tags=SKIP_TAGS \u8df3\u8fc7\u8fd0\u884c\u6807\u8bb0\u6b64\u6807\u7b7e\u7684\u4efb\u52a1 -start-at-task=START_AT_TASK \u5728\u6b64\u4efb\u52a1\u5904\u5f00\u59cb\u8fd0\u884c --step \u4e00\u6b65\u4e00\u6b65\u7684\u6267\u884c\uff1a\u5728\u8fd0\u884c\u4e4b\u524d\u786e\u8ba4\u6bcf\u4e2a\u4efb\u52a1 --syntax-check \u5bf9playbook\u8fdb\u884c\u8bed\u6cd5\u68c0\u67e5\uff0c\u4e14\u4e0d\u6267\u884cplaybook\u3002 --vault-id=VAULT_IDS \u6807\u8bc6\u4f7f\u7528\u7684vault id --vault-password-file=VAULT_PASSWORD_FILE \u6307\u5b9avault\u5bc6\u7801\u6587\u4ef6 --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u4fe1\u606f -C, --check \u53ea\u662f\u6d4b\u8bd5\u4e00\u4e0b\u4f1a\u6539\u53d8\u4ec0\u4e48\u5185\u5bb9\uff0c\u4e0d\u4f1a\u771f\u6b63\u53bb\u6267\u884c;\u76f8\u53cd,\u8bd5\u56fe\u9884\u6d4b\u4e00\u4e9b\u53ef\u80fd\u53d1\u751f\u7684\u53d8\u5316\u3002 -D, --diff \u5f53\u66f4\u6539\u6587\u4ef6\u548c\u6a21\u677f\u65f6\uff0c\u663e\u793a\u8fd9\u4e9b\u6587\u4ef6\u5f97\u5dee\u5f02\uff0c\u6bd4--check\u6548\u679c\u597d\u3002 -M MODULE_PATH, --module-path MODULE_PATH \u8981\u6267\u884c\u7684\u6a21\u5757\u7684\u8def\u5f84\uff0c\u9ed8\u8ba4\u8def\u5f84 ~/.ansible/plugins/modules:/usr/share/ansible/plu<br/> gins/modules) -e EXTRA_VARS, --extra-vars EXTRA_VARS \u6dfb\u52a0\u9644\u52a0\u53d8\u91cf\uff0c\u6bd4\u5982key=value\uff0cyaml\uff0cjson\u683c\u5f0f\u3002\u4f7f\u7528 @ \u6307\u5b9a\u6587\u4ef6 -f FORKS, --forks FORKS \u6307\u5b9a\u5b9a\u8981\u4f7f\u7528\u7684\u5e76\u884c\u8fdb\u7a0b\u6570\uff0c\u9ed8\u8ba4\u4e3a5\u4e2a\u3002 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f\u3002 -i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY \u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u6216\u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\uff0c\u9ed8\u8ba4\u4e3a/etc/ansible/hosts\u3002 -l SUBSET, --limit SUBSET \u8fdb\u4e00\u6b65\u9650\u5236\u6240\u9009\u4e3b\u673a/\u7ec4\u6a21\u5f0f\uff0c\u53ea\u6267\u884c -l \u540e\u7684\u4e3b\u673a\u548c\u7ec4\u3002 -t TAGS, --tags TAGS \u8fd0\u884c\u6307\u5b9a\u7684\u5e26\u6709tags\u4efb\u52a1 -v, --verbose \u8f93\u51fa\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f7f\u7528-vvv\u83b7\u5f97\u66f4\u591a\uff0c-vvvv \u542f\u7528\u8fde\u63a5\u8c03\u8bd5 \u7279\u6743\u5347\u7ea7\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --become-method=BECOME_METHOD \u6743\u9650\u5347\u7ea7\u65b9\u6cd5\u4f7f\u7528 \uff0c\u9ed8\u8ba4\u4e3asudo\uff0c\u6709\u6548\u9009\u62e9\uff1a[sudo | su | pbrun | pfexec | runas | doas | dzdo] --become-user=BECOME_USER \u4f7f\u7528\u54ea\u4e2a\u7528\u6237\u8fd0\u884c\uff0c\u9ed8\u8ba4\u4e3aroot -K, --ask-become-pass \u63d0\u4f9b\u6743\u9650\u63d0\u5347\u5bc6\u7801 -b, --become \u8fd0\u884c\u6743\u9650\u63d0\u5347 \u8fde\u63a5\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE \u79c1\u94a5\u8def\u5f84\uff0c\u4f7f\u7528\u8fd9\u4e2a\u6587\u4ef6\u6765\u9a8c\u8bc1\u8fde\u63a5 --scp-extra-args SCP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 scp \uff0c\u4f8b\u5982 -l --sftp-extra-args SFTP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 sftp \uff0c\u4f8b\u5982 -f --ssh-common-args SSH_COMMON_ARGS \u6307\u5b9a\u8981\u4f20\u9012\u7ed9sftp / scp / ssh\u7684\u901a\u7528\u53c2\u6570\uff08\u4f8b\u5982 ProxyCommand\uff09 --ssh-extra-args SSH_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 ssh \uff0c\u4f8b\u5982 -R -T TIMEOUT, --timeout=TIMEOUT \u6307\u5b9a\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u662f10S -c CONNECTION, --connection=CONNECTION \u6307\u5b9a\u8fde\u63a5\u7c7b\u578b\uff0c\u9ed8\u8ba4smart -k, --ask-pass \u8981\u6c42\u7528\u6237\u8f93\u5165\u8bf7\u6c42\u8fde\u63a5\u5bc6\u7801 -u REMOTE_USER, --user=REMOTE_USER \u6307\u5b9a\u8fde\u63a5\u7528\u6237 \u793a\u4f8b\uff1a ansible-playbook -i hosts ssh-addkey.yml # \u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u6587\u4ef6 ansible-playbook -i hosts ssh-addkey.yml --list-tags # \u5217\u51fatags ansible-playbook -i hosts ssh-addkey.yml -t install # \u6267\u884cinstall\u6807\u7b7e\u7684\u4efb\u52a1 ansible-playbook -i hosts ssh-addkey.yml -t install -e a = 1 # \u6307\u5b9a\u53d8\u91cf","title":"ansible-playbook"},{"location":"basic/Ansible-command/#ansible-pull","text":"pull\u6a21\u5f0f\u5728\u88ab\u914d\u7f6e\u7684\u673a\u5668\u4e0a\u8fd0\u884c\uff0c\u901f\u5ea6\u5f88\u5feb\u3002\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u4f60\u9700\u8981\u63d0\u4f9b\u4e00\u4e2agit\u4ed3\u5e93\u6765\u4f9bAnsible\u4e0b\u8f7d\u6765\u914d\u7f6e\u4f60\u7684\u673a\u5668\u3002 # ansible-pull --help usage: ansible-pull [ -h ] [ --version ] [ -v ] [ -k ] [ --private-key PRIVATE_KEY_FILE ] [ -u REMOTE_USER ] [ -c CONNECTION ] [ -T TIMEOUT ] [ --ssh-common-args SSH_COMMON_ARGS ] [ --sftp-extra-args SFTP_EXTRA_ARGS ] [ --scp-extra-args SCP_EXTRA_ARGS ] [ --ssh-extra-args SSH_EXTRA_ARGS ] [ --vault-id VAULT_IDS ] [ --ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES ] [ -e EXTRA_VARS ] [ -t TAGS ] [ --skip-tags SKIP_TAGS ] [ -i INVENTORY ] [ --list-hosts ] [ -l SUBSET ] [ -M MODULE_PATH ] [ -K ] [ --purge ] [ -o ] [ -s SLEEP ] [ -f ] [ -d DEST ] [ -U URL ] [ --full ] [ -C CHECKOUT ] [ --accept-host-key ] [ -m MODULE_NAME ] [ --verify-commit ] [ --clean ] [ --track-subs ] [ --check ] [ --diff ] [ playbook.yml [ playbook.yml ... ]] \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e playbook playbook\u6587\u4ef6 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --accept-host-key \u6307\u5b9a\u4ed3\u5e93\u7684\u4e3b\u673a\u79d8\u94a5 --ask-vault-pass \u63d0\u793a\u8f93\u5165vault \u5bc6\u7801\u3002 --check \u53ea\u505a\u68c0\u67e5\uff0c\u4e0d\u505a\u66f4\u6539 --clean \u5de5\u4f5c\u5b58\u50a8\u5e93\u4e2d\u7684\u5df2\u4fee\u6539\u6587\u4ef6\u5c06\u88ab\u5220\u9664 --diff \u66f4\u6539\uff08\u5c0f\u7684\uff09\u6587\u4ef6\u548c\u6a21\u677f\u65f6\uff0c\u663e\u793a\u8fd9\u4e9b\u6587\u4ef6\u4e2d\u7684\u5dee\u5f02 --full \u5b8c\u6574\u514b\u9686 --list-hosts \u8f93\u51fa\u5339\u914d\u4e3b\u673a\u5217\u8868 --purge \u8fd0\u884c\u540e\u6e05\u9664 --skip-tags SKIP_TAGS \u8df3\u8fc7\u8fd0\u884c\u6807\u8bb0\u6b64\u6807\u7b7e\u7684\u4efb\u52a1 --track-subs \u6a21\u5757\u5c06\u8ddf\u8e2a\u6700\u65b0\u7684\u53d8\u5316\u3002 \u8fd9\u76f8\u5f53\u4e8e\u6307\u5b9a--remote\u6807\u5fd7\u6765git\u5b50\u6a21\u5757\u66f4\u65b0 --vault-id=VAULT_IDS \u6807\u8bc6\u4f7f\u7528\u7684vault id --vault-password-file=VAULT_PASSWORD_FILE \u6307\u5b9avault\u5bc6\u7801\u6587\u4ef6 --verify-commit \u9a8c\u8bc1\u5df2\u68c0\u51fa\u63d0\u4ea4\u7684GPG\u7b7e\u540d\uff0c\u5982\u679c\u5931\u8d25\u5219\u4e2d\u6b62\u8fd0\u884c\u5267\u672c\u3002 --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u4fe1\u606f -C CHECKOUT, --checkout=CHECKOUT \u6307\u5b9a\u514b\u9686\u7684\u5206\u652f -M MODULE_PATH, --module-path MODULE_PATH \u8981\u6267\u884c\u7684\u6a21\u5757\u7684\u8def\u5f84\uff0c\u9ed8\u8ba4\u8def\u5f84 ~/.ansible/plugins/modules:/usr/share/ansible/plu<br/> gins/modules) -U URL, --url URL playbook\u4ed3\u5e93\u7684\u5730\u5740 -d DEST, --directory DEST \u6307\u5b9a\u68c0\u51fa\u76ee\u5f55 -e EXTRA_VARS, --extra-vars EXTRA_VARS \u6dfb\u52a0\u9644\u52a0\u53d8\u91cf\uff0c\u6bd4\u5982key=value\uff0cyaml\uff0cjson\u683c\u5f0f\u3002\u4f7f\u7528 @ \u6307\u5b9a\u6587\u4ef6 -f FORKS, --forks FORKS \u6307\u5b9a\u5b9a\u8981\u4f7f\u7528\u7684\u5e76\u884c\u8fdb\u7a0b\u6570\uff0c\u9ed8\u8ba4\u4e3a5\u4e2a\u3002 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f\u3002 -i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY \u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u6216\u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\uff0c\u9ed8\u8ba4\u4e3a/etc/ansible/hosts\u3002 -l SUBSET, --limit SUBSET \u8fdb\u4e00\u6b65\u9650\u5236\u6240\u9009\u4e3b\u673a/\u7ec4\u6a21\u5f0f\uff0c\u53ea\u6267\u884c -l \u540e\u7684\u4e3b\u673a\u548c\u7ec4\u3002 -m MODULE_NAME, --module-name MODULE_NAME \u4ed3\u5e93\u6a21\u5757\u540d\u79f0\uff0c\u53ef\u9009\u503c('git', 'subversion', 'hg', 'bzr')\u9ed8\u8ba4\u4e3agit\u3002 -o, --only-if-changed \u5f53\u5b58\u50a8\u5e93\u5df2\u66f4\u65b0\u65f6\u624d\u8fd0\u884c\u5267\u672c -s SLEEP, --sleep SLEEP \u6307\u5b9a\u7761\u7720\u65f6\u95f4 -t TAGS, --tags TAGS \u8fd0\u884c\u6307\u5b9a\u7684\u5e26\u6709tags\u4efb\u52a1 -v, --verbose \u8f93\u51fa\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f7f\u7528-vvv\u83b7\u5f97\u66f4\u591a\uff0c-vvvv \u542f\u7528\u8fde\u63a5\u8c03\u8bd5 \u7279\u6743\u5347\u7ea7\u9009\u9879 \u53c2\u6570 \u8bf4\u660e -K, --ask-become-pass \u63d0\u4f9b\u6743\u9650\u63d0\u5347\u5bc6\u7801 \u8fde\u63a5\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE \u79c1\u94a5\u8def\u5f84\uff0c\u4f7f\u7528\u8fd9\u4e2a\u6587\u4ef6\u6765\u9a8c\u8bc1\u8fde\u63a5 --scp-extra-args SCP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 scp \uff0c\u4f8b\u5982 -l --sftp-extra-args SFTP_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 sftp \uff0c\u4f8b\u5982 -f --ssh-common-args SSH_COMMON_ARGS \u6307\u5b9a\u8981\u4f20\u9012\u7ed9sftp / scp / ssh\u7684\u901a\u7528\u53c2\u6570\uff08\u4f8b\u5982 ProxyCommand\uff09 --ssh-extra-args SSH_EXTRA_ARGS \u6307\u5b9a\u989d\u5916\u7684\u53c2\u6570\u4f20\u9012\u7ed9 ssh \uff0c\u4f8b\u5982 -R -T TIMEOUT, --timeout=TIMEOUT \u6307\u5b9a\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u662f10S -c CONNECTION, --connection=CONNECTION \u6307\u5b9a\u8fde\u63a5\u7c7b\u578b\uff0c\u9ed8\u8ba4smart -K, --ask-become-pass \u8981\u6c42\u7528\u6237\u8f93\u5165\u8bf7\u6c42\u8fde\u63a5\u5bc6\u7801 -u REMOTE_USER, --user=REMOTE_USER \u6307\u5b9a\u8fde\u63a5\u7528\u6237 \u793a\u4f8b\uff1a ansible-pull -o -C master -d /tmp/pull -i /tmp/pull/hosts -U https://github.com/lework/Ansible-Pull-Example.git","title":"ansible-pull"},{"location":"basic/Ansible-command/#ansible-config","text":"\u7f16\u8f91\u7ba1\u7406ansible\u914d\u7f6e # ansible-config --help usage: ansible-config [ -h ] [ --version ] [ -v ] { list,dump,view } ... \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e list \u663e\u793a\u6240\u6709\u7684\u53c2\u6570\u914d\u7f6e dump dump\u914d\u7f6e view \u67e5\u770b\u914d\u7f6e\u6587\u4ef6 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u53f7 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f -v, --verbose \u8be6\u7ec6\u6a21\u5f0f\uff08-vvv\u8868\u793a\u66f4\u591a\uff0c-vvvv\u8868\u793a\u542f\u7528\u8fde\u63a5\u8c03\u8bd5\uff09 \u793a\u4f8b\uff1a ansible-config view ansible-config list ansible-config dump","title":"ansible-config"},{"location":"basic/Ansible-command/#ansible-inventory","text":"\u67e5\u770b\u4e3b\u673a\u6e05\u5355\u4fe1\u606f # ansible-inventory --help usage: ansible-inventory [ -h ] [ --version ] [ -v ] [ -i INVENTORY ] [ --vault-id VAULT_IDS ] [ --ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES ] [ --playbook-dir BASEDIR ] [ --list ] [ --host HOST ] [ --graph ] [ -y ] [ --toml ] [ --vars ] [ --export ] [ --output OUTPUT_FILE ] [ host | group ] \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e host/group \u4e3b\u673a/\u4e3b\u673a\u7ec4 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --accept-host-key \u6307\u5b9a\u4ed3\u5e93\u7684\u4e3b\u673a\u79d8\u94a5 --export \u5bfc\u51fa\u4fe1\u606f\uff0c\u4e0e--list\u6216--graph\u4e00\u8d77\u4f7f\u7528 --output OUTPUT_FILE \u5bfc\u51fa\u4fe1\u606f\u5230\u6587\u4ef6\uff0c\u4e0e--list\u6216--graph\u4e00\u8d77\u4f7f\u7528 --playbook-dir BASEDIR \u6307\u5b9aplaybook\u76ee\u5f55\uff0c\u4e3a role , group_vars/etc \u6307\u5b9a\u76f8\u5bf9\u8def\u5f84 --toml \u4f7f\u7528toml\u683c\u5f0f\u8f93\u51fa,\u9ed8\u8ba4\u662fjson\u683c\u5f0f --vars \u8f93\u51fa\u53d8\u91cf\u4fe1\u606f\uff0c\u4e0e--list\u6216--graph\u4e00\u8d77\u4f7f\u7528 --vault-id=VAULT_IDS \u6807\u8bc6\u4f7f\u7528\u7684vault id --vault-password-file=VAULT_PASSWORD_FILE \u6307\u5b9avault\u5bc6\u7801\u6587\u4ef6 --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u4fe1\u606f -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f\u3002 -i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY \u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u6216\u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\uff0c\u9ed8\u8ba4\u4e3a/etc/ansible/hosts\u3002 -v, --verbose \u8f93\u51fa\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4f7f\u7528-vvv\u83b7\u5f97\u66f4\u591a\uff0c-vvvv \u542f\u7528\u8fde\u63a5\u8c03\u8bd5 -y, --yaml \u4f7f\u7528yaml\u683c\u5f0f\u8f93\u51fa,\u9ed8\u8ba4\u662fjson\u683c\u5f0f \u52a8\u4f5c\u9009\u9879 \u53c2\u6570 \u8bf4\u660e --graph \u521b\u5efa\u4e3b\u673a\u6e05\u5355\u56fe --host HOST \u8f93\u51fa\u4e3b\u673a\u6e05\u5355\u4fe1\u606f --list \u4ee5json\u7684\u683c\u5f0f\u8f93\u51fa\u6240\u6709\u4e3b\u673a\u6e05\u5355\u4fe1\u606f \u793a\u4f8b\uff1a ansible-inventory --export --graph ansible-inventory -i /etc/ansible/hosts --export --list ansible-inventory --host = 192 .168.1.100 ansible-inventory --vars --list ``` ## ansible-vault ansible-vault\u4e3b\u8981\u5e94\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\u4e2d\u542b\u6709\u654f\u611f\u4fe1\u606f\uff0c\u53c8\u4e0d\u5e0c\u671b\u4ed6\u80fd\u88ab\u4eba\u770b\u5230\uff0cvault\u53ef\u4ee5\u5e2e\u4f60\u52a0\u5bc6/\u89e3\u5bc6\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u3002\u8fd9\u79cdplaybook\u6587\u4ef6\u5728\u6267\u884c\u65f6\uff0c\u9700\u8981\u52a0\u4e0a ` --ask-vault-pass ` \u53c2\u6570\uff0c\u540c\u6837\u9700\u8981\u8f93\u5165\u5bc6\u7801\u540e\u624d\u80fd\u6b63\u5e38\u6267\u884c\u3002 ``` bash # ansible-vault --help usage: ansible-vault [ -h ] [ --version ] [ -v ] { create,decrypt,edit,view,encrypt,encrypt_string,rekey } ... \u4f4d\u7f6e\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e create \u521b\u5efa\u52a0\u5bc6\u6587\u4ef6 decrypt \u89e3\u5bc6\u6587\u4ef6 edit \u7f16\u8f91\u52a0\u5bc6\u6587\u4ef6 view \u67e5\u770b\u52a0\u5bc6\u6587\u4ef6 encrypt \u52a0\u5bc6\u6587\u4ef6 encrypt_string \u8f93\u51fa\u52a0\u5bc6\u5b57\u7b26\u4e32 rekey \u91cd\u65b0\u52a0\u5bc6\u6587\u4ef6 \u9009\u9879\u53c2\u6570 \u53c2\u6570 \u8bf4\u660e --version \u663e\u793a\u7a0b\u5e8f\u7248\u672c\u53f7 -h, --help \u663e\u793a\u6b64\u5e2e\u52a9\u4fe1\u606f -v, --verbose \u8be6\u7ec6\u6a21\u5f0f\uff08-vvv\u8868\u793a\u66f4\u591a\uff0c-vvvv\u8868\u793a\u542f\u7528\u8fde\u63a5\u8c03\u8bd5\uff09 \u793a\u4f8b\uff1a ansible-vault create # /tmp/123 \u521b\u5efa\u52a0\u5bc6\u6587\u4ef6 ansible-vault view # /tmp/123 \u67e5\u770b\u52a0\u5bc6\u6587\u4ef6 ansible-vault encrypt # /tmp/abc \u52a0\u5bc6\u6587\u4ef6 ansible-vault decrypt # /tmp/abc \u89e3\u5bc6\u6587\u4ef6 ansible-vault edit # /tmp/abc \u7f16\u8f91\u52a0\u5bc6\u6587\u4ef6 ansible-vault encrypt_string '123' # \u8f93\u51fa\u52a0\u5bc6\u5b57\u7b26\u4e32","title":"ansible-inventory"},{"location":"basic/Blocks/","text":"14. Blocks \u00b6 Blocks \u5141\u8bb8\u4efb\u52a1\u7684\u903b\u8f91\u5206\u7ec4\u548c play \u4e2d\u7684\u9519\u8bef\u5904\u7406\u3002\u60a8\u53ef\u4ee5\u5e94\u7528\u4e8e\u5355\u4e2a\u4efb\u52a1\u7684\u5927\u90e8\u5206\u5185\u5bb9(\u5faa\u73af\u9664\u5916)\u90fd\u53ef\u4ee5\u5e94\u7528\u4e8e\u5757\u7ea7\u522b\uff0c\u8fd9\u4e5f\u4f7f\u5f97\u8bbe\u7f6e\u4efb\u52a1\u901a\u7528\u7684\u6570\u636e\u6216\u6307\u4ee4\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002\u8fd9\u5e76\u4e0d\u610f\u5473\u7740\u6307\u4ee4\u5f71\u54cd\u5757\u672c\u8eab\uff0c\u800c\u662f\u7531\u5757\u6240\u5305\u542b\u7684\u4efb\u52a1\u7ee7\u627f\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a when \u5c06\u5e94\u7528\u4e8e\u4efb\u52a1\uff0c\u800c\u4e0d\u662f\u5757\u672c\u8eab\u3002 tasks : - name : Install, configure, and start Apache block : - name : install httpd and memcached yum : name : - httpd - memcached state : present - name : apply the foo config template template : src : templates/src.j2 dest : /etc/foo.conf - name : start service bar and enable it service : name : bar state : started enabled : True when : ansible_facts['distribution'] == 'CentOS' become : true become_user : root ignore_errors : yes \u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u8fd93\u4e2a\u4efb\u52a1\u90fd\u662f\u5728\u4ece\u5757\u4e2d\u7ee7\u627f when \u6761\u4ef6\u5e76\u5728\u4efb\u52a1\u4e0a\u5224\u65ad\u4e4b\u540e\u6267\u884c\u7684\u3002\u5b83\u4eec\u8fd8\u7ee7\u627f\u4e86\u7279\u6743\u5347\u7ea7\u6307\u4ee4\uff0c\u4f7f become \u80fd\u591f\u5e94\u7528\u5230block\u6240\u5305\u542b\u7684\u6240\u6709\u4efb\u52a1\u3002\u6700\u540e\uff0c ignore_errors: yes \u5373\u4f7f\u6709\u4efb\u52a1\u5931\u8d25\u4e86\uff0c\u4e5f\u5c06\u7ee7\u7eed\u6267\u884c\u5267\u672c\u3002 \u5757\u7684\u9519\u8bef\u5904\u7406 \u00b6 \u5757\u8fd8\u5f15\u5165\u4e86\u4ee5\u7c7b\u4f3c\u4e8e\u5927\u591a\u6570\u7f16\u7a0b\u8bed\u8a00\u4e2d\u7684\u5f02\u5e38\u7684\u65b9\u5f0f\u5904\u7406\u9519\u8bef\u7684\u80fd\u529b\u3002\u5757\u53ea\u5904\u7406\u4efb\u52a1\u7684\u5931\u8d25\u72b6\u6001\u3002\u9519\u8bef\u7684\u4efb\u52a1\u5b9a\u4e49\u6216\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u662f\u4e0d\u80fd\u89e6\u53d1\u5757\u7684\u9519\u8bef\u5904\u7406\u3002 - name : Attempt and graceful roll back demo block : - debug : msg : 'I execute normally' - name : i force a failure command : /bin/false - debug : msg : 'I never execute, due to the above task failing, :-(' rescue : - debug : msg : 'I caught an error' - name : i force a failure in middle of recovery! >:-) command : /bin/false - debug : msg : 'I also never execute :-(' always : - debug : msg : \"This always executes\" block\u4e2d\u7684\u4efb\u52a1\u5728\u6267\u884c\u4e2d\uff0c\u5982\u679c\u6709\u4efb\u4f55\u9519\u8bef\uff0c\u5c06\u6267\u884c**rescue**\u4e2d\u7684\u4efb\u52a1\u3002 \u65e0\u8bba\u5728block\u548crescue\u4e2d\u53d1\u751f\u6216\u6ca1\u6709\u53d1\u751f\u9519\u8bef\uff0c**always**\u90e8\u5206\u90fd\u8fd0\u884c\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c**rescue**\u90e8\u5206\u6210\u529f\u5b8c\u6210\uff0c\u90a3\u4e48 play \u5c06\u7ee7\u7eed\u8fdb\u884c\uff0c\u56e0\u4e3a\u5b83\u5c06\u64e6\u9664\u9519\u8bef\u72b6\u6001(\u4f46\u4e0d\u5305\u62ec\u62a5\u544a),\u8fd9\u610f\u5473\u7740\u5b83\u4e0d\u4f1a\u89e6\u53d1 max_fail_percentage \u6216 any_errors_fatal \u7684\u914d\u7f6e\uff0c\u4f46\u5c06\u51fa\u73b0\u5728playbook\u7edf\u8ba1\u3002 \u53d1\u751f\u9519\u8bef\u540e\uff0c\u4f9d\u7136\u8fd0\u884chandlers tasks : - name : Attempt and graceful roll back demo block : - debug : msg : 'I execute normally' changed_when : yes notify : run me even after an error - command : /bin/false rescue : - name : make sure all handlers run meta : flush_handlers handlers : - name : run me even after an error debug : msg : 'This handler runs even on error' Ansible\u8fd8\u4e3ablock\u7684rescue\u90e8\u5206\u7684\u4efb\u52a1\u63d0\u4f9b\u4e86\u4e24\u4e2a\u53d8\u91cf ansible_failed_task \u8fd4\u56de\u89e6\u53d1 rescue \u7684\u5931\u8d25\u4efb\u52a1\u3002\u4f8b\u5982\uff0c\u8981\u83b7\u53d6\u540d\u79f0\uff0c\u8bf7\u4f7f\u7528 ansible_failed_task.name \u3002 ansible_failed_result \u8fd4\u56de\u89e6\u53d1 rescue \u7684\u5931\u8d25\u4efb\u52a1\u7684\u8fd4\u56de\u7ed3\u679c\u3002\u8fd9\u76f8\u5f53\u4e8e\u5728\u5931\u8d25\u4efb\u52a1\u4e2d\u6dfb\u52a0 register: ansible_failed_result","title":"14. Blocks"},{"location":"basic/Blocks/#14-blocks","text":"Blocks \u5141\u8bb8\u4efb\u52a1\u7684\u903b\u8f91\u5206\u7ec4\u548c play \u4e2d\u7684\u9519\u8bef\u5904\u7406\u3002\u60a8\u53ef\u4ee5\u5e94\u7528\u4e8e\u5355\u4e2a\u4efb\u52a1\u7684\u5927\u90e8\u5206\u5185\u5bb9(\u5faa\u73af\u9664\u5916)\u90fd\u53ef\u4ee5\u5e94\u7528\u4e8e\u5757\u7ea7\u522b\uff0c\u8fd9\u4e5f\u4f7f\u5f97\u8bbe\u7f6e\u4efb\u52a1\u901a\u7528\u7684\u6570\u636e\u6216\u6307\u4ee4\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002\u8fd9\u5e76\u4e0d\u610f\u5473\u7740\u6307\u4ee4\u5f71\u54cd\u5757\u672c\u8eab\uff0c\u800c\u662f\u7531\u5757\u6240\u5305\u542b\u7684\u4efb\u52a1\u7ee7\u627f\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a when \u5c06\u5e94\u7528\u4e8e\u4efb\u52a1\uff0c\u800c\u4e0d\u662f\u5757\u672c\u8eab\u3002 tasks : - name : Install, configure, and start Apache block : - name : install httpd and memcached yum : name : - httpd - memcached state : present - name : apply the foo config template template : src : templates/src.j2 dest : /etc/foo.conf - name : start service bar and enable it service : name : bar state : started enabled : True when : ansible_facts['distribution'] == 'CentOS' become : true become_user : root ignore_errors : yes \u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u8fd93\u4e2a\u4efb\u52a1\u90fd\u662f\u5728\u4ece\u5757\u4e2d\u7ee7\u627f when \u6761\u4ef6\u5e76\u5728\u4efb\u52a1\u4e0a\u5224\u65ad\u4e4b\u540e\u6267\u884c\u7684\u3002\u5b83\u4eec\u8fd8\u7ee7\u627f\u4e86\u7279\u6743\u5347\u7ea7\u6307\u4ee4\uff0c\u4f7f become \u80fd\u591f\u5e94\u7528\u5230block\u6240\u5305\u542b\u7684\u6240\u6709\u4efb\u52a1\u3002\u6700\u540e\uff0c ignore_errors: yes \u5373\u4f7f\u6709\u4efb\u52a1\u5931\u8d25\u4e86\uff0c\u4e5f\u5c06\u7ee7\u7eed\u6267\u884c\u5267\u672c\u3002","title":"14. Blocks"},{"location":"basic/Blocks/#_1","text":"\u5757\u8fd8\u5f15\u5165\u4e86\u4ee5\u7c7b\u4f3c\u4e8e\u5927\u591a\u6570\u7f16\u7a0b\u8bed\u8a00\u4e2d\u7684\u5f02\u5e38\u7684\u65b9\u5f0f\u5904\u7406\u9519\u8bef\u7684\u80fd\u529b\u3002\u5757\u53ea\u5904\u7406\u4efb\u52a1\u7684\u5931\u8d25\u72b6\u6001\u3002\u9519\u8bef\u7684\u4efb\u52a1\u5b9a\u4e49\u6216\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u662f\u4e0d\u80fd\u89e6\u53d1\u5757\u7684\u9519\u8bef\u5904\u7406\u3002 - name : Attempt and graceful roll back demo block : - debug : msg : 'I execute normally' - name : i force a failure command : /bin/false - debug : msg : 'I never execute, due to the above task failing, :-(' rescue : - debug : msg : 'I caught an error' - name : i force a failure in middle of recovery! >:-) command : /bin/false - debug : msg : 'I also never execute :-(' always : - debug : msg : \"This always executes\" block\u4e2d\u7684\u4efb\u52a1\u5728\u6267\u884c\u4e2d\uff0c\u5982\u679c\u6709\u4efb\u4f55\u9519\u8bef\uff0c\u5c06\u6267\u884c**rescue**\u4e2d\u7684\u4efb\u52a1\u3002 \u65e0\u8bba\u5728block\u548crescue\u4e2d\u53d1\u751f\u6216\u6ca1\u6709\u53d1\u751f\u9519\u8bef\uff0c**always**\u90e8\u5206\u90fd\u8fd0\u884c\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c**rescue**\u90e8\u5206\u6210\u529f\u5b8c\u6210\uff0c\u90a3\u4e48 play \u5c06\u7ee7\u7eed\u8fdb\u884c\uff0c\u56e0\u4e3a\u5b83\u5c06\u64e6\u9664\u9519\u8bef\u72b6\u6001(\u4f46\u4e0d\u5305\u62ec\u62a5\u544a),\u8fd9\u610f\u5473\u7740\u5b83\u4e0d\u4f1a\u89e6\u53d1 max_fail_percentage \u6216 any_errors_fatal \u7684\u914d\u7f6e\uff0c\u4f46\u5c06\u51fa\u73b0\u5728playbook\u7edf\u8ba1\u3002 \u53d1\u751f\u9519\u8bef\u540e\uff0c\u4f9d\u7136\u8fd0\u884chandlers tasks : - name : Attempt and graceful roll back demo block : - debug : msg : 'I execute normally' changed_when : yes notify : run me even after an error - command : /bin/false rescue : - name : make sure all handlers run meta : flush_handlers handlers : - name : run me even after an error debug : msg : 'This handler runs even on error' Ansible\u8fd8\u4e3ablock\u7684rescue\u90e8\u5206\u7684\u4efb\u52a1\u63d0\u4f9b\u4e86\u4e24\u4e2a\u53d8\u91cf ansible_failed_task \u8fd4\u56de\u89e6\u53d1 rescue \u7684\u5931\u8d25\u4efb\u52a1\u3002\u4f8b\u5982\uff0c\u8981\u83b7\u53d6\u540d\u79f0\uff0c\u8bf7\u4f7f\u7528 ansible_failed_task.name \u3002 ansible_failed_result \u8fd4\u56de\u89e6\u53d1 rescue \u7684\u5931\u8d25\u4efb\u52a1\u7684\u8fd4\u56de\u7ed3\u679c\u3002\u8fd9\u76f8\u5f53\u4e8e\u5728\u5931\u8d25\u4efb\u52a1\u4e2d\u6dfb\u52a0 register: ansible_failed_result","title":"\u5757\u7684\u9519\u8bef\u5904\u7406"},{"location":"basic/Conditionals-loop/","text":"13. \u6761\u4ef6\u5224\u65ad\u4e0e\u5faa\u73af \u00b6 \u6761\u4ef6\u5224\u65ad \u00b6 ansible \u4f7f\u7528 when \u8bed\u53e5\u540e\u7684\u8868\u8fbe\u5f0f\u6765\u5224\u65ad\u8be5\u6b65\u9aa4\u662f\u5426\u6267\u884c\u3002 When \u8bed\u53e5 \u00b6 \u5728when \u540e\u9762\u4f7f\u7528\u6ca1\u6709 {{ }} \u7684 Jinja2 \u8868\u8fbe\u5f0f\uff0c\u7ed3\u679c\u4e3aTrue\u5219\u6267\u884c\u4efb\u52a1\u3002 \u4e0d\u9700\u8981\u4f7f\u7528 {{}} \u6765\u5728\u6761\u4ef6\u8bed\u53e5\u4e2d\u4f7f\u7528\u53d8\u91cf # \u82e5\u64cd\u4f5c\u7cfb\u7edf\u662f Debian \u65f6\u5c31\u6267\u884c\u5173\u673a\u64cd\u4f5c tasks : - name : \"shut down Debian flavored systems\" command : /sbin/shutdown -t now when : ansible_os_family == \"Debian\" ansible_os_family \u662f facts \u6216 vars \u7684\u53d8\u91cf \u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u62ec\u53f7\u5bf9\u6761\u4ef6\u8fdb\u884c\u5206\u7ec4 tasks : - name : \"shut down CentOS 6 and Debian 7 systems\" command : /sbin/shutdown -t now when : (ansible_facts['distribution'] == \"CentOS\" and ansible_facts['distribution_major_version'] == \"6\") or (ansible_facts['distribution'] == \"Debian\" and ansible_facts['distribution_major_version'] == \"7\") \u53ef\u4ee5\u4f7f\u7528\u5217\u8868\u5f62\u5f0f\u6765\u8868\u793a\u6761\u4ef6\u4e3a**and**\u7684\u5173\u7cfb tasks : - name : \"shut down CentOS 6 systems\" command : /sbin/shutdown -t now when : - ansible_facts['distribution'] == \"CentOS\" - ansible_facts['distribution_major_version'] == \"6\" \u8bb8\u591aJinja2\u6d4b\u8bd5\u548c\u8fc7\u6ee4\u5668\u4e5f\u53ef\u4ee5\u7528\u4e8ewhen\u8bed\u53e5\uff0c\u5176\u4e2d\u4e00\u4e9b\u662f\u552f\u4e00\u7684\uff0c\u7531Ansible\u63d0\u4f9b\u3002 tasks : - command : /bin/false register : result ignore_errors : True - command : /bin/something when : result is failed # \u5ffd\u7565\u4e00\u4e2a\u8bed\u53e5\u7684\u9519\u8bef\uff0c\u7136\u540e\u51b3\u5b9a\u57fa\u4e8e\u6210\u529f\u6216\u5931\u8d25\u6709\u6761\u4ef6\u5730\u505a\u4e00\u4e9b\u4e8b\u60c5\u3002 - command : /bin/something_else when : result is succeeded - command : /bin/still/something_else when : result is skipped \u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6570\u5b57\u578b\u518d\u53bb\u6bd4\u8f83 tasks : - shell : echo \"only on Red Hat 6, derivatives, and later\" when : ansible_facts['os_family'] == \"RedHat\" and ansible_facts['lsb']['major_release']|int >= 6 \u4e5f\u53ef\u4ee5\u4f7f\u7528\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u6ce8\u610f\u5b57\u7b26\u4e32(\u7c7b\u4f3c:\"yes\", \"on\", \"1\",\"true\")\u9700\u8981\u7528 |bool \u8f6c\u6210\u5e03\u5c14\u503c\u3002 - hosts : node vars : epic : true monumental : \"yes\" tasks : - shell : echo \"This certainly is epic!\" when : epic or monumental | bool - shell : echo \"This certainly isn't epic!\" when : not epic \u5982\u679c\u672a\u8bbe\u7f6e\u6240\u9700\u7684\u53d8\u91cf\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 Jinja2 \u5b9a\u4e49\u7684\u6d4b\u8bd5\u8df3\u8fc7\u6216\u5931\u8d25\u3002\u4f8b\u5982: tasks : - shell : echo \"I've got '{{ foo }}' and am not afraid to use it!\" when : foo is defined - fail : msg=\"Bailing out. this play requires 'bar'\" when : bar is undefined \u4e0e\u5faa\u73af\u4e00\u8d77\u4f7f\u7528 \u00b6 \u4f9d\u6b21\u904d\u5386\u5217\u8868\uff0c\u5f53\u5217\u8868\u91cc\u5f97\u6570\u5b57\u5927\u4e8e5\u65f6\u6267\u884c\u4efb\u52a1 tasks : - command : echo {{ item }} loop : [ 0 , 2 , 4 , 6 , 8 , 10 ] when : item > 5 \u5f53\u53d8\u91cf\u4e0d\u5b58\u5728\u65f6\uff0c\u76f4\u63a5\u8df3\u8fc7 - command : echo {{ item }} loop : \"{{ mylist | default([]) }}\" when : item > 5 \u5982\u679c\u53d8\u91cf\u662f\u5b57\u5178 - command : echo {{ item.key }} loop : \"{{ query('dict', mydict|default({})) }}\" when : item.value > 5 \u4f7f\u7528\u81ea\u5b9a\u4e49\u7684facts\u503c\u505a\u5224\u65ad \u00b6 \u4f60\u53ef\u4ee5\u5f00\u53d1\u4e00\u4e2a\u6a21\u5757\u6765\u8bbe\u7f6efacts\u6570\u636e\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a\u53d8\u91cf\u7ed3\u679c\u8fd4\u56de\uff0c\u540e\u7eed\u7684\u4efb\u52a1\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u53d8\u91cf\u4e86\u3002 tasks : - name : gather site specific fact data action : site_facts - command : /usr/bin/thingy when : my_custom_fact_just_retrieved_from_the_remote_system == '1234' \u89d2\u8272\u5305\u542b\u4f7f\u4f7f\u7528when \u00b6 \u5982\u679c\u60a8\u6709\u591a\u4e2a\u4efb\u52a1\u90fd\u5171\u4eab\u540c\u4e00\u4e2a\u6761\u4ef6\u8bed\u53e5\uff0c\u5219\u53ef\u4ee5\u5c06\u8be5\u6761\u4ef6\u9644\u52a0\u5230task include\u8bed\u53e5\u4e0a\uff0c\u5982\u4e0b\uff1a - import_tasks : tasks/sometasks.yml when : \"'reticulating splines' in output\" \u4f7f\u7528\u5728\u89d2\u8272\u4e0a - hosts : webservers roles : - role : debian_stock_config when : ansible_facts['os_family'] == 'Debian' \u5f53\u6761\u4ef6\u53e5\u4e0e include* \u4efb\u52a1\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u5b83\u4ec5\u5e94\u7528\u4e8e\u5305\u542b\u4efb\u52a1\u672c\u8eab\uff0c\u800c\u4e0d\u5e94\u7528\u4e8e\u5305\u542b\u6587\u4ef6\u4e2d\u7684\u4efb\u4f55\u5176\u4ed6\u4efb\u52a1\u3002 \u6709\u6761\u4ef6\u7684\u5bfc\u5165 \u00b6 \u6709\u65f6\u4f60\u4f1a\u60f3\u8981\u6839\u636e\u7279\u5b9a\u7684\u6807\u51c6\u5728\u5267\u672c\u4e2d\u505a\u4e00\u4e9b\u4e0d\u540c\u7684\u4e8b\u60c5 \u3002\u62e5\u6709\u4e00\u4e2a\u9002\u7528\u4e8e\u591a\u4e2a\u5e73\u53f0\u548c\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c\u7684\u5267\u672c\u5c31\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u4f8b\u5b50\u3002 \u4f8b\u5982\uff0cApache\u5305\u7684\u540d\u79f0\u5728CentOS\u548cDebian\u4e4b\u95f4\u4e0d\u540c\uff0c\u4f46\u662f\u5728Ansible Playbook\u4e2d\uff0c \u4f60\u53ef\u4ee5\u7528\u6700\u7b80\u6d01\u7684\u8bed\u6cd5\u6765\u5904\u7406\u8fd9\u4e2a --- # for vars/RedHat.yml apache : httpd somethingelse : 42 --- # for vars/Debian.yml apache : apache2 somethingelse : 42 --- # for playbook.yml - hosts : all remote_user : root vars_files : - \"vars/common.yml\" - [ \"vars/{{ ansible_facts['os_family'] }}.yml\" , \"vars/os_defaults.yml\" ] tasks : - name : make sure apache is started service : name={{ apache }} state=started ansible_facts['os_family'] \u6765\u786e\u5b9a\u6267\u884c\u7684\u4e3b\u673a\u7cfb\u7edf \u57fa\u4e8e\u53d8\u91cf\u9009\u62e9\u6587\u4ef6\u548c\u6a21\u677f \u00b6 - name : template a file template : src : \"{{ item }}\" dest : /etc/myapp/foo.conf loop : \"{{ query('first_found', { 'files': myfiles, 'paths': mypaths}) }}\" vars : myfiles : - \"{{ansible_facts['distribution']}}.conf\" - default.conf mypaths : [ 'search_location_one/somedir/' , '/opt/other_location/somedir/' ] \u4f7f\u7528\u6ce8\u518c\u53d8\u91cf\u5224\u65ad \u00b6 \u5c06\u7ed9\u5b9a\u547d\u4ee4\u7684\u7ed3\u679c\u5b58\u50a8\u5728\u53d8\u91cf\u4e2d\uff0c \u5e76\u5728\u540e\u7eed\u7684\u4efb\u52a1\u4e2d\u4f7f\u7528\u3002 - name : test play hosts : all tasks : - shell : cat /etc/motd register : motd_contents - shell : echo \"motd contains the word hi\" when : motd_contents.stdout.find('hi') != -1 \u5982\u679c\u6ce8\u518c\u7684\u7ed3\u679c\u88ab\u8f6c\u6362\u4e3a\u5217\u8868(\u6216\u8005\u5df2\u7ecf\u662f\u5217\u8868)\uff0c\u5219\u53ef\u4ee5\u5728\u4efb\u52a1\u7684\u5faa\u73af\u4e2d\u4f7f\u7528 \u3002 - name : registered variable usage as a loop list hosts : all tasks : - name : retrieve the list of home directories command : ls /home register : home_dirs - name : add home dirs to the backup spooler file : path : /mnt/bkspool/{{ item }} src : /home/{{ item }} state : link loop : \"{{ home_dirs.stdout_lines }}\" # same as loop: \"{{ home_dirs.stdout.split() }}\"### failed_when \u00b6 \u6ee1\u8db3\u7ed9\u5b9a\u7684\u6761\u4ef6\u65f6\uff0c\u4f7f\u4efb\u52a1\u5931\u8d25 tasks : - command : echo faild. register : command_result ailed_when : \"'faild' in command_result.stdout\" - debug : msg=\"echo test\" \u8fd8\u53ef\u4ee5\u5199\u6210\u8fd9\u6837 tasks : - command : echo faild. register : command_result ignore_errors : True - name : fail the echo fail : msg=\"the command failed\" when : \"'faild' in command_result.stdout\" - debug : msg=\"echo test\" fail \u6a21\u5757\u662f\u4ea7\u751f\u4e00\u4e2a\u9519\u8bef\u4fe1\u606f changed_when \u00b6 \u5982\u679c\u8bf4\u4e00\u4e2a\u547d\u4ee4\u6ca1\u6709\u66f4\u6539\u4efb\u4f55\u4e8b\u7269\uff0c\u5c31\u53ef\u4ee5\u4e3a\u5176\u8bbe\u7f6e\u4e3a\u6ca1\u6709\u66f4\u6539\u72b6\u6001 tasks : - name : Install dependencies via Composer. command : \"/usr/local/bin/composer global require phpunit/phpunit --prefer-dist\" register : composer changed_when : \"'Nothing to install or update' not in composer.stdout\" \u5faa\u73af \u00b6 \u6709\u65f6\u4f60\u60f3\u8981\u91cd\u590d\u4e00\u4e2a\u4efb\u52a1\u591a\u6b21\u3002\u5728\u8ba1\u7b97\u673a\u7f16\u7a0b\u4e2d\uff0c\u8fd9\u53eb\u505a\u5faa\u73af\uff0c Ansible\u63d0\u4f9b\u4e86\u4e24\u4e2a\u7528\u4e8e\u521b\u5efa\u5faa\u73af\u7684\u5173\u952e\u5b57\uff1a loop \u548c with_<lookup> \u3002 \u6211\u4eec\u5728Ansible 2.5\u4e2d\u6dfb\u52a0\u4e86 loop \u3002\u5b83\u8fd8\u4e0d\u662f with_<lookup> \u7684\u5b8c\u6574\u66ff\u4ee3\u54c1\uff0c\u4f46\u662f\u6211\u4eec\u5efa\u8bae\u5728\u5927\u591a\u6570\u7528\u4f8b\u4e2d\u4f7f\u7528\u5b83\u3002 \u6211\u4eec\u5e76\u6ca1\u6709\u53cd\u5bf9\u4f7f\u7528 with_<lookup> \u2014\u5728\u53ef\u9884\u89c1\u7684\u5c06\u6765\uff0c\u8be5\u8bed\u6cd5\u4ecd\u7136\u6709\u6548\u3002 \u6211\u4eec\u4e00\u76f4\u5728\u6539\u8fdb loop \u8bed\u6cd5\uff0c\u8bf7\u6ce8\u610f\u4fee\u6539\u65e5\u5fd7\u3002 \u6bd4\u8f83 loop \u548c with_* \u00b6 with_<lookup> \u5173\u952e\u5b57\u4f9d\u8d56\u4e8e Lookup \u63d2\u4ef6 loop \u5173\u952e\u5b57\u76f8\u5f53\u4e8e with_list \uff0c\u662f\u7b80\u5355\u5faa\u73af\u7684\u6700\u4f73\u9009\u62e9\u3002 loop \u5173\u952e\u5b57\u4e0d\u4f1a\u63a5\u53d7\u5b57\u7b26\u4e32\u4f5c\u4e3a\u8f93\u5165 \u4e00\u822c\u6765\u8bf4, \u6240\u6709 with_* \u7684\u4f7f\u7528\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528 loop \u66ff\u4ee3 \u4f7f\u7528 with_items \u65f6\u8981\u6ce8\u610f\uff0c \u56e0\u4e3a with_items \u4f1a\u6267\u884c\u9690\u5f0f\u5355\u7ea7\u5c55\u5e73\u3002 \u60a8\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u5e26\u6709\u5faa\u73af\u7684flatten(1)\u6765\u5339\u914d\u786e\u5207\u7684\u7ed3\u679c\u3002 with_items: - 1 - [2,3] - 4 \u4f7f\u7528loop\u8868\u8fbe loop : \"{{ [1, [2,3] ,4] | flatten(1) }}\" \u5728\u4f7f\u7528\u67e5\u627e\u7684\u529f\u80fd\u65f6, \u90fd\u4e0d\u5e94\u8be5\u5c06 with_* \u8f6c\u6362\u6210 loop loop : \"{{ lookup('fileglob', '*.txt', wantlist=True) }}\" \u4f7f\u7528 with_* \u53ef\u4ee5\u5f88\u7b80\u6d01\u7684\u8868\u8fbe with_fileglob : '*.txt' \u6807\u51c6\u5faa\u73af \u00b6 \u904d\u5386\u5217\u8868 \u00b6 \u6dfb\u52a0\u591a\u4e2a\u7528\u6237 - name : add several users user : name : \"{{ item }}\" state : present groups : \"wheel\" loop : - testuser1 - testuser2 \u4e5f\u53ef\u4ee5\u76f4\u63a5\u5f15\u7528\u53d8\u91cf\u5217\u8868 loop : \"{{ somelist }}\" \u8fd9\u4e24\u4e2a\u4f8b\u5b50\u7b49\u4ef7\u4e8e - name : add user testuser1 user : name : \"testuser1\" state : present groups : \"wheel\" - name : add user testuser2 user : name : \"testuser2\" state : present groups : \"wheel\" \u6709\u65f6\uff0c\u5982\u679c\u6a21\u5757\u53ef\u4ee5\u63a5\u53d7\u5217\u8868\u7684\u8bdd\uff0c\u5c31\u4e0d\u9700\u8981\u4f7f\u7528\u5faa\u73af\u6765\u4f20\u9012\u3002\u4f8b\u5982yum\u5305\u7ba1\u7406\u7684 - name : optimal yum yum : name : \"{{ list_of_packages }}\" state : present - name : non-optimal yum, slower and may cause issues with interdependencies yum : name : \"{{ item }}\" state : present loop : \"{{ list_of_packages }}\" \u904d\u5386\u6563\u5217\u5217\u8868 \u00b6 \u5982\u679c\u4f60\u6709\u4e00\u4e2a\u6563\u5217\u5217\u8868\uff0c\u53ef\u4ee5\u5728\u5faa\u73af\u4e2d\u5f15\u7528\u5b50\u952e\u3002 - name : add several users user : name : \"{{ item.name }}\" state : present groups : \"{{ item.groups }}\" loop : - { name : 'testuser1' , groups : 'wheel' } - { name : 'testuser2' , groups : 'root' } \u6dfb\u52a0\u591a\u4e2a\u7528\u6237\uff0c\u5e76\u5c06\u7528\u6237\u52a0\u5165\u4e0d\u540c\u7684\u7ec4\u5185\u3002 \u904d\u5386\u5b57\u5178 \u00b6 \u8981\u904d\u5386\u5b57\u5178\uff0c\u8bf7\u4f7f\u7528 dict2items \u8fc7\u6ee4\u5668\u5c06\u5b57\u5178\u8f6c\u6362\u6210\u6563\u5217\uff1a - name : create a tag dictionary of non-empty tags set_fact : tags_dict : \"{{ (tags_dict|default({}))|combine({item.key: item.value}) }}\" loop : \"{{ tags|dict2items }}\" vars : tags : Environment : dev Application : payment Another : \"{{ doesnotexist | default() }}\" when : item.value != \"\" default() \u53ef\u4ee5\u5728\u53d8\u91cf\u672a\u5b9a\u4e49\u7684\u65f6\u5019\u4e3a\u5176\u8bbe\u7f6e\u4e00\u4e2a\u9ed8\u8ba4\u503c\u3002 \u5faa\u73af\u4e2d\u6ce8\u518c\u53d8\u91cf \u00b6 - shell : \"echo {{ item }}\" loop : - \"one\" - \"two\" register : echo \u5f53\u60a8\u5728\u5faa\u73af\u4e2d\u4f7f\u7528register\u65f6\uff0c\u653e\u5728\u53d8\u91cf\u4e2d\u7684\u6570\u636e\u7ed3\u6784\u5c06\u5305\u542b\u4e00\u4e2aresults\u5c5e\u6027\uff0c\u8be5\u5c5e\u6027\u662f\u6765\u81ea\u6a21\u5757\u7684\u6240\u6709\u6267\u884c\u7684\u5217\u8868\u3002\u8fd9\u4e0e\u4e0d\u4f7f\u7528\u5faa\u73af\u4f7f\u7528register\u65f6\u8fd4\u56de\u7684\u6570\u636e\u7ed3\u6784\u4e0d\u540c { \"changed\" : true , \"msg\" : \"All items completed\" , \"results\" : [ { \"ansible_loop_var\" : \"item\" , \"changed\" : true , \"cmd\" : \"echo one\" , \"delta\" : \"0:00:00.003978\" , \"end\" : \"2020-03-30 21:13:24.329114\" , \"failed\" : false , \"invocation\" : { \"module_args\" : { \"_raw_params\" : \"echo one\" , \"_uses_shell\" : true , \"argv\" : null , \"chdir\" : null , \"creates\" : null , \"executable\" : null , \"removes\" : null , \"stdin\" : null , \"stdin_add_newline\" : true , \"strip_empty_ends\" : true , \"warn\" : true } }, \"item\" : \"one\" , \"rc\" : 0 , \"start\" : \"2020-03-30 21:13:24.325136\" , \"stderr\" : \"\" , \"stderr_lines\" : [], \"stdout\" : \"one\" , \"stdout_lines\" : [ \"one\" ] }, { \"ansible_loop_var\" : \"item\" , \"changed\" : true , \"cmd\" : \"echo two\" , \"delta\" : \"0:00:00.003879\" , \"end\" : \"2020-03-30 21:13:24.621379\" , \"failed\" : false , \"invocation\" : { \"module_args\" : { \"_raw_params\" : \"echo two\" , \"_uses_shell\" : true , \"argv\" : null , \"chdir\" : null , \"creates\" : null , \"executable\" : null , \"removes\" : null , \"stdin\" : null , \"stdin_add_newline\" : true , \"strip_empty_ends\" : true , \"warn\" : true } }, \"item\" : \"two\" , \"rc\" : 0 , \"start\" : \"2020-03-30 21:13:24.613500\" , \"stderr\" : \"\" , \"stderr_lines\" : [], \"stdout\" : \"two\" , \"stdout_lines\" : [ \"two\" ] } ] } \u540e\u7eed\u4f7f\u7528\u6ce8\u518c\u53d8\u91cf\u6765\u68c0\u67e5\u547d\u4ee4\u6267\u884c\u60c5\u51b5 - name : Fail if return code is not 0 fail : msg : \"The command ({{ item.cmd }}) did not have a 0 return code\" when : item.rc != 0 loop : \"{{ echo.results }}\" \u5728\u5faa\u73af\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5f53\u524d\u7684\u6a21\u5757\u7ed3\u679c - shell : echo \"{{ item }}\" loop : - one - two register : echo changed_when : echo.stdout != \"one\" \u590d\u6742\u5faa\u73af \u00b6 \u904d\u5386\u5d4c\u5957\u5217\u8868 \u00b6 \u60a8\u53ef\u4ee5\u4f7f\u7528Jinja2\u8868\u8fbe\u5f0f\u8fed\u4ee3\u590d\u6742\u7684\u5217\u8868\u3002\u4f8b\u5982\uff0c \u5206\u522b\u7ed9\u7528\u6237\u6388\u4e883\u4e2a\u6570\u636e\u5e93\u7684\u6240\u6709\u6743\u9650 - name : give users access to multiple databases mysql_user : name : \"{{ item[0] }}\" priv : \"{{ item[1] }}.*:ALL\" append_privs : yes password : \"foo\" loop : \"{{ ['alice', 'bob'] | product(['clientdb', 'employeedb', 'providerdb'])|list }}\" \u5728\u6ee1\u8db3\u6761\u4ef6\u4e4b\u524d\u91cd\u8bd5\u4efb\u52a1 \u00b6 \u53ef\u4ee5\u4f7f\u7528 until \u5173\u952e\u5b57\u91cd\u8bd5\u4efb\u52a1\uff0c\u76f4\u5230\u6ee1\u8db3\u7279\u5b9a\u6761\u4ef6\u3002 - shell : /usr/bin/foo register : result until : result.stdout.find(\"all systems go\") != -1 retries : 5 delay : 10 \u6b64\u4efb\u52a1\u6700\u591a\u8fd0\u884c5\u6b21\uff0c\u6bcf\u6b21\u5c1d\u8bd5\u4e4b\u95f4\u7684\u5ef6\u8fdf\u4e3a10\u79d2\u3002\u5982\u679c\u6807\u51c6\u8f93\u51fa\u4e2d\u6709 all systems go \u5b57\u7b26\u4e32\uff0c\u5219\u4efb\u52a1\u6210\u529f\u3002\u91cd\u8bd5\u7684\u9ed8\u8ba4\u503c\u662f3\uff0c\u5ef6\u8fdf\u662f5\u3002 \u5faa\u73af\u4e3b\u673a\u6e05\u5355 \u00b6 # \u8f93\u51fa\u6240\u6709\u4e3b\u673a\u4fe1\u606f - debug : msg : \"{{ item }}\" loop : \"{{ groups['all'] }}\" # \u8f93\u51fa\u5f53\u524dplay\u8fd0\u884c\u7684\u4e3b\u673a\u4fe1\u606f - debug : msg : \"{{ item }}\" loop : \"{{ ansible_play_batch }}\" # \u663e\u793a\u6e05\u5355\u4e2d\u7684\u6240\u6709\u4e3b\u673a - debug : msg : \"{{ item }}\" loop : \"{{ query('inventory_hostnames', 'all') }}\" # \u9664\u7ec4www\u5916\u7684\u6240\u6709\u4e3b\u673a - debug : msg : \"{{ item }}\" loop : \"{{ query('inventory_hostnames', 'all:!www') }}\" \u4f7f\u7528 query \u8fd8\u662f lookup \u00b6 loop\u5173\u952e\u5b57\u9700\u8981\u4e00\u4e2a\u5217\u8868\u4f5c\u4e3a\u8f93\u5165\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c lookup \u5173\u952e\u5b57\u8fd4\u56de\u4e00\u4e2a\u9017\u53f7\u5206\u9694\u7684\u503c\u5b57\u7b26\u4e32 ,\u800c query \u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5217\u8868\u3002 \u5982\u679c\u4f7f\u7528 lookup \u8fd4\u56de\u5217\u8868\uff0c\u5219\u53ef\u4ee5\u6dfb\u52a0 wantlist=True \u5f3a\u5236\u8fd4\u56de\u5217\u8868\u3002 loop : \"{{ query('inventory_hostnames', 'all') }}\" loop : \"{{ lookup('inventory_hostnames', 'all', wantlist=True) }}\" \u5faa\u73af\u63a7\u5236 \u00b6 \u4f7f\u7528 loop_control \u5173\u952e\u5b57\u6765\u7ba1\u7406\u5faa\u73af\u3002 \u4f7f\u7528 label \u9650\u5236loop\u7684\u8f93\u51fa \u00b6 - name : create servers digital_ocean : name : \"{{ item.name }}\" state : present loop : - name : server1 disks : 3gb ram : 15Gb network : nic01 : 100Gb nic02 : 10Gb ... loop_control : label : \"{{ item.name }}\" \u8fd9\u4e2a\u4efb\u52a1\u7684\u8f93\u51fa\u5c06\u53ea\u663e\u793a\u6bcf\u4e2a\u9879\u76ee\u7684\u540d\u79f0\u5b57\u6bb5\uff0c\u800c\u4e0d\u662f\u591a\u884c {{item}} \u53d8\u91cf\u7684\u6574\u4e2a\u5185\u5bb9\u3002 \u8fd9\u662f\u4e3a\u4e86\u4f7f\u63a7\u5236\u53f0\u8f93\u51fa\u66f4\u5177\u53ef\u8bfb\u6027\uff0c\u800c\u4e0d\u662f\u4e3a\u4e86\u4fdd\u62a4\u654f\u611f\u6570\u636e\u3002\u5982\u679c\u5faa\u73af\u4e2d\u6709\u654f\u611f\u6570\u636e\uff0c\u5219\u8bbe\u7f6e no_log: yes \uff0c\u4ee5\u9632\u6b62\u6cc4\u6f0f\u3002 \u5faa\u73af\u95f4\u9694\u65f6\u95f4 \u00b6 \u4f7f\u7528 pause \u6307\u4ee4\u63a7\u5236\u5faa\u73af\u4e2d\u6bcf\u4e2a\u9879\u6267\u884c\u4e4b\u95f4\u7684\u65f6\u95f4(\u4ee5\u79d2\u4e3a\u5355\u4f4d) - name : create servers, pause 3s before creating next digital_ocean : name : \"{{ item }}\" state : present loop : - server1 - server2 loop_control : pause : 3 \u5faa\u73af\u7d22\u5f15 \u00b6 \u4f7f\u7528 index_var \u6307\u4ee4\u6765\u8ddf\u8e2a\u5f53\u524d\u5faa\u73af\u7684\u7d22\u5f15 - name : count our fruit debug : msg : \"{{ item }} with index {{ my_idx }}\" loop : - apple - banana - pear loop_control : index_var : my_idx \u66f4\u6539\u5faa\u73af\u7684\u53d8\u91cf\u540d\u79f0 \u00b6 \u5faa\u73af\u7684\u9ed8\u8ba4\u53d8\u91cf\u540d\u79f0\u4e3a item ,\u53ef\u4ee5\u901a\u8fc7 loop_var \u6765\u4fee\u6539\u6b64\u9879,\u4ece\u800c\u907f\u514d\u8986\u76d6 include_tasks \u4efb\u52a1\u91cc\u7684\u5faa\u73af\u53d8\u91cf # main.yml - include_tasks : inner.yml loop : - 1 - 2 - 3 loop_control : loop_var : outer_item # inner.yml - debug : msg : \"outer item={{ outer_item }} inner item={{ item }}\" loop : - a - b - c \u6269\u5c55\u53d8\u91cf \u00b6 \u4eceAnsible 2.8\u5f00\u59cb\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u6269\u5c55\u9009\u9879\u6765\u83b7\u53d6\u6269\u5c55\u5faa\u73af\u4fe1\u606f\u3002\u6b64\u9009\u9879\u5c06\u516c\u5f00\u4ee5\u4e0b\u4fe1\u606f\u3002 \u53d8\u91cf \u63cf\u8ff0 ansible_loop.allitems \u5faa\u73af\u4e2d\u6240\u6709\u9879\u7684\u5217\u8868 ansible_loop.index \u5faa\u73af\u7684\u5f53\u524d\u8fed\u4ee3\u6b21\u6570\u3002(\u4ece1\u5f00\u59cb) ansible_loop.index0 \u5faa\u73af\u7684\u5f53\u524d\u8fed\u4ee3\u6b21\u6570\u3002(\u4ece0\u5f00\u59cb) ansible_loop.revindex \u5faa\u73af\u7ed3\u675f\u540e\u7684\u8fed\u4ee3\u6b21\u6570\u3002(\u4ece1\u5f00\u59cb) ansible_loop.revindex0 \u5faa\u73af\u7ed3\u675f\u540e\u7684\u8fed\u4ee3\u6b21\u6570\u3002(\u4ece0\u5f00\u59cb) ansible_loop.first \u5982\u679c\u662f\u7b2c\u4e00\u6b21\u8fed\u4ee3\uff0c\u8fd4\u56de True ansible_loop.last \u5982\u679c\u662f\u6700\u540e\u4e00\u6b21\u8fed\u4ee3\uff0c\u8fd4\u56de True ansible_loop.length \u5faa\u73af\u4e2d\u7684\u9879\u6570 ansible_loop.previtem \u5faa\u73af\u524d\u4e00\u6b21\u8fed\u4ee3\u7684\u9879\u3002\u5728\u7b2c\u4e00\u6b21\u8fed\u4ee3\u4e2d\u672a\u5b9a\u4e49\u3002 ansible_loop.nextitem \u5faa\u73af\u7684\u540e\u7eed\u8fed\u4ee3\u4e2d\u7684\u9879\u3002\u5728\u6700\u540e\u4e00\u6b21\u8fed\u4ee3\u4e2d\u672a\u5b9a\u4e49\u3002 loop_control: extended: yes #### \u83b7\u53d6 loop_var \u7684\u540d\u79f0 \u4eceansible2.8\u5f00\u59cb\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 ansible_loop_var \u6765\u83b7\u53d6 loop_control.loop_var \u7684\u503c \"{{ lookup('vars', ansible_loop_var) }}\" \u4ecewith_*\u8fc1\u79fb\u5230loop \u00b6 \u968f\u7740Ansible 2.5\u7684\u53d1\u5e03\uff0c\u6267\u884c\u5faa\u73af\u7684\u63a8\u8350\u65b9\u6cd5\u662f\u4f7f\u7528 loop \u5173\u952e\u5b57\uff0c\u800c\u4e0d\u662f with_* \u6837\u5f0f\u7684\u5faa\u73af\u3002 \u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\uff0c loop \u8bed\u6cd5\u4f7f\u7528\u8fc7\u6ee4\u5668\u66f4\u597d\u5730\u8868\u8fbe\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u66f4\u590d\u6742\u7684 query \u6216 lookup \u3002 \u4e0b\u9762\u7684\u793a\u4f8b\u5c06\u5c55\u793a\u5982\u4f55\u5c06\u8bb8\u591a\u5e38\u89c1\u7684 with_ \u6837\u5f0f\u5faa\u73af\u8f6c\u6362\u4e3a loop \u3002 with_list \u00b6 \u904d\u5386\u5217\u8868 - name : with_list debug : msg : \"{{ item }}\" with_list : - one - two - name : with_list -> loop debug : msg : \"{{ item }}\" loop : - one - two with_items \u00b6 \u904d\u5386\u5217\u8868 - name : with_items debug : msg : \"{{ item }}\" with_items : \"{{ items }}\" - name : with_items -> loop debug : msg : \"{{ item }}\" loop : \"{{ items | flatten(levels=1) }}\" with_indexed_items \u00b6 \u904d\u5386\u5217\u8868\u548c\u7d22\u5f15 - name : with_indexed_items debug : msg : \"{{ item.0 }} - {{ item.1 }}\" with_indexed_items : \"{{ items }}\" - name : with_indexed_items -> loop debug : msg : \"{{ index }} - {{ item }}\" loop : \"{{ items | flatten(levels=1) }}\" loop_control : index_var : index with_flattened \u00b6 \u5408\u5e76\u5217\u8868 - name : with_flattened debug : msg : \"{{ item }}\" with_flattened : \"{{ items }}\" - name : with_flattened -> loop debug : msg : \"{{ item }}\" loop : \"{{ items | flatten }}\" with_together \u00b6 \u5e76\u884c\u904d\u5386\u5217\u8868 - name : with_together debug : msg : \"{{ item.0 }} - {{ item.1 }}\" with_together : - \"{{ list_one }}\" - \"{{ list_two }}\" - name : with_together -> loop debug : msg : \"{{ item.0 }} - {{ item.1 }}\" loop : \"{{ list_one|zip(list_two)|list }}\" with_dict \u00b6 \u904d\u5386\u5b57\u5178 - name : with_dict debug : msg : \"{{ item.key }} - {{ item.value }}\" with_dict : \"{{ dictionary }}\" - name : with_dict -> loop (option 1) debug : msg : \"{{ item.key }} - {{ item.value }}\" loop : \"{{ dictionary|dict2items }}\" - name : with_dict -> loop (option 2) debug : msg : \"{{ item.0 }} - {{ item.1 }}\" loop : \"{{ dictionary|dictsort }}\" - name : with_dict lookup debug : msg : \"with_dict_lookup: item.key is '{{ item.key }}' and item.value is '{{ item.value }}'\" loop : \"{{ lookup('dict', dictionary) }}\" - name : with_dict query debug : msg : \"with_dict_query: item.key is '{{ item.key }}' and item.value is '{{ item.value }}'\" loop : \"{{ query('dict', dictionary) }}\" with_sequence \u00b6 \u4ee5\u9012\u589e\u7684\u6570\u5b57\u987a\u5e8f\u751f\u6210\u9879\u5e8f\u5217 - name : with_sequence debug : msg : \"{{ item }}\" with_sequence : start=0 end=4 stride=2 format=testuser%02x - name : with_sequence -> loop debug : msg : \"{{ 'testuser%02x' | format(item) }}\" # range is exclusive of the end point loop : \"{{ range(0, 4 + 1, 2)|list }}\" - name : with sequence loop and lookup debug : msg : \"sequence_lookup: item is '{{ item }}'\" # end is inclusive of the end point loop : \"{{ lookup('sequence', 'start=0 end=4 stride=2 format=testuser%02x', wantlist=True) }}\" - name : with sequence loop and query debug : msg : \"sequence_query: item is '{{ item }}'\" # end is inclusive of the end point loop : \"{{ query('sequence', 'start=0 end=4 stride=2 format=testuser%02x') }}\" with_subelements \u00b6 \u904d\u5386\u5b50\u5143\u7d20 - name : with_nested debug : msg : \"{{ item.0 }} - {{ item.1 }}\" with_nested : - \"{{ list_one }}\" - \"{{ list_two }}\" - name : with_nested -> loop debug : msg : \"{{ item.0 }} - {{ item.1 }}\" loop : \"{{ list_one|product(list_two)|list }}\" with_random_choice \u00b6 \u968f\u673a\u9009\u62e9\u5217\u8868\u4e2d\u5f97\u4e00\u4e2a\u503c - name : with_random_choice debug : msg : \"{{ item }}\" with_random_choice : \"{{ my_list }}\" - name : with_random_choice -> loop (No loop is needed here) debug : msg : \"{{ my_list|random }}\" tags : random","title":"13. \u6761\u4ef6\u5224\u65ad\u4e0e\u5faa\u73af"},{"location":"basic/Conditionals-loop/#13","text":"","title":"13. \u6761\u4ef6\u5224\u65ad\u4e0e\u5faa\u73af"},{"location":"basic/Conditionals-loop/#_1","text":"ansible \u4f7f\u7528 when \u8bed\u53e5\u540e\u7684\u8868\u8fbe\u5f0f\u6765\u5224\u65ad\u8be5\u6b65\u9aa4\u662f\u5426\u6267\u884c\u3002","title":"\u6761\u4ef6\u5224\u65ad"},{"location":"basic/Conditionals-loop/#when","text":"\u5728when \u540e\u9762\u4f7f\u7528\u6ca1\u6709 {{ }} \u7684 Jinja2 \u8868\u8fbe\u5f0f\uff0c\u7ed3\u679c\u4e3aTrue\u5219\u6267\u884c\u4efb\u52a1\u3002 \u4e0d\u9700\u8981\u4f7f\u7528 {{}} \u6765\u5728\u6761\u4ef6\u8bed\u53e5\u4e2d\u4f7f\u7528\u53d8\u91cf # \u82e5\u64cd\u4f5c\u7cfb\u7edf\u662f Debian \u65f6\u5c31\u6267\u884c\u5173\u673a\u64cd\u4f5c tasks : - name : \"shut down Debian flavored systems\" command : /sbin/shutdown -t now when : ansible_os_family == \"Debian\" ansible_os_family \u662f facts \u6216 vars \u7684\u53d8\u91cf \u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u62ec\u53f7\u5bf9\u6761\u4ef6\u8fdb\u884c\u5206\u7ec4 tasks : - name : \"shut down CentOS 6 and Debian 7 systems\" command : /sbin/shutdown -t now when : (ansible_facts['distribution'] == \"CentOS\" and ansible_facts['distribution_major_version'] == \"6\") or (ansible_facts['distribution'] == \"Debian\" and ansible_facts['distribution_major_version'] == \"7\") \u53ef\u4ee5\u4f7f\u7528\u5217\u8868\u5f62\u5f0f\u6765\u8868\u793a\u6761\u4ef6\u4e3a**and**\u7684\u5173\u7cfb tasks : - name : \"shut down CentOS 6 systems\" command : /sbin/shutdown -t now when : - ansible_facts['distribution'] == \"CentOS\" - ansible_facts['distribution_major_version'] == \"6\" \u8bb8\u591aJinja2\u6d4b\u8bd5\u548c\u8fc7\u6ee4\u5668\u4e5f\u53ef\u4ee5\u7528\u4e8ewhen\u8bed\u53e5\uff0c\u5176\u4e2d\u4e00\u4e9b\u662f\u552f\u4e00\u7684\uff0c\u7531Ansible\u63d0\u4f9b\u3002 tasks : - command : /bin/false register : result ignore_errors : True - command : /bin/something when : result is failed # \u5ffd\u7565\u4e00\u4e2a\u8bed\u53e5\u7684\u9519\u8bef\uff0c\u7136\u540e\u51b3\u5b9a\u57fa\u4e8e\u6210\u529f\u6216\u5931\u8d25\u6709\u6761\u4ef6\u5730\u505a\u4e00\u4e9b\u4e8b\u60c5\u3002 - command : /bin/something_else when : result is succeeded - command : /bin/still/something_else when : result is skipped \u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6570\u5b57\u578b\u518d\u53bb\u6bd4\u8f83 tasks : - shell : echo \"only on Red Hat 6, derivatives, and later\" when : ansible_facts['os_family'] == \"RedHat\" and ansible_facts['lsb']['major_release']|int >= 6 \u4e5f\u53ef\u4ee5\u4f7f\u7528\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u6ce8\u610f\u5b57\u7b26\u4e32(\u7c7b\u4f3c:\"yes\", \"on\", \"1\",\"true\")\u9700\u8981\u7528 |bool \u8f6c\u6210\u5e03\u5c14\u503c\u3002 - hosts : node vars : epic : true monumental : \"yes\" tasks : - shell : echo \"This certainly is epic!\" when : epic or monumental | bool - shell : echo \"This certainly isn't epic!\" when : not epic \u5982\u679c\u672a\u8bbe\u7f6e\u6240\u9700\u7684\u53d8\u91cf\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 Jinja2 \u5b9a\u4e49\u7684\u6d4b\u8bd5\u8df3\u8fc7\u6216\u5931\u8d25\u3002\u4f8b\u5982: tasks : - shell : echo \"I've got '{{ foo }}' and am not afraid to use it!\" when : foo is defined - fail : msg=\"Bailing out. this play requires 'bar'\" when : bar is undefined","title":"When \u8bed\u53e5"},{"location":"basic/Conditionals-loop/#_2","text":"\u4f9d\u6b21\u904d\u5386\u5217\u8868\uff0c\u5f53\u5217\u8868\u91cc\u5f97\u6570\u5b57\u5927\u4e8e5\u65f6\u6267\u884c\u4efb\u52a1 tasks : - command : echo {{ item }} loop : [ 0 , 2 , 4 , 6 , 8 , 10 ] when : item > 5 \u5f53\u53d8\u91cf\u4e0d\u5b58\u5728\u65f6\uff0c\u76f4\u63a5\u8df3\u8fc7 - command : echo {{ item }} loop : \"{{ mylist | default([]) }}\" when : item > 5 \u5982\u679c\u53d8\u91cf\u662f\u5b57\u5178 - command : echo {{ item.key }} loop : \"{{ query('dict', mydict|default({})) }}\" when : item.value > 5","title":"\u4e0e\u5faa\u73af\u4e00\u8d77\u4f7f\u7528"},{"location":"basic/Conditionals-loop/#facts","text":"\u4f60\u53ef\u4ee5\u5f00\u53d1\u4e00\u4e2a\u6a21\u5757\u6765\u8bbe\u7f6efacts\u6570\u636e\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a\u53d8\u91cf\u7ed3\u679c\u8fd4\u56de\uff0c\u540e\u7eed\u7684\u4efb\u52a1\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u53d8\u91cf\u4e86\u3002 tasks : - name : gather site specific fact data action : site_facts - command : /usr/bin/thingy when : my_custom_fact_just_retrieved_from_the_remote_system == '1234'","title":"\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684facts\u503c\u505a\u5224\u65ad"},{"location":"basic/Conditionals-loop/#when_1","text":"\u5982\u679c\u60a8\u6709\u591a\u4e2a\u4efb\u52a1\u90fd\u5171\u4eab\u540c\u4e00\u4e2a\u6761\u4ef6\u8bed\u53e5\uff0c\u5219\u53ef\u4ee5\u5c06\u8be5\u6761\u4ef6\u9644\u52a0\u5230task include\u8bed\u53e5\u4e0a\uff0c\u5982\u4e0b\uff1a - import_tasks : tasks/sometasks.yml when : \"'reticulating splines' in output\" \u4f7f\u7528\u5728\u89d2\u8272\u4e0a - hosts : webservers roles : - role : debian_stock_config when : ansible_facts['os_family'] == 'Debian' \u5f53\u6761\u4ef6\u53e5\u4e0e include* \u4efb\u52a1\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u5b83\u4ec5\u5e94\u7528\u4e8e\u5305\u542b\u4efb\u52a1\u672c\u8eab\uff0c\u800c\u4e0d\u5e94\u7528\u4e8e\u5305\u542b\u6587\u4ef6\u4e2d\u7684\u4efb\u4f55\u5176\u4ed6\u4efb\u52a1\u3002","title":"\u89d2\u8272\u5305\u542b\u4f7f\u4f7f\u7528when"},{"location":"basic/Conditionals-loop/#_3","text":"\u6709\u65f6\u4f60\u4f1a\u60f3\u8981\u6839\u636e\u7279\u5b9a\u7684\u6807\u51c6\u5728\u5267\u672c\u4e2d\u505a\u4e00\u4e9b\u4e0d\u540c\u7684\u4e8b\u60c5 \u3002\u62e5\u6709\u4e00\u4e2a\u9002\u7528\u4e8e\u591a\u4e2a\u5e73\u53f0\u548c\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c\u7684\u5267\u672c\u5c31\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u4f8b\u5b50\u3002 \u4f8b\u5982\uff0cApache\u5305\u7684\u540d\u79f0\u5728CentOS\u548cDebian\u4e4b\u95f4\u4e0d\u540c\uff0c\u4f46\u662f\u5728Ansible Playbook\u4e2d\uff0c \u4f60\u53ef\u4ee5\u7528\u6700\u7b80\u6d01\u7684\u8bed\u6cd5\u6765\u5904\u7406\u8fd9\u4e2a --- # for vars/RedHat.yml apache : httpd somethingelse : 42 --- # for vars/Debian.yml apache : apache2 somethingelse : 42 --- # for playbook.yml - hosts : all remote_user : root vars_files : - \"vars/common.yml\" - [ \"vars/{{ ansible_facts['os_family'] }}.yml\" , \"vars/os_defaults.yml\" ] tasks : - name : make sure apache is started service : name={{ apache }} state=started ansible_facts['os_family'] \u6765\u786e\u5b9a\u6267\u884c\u7684\u4e3b\u673a\u7cfb\u7edf","title":"\u6709\u6761\u4ef6\u7684\u5bfc\u5165"},{"location":"basic/Conditionals-loop/#_4","text":"- name : template a file template : src : \"{{ item }}\" dest : /etc/myapp/foo.conf loop : \"{{ query('first_found', { 'files': myfiles, 'paths': mypaths}) }}\" vars : myfiles : - \"{{ansible_facts['distribution']}}.conf\" - default.conf mypaths : [ 'search_location_one/somedir/' , '/opt/other_location/somedir/' ]","title":"\u57fa\u4e8e\u53d8\u91cf\u9009\u62e9\u6587\u4ef6\u548c\u6a21\u677f"},{"location":"basic/Conditionals-loop/#_5","text":"\u5c06\u7ed9\u5b9a\u547d\u4ee4\u7684\u7ed3\u679c\u5b58\u50a8\u5728\u53d8\u91cf\u4e2d\uff0c \u5e76\u5728\u540e\u7eed\u7684\u4efb\u52a1\u4e2d\u4f7f\u7528\u3002 - name : test play hosts : all tasks : - shell : cat /etc/motd register : motd_contents - shell : echo \"motd contains the word hi\" when : motd_contents.stdout.find('hi') != -1 \u5982\u679c\u6ce8\u518c\u7684\u7ed3\u679c\u88ab\u8f6c\u6362\u4e3a\u5217\u8868(\u6216\u8005\u5df2\u7ecf\u662f\u5217\u8868)\uff0c\u5219\u53ef\u4ee5\u5728\u4efb\u52a1\u7684\u5faa\u73af\u4e2d\u4f7f\u7528 \u3002 - name : registered variable usage as a loop list hosts : all tasks : - name : retrieve the list of home directories command : ls /home register : home_dirs - name : add home dirs to the backup spooler file : path : /mnt/bkspool/{{ item }} src : /home/{{ item }} state : link loop : \"{{ home_dirs.stdout_lines }}\" # same as loop: \"{{ home_dirs.stdout.split() }}\"###","title":"\u4f7f\u7528\u6ce8\u518c\u53d8\u91cf\u5224\u65ad"},{"location":"basic/Conditionals-loop/#failed_when","text":"\u6ee1\u8db3\u7ed9\u5b9a\u7684\u6761\u4ef6\u65f6\uff0c\u4f7f\u4efb\u52a1\u5931\u8d25 tasks : - command : echo faild. register : command_result ailed_when : \"'faild' in command_result.stdout\" - debug : msg=\"echo test\" \u8fd8\u53ef\u4ee5\u5199\u6210\u8fd9\u6837 tasks : - command : echo faild. register : command_result ignore_errors : True - name : fail the echo fail : msg=\"the command failed\" when : \"'faild' in command_result.stdout\" - debug : msg=\"echo test\" fail \u6a21\u5757\u662f\u4ea7\u751f\u4e00\u4e2a\u9519\u8bef\u4fe1\u606f","title":"failed_when"},{"location":"basic/Conditionals-loop/#changed_when","text":"\u5982\u679c\u8bf4\u4e00\u4e2a\u547d\u4ee4\u6ca1\u6709\u66f4\u6539\u4efb\u4f55\u4e8b\u7269\uff0c\u5c31\u53ef\u4ee5\u4e3a\u5176\u8bbe\u7f6e\u4e3a\u6ca1\u6709\u66f4\u6539\u72b6\u6001 tasks : - name : Install dependencies via Composer. command : \"/usr/local/bin/composer global require phpunit/phpunit --prefer-dist\" register : composer changed_when : \"'Nothing to install or update' not in composer.stdout\"","title":"changed_when"},{"location":"basic/Conditionals-loop/#_6","text":"\u6709\u65f6\u4f60\u60f3\u8981\u91cd\u590d\u4e00\u4e2a\u4efb\u52a1\u591a\u6b21\u3002\u5728\u8ba1\u7b97\u673a\u7f16\u7a0b\u4e2d\uff0c\u8fd9\u53eb\u505a\u5faa\u73af\uff0c Ansible\u63d0\u4f9b\u4e86\u4e24\u4e2a\u7528\u4e8e\u521b\u5efa\u5faa\u73af\u7684\u5173\u952e\u5b57\uff1a loop \u548c with_<lookup> \u3002 \u6211\u4eec\u5728Ansible 2.5\u4e2d\u6dfb\u52a0\u4e86 loop \u3002\u5b83\u8fd8\u4e0d\u662f with_<lookup> \u7684\u5b8c\u6574\u66ff\u4ee3\u54c1\uff0c\u4f46\u662f\u6211\u4eec\u5efa\u8bae\u5728\u5927\u591a\u6570\u7528\u4f8b\u4e2d\u4f7f\u7528\u5b83\u3002 \u6211\u4eec\u5e76\u6ca1\u6709\u53cd\u5bf9\u4f7f\u7528 with_<lookup> \u2014\u5728\u53ef\u9884\u89c1\u7684\u5c06\u6765\uff0c\u8be5\u8bed\u6cd5\u4ecd\u7136\u6709\u6548\u3002 \u6211\u4eec\u4e00\u76f4\u5728\u6539\u8fdb loop \u8bed\u6cd5\uff0c\u8bf7\u6ce8\u610f\u4fee\u6539\u65e5\u5fd7\u3002","title":"\u5faa\u73af"},{"location":"basic/Conditionals-loop/#loop-with_","text":"with_<lookup> \u5173\u952e\u5b57\u4f9d\u8d56\u4e8e Lookup \u63d2\u4ef6 loop \u5173\u952e\u5b57\u76f8\u5f53\u4e8e with_list \uff0c\u662f\u7b80\u5355\u5faa\u73af\u7684\u6700\u4f73\u9009\u62e9\u3002 loop \u5173\u952e\u5b57\u4e0d\u4f1a\u63a5\u53d7\u5b57\u7b26\u4e32\u4f5c\u4e3a\u8f93\u5165 \u4e00\u822c\u6765\u8bf4, \u6240\u6709 with_* \u7684\u4f7f\u7528\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528 loop \u66ff\u4ee3 \u4f7f\u7528 with_items \u65f6\u8981\u6ce8\u610f\uff0c \u56e0\u4e3a with_items \u4f1a\u6267\u884c\u9690\u5f0f\u5355\u7ea7\u5c55\u5e73\u3002 \u60a8\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u5e26\u6709\u5faa\u73af\u7684flatten(1)\u6765\u5339\u914d\u786e\u5207\u7684\u7ed3\u679c\u3002 with_items: - 1 - [2,3] - 4 \u4f7f\u7528loop\u8868\u8fbe loop : \"{{ [1, [2,3] ,4] | flatten(1) }}\" \u5728\u4f7f\u7528\u67e5\u627e\u7684\u529f\u80fd\u65f6, \u90fd\u4e0d\u5e94\u8be5\u5c06 with_* \u8f6c\u6362\u6210 loop loop : \"{{ lookup('fileglob', '*.txt', wantlist=True) }}\" \u4f7f\u7528 with_* \u53ef\u4ee5\u5f88\u7b80\u6d01\u7684\u8868\u8fbe with_fileglob : '*.txt'","title":"\u6bd4\u8f83loop \u548c with_*"},{"location":"basic/Conditionals-loop/#_7","text":"","title":"\u6807\u51c6\u5faa\u73af"},{"location":"basic/Conditionals-loop/#_8","text":"\u6dfb\u52a0\u591a\u4e2a\u7528\u6237 - name : add several users user : name : \"{{ item }}\" state : present groups : \"wheel\" loop : - testuser1 - testuser2 \u4e5f\u53ef\u4ee5\u76f4\u63a5\u5f15\u7528\u53d8\u91cf\u5217\u8868 loop : \"{{ somelist }}\" \u8fd9\u4e24\u4e2a\u4f8b\u5b50\u7b49\u4ef7\u4e8e - name : add user testuser1 user : name : \"testuser1\" state : present groups : \"wheel\" - name : add user testuser2 user : name : \"testuser2\" state : present groups : \"wheel\" \u6709\u65f6\uff0c\u5982\u679c\u6a21\u5757\u53ef\u4ee5\u63a5\u53d7\u5217\u8868\u7684\u8bdd\uff0c\u5c31\u4e0d\u9700\u8981\u4f7f\u7528\u5faa\u73af\u6765\u4f20\u9012\u3002\u4f8b\u5982yum\u5305\u7ba1\u7406\u7684 - name : optimal yum yum : name : \"{{ list_of_packages }}\" state : present - name : non-optimal yum, slower and may cause issues with interdependencies yum : name : \"{{ item }}\" state : present loop : \"{{ list_of_packages }}\"","title":"\u904d\u5386\u5217\u8868"},{"location":"basic/Conditionals-loop/#_9","text":"\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u6563\u5217\u5217\u8868\uff0c\u53ef\u4ee5\u5728\u5faa\u73af\u4e2d\u5f15\u7528\u5b50\u952e\u3002 - name : add several users user : name : \"{{ item.name }}\" state : present groups : \"{{ item.groups }}\" loop : - { name : 'testuser1' , groups : 'wheel' } - { name : 'testuser2' , groups : 'root' } \u6dfb\u52a0\u591a\u4e2a\u7528\u6237\uff0c\u5e76\u5c06\u7528\u6237\u52a0\u5165\u4e0d\u540c\u7684\u7ec4\u5185\u3002","title":"\u904d\u5386\u6563\u5217\u5217\u8868"},{"location":"basic/Conditionals-loop/#_10","text":"\u8981\u904d\u5386\u5b57\u5178\uff0c\u8bf7\u4f7f\u7528 dict2items \u8fc7\u6ee4\u5668\u5c06\u5b57\u5178\u8f6c\u6362\u6210\u6563\u5217\uff1a - name : create a tag dictionary of non-empty tags set_fact : tags_dict : \"{{ (tags_dict|default({}))|combine({item.key: item.value}) }}\" loop : \"{{ tags|dict2items }}\" vars : tags : Environment : dev Application : payment Another : \"{{ doesnotexist | default() }}\" when : item.value != \"\" default() \u53ef\u4ee5\u5728\u53d8\u91cf\u672a\u5b9a\u4e49\u7684\u65f6\u5019\u4e3a\u5176\u8bbe\u7f6e\u4e00\u4e2a\u9ed8\u8ba4\u503c\u3002","title":"\u904d\u5386\u5b57\u5178"},{"location":"basic/Conditionals-loop/#_11","text":"- shell : \"echo {{ item }}\" loop : - \"one\" - \"two\" register : echo \u5f53\u60a8\u5728\u5faa\u73af\u4e2d\u4f7f\u7528register\u65f6\uff0c\u653e\u5728\u53d8\u91cf\u4e2d\u7684\u6570\u636e\u7ed3\u6784\u5c06\u5305\u542b\u4e00\u4e2aresults\u5c5e\u6027\uff0c\u8be5\u5c5e\u6027\u662f\u6765\u81ea\u6a21\u5757\u7684\u6240\u6709\u6267\u884c\u7684\u5217\u8868\u3002\u8fd9\u4e0e\u4e0d\u4f7f\u7528\u5faa\u73af\u4f7f\u7528register\u65f6\u8fd4\u56de\u7684\u6570\u636e\u7ed3\u6784\u4e0d\u540c { \"changed\" : true , \"msg\" : \"All items completed\" , \"results\" : [ { \"ansible_loop_var\" : \"item\" , \"changed\" : true , \"cmd\" : \"echo one\" , \"delta\" : \"0:00:00.003978\" , \"end\" : \"2020-03-30 21:13:24.329114\" , \"failed\" : false , \"invocation\" : { \"module_args\" : { \"_raw_params\" : \"echo one\" , \"_uses_shell\" : true , \"argv\" : null , \"chdir\" : null , \"creates\" : null , \"executable\" : null , \"removes\" : null , \"stdin\" : null , \"stdin_add_newline\" : true , \"strip_empty_ends\" : true , \"warn\" : true } }, \"item\" : \"one\" , \"rc\" : 0 , \"start\" : \"2020-03-30 21:13:24.325136\" , \"stderr\" : \"\" , \"stderr_lines\" : [], \"stdout\" : \"one\" , \"stdout_lines\" : [ \"one\" ] }, { \"ansible_loop_var\" : \"item\" , \"changed\" : true , \"cmd\" : \"echo two\" , \"delta\" : \"0:00:00.003879\" , \"end\" : \"2020-03-30 21:13:24.621379\" , \"failed\" : false , \"invocation\" : { \"module_args\" : { \"_raw_params\" : \"echo two\" , \"_uses_shell\" : true , \"argv\" : null , \"chdir\" : null , \"creates\" : null , \"executable\" : null , \"removes\" : null , \"stdin\" : null , \"stdin_add_newline\" : true , \"strip_empty_ends\" : true , \"warn\" : true } }, \"item\" : \"two\" , \"rc\" : 0 , \"start\" : \"2020-03-30 21:13:24.613500\" , \"stderr\" : \"\" , \"stderr_lines\" : [], \"stdout\" : \"two\" , \"stdout_lines\" : [ \"two\" ] } ] } \u540e\u7eed\u4f7f\u7528\u6ce8\u518c\u53d8\u91cf\u6765\u68c0\u67e5\u547d\u4ee4\u6267\u884c\u60c5\u51b5 - name : Fail if return code is not 0 fail : msg : \"The command ({{ item.cmd }}) did not have a 0 return code\" when : item.rc != 0 loop : \"{{ echo.results }}\" \u5728\u5faa\u73af\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5f53\u524d\u7684\u6a21\u5757\u7ed3\u679c - shell : echo \"{{ item }}\" loop : - one - two register : echo changed_when : echo.stdout != \"one\"","title":"\u5faa\u73af\u4e2d\u6ce8\u518c\u53d8\u91cf"},{"location":"basic/Conditionals-loop/#_12","text":"","title":"\u590d\u6742\u5faa\u73af"},{"location":"basic/Conditionals-loop/#_13","text":"\u60a8\u53ef\u4ee5\u4f7f\u7528Jinja2\u8868\u8fbe\u5f0f\u8fed\u4ee3\u590d\u6742\u7684\u5217\u8868\u3002\u4f8b\u5982\uff0c \u5206\u522b\u7ed9\u7528\u6237\u6388\u4e883\u4e2a\u6570\u636e\u5e93\u7684\u6240\u6709\u6743\u9650 - name : give users access to multiple databases mysql_user : name : \"{{ item[0] }}\" priv : \"{{ item[1] }}.*:ALL\" append_privs : yes password : \"foo\" loop : \"{{ ['alice', 'bob'] | product(['clientdb', 'employeedb', 'providerdb'])|list }}\"","title":"\u904d\u5386\u5d4c\u5957\u5217\u8868"},{"location":"basic/Conditionals-loop/#_14","text":"\u53ef\u4ee5\u4f7f\u7528 until \u5173\u952e\u5b57\u91cd\u8bd5\u4efb\u52a1\uff0c\u76f4\u5230\u6ee1\u8db3\u7279\u5b9a\u6761\u4ef6\u3002 - shell : /usr/bin/foo register : result until : result.stdout.find(\"all systems go\") != -1 retries : 5 delay : 10 \u6b64\u4efb\u52a1\u6700\u591a\u8fd0\u884c5\u6b21\uff0c\u6bcf\u6b21\u5c1d\u8bd5\u4e4b\u95f4\u7684\u5ef6\u8fdf\u4e3a10\u79d2\u3002\u5982\u679c\u6807\u51c6\u8f93\u51fa\u4e2d\u6709 all systems go \u5b57\u7b26\u4e32\uff0c\u5219\u4efb\u52a1\u6210\u529f\u3002\u91cd\u8bd5\u7684\u9ed8\u8ba4\u503c\u662f3\uff0c\u5ef6\u8fdf\u662f5\u3002","title":"\u5728\u6ee1\u8db3\u6761\u4ef6\u4e4b\u524d\u91cd\u8bd5\u4efb\u52a1"},{"location":"basic/Conditionals-loop/#_15","text":"# \u8f93\u51fa\u6240\u6709\u4e3b\u673a\u4fe1\u606f - debug : msg : \"{{ item }}\" loop : \"{{ groups['all'] }}\" # \u8f93\u51fa\u5f53\u524dplay\u8fd0\u884c\u7684\u4e3b\u673a\u4fe1\u606f - debug : msg : \"{{ item }}\" loop : \"{{ ansible_play_batch }}\" # \u663e\u793a\u6e05\u5355\u4e2d\u7684\u6240\u6709\u4e3b\u673a - debug : msg : \"{{ item }}\" loop : \"{{ query('inventory_hostnames', 'all') }}\" # \u9664\u7ec4www\u5916\u7684\u6240\u6709\u4e3b\u673a - debug : msg : \"{{ item }}\" loop : \"{{ query('inventory_hostnames', 'all:!www') }}\"","title":"\u5faa\u73af\u4e3b\u673a\u6e05\u5355"},{"location":"basic/Conditionals-loop/#querylookup","text":"loop\u5173\u952e\u5b57\u9700\u8981\u4e00\u4e2a\u5217\u8868\u4f5c\u4e3a\u8f93\u5165\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c lookup \u5173\u952e\u5b57\u8fd4\u56de\u4e00\u4e2a\u9017\u53f7\u5206\u9694\u7684\u503c\u5b57\u7b26\u4e32 ,\u800c query \u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5217\u8868\u3002 \u5982\u679c\u4f7f\u7528 lookup \u8fd4\u56de\u5217\u8868\uff0c\u5219\u53ef\u4ee5\u6dfb\u52a0 wantlist=True \u5f3a\u5236\u8fd4\u56de\u5217\u8868\u3002 loop : \"{{ query('inventory_hostnames', 'all') }}\" loop : \"{{ lookup('inventory_hostnames', 'all', wantlist=True) }}\"","title":"\u4f7f\u7528query\u8fd8\u662flookup"},{"location":"basic/Conditionals-loop/#_16","text":"\u4f7f\u7528 loop_control \u5173\u952e\u5b57\u6765\u7ba1\u7406\u5faa\u73af\u3002","title":"\u5faa\u73af\u63a7\u5236"},{"location":"basic/Conditionals-loop/#labelloop","text":"- name : create servers digital_ocean : name : \"{{ item.name }}\" state : present loop : - name : server1 disks : 3gb ram : 15Gb network : nic01 : 100Gb nic02 : 10Gb ... loop_control : label : \"{{ item.name }}\" \u8fd9\u4e2a\u4efb\u52a1\u7684\u8f93\u51fa\u5c06\u53ea\u663e\u793a\u6bcf\u4e2a\u9879\u76ee\u7684\u540d\u79f0\u5b57\u6bb5\uff0c\u800c\u4e0d\u662f\u591a\u884c {{item}} \u53d8\u91cf\u7684\u6574\u4e2a\u5185\u5bb9\u3002 \u8fd9\u662f\u4e3a\u4e86\u4f7f\u63a7\u5236\u53f0\u8f93\u51fa\u66f4\u5177\u53ef\u8bfb\u6027\uff0c\u800c\u4e0d\u662f\u4e3a\u4e86\u4fdd\u62a4\u654f\u611f\u6570\u636e\u3002\u5982\u679c\u5faa\u73af\u4e2d\u6709\u654f\u611f\u6570\u636e\uff0c\u5219\u8bbe\u7f6e no_log: yes \uff0c\u4ee5\u9632\u6b62\u6cc4\u6f0f\u3002","title":"\u4f7f\u7528label\u9650\u5236loop\u7684\u8f93\u51fa"},{"location":"basic/Conditionals-loop/#_17","text":"\u4f7f\u7528 pause \u6307\u4ee4\u63a7\u5236\u5faa\u73af\u4e2d\u6bcf\u4e2a\u9879\u6267\u884c\u4e4b\u95f4\u7684\u65f6\u95f4(\u4ee5\u79d2\u4e3a\u5355\u4f4d) - name : create servers, pause 3s before creating next digital_ocean : name : \"{{ item }}\" state : present loop : - server1 - server2 loop_control : pause : 3","title":"\u5faa\u73af\u95f4\u9694\u65f6\u95f4"},{"location":"basic/Conditionals-loop/#_18","text":"\u4f7f\u7528 index_var \u6307\u4ee4\u6765\u8ddf\u8e2a\u5f53\u524d\u5faa\u73af\u7684\u7d22\u5f15 - name : count our fruit debug : msg : \"{{ item }} with index {{ my_idx }}\" loop : - apple - banana - pear loop_control : index_var : my_idx","title":"\u5faa\u73af\u7d22\u5f15"},{"location":"basic/Conditionals-loop/#_19","text":"\u5faa\u73af\u7684\u9ed8\u8ba4\u53d8\u91cf\u540d\u79f0\u4e3a item ,\u53ef\u4ee5\u901a\u8fc7 loop_var \u6765\u4fee\u6539\u6b64\u9879,\u4ece\u800c\u907f\u514d\u8986\u76d6 include_tasks \u4efb\u52a1\u91cc\u7684\u5faa\u73af\u53d8\u91cf # main.yml - include_tasks : inner.yml loop : - 1 - 2 - 3 loop_control : loop_var : outer_item # inner.yml - debug : msg : \"outer item={{ outer_item }} inner item={{ item }}\" loop : - a - b - c","title":"\u66f4\u6539\u5faa\u73af\u7684\u53d8\u91cf\u540d\u79f0"},{"location":"basic/Conditionals-loop/#_20","text":"\u4eceAnsible 2.8\u5f00\u59cb\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u6269\u5c55\u9009\u9879\u6765\u83b7\u53d6\u6269\u5c55\u5faa\u73af\u4fe1\u606f\u3002\u6b64\u9009\u9879\u5c06\u516c\u5f00\u4ee5\u4e0b\u4fe1\u606f\u3002 \u53d8\u91cf \u63cf\u8ff0 ansible_loop.allitems \u5faa\u73af\u4e2d\u6240\u6709\u9879\u7684\u5217\u8868 ansible_loop.index \u5faa\u73af\u7684\u5f53\u524d\u8fed\u4ee3\u6b21\u6570\u3002(\u4ece1\u5f00\u59cb) ansible_loop.index0 \u5faa\u73af\u7684\u5f53\u524d\u8fed\u4ee3\u6b21\u6570\u3002(\u4ece0\u5f00\u59cb) ansible_loop.revindex \u5faa\u73af\u7ed3\u675f\u540e\u7684\u8fed\u4ee3\u6b21\u6570\u3002(\u4ece1\u5f00\u59cb) ansible_loop.revindex0 \u5faa\u73af\u7ed3\u675f\u540e\u7684\u8fed\u4ee3\u6b21\u6570\u3002(\u4ece0\u5f00\u59cb) ansible_loop.first \u5982\u679c\u662f\u7b2c\u4e00\u6b21\u8fed\u4ee3\uff0c\u8fd4\u56de True ansible_loop.last \u5982\u679c\u662f\u6700\u540e\u4e00\u6b21\u8fed\u4ee3\uff0c\u8fd4\u56de True ansible_loop.length \u5faa\u73af\u4e2d\u7684\u9879\u6570 ansible_loop.previtem \u5faa\u73af\u524d\u4e00\u6b21\u8fed\u4ee3\u7684\u9879\u3002\u5728\u7b2c\u4e00\u6b21\u8fed\u4ee3\u4e2d\u672a\u5b9a\u4e49\u3002 ansible_loop.nextitem \u5faa\u73af\u7684\u540e\u7eed\u8fed\u4ee3\u4e2d\u7684\u9879\u3002\u5728\u6700\u540e\u4e00\u6b21\u8fed\u4ee3\u4e2d\u672a\u5b9a\u4e49\u3002 loop_control: extended: yes #### \u83b7\u53d6 loop_var \u7684\u540d\u79f0 \u4eceansible2.8\u5f00\u59cb\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 ansible_loop_var \u6765\u83b7\u53d6 loop_control.loop_var \u7684\u503c \"{{ lookup('vars', ansible_loop_var) }}\"","title":"\u6269\u5c55\u53d8\u91cf"},{"location":"basic/Conditionals-loop/#with_loop","text":"\u968f\u7740Ansible 2.5\u7684\u53d1\u5e03\uff0c\u6267\u884c\u5faa\u73af\u7684\u63a8\u8350\u65b9\u6cd5\u662f\u4f7f\u7528 loop \u5173\u952e\u5b57\uff0c\u800c\u4e0d\u662f with_* \u6837\u5f0f\u7684\u5faa\u73af\u3002 \u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\uff0c loop \u8bed\u6cd5\u4f7f\u7528\u8fc7\u6ee4\u5668\u66f4\u597d\u5730\u8868\u8fbe\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u66f4\u590d\u6742\u7684 query \u6216 lookup \u3002 \u4e0b\u9762\u7684\u793a\u4f8b\u5c06\u5c55\u793a\u5982\u4f55\u5c06\u8bb8\u591a\u5e38\u89c1\u7684 with_ \u6837\u5f0f\u5faa\u73af\u8f6c\u6362\u4e3a loop \u3002","title":"\u4ecewith_*\u8fc1\u79fb\u5230loop"},{"location":"basic/Conditionals-loop/#with_list","text":"\u904d\u5386\u5217\u8868 - name : with_list debug : msg : \"{{ item }}\" with_list : - one - two - name : with_list -> loop debug : msg : \"{{ item }}\" loop : - one - two","title":"with_list"},{"location":"basic/Conditionals-loop/#with_items","text":"\u904d\u5386\u5217\u8868 - name : with_items debug : msg : \"{{ item }}\" with_items : \"{{ items }}\" - name : with_items -> loop debug : msg : \"{{ item }}\" loop : \"{{ items | flatten(levels=1) }}\"","title":"with_items"},{"location":"basic/Conditionals-loop/#with_indexed_items","text":"\u904d\u5386\u5217\u8868\u548c\u7d22\u5f15 - name : with_indexed_items debug : msg : \"{{ item.0 }} - {{ item.1 }}\" with_indexed_items : \"{{ items }}\" - name : with_indexed_items -> loop debug : msg : \"{{ index }} - {{ item }}\" loop : \"{{ items | flatten(levels=1) }}\" loop_control : index_var : index","title":"with_indexed_items"},{"location":"basic/Conditionals-loop/#with_flattened","text":"\u5408\u5e76\u5217\u8868 - name : with_flattened debug : msg : \"{{ item }}\" with_flattened : \"{{ items }}\" - name : with_flattened -> loop debug : msg : \"{{ item }}\" loop : \"{{ items | flatten }}\"","title":"with_flattened"},{"location":"basic/Conditionals-loop/#with_together","text":"\u5e76\u884c\u904d\u5386\u5217\u8868 - name : with_together debug : msg : \"{{ item.0 }} - {{ item.1 }}\" with_together : - \"{{ list_one }}\" - \"{{ list_two }}\" - name : with_together -> loop debug : msg : \"{{ item.0 }} - {{ item.1 }}\" loop : \"{{ list_one|zip(list_two)|list }}\"","title":"with_together"},{"location":"basic/Conditionals-loop/#with_dict","text":"\u904d\u5386\u5b57\u5178 - name : with_dict debug : msg : \"{{ item.key }} - {{ item.value }}\" with_dict : \"{{ dictionary }}\" - name : with_dict -> loop (option 1) debug : msg : \"{{ item.key }} - {{ item.value }}\" loop : \"{{ dictionary|dict2items }}\" - name : with_dict -> loop (option 2) debug : msg : \"{{ item.0 }} - {{ item.1 }}\" loop : \"{{ dictionary|dictsort }}\" - name : with_dict lookup debug : msg : \"with_dict_lookup: item.key is '{{ item.key }}' and item.value is '{{ item.value }}'\" loop : \"{{ lookup('dict', dictionary) }}\" - name : with_dict query debug : msg : \"with_dict_query: item.key is '{{ item.key }}' and item.value is '{{ item.value }}'\" loop : \"{{ query('dict', dictionary) }}\"","title":"with_dict"},{"location":"basic/Conditionals-loop/#with_sequence","text":"\u4ee5\u9012\u589e\u7684\u6570\u5b57\u987a\u5e8f\u751f\u6210\u9879\u5e8f\u5217 - name : with_sequence debug : msg : \"{{ item }}\" with_sequence : start=0 end=4 stride=2 format=testuser%02x - name : with_sequence -> loop debug : msg : \"{{ 'testuser%02x' | format(item) }}\" # range is exclusive of the end point loop : \"{{ range(0, 4 + 1, 2)|list }}\" - name : with sequence loop and lookup debug : msg : \"sequence_lookup: item is '{{ item }}'\" # end is inclusive of the end point loop : \"{{ lookup('sequence', 'start=0 end=4 stride=2 format=testuser%02x', wantlist=True) }}\" - name : with sequence loop and query debug : msg : \"sequence_query: item is '{{ item }}'\" # end is inclusive of the end point loop : \"{{ query('sequence', 'start=0 end=4 stride=2 format=testuser%02x') }}\"","title":"with_sequence"},{"location":"basic/Conditionals-loop/#with_subelements","text":"\u904d\u5386\u5b50\u5143\u7d20 - name : with_nested debug : msg : \"{{ item.0 }} - {{ item.1 }}\" with_nested : - \"{{ list_one }}\" - \"{{ list_two }}\" - name : with_nested -> loop debug : msg : \"{{ item.0 }} - {{ item.1 }}\" loop : \"{{ list_one|product(list_two)|list }}\"","title":"with_subelements"},{"location":"basic/Conditionals-loop/#with_random_choice","text":"\u968f\u673a\u9009\u62e9\u5217\u8868\u4e2d\u5f97\u4e00\u4e2a\u503c - name : with_random_choice debug : msg : \"{{ item }}\" with_random_choice : \"{{ my_list }}\" - name : with_random_choice -> loop (No loop is needed here) debug : msg : \"{{ my_list|random }}\" tags : random","title":"with_random_choice"},{"location":"basic/Facts/","text":"11. Facts \u6570\u636e \u00b6 Facts\u4e3b\u8981\u662f\u7528\u6765\u91c7\u96c6\u76ee\u6807\u7cfb\u7edf\u4fe1\u606f\u7684\uff0c\u91c7\u96c6\u5230\u4fe1\u606f\u5b58\u50a8\u5728 ansible_facts \u53d8\u91cf\u4e2d\uff0c\u4e5f\u6709\u8bb8\u591a\u4fe1\u606f\u5b58\u50a8\u5728\u4ee5 ansible_ \u5f00\u5934\u7684\u53d8\u91cf\u3002 \u83b7\u53d6Facts\u4fe1\u606f \u00b6 \u4f7f\u7528setup\u6a21\u5757\u6765\u83b7\u53d6\u76ee\u6807\u7cfb\u7edf\u4fe1\u606f \u00b6 \u53ef\u4ee5\u4f7f\u7528 setup \u6a21\u5757\u624b\u52a8\u7684\u83b7\u53d6\u76ee\u6807\u7cfb\u7edf\u4fe1\u606f ansible hostname -m setup \u5411 setup \u6a21\u5757\u4f20\u9012 filter \u9009\u9879\uff0c\u5c31\u53ef\u4ee5\u9009\u62e9\u83b7\u53d6\u54ea\u4e9b\u5185\u5bb9\uff0c\u4f8b\u5982\u4ec5\u663e\u793a\u4e0eansible\u76f8\u5173\u7684\u5185\u5b58\u4fe1\u606f ansible all -m setup -a 'filter=ansible_*_mb' \u4f7f\u7528playbook\u6765\u83b7\u53d6\u76ee\u6807\u7cfb\u7edf\u4fe1\u606f \u00b6 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cplaybook\u7684\u7b2c\u4e00\u4e2a\u4efb\u52a1\u5c31\u662f Facts \u4fe1\u606f\uff0c\u663e\u793a\u7684\u7ed3\u679c\u5982\u4e0b: PLAY [192.168.77.130] ****************************************** TASK [Gathering Facts] **************************************************************** ok : [ 192.168.77.130 ] TASK [test] **************************************************** changed : [ 192.168.77.130 ] \u5982\u679c\u8981\u5173\u95edplaybook\u7684\u8fd9\u4e00\u64cd\u4f5c\uff0c\u5c31\u9700\u8981\u4e3aplay\u6dfb\u52a0 gather_facts \u5173\u952e\u5b57 # \u5173\u95ed\u5173\u95ed\u81ea\u52a8\u91c7\u96c6Facts - hosts : whatever gather_facts : no \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u662f\u6536\u96c6\u6240\u6709\u7684facts\u4fe1\u606f\uff0c\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539ansible\u914d\u7f6e\u6587\u4ef6\u6765\u8fbe\u5230\u53ea\u83b7\u53d6\u67d0\u4e00\u7c7b\u578b\u7684\u4fe1\u606f # /etc/ansible/ansible.cfg # all - \u6536\u96c6\u6240\u6709\u5b50\u96c6\uff0c\u9ed8\u8ba4 # network - \u6536\u96c6\u7f51\u7edc\u4fe1\u606f\u5b50\u96c6 # hardware - \u6536\u96c6\u786c\u4ef6\u4fe1\u606f\u5b50\u96c6 # virtual - \u6536\u96c6\u865a\u62df\u76f8\u5173\u7684\u4fe1\u606f # facter - \u6536\u96c6\u81ea\u5b9a\u4e49\u7684fact\u4fe1\u606f # ohai - \u6536\u96c6ohai\u4fe1\u606f # \u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u5b50\u96c6 (ex: network,virtual) # \u53ef\u4ee5\u6392\u9664\u5b50\u96c6 (ex: !hardware,!facter,!ohai) gather_subset = all \u5728task\u4e2d\u8bbe\u7f6efacts\u4fe1\u606f \u00b6 \u53ef\u4ee5\u4f7f\u7528 set_fact \u6765\u8bbe\u7f6e\u5f53\u524d\u8fd0\u884c\u4e3b\u673a\u7684facts\u4fe1\u606f - hosts : hostname tasks : - command : whoami register : result - set_fact : one : \"{{ result.stdout }}\" two : true - debug : var=one - debug : var=two \u81ea\u5b9a\u4e49\u76ee\u6807\u7cfb\u7edffacts \u00b6 \u5728\u8fdc\u7a0b\u4e3b\u673a/etc/ansible/facts.d/\u76ee\u5f55\u4e0b\u521b\u5efa.fact \u7ed3\u5c3e\u7684\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u662fjson\u3001ini \u6216\u8005\u8fd4\u56dejson \u683c\u5f0f\u6570\u636e\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u8fd9\u4e9b\u5c06\u88ab\u4f5c\u4e3a\u8fdc\u7a0b\u4e3b\u673a\u672c\u5730\u7684facts \u6267\u884c \u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u64cd\u4f5c mkdir -p /etc/ansible/facts.d cat << EOF > /etc/ansible/facts.d/hello.fact [test] h=hello p=world EOF \u5728ansible\u63a7\u5236\u8282\u70b9\u4e0a\u64cd\u4f5c \u8fdc\u7a0b\u4e3b\u673a\u7684\u81ea\u5b9a\u4e49facts\u4fe1\u606f\uff0c\u5b58\u50a8\u5728 ansible_local \u53d8\u91cf\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 setup \u6a21\u5757\u8fc7\u6ee4\u83b7\u53d6 ansible 192 .168.77.130 -m setup -a \"filter=ansible_local\" 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"ansible_local\" : { \"hello\" : { \"test\" : { \"h\" : \"hello\" , \"p\" : \"world\" } } } , \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false } \u4e5f\u53ef\u4ee5\u901a\u8fc7\u5728\u4efb\u52a1\u4e2d\u4f7f\u7528 {{ ansible_local.hello }} \u7684\u65b9\u5f0f\u8bbf\u95ee\u8be5\u53d8\u91cf --- - hosts: 192 .168.77.130 tasks: - debug: var = ansible_local.hello - debug: var = ansible_local.hello.test.h \u5f53\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e0a\u9762\u7684\u6b65\u9aa4\uff0c\u901a\u8fc7playbook\u6765\u5b9e\u73b0 \u8fd0\u7528playbook \u5b9a\u4e49\u8fdc\u7aeffacts.d\uff0c\u5e76\u52a0\u8f7d\u5230fact\u4e2d - hosts : node1 tasks : - name : create directory for ansible custom facts file : state=directory recurse=yes path=/etc/ansible/facts.d - name : install custom test fact copy : content : | [test] h=hello p=world dest : /etc/ansible/facts.d/test.fact - name : re-read facts after adding custom fact setup : filter=ansible_local - name : ansible_local vars debug : var=ansible_local Facts \u8fd4\u56de\u7684\u4fe1\u606f \u00b6 \u4ee5 ansible 2.9.1 \u7248\u672c\u8fd4\u56de centos 7 \u7cfb\u7edf\u7684Facts\u4fe1\u606f \"ansible_facts\" : { \"ansible_all_ipv4_addresses\" : [ \"192.168.77.130\" , \"172.17.0.1\" ], \"ansible_all_ipv6_addresses\" : [ \"fe80::6d73:3667:2ed6:a7c2\" , \"fe80::4d03:8744:2f0d:2085\" ], \"ansible_apparmor\" : { \"status\" : \"disabled\" }, \"ansible_architecture\" : \"x86_64\" , \"ansible_bios_date\" : \"07/29/2019\" , \"ansible_bios_version\" : \"6.00\" , \"ansible_cmdline\" : { \"BOOT_IMAGE\" : \"/vmlinuz-5.1.11-1.el7.elrepo.x86_64\" , \"crashkernel\" : \"auto\" , \"quiet\" : true , \"rhgb\" : true , \"ro\" : true , \"root\" : \"UUID=a7d49533-e756-4a71-a977-5efb174eb09c\" , \"user_namespace.enable\" : \"1\" }, \"ansible_date_time\" : { \"date\" : \"2020-03-31\" , \"day\" : \"31\" , \"epoch\" : \"1585627320\" , \"hour\" : \"12\" , \"iso8601\" : \"2020-03-31T04:02:00Z\" , \"iso8601_basic\" : \"20200331T120200260891\" , \"iso8601_basic_short\" : \"20200331T120200\" , \"iso8601_micro\" : \"2020-03-31T04:02:00.260966Z\" , \"minute\" : \"02\" , \"month\" : \"03\" , \"second\" : \"00\" , \"time\" : \"12:02:00\" , \"tz\" : \"CST\" , \"tz_offset\" : \"+0800\" , \"weekday\" : \"\u661f\u671f\u4e8c\" , \"weekday_number\" : \"2\" , \"weeknumber\" : \"13\" , \"year\" : \"2020\" }, \"ansible_default_ipv4\" : { \"address\" : \"192.168.77.130\" , \"alias\" : \"ens33\" , \"broadcast\" : \"192.168.77.255\" , \"gateway\" : \"192.168.77.2\" , \"interface\" : \"ens33\" , \"macaddress\" : \"00:0c:29:88:01:c0\" , \"mtu\" : 1500 , \"netmask\" : \"255.255.255.0\" , \"network\" : \"192.168.77.0\" , \"type\" : \"ether\" }, \"ansible_default_ipv6\" : {}, \"ansible_device_links\" : { \"ids\" : { \"sr0\" : [ \"ata-VMware_Virtual_IDE_CDROM_Drive_10000000000000000001\" ] }, \"labels\" : {}, \"masters\" : {}, \"uuids\" : { \"sda1\" : [ \"93556f71-6dad-4761-9207-edee35d47129\" ], \"sda2\" : [ \"0c0f8a5a-58dd-4fc6-a49e-fc5e63f5d8a3\" ], \"sda3\" : [ \"a7d49533-e756-4a71-a977-5efb174eb09c\" ] } }, \"ansible_devices\" : { \"sda\" : { \"holders\" : [], \"host\" : \"SCSI storage controller: LSI Logic / Symbios Logic 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI (rev 01)\" , \"links\" : { \"ids\" : [], \"labels\" : [], \"masters\" : [], \"uuids\" : [] }, \"model\" : \"VMware Virtual S\" , \"partitions\" : { \"sda1\" : { \"holders\" : [], \"links\" : { \"ids\" : [], \"labels\" : [], \"masters\" : [], \"uuids\" : [ \"93556f71-6dad-4761-9207-edee35d47129\" ] }, \"sectors\" : \"409600\" , \"sectorsize\" : 512 , \"size\" : \"200.00 MB\" , \"start\" : \"2048\" , \"uuid\" : \"93556f71-6dad-4761-9207-edee35d47129\" }, \"sda2\" : { \"holders\" : [], \"links\" : { \"ids\" : [], \"labels\" : [], \"masters\" : [], \"uuids\" : [ \"0c0f8a5a-58dd-4fc6-a49e-fc5e63f5d8a3\" ] }, \"sectors\" : \"20971520\" , \"sectorsize\" : 512 , \"size\" : \"10.00 GB\" , \"start\" : \"411648\" , \"uuid\" : \"0c0f8a5a-58dd-4fc6-a49e-fc5e63f5d8a3\" }, \"sda3\" : { \"holders\" : [], \"links\" : { \"ids\" : [], \"labels\" : [], \"masters\" : [], \"uuids\" : [ \"a7d49533-e756-4a71-a977-5efb174eb09c\" ] }, \"sectors\" : \"62502912\" , \"sectorsize\" : 512 , \"size\" : \"29.80 GB\" , \"start\" : \"21383168\" , \"uuid\" : \"a7d49533-e756-4a71-a977-5efb174eb09c\" } }, \"removable\" : \"0\" , \"rotational\" : \"1\" , \"sas_address\" : null , \"sas_device_handle\" : null , \"scheduler_mode\" : \"mq-deadline\" , \"sectors\" : \"83886080\" , \"sectorsize\" : \"512\" , \"size\" : \"40.00 GB\" , \"support_discard\" : \"0\" , \"vendor\" : \"VMware,\" , \"virtual\" : 1 }, \"sr0\" : { \"holders\" : [], \"host\" : \"IDE interface: Intel Corporation 82371AB/EB/MB PIIX4 IDE (rev 01)\" , \"links\" : { \"ids\" : [ \"ata-VMware_Virtual_IDE_CDROM_Drive_10000000000000000001\" ], \"labels\" : [], \"masters\" : [], \"uuids\" : [] }, \"model\" : \"VMware IDE CDR10\" , \"partitions\" : {}, \"removable\" : \"1\" , \"rotational\" : \"1\" , \"sas_address\" : null , \"sas_device_handle\" : null , \"scheduler_mode\" : \"mq-deadline\" , \"sectors\" : \"2097151\" , \"sectorsize\" : \"512\" , \"size\" : \"1024.00 MB\" , \"support_discard\" : \"0\" , \"vendor\" : \"NECVMWar\" , \"virtual\" : 1 } }, \"ansible_distribution\" : \"CentOS\" , \"ansible_distribution_file_parsed\" : true , \"ansible_distribution_file_path\" : \"/etc/redhat-release\" , \"ansible_distribution_file_variety\" : \"RedHat\" , \"ansible_distribution_major_version\" : \"7\" , \"ansible_distribution_release\" : \"Core\" , \"ansible_distribution_version\" : \"7.6\" , \"ansible_dns\" : { \"nameservers\" : [ \"192.168.77.2\" ] }, \"ansible_docker0\" : { \"active\" : false , \"device\" : \"docker0\" , \"features\" : { \"esp_hw_offload\" : \"off [fixed]\" , \"esp_tx_csum_hw_offload\" : \"off [fixed]\" , \"fcoe_mtu\" : \"off [fixed]\" , \"generic_receive_offload\" : \"on\" , \"generic_segmentation_offload\" : \"on\" , \"highdma\" : \"on\" , \"hw_tc_offload\" : \"off [fixed]\" , \"l2_fwd_offload\" : \"off [fixed]\" , \"large_receive_offload\" : \"off [fixed]\" , \"loopback\" : \"off [fixed]\" , \"netns_local\" : \"on [fixed]\" , \"ntuple_filters\" : \"off [fixed]\" , \"receive_hashing\" : \"off [fixed]\" , \"rx_all\" : \"off [fixed]\" , \"rx_checksumming\" : \"off [fixed]\" , \"rx_fcs\" : \"off [fixed]\" , \"rx_gro_hw\" : \"off [fixed]\" , \"rx_udp_tunnel_port_offload\" : \"off [fixed]\" , \"rx_vlan_filter\" : \"off [fixed]\" , \"rx_vlan_offload\" : \"off [fixed]\" , \"rx_vlan_stag_filter\" : \"off [fixed]\" , \"rx_vlan_stag_hw_parse\" : \"off [fixed]\" , \"scatter_gather\" : \"on\" , \"tcp_segmentation_offload\" : \"on\" , \"tls_hw_record\" : \"off [fixed]\" , \"tls_hw_rx_offload\" : \"off [fixed]\" , \"tls_hw_tx_offload\" : \"off [fixed]\" , \"tx_checksum_fcoe_crc\" : \"off [fixed]\" , \"tx_checksum_ip_generic\" : \"on\" , \"tx_checksum_ipv4\" : \"off [fixed]\" , \"tx_checksum_ipv6\" : \"off [fixed]\" , \"tx_checksum_sctp\" : \"off [fixed]\" , \"tx_checksumming\" : \"on\" , \"tx_esp_segmentation\" : \"on\" , \"tx_fcoe_segmentation\" : \"on\" , \"tx_gre_csum_segmentation\" : \"on\" , \"tx_gre_segmentation\" : \"on\" , \"tx_gso_partial\" : \"on\" , \"tx_gso_robust\" : \"on\" , \"tx_ipxip4_segmentation\" : \"on\" , \"tx_ipxip6_segmentation\" : \"on\" , \"tx_lockless\" : \"on [fixed]\" , \"tx_nocache_copy\" : \"off\" , \"tx_scatter_gather\" : \"on\" , \"tx_scatter_gather_fraglist\" : \"on\" , \"tx_sctp_segmentation\" : \"on\" , \"tx_tcp6_segmentation\" : \"on\" , \"tx_tcp_ecn_segmentation\" : \"on\" , \"tx_tcp_mangleid_segmentation\" : \"on\" , \"tx_tcp_segmentation\" : \"on\" , \"tx_udp_segmentation\" : \"on\" , \"tx_udp_tnl_csum_segmentation\" : \"on\" , \"tx_udp_tnl_segmentation\" : \"on\" , \"tx_vlan_offload\" : \"on\" , \"tx_vlan_stag_hw_insert\" : \"on\" , \"udp_fragmentation_offload\" : \"off\" , \"vlan_challenged\" : \"off [fixed]\" }, \"hw_timestamp_filters\" : [], \"id\" : \"8000.024238d96cf4\" , \"interfaces\" : [], \"ipv4\" : { \"address\" : \"172.17.0.1\" , \"broadcast\" : \"172.17.255.255\" , \"netmask\" : \"255.255.0.0\" , \"network\" : \"172.17.0.0\" }, \"macaddress\" : \"02:42:38:d9:6c:f4\" , \"mtu\" : 1500 , \"promisc\" : false , \"stp\" : false , \"timestamping\" : [ \"rx_software\" , \"software\" ], \"type\" : \"bridge\" }, \"ansible_domain\" : \"\" , \"ansible_effective_group_id\" : 0 , \"ansible_effective_user_id\" : 0 , \"ansible_ens33\" : { \"active\" : true , \"device\" : \"ens33\" , \"features\" : { \"esp_hw_offload\" : \"off [fixed]\" , \"esp_tx_csum_hw_offload\" : \"off [fixed]\" , \"fcoe_mtu\" : \"off [fixed]\" , \"generic_receive_offload\" : \"on\" , \"generic_segmentation_offload\" : \"on\" , \"highdma\" : \"off [fixed]\" , \"hw_tc_offload\" : \"off [fixed]\" , \"l2_fwd_offload\" : \"off [fixed]\" , \"large_receive_offload\" : \"off [fixed]\" , \"loopback\" : \"off [fixed]\" , \"netns_local\" : \"off [fixed]\" , \"ntuple_filters\" : \"off [fixed]\" , \"receive_hashing\" : \"off [fixed]\" , \"rx_all\" : \"off\" , \"rx_checksumming\" : \"off\" , \"rx_fcs\" : \"off\" , \"rx_gro_hw\" : \"off [fixed]\" , \"rx_udp_tunnel_port_offload\" : \"off [fixed]\" , \"rx_vlan_filter\" : \"on [fixed]\" , \"rx_vlan_offload\" : \"on\" , \"rx_vlan_stag_filter\" : \"off [fixed]\" , \"rx_vlan_stag_hw_parse\" : \"off [fixed]\" , \"scatter_gather\" : \"on\" , \"tcp_segmentation_offload\" : \"on\" , \"tls_hw_record\" : \"off [fixed]\" , \"tls_hw_rx_offload\" : \"off [fixed]\" , \"tls_hw_tx_offload\" : \"off [fixed]\" , \"tx_checksum_fcoe_crc\" : \"off [fixed]\" , \"tx_checksum_ip_generic\" : \"on\" , \"tx_checksum_ipv4\" : \"off [fixed]\" , \"tx_checksum_ipv6\" : \"off [fixed]\" , \"tx_checksum_sctp\" : \"off [fixed]\" , \"tx_checksumming\" : \"on\" , \"tx_esp_segmentation\" : \"off [fixed]\" , \"tx_fcoe_segmentation\" : \"off [fixed]\" , \"tx_gre_csum_segmentation\" : \"off [fixed]\" , \"tx_gre_segmentation\" : \"off [fixed]\" , \"tx_gso_partial\" : \"off [fixed]\" , \"tx_gso_robust\" : \"off [fixed]\" , \"tx_ipxip4_segmentation\" : \"off [fixed]\" , \"tx_ipxip6_segmentation\" : \"off [fixed]\" , \"tx_lockless\" : \"off [fixed]\" , \"tx_nocache_copy\" : \"off\" , \"tx_scatter_gather\" : \"on\" , \"tx_scatter_gather_fraglist\" : \"off [fixed]\" , \"tx_sctp_segmentation\" : \"off [fixed]\" , \"tx_tcp6_segmentation\" : \"off [fixed]\" , \"tx_tcp_ecn_segmentation\" : \"off [fixed]\" , \"tx_tcp_mangleid_segmentation\" : \"off\" , \"tx_tcp_segmentation\" : \"on\" , \"tx_udp_segmentation\" : \"off [fixed]\" , \"tx_udp_tnl_csum_segmentation\" : \"off [fixed]\" , \"tx_udp_tnl_segmentation\" : \"off [fixed]\" , \"tx_vlan_offload\" : \"on [fixed]\" , \"tx_vlan_stag_hw_insert\" : \"off [fixed]\" , \"udp_fragmentation_offload\" : \"off\" , \"vlan_challenged\" : \"off [fixed]\" }, \"hw_timestamp_filters\" : [], \"ipv4\" : { \"address\" : \"192.168.77.130\" , \"broadcast\" : \"192.168.77.255\" , \"netmask\" : \"255.255.255.0\" , \"network\" : \"192.168.77.0\" }, \"ipv6\" : [ { \"address\" : \"fe80::6d73:3667:2ed6:a7c2\" , \"prefix\" : \"64\" , \"scope\" : \"link\" }, { \"address\" : \"fe80::4d03:8744:2f0d:2085\" , \"prefix\" : \"64\" , \"scope\" : \"link\" } ], \"macaddress\" : \"00:0c:29:88:01:c0\" , \"module\" : \"e1000\" , \"mtu\" : 1500 , \"pciid\" : \"0000:02:01.0\" , \"promisc\" : false , \"speed\" : 1000 , \"timestamping\" : [ \"tx_software\" , \"rx_software\" , \"software\" ], \"type\" : \"ether\" }, \"ansible_env\" : { \"HOME\" : \"/root\" , \"LANG\" : \"zh_CN.UTF-8\" , \"LESSOPEN\" : \"||/usr/bin/lesspipe.sh %s\" , \"LOGNAME\" : \"root\" , \"LS_COLORS\" : \"rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;36:*.au=01;36:*.flac=01;36:*.mid=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:*.xspf=01;36:\" , \"MAIL\" : \"/var/mail/root\" , \"PATH\" : \"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin\" , \"PWD\" : \"/root\" , \"SHELL\" : \"/bin/bash\" , \"SHLVL\" : \"2\" , \"SSH_CLIENT\" : \"192.168.77.128 46964 22\" , \"SSH_CONNECTION\" : \"192.168.77.128 46964 192.168.77.130 22\" , \"SSH_TTY\" : \"/dev/pts/1\" , \"TERM\" : \"linux\" , \"USER\" : \"root\" , \"XDG_RUNTIME_DIR\" : \"/run/user/0\" , \"XDG_SESSION_ID\" : \"22\" , \"_\" : \"/usr/bin/python\" }, \"ansible_fibre_channel_wwn\" : [], \"ansible_fips\" : false , \"ansible_form_factor\" : \"Other\" , \"ansible_fqdn\" : \"node130\" , \"ansible_hostname\" : \"node130\" , \"ansible_hostnqn\" : \"\" , \"ansible_interfaces\" : [ \"lo\" , \"docker0\" , \"ens33\" ], \"ansible_is_chroot\" : false , \"ansible_iscsi_iqn\" : \"\" , \"ansible_kernel\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"ansible_kernel_version\" : \"#1 SMP Mon Jun 17 15:51:08 EDT 2019\" , \"ansible_lo\" : { \"active\" : true , \"device\" : \"lo\" , \"features\" : { \"esp_hw_offload\" : \"off [fixed]\" , \"esp_tx_csum_hw_offload\" : \"off [fixed]\" , \"fcoe_mtu\" : \"off [fixed]\" , \"generic_receive_offload\" : \"on\" , \"generic_segmentation_offload\" : \"on\" , \"highdma\" : \"on [fixed]\" , \"hw_tc_offload\" : \"off [fixed]\" , \"l2_fwd_offload\" : \"off [fixed]\" , \"large_receive_offload\" : \"off [fixed]\" , \"loopback\" : \"on [fixed]\" , \"netns_local\" : \"on [fixed]\" , \"ntuple_filters\" : \"off [fixed]\" , \"receive_hashing\" : \"off [fixed]\" , \"rx_all\" : \"off [fixed]\" , \"rx_checksumming\" : \"on [fixed]\" , \"rx_fcs\" : \"off [fixed]\" , \"rx_gro_hw\" : \"off [fixed]\" , \"rx_udp_tunnel_port_offload\" : \"off [fixed]\" , \"rx_vlan_filter\" : \"off [fixed]\" , \"rx_vlan_offload\" : \"off [fixed]\" , \"rx_vlan_stag_filter\" : \"off [fixed]\" , \"rx_vlan_stag_hw_parse\" : \"off [fixed]\" , \"scatter_gather\" : \"on\" , \"tcp_segmentation_offload\" : \"on\" , \"tls_hw_record\" : \"off [fixed]\" , \"tls_hw_rx_offload\" : \"off [fixed]\" , \"tls_hw_tx_offload\" : \"off [fixed]\" , \"tx_checksum_fcoe_crc\" : \"off [fixed]\" , \"tx_checksum_ip_generic\" : \"on [fixed]\" , \"tx_checksum_ipv4\" : \"off [fixed]\" , \"tx_checksum_ipv6\" : \"off [fixed]\" , \"tx_checksum_sctp\" : \"on [fixed]\" , \"tx_checksumming\" : \"on\" , \"tx_esp_segmentation\" : \"off [fixed]\" , \"tx_fcoe_segmentation\" : \"off [fixed]\" , \"tx_gre_csum_segmentation\" : \"off [fixed]\" , \"tx_gre_segmentation\" : \"off [fixed]\" , \"tx_gso_partial\" : \"off [fixed]\" , \"tx_gso_robust\" : \"off [fixed]\" , \"tx_ipxip4_segmentation\" : \"off [fixed]\" , \"tx_ipxip6_segmentation\" : \"off [fixed]\" , \"tx_lockless\" : \"on [fixed]\" , \"tx_nocache_copy\" : \"off [fixed]\" , \"tx_scatter_gather\" : \"on [fixed]\" , \"tx_scatter_gather_fraglist\" : \"on [fixed]\" , \"tx_sctp_segmentation\" : \"on\" , \"tx_tcp6_segmentation\" : \"on\" , \"tx_tcp_ecn_segmentation\" : \"on\" , \"tx_tcp_mangleid_segmentation\" : \"on\" , \"tx_tcp_segmentation\" : \"on\" , \"tx_udp_segmentation\" : \"off [fixed]\" , \"tx_udp_tnl_csum_segmentation\" : \"off [fixed]\" , \"tx_udp_tnl_segmentation\" : \"off [fixed]\" , \"tx_vlan_offload\" : \"off [fixed]\" , \"tx_vlan_stag_hw_insert\" : \"off [fixed]\" , \"udp_fragmentation_offload\" : \"off\" , \"vlan_challenged\" : \"on [fixed]\" }, \"hw_timestamp_filters\" : [], \"ipv4\" : { \"address\" : \"127.0.0.1\" , \"broadcast\" : \"host\" , \"netmask\" : \"255.0.0.0\" , \"network\" : \"127.0.0.0\" }, \"ipv6\" : [ { \"address\" : \"::1\" , \"prefix\" : \"128\" , \"scope\" : \"host\" } ], \"mtu\" : 65536 , \"promisc\" : false , \"timestamping\" : [ \"tx_software\" , \"rx_software\" , \"software\" ], \"type\" : \"loopback\" }, \"ansible_local\" : { \"hello\" : { \"test\" : { \"h\" : \"hello\" , \"p\" : \"world\" } }, \"test\" : { \"test\" : { \"h\" : \"hello\" , \"p\" : \"world\" } } }, \"ansible_lsb\" : {}, \"ansible_machine\" : \"x86_64\" , \"ansible_machine_id\" : \"c6e2cb0cdbad41f19c30d690896aabe0\" , \"ansible_memfree_mb\" : 476 , \"ansible_memory_mb\" : { \"nocache\" : { \"free\" : 695 , \"used\" : 265 }, \"real\" : { \"free\" : 476 , \"total\" : 960 , \"used\" : 484 }, \"swap\" : { \"cached\" : 0 , \"free\" : 10239 , \"total\" : 10239 , \"used\" : 0 } }, \"ansible_memtotal_mb\" : 960 , \"ansible_mounts\" : [ { \"block_available\" : 10389 , \"block_size\" : 4096 , \"block_total\" : 50345 , \"block_used\" : 39956 , \"device\" : \"/dev/sda1\" , \"fstype\" : \"xfs\" , \"inode_available\" : 83285 , \"inode_total\" : 83624 , \"inode_used\" : 339 , \"mount\" : \"/boot\" , \"options\" : \"rw,relatime,attr2,inode64,noquota\" , \"size_available\" : 42553344 , \"size_total\" : 206213120 , \"uuid\" : \"93556f71-6dad-4761-9207-edee35d47129\" }, { \"block_available\" : 7234718 , \"block_size\" : 4096 , \"block_total\" : 7809050 , \"block_used\" : 574332 , \"device\" : \"/dev/sda3\" , \"fstype\" : \"xfs\" , \"inode_available\" : 15558107 , \"inode_total\" : 15625728 , \"inode_used\" : 67621 , \"mount\" : \"/\" , \"options\" : \"rw,relatime,attr2,inode64,noquota\" , \"size_available\" : 29633404928 , \"size_total\" : 31985868800 , \"uuid\" : \"a7d49533-e756-4a71-a977-5efb174eb09c\" } ], \"ansible_nodename\" : \"node130\" , \"ansible_os_family\" : \"RedHat\" , \"ansible_pkg_mgr\" : \"yum\" , \"ansible_proc_cmdline\" : { \"BOOT_IMAGE\" : \"/vmlinuz-5.1.11-1.el7.elrepo.x86_64\" , \"crashkernel\" : \"auto\" , \"quiet\" : true , \"rhgb\" : true , \"ro\" : true , \"root\" : \"UUID=a7d49533-e756-4a71-a977-5efb174eb09c\" , \"user_namespace.enable\" : \"1\" }, \"ansible_processor\" : [ \"0\" , \"GenuineIntel\" , \"Intel(R) Core(TM) i3-4160 CPU @ 3.60GHz\" ], \"ansible_processor_cores\" : 1 , \"ansible_processor_count\" : 1 , \"ansible_processor_threads_per_core\" : 1 , \"ansible_processor_vcpus\" : 1 , \"ansible_product_name\" : \"VMware Virtual Platform\" , \"ansible_product_serial\" : \"VMware-56 4d 4b f0 c3 97 be 18-aa c9 56 08 cb 88 01 c0\" , \"ansible_product_uuid\" : \"f04b4d56-97c3-18be-aac9-5608cb8801c0\" , \"ansible_product_version\" : \"None\" , \"ansible_python\" : { \"executable\" : \"/usr/bin/python\" , \"has_sslcontext\" : true , \"type\" : \"CPython\" , \"version\" : { \"major\" : 2 , \"micro\" : 5 , \"minor\" : 7 , \"releaselevel\" : \"final\" , \"serial\" : 0 }, \"version_info\" : [ 2 , 7 , 5 , \"final\" , 0 ] }, \"ansible_python_version\" : \"2.7.5\" , \"ansible_real_group_id\" : 0 , \"ansible_real_user_id\" : 0 , \"ansible_selinux\" : { \"status\" : \"disabled\" }, \"ansible_selinux_python_present\" : true , \"ansible_service_mgr\" : \"systemd\" , \"ansible_ssh_host_key_ecdsa_public\" : \"AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBK2zovckFKduH7EsvGaWar2mA+LdC4kTjgFG4h9RQlxZ1v5kEPx8Bs7jWnj94Cd8lY8BGb7RU7akUFpq3V59WIY=\" , \"ansible_ssh_host_key_ed25519_public\" : \"AAAAC3NzaC1lZDI1NTE5AAAAIEgM8JK59UtnryS0IhtNoPJHbOSqy7Xy2jExPYMvAex5\" , \"ansible_ssh_host_key_rsa_public\" : \"AAAAB3NzaC1yc2EAAAADAQABAAABAQDfNgNsUWXmYOD7Iz94nO98XRmw4dWKREbxWz6rZBP2QHYFN38nzdo9h5UT4HMuUM/FraPwwbfPubznNgn0/cXfMkqu8JIssxizpIRBZv82HFqwHTYRvkFAEII8ftkHs2RVlq64+ljPZzWvGL14nkfU7P+kc8Ym4jZGtorKRBoHFCeu67fycmZSCLFJxkKSumOaZ9TbNzP6bziyfmdDIGfj8UgzJRSuBW+B5XNeJp/QtsQZTjgpxSZZ9QRf/FeRx1NDR5Si91Fkd0NILIgoOSz536lP+aCCUOx7ukaoV1T/kyUKOj8a3wpBGiBWWZUGZa6O02Ig0eHnx8F4lZ2iOnNN\" , \"ansible_swapfree_mb\" : 10239 , \"ansible_swaptotal_mb\" : 10239 , \"ansible_system\" : \"Linux\" , \"ansible_system_capabilities\" : [ \"cap_chown\" , \"cap_dac_override\" , \"cap_dac_read_search\" , \"cap_fowner\" , \"cap_fsetid\" , \"cap_kill\" , \"cap_setgid\" , \"cap_setuid\" , \"cap_setpcap\" , \"cap_linux_immutable\" , \"cap_net_bind_service\" , \"cap_net_broadcast\" , \"cap_net_admin\" , \"cap_net_raw\" , \"cap_ipc_lock\" , \"cap_ipc_owner\" , \"cap_sys_module\" , \"cap_sys_rawio\" , \"cap_sys_chroot\" , \"cap_sys_ptrace\" , \"cap_sys_pacct\" , \"cap_sys_admin\" , \"cap_sys_boot\" , \"cap_sys_nice\" , \"cap_sys_resource\" , \"cap_sys_time\" , \"cap_sys_tty_config\" , \"cap_mknod\" , \"cap_lease\" , \"cap_audit_write\" , \"cap_audit_control\" , \"cap_setfcap\" , \"cap_mac_override\" , \"cap_mac_admin\" , \"cap_syslog\" , \"35\" , \"36\" , \"37+ep\" ], \"ansible_system_capabilities_enforced\" : \"True\" , \"ansible_system_vendor\" : \"VMware, Inc.\" , \"ansible_uptime_seconds\" : 4004 , \"ansible_user_dir\" : \"/root\" , \"ansible_user_gecos\" : \"root\" , \"ansible_user_gid\" : 0 , \"ansible_user_id\" : \"root\" , \"ansible_user_shell\" : \"/bin/bash\" , \"ansible_user_uid\" : 0 , \"ansible_userspace_architecture\" : \"x86_64\" , \"ansible_userspace_bits\" : \"64\" , \"ansible_virtualization_role\" : \"guest\" , \"ansible_virtualization_type\" : \"VMware\" , \"gather_subset\" : [ \"all\" ], \"module_setup\" : true } \u5176\u4e2d\u8f83\u4e3a\u5e38\u7528\u7684\u53d8\u91cf ansible_distribution ansible_distribution_release ansible_distribution_version ansible_fqdn ansible_hostname ansible_os_family ansible_pkg_mgr ansible_default_ipv4.address ansible_default_ipv6.address \u7f13\u5b58Facts\u4fe1\u606f \u00b6 Facts\u4fe1\u606f\u9ed8\u8ba4\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u5373\u6bcf\u6b21\u8fd0\u884c\u540e\uff0c\u4fe1\u606f\u5c31\u4e0d\u4f1a\u5b58\u5728\u4e86\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u6211\u4eec\u6bcf\u6b21\u90fd\u9700\u8981\u91cd\u65b0\u53bb\u83b7\u53d6\u4e3b\u673a\u7684\u6240\u6709Facts\u4fe1\u606f\uff0c\u6d6a\u8d39\u4e86\u5f88\u591a\u65f6\u95f4\uff0cFacts\u7ed9\u4e86\u51e0\u79cd\u7f13\u5b58\u65b9\u5f0f\u3002 \u4f7f\u7528\u6587\u4ef6\u4f5c\u4e3a\u7f13\u5b58 \u00b6 \u521b\u5efa\u7f13\u5b58\u5b58\u653e\u7684\u76ee\u5f55 mkdir /tmp/facts_cache \u4fee\u6539ansible\u914d\u7f6e\u6587\u4ef6 # /etc/ansible/ansible.cfg gathering = smart fact_caching = jsonfile fact_caching_timeout = 86400 fact_caching_connection = /tmp/facts_cache \u83b7\u53d6\u4e3b\u673a\u7684Facts\u4fe1\u606f ansible 192 .168.77.130 -m setup \u67e5\u770b\u7f13\u5b58\u76ee\u5f55 ll /tmp/facts_cache/ \u603b\u7528\u91cf 28 -rw-r--r-- 1 root root 25241 3\u6708 31 11 :39 192 .168.77.130 \u4e0a\u8ff0\u6587\u4ef6\u4e2d\u5b58\u50a8\u7740json\u5e8f\u5217\u5316\u7684facts\u6570\u636e \u4f7f\u7528redis\u4f5c\u4e3a\u7f13\u5b58 \u00b6 \u5b89\u88c5redis # centos 7 yum -y install redis easy_install pip pip install redis \u914d\u7f6eredis\uff0c\u4f7f\u7528\u5bc6\u7801\u767b\u9646 echo 'requirepass \"admin\"' > /etc/redis.conf \u542f\u52a8redis systemctl enable --now redis \u4fee\u6539ansible\u914d\u7f6e\u6587\u4ef6 # /etc/ansible/ansible.cfg gathering = smart fact_caching = redis fact_caching_timeout = 86400 fact_caching_connection = localhost:6379:0:admin \u83b7\u53d6\u4e3b\u673a\u7684Facts\u4fe1\u606f ansible 192 .168.77.130 -m setup \u67e5\u770bredis\u5185\u5bb9 # redis-cli 127 .0.0.1:6379> auth admin OK 127 .0.0.1:6379> keys * 1 ) \"ansible_cache_keys\" 2 ) \"ansible_facts192.168.77.130\" 127 .0.0.1:6379> get ansible_facts192.168.77.130 ..... \u4f7f\u7528memcached\u4f5c\u4e3a\u7f13\u5b58 \u00b6 \u5b89\u88c5 memcached # centos 7 yum install memcached easy_install pip pip install python-memcached \u542f\u52a8memcached systemctl enable --now memcached \u4fee\u6539ansible\u914d\u7f6e\u6587\u4ef6 # /etc/ansible/ansible.cfg gathering = smart fact_caching = memcached fact_caching_timeout = 86400 fact_caching_connection = localhost:11211 \u83b7\u53d6\u4e3b\u673a\u7684Facts\u4fe1\u606f ansible 192 .168.77.130 -m setup \u67e5\u770bmemcached\u5185\u5bb9 # telnet 127.0.0.1 11211 Trying 127 .0.0.1... Connected to 127 .0.0.1. Escape character is '^]' . stats items STAT items:3:number 1 STAT items:3:age 135 STAT items:3:evicted 0 STAT items:3:evicted_nonzero 0 STAT items:3:evicted_time 0 STAT items:3:outofmemory 0 STAT items:3:tailrepairs 0 STAT items:3:reclaimed 0 STAT items:3:expired_unfetched 0 STAT items:3:evicted_unfetched 0 STAT items:21:number 1 STAT items:21:age 135 STAT items:21:evicted 0 STAT items:21:evicted_nonzero 0 STAT items:21:evicted_time 0 STAT items:21:outofmemory 0 STAT items:21:tailrepairs 0 STAT items:21:reclaimed 0 STAT items:21:expired_unfetched 0 STAT items:21:evicted_unfetched 0 END stats cachedump 3 0 ITEM ansible_cache_keys [ 46 b ; 1585626688 s ] END stats cachedump 21 0 ITEM ansible_facts192.168.77.130 [ 8349 b ; 1585713251 s ] END \u5237\u65b0\u7f13\u5b58 \u00b6 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u5b58\u7684\u751f\u5b58\u65f6\u95f4\u662f fact_caching_timeout \u63a7\u5236\u7684\uff0c\u5982\u679c\u6211\u4eec\u60f3\u5f3a\u5236\u5237\u65b0\u7f13\u5b58\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528 --flush-cache \u9009\u9879 ansible-playbook --flush-cache /etc/ansible/test3.yaml","title":"11. Facts \u6570\u636e"},{"location":"basic/Facts/#11-facts","text":"Facts\u4e3b\u8981\u662f\u7528\u6765\u91c7\u96c6\u76ee\u6807\u7cfb\u7edf\u4fe1\u606f\u7684\uff0c\u91c7\u96c6\u5230\u4fe1\u606f\u5b58\u50a8\u5728 ansible_facts \u53d8\u91cf\u4e2d\uff0c\u4e5f\u6709\u8bb8\u591a\u4fe1\u606f\u5b58\u50a8\u5728\u4ee5 ansible_ \u5f00\u5934\u7684\u53d8\u91cf\u3002","title":"11. Facts \u6570\u636e"},{"location":"basic/Facts/#facts","text":"","title":"\u83b7\u53d6Facts\u4fe1\u606f"},{"location":"basic/Facts/#setup","text":"\u53ef\u4ee5\u4f7f\u7528 setup \u6a21\u5757\u624b\u52a8\u7684\u83b7\u53d6\u76ee\u6807\u7cfb\u7edf\u4fe1\u606f ansible hostname -m setup \u5411 setup \u6a21\u5757\u4f20\u9012 filter \u9009\u9879\uff0c\u5c31\u53ef\u4ee5\u9009\u62e9\u83b7\u53d6\u54ea\u4e9b\u5185\u5bb9\uff0c\u4f8b\u5982\u4ec5\u663e\u793a\u4e0eansible\u76f8\u5173\u7684\u5185\u5b58\u4fe1\u606f ansible all -m setup -a 'filter=ansible_*_mb'","title":"\u4f7f\u7528setup\u6a21\u5757\u6765\u83b7\u53d6\u76ee\u6807\u7cfb\u7edf\u4fe1\u606f"},{"location":"basic/Facts/#playbook","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cplaybook\u7684\u7b2c\u4e00\u4e2a\u4efb\u52a1\u5c31\u662f Facts \u4fe1\u606f\uff0c\u663e\u793a\u7684\u7ed3\u679c\u5982\u4e0b: PLAY [192.168.77.130] ****************************************** TASK [Gathering Facts] **************************************************************** ok : [ 192.168.77.130 ] TASK [test] **************************************************** changed : [ 192.168.77.130 ] \u5982\u679c\u8981\u5173\u95edplaybook\u7684\u8fd9\u4e00\u64cd\u4f5c\uff0c\u5c31\u9700\u8981\u4e3aplay\u6dfb\u52a0 gather_facts \u5173\u952e\u5b57 # \u5173\u95ed\u5173\u95ed\u81ea\u52a8\u91c7\u96c6Facts - hosts : whatever gather_facts : no \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u662f\u6536\u96c6\u6240\u6709\u7684facts\u4fe1\u606f\uff0c\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539ansible\u914d\u7f6e\u6587\u4ef6\u6765\u8fbe\u5230\u53ea\u83b7\u53d6\u67d0\u4e00\u7c7b\u578b\u7684\u4fe1\u606f # /etc/ansible/ansible.cfg # all - \u6536\u96c6\u6240\u6709\u5b50\u96c6\uff0c\u9ed8\u8ba4 # network - \u6536\u96c6\u7f51\u7edc\u4fe1\u606f\u5b50\u96c6 # hardware - \u6536\u96c6\u786c\u4ef6\u4fe1\u606f\u5b50\u96c6 # virtual - \u6536\u96c6\u865a\u62df\u76f8\u5173\u7684\u4fe1\u606f # facter - \u6536\u96c6\u81ea\u5b9a\u4e49\u7684fact\u4fe1\u606f # ohai - \u6536\u96c6ohai\u4fe1\u606f # \u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u5b50\u96c6 (ex: network,virtual) # \u53ef\u4ee5\u6392\u9664\u5b50\u96c6 (ex: !hardware,!facter,!ohai) gather_subset = all","title":"\u4f7f\u7528playbook\u6765\u83b7\u53d6\u76ee\u6807\u7cfb\u7edf\u4fe1\u606f"},{"location":"basic/Facts/#taskfacts","text":"\u53ef\u4ee5\u4f7f\u7528 set_fact \u6765\u8bbe\u7f6e\u5f53\u524d\u8fd0\u884c\u4e3b\u673a\u7684facts\u4fe1\u606f - hosts : hostname tasks : - command : whoami register : result - set_fact : one : \"{{ result.stdout }}\" two : true - debug : var=one - debug : var=two","title":"\u5728task\u4e2d\u8bbe\u7f6efacts\u4fe1\u606f"},{"location":"basic/Facts/#facts_1","text":"\u5728\u8fdc\u7a0b\u4e3b\u673a/etc/ansible/facts.d/\u76ee\u5f55\u4e0b\u521b\u5efa.fact \u7ed3\u5c3e\u7684\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u662fjson\u3001ini \u6216\u8005\u8fd4\u56dejson \u683c\u5f0f\u6570\u636e\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u8fd9\u4e9b\u5c06\u88ab\u4f5c\u4e3a\u8fdc\u7a0b\u4e3b\u673a\u672c\u5730\u7684facts \u6267\u884c \u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u64cd\u4f5c mkdir -p /etc/ansible/facts.d cat << EOF > /etc/ansible/facts.d/hello.fact [test] h=hello p=world EOF \u5728ansible\u63a7\u5236\u8282\u70b9\u4e0a\u64cd\u4f5c \u8fdc\u7a0b\u4e3b\u673a\u7684\u81ea\u5b9a\u4e49facts\u4fe1\u606f\uff0c\u5b58\u50a8\u5728 ansible_local \u53d8\u91cf\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 setup \u6a21\u5757\u8fc7\u6ee4\u83b7\u53d6 ansible 192 .168.77.130 -m setup -a \"filter=ansible_local\" 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"ansible_local\" : { \"hello\" : { \"test\" : { \"h\" : \"hello\" , \"p\" : \"world\" } } } , \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false } \u4e5f\u53ef\u4ee5\u901a\u8fc7\u5728\u4efb\u52a1\u4e2d\u4f7f\u7528 {{ ansible_local.hello }} \u7684\u65b9\u5f0f\u8bbf\u95ee\u8be5\u53d8\u91cf --- - hosts: 192 .168.77.130 tasks: - debug: var = ansible_local.hello - debug: var = ansible_local.hello.test.h \u5f53\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e0a\u9762\u7684\u6b65\u9aa4\uff0c\u901a\u8fc7playbook\u6765\u5b9e\u73b0 \u8fd0\u7528playbook \u5b9a\u4e49\u8fdc\u7aeffacts.d\uff0c\u5e76\u52a0\u8f7d\u5230fact\u4e2d - hosts : node1 tasks : - name : create directory for ansible custom facts file : state=directory recurse=yes path=/etc/ansible/facts.d - name : install custom test fact copy : content : | [test] h=hello p=world dest : /etc/ansible/facts.d/test.fact - name : re-read facts after adding custom fact setup : filter=ansible_local - name : ansible_local vars debug : var=ansible_local","title":"\u81ea\u5b9a\u4e49\u76ee\u6807\u7cfb\u7edffacts"},{"location":"basic/Facts/#facts_2","text":"\u4ee5 ansible 2.9.1 \u7248\u672c\u8fd4\u56de centos 7 \u7cfb\u7edf\u7684Facts\u4fe1\u606f \"ansible_facts\" : { \"ansible_all_ipv4_addresses\" : [ \"192.168.77.130\" , \"172.17.0.1\" ], \"ansible_all_ipv6_addresses\" : [ \"fe80::6d73:3667:2ed6:a7c2\" , \"fe80::4d03:8744:2f0d:2085\" ], \"ansible_apparmor\" : { \"status\" : \"disabled\" }, \"ansible_architecture\" : \"x86_64\" , \"ansible_bios_date\" : \"07/29/2019\" , \"ansible_bios_version\" : \"6.00\" , \"ansible_cmdline\" : { \"BOOT_IMAGE\" : \"/vmlinuz-5.1.11-1.el7.elrepo.x86_64\" , \"crashkernel\" : \"auto\" , \"quiet\" : true , \"rhgb\" : true , \"ro\" : true , \"root\" : \"UUID=a7d49533-e756-4a71-a977-5efb174eb09c\" , \"user_namespace.enable\" : \"1\" }, \"ansible_date_time\" : { \"date\" : \"2020-03-31\" , \"day\" : \"31\" , \"epoch\" : \"1585627320\" , \"hour\" : \"12\" , \"iso8601\" : \"2020-03-31T04:02:00Z\" , \"iso8601_basic\" : \"20200331T120200260891\" , \"iso8601_basic_short\" : \"20200331T120200\" , \"iso8601_micro\" : \"2020-03-31T04:02:00.260966Z\" , \"minute\" : \"02\" , \"month\" : \"03\" , \"second\" : \"00\" , \"time\" : \"12:02:00\" , \"tz\" : \"CST\" , \"tz_offset\" : \"+0800\" , \"weekday\" : \"\u661f\u671f\u4e8c\" , \"weekday_number\" : \"2\" , \"weeknumber\" : \"13\" , \"year\" : \"2020\" }, \"ansible_default_ipv4\" : { \"address\" : \"192.168.77.130\" , \"alias\" : \"ens33\" , \"broadcast\" : \"192.168.77.255\" , \"gateway\" : \"192.168.77.2\" , \"interface\" : \"ens33\" , \"macaddress\" : \"00:0c:29:88:01:c0\" , \"mtu\" : 1500 , \"netmask\" : \"255.255.255.0\" , \"network\" : \"192.168.77.0\" , \"type\" : \"ether\" }, \"ansible_default_ipv6\" : {}, \"ansible_device_links\" : { \"ids\" : { \"sr0\" : [ \"ata-VMware_Virtual_IDE_CDROM_Drive_10000000000000000001\" ] }, \"labels\" : {}, \"masters\" : {}, \"uuids\" : { \"sda1\" : [ \"93556f71-6dad-4761-9207-edee35d47129\" ], \"sda2\" : [ \"0c0f8a5a-58dd-4fc6-a49e-fc5e63f5d8a3\" ], \"sda3\" : [ \"a7d49533-e756-4a71-a977-5efb174eb09c\" ] } }, \"ansible_devices\" : { \"sda\" : { \"holders\" : [], \"host\" : \"SCSI storage controller: LSI Logic / Symbios Logic 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI (rev 01)\" , \"links\" : { \"ids\" : [], \"labels\" : [], \"masters\" : [], \"uuids\" : [] }, \"model\" : \"VMware Virtual S\" , \"partitions\" : { \"sda1\" : { \"holders\" : [], \"links\" : { \"ids\" : [], \"labels\" : [], \"masters\" : [], \"uuids\" : [ \"93556f71-6dad-4761-9207-edee35d47129\" ] }, \"sectors\" : \"409600\" , \"sectorsize\" : 512 , \"size\" : \"200.00 MB\" , \"start\" : \"2048\" , \"uuid\" : \"93556f71-6dad-4761-9207-edee35d47129\" }, \"sda2\" : { \"holders\" : [], \"links\" : { \"ids\" : [], \"labels\" : [], \"masters\" : [], \"uuids\" : [ \"0c0f8a5a-58dd-4fc6-a49e-fc5e63f5d8a3\" ] }, \"sectors\" : \"20971520\" , \"sectorsize\" : 512 , \"size\" : \"10.00 GB\" , \"start\" : \"411648\" , \"uuid\" : \"0c0f8a5a-58dd-4fc6-a49e-fc5e63f5d8a3\" }, \"sda3\" : { \"holders\" : [], \"links\" : { \"ids\" : [], \"labels\" : [], \"masters\" : [], \"uuids\" : [ \"a7d49533-e756-4a71-a977-5efb174eb09c\" ] }, \"sectors\" : \"62502912\" , \"sectorsize\" : 512 , \"size\" : \"29.80 GB\" , \"start\" : \"21383168\" , \"uuid\" : \"a7d49533-e756-4a71-a977-5efb174eb09c\" } }, \"removable\" : \"0\" , \"rotational\" : \"1\" , \"sas_address\" : null , \"sas_device_handle\" : null , \"scheduler_mode\" : \"mq-deadline\" , \"sectors\" : \"83886080\" , \"sectorsize\" : \"512\" , \"size\" : \"40.00 GB\" , \"support_discard\" : \"0\" , \"vendor\" : \"VMware,\" , \"virtual\" : 1 }, \"sr0\" : { \"holders\" : [], \"host\" : \"IDE interface: Intel Corporation 82371AB/EB/MB PIIX4 IDE (rev 01)\" , \"links\" : { \"ids\" : [ \"ata-VMware_Virtual_IDE_CDROM_Drive_10000000000000000001\" ], \"labels\" : [], \"masters\" : [], \"uuids\" : [] }, \"model\" : \"VMware IDE CDR10\" , \"partitions\" : {}, \"removable\" : \"1\" , \"rotational\" : \"1\" , \"sas_address\" : null , \"sas_device_handle\" : null , \"scheduler_mode\" : \"mq-deadline\" , \"sectors\" : \"2097151\" , \"sectorsize\" : \"512\" , \"size\" : \"1024.00 MB\" , \"support_discard\" : \"0\" , \"vendor\" : \"NECVMWar\" , \"virtual\" : 1 } }, \"ansible_distribution\" : \"CentOS\" , \"ansible_distribution_file_parsed\" : true , \"ansible_distribution_file_path\" : \"/etc/redhat-release\" , \"ansible_distribution_file_variety\" : \"RedHat\" , \"ansible_distribution_major_version\" : \"7\" , \"ansible_distribution_release\" : \"Core\" , \"ansible_distribution_version\" : \"7.6\" , \"ansible_dns\" : { \"nameservers\" : [ \"192.168.77.2\" ] }, \"ansible_docker0\" : { \"active\" : false , \"device\" : \"docker0\" , \"features\" : { \"esp_hw_offload\" : \"off [fixed]\" , \"esp_tx_csum_hw_offload\" : \"off [fixed]\" , \"fcoe_mtu\" : \"off [fixed]\" , \"generic_receive_offload\" : \"on\" , \"generic_segmentation_offload\" : \"on\" , \"highdma\" : \"on\" , \"hw_tc_offload\" : \"off [fixed]\" , \"l2_fwd_offload\" : \"off [fixed]\" , \"large_receive_offload\" : \"off [fixed]\" , \"loopback\" : \"off [fixed]\" , \"netns_local\" : \"on [fixed]\" , \"ntuple_filters\" : \"off [fixed]\" , \"receive_hashing\" : \"off [fixed]\" , \"rx_all\" : \"off [fixed]\" , \"rx_checksumming\" : \"off [fixed]\" , \"rx_fcs\" : \"off [fixed]\" , \"rx_gro_hw\" : \"off [fixed]\" , \"rx_udp_tunnel_port_offload\" : \"off [fixed]\" , \"rx_vlan_filter\" : \"off [fixed]\" , \"rx_vlan_offload\" : \"off [fixed]\" , \"rx_vlan_stag_filter\" : \"off [fixed]\" , \"rx_vlan_stag_hw_parse\" : \"off [fixed]\" , \"scatter_gather\" : \"on\" , \"tcp_segmentation_offload\" : \"on\" , \"tls_hw_record\" : \"off [fixed]\" , \"tls_hw_rx_offload\" : \"off [fixed]\" , \"tls_hw_tx_offload\" : \"off [fixed]\" , \"tx_checksum_fcoe_crc\" : \"off [fixed]\" , \"tx_checksum_ip_generic\" : \"on\" , \"tx_checksum_ipv4\" : \"off [fixed]\" , \"tx_checksum_ipv6\" : \"off [fixed]\" , \"tx_checksum_sctp\" : \"off [fixed]\" , \"tx_checksumming\" : \"on\" , \"tx_esp_segmentation\" : \"on\" , \"tx_fcoe_segmentation\" : \"on\" , \"tx_gre_csum_segmentation\" : \"on\" , \"tx_gre_segmentation\" : \"on\" , \"tx_gso_partial\" : \"on\" , \"tx_gso_robust\" : \"on\" , \"tx_ipxip4_segmentation\" : \"on\" , \"tx_ipxip6_segmentation\" : \"on\" , \"tx_lockless\" : \"on [fixed]\" , \"tx_nocache_copy\" : \"off\" , \"tx_scatter_gather\" : \"on\" , \"tx_scatter_gather_fraglist\" : \"on\" , \"tx_sctp_segmentation\" : \"on\" , \"tx_tcp6_segmentation\" : \"on\" , \"tx_tcp_ecn_segmentation\" : \"on\" , \"tx_tcp_mangleid_segmentation\" : \"on\" , \"tx_tcp_segmentation\" : \"on\" , \"tx_udp_segmentation\" : \"on\" , \"tx_udp_tnl_csum_segmentation\" : \"on\" , \"tx_udp_tnl_segmentation\" : \"on\" , \"tx_vlan_offload\" : \"on\" , \"tx_vlan_stag_hw_insert\" : \"on\" , \"udp_fragmentation_offload\" : \"off\" , \"vlan_challenged\" : \"off [fixed]\" }, \"hw_timestamp_filters\" : [], \"id\" : \"8000.024238d96cf4\" , \"interfaces\" : [], \"ipv4\" : { \"address\" : \"172.17.0.1\" , \"broadcast\" : \"172.17.255.255\" , \"netmask\" : \"255.255.0.0\" , \"network\" : \"172.17.0.0\" }, \"macaddress\" : \"02:42:38:d9:6c:f4\" , \"mtu\" : 1500 , \"promisc\" : false , \"stp\" : false , \"timestamping\" : [ \"rx_software\" , \"software\" ], \"type\" : \"bridge\" }, \"ansible_domain\" : \"\" , \"ansible_effective_group_id\" : 0 , \"ansible_effective_user_id\" : 0 , \"ansible_ens33\" : { \"active\" : true , \"device\" : \"ens33\" , \"features\" : { \"esp_hw_offload\" : \"off [fixed]\" , \"esp_tx_csum_hw_offload\" : \"off [fixed]\" , \"fcoe_mtu\" : \"off [fixed]\" , \"generic_receive_offload\" : \"on\" , \"generic_segmentation_offload\" : \"on\" , \"highdma\" : \"off [fixed]\" , \"hw_tc_offload\" : \"off [fixed]\" , \"l2_fwd_offload\" : \"off [fixed]\" , \"large_receive_offload\" : \"off [fixed]\" , \"loopback\" : \"off [fixed]\" , \"netns_local\" : \"off [fixed]\" , \"ntuple_filters\" : \"off [fixed]\" , \"receive_hashing\" : \"off [fixed]\" , \"rx_all\" : \"off\" , \"rx_checksumming\" : \"off\" , \"rx_fcs\" : \"off\" , \"rx_gro_hw\" : \"off [fixed]\" , \"rx_udp_tunnel_port_offload\" : \"off [fixed]\" , \"rx_vlan_filter\" : \"on [fixed]\" , \"rx_vlan_offload\" : \"on\" , \"rx_vlan_stag_filter\" : \"off [fixed]\" , \"rx_vlan_stag_hw_parse\" : \"off [fixed]\" , \"scatter_gather\" : \"on\" , \"tcp_segmentation_offload\" : \"on\" , \"tls_hw_record\" : \"off [fixed]\" , \"tls_hw_rx_offload\" : \"off [fixed]\" , \"tls_hw_tx_offload\" : \"off [fixed]\" , \"tx_checksum_fcoe_crc\" : \"off [fixed]\" , \"tx_checksum_ip_generic\" : \"on\" , \"tx_checksum_ipv4\" : \"off [fixed]\" , \"tx_checksum_ipv6\" : \"off [fixed]\" , \"tx_checksum_sctp\" : \"off [fixed]\" , \"tx_checksumming\" : \"on\" , \"tx_esp_segmentation\" : \"off [fixed]\" , \"tx_fcoe_segmentation\" : \"off [fixed]\" , \"tx_gre_csum_segmentation\" : \"off [fixed]\" , \"tx_gre_segmentation\" : \"off [fixed]\" , \"tx_gso_partial\" : \"off [fixed]\" , \"tx_gso_robust\" : \"off [fixed]\" , \"tx_ipxip4_segmentation\" : \"off [fixed]\" , \"tx_ipxip6_segmentation\" : \"off [fixed]\" , \"tx_lockless\" : \"off [fixed]\" , \"tx_nocache_copy\" : \"off\" , \"tx_scatter_gather\" : \"on\" , \"tx_scatter_gather_fraglist\" : \"off [fixed]\" , \"tx_sctp_segmentation\" : \"off [fixed]\" , \"tx_tcp6_segmentation\" : \"off [fixed]\" , \"tx_tcp_ecn_segmentation\" : \"off [fixed]\" , \"tx_tcp_mangleid_segmentation\" : \"off\" , \"tx_tcp_segmentation\" : \"on\" , \"tx_udp_segmentation\" : \"off [fixed]\" , \"tx_udp_tnl_csum_segmentation\" : \"off [fixed]\" , \"tx_udp_tnl_segmentation\" : \"off [fixed]\" , \"tx_vlan_offload\" : \"on [fixed]\" , \"tx_vlan_stag_hw_insert\" : \"off [fixed]\" , \"udp_fragmentation_offload\" : \"off\" , \"vlan_challenged\" : \"off [fixed]\" }, \"hw_timestamp_filters\" : [], \"ipv4\" : { \"address\" : \"192.168.77.130\" , \"broadcast\" : \"192.168.77.255\" , \"netmask\" : \"255.255.255.0\" , \"network\" : \"192.168.77.0\" }, \"ipv6\" : [ { \"address\" : \"fe80::6d73:3667:2ed6:a7c2\" , \"prefix\" : \"64\" , \"scope\" : \"link\" }, { \"address\" : \"fe80::4d03:8744:2f0d:2085\" , \"prefix\" : \"64\" , \"scope\" : \"link\" } ], \"macaddress\" : \"00:0c:29:88:01:c0\" , \"module\" : \"e1000\" , \"mtu\" : 1500 , \"pciid\" : \"0000:02:01.0\" , \"promisc\" : false , \"speed\" : 1000 , \"timestamping\" : [ \"tx_software\" , \"rx_software\" , \"software\" ], \"type\" : \"ether\" }, \"ansible_env\" : { \"HOME\" : \"/root\" , \"LANG\" : \"zh_CN.UTF-8\" , \"LESSOPEN\" : \"||/usr/bin/lesspipe.sh %s\" , \"LOGNAME\" : \"root\" , \"LS_COLORS\" : \"rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;36:*.au=01;36:*.flac=01;36:*.mid=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:*.xspf=01;36:\" , \"MAIL\" : \"/var/mail/root\" , \"PATH\" : \"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin\" , \"PWD\" : \"/root\" , \"SHELL\" : \"/bin/bash\" , \"SHLVL\" : \"2\" , \"SSH_CLIENT\" : \"192.168.77.128 46964 22\" , \"SSH_CONNECTION\" : \"192.168.77.128 46964 192.168.77.130 22\" , \"SSH_TTY\" : \"/dev/pts/1\" , \"TERM\" : \"linux\" , \"USER\" : \"root\" , \"XDG_RUNTIME_DIR\" : \"/run/user/0\" , \"XDG_SESSION_ID\" : \"22\" , \"_\" : \"/usr/bin/python\" }, \"ansible_fibre_channel_wwn\" : [], \"ansible_fips\" : false , \"ansible_form_factor\" : \"Other\" , \"ansible_fqdn\" : \"node130\" , \"ansible_hostname\" : \"node130\" , \"ansible_hostnqn\" : \"\" , \"ansible_interfaces\" : [ \"lo\" , \"docker0\" , \"ens33\" ], \"ansible_is_chroot\" : false , \"ansible_iscsi_iqn\" : \"\" , \"ansible_kernel\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"ansible_kernel_version\" : \"#1 SMP Mon Jun 17 15:51:08 EDT 2019\" , \"ansible_lo\" : { \"active\" : true , \"device\" : \"lo\" , \"features\" : { \"esp_hw_offload\" : \"off [fixed]\" , \"esp_tx_csum_hw_offload\" : \"off [fixed]\" , \"fcoe_mtu\" : \"off [fixed]\" , \"generic_receive_offload\" : \"on\" , \"generic_segmentation_offload\" : \"on\" , \"highdma\" : \"on [fixed]\" , \"hw_tc_offload\" : \"off [fixed]\" , \"l2_fwd_offload\" : \"off [fixed]\" , \"large_receive_offload\" : \"off [fixed]\" , \"loopback\" : \"on [fixed]\" , \"netns_local\" : \"on [fixed]\" , \"ntuple_filters\" : \"off [fixed]\" , \"receive_hashing\" : \"off [fixed]\" , \"rx_all\" : \"off [fixed]\" , \"rx_checksumming\" : \"on [fixed]\" , \"rx_fcs\" : \"off [fixed]\" , \"rx_gro_hw\" : \"off [fixed]\" , \"rx_udp_tunnel_port_offload\" : \"off [fixed]\" , \"rx_vlan_filter\" : \"off [fixed]\" , \"rx_vlan_offload\" : \"off [fixed]\" , \"rx_vlan_stag_filter\" : \"off [fixed]\" , \"rx_vlan_stag_hw_parse\" : \"off [fixed]\" , \"scatter_gather\" : \"on\" , \"tcp_segmentation_offload\" : \"on\" , \"tls_hw_record\" : \"off [fixed]\" , \"tls_hw_rx_offload\" : \"off [fixed]\" , \"tls_hw_tx_offload\" : \"off [fixed]\" , \"tx_checksum_fcoe_crc\" : \"off [fixed]\" , \"tx_checksum_ip_generic\" : \"on [fixed]\" , \"tx_checksum_ipv4\" : \"off [fixed]\" , \"tx_checksum_ipv6\" : \"off [fixed]\" , \"tx_checksum_sctp\" : \"on [fixed]\" , \"tx_checksumming\" : \"on\" , \"tx_esp_segmentation\" : \"off [fixed]\" , \"tx_fcoe_segmentation\" : \"off [fixed]\" , \"tx_gre_csum_segmentation\" : \"off [fixed]\" , \"tx_gre_segmentation\" : \"off [fixed]\" , \"tx_gso_partial\" : \"off [fixed]\" , \"tx_gso_robust\" : \"off [fixed]\" , \"tx_ipxip4_segmentation\" : \"off [fixed]\" , \"tx_ipxip6_segmentation\" : \"off [fixed]\" , \"tx_lockless\" : \"on [fixed]\" , \"tx_nocache_copy\" : \"off [fixed]\" , \"tx_scatter_gather\" : \"on [fixed]\" , \"tx_scatter_gather_fraglist\" : \"on [fixed]\" , \"tx_sctp_segmentation\" : \"on\" , \"tx_tcp6_segmentation\" : \"on\" , \"tx_tcp_ecn_segmentation\" : \"on\" , \"tx_tcp_mangleid_segmentation\" : \"on\" , \"tx_tcp_segmentation\" : \"on\" , \"tx_udp_segmentation\" : \"off [fixed]\" , \"tx_udp_tnl_csum_segmentation\" : \"off [fixed]\" , \"tx_udp_tnl_segmentation\" : \"off [fixed]\" , \"tx_vlan_offload\" : \"off [fixed]\" , \"tx_vlan_stag_hw_insert\" : \"off [fixed]\" , \"udp_fragmentation_offload\" : \"off\" , \"vlan_challenged\" : \"on [fixed]\" }, \"hw_timestamp_filters\" : [], \"ipv4\" : { \"address\" : \"127.0.0.1\" , \"broadcast\" : \"host\" , \"netmask\" : \"255.0.0.0\" , \"network\" : \"127.0.0.0\" }, \"ipv6\" : [ { \"address\" : \"::1\" , \"prefix\" : \"128\" , \"scope\" : \"host\" } ], \"mtu\" : 65536 , \"promisc\" : false , \"timestamping\" : [ \"tx_software\" , \"rx_software\" , \"software\" ], \"type\" : \"loopback\" }, \"ansible_local\" : { \"hello\" : { \"test\" : { \"h\" : \"hello\" , \"p\" : \"world\" } }, \"test\" : { \"test\" : { \"h\" : \"hello\" , \"p\" : \"world\" } } }, \"ansible_lsb\" : {}, \"ansible_machine\" : \"x86_64\" , \"ansible_machine_id\" : \"c6e2cb0cdbad41f19c30d690896aabe0\" , \"ansible_memfree_mb\" : 476 , \"ansible_memory_mb\" : { \"nocache\" : { \"free\" : 695 , \"used\" : 265 }, \"real\" : { \"free\" : 476 , \"total\" : 960 , \"used\" : 484 }, \"swap\" : { \"cached\" : 0 , \"free\" : 10239 , \"total\" : 10239 , \"used\" : 0 } }, \"ansible_memtotal_mb\" : 960 , \"ansible_mounts\" : [ { \"block_available\" : 10389 , \"block_size\" : 4096 , \"block_total\" : 50345 , \"block_used\" : 39956 , \"device\" : \"/dev/sda1\" , \"fstype\" : \"xfs\" , \"inode_available\" : 83285 , \"inode_total\" : 83624 , \"inode_used\" : 339 , \"mount\" : \"/boot\" , \"options\" : \"rw,relatime,attr2,inode64,noquota\" , \"size_available\" : 42553344 , \"size_total\" : 206213120 , \"uuid\" : \"93556f71-6dad-4761-9207-edee35d47129\" }, { \"block_available\" : 7234718 , \"block_size\" : 4096 , \"block_total\" : 7809050 , \"block_used\" : 574332 , \"device\" : \"/dev/sda3\" , \"fstype\" : \"xfs\" , \"inode_available\" : 15558107 , \"inode_total\" : 15625728 , \"inode_used\" : 67621 , \"mount\" : \"/\" , \"options\" : \"rw,relatime,attr2,inode64,noquota\" , \"size_available\" : 29633404928 , \"size_total\" : 31985868800 , \"uuid\" : \"a7d49533-e756-4a71-a977-5efb174eb09c\" } ], \"ansible_nodename\" : \"node130\" , \"ansible_os_family\" : \"RedHat\" , \"ansible_pkg_mgr\" : \"yum\" , \"ansible_proc_cmdline\" : { \"BOOT_IMAGE\" : \"/vmlinuz-5.1.11-1.el7.elrepo.x86_64\" , \"crashkernel\" : \"auto\" , \"quiet\" : true , \"rhgb\" : true , \"ro\" : true , \"root\" : \"UUID=a7d49533-e756-4a71-a977-5efb174eb09c\" , \"user_namespace.enable\" : \"1\" }, \"ansible_processor\" : [ \"0\" , \"GenuineIntel\" , \"Intel(R) Core(TM) i3-4160 CPU @ 3.60GHz\" ], \"ansible_processor_cores\" : 1 , \"ansible_processor_count\" : 1 , \"ansible_processor_threads_per_core\" : 1 , \"ansible_processor_vcpus\" : 1 , \"ansible_product_name\" : \"VMware Virtual Platform\" , \"ansible_product_serial\" : \"VMware-56 4d 4b f0 c3 97 be 18-aa c9 56 08 cb 88 01 c0\" , \"ansible_product_uuid\" : \"f04b4d56-97c3-18be-aac9-5608cb8801c0\" , \"ansible_product_version\" : \"None\" , \"ansible_python\" : { \"executable\" : \"/usr/bin/python\" , \"has_sslcontext\" : true , \"type\" : \"CPython\" , \"version\" : { \"major\" : 2 , \"micro\" : 5 , \"minor\" : 7 , \"releaselevel\" : \"final\" , \"serial\" : 0 }, \"version_info\" : [ 2 , 7 , 5 , \"final\" , 0 ] }, \"ansible_python_version\" : \"2.7.5\" , \"ansible_real_group_id\" : 0 , \"ansible_real_user_id\" : 0 , \"ansible_selinux\" : { \"status\" : \"disabled\" }, \"ansible_selinux_python_present\" : true , \"ansible_service_mgr\" : \"systemd\" , \"ansible_ssh_host_key_ecdsa_public\" : \"AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBK2zovckFKduH7EsvGaWar2mA+LdC4kTjgFG4h9RQlxZ1v5kEPx8Bs7jWnj94Cd8lY8BGb7RU7akUFpq3V59WIY=\" , \"ansible_ssh_host_key_ed25519_public\" : \"AAAAC3NzaC1lZDI1NTE5AAAAIEgM8JK59UtnryS0IhtNoPJHbOSqy7Xy2jExPYMvAex5\" , \"ansible_ssh_host_key_rsa_public\" : \"AAAAB3NzaC1yc2EAAAADAQABAAABAQDfNgNsUWXmYOD7Iz94nO98XRmw4dWKREbxWz6rZBP2QHYFN38nzdo9h5UT4HMuUM/FraPwwbfPubznNgn0/cXfMkqu8JIssxizpIRBZv82HFqwHTYRvkFAEII8ftkHs2RVlq64+ljPZzWvGL14nkfU7P+kc8Ym4jZGtorKRBoHFCeu67fycmZSCLFJxkKSumOaZ9TbNzP6bziyfmdDIGfj8UgzJRSuBW+B5XNeJp/QtsQZTjgpxSZZ9QRf/FeRx1NDR5Si91Fkd0NILIgoOSz536lP+aCCUOx7ukaoV1T/kyUKOj8a3wpBGiBWWZUGZa6O02Ig0eHnx8F4lZ2iOnNN\" , \"ansible_swapfree_mb\" : 10239 , \"ansible_swaptotal_mb\" : 10239 , \"ansible_system\" : \"Linux\" , \"ansible_system_capabilities\" : [ \"cap_chown\" , \"cap_dac_override\" , \"cap_dac_read_search\" , \"cap_fowner\" , \"cap_fsetid\" , \"cap_kill\" , \"cap_setgid\" , \"cap_setuid\" , \"cap_setpcap\" , \"cap_linux_immutable\" , \"cap_net_bind_service\" , \"cap_net_broadcast\" , \"cap_net_admin\" , \"cap_net_raw\" , \"cap_ipc_lock\" , \"cap_ipc_owner\" , \"cap_sys_module\" , \"cap_sys_rawio\" , \"cap_sys_chroot\" , \"cap_sys_ptrace\" , \"cap_sys_pacct\" , \"cap_sys_admin\" , \"cap_sys_boot\" , \"cap_sys_nice\" , \"cap_sys_resource\" , \"cap_sys_time\" , \"cap_sys_tty_config\" , \"cap_mknod\" , \"cap_lease\" , \"cap_audit_write\" , \"cap_audit_control\" , \"cap_setfcap\" , \"cap_mac_override\" , \"cap_mac_admin\" , \"cap_syslog\" , \"35\" , \"36\" , \"37+ep\" ], \"ansible_system_capabilities_enforced\" : \"True\" , \"ansible_system_vendor\" : \"VMware, Inc.\" , \"ansible_uptime_seconds\" : 4004 , \"ansible_user_dir\" : \"/root\" , \"ansible_user_gecos\" : \"root\" , \"ansible_user_gid\" : 0 , \"ansible_user_id\" : \"root\" , \"ansible_user_shell\" : \"/bin/bash\" , \"ansible_user_uid\" : 0 , \"ansible_userspace_architecture\" : \"x86_64\" , \"ansible_userspace_bits\" : \"64\" , \"ansible_virtualization_role\" : \"guest\" , \"ansible_virtualization_type\" : \"VMware\" , \"gather_subset\" : [ \"all\" ], \"module_setup\" : true } \u5176\u4e2d\u8f83\u4e3a\u5e38\u7528\u7684\u53d8\u91cf ansible_distribution ansible_distribution_release ansible_distribution_version ansible_fqdn ansible_hostname ansible_os_family ansible_pkg_mgr ansible_default_ipv4.address ansible_default_ipv6.address","title":"Facts \u8fd4\u56de\u7684\u4fe1\u606f"},{"location":"basic/Facts/#facts_3","text":"Facts\u4fe1\u606f\u9ed8\u8ba4\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u5373\u6bcf\u6b21\u8fd0\u884c\u540e\uff0c\u4fe1\u606f\u5c31\u4e0d\u4f1a\u5b58\u5728\u4e86\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u6211\u4eec\u6bcf\u6b21\u90fd\u9700\u8981\u91cd\u65b0\u53bb\u83b7\u53d6\u4e3b\u673a\u7684\u6240\u6709Facts\u4fe1\u606f\uff0c\u6d6a\u8d39\u4e86\u5f88\u591a\u65f6\u95f4\uff0cFacts\u7ed9\u4e86\u51e0\u79cd\u7f13\u5b58\u65b9\u5f0f\u3002","title":"\u7f13\u5b58Facts\u4fe1\u606f"},{"location":"basic/Facts/#_1","text":"\u521b\u5efa\u7f13\u5b58\u5b58\u653e\u7684\u76ee\u5f55 mkdir /tmp/facts_cache \u4fee\u6539ansible\u914d\u7f6e\u6587\u4ef6 # /etc/ansible/ansible.cfg gathering = smart fact_caching = jsonfile fact_caching_timeout = 86400 fact_caching_connection = /tmp/facts_cache \u83b7\u53d6\u4e3b\u673a\u7684Facts\u4fe1\u606f ansible 192 .168.77.130 -m setup \u67e5\u770b\u7f13\u5b58\u76ee\u5f55 ll /tmp/facts_cache/ \u603b\u7528\u91cf 28 -rw-r--r-- 1 root root 25241 3\u6708 31 11 :39 192 .168.77.130 \u4e0a\u8ff0\u6587\u4ef6\u4e2d\u5b58\u50a8\u7740json\u5e8f\u5217\u5316\u7684facts\u6570\u636e","title":"\u4f7f\u7528\u6587\u4ef6\u4f5c\u4e3a\u7f13\u5b58"},{"location":"basic/Facts/#redis","text":"\u5b89\u88c5redis # centos 7 yum -y install redis easy_install pip pip install redis \u914d\u7f6eredis\uff0c\u4f7f\u7528\u5bc6\u7801\u767b\u9646 echo 'requirepass \"admin\"' > /etc/redis.conf \u542f\u52a8redis systemctl enable --now redis \u4fee\u6539ansible\u914d\u7f6e\u6587\u4ef6 # /etc/ansible/ansible.cfg gathering = smart fact_caching = redis fact_caching_timeout = 86400 fact_caching_connection = localhost:6379:0:admin \u83b7\u53d6\u4e3b\u673a\u7684Facts\u4fe1\u606f ansible 192 .168.77.130 -m setup \u67e5\u770bredis\u5185\u5bb9 # redis-cli 127 .0.0.1:6379> auth admin OK 127 .0.0.1:6379> keys * 1 ) \"ansible_cache_keys\" 2 ) \"ansible_facts192.168.77.130\" 127 .0.0.1:6379> get ansible_facts192.168.77.130 .....","title":"\u4f7f\u7528redis\u4f5c\u4e3a\u7f13\u5b58"},{"location":"basic/Facts/#memcached","text":"\u5b89\u88c5 memcached # centos 7 yum install memcached easy_install pip pip install python-memcached \u542f\u52a8memcached systemctl enable --now memcached \u4fee\u6539ansible\u914d\u7f6e\u6587\u4ef6 # /etc/ansible/ansible.cfg gathering = smart fact_caching = memcached fact_caching_timeout = 86400 fact_caching_connection = localhost:11211 \u83b7\u53d6\u4e3b\u673a\u7684Facts\u4fe1\u606f ansible 192 .168.77.130 -m setup \u67e5\u770bmemcached\u5185\u5bb9 # telnet 127.0.0.1 11211 Trying 127 .0.0.1... Connected to 127 .0.0.1. Escape character is '^]' . stats items STAT items:3:number 1 STAT items:3:age 135 STAT items:3:evicted 0 STAT items:3:evicted_nonzero 0 STAT items:3:evicted_time 0 STAT items:3:outofmemory 0 STAT items:3:tailrepairs 0 STAT items:3:reclaimed 0 STAT items:3:expired_unfetched 0 STAT items:3:evicted_unfetched 0 STAT items:21:number 1 STAT items:21:age 135 STAT items:21:evicted 0 STAT items:21:evicted_nonzero 0 STAT items:21:evicted_time 0 STAT items:21:outofmemory 0 STAT items:21:tailrepairs 0 STAT items:21:reclaimed 0 STAT items:21:expired_unfetched 0 STAT items:21:evicted_unfetched 0 END stats cachedump 3 0 ITEM ansible_cache_keys [ 46 b ; 1585626688 s ] END stats cachedump 21 0 ITEM ansible_facts192.168.77.130 [ 8349 b ; 1585713251 s ] END","title":"\u4f7f\u7528memcached\u4f5c\u4e3a\u7f13\u5b58"},{"location":"basic/Facts/#_2","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u5b58\u7684\u751f\u5b58\u65f6\u95f4\u662f fact_caching_timeout \u63a7\u5236\u7684\uff0c\u5982\u679c\u6211\u4eec\u60f3\u5f3a\u5236\u5237\u65b0\u7f13\u5b58\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528 --flush-cache \u9009\u9879 ansible-playbook --flush-cache /etc/ansible/test3.yaml","title":"\u5237\u65b0\u7f13\u5b58"},{"location":"basic/Include-roles/","text":"9. \u5305\u542b\u548c\u89d2\u8272 \u00b6 \u867d\u7136\u53ef\u4ee5\u5728\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u6587\u4ef6\u4e2d\u7f16\u5199 playbook (\u60a8\u53ef\u80fd\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u5f00\u59cb\u5b66\u4e60 palybook)\uff0c\u4f46\u6700\u7ec8\u60a8\u5c06\u5e0c\u671b\u91cd\u7528\u6587\u4ef6\u5e76\u5f00\u59cb\u7ec4\u7ec7\u5de5\u4f5c\u3002\u5728Ansible\u4e2d\uff0c\u6709\u4e09\u79cd\u65b9\u6cd5\u53ef\u4ee5\u505a\u5230\u8fd9\u4e00\u70b9: includes , imports , and roles \u3002 includes \u548c imports \uff08\u5728Ansible 2.4\u7248\u4e2d\u6dfb\u52a0\uff09\u5141\u8bb8\u7528\u6237\u5c06\u5927\u578bplaybook\u62c6\u5206\u6210\u8f83\u5c0f\u7684\u6587\u4ef6\uff0c\u8fd9\u4e9b\u6587\u4ef6\u53ef\u4ee5\u5728\u591a\u4e2a\u7236\u7ea7playbook\u4e2d\u4f7f\u7528\uff0c\u751a\u81f3\u53ef\u4ee5\u5728\u540c\u4e00Playbook\u4e2d\u591a\u6b21\u4f7f\u7528\u3002 \u52a8\u6001\u548c\u9759\u6001 \u00b6 \u5bf9\u4e8e\u53ef\u91cd\u7528\u7684\u5185\u5bb9\uff0cAnsible\u6709\u4e24\u79cd\u64cd\u4f5c\u6a21\u5f0f: \u52a8\u6001 \u548c \u9759\u6001 \u3002 \u5728Ansible 2.0\u4e2d\uff0c\u5f15\u5165\u4e86\u52a8\u6001\u5305\u542b\u7684\u6982\u5ff5\u3002\u7531\u4e8e\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u5b9e\u73b0 all include \u7684\u4e00\u4e9b\u9650\u5236\uff0cAnsible 2.1\u4e2d\u5f15\u5165\u4e86\u5c06 force include \u8bbe\u7f6e\u4e3a\u9759\u6001\u7684\u80fd\u529b\u3002\u56e0\u4e3a include \u4efb\u52a1\u88ab\u91cd\u8f7d\uff0c\u5305\u542b\u4e86\u9759\u6001\u548c\u52a8\u6001\u8bed\u6cd5\uff0c\u800c\u4e14\u7531\u4e8e include \u7684\u9ed8\u8ba4\u884c\u4e3a\u53ef\u80fd\u4f1a\u6839\u636e\u4efb\u52a1\u4e0a\u8bbe\u7f6e\u7684\u5176\u4ed6\u9009\u9879\u800c\u66f4\u6539\uff0c\u6240\u4ee5Ansible 2.4\u5f15\u5165\u4e86 include \u4e0e import \u7684\u6982\u5ff5\u3002 \u9759\u6001\u5bfc\u5165 \u00b6 \u4f7f\u7528 import_tasks \u6a21\u5757\u6765\u5bfc\u5165 tasks \u6587\u4ef6 \u4f7f\u7528 import_role \u6a21\u5757\u6765\u5bfc\u5165 role tasks : - import_tasks : tasks/foo.yml - import_role : name : example import_tasks \u8fd8\u5141\u8bb8 \u4f20\u9012\u53d8\u91cf - import_tasks : wordpress.yml wp_user=timmy - import_tasks : wordpress.yml vars : wp_user : timmy ssh_keys : - keys/one.txt - keys/two.txt \u52a8\u6001\u5305\u542b \u00b6 \u4f7f\u7528 include_tasks \u6a21\u5757\u6765\u5305\u542b tasks \u6587\u4ef6 \u4f7f\u7528 include_role \u6a21\u5757\u6765\u5305\u542b role \u52a8\u6001\u5305\u542b\u53ef\u4ee5\u7528\u4f5c\u5faa\u73af\u5f15\u7528 - include_tasks : foo.yml param={{item}} with_items : # \u5faa\u73af\u5f15\u75283\u6b21 - 1 - 2 - 3 - include_role : name : example \u8fd8\u53ef\u4ee5\u4f7f\u7528\u53d8\u91cf\u5f15\u5165task\u6587\u4ef6 - include_tasks : \"{{inventory_hostname}}.yml\" \u53d8\u91cf\u5305\u542b include_vars \u5728 task \u4e2d\u52a8\u6001\u52a0\u8f7d yaml \u6216 json \u6587\u4ef6\u7c7b\u578b\u4e2d\u7684\u53d8\u91cf yaml - include_vars: myvars.yml \u6839\u636e\u64cd\u4f5c\u7cfb\u7edf\u7c7b\u578b\u52a0\u8f7d\u53d8\u91cf\u6587\u4ef6\uff0c\u5982\u679c\u627e\u4e0d\u5230\uff0c\u5219\u4e3a\u9ed8\u8ba4\u503c\u3002 - include_vars : \"{{ item }}\" with_first_found : - \"{{ ansible_distribution }}.yml\" - \"{{ ansible_os_family }}.yml\" - \"default.yml\" \u52a8\u6001\u4e0e\u9759\u6001\u4e24\u8005\u7684\u533a\u522b \u00b6 Ansible\u5728Playbook\u89e3\u6790\u65f6\u95f4\u9884\u5904\u7406\u6240\u6709 \u9759\u6001\u5bfc\u5165 \u3002\u5728\u6267\u884c\u524d\u5bfc\u5165\u914d\u7f6e\u6587\u4ef6\uff0c\u51fa\u73b0\u9519\u8bef\u4f1a\u7acb\u5373\u505c\u6b62 \u52a8\u6001\u5305\u542b \u662f\u5728\u8fd0\u884c\u671f\u95f4\u9047\u5230\u8be5\u4efb\u52a1\u65f6\u5904\u7406\u7684\u3002\u5728\u6267\u884c\u65f6\u5bfc\u5165\u914d\u7f6e\u6587\u4ef6\uff0c\u51fa\u73b0\u9519\u8bef\u4e0d\u4f1a\u7acb\u5373\u505c\u6b62 \u5f53\u6d89\u53caAnsible\u4efb\u52a1\u9009\u9879\u65f6\uff0c\u4f8b\u5982 tags \u548c\u6761\u4ef6\u8bed\u53e5 when \uff1a \u5bf9\u4e8e \u52a8\u6001\u5305\u542b \uff0c\u4efb\u52a1\u9009\u9879\u5c06\u4ec5\u5728\u8bc4\u4f30\u52a8\u6001\u4efb\u52a1\u65f6\u5e94\u7528\u4e8e\u8be5\u4efb\u52a1\uff0c\u800c\u4e0d\u4f1a\u590d\u5236\u5230\u5b50\u4efb\u52a1\u3002 \u5bf9\u4e8e \u9759\u6001\u5bfc\u5165 \uff0c\u7236\u4efb\u52a1\u9009\u9879\u5c06\u88ab\u590d\u5236\u5230\u5bfc\u5165\u4e2d\u5305\u542b\u7684\u6240\u6709\u5b50\u4efb\u52a1\u3002 \u4f7f\u7528 include* vs. import* \u6709\u4e00\u4e9b\u4f18\u70b9\uff0c\u4e5f\u6709\u4e00\u4e9b\u7f3a\u70b9\uff0c\u7528\u6237\u5728\u9009\u62e9\u4f7f\u7528\u5b83\u4eec\u65f6\u5e94\u8be5\u52a0\u4ee5\u8003\u8651 \u4f7f\u7528 include* \u8bed\u53e5\u7684\u4e3b\u8981\u4f18\u70b9\u662f \u5faa\u73af \u3002 \u5f53 \u5faa\u73af\u4e0e\u5305\u542b \u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u5c06\u5bf9\u5faa\u73af\u4e2d\u7684 \u6bcf\u4e2a\u9879\u76ee\u6267\u884c\u4e00\u6b21\u5305\u542b\u7684task\u6216role \u3002 \u4e0e\u9759\u6001\u5bfc\u5165\u76f8\u6bd4\uff0c\u52a8\u6001\u5305\u542b\u7684\u4e00\u4e9b\u9650\u5236 \u60a8\u4e0d\u80fd\u4f7f\u7528 notify \u6765\u89e6\u53d1\u6765\u81ea\u52a8\u6001\u5305\u542b\u7684\u5904\u7406\u7a0b\u5e8f\u540d\u79f0\u3002 \u60a8\u4e0d\u80fd\u4f7f\u7528 --start-at-task \u5728\u52a8\u6001\u5305\u542b\u5185\u7684\u4efb\u52a1\u5f00\u59cb\u6267\u884c\u3002 \u4ec5\u5b58\u5728\u4e8e\u52a8\u6001\u5305\u542b\u5185\u7684\u6807\u8bb0\u4e0d\u4f1a\u663e\u793a\u5728 -list-tags \u8f93\u51fa\u4e2d\u3002 \u53ea\u5b58\u5728\u4e8e\u52a8\u6001\u5305\u542b\u5185\u7684\u4efb\u52a1\u5c06\u4e0d\u4f1a\u663e\u793a\u5728 -list-tasks \u8f93\u51fa\u4e2d\u3002 \u4e0e\u52a8\u6001\u5305\u542b\u76f8\u6bd4, \u9759\u6001\u5bfc\u5165\u7684\u4e00\u4e9b\u9650\u5236 \u9759\u6001\u5bfc\u5165 \u4e0d\u80fd\u7528\u5faa\u73af \u5f53\u4f7f\u7528\u76ee\u6807\u6587\u4ef6\u6216\u89d2\u8272\u540d\u79f0\u7684\u53d8\u91cf\u65f6\uff0c\u4e0d\u80fd\u4f7f\u7528\u4e3b\u673a\u6e05\u5355\u4e2d\u7684 \u53d8\u91cf handlers \u4f7f\u7528 import \u5bfc\u5165\u7684\u5904\u7406\u7a0b\u5e8f\u5728\u88ab\u5176\u540d\u79f0\u901a\u77e5\u65f6\u4e0d\u4f1a\u88ab\u89e6\u53d1\uff0c\u56e0\u4e3a import \u4f1a\u7528\u5bfc\u5165\u7684\u4efb\u52a1\u5217\u8868\u8986\u76d6 handler\u2019s \u7684\u6307\u5b9a\u4efb\u52a1\u3002 \u89d2\u8272ROLE \u00b6 \u89d2\u8272\u662f\u57fa\u4e8e\u5df2\u77e5\u6587\u4ef6\u7ed3\u6784\u81ea\u52a8\u52a0\u8f7d\u67d0\u4e9b vars_files \uff0c tasks \u548c handlers \u7684\u65b9\u6cd5\u3002 \u6309\u89d2\u8272\u5206\u7ec4\u7684\u5185\u5bb9\u8fd8\u5141\u8bb8\u4e0e\u5176\u4ed6\u7528\u6237\u8f7b\u677e\u5171\u4eab\u89d2\u8272\u3002 \u89d2\u8272\u76ee\u5f55\u7ed3\u6784 \u00b6 \u6587\u4ef6\u7ed3\u6784\u5982\u4e0b webservers.yml fooservers.yml group_vars/ all.yml group1.yml group2.yml host_vars/ hostname1.yml hostname2.yml library/ module_utils/ filter_plugins/ roles/ common/ tasks/ handlers/ files/ templates/ vars/ defaults/ meta/ webservers/ tasks/ defaults/ meta/ \u89d2\u8272\u5fc5\u987b\u5305\u542b\u81f3\u5c11\u4e00\u4e2a\u8fd9\u6837\u7684\u76ee\u5f55\uff0c\u4f46\u662f\u5b8c\u5168\u53ef\u4ee5\u6392\u9664\u4efb\u4f55\u6ca1\u6709\u4f7f\u7528\u7684\u76ee\u5f55\u3002\u5728\u4f7f\u7528\u65f6\uff0c\u6bcf\u4e2a\u76ee\u5f55\u5fc5\u987b\u5305\u542b\u4e00\u4e2a main.yml \u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u76f8\u5173\u5185\u5bb9: tasks - \u5305\u542b\u89d2\u8272\u8981\u6267\u884c\u7684\u4e3b\u8981\u4efb\u52a1\u5217\u8868\u3002 handlers - \u5305\u542b\u5904\u7406\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u7531\u6b64\u89d2\u8272\u4f7f\u7528\uff0c\u751a\u81f3\u53ef\u4ee5\u5728\u6b64\u89d2\u8272\u4ee5\u5916\u7684\u4efb\u4f55\u5730\u65b9\u4f7f\u7528\u3002 defaults - \u89d2\u8272\u7684\u9ed8\u8ba4\u53d8\u91cf\uff08\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u53d8\u91cf\uff09\u3002 vars - \u89d2\u8272\u7684\u5176\u4ed6\u53d8\u91cf\uff08\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u53d8\u91cf\uff09\u3002 files - \u5305\u542b\u53ef\u4ee5\u901a\u8fc7\u6b64\u89d2\u8272\u90e8\u7f72\u7684\u6587\u4ef6\u3002 templates - \u5305\u542b\u53ef\u4ee5\u901a\u8fc7\u6b64\u89d2\u8272\u90e8\u7f72\u7684\u6a21\u677f\u3002 meta - \u4e3a\u8fd9\u4e2a\u89d2\u8272\u5b9a\u4e49\u4e86\u4e00\u4e9b\u5143\u6570\u636e\u3002 library - \u5982\u679c\u6709\u4efb\u4f55\u81ea\u5b9a\u4e49\u6a21\u5757\uff0c\u5c06\u5176\u653e\u5728\u8fd9\u91cc\uff08\u53ef\u9009\uff09 filter_plugins - \u5982\u679c\u6709\u4efb\u4f55\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668\u63d2\u4ef6\uff0c\u5c06\u5176\u653e\u5728\u8fd9\u91cc\uff08\u53ef\u9009\uff09 group_var/all - \u5982\u679c group_var/all \u5b58\u5728\uff0c\u5176\u4e2d\u5217\u51fa\u7684\u53d8\u91cf\u5c06\u88ab\u6dfb\u52a0\u5230\u6240\u6709\u7684\u4e3b\u673a\u7ec4\u4e2d group_var/groupname1 - \u5982\u679c group_var/groupname1 \u5b58\u5728\uff0c\u5176\u4e2d\u5217\u51fa\u7684\u53d8\u91cf\u5c06\u88ab\u6dfb\u52a0\u5230groupname1\u4e3b\u673a\u7ec4\u4e2d host_vars/hostname1 - \u5982\u679c host_vars/hostname1 \u5b58\u5728\uff0c\u5176\u4e2d\u5217\u51fa\u7684\u53d8\u91cf\u5c06\u88ab\u6dfb\u52a0\u5230hostname1\u4e3b\u673a\u7ec4\u4e2d \u9664\u4e86\u7279\u5b9a\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u5916\uff0c\u4e5f\u53ef\u4ee5\u5305\u542b\u81ea\u5b9a\u4e49\u7684\u6587\u4ef6\u548c\u76ee\u5f55\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u4e3a\u6bcf\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u8bbe\u7f6e\u4e00\u4e2a\u6587\u4ef6 # roles/example/tasks/main.yml - name : added in 2.4, previously you used 'include' import_tasks : redhat.yml when : ansible_facts['os_family']|lower == 'redhat' - import_tasks : debian.yml when : ansible_facts['os_family']|lower == 'debian' # roles/example/tasks/redhat.yml - yum : name : \"httpd\" state : present # roles/example/tasks/debian.yml - apt : name : \"apache2\" state : present \u89d2\u8272\u4f7f\u7528 \u00b6 \u5728 play \u4e2d\u4f7f\u7528 roles: \u6765\u5b9a\u4e49\u4f7f\u7528\u54ea\u4e9brole --- - hosts : webservers roles : - common - webservers \u8fd9\u4e2a playbook \u4e3a\u4e00\u4e2a\u89d2\u8272 \u2018x\u2019 \u6307\u5b9a\u4e86\u5982\u4e0b\u7684\u884c\u4e3a \u5982\u679c roles/x/tasks/main.yml \u5b58\u5728, \u5176\u4e2d\u5217\u51fa\u7684 tasks \u5c06\u88ab\u6dfb\u52a0\u5230 play \u4e2d \u5982\u679c roles/x/handlers/main.yml \u5b58\u5728, \u5176\u4e2d\u5217\u51fa\u7684 handlers \u5c06\u88ab\u6dfb\u52a0\u5230 play \u4e2d \u5982\u679c roles/x/vars/main.yml \u5b58\u5728, \u5176\u4e2d\u5217\u51fa\u7684 \u53d8\u91cf\u5c06\u88ab\u6dfb\u52a0\u5230 play \u4e2d \u5982\u679c roles/ x/defaults/main.yml \u5b58\u5728\uff0c\u5176\u4e2d\u5217\u51fa\u7684\u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf\u5c06\u88ab\u6dfb\u52a0\u5230play \u4e2d \u5982\u679c roles/x/meta/main.yml \u5b58\u5728, \u5176\u4e2d\u5217\u51fa\u7684 \u201c\u89d2\u8272\u4f9d\u8d56\u201d \u5c06\u88ab\u6dfb\u52a0\u5230 roles \u5217\u8868\u4e2d \u6240\u6709 copy tasks \u53ef\u4ee5\u5f15\u7528 roles/x/files/ \u4e2d\u7684\u6587\u4ef6\uff0c\u4e0d\u9700\u8981\u6307\u660e\u6587\u4ef6\u7684\u5168\u8def\u5f84\u3002 \u6240\u6709 script tasks \u53ef\u4ee5\u5f15\u7528 roles/x/files/ \u4e2d\u7684\u811a\u672c\uff0c\u4e0d\u9700\u8981\u6307\u660e\u6587\u4ef6\u7684\u5168\u8def\u5f84\u3002 \u6240\u6709 template tasks \u53ef\u4ee5\u5f15\u7528 roles/x/templates/ \u4e2d\u7684\u6587\u4ef6\uff0c\u4e0d\u9700\u8981\u6307\u660e\u6587\u4ef6\u7684\u5168\u8def\u5f84\u3002 \u6240\u6709 include tasks \u53ef\u4ee5\u5f15\u7528 roles/x/tasks/ \u4e2d\u7684\u6587\u4ef6\uff0c\u4e0d\u9700\u8981\u6307\u660e\u6587\u4ef6\u7684\u5168\u8def\u5f84\u3002\u5982\u679c roles \u76ee\u5f55\u4e0b\u6709\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u8fd9\u4e9b\u6587\u4ef6\u5c06\u88ab\u5ffd\u7565\u3002 \u5f53\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u4f7f\u7528\u65f6\uff0cplaybook \u7684\u6267\u884c\u987a\u5e8f\u5982\u4e0b: pre_tasks \u5b9a\u4e49\u7684\u6240\u6709\u4efb\u52a1 \u5230\u76ee\u524d\u89e6\u53d1\u7684 handlers \u4efb\u52a1 roles \u4e2d\u5217\u51fa\u7684\u6bcf\u4e2a\u89d2\u8272\u5c06\u4f9d\u6b21\u6267\u884c\u3002 \u89d2\u8272 meta/main.yml \u4e2d\u5b9a\u4e49\u7684\u4efb\u4f55\u89d2\u8272\u4f9d\u8d56\u5173\u7cfb\u90fd\u5c06\u9996\u5148\u8fd0\u884c\uff0c\u4f46\u8981\u9075\u5faa\u6807\u7b7e\u8fc7\u6ee4\u548c\u6761\u4ef6\u3002 tasks \u5b9a\u4e49\u7684\u6240\u6709\u4efb\u52a1 \u5230\u76ee\u524d\u89e6\u53d1\u7684 handlers \u4efb\u52a1 post_tasks \u5b9a\u4e49\u7684\u6240\u6709\u4efb\u52a1 \u5230\u76ee\u524d\u89e6\u53d1\u7684 handlers \u4efb\u52a1 \u4eceAnsible 2.4\u5f00\u59cb\uff0c\u60a8\u73b0\u5728\u53ef\u4ee5\u4f7f\u7528 import role \u6216 include role \u5c06\u89d2\u8272\u5185\u8054\u5230\u4efb\u4f55\u5176\u4ed6\u4efb\u52a1\u4e2d --- - hosts : webservers tasks : - debug : msg : \"before we run our role\" - import_role : name : example - include_role : name : example - debug : msg : \"after we ran our role\" \u4f7f\u7528\u89d2\u8272\u53ef\u4ee5\u7528\u7b80\u5355\u7684\u540d\u79f0\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\u5f15\u5165 - hosts : webservers roles : - role : '/path/to/my/roles/common' roles \u4e5f\u53ef\u4ee5\u63a5\u53d7\u5176\u4ed6\u5173\u952e\u5b57 --- - hosts : webservers roles : - common - role : foo_app_instance vars : dir : '/opt/a' app_port : 5000 - role : foo_app_instance vars : dir : '/opt/b' app_port : 5001 \u4e5f\u53ef\u4ee5\u6362\u79cd\u8bed\u6cd5\u4e66\u5199 --- - hosts : webservers tasks : - include_role : name : foo_app_instance vars : dir : '/opt/a' app_port : 5000 ... \u53ef\u4ee5\u6709\u6761\u4ef6\u7684\u5bfc\u5165role --- - hosts : webservers tasks : - include_role : name : some_role when : \"ansible_facts['os_family'] == 'RedHat'\" \u4e5f\u53ef\u4ee5\u4e3a\u89d2\u8272\u5185\u7684\u4efb\u52a1\u5206\u914d\u6807\u7b7e --- - hosts : webservers roles : - role : foo tags : - bar - baz # using YAML shorthand, this is equivalent to the above: - { role : foo , tags : [ \"bar\" , \"baz\" ] } \u6362\u4e00\u79cd\u8bed\u6cd5\u4e66\u5199 --- - hosts : webservers tasks : - import_role : name : foo tags : - bar - baz \u5982\u679c\u4f60\u60f3\u53ea\u7ed9\u8fd9\u4e2a\u89d2\u8272\u672c\u8eab\u6253\u4e0a\u6807\u8bb0 --- - hosts : webservers tasks : - include_role : name : bar tags : - foo \u672c\u4f8b\u4e2d\u7684\u6807\u8bb0\u4e0d\u4f1a\u88ab\u6dfb\u52a0\u5230include\u89d2\u8272\u4e2d\u7684\u4efb\u52a1\u4e2d \u89d2\u8272\u91cd\u590d\u6267\u884c \u00b6 Ansible\u53ea\u5141\u8bb8\u4e00\u4e2a\u89d2\u8272\u6267\u884c\u4e00\u6b21\uff0c\u5373\u4f7f\u5b9a\u4e49\u4e86\u591a\u6b21\uff0c\u5982\u679c\u89d2\u8272\u4e0a\u5b9a\u4e49\u7684\u53c2\u6570\u5bf9\u4e8e\u6bcf\u4e2a\u5b9a\u4e49\u90fd\u662f\u76f8\u540c\u7684\u3002\u4f8b\u5982 --- - hosts : webservers roles : - foo - foo \u9274\u4e8e\u4ee5\u4e0a\u6240\u8ff0\uff0c\u89d2\u8272foo\u5c06\u53ea\u8fd0\u884c\u4e00\u6b21\u3002 \u8981\u4f7f\u89d2\u8272\u591a\u6b21\u8fd0\u884c\uff0c\u6709\u4e24\u79cd\u9009\u62e9\uff1a \u5728\u6bcf\u4e2a\u89d2\u8272\u5b9a\u4e49\u4e2d\u4f20\u9012\u4e0d\u540c\u7684\u53c2\u6570\u3002 --- - hosts : webservers roles : - role : foo vars : message : \"first\" - { role : foo , vars : { message : \"second\" } } \u5728\u89d2\u8272\u7684 meta/main.yml \u6587\u4ef6\u4e2d\u6dfb\u52a0 allow_duplicates\uff1atrue \u3002 # playbook.yml --- - hosts : webservers roles : - foo - foo # roles/foo/meta/main.yml --- allow_duplicates : true \u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf \u00b6 \u5b9a\u4e49\u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf\uff0c\u53ea\u9700\u5728\u89d2\u8272\u76ee\u5f55\u4e2d\u6dfb\u52a0\u4e00\u4e2a defaults/main.yml \u6587\u4ef6\u3002\u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf\u4f18\u5148\u7ea7\u6700\u4f4e,\u5f88\u5bb9\u6613\u88ab\u5176\u4ed6\u53d8\u91cf\u8986\u76d6\u6389\u3002 \u89d2\u8272\u4f9d\u8d56 \u00b6 \u89d2\u8272\u4f9d\u8d56\u6027\u4f7f\u60a8\u53ef\u4ee5\u5728\u4f7f\u7528\u89d2\u8272\u65f6 \u81ea\u52a8\u5bfc\u5165 \u5176\u4ed6\u89d2\u8272\u3002 \u89d2\u8272\u76f8\u5173\u6027\u5b58\u50a8\u5728\u89d2\u8272\u76ee\u5f55\u4e2d\u5305\u542b\u7684 meta/main.yml \u6587\u4ef6\u4e2d\uff0c\u5982\u4e0a\u6240\u8ff0\u3002 \u8be5\u6587\u4ef6\u5e94\u5305\u542b\u8981\u5728\u6307\u5b9a\u89d2\u8272\u4e4b\u524d\u63d2\u5165\u7684\u89d2\u8272\u548c\u53c2\u6570\u7684\u5217\u8868\uff0c\u4f8b\u5982\u5728 role/myapp/meta/main.yml \u793a\u4f8b\u4e2d\u7684\u4ee5\u4e0b\u5185\u5bb9\uff1a --- dependencies : - role : common vars : some_parameter : 3 - role : apache vars : apache_port : 80 - role : postgres vars : dbname : blarg other_parameter : 12 \u89d2\u8272\u4f9d\u8d56\u9879\u5fc5\u987b\u4f7f\u7528\u7ecf\u5178\u7684\u89d2\u8272\u5b9a\u4e49\u6837\u5f0f\u3002 \u89d2\u8272\u4f9d\u8d56\u9879\u59cb\u7ec8\u5728\u5305\u542b\u5b83\u4eec\u7684\u89d2\u8272\u4e4b\u524d\u6267\u884c\uff0c\u5e76\u4e14\u53ef\u80fd\u662f\u9012\u5f52\u7684\u3002 \u4f9d\u8d56\u6027\u4e5f\u9075\u5faa\u4e0a\u9762\u6307\u5b9a\u7684\u590d\u5236\u89c4\u5219\u3002 \u5982\u679c\u53e6\u4e00\u4e2a\u89d2\u8272\u4e5f\u5c06\u5176\u5217\u4e3a\u4f9d\u8d56\u9879\uff0c\u5219\u4e0d\u4f1a\u6839\u636e\u4e0a\u8ff0\u76f8\u540c\u89c4\u5219\u518d\u6b21\u8fd0\u884c\u5b83\u3002 \u6c38\u8fdc\u8bb0\u4f4f\uff0c\u5f53\u4f7f\u7528 allow_duplicates\uff1atrue \u65f6\uff0c\u5b83\u5fc5\u987b\u4f4d\u4e8e\u4ece\u5c5e\u89d2\u8272\u7684 meta/main.yml \u4e2d\uff0c\u800c\u4e0d\u662f\u7236\u89d2\u8272\u4e2d\u3002 \u4f8b\u5982\uff0c\u4e00\u4e2a\u540d\u4e3acar\u7684\u89d2\u8272\u4f9d\u8d56\u4e8e\u4e00\u4e2a\u540d\u4e3awheel\u7684\u89d2\u8272\uff0c\u5982\u4e0b\u6240\u793a --- dependencies : - role : wheel vars : n : 1 - role : wheel vars : n : 2 - role : wheel vars : n : 3 - role : wheel vars : n : 4 wheel \u89d2\u8272\u53c8\u4f9d\u8d56\u4e24\u4e2a\u89d2\u8272\uff1a tire \u548c brake \u3002 wheel\u7684 meta/main.yml \u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a --- dependencies : - role : tire - role : brake tire \u548c brake \u7684 meta/main.yml \u5c06\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a --- allow_duplicates : true \u4ea7\u751f\u7684\u6267\u884c\u987a\u5e8f\u5982\u4e0b\uff1a tire(n=1) brake(n=1) wheel(n=1) tire(n=2) brake(n=2) wheel(n=2) ... car \u6ce8\u610f\uff0c\u6211\u4eec\u5728wheel\u53ef\u4ee5\u4e0d\u5fc5\u4f7f\u7528 allow duplicate: true \uff0c\u56e0\u4e3acar\u5b9a\u4e49\u7684\u6bcf\u4e2arole\u4f7f\u7528\u4e0d\u540c\u7684\u53c2\u6570\u503c\u3002 \u5d4c\u5165\u6a21\u5757\u548c\u63d2\u4ef6 \u00b6 \u5982\u679c\u60a8\u7f16\u5199\u4e86\u81ea\u5b9a\u4e49\u6a21\u5757\u6216\u63d2\u4ef6\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u5c06\u5176\u4f5c\u4e3a\u89d2\u8272\u7684\u4e00\u90e8\u5206\u8fdb\u884c\u5206\u4eab\u3002 \u9664\u4e86\u89d2\u8272\u7684 tasks \u548c handlers \u7ed3\u6784\u4e4b\u5916\uff0c\u8fd8\u8981\u6dfb\u52a0\u4e00\u4e2a\u540d\u4e3a library \u7684\u76ee\u5f55\u3002\u5728\u8fd9\u4e2a\u5e93\u76ee\u5f55\u4e2d\uff0c\u7136\u540e\u5c06\u6a21\u5757\u76f4\u63a5\u5305\u542b\u5728\u5176\u4e2d\u3002 \u6bd4\u5982\u4e0b\u9762\u8fd9\u6837 roles/ my_custom_modules/ library/ module1 module2 \u8be5\u81ea\u5b9a\u4e49\u7684\u6a21\u5757\u5728\u89d2\u8272\u672c\u8eab\u4ee5\u53ca\u5728\u6b64\u89d2\u8272\u4e4b\u540e\u8c03\u7528\u7684\u4efb\u4f55\u89d2\u8272\u4e2d\u90fd\u662f\u53ef\u7528\u7684 --- - hosts : webservers roles : - my_custom_modules - some_other_role_using_my_custom_modules - yet_another_role_using_my_custom_modules \u76f8\u540c\u7684\u60c5\u51b5\uff0c\u5982\u679c\u5f00\u53d1\u81ea\u5b9a\u4e49\u7684\u63d2\u4ef6\uff0c\u9700\u8981\u653e\u5728 filter_plugins \u76ee\u5f55\u4e2d\uff0c\u89d2\u8272\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e86 roles/ my_custom_filter/ filter_plugins filter1 filter2 \u5982\u679c\u8bf4\u6a21\u5757\u548c\u63d2\u4ef6\u9700\u8981\u7ed9\u591a\u4e2arole\u4f7f\u7528\uff0c\u90a3\u5c31\u53ef\u4ee5\u653e\u7f6e\u5728ansible\u7684\u63d2\u4ef6\u76ee\u5f55\u4e2d\uff0c\u8fd9\u6837\uff0c\u4efb\u4f55role\u90fd\u53ef\u4ee5\u4f7f\u7528\u4e86\u3002 /etc/ansible/roles/ filter_plugins filter1 library/ module1 my_custom_filter/ my_custom_modules/ \u89d2\u8272\u641c\u7d22\u8def\u5f84 \u00b6 \u4f4d\u4e8eplaybook\u76ee\u5f55\u4e0b\u7684 roles/ \u76ee\u5f55 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u7684 /etc/ansible/roles \u76ee\u5f55 \u5728Ansible 1.4\u548c\u66f4\u9ad8\u7248\u672c\u4e2d\uff0c\u60a8\u53ef\u4ee5\u914d\u7f6e\u5176\u4ed6 role_path \u6765\u641c\u7d22\u89d2\u8272\u3002 \u4f7f\u7528\u6b64\u529f\u80fd\u53ef\u4ee5\u5c06\u6240\u6709\u5e38\u89c1\u89d2\u8272\u7b7e\u5230\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u5e76\u5728\u591a\u4e2a\u5267\u672c\u9879\u76ee\u4e4b\u95f4\u8f7b\u677e\u5171\u4eab\u5b83\u4eec\u3002 \u6709\u5173\u5982\u4f55\u5728 ansible.cfg \u4e2d\u8fdb\u884c\u8bbe\u7f6e\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u914d\u7f6eAnsible\u3002 Ansible Galaxy \u00b6 Ansible Galaxy\u662f\u4e00\u4e2a\u514d\u8d39\u7684\u7f51\u7ad9\uff0c\u53ef\u4ee5\u627e\u5230\uff0c\u4e0b\u8f7d\uff0c\u8bc4\u7ea7\uff0c\u5e76\u5ba1\u67e5\u5404\u79cd\u793e\u533a\u5f00\u53d1\u7684Ansible\u89d2\u8272\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2a\u4f1f\u5927\u7684\u65b9\u5f0f\u6765\u542f\u52a8\u4f60\u7684\u81ea\u52a8\u5316\u9879\u76ee\u3002 \u53ef\u4ee5\u4f7f\u7528 ansible-galaxy \u521d\u59cb\u5316\u4e00\u4e2a\u89d2\u8272\u57fa\u7840\u76ee\u5f55\u7ed3\u6784 # ansible-galaxy init demo - Role demo was created successfully # tree demo demo \u251c\u2500\u2500 defaults \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 files \u251c\u2500\u2500 handlers \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 meta \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 README.md \u251c\u2500\u2500 tasks \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 templates \u251c\u2500\u2500 tests \u2502 \u251c\u2500\u2500 inventory \u2502 \u2514\u2500\u2500 test.yml \u2514\u2500\u2500 vars \u2514\u2500\u2500 main.yml 8 directories, 8 files \u89d2\u8272\u793a\u4f8b\u53c2\u8003 \u00b6 https://galaxy.ansible.com/ https://github.com/ansible/ansible-examples https://github.com/lework/Ansible-roles https://github.com/geerlingguy https://github.com/debops","title":"9. \u5305\u542b\u548c\u89d2\u8272"},{"location":"basic/Include-roles/#9","text":"\u867d\u7136\u53ef\u4ee5\u5728\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u6587\u4ef6\u4e2d\u7f16\u5199 playbook (\u60a8\u53ef\u80fd\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u5f00\u59cb\u5b66\u4e60 palybook)\uff0c\u4f46\u6700\u7ec8\u60a8\u5c06\u5e0c\u671b\u91cd\u7528\u6587\u4ef6\u5e76\u5f00\u59cb\u7ec4\u7ec7\u5de5\u4f5c\u3002\u5728Ansible\u4e2d\uff0c\u6709\u4e09\u79cd\u65b9\u6cd5\u53ef\u4ee5\u505a\u5230\u8fd9\u4e00\u70b9: includes , imports , and roles \u3002 includes \u548c imports \uff08\u5728Ansible 2.4\u7248\u4e2d\u6dfb\u52a0\uff09\u5141\u8bb8\u7528\u6237\u5c06\u5927\u578bplaybook\u62c6\u5206\u6210\u8f83\u5c0f\u7684\u6587\u4ef6\uff0c\u8fd9\u4e9b\u6587\u4ef6\u53ef\u4ee5\u5728\u591a\u4e2a\u7236\u7ea7playbook\u4e2d\u4f7f\u7528\uff0c\u751a\u81f3\u53ef\u4ee5\u5728\u540c\u4e00Playbook\u4e2d\u591a\u6b21\u4f7f\u7528\u3002","title":"9. \u5305\u542b\u548c\u89d2\u8272"},{"location":"basic/Include-roles/#_1","text":"\u5bf9\u4e8e\u53ef\u91cd\u7528\u7684\u5185\u5bb9\uff0cAnsible\u6709\u4e24\u79cd\u64cd\u4f5c\u6a21\u5f0f: \u52a8\u6001 \u548c \u9759\u6001 \u3002 \u5728Ansible 2.0\u4e2d\uff0c\u5f15\u5165\u4e86\u52a8\u6001\u5305\u542b\u7684\u6982\u5ff5\u3002\u7531\u4e8e\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u5b9e\u73b0 all include \u7684\u4e00\u4e9b\u9650\u5236\uff0cAnsible 2.1\u4e2d\u5f15\u5165\u4e86\u5c06 force include \u8bbe\u7f6e\u4e3a\u9759\u6001\u7684\u80fd\u529b\u3002\u56e0\u4e3a include \u4efb\u52a1\u88ab\u91cd\u8f7d\uff0c\u5305\u542b\u4e86\u9759\u6001\u548c\u52a8\u6001\u8bed\u6cd5\uff0c\u800c\u4e14\u7531\u4e8e include \u7684\u9ed8\u8ba4\u884c\u4e3a\u53ef\u80fd\u4f1a\u6839\u636e\u4efb\u52a1\u4e0a\u8bbe\u7f6e\u7684\u5176\u4ed6\u9009\u9879\u800c\u66f4\u6539\uff0c\u6240\u4ee5Ansible 2.4\u5f15\u5165\u4e86 include \u4e0e import \u7684\u6982\u5ff5\u3002","title":"\u52a8\u6001\u548c\u9759\u6001"},{"location":"basic/Include-roles/#_2","text":"\u4f7f\u7528 import_tasks \u6a21\u5757\u6765\u5bfc\u5165 tasks \u6587\u4ef6 \u4f7f\u7528 import_role \u6a21\u5757\u6765\u5bfc\u5165 role tasks : - import_tasks : tasks/foo.yml - import_role : name : example import_tasks \u8fd8\u5141\u8bb8 \u4f20\u9012\u53d8\u91cf - import_tasks : wordpress.yml wp_user=timmy - import_tasks : wordpress.yml vars : wp_user : timmy ssh_keys : - keys/one.txt - keys/two.txt","title":"\u9759\u6001\u5bfc\u5165"},{"location":"basic/Include-roles/#_3","text":"\u4f7f\u7528 include_tasks \u6a21\u5757\u6765\u5305\u542b tasks \u6587\u4ef6 \u4f7f\u7528 include_role \u6a21\u5757\u6765\u5305\u542b role \u52a8\u6001\u5305\u542b\u53ef\u4ee5\u7528\u4f5c\u5faa\u73af\u5f15\u7528 - include_tasks : foo.yml param={{item}} with_items : # \u5faa\u73af\u5f15\u75283\u6b21 - 1 - 2 - 3 - include_role : name : example \u8fd8\u53ef\u4ee5\u4f7f\u7528\u53d8\u91cf\u5f15\u5165task\u6587\u4ef6 - include_tasks : \"{{inventory_hostname}}.yml\" \u53d8\u91cf\u5305\u542b include_vars \u5728 task \u4e2d\u52a8\u6001\u52a0\u8f7d yaml \u6216 json \u6587\u4ef6\u7c7b\u578b\u4e2d\u7684\u53d8\u91cf yaml - include_vars: myvars.yml \u6839\u636e\u64cd\u4f5c\u7cfb\u7edf\u7c7b\u578b\u52a0\u8f7d\u53d8\u91cf\u6587\u4ef6\uff0c\u5982\u679c\u627e\u4e0d\u5230\uff0c\u5219\u4e3a\u9ed8\u8ba4\u503c\u3002 - include_vars : \"{{ item }}\" with_first_found : - \"{{ ansible_distribution }}.yml\" - \"{{ ansible_os_family }}.yml\" - \"default.yml\"","title":"\u52a8\u6001\u5305\u542b"},{"location":"basic/Include-roles/#_4","text":"Ansible\u5728Playbook\u89e3\u6790\u65f6\u95f4\u9884\u5904\u7406\u6240\u6709 \u9759\u6001\u5bfc\u5165 \u3002\u5728\u6267\u884c\u524d\u5bfc\u5165\u914d\u7f6e\u6587\u4ef6\uff0c\u51fa\u73b0\u9519\u8bef\u4f1a\u7acb\u5373\u505c\u6b62 \u52a8\u6001\u5305\u542b \u662f\u5728\u8fd0\u884c\u671f\u95f4\u9047\u5230\u8be5\u4efb\u52a1\u65f6\u5904\u7406\u7684\u3002\u5728\u6267\u884c\u65f6\u5bfc\u5165\u914d\u7f6e\u6587\u4ef6\uff0c\u51fa\u73b0\u9519\u8bef\u4e0d\u4f1a\u7acb\u5373\u505c\u6b62 \u5f53\u6d89\u53caAnsible\u4efb\u52a1\u9009\u9879\u65f6\uff0c\u4f8b\u5982 tags \u548c\u6761\u4ef6\u8bed\u53e5 when \uff1a \u5bf9\u4e8e \u52a8\u6001\u5305\u542b \uff0c\u4efb\u52a1\u9009\u9879\u5c06\u4ec5\u5728\u8bc4\u4f30\u52a8\u6001\u4efb\u52a1\u65f6\u5e94\u7528\u4e8e\u8be5\u4efb\u52a1\uff0c\u800c\u4e0d\u4f1a\u590d\u5236\u5230\u5b50\u4efb\u52a1\u3002 \u5bf9\u4e8e \u9759\u6001\u5bfc\u5165 \uff0c\u7236\u4efb\u52a1\u9009\u9879\u5c06\u88ab\u590d\u5236\u5230\u5bfc\u5165\u4e2d\u5305\u542b\u7684\u6240\u6709\u5b50\u4efb\u52a1\u3002 \u4f7f\u7528 include* vs. import* \u6709\u4e00\u4e9b\u4f18\u70b9\uff0c\u4e5f\u6709\u4e00\u4e9b\u7f3a\u70b9\uff0c\u7528\u6237\u5728\u9009\u62e9\u4f7f\u7528\u5b83\u4eec\u65f6\u5e94\u8be5\u52a0\u4ee5\u8003\u8651 \u4f7f\u7528 include* \u8bed\u53e5\u7684\u4e3b\u8981\u4f18\u70b9\u662f \u5faa\u73af \u3002 \u5f53 \u5faa\u73af\u4e0e\u5305\u542b \u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u5c06\u5bf9\u5faa\u73af\u4e2d\u7684 \u6bcf\u4e2a\u9879\u76ee\u6267\u884c\u4e00\u6b21\u5305\u542b\u7684task\u6216role \u3002 \u4e0e\u9759\u6001\u5bfc\u5165\u76f8\u6bd4\uff0c\u52a8\u6001\u5305\u542b\u7684\u4e00\u4e9b\u9650\u5236 \u60a8\u4e0d\u80fd\u4f7f\u7528 notify \u6765\u89e6\u53d1\u6765\u81ea\u52a8\u6001\u5305\u542b\u7684\u5904\u7406\u7a0b\u5e8f\u540d\u79f0\u3002 \u60a8\u4e0d\u80fd\u4f7f\u7528 --start-at-task \u5728\u52a8\u6001\u5305\u542b\u5185\u7684\u4efb\u52a1\u5f00\u59cb\u6267\u884c\u3002 \u4ec5\u5b58\u5728\u4e8e\u52a8\u6001\u5305\u542b\u5185\u7684\u6807\u8bb0\u4e0d\u4f1a\u663e\u793a\u5728 -list-tags \u8f93\u51fa\u4e2d\u3002 \u53ea\u5b58\u5728\u4e8e\u52a8\u6001\u5305\u542b\u5185\u7684\u4efb\u52a1\u5c06\u4e0d\u4f1a\u663e\u793a\u5728 -list-tasks \u8f93\u51fa\u4e2d\u3002 \u4e0e\u52a8\u6001\u5305\u542b\u76f8\u6bd4, \u9759\u6001\u5bfc\u5165\u7684\u4e00\u4e9b\u9650\u5236 \u9759\u6001\u5bfc\u5165 \u4e0d\u80fd\u7528\u5faa\u73af \u5f53\u4f7f\u7528\u76ee\u6807\u6587\u4ef6\u6216\u89d2\u8272\u540d\u79f0\u7684\u53d8\u91cf\u65f6\uff0c\u4e0d\u80fd\u4f7f\u7528\u4e3b\u673a\u6e05\u5355\u4e2d\u7684 \u53d8\u91cf handlers \u4f7f\u7528 import \u5bfc\u5165\u7684\u5904\u7406\u7a0b\u5e8f\u5728\u88ab\u5176\u540d\u79f0\u901a\u77e5\u65f6\u4e0d\u4f1a\u88ab\u89e6\u53d1\uff0c\u56e0\u4e3a import \u4f1a\u7528\u5bfc\u5165\u7684\u4efb\u52a1\u5217\u8868\u8986\u76d6 handler\u2019s \u7684\u6307\u5b9a\u4efb\u52a1\u3002","title":"\u52a8\u6001\u4e0e\u9759\u6001\u4e24\u8005\u7684\u533a\u522b"},{"location":"basic/Include-roles/#role","text":"\u89d2\u8272\u662f\u57fa\u4e8e\u5df2\u77e5\u6587\u4ef6\u7ed3\u6784\u81ea\u52a8\u52a0\u8f7d\u67d0\u4e9b vars_files \uff0c tasks \u548c handlers \u7684\u65b9\u6cd5\u3002 \u6309\u89d2\u8272\u5206\u7ec4\u7684\u5185\u5bb9\u8fd8\u5141\u8bb8\u4e0e\u5176\u4ed6\u7528\u6237\u8f7b\u677e\u5171\u4eab\u89d2\u8272\u3002","title":"\u89d2\u8272ROLE"},{"location":"basic/Include-roles/#_5","text":"\u6587\u4ef6\u7ed3\u6784\u5982\u4e0b webservers.yml fooservers.yml group_vars/ all.yml group1.yml group2.yml host_vars/ hostname1.yml hostname2.yml library/ module_utils/ filter_plugins/ roles/ common/ tasks/ handlers/ files/ templates/ vars/ defaults/ meta/ webservers/ tasks/ defaults/ meta/ \u89d2\u8272\u5fc5\u987b\u5305\u542b\u81f3\u5c11\u4e00\u4e2a\u8fd9\u6837\u7684\u76ee\u5f55\uff0c\u4f46\u662f\u5b8c\u5168\u53ef\u4ee5\u6392\u9664\u4efb\u4f55\u6ca1\u6709\u4f7f\u7528\u7684\u76ee\u5f55\u3002\u5728\u4f7f\u7528\u65f6\uff0c\u6bcf\u4e2a\u76ee\u5f55\u5fc5\u987b\u5305\u542b\u4e00\u4e2a main.yml \u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u76f8\u5173\u5185\u5bb9: tasks - \u5305\u542b\u89d2\u8272\u8981\u6267\u884c\u7684\u4e3b\u8981\u4efb\u52a1\u5217\u8868\u3002 handlers - \u5305\u542b\u5904\u7406\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u7531\u6b64\u89d2\u8272\u4f7f\u7528\uff0c\u751a\u81f3\u53ef\u4ee5\u5728\u6b64\u89d2\u8272\u4ee5\u5916\u7684\u4efb\u4f55\u5730\u65b9\u4f7f\u7528\u3002 defaults - \u89d2\u8272\u7684\u9ed8\u8ba4\u53d8\u91cf\uff08\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u53d8\u91cf\uff09\u3002 vars - \u89d2\u8272\u7684\u5176\u4ed6\u53d8\u91cf\uff08\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u53d8\u91cf\uff09\u3002 files - \u5305\u542b\u53ef\u4ee5\u901a\u8fc7\u6b64\u89d2\u8272\u90e8\u7f72\u7684\u6587\u4ef6\u3002 templates - \u5305\u542b\u53ef\u4ee5\u901a\u8fc7\u6b64\u89d2\u8272\u90e8\u7f72\u7684\u6a21\u677f\u3002 meta - \u4e3a\u8fd9\u4e2a\u89d2\u8272\u5b9a\u4e49\u4e86\u4e00\u4e9b\u5143\u6570\u636e\u3002 library - \u5982\u679c\u6709\u4efb\u4f55\u81ea\u5b9a\u4e49\u6a21\u5757\uff0c\u5c06\u5176\u653e\u5728\u8fd9\u91cc\uff08\u53ef\u9009\uff09 filter_plugins - \u5982\u679c\u6709\u4efb\u4f55\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668\u63d2\u4ef6\uff0c\u5c06\u5176\u653e\u5728\u8fd9\u91cc\uff08\u53ef\u9009\uff09 group_var/all - \u5982\u679c group_var/all \u5b58\u5728\uff0c\u5176\u4e2d\u5217\u51fa\u7684\u53d8\u91cf\u5c06\u88ab\u6dfb\u52a0\u5230\u6240\u6709\u7684\u4e3b\u673a\u7ec4\u4e2d group_var/groupname1 - \u5982\u679c group_var/groupname1 \u5b58\u5728\uff0c\u5176\u4e2d\u5217\u51fa\u7684\u53d8\u91cf\u5c06\u88ab\u6dfb\u52a0\u5230groupname1\u4e3b\u673a\u7ec4\u4e2d host_vars/hostname1 - \u5982\u679c host_vars/hostname1 \u5b58\u5728\uff0c\u5176\u4e2d\u5217\u51fa\u7684\u53d8\u91cf\u5c06\u88ab\u6dfb\u52a0\u5230hostname1\u4e3b\u673a\u7ec4\u4e2d \u9664\u4e86\u7279\u5b9a\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u5916\uff0c\u4e5f\u53ef\u4ee5\u5305\u542b\u81ea\u5b9a\u4e49\u7684\u6587\u4ef6\u548c\u76ee\u5f55\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u4e3a\u6bcf\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u8bbe\u7f6e\u4e00\u4e2a\u6587\u4ef6 # roles/example/tasks/main.yml - name : added in 2.4, previously you used 'include' import_tasks : redhat.yml when : ansible_facts['os_family']|lower == 'redhat' - import_tasks : debian.yml when : ansible_facts['os_family']|lower == 'debian' # roles/example/tasks/redhat.yml - yum : name : \"httpd\" state : present # roles/example/tasks/debian.yml - apt : name : \"apache2\" state : present","title":"\u89d2\u8272\u76ee\u5f55\u7ed3\u6784"},{"location":"basic/Include-roles/#_6","text":"\u5728 play \u4e2d\u4f7f\u7528 roles: \u6765\u5b9a\u4e49\u4f7f\u7528\u54ea\u4e9brole --- - hosts : webservers roles : - common - webservers \u8fd9\u4e2a playbook \u4e3a\u4e00\u4e2a\u89d2\u8272 \u2018x\u2019 \u6307\u5b9a\u4e86\u5982\u4e0b\u7684\u884c\u4e3a \u5982\u679c roles/x/tasks/main.yml \u5b58\u5728, \u5176\u4e2d\u5217\u51fa\u7684 tasks \u5c06\u88ab\u6dfb\u52a0\u5230 play \u4e2d \u5982\u679c roles/x/handlers/main.yml \u5b58\u5728, \u5176\u4e2d\u5217\u51fa\u7684 handlers \u5c06\u88ab\u6dfb\u52a0\u5230 play \u4e2d \u5982\u679c roles/x/vars/main.yml \u5b58\u5728, \u5176\u4e2d\u5217\u51fa\u7684 \u53d8\u91cf\u5c06\u88ab\u6dfb\u52a0\u5230 play \u4e2d \u5982\u679c roles/ x/defaults/main.yml \u5b58\u5728\uff0c\u5176\u4e2d\u5217\u51fa\u7684\u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf\u5c06\u88ab\u6dfb\u52a0\u5230play \u4e2d \u5982\u679c roles/x/meta/main.yml \u5b58\u5728, \u5176\u4e2d\u5217\u51fa\u7684 \u201c\u89d2\u8272\u4f9d\u8d56\u201d \u5c06\u88ab\u6dfb\u52a0\u5230 roles \u5217\u8868\u4e2d \u6240\u6709 copy tasks \u53ef\u4ee5\u5f15\u7528 roles/x/files/ \u4e2d\u7684\u6587\u4ef6\uff0c\u4e0d\u9700\u8981\u6307\u660e\u6587\u4ef6\u7684\u5168\u8def\u5f84\u3002 \u6240\u6709 script tasks \u53ef\u4ee5\u5f15\u7528 roles/x/files/ \u4e2d\u7684\u811a\u672c\uff0c\u4e0d\u9700\u8981\u6307\u660e\u6587\u4ef6\u7684\u5168\u8def\u5f84\u3002 \u6240\u6709 template tasks \u53ef\u4ee5\u5f15\u7528 roles/x/templates/ \u4e2d\u7684\u6587\u4ef6\uff0c\u4e0d\u9700\u8981\u6307\u660e\u6587\u4ef6\u7684\u5168\u8def\u5f84\u3002 \u6240\u6709 include tasks \u53ef\u4ee5\u5f15\u7528 roles/x/tasks/ \u4e2d\u7684\u6587\u4ef6\uff0c\u4e0d\u9700\u8981\u6307\u660e\u6587\u4ef6\u7684\u5168\u8def\u5f84\u3002\u5982\u679c roles \u76ee\u5f55\u4e0b\u6709\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u8fd9\u4e9b\u6587\u4ef6\u5c06\u88ab\u5ffd\u7565\u3002 \u5f53\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u4f7f\u7528\u65f6\uff0cplaybook \u7684\u6267\u884c\u987a\u5e8f\u5982\u4e0b: pre_tasks \u5b9a\u4e49\u7684\u6240\u6709\u4efb\u52a1 \u5230\u76ee\u524d\u89e6\u53d1\u7684 handlers \u4efb\u52a1 roles \u4e2d\u5217\u51fa\u7684\u6bcf\u4e2a\u89d2\u8272\u5c06\u4f9d\u6b21\u6267\u884c\u3002 \u89d2\u8272 meta/main.yml \u4e2d\u5b9a\u4e49\u7684\u4efb\u4f55\u89d2\u8272\u4f9d\u8d56\u5173\u7cfb\u90fd\u5c06\u9996\u5148\u8fd0\u884c\uff0c\u4f46\u8981\u9075\u5faa\u6807\u7b7e\u8fc7\u6ee4\u548c\u6761\u4ef6\u3002 tasks \u5b9a\u4e49\u7684\u6240\u6709\u4efb\u52a1 \u5230\u76ee\u524d\u89e6\u53d1\u7684 handlers \u4efb\u52a1 post_tasks \u5b9a\u4e49\u7684\u6240\u6709\u4efb\u52a1 \u5230\u76ee\u524d\u89e6\u53d1\u7684 handlers \u4efb\u52a1 \u4eceAnsible 2.4\u5f00\u59cb\uff0c\u60a8\u73b0\u5728\u53ef\u4ee5\u4f7f\u7528 import role \u6216 include role \u5c06\u89d2\u8272\u5185\u8054\u5230\u4efb\u4f55\u5176\u4ed6\u4efb\u52a1\u4e2d --- - hosts : webservers tasks : - debug : msg : \"before we run our role\" - import_role : name : example - include_role : name : example - debug : msg : \"after we ran our role\" \u4f7f\u7528\u89d2\u8272\u53ef\u4ee5\u7528\u7b80\u5355\u7684\u540d\u79f0\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\u5f15\u5165 - hosts : webservers roles : - role : '/path/to/my/roles/common' roles \u4e5f\u53ef\u4ee5\u63a5\u53d7\u5176\u4ed6\u5173\u952e\u5b57 --- - hosts : webservers roles : - common - role : foo_app_instance vars : dir : '/opt/a' app_port : 5000 - role : foo_app_instance vars : dir : '/opt/b' app_port : 5001 \u4e5f\u53ef\u4ee5\u6362\u79cd\u8bed\u6cd5\u4e66\u5199 --- - hosts : webservers tasks : - include_role : name : foo_app_instance vars : dir : '/opt/a' app_port : 5000 ... \u53ef\u4ee5\u6709\u6761\u4ef6\u7684\u5bfc\u5165role --- - hosts : webservers tasks : - include_role : name : some_role when : \"ansible_facts['os_family'] == 'RedHat'\" \u4e5f\u53ef\u4ee5\u4e3a\u89d2\u8272\u5185\u7684\u4efb\u52a1\u5206\u914d\u6807\u7b7e --- - hosts : webservers roles : - role : foo tags : - bar - baz # using YAML shorthand, this is equivalent to the above: - { role : foo , tags : [ \"bar\" , \"baz\" ] } \u6362\u4e00\u79cd\u8bed\u6cd5\u4e66\u5199 --- - hosts : webservers tasks : - import_role : name : foo tags : - bar - baz \u5982\u679c\u4f60\u60f3\u53ea\u7ed9\u8fd9\u4e2a\u89d2\u8272\u672c\u8eab\u6253\u4e0a\u6807\u8bb0 --- - hosts : webservers tasks : - include_role : name : bar tags : - foo \u672c\u4f8b\u4e2d\u7684\u6807\u8bb0\u4e0d\u4f1a\u88ab\u6dfb\u52a0\u5230include\u89d2\u8272\u4e2d\u7684\u4efb\u52a1\u4e2d","title":"\u89d2\u8272\u4f7f\u7528"},{"location":"basic/Include-roles/#_7","text":"Ansible\u53ea\u5141\u8bb8\u4e00\u4e2a\u89d2\u8272\u6267\u884c\u4e00\u6b21\uff0c\u5373\u4f7f\u5b9a\u4e49\u4e86\u591a\u6b21\uff0c\u5982\u679c\u89d2\u8272\u4e0a\u5b9a\u4e49\u7684\u53c2\u6570\u5bf9\u4e8e\u6bcf\u4e2a\u5b9a\u4e49\u90fd\u662f\u76f8\u540c\u7684\u3002\u4f8b\u5982 --- - hosts : webservers roles : - foo - foo \u9274\u4e8e\u4ee5\u4e0a\u6240\u8ff0\uff0c\u89d2\u8272foo\u5c06\u53ea\u8fd0\u884c\u4e00\u6b21\u3002 \u8981\u4f7f\u89d2\u8272\u591a\u6b21\u8fd0\u884c\uff0c\u6709\u4e24\u79cd\u9009\u62e9\uff1a \u5728\u6bcf\u4e2a\u89d2\u8272\u5b9a\u4e49\u4e2d\u4f20\u9012\u4e0d\u540c\u7684\u53c2\u6570\u3002 --- - hosts : webservers roles : - role : foo vars : message : \"first\" - { role : foo , vars : { message : \"second\" } } \u5728\u89d2\u8272\u7684 meta/main.yml \u6587\u4ef6\u4e2d\u6dfb\u52a0 allow_duplicates\uff1atrue \u3002 # playbook.yml --- - hosts : webservers roles : - foo - foo # roles/foo/meta/main.yml --- allow_duplicates : true","title":"\u89d2\u8272\u91cd\u590d\u6267\u884c"},{"location":"basic/Include-roles/#_8","text":"\u5b9a\u4e49\u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf\uff0c\u53ea\u9700\u5728\u89d2\u8272\u76ee\u5f55\u4e2d\u6dfb\u52a0\u4e00\u4e2a defaults/main.yml \u6587\u4ef6\u3002\u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf\u4f18\u5148\u7ea7\u6700\u4f4e,\u5f88\u5bb9\u6613\u88ab\u5176\u4ed6\u53d8\u91cf\u8986\u76d6\u6389\u3002","title":"\u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf"},{"location":"basic/Include-roles/#_9","text":"\u89d2\u8272\u4f9d\u8d56\u6027\u4f7f\u60a8\u53ef\u4ee5\u5728\u4f7f\u7528\u89d2\u8272\u65f6 \u81ea\u52a8\u5bfc\u5165 \u5176\u4ed6\u89d2\u8272\u3002 \u89d2\u8272\u76f8\u5173\u6027\u5b58\u50a8\u5728\u89d2\u8272\u76ee\u5f55\u4e2d\u5305\u542b\u7684 meta/main.yml \u6587\u4ef6\u4e2d\uff0c\u5982\u4e0a\u6240\u8ff0\u3002 \u8be5\u6587\u4ef6\u5e94\u5305\u542b\u8981\u5728\u6307\u5b9a\u89d2\u8272\u4e4b\u524d\u63d2\u5165\u7684\u89d2\u8272\u548c\u53c2\u6570\u7684\u5217\u8868\uff0c\u4f8b\u5982\u5728 role/myapp/meta/main.yml \u793a\u4f8b\u4e2d\u7684\u4ee5\u4e0b\u5185\u5bb9\uff1a --- dependencies : - role : common vars : some_parameter : 3 - role : apache vars : apache_port : 80 - role : postgres vars : dbname : blarg other_parameter : 12 \u89d2\u8272\u4f9d\u8d56\u9879\u5fc5\u987b\u4f7f\u7528\u7ecf\u5178\u7684\u89d2\u8272\u5b9a\u4e49\u6837\u5f0f\u3002 \u89d2\u8272\u4f9d\u8d56\u9879\u59cb\u7ec8\u5728\u5305\u542b\u5b83\u4eec\u7684\u89d2\u8272\u4e4b\u524d\u6267\u884c\uff0c\u5e76\u4e14\u53ef\u80fd\u662f\u9012\u5f52\u7684\u3002 \u4f9d\u8d56\u6027\u4e5f\u9075\u5faa\u4e0a\u9762\u6307\u5b9a\u7684\u590d\u5236\u89c4\u5219\u3002 \u5982\u679c\u53e6\u4e00\u4e2a\u89d2\u8272\u4e5f\u5c06\u5176\u5217\u4e3a\u4f9d\u8d56\u9879\uff0c\u5219\u4e0d\u4f1a\u6839\u636e\u4e0a\u8ff0\u76f8\u540c\u89c4\u5219\u518d\u6b21\u8fd0\u884c\u5b83\u3002 \u6c38\u8fdc\u8bb0\u4f4f\uff0c\u5f53\u4f7f\u7528 allow_duplicates\uff1atrue \u65f6\uff0c\u5b83\u5fc5\u987b\u4f4d\u4e8e\u4ece\u5c5e\u89d2\u8272\u7684 meta/main.yml \u4e2d\uff0c\u800c\u4e0d\u662f\u7236\u89d2\u8272\u4e2d\u3002 \u4f8b\u5982\uff0c\u4e00\u4e2a\u540d\u4e3acar\u7684\u89d2\u8272\u4f9d\u8d56\u4e8e\u4e00\u4e2a\u540d\u4e3awheel\u7684\u89d2\u8272\uff0c\u5982\u4e0b\u6240\u793a --- dependencies : - role : wheel vars : n : 1 - role : wheel vars : n : 2 - role : wheel vars : n : 3 - role : wheel vars : n : 4 wheel \u89d2\u8272\u53c8\u4f9d\u8d56\u4e24\u4e2a\u89d2\u8272\uff1a tire \u548c brake \u3002 wheel\u7684 meta/main.yml \u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a --- dependencies : - role : tire - role : brake tire \u548c brake \u7684 meta/main.yml \u5c06\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a --- allow_duplicates : true \u4ea7\u751f\u7684\u6267\u884c\u987a\u5e8f\u5982\u4e0b\uff1a tire(n=1) brake(n=1) wheel(n=1) tire(n=2) brake(n=2) wheel(n=2) ... car \u6ce8\u610f\uff0c\u6211\u4eec\u5728wheel\u53ef\u4ee5\u4e0d\u5fc5\u4f7f\u7528 allow duplicate: true \uff0c\u56e0\u4e3acar\u5b9a\u4e49\u7684\u6bcf\u4e2arole\u4f7f\u7528\u4e0d\u540c\u7684\u53c2\u6570\u503c\u3002","title":"\u89d2\u8272\u4f9d\u8d56"},{"location":"basic/Include-roles/#_10","text":"\u5982\u679c\u60a8\u7f16\u5199\u4e86\u81ea\u5b9a\u4e49\u6a21\u5757\u6216\u63d2\u4ef6\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u5c06\u5176\u4f5c\u4e3a\u89d2\u8272\u7684\u4e00\u90e8\u5206\u8fdb\u884c\u5206\u4eab\u3002 \u9664\u4e86\u89d2\u8272\u7684 tasks \u548c handlers \u7ed3\u6784\u4e4b\u5916\uff0c\u8fd8\u8981\u6dfb\u52a0\u4e00\u4e2a\u540d\u4e3a library \u7684\u76ee\u5f55\u3002\u5728\u8fd9\u4e2a\u5e93\u76ee\u5f55\u4e2d\uff0c\u7136\u540e\u5c06\u6a21\u5757\u76f4\u63a5\u5305\u542b\u5728\u5176\u4e2d\u3002 \u6bd4\u5982\u4e0b\u9762\u8fd9\u6837 roles/ my_custom_modules/ library/ module1 module2 \u8be5\u81ea\u5b9a\u4e49\u7684\u6a21\u5757\u5728\u89d2\u8272\u672c\u8eab\u4ee5\u53ca\u5728\u6b64\u89d2\u8272\u4e4b\u540e\u8c03\u7528\u7684\u4efb\u4f55\u89d2\u8272\u4e2d\u90fd\u662f\u53ef\u7528\u7684 --- - hosts : webservers roles : - my_custom_modules - some_other_role_using_my_custom_modules - yet_another_role_using_my_custom_modules \u76f8\u540c\u7684\u60c5\u51b5\uff0c\u5982\u679c\u5f00\u53d1\u81ea\u5b9a\u4e49\u7684\u63d2\u4ef6\uff0c\u9700\u8981\u653e\u5728 filter_plugins \u76ee\u5f55\u4e2d\uff0c\u89d2\u8272\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e86 roles/ my_custom_filter/ filter_plugins filter1 filter2 \u5982\u679c\u8bf4\u6a21\u5757\u548c\u63d2\u4ef6\u9700\u8981\u7ed9\u591a\u4e2arole\u4f7f\u7528\uff0c\u90a3\u5c31\u53ef\u4ee5\u653e\u7f6e\u5728ansible\u7684\u63d2\u4ef6\u76ee\u5f55\u4e2d\uff0c\u8fd9\u6837\uff0c\u4efb\u4f55role\u90fd\u53ef\u4ee5\u4f7f\u7528\u4e86\u3002 /etc/ansible/roles/ filter_plugins filter1 library/ module1 my_custom_filter/ my_custom_modules/","title":"\u5d4c\u5165\u6a21\u5757\u548c\u63d2\u4ef6"},{"location":"basic/Include-roles/#_11","text":"\u4f4d\u4e8eplaybook\u76ee\u5f55\u4e0b\u7684 roles/ \u76ee\u5f55 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u7684 /etc/ansible/roles \u76ee\u5f55 \u5728Ansible 1.4\u548c\u66f4\u9ad8\u7248\u672c\u4e2d\uff0c\u60a8\u53ef\u4ee5\u914d\u7f6e\u5176\u4ed6 role_path \u6765\u641c\u7d22\u89d2\u8272\u3002 \u4f7f\u7528\u6b64\u529f\u80fd\u53ef\u4ee5\u5c06\u6240\u6709\u5e38\u89c1\u89d2\u8272\u7b7e\u5230\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u5e76\u5728\u591a\u4e2a\u5267\u672c\u9879\u76ee\u4e4b\u95f4\u8f7b\u677e\u5171\u4eab\u5b83\u4eec\u3002 \u6709\u5173\u5982\u4f55\u5728 ansible.cfg \u4e2d\u8fdb\u884c\u8bbe\u7f6e\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u914d\u7f6eAnsible\u3002","title":"\u89d2\u8272\u641c\u7d22\u8def\u5f84"},{"location":"basic/Include-roles/#ansible-galaxy","text":"Ansible Galaxy\u662f\u4e00\u4e2a\u514d\u8d39\u7684\u7f51\u7ad9\uff0c\u53ef\u4ee5\u627e\u5230\uff0c\u4e0b\u8f7d\uff0c\u8bc4\u7ea7\uff0c\u5e76\u5ba1\u67e5\u5404\u79cd\u793e\u533a\u5f00\u53d1\u7684Ansible\u89d2\u8272\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2a\u4f1f\u5927\u7684\u65b9\u5f0f\u6765\u542f\u52a8\u4f60\u7684\u81ea\u52a8\u5316\u9879\u76ee\u3002 \u53ef\u4ee5\u4f7f\u7528 ansible-galaxy \u521d\u59cb\u5316\u4e00\u4e2a\u89d2\u8272\u57fa\u7840\u76ee\u5f55\u7ed3\u6784 # ansible-galaxy init demo - Role demo was created successfully # tree demo demo \u251c\u2500\u2500 defaults \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 files \u251c\u2500\u2500 handlers \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 meta \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 README.md \u251c\u2500\u2500 tasks \u2502 \u2514\u2500\u2500 main.yml \u251c\u2500\u2500 templates \u251c\u2500\u2500 tests \u2502 \u251c\u2500\u2500 inventory \u2502 \u2514\u2500\u2500 test.yml \u2514\u2500\u2500 vars \u2514\u2500\u2500 main.yml 8 directories, 8 files","title":"Ansible Galaxy"},{"location":"basic/Include-roles/#_12","text":"https://galaxy.ansible.com/ https://github.com/ansible/ansible-examples https://github.com/lework/Ansible-roles https://github.com/geerlingguy https://github.com/debops","title":"\u89d2\u8272\u793a\u4f8b\u53c2\u8003"},{"location":"basic/Installation/","text":"2. \u5b89\u88c5 Ansible \u00b6 \u5b66\u4f1a\u4e00\u4e2a\u8f6f\u4ef6\u7684\u7b2c\u4e00\u4ef6\u4e8b\uff0c\u5c31\u662f\u8981\u5728\u5404\u79cd\u73af\u5883\u4e0a\u5b89\u88c5\u8fd9\u4e2a\u8f6f\u4ef6\uff0c\u5b89\u88c5\u597d\uff0c\u6211\u4eec\u624d\u80fd\u8fdb\u5165\u4e0b\u4e00\u6b65\uff0c\u8ddf\u7740\u6211\u4e00\u8d77\u6765\u5b89\u88c5 ansible \u5427 \u5bf9\u7ba1\u7406\u4e3b\u673a\u7684\u8981\u6c42 \u76ee\u524d,\u53ea\u8981\u673a\u5668\u4e0a\u5b89\u88c5\u4e86 Python 2\uff08\u7248\u672c2.6\u62162.7\uff09\u6216Python 3\uff08\u7248\u672c3.5\u53ca\u66f4\u9ad8\u7248\u672c\uff09\u90fd\u53ef\u4ee5\u8fd0\u884cAnsible (windows\u7cfb\u7edf\u4e0d\u53ef\u4ee5\u505a\u7ba1\u7406\u4e3b\u673a) \u7ba1\u7406\u4e3b\u673a\u7684\u7cfb\u7edf\u53ef\u4ee5\u662f Red Hat, Debian, CentOS, macOS, BSD\u7684\u5404\u79cd\u7248\u672c. \u5bf9\u8282\u70b9\u4e3b\u673a\u7684\u8981\u6c42 \u901a\u5e38\u6211\u4eec\u4f7f\u7528 ssh \u4e0e\u8282\u70b9\u901a\u4fe1\uff0c\u9ed8\u8ba4\u4f7f\u7528 sftp. \u5982\u679c sftp \u4e0d\u53ef\u7528\uff0c\u53ef\u5728 ansible.cfg \u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u6210 scp \u7684\u65b9\u5f0f. \u5728\u8282\u70b9\u4e0a\u4e5f\u9700\u8981\u5b89\u88c5Python 2\uff082.6\u6216\u66f4\u9ad8\u7248\u672c\uff09\u6216Python 3\uff083.5\u6216\u66f4\u9ad8\u7248\u672c\uff09 \u5982\u679c\u8282\u70b9\u542f\u7528\u4e86 selinux , \u5728\u4f7f\u7528 copy / file / template \u65f6\u9700\u8981\u5b89\u88c5 libselinux-python \u5305\u3002 \u5982\u679c\u60f3\u901a\u8fc7ansible\u7ed9\u8282\u70b9\u4e3b\u673a\u5b89\u88c5python\u6a21\u5757\uff0c\u53ef\u4ee5\u4f7f\u7528 raw \u6a21\u5757\uff0c\u547d\u4ee4\u5982: ansible myhost --become -m raw -a \"yum install -y python2\" raw \u6a21\u5757 \u53ef\u4ee5\u539f\u751f\u6267\u884cshell\u547d\u4ee4 \u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u5b89\u88c5ansible \u00b6 \u5927\u5bb6\u9009\u62e9\u4e0b\u9762\u7684\u4e00\u79cd\u65b9\u5f0f\u8fdb\u884c\u5b89\u88c5 ansible CentOS/RHEL sed -e 's!^#baseurl=!baseurl=!g' \\ -e 's!^mirrorlist=!#mirrorlist=!g' \\ -e 's!mirror.centos.org!mirrors.aliyun.com!g' \\ -i /etc/yum.repos.d/CentOS-Base.repo yum install -y epel-release sed -e 's!^mirrorlist=!#mirrorlist=!g' \\ -e 's!^metalink=!#metalink=!g' \\ -e 's!^#baseurl=!baseurl=!g' \\ -e 's!//download\\.fedoraproject\\.org/pub!//mirrors.aliyun.com!g' \\ -e 's!http://mirrors\\.aliyun!https://mirrors.aliyun!g' \\ -i /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel-testing.repo yum install -y ansible Ubuntu $ sudo apt update $ sudo apt install software-properties-common $ sudo apt-add-repository --yes --update ppa:ansible/ansible $ sudo apt install ansible Debian deb http://ppa.launchpad.net/ansible/ansible/ubuntu trusty main $ sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 93C4A3FD7BB9C367 $ sudo apt update $ sudo apt install ansible FreeBSD $ sudo pkg install py27-ansible # or $ sudo pkg install py36-ansible dnf $ sudo dnf install ansible mac curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py python get-pip.py sudo CFLAGS = -Qunused-arguments CPPFLAGS = -Qunused-arguments pip install ansible -i https://mirrors.ustc.edu.cn/pypi/web/simple # \u901a\u8fc7\u6b64\u65b9\u5f0f\u5b89\u88c5\u7684\u6ca1\u6709\u751f\u6210/etc/ansible\u6587\u4ef6\uff0c\u53ef\u4ee5\u624b\u52a8\u751f\u6210\uff0c\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u5230https://github.com/ansible/ansible/tree/devel/examples pip curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py python get-pip.py pip install ansible -i https://mirrors.ustc.edu.cn/pypi/web/simple # \u901a\u8fc7\u6b64\u65b9\u5f0f\u5b89\u88c5\u7684\u6ca1\u6709\u751f\u6210/etc/ansible\u6587\u4ef6\uff0c\u53ef\u4ee5\u624b\u52a8\u751f\u6210\uff0c\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u5230https://github.com/ansible/ansible/tree/devel/examples Python3 yum install -y python36 python36-tools curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py python3.6 get-pip.py pip3.6 install ansible -i https://mirrors.ustc.edu.cn/pypi/web/simple # \u901a\u8fc7\u6b64\u65b9\u5f0f\u5b89\u88c5\u7684\u6ca1\u6709\u751f\u6210/etc/ansible\u6587\u4ef6\uff0c\u53ef\u4ee5\u624b\u52a8\u751f\u6210\uff0c\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u5230https://github.com/ansible/ansible/tree/devel/examples \u6e90\u7801 yum install -y python-setuptools easy_install pip wget https://github.com/ansible/ansible/archive/v2.9.6.tar.gz tar zxf v2.9.6.tar.gz cd ./ansible-2.9.6 pip install -r ./requirements.txt python setup.py install mkdir /etc/ansible/ cp examples/ { ansible.cfg,hosts } /etc/ansible/ \u79bb\u7ebf\u5b89\u88c5 # \u4ee5\u76ee\u6807\u4e3b\u673acentos7\u4e3a\u6d4b\u8bd5 # 1. \u4e0b\u8f7dansible\u53ca\u4f9d\u8d56\u7cfb\u7edf\u5305 curl -sSL https://cdn.jsdelivr.net/gh/lework/script/shell/get_packages.sh | bash -s - centos7 ansible # 2. \u4e0b\u8f7d\u597d\u7684\u79bb\u7ebf\u5305\u5728\u5f53\u524d\u76ee\u5f55\u7684package_centos7_ansible ls package_centos7_ansible # 3. \u5c06\u76ee\u5f55\u62f7\u8d1d\u5230\u76ee\u6807\u4e3b\u673a,\u5728\u5f53\u524d\u76ee\u5f55\u5b89\u88c5 yum localinstall *.rpm bash\u547d\u4ee4\u884c\u81ea\u52a8\u8865\u5168 \u00b6 \u5728Ansible 2.9\u4e4b\u540e\uff0c\u5c31\u652f\u6301\u4e86\u547d\u4ee4\u884c\u53c2\u6570\u8865\u9f50\u529f\u80fd CentOS/RHEL yum install epel-release yum install python-argcomplete apt $ sudo apt install python-argcomplete pip pip install argcomplete \u5c06\u8865\u5168\u52a0\u5165\u73af\u5883\u53d8\u91cf activate-global-python-argcomplete source /etc/profile \u5728bash \u5c0f\u4e8e4.2 \u65f6\uff0c\u4f7f\u7528\u4e0b\u5217\u547d\u4ee4\u6ce8\u518c $ eval $( register-python-argcomplete ansible ) $ eval $( register-python-argcomplete ansible-config ) $ eval $( register-python-argcomplete ansible-console ) $ eval $( register-python-argcomplete ansible-doc ) $ eval $( register-python-argcomplete ansible-galaxy ) $ eval $( register-python-argcomplete ansible-inventory ) $ eval $( register-python-argcomplete ansible-playbook ) $ eval $( register-python-argcomplete ansible-pull ) $ eval $( register-python-argcomplete ansible-vault ) source /etc/profile","title":"2. \u5b89\u88c5 Ansible"},{"location":"basic/Installation/#2-ansible","text":"\u5b66\u4f1a\u4e00\u4e2a\u8f6f\u4ef6\u7684\u7b2c\u4e00\u4ef6\u4e8b\uff0c\u5c31\u662f\u8981\u5728\u5404\u79cd\u73af\u5883\u4e0a\u5b89\u88c5\u8fd9\u4e2a\u8f6f\u4ef6\uff0c\u5b89\u88c5\u597d\uff0c\u6211\u4eec\u624d\u80fd\u8fdb\u5165\u4e0b\u4e00\u6b65\uff0c\u8ddf\u7740\u6211\u4e00\u8d77\u6765\u5b89\u88c5 ansible \u5427 \u5bf9\u7ba1\u7406\u4e3b\u673a\u7684\u8981\u6c42 \u76ee\u524d,\u53ea\u8981\u673a\u5668\u4e0a\u5b89\u88c5\u4e86 Python 2\uff08\u7248\u672c2.6\u62162.7\uff09\u6216Python 3\uff08\u7248\u672c3.5\u53ca\u66f4\u9ad8\u7248\u672c\uff09\u90fd\u53ef\u4ee5\u8fd0\u884cAnsible (windows\u7cfb\u7edf\u4e0d\u53ef\u4ee5\u505a\u7ba1\u7406\u4e3b\u673a) \u7ba1\u7406\u4e3b\u673a\u7684\u7cfb\u7edf\u53ef\u4ee5\u662f Red Hat, Debian, CentOS, macOS, BSD\u7684\u5404\u79cd\u7248\u672c. \u5bf9\u8282\u70b9\u4e3b\u673a\u7684\u8981\u6c42 \u901a\u5e38\u6211\u4eec\u4f7f\u7528 ssh \u4e0e\u8282\u70b9\u901a\u4fe1\uff0c\u9ed8\u8ba4\u4f7f\u7528 sftp. \u5982\u679c sftp \u4e0d\u53ef\u7528\uff0c\u53ef\u5728 ansible.cfg \u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u6210 scp \u7684\u65b9\u5f0f. \u5728\u8282\u70b9\u4e0a\u4e5f\u9700\u8981\u5b89\u88c5Python 2\uff082.6\u6216\u66f4\u9ad8\u7248\u672c\uff09\u6216Python 3\uff083.5\u6216\u66f4\u9ad8\u7248\u672c\uff09 \u5982\u679c\u8282\u70b9\u542f\u7528\u4e86 selinux , \u5728\u4f7f\u7528 copy / file / template \u65f6\u9700\u8981\u5b89\u88c5 libselinux-python \u5305\u3002 \u5982\u679c\u60f3\u901a\u8fc7ansible\u7ed9\u8282\u70b9\u4e3b\u673a\u5b89\u88c5python\u6a21\u5757\uff0c\u53ef\u4ee5\u4f7f\u7528 raw \u6a21\u5757\uff0c\u547d\u4ee4\u5982: ansible myhost --become -m raw -a \"yum install -y python2\" raw \u6a21\u5757 \u53ef\u4ee5\u539f\u751f\u6267\u884cshell\u547d\u4ee4","title":"2. \u5b89\u88c5 Ansible"},{"location":"basic/Installation/#ansible","text":"\u5927\u5bb6\u9009\u62e9\u4e0b\u9762\u7684\u4e00\u79cd\u65b9\u5f0f\u8fdb\u884c\u5b89\u88c5 ansible CentOS/RHEL sed -e 's!^#baseurl=!baseurl=!g' \\ -e 's!^mirrorlist=!#mirrorlist=!g' \\ -e 's!mirror.centos.org!mirrors.aliyun.com!g' \\ -i /etc/yum.repos.d/CentOS-Base.repo yum install -y epel-release sed -e 's!^mirrorlist=!#mirrorlist=!g' \\ -e 's!^metalink=!#metalink=!g' \\ -e 's!^#baseurl=!baseurl=!g' \\ -e 's!//download\\.fedoraproject\\.org/pub!//mirrors.aliyun.com!g' \\ -e 's!http://mirrors\\.aliyun!https://mirrors.aliyun!g' \\ -i /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel-testing.repo yum install -y ansible Ubuntu $ sudo apt update $ sudo apt install software-properties-common $ sudo apt-add-repository --yes --update ppa:ansible/ansible $ sudo apt install ansible Debian deb http://ppa.launchpad.net/ansible/ansible/ubuntu trusty main $ sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 93C4A3FD7BB9C367 $ sudo apt update $ sudo apt install ansible FreeBSD $ sudo pkg install py27-ansible # or $ sudo pkg install py36-ansible dnf $ sudo dnf install ansible mac curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py python get-pip.py sudo CFLAGS = -Qunused-arguments CPPFLAGS = -Qunused-arguments pip install ansible -i https://mirrors.ustc.edu.cn/pypi/web/simple # \u901a\u8fc7\u6b64\u65b9\u5f0f\u5b89\u88c5\u7684\u6ca1\u6709\u751f\u6210/etc/ansible\u6587\u4ef6\uff0c\u53ef\u4ee5\u624b\u52a8\u751f\u6210\uff0c\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u5230https://github.com/ansible/ansible/tree/devel/examples pip curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py python get-pip.py pip install ansible -i https://mirrors.ustc.edu.cn/pypi/web/simple # \u901a\u8fc7\u6b64\u65b9\u5f0f\u5b89\u88c5\u7684\u6ca1\u6709\u751f\u6210/etc/ansible\u6587\u4ef6\uff0c\u53ef\u4ee5\u624b\u52a8\u751f\u6210\uff0c\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u5230https://github.com/ansible/ansible/tree/devel/examples Python3 yum install -y python36 python36-tools curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py python3.6 get-pip.py pip3.6 install ansible -i https://mirrors.ustc.edu.cn/pypi/web/simple # \u901a\u8fc7\u6b64\u65b9\u5f0f\u5b89\u88c5\u7684\u6ca1\u6709\u751f\u6210/etc/ansible\u6587\u4ef6\uff0c\u53ef\u4ee5\u624b\u52a8\u751f\u6210\uff0c\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u5230https://github.com/ansible/ansible/tree/devel/examples \u6e90\u7801 yum install -y python-setuptools easy_install pip wget https://github.com/ansible/ansible/archive/v2.9.6.tar.gz tar zxf v2.9.6.tar.gz cd ./ansible-2.9.6 pip install -r ./requirements.txt python setup.py install mkdir /etc/ansible/ cp examples/ { ansible.cfg,hosts } /etc/ansible/ \u79bb\u7ebf\u5b89\u88c5 # \u4ee5\u76ee\u6807\u4e3b\u673acentos7\u4e3a\u6d4b\u8bd5 # 1. \u4e0b\u8f7dansible\u53ca\u4f9d\u8d56\u7cfb\u7edf\u5305 curl -sSL https://cdn.jsdelivr.net/gh/lework/script/shell/get_packages.sh | bash -s - centos7 ansible # 2. \u4e0b\u8f7d\u597d\u7684\u79bb\u7ebf\u5305\u5728\u5f53\u524d\u76ee\u5f55\u7684package_centos7_ansible ls package_centos7_ansible # 3. \u5c06\u76ee\u5f55\u62f7\u8d1d\u5230\u76ee\u6807\u4e3b\u673a,\u5728\u5f53\u524d\u76ee\u5f55\u5b89\u88c5 yum localinstall *.rpm","title":"\u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u5b89\u88c5ansible"},{"location":"basic/Installation/#bash","text":"\u5728Ansible 2.9\u4e4b\u540e\uff0c\u5c31\u652f\u6301\u4e86\u547d\u4ee4\u884c\u53c2\u6570\u8865\u9f50\u529f\u80fd CentOS/RHEL yum install epel-release yum install python-argcomplete apt $ sudo apt install python-argcomplete pip pip install argcomplete \u5c06\u8865\u5168\u52a0\u5165\u73af\u5883\u53d8\u91cf activate-global-python-argcomplete source /etc/profile \u5728bash \u5c0f\u4e8e4.2 \u65f6\uff0c\u4f7f\u7528\u4e0b\u5217\u547d\u4ee4\u6ce8\u518c $ eval $( register-python-argcomplete ansible ) $ eval $( register-python-argcomplete ansible-config ) $ eval $( register-python-argcomplete ansible-console ) $ eval $( register-python-argcomplete ansible-doc ) $ eval $( register-python-argcomplete ansible-galaxy ) $ eval $( register-python-argcomplete ansible-inventory ) $ eval $( register-python-argcomplete ansible-playbook ) $ eval $( register-python-argcomplete ansible-pull ) $ eval $( register-python-argcomplete ansible-vault ) source /etc/profile","title":"bash\u547d\u4ee4\u884c\u81ea\u52a8\u8865\u5168"},{"location":"basic/Introduction/","text":"1. Ansible \u4ecb\u7ecd \u00b6 Ansible \u662f2012\u5e74\u63a8\u51fa\u7684\u4e00\u79cd\u901a\u7528\u81ea\u52a8\u5316\u5de5\u5177\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u7ba1\u7406\u6216\u5de5\u4f5c\u6d41\u7a0b\u81ea\u52a8\u5316\u3002\u914d\u7f6e\u7ba1\u7406\u662f\u4e00\u79cd\" \u57fa\u7840\u67b6\u6784\u4ee3\u7801 \"\u5b9e\u8df5\uff0c\u5b83\u5c06\u4e8b\u7269\u7f16\u7801\uff0c\u4f8b\u5982\u5e94\u8be5\u5728\u7cfb\u7edf\u4e0a\u5b89\u88c5\u4ec0\u4e48\u5305\u548c\u7248\u672c\uff0c\u6216\u8005\u5e94\u8be5\u8fd0\u884c\u4ec0\u4e48\u5b88\u62a4\u8fdb\u7a0b\u3002\u5de5\u4f5c\u6d41\u81ea\u52a8\u5316\u53ef\u80fd\u662f\u4ece\u914d\u7f6e\u57fa\u7840\u67b6\u6784\u5230\u90e8\u7f72\u8f6f\u4ef6\u7684\u4efb\u4f55\u4e8b\u60c5\u3002Ansible \u57282015\u5e74\u65f6\u88abRedhat\u516c\u53f8\u6536\u8d2d\u3002 Ansible\u662f\u7528Python\u7f16\u5199\u7684\uff0c\u5b83\u4f7f\u7528SSH\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\u6267\u884c\u547d\u4ee4\u3002Ansible\u662f\u65e0\u4ee3\u7406\u7684\uff0c\u8fd9\u4f7f\u5f97\u5165\u624b\u66f4\u5bb9\u6613\u3002\u60a8\u53ea\u9700\u8981\u5728\u76f8\u5173\u673a\u5668\u4e0a\u5b89\u88c5SSH\u548cPython\u3002Ansible\u4f7f\u7528\u58f0\u660e\u5f0fYAML\u8bed\u8a00\"playbook\"\u5c06\u4e00\u7ec4\u4e3b\u673a\uff08\"hosts\"\uff09\u6620\u5c04\u5230\u5b9a\u4e49\u660e\u786e\u7684\u89d2\u8272\u3002\u58f0\u660e\u6027\u7528\u4e8e\u6307\u793aAnsible\u5982\u4f55\u8bbe\u7f6e\u6216\u66f4\u6539\u4e8b\u7269\uff0cAnsible\u624d\u8fdb\u884c\u5fc5\u8981\u7684\u66f4\u6539\u3002 Ansible \u7684\u76ee\u6807 \u00b6 \u4e00\u5207\u81ea\u52a8\u5316 ansible\u7684\u4f7f\u7528\u8303\u56f4 \u00b6 \u81ea\u52a8\u5316\u90e8\u7f72\u5e94\u7528 \u81ea\u52a8\u5316\u7ba1\u7406\u914d\u7f6e \u81ea\u52a8\u5316\u7684\u6301\u7eed\u4ea4\u4ed8 \u81ea\u52a8\u5316\u7684\u4e91\u670d\u52a1\u7ba1\u7406 \u81ea\u52a8\u5316\u7f51\u7edc\u8bbe\u5907\u7ba1\u7406 Ansible\u662f\u600e\u4e48\u5de5\u4f5c\u7684 \u00b6 \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd0\u884cansible\u7684\u5148\u51b3\u6761\u4ef6\u662f\uff0c\u5b89\u88c5ansible\u5230\u7ba1\u7406\u8282\u70b9\uff0c\u5b9a\u4e49\u4e3b\u673a\u6e05\u5355\uff0c\u5e76\u6709\u4e00\u4e9bplaybooks\u5b9a\u4e49\u3002 \u7b80\u8981\u7684\u6b65\u9aa4 \u5728\u63a7\u5236\u8282\u70b9\u4e0a\u5b89\u88c5 ansible \u914d\u7f6e\u4e3b\u673a\u6e05\u5355: \u5c06\u88ab\u63a7\u8282\u70b9\u7684\u8fde\u63a5\u4fe1\u606f\u914d\u7f6e\u5230\u4e3b\u673a\u6e05\u5355\u4e2d\u3002 \u5b9a\u4e49playbook: \u6307\u5b9a\u8fd0\u884c\u4e3b\u673a\u548c\u6267\u884c\u4efb\u52a1 \u8ba9\u6211\u4eec\u6765\u770b\u770b\u6211\u4eec\u5982\u4f55\u4f7f\u7528Ansible\u5c06\u6211\u4eec\u7684Ubuntu\u865a\u62df\u673a\u8f6c\u6362\u4e3aWeb\u670d\u52a1\u5668\u3002 \u60a8\u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u8fd0\u884cAnsible Playbook\uff0c\u5b83\u67e5\u770b\u60a8\u5728playbook\u4e2d\u5b9a\u4e49\u7684\u547d\u4ee4\u53c2\u6570\uff0c\u5e76\u901a\u77e5\u6211\u4eec\u5b9a\u4f4d\u5230\u7f51\u7edc\u7ec4\u4e2d\u7684\u8282\u70b9\u3002 Ansible\u7136\u540e\u8bfb\u53d6\u4e3b\u673a\u6e05\u5355\u4ee5\u67e5\u627e\u5206\u914d\u7ed9Web\u7ec4\u7684\u8282\u70b9\u3002\u5728\u8fd9\u4e00\u70b9\u4e0a\uff0cAnsible\u5df2\u7ecf\u51c6\u5907\u597d\u5f00\u59cb\u5de5\u4f5c\uff0c\u6240\u4ee5\u5b83\u5c06\u901a\u8fc7ssh\u8fdc\u7a0b\u8fde\u63a5\u5230\u5b9a\u4e49\u7684\u673a\u5668\uff0c\u901a\u5e38\u4f60\u4f1a\u60f3\u8981\u901a\u8fc7\u9884\u5171\u4eab\u5bc6\u94a5\u5efa\u7acb\u4e00\u4e9b\u7c7b\u578b\u7684ssh\u4fe1\u4efb\uff0c\u8fd9\u6837\u4f60\u5c31\u4e0d\u5fc5\u5728\u8fdb\u884cssh\u767b\u9646\u7684\u65f6\u5019\u8f93\u5165\u5bc6\u7801\u3002\u7136\u540eAnsible\u5c06\u5f00\u59cb\u9010\u6b65\u6267\u884cplaybook\u4e2d\u7684\u4efb\u52a1\uff0c\u4e00\u6b21\u4e00\u4e2a\u4efb\u52a1\uff0c\u4ece\u9876\u90e8\u5230\u5e95\u90e8\u7684\u987a\u5e8f\u904d\u5386\u5b83\u4eec\uff0c\u5c31\u50cf\u4f60\u624b\u52a8\u767b\u5f55\u6267\u884c\u4efb\u52a1\u4e00\u6837\u3002\u6240\u4ee5\uff0c\u5b83\u5b89\u88c5\u8f6f\u4ef6\u5305\uff0c\u66f4\u65b0\u914d\u7f6e\u6587\u4ef6\uff0c\u4f7f\u7528git\u90e8\u7f72\u6211\u4eec\u7684\u7f51\u7ad9\u4ee3\u7801\uff0c\u6700\u540e\u542f\u52a8\u6211\u4eec\u7684Web\u670d\u52a1\u3002\u5f53Ansible\u5f88\u6109\u5feb\u7684\u628a\u4e00\u5207\u90fd\u6309\u9884\u671f\u7684\u5b8c\u6210\uff0c\u4f60\u4f1a\u5f97\u5230\u4e00\u4e2a\u6267\u884c\u6210\u529f\u7684\u72b6\u6001\u62a5\u544a\u3002 \u53ef\u4ee5\u7528\u52a8\u56fe\u8bf4\u660e\u4e0b\u6b64\u6b21\u8fc7\u7a0b\u3002 \u5bf9\u7ba1\u7406\u4e3b\u673a\u7684\u8981\u6c42 \u00b6 \u76ee\u524d,\u53ea\u8981\u673a\u5668\u4e0a\u5b89\u88c5\u4e86 Python 2\uff08\u7248\u672c2.6\u62162.7\uff09\u6216Python 3\uff08\u7248\u672c3.5\u53ca\u66f4\u9ad8\u7248\u672c\uff09\u90fd\u53ef\u4ee5\u8fd0\u884cAnsible (windows\u7cfb\u7edf\u4e0d\u53ef\u4ee5\u505a\u7ba1\u7406\u4e3b\u673a) \u7ba1\u7406\u4e3b\u673a\u7684\u7cfb\u7edf\u53ef\u4ee5\u662f Red Hat, Debian, CentOS, OS X, BSD\u7684\u5404\u79cd\u7248\u672c. \u5bf9\u8282\u70b9\u4e3b\u673a\u7684\u8981\u6c42 \u00b6 \u901a\u5e38\u6211\u4eec\u4f7f\u7528 ssh \u4e0e\u8282\u70b9\u901a\u4fe1\uff0c\u9ed8\u8ba4\u4f7f\u7528 sftp. \u5982\u679c sftp \u4e0d\u53ef\u7528\uff0c\u53ef\u5728 ansible.cfg \u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u6210 scp \u7684\u65b9\u5f0f. \u5728\u8282\u70b9\u4e0a\u4e5f\u9700\u8981\u5b89\u88c5Python 2\uff082.6\u6216\u66f4\u9ad8\u7248\u672c\uff09\u6216Python 3\uff083.5\u6216\u66f4\u9ad8\u7248\u672c\uff09 Ansible \u6982\u5ff5 \u00b6 \u63a7\u5236\u8282\u70b9(Control node) \u00b6 \u4efb\u4f55\u88c5\u6709Ansible\u7684\u673a\u5668\u53ef\u79f0\u4e3a \u63a7\u5236\u8282\u70b9 \u3002 \u60a8\u53ef\u4ee5\u4ece\u4efb\u4f55\u63a7\u5236\u8282\u70b9\u8fd0\u884c\u547d\u4ee4\u548c\u5267\u672c\uff0c\u5e76\u8c03\u7528 /usr/bin/ansible \u6216 /usr/bin/ansible-playbook \u3002 \u60a8\u53ef\u4ee5\u5c06\u4efb\u4f55\u5b89\u88c5\u4e86Python\u7684\u8ba1\u7b97\u673a\u7528\u4f5c\u63a7\u5236\u8282\u70b9,\u7b14\u8bb0\u672c\u7535\u8111,\u5171\u4eab\u684c\u9762\u548c\u670d\u52a1\u5668\u90fd\u53ef\u4ee5\u8fd0\u884cAnsible\u3002 \u4f46\u662f\uff0c\u4e0d\u80fd\u5c06Windows\u8ba1\u7b97\u673a\u7528\u4f5c\u63a7\u5236\u8282\u70b9\u3002\u60a8\u4e5f\u53ef\u4ee5\u6709\u591a\u4e2a\u63a7\u5236\u8282\u70b9\u3002 \u7ba1\u7406\u8282\u70b9(Managed nodes) \u00b6 \u4f7f\u7528Ansible\u7ba1\u7406\u7684\u7f51\u7edc\u8bbe\u5907\u6216\u670d\u52a1\u5668\u53ef\u79f0\u4e3a \u7ba1\u7406\u8282\u70b9 \u3002 \u53d7\u7ba1\u8282\u70b9\u6709\u65f6\u4e5f\u79f0\u4e3a \u4e3b\u673a \u3002 \u53d7\u7ba1\u8282\u70b9\u4e0a\u662f\u4e0d\u9700\u8981\u5b89\u88c5Ansible\u7684\u3002 \u4e3b\u673a\u6e05\u5355(Inventory) \u00b6 \u6258\u7ba1\u8282\u70b9\u7684\u5217\u8868\u3002\u5e93\u5b58\u6587\u4ef6\u6709\u65f6\u4e5f\u79f0\u4e3a\u4e3b\u673a\u6587\u4ef6\u3002\u60a8\u7684\u76ee\u5f55\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u6258\u7ba1\u8282\u70b9\u6307\u5b9a\u8bf8\u5982IP\u5730\u5740\u4e4b\u7c7b\u7684\u4fe1\u606f\u3002\u5e93\u5b58\u8fd8\u53ef\u4ee5\u7ec4\u7ec7\u6258\u7ba1\u8282\u70b9\uff0c\u521b\u5efa\u548c\u5d4c\u5957\u7ec4\uff0c\u4ee5\u4fbf\u4e8e\u6269\u5c55\u3002\u8981\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u5e93\u5b58\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u4f7f\u7528 \u4e3b\u673a\u6e05\u5355 \u4e00\u8282\u3002 \u6a21\u5757(Modules) \u00b6 Ansible\u6267\u884c\u7684\u5177\u4f53\u4ee3\u7801\u3002\u6bcf\u4e2a\u6a21\u5757\u90fd\u6709\u7279\u5b9a\u7684\u7528\u9014\uff0c\u4ece\u7ba1\u7406\u7279\u5b9a\u7c7b\u578b\u6570\u636e\u5e93\u7684\u7528\u6237\u5230\u7ba1\u7406\u7279\u5b9a\u7c7b\u578b\u7f51\u7edc\u8bbe\u5907\u4e0a\u7684VLAN\u63a5\u53e3\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u52a1\u8c03\u7528\u5355\u4e2a\u6a21\u5757\uff0c\u4e5f\u53ef\u4ee5\u8c03\u7528\u5267\u672c\u4e2d\u7684\u51e0\u4e2a\u4e0d\u540c\u6a21\u5757\u3002\u8981\u4e86\u89e3Ansible\u5305\u542b\u591a\u5c11\u4e2a\u6a21\u5757\uff0c\u8bf7\u67e5\u770b \u6240\u6709\u6a21\u5757 \u7684\u5217\u8868\u3002 \u4efb\u52a1(Tasks) \u00b6 Ansible\u7684\u884c\u52a8\u5355\u4f4d\u3002tasks\u5305\u542b\u4e00\u7ec4\u7531module\u7ec4\u6210\u7684\u4efb\u52a1\u5217\u8868, \u60a8\u53ef\u4ee5\u4f7f\u7528\u7279\u522b\u7684\u547d\u4ee4\u4e00\u6b21\u6027\u6267\u884c\u5355\u4e2a\u4efb\u52a1\u3002 \u5267\u672c(Playbooks) \u00b6 \u4fdd\u5b58\u4e86\u5df2\u6392\u5e8f\u7684\u4efb\u52a1\u5217\u8868\uff0c\u56e0\u6b64\u53ef\u4ee5\u6309\u6b64\u987a\u5e8f\u91cd\u590d\u8fd0\u884c\u8fd9\u4e9b\u4efb\u52a1\u3002\u5267\u672c\u53ef\u4ee5\u5305\u62ec\u53d8\u91cf\u548c\u4efb\u52a1\u3002\u5267\u672c\u662f\u7528 YAML \u7f16\u5199\u7684\uff0c\u6613\u4e8e\u9605\u8bfb\u3001\u7f16\u5199\u3001\u5171\u4eab\u548c\u7406\u89e3\u3002\u8981\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u5267\u672c\u7684\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b \u5267\u672c \u3002 \u793e\u533a\u6d3b\u8dc3 \u00b6 \u7edf\u8ba1\u65f6\u95f4: 2020\u5e7404\u670806\u65e5 Ansible releases 304 Ansible modules 3387 Galaxy Roles 24,251 Github Starts 42,547 Github Fork 18,764 Github Contributors 4,955 ansible\u9879\u76ee \u00b6 Ansible Galaxy\u662f\u4e00\u4e2a\u7528\u4e8e\u67e5\u627e\uff0c\u5171\u4eab\uff0c\u4f7f\u7528Ansible role\u7684\u5728\u7ebf\u793e\u533a\u3002 https://galaxy.ansible.com/ Ansible Container\u662f\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u65e8\u5728\u5b9e\u73b0\u6574\u4e2a\u5bb9\u5668\u6784\u5efa\uff0c\u90e8\u7f72\u548c\u7ba1\u7406\u8fc7\u7a0b\u7684\u81ea\u52a8\u5316\u3002 https://github.com/ansible/ansible-container Ansible tower \u5546\u4e1a\u9879\u76ee\uff0c\u4f7f\u7528\u53ef\u89c6\u5316\u4eea\u8868\u677f\uff0c\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff0c\u4f5c\u4e1a\u8c03\u5ea6\uff0c\u96c6\u6210\u901a\u77e5\u548c\u56fe\u5f62\u5e93\u5b58\u7ba1\u7406\u6765\u96c6\u4e2d\u548c\u63a7\u5236IT\u57fa\u7840\u67b6\u6784\u3002 https://www.ansible.com/products/tower Ansible \u8bc1\u4e66 \u00b6 AUTOMATION WITH ANSIBLE I (DO407) \u4e86\u89e3\u5982\u4f55\u5b89\u88c5\u548c\u914d\u7f6eAnsible\uff0c\u521b\u5efa\u548c\u8fd0\u884c\u5267\u672c\u4ee5\u914d\u7f6e\u7cfb\u7edf\uff0c\u5e76\u5b66\u4e60\u7ba1\u7406\u4e3b\u673a\u3002 AUTOMATION WITH ANSIBLE II: RED HAT ANSIBLE TOWER (DO409) \u4e86\u89e3\u4f7f\u7528 Ansible Tower\u3002 RED HAT CERTIFICATE OF EXPERTISE IN ANSIBLE AUTOMATION (EX407) \u6d4b\u8bd5\u60a8\u4f7f\u7528Ansible\u81ea\u52a8\u914d\u7f6e\u7cfb\u7edf\u548c\u5e94\u7528\u7a0b\u5e8f\u7684\u6280\u80fd\uff0c\u77e5\u8bc6\u548c\u80fd\u529b\u3002\u901a\u8fc7\u6b64\u8003\u8bd5\uff0c\u60a8\u5c06\u83b7\u5f97Ansible Automation\u7684\u7ea2\u5e3d\u8ba4\u8bc1\u8bc1\u4e66\u3002 Ansible \u4e0e\u5176\u5b83\u914d\u7f6e\u7ba1\u7406\u7684\u5bf9\u6bd4 \u00b6 \u7b14\u8005\u9009\u62e9\u4e86\u76ee\u524d\u51e0\u6b3e\u4e3b\u6d41\u7684\u4e0e Ansible \u529f\u80fd\u7c7b\u4f3c\u7684\u914d\u7f6e\u7ba1\u7406\u8f6f\u4ef6chef\u3001 Puppet\u3001Saltstack\uff0c\u8fd9\u91cc\u6240\u505a\u7684\u5bf9\u6bd4\u4e0d\u9488\u5bf9\u5404\u4e2a\u8f6f\u4ef6\u7684\u6027\u80fd\u4f5c\u6bd4\u8f83\uff0c\u53ea\u662f\u5bf9\u5404\u4e2a\u8f6f\u4ef6\u7684\u7279\u6027\u505a\u4e2a\u5bf9\u6bd4\u3002 Ansible Chef Puppet SaltStack \u7a0b\u5e8f\u8bed\u8a00 Python Ruby\uff0cErlang C++, Clojure Python2 \u914d\u7f6e\u6587\u4ef6\u8bed\u8a00 YAML\uff0cJSON Ruby Propfietary YAML \u6570\u636e\u5e93 \u5426 PostgreSQL PuppetDB \u65e0 \u4f20\u8f93\u65b9\u5f0f Ssh RabbitMQ Mcollective ZeroMQ \u53d1\u5e03\u65b9\u5f0f Push Pull Pull Push \u7ba1\u7406\u8282\u70b9 A\uff0cB\uff0cL\uff0cO\uff0cS Linux Linux L\uff0cB \u5ba2\u6237\u7aef \u5426 A\uff0cB\uff0cL\uff0cO\uff0cS\uff0cW A\uff0cB\uff0cL\uff0cO\uff0cS\uff0cW A\uff0cB\uff0cL\uff0cO\uff0cS\uff0cW \u65e0\u4ee3\u7406 \u662f \u5426 \u5426 \u5426 \u516c\u6709\u4e91\u7248\u672c AM AM/AZ/PR \u5426 \u5426 \u516c\u6709\u4e91\u7ba1\u7406 AM/AZ/OS/GCP Fog driver AM/AZ/VM/GCP salt Cloud \u67b6\u6784 Server server/client server/client server/client \u9010\u6b65\u90e8\u7f72 \u662f \u662f \u5426 \u5426 \u4f01\u4e1a\u7248UI Ansible Tower opscode Manage Puppet Enterprise SaltStack Enterprise \u5f00\u6e90\u7248UI Semaphore Chef Manage Foreman Slatpad\uff0cSaltshaker \u4f01\u4e1a\u7248\u672c \u662f \u662f \u662f \u662f \u521b\u5efa\u65f6\u95f4 2012\u5e743\u67086\u65e5 2009\u5e741\u670816\u65e5 2010\u5e749\u670815\u65e5 2011\u5e742\u670821\u65e5 Github Starts 42,547 6,198 5,710 10,747 Github Forks 18,764 2,417 2,138 4,815 Contributors 4,955 586 536 2,078 Commits 49,775 26,017 31,751 106,129 \u7edf\u8ba1\u65f6\u95f4: 2020\u5e7404\u670806\u65e5 \u8d44\u6e90 \u00b6 \u6e90\u7801\uff1a https://github.com/ansible/ansible \u5b98\u65b9\u6587\u6863\uff1a http://docs.ansible.com/ Jinja2 \u4e2d\u6587\u6587\u6863\uff1a http://docs.jinkan.org/docs/jinja2/ yaml\u8bed\u6cd5\uff1a http://www.yaml.org/ ansible \u7535\u5b50\u4e66: https://www.ansible.com/resources/ebooks \u767d\u76ae\u4e66: https://www.ansible.com/resources/whitepapers \u7528\u6237\u6848\u4f8b: https://www.ansible.com/resources/case-studies","title":"1. Ansible \u4ecb\u7ecd"},{"location":"basic/Introduction/#1-ansible","text":"Ansible \u662f2012\u5e74\u63a8\u51fa\u7684\u4e00\u79cd\u901a\u7528\u81ea\u52a8\u5316\u5de5\u5177\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u7ba1\u7406\u6216\u5de5\u4f5c\u6d41\u7a0b\u81ea\u52a8\u5316\u3002\u914d\u7f6e\u7ba1\u7406\u662f\u4e00\u79cd\" \u57fa\u7840\u67b6\u6784\u4ee3\u7801 \"\u5b9e\u8df5\uff0c\u5b83\u5c06\u4e8b\u7269\u7f16\u7801\uff0c\u4f8b\u5982\u5e94\u8be5\u5728\u7cfb\u7edf\u4e0a\u5b89\u88c5\u4ec0\u4e48\u5305\u548c\u7248\u672c\uff0c\u6216\u8005\u5e94\u8be5\u8fd0\u884c\u4ec0\u4e48\u5b88\u62a4\u8fdb\u7a0b\u3002\u5de5\u4f5c\u6d41\u81ea\u52a8\u5316\u53ef\u80fd\u662f\u4ece\u914d\u7f6e\u57fa\u7840\u67b6\u6784\u5230\u90e8\u7f72\u8f6f\u4ef6\u7684\u4efb\u4f55\u4e8b\u60c5\u3002Ansible \u57282015\u5e74\u65f6\u88abRedhat\u516c\u53f8\u6536\u8d2d\u3002 Ansible\u662f\u7528Python\u7f16\u5199\u7684\uff0c\u5b83\u4f7f\u7528SSH\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\u6267\u884c\u547d\u4ee4\u3002Ansible\u662f\u65e0\u4ee3\u7406\u7684\uff0c\u8fd9\u4f7f\u5f97\u5165\u624b\u66f4\u5bb9\u6613\u3002\u60a8\u53ea\u9700\u8981\u5728\u76f8\u5173\u673a\u5668\u4e0a\u5b89\u88c5SSH\u548cPython\u3002Ansible\u4f7f\u7528\u58f0\u660e\u5f0fYAML\u8bed\u8a00\"playbook\"\u5c06\u4e00\u7ec4\u4e3b\u673a\uff08\"hosts\"\uff09\u6620\u5c04\u5230\u5b9a\u4e49\u660e\u786e\u7684\u89d2\u8272\u3002\u58f0\u660e\u6027\u7528\u4e8e\u6307\u793aAnsible\u5982\u4f55\u8bbe\u7f6e\u6216\u66f4\u6539\u4e8b\u7269\uff0cAnsible\u624d\u8fdb\u884c\u5fc5\u8981\u7684\u66f4\u6539\u3002","title":"1. Ansible \u4ecb\u7ecd"},{"location":"basic/Introduction/#ansible","text":"\u4e00\u5207\u81ea\u52a8\u5316","title":"Ansible \u7684\u76ee\u6807"},{"location":"basic/Introduction/#ansible_1","text":"\u81ea\u52a8\u5316\u90e8\u7f72\u5e94\u7528 \u81ea\u52a8\u5316\u7ba1\u7406\u914d\u7f6e \u81ea\u52a8\u5316\u7684\u6301\u7eed\u4ea4\u4ed8 \u81ea\u52a8\u5316\u7684\u4e91\u670d\u52a1\u7ba1\u7406 \u81ea\u52a8\u5316\u7f51\u7edc\u8bbe\u5907\u7ba1\u7406","title":"ansible\u7684\u4f7f\u7528\u8303\u56f4"},{"location":"basic/Introduction/#ansible_2","text":"\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd0\u884cansible\u7684\u5148\u51b3\u6761\u4ef6\u662f\uff0c\u5b89\u88c5ansible\u5230\u7ba1\u7406\u8282\u70b9\uff0c\u5b9a\u4e49\u4e3b\u673a\u6e05\u5355\uff0c\u5e76\u6709\u4e00\u4e9bplaybooks\u5b9a\u4e49\u3002 \u7b80\u8981\u7684\u6b65\u9aa4 \u5728\u63a7\u5236\u8282\u70b9\u4e0a\u5b89\u88c5 ansible \u914d\u7f6e\u4e3b\u673a\u6e05\u5355: \u5c06\u88ab\u63a7\u8282\u70b9\u7684\u8fde\u63a5\u4fe1\u606f\u914d\u7f6e\u5230\u4e3b\u673a\u6e05\u5355\u4e2d\u3002 \u5b9a\u4e49playbook: \u6307\u5b9a\u8fd0\u884c\u4e3b\u673a\u548c\u6267\u884c\u4efb\u52a1 \u8ba9\u6211\u4eec\u6765\u770b\u770b\u6211\u4eec\u5982\u4f55\u4f7f\u7528Ansible\u5c06\u6211\u4eec\u7684Ubuntu\u865a\u62df\u673a\u8f6c\u6362\u4e3aWeb\u670d\u52a1\u5668\u3002 \u60a8\u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u8fd0\u884cAnsible Playbook\uff0c\u5b83\u67e5\u770b\u60a8\u5728playbook\u4e2d\u5b9a\u4e49\u7684\u547d\u4ee4\u53c2\u6570\uff0c\u5e76\u901a\u77e5\u6211\u4eec\u5b9a\u4f4d\u5230\u7f51\u7edc\u7ec4\u4e2d\u7684\u8282\u70b9\u3002 Ansible\u7136\u540e\u8bfb\u53d6\u4e3b\u673a\u6e05\u5355\u4ee5\u67e5\u627e\u5206\u914d\u7ed9Web\u7ec4\u7684\u8282\u70b9\u3002\u5728\u8fd9\u4e00\u70b9\u4e0a\uff0cAnsible\u5df2\u7ecf\u51c6\u5907\u597d\u5f00\u59cb\u5de5\u4f5c\uff0c\u6240\u4ee5\u5b83\u5c06\u901a\u8fc7ssh\u8fdc\u7a0b\u8fde\u63a5\u5230\u5b9a\u4e49\u7684\u673a\u5668\uff0c\u901a\u5e38\u4f60\u4f1a\u60f3\u8981\u901a\u8fc7\u9884\u5171\u4eab\u5bc6\u94a5\u5efa\u7acb\u4e00\u4e9b\u7c7b\u578b\u7684ssh\u4fe1\u4efb\uff0c\u8fd9\u6837\u4f60\u5c31\u4e0d\u5fc5\u5728\u8fdb\u884cssh\u767b\u9646\u7684\u65f6\u5019\u8f93\u5165\u5bc6\u7801\u3002\u7136\u540eAnsible\u5c06\u5f00\u59cb\u9010\u6b65\u6267\u884cplaybook\u4e2d\u7684\u4efb\u52a1\uff0c\u4e00\u6b21\u4e00\u4e2a\u4efb\u52a1\uff0c\u4ece\u9876\u90e8\u5230\u5e95\u90e8\u7684\u987a\u5e8f\u904d\u5386\u5b83\u4eec\uff0c\u5c31\u50cf\u4f60\u624b\u52a8\u767b\u5f55\u6267\u884c\u4efb\u52a1\u4e00\u6837\u3002\u6240\u4ee5\uff0c\u5b83\u5b89\u88c5\u8f6f\u4ef6\u5305\uff0c\u66f4\u65b0\u914d\u7f6e\u6587\u4ef6\uff0c\u4f7f\u7528git\u90e8\u7f72\u6211\u4eec\u7684\u7f51\u7ad9\u4ee3\u7801\uff0c\u6700\u540e\u542f\u52a8\u6211\u4eec\u7684Web\u670d\u52a1\u3002\u5f53Ansible\u5f88\u6109\u5feb\u7684\u628a\u4e00\u5207\u90fd\u6309\u9884\u671f\u7684\u5b8c\u6210\uff0c\u4f60\u4f1a\u5f97\u5230\u4e00\u4e2a\u6267\u884c\u6210\u529f\u7684\u72b6\u6001\u62a5\u544a\u3002 \u53ef\u4ee5\u7528\u52a8\u56fe\u8bf4\u660e\u4e0b\u6b64\u6b21\u8fc7\u7a0b\u3002","title":"Ansible\u662f\u600e\u4e48\u5de5\u4f5c\u7684"},{"location":"basic/Introduction/#_1","text":"\u76ee\u524d,\u53ea\u8981\u673a\u5668\u4e0a\u5b89\u88c5\u4e86 Python 2\uff08\u7248\u672c2.6\u62162.7\uff09\u6216Python 3\uff08\u7248\u672c3.5\u53ca\u66f4\u9ad8\u7248\u672c\uff09\u90fd\u53ef\u4ee5\u8fd0\u884cAnsible (windows\u7cfb\u7edf\u4e0d\u53ef\u4ee5\u505a\u7ba1\u7406\u4e3b\u673a) \u7ba1\u7406\u4e3b\u673a\u7684\u7cfb\u7edf\u53ef\u4ee5\u662f Red Hat, Debian, CentOS, OS X, BSD\u7684\u5404\u79cd\u7248\u672c.","title":"\u5bf9\u7ba1\u7406\u4e3b\u673a\u7684\u8981\u6c42"},{"location":"basic/Introduction/#_2","text":"\u901a\u5e38\u6211\u4eec\u4f7f\u7528 ssh \u4e0e\u8282\u70b9\u901a\u4fe1\uff0c\u9ed8\u8ba4\u4f7f\u7528 sftp. \u5982\u679c sftp \u4e0d\u53ef\u7528\uff0c\u53ef\u5728 ansible.cfg \u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u6210 scp \u7684\u65b9\u5f0f. \u5728\u8282\u70b9\u4e0a\u4e5f\u9700\u8981\u5b89\u88c5Python 2\uff082.6\u6216\u66f4\u9ad8\u7248\u672c\uff09\u6216Python 3\uff083.5\u6216\u66f4\u9ad8\u7248\u672c\uff09","title":"\u5bf9\u8282\u70b9\u4e3b\u673a\u7684\u8981\u6c42"},{"location":"basic/Introduction/#ansible_3","text":"","title":"Ansible \u6982\u5ff5"},{"location":"basic/Introduction/#control-node","text":"\u4efb\u4f55\u88c5\u6709Ansible\u7684\u673a\u5668\u53ef\u79f0\u4e3a \u63a7\u5236\u8282\u70b9 \u3002 \u60a8\u53ef\u4ee5\u4ece\u4efb\u4f55\u63a7\u5236\u8282\u70b9\u8fd0\u884c\u547d\u4ee4\u548c\u5267\u672c\uff0c\u5e76\u8c03\u7528 /usr/bin/ansible \u6216 /usr/bin/ansible-playbook \u3002 \u60a8\u53ef\u4ee5\u5c06\u4efb\u4f55\u5b89\u88c5\u4e86Python\u7684\u8ba1\u7b97\u673a\u7528\u4f5c\u63a7\u5236\u8282\u70b9,\u7b14\u8bb0\u672c\u7535\u8111,\u5171\u4eab\u684c\u9762\u548c\u670d\u52a1\u5668\u90fd\u53ef\u4ee5\u8fd0\u884cAnsible\u3002 \u4f46\u662f\uff0c\u4e0d\u80fd\u5c06Windows\u8ba1\u7b97\u673a\u7528\u4f5c\u63a7\u5236\u8282\u70b9\u3002\u60a8\u4e5f\u53ef\u4ee5\u6709\u591a\u4e2a\u63a7\u5236\u8282\u70b9\u3002","title":"\u63a7\u5236\u8282\u70b9(Control node)"},{"location":"basic/Introduction/#managed-nodes","text":"\u4f7f\u7528Ansible\u7ba1\u7406\u7684\u7f51\u7edc\u8bbe\u5907\u6216\u670d\u52a1\u5668\u53ef\u79f0\u4e3a \u7ba1\u7406\u8282\u70b9 \u3002 \u53d7\u7ba1\u8282\u70b9\u6709\u65f6\u4e5f\u79f0\u4e3a \u4e3b\u673a \u3002 \u53d7\u7ba1\u8282\u70b9\u4e0a\u662f\u4e0d\u9700\u8981\u5b89\u88c5Ansible\u7684\u3002","title":"\u7ba1\u7406\u8282\u70b9(Managed nodes)"},{"location":"basic/Introduction/#inventory","text":"\u6258\u7ba1\u8282\u70b9\u7684\u5217\u8868\u3002\u5e93\u5b58\u6587\u4ef6\u6709\u65f6\u4e5f\u79f0\u4e3a\u4e3b\u673a\u6587\u4ef6\u3002\u60a8\u7684\u76ee\u5f55\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u6258\u7ba1\u8282\u70b9\u6307\u5b9a\u8bf8\u5982IP\u5730\u5740\u4e4b\u7c7b\u7684\u4fe1\u606f\u3002\u5e93\u5b58\u8fd8\u53ef\u4ee5\u7ec4\u7ec7\u6258\u7ba1\u8282\u70b9\uff0c\u521b\u5efa\u548c\u5d4c\u5957\u7ec4\uff0c\u4ee5\u4fbf\u4e8e\u6269\u5c55\u3002\u8981\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u5e93\u5b58\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u4f7f\u7528 \u4e3b\u673a\u6e05\u5355 \u4e00\u8282\u3002","title":"\u4e3b\u673a\u6e05\u5355(Inventory)"},{"location":"basic/Introduction/#modules","text":"Ansible\u6267\u884c\u7684\u5177\u4f53\u4ee3\u7801\u3002\u6bcf\u4e2a\u6a21\u5757\u90fd\u6709\u7279\u5b9a\u7684\u7528\u9014\uff0c\u4ece\u7ba1\u7406\u7279\u5b9a\u7c7b\u578b\u6570\u636e\u5e93\u7684\u7528\u6237\u5230\u7ba1\u7406\u7279\u5b9a\u7c7b\u578b\u7f51\u7edc\u8bbe\u5907\u4e0a\u7684VLAN\u63a5\u53e3\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u52a1\u8c03\u7528\u5355\u4e2a\u6a21\u5757\uff0c\u4e5f\u53ef\u4ee5\u8c03\u7528\u5267\u672c\u4e2d\u7684\u51e0\u4e2a\u4e0d\u540c\u6a21\u5757\u3002\u8981\u4e86\u89e3Ansible\u5305\u542b\u591a\u5c11\u4e2a\u6a21\u5757\uff0c\u8bf7\u67e5\u770b \u6240\u6709\u6a21\u5757 \u7684\u5217\u8868\u3002","title":"\u6a21\u5757(Modules)"},{"location":"basic/Introduction/#tasks","text":"Ansible\u7684\u884c\u52a8\u5355\u4f4d\u3002tasks\u5305\u542b\u4e00\u7ec4\u7531module\u7ec4\u6210\u7684\u4efb\u52a1\u5217\u8868, \u60a8\u53ef\u4ee5\u4f7f\u7528\u7279\u522b\u7684\u547d\u4ee4\u4e00\u6b21\u6027\u6267\u884c\u5355\u4e2a\u4efb\u52a1\u3002","title":"\u4efb\u52a1(Tasks)"},{"location":"basic/Introduction/#playbooks","text":"\u4fdd\u5b58\u4e86\u5df2\u6392\u5e8f\u7684\u4efb\u52a1\u5217\u8868\uff0c\u56e0\u6b64\u53ef\u4ee5\u6309\u6b64\u987a\u5e8f\u91cd\u590d\u8fd0\u884c\u8fd9\u4e9b\u4efb\u52a1\u3002\u5267\u672c\u53ef\u4ee5\u5305\u62ec\u53d8\u91cf\u548c\u4efb\u52a1\u3002\u5267\u672c\u662f\u7528 YAML \u7f16\u5199\u7684\uff0c\u6613\u4e8e\u9605\u8bfb\u3001\u7f16\u5199\u3001\u5171\u4eab\u548c\u7406\u89e3\u3002\u8981\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u5267\u672c\u7684\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b \u5267\u672c \u3002","title":"\u5267\u672c(Playbooks)"},{"location":"basic/Introduction/#_3","text":"\u7edf\u8ba1\u65f6\u95f4: 2020\u5e7404\u670806\u65e5 Ansible releases 304 Ansible modules 3387 Galaxy Roles 24,251 Github Starts 42,547 Github Fork 18,764 Github Contributors 4,955","title":"\u793e\u533a\u6d3b\u8dc3"},{"location":"basic/Introduction/#ansible_4","text":"Ansible Galaxy\u662f\u4e00\u4e2a\u7528\u4e8e\u67e5\u627e\uff0c\u5171\u4eab\uff0c\u4f7f\u7528Ansible role\u7684\u5728\u7ebf\u793e\u533a\u3002 https://galaxy.ansible.com/ Ansible Container\u662f\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u65e8\u5728\u5b9e\u73b0\u6574\u4e2a\u5bb9\u5668\u6784\u5efa\uff0c\u90e8\u7f72\u548c\u7ba1\u7406\u8fc7\u7a0b\u7684\u81ea\u52a8\u5316\u3002 https://github.com/ansible/ansible-container Ansible tower \u5546\u4e1a\u9879\u76ee\uff0c\u4f7f\u7528\u53ef\u89c6\u5316\u4eea\u8868\u677f\uff0c\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff0c\u4f5c\u4e1a\u8c03\u5ea6\uff0c\u96c6\u6210\u901a\u77e5\u548c\u56fe\u5f62\u5e93\u5b58\u7ba1\u7406\u6765\u96c6\u4e2d\u548c\u63a7\u5236IT\u57fa\u7840\u67b6\u6784\u3002 https://www.ansible.com/products/tower","title":"ansible\u9879\u76ee"},{"location":"basic/Introduction/#ansible_5","text":"AUTOMATION WITH ANSIBLE I (DO407) \u4e86\u89e3\u5982\u4f55\u5b89\u88c5\u548c\u914d\u7f6eAnsible\uff0c\u521b\u5efa\u548c\u8fd0\u884c\u5267\u672c\u4ee5\u914d\u7f6e\u7cfb\u7edf\uff0c\u5e76\u5b66\u4e60\u7ba1\u7406\u4e3b\u673a\u3002 AUTOMATION WITH ANSIBLE II: RED HAT ANSIBLE TOWER (DO409) \u4e86\u89e3\u4f7f\u7528 Ansible Tower\u3002 RED HAT CERTIFICATE OF EXPERTISE IN ANSIBLE AUTOMATION (EX407) \u6d4b\u8bd5\u60a8\u4f7f\u7528Ansible\u81ea\u52a8\u914d\u7f6e\u7cfb\u7edf\u548c\u5e94\u7528\u7a0b\u5e8f\u7684\u6280\u80fd\uff0c\u77e5\u8bc6\u548c\u80fd\u529b\u3002\u901a\u8fc7\u6b64\u8003\u8bd5\uff0c\u60a8\u5c06\u83b7\u5f97Ansible Automation\u7684\u7ea2\u5e3d\u8ba4\u8bc1\u8bc1\u4e66\u3002","title":"Ansible \u8bc1\u4e66"},{"location":"basic/Introduction/#ansible_6","text":"\u7b14\u8005\u9009\u62e9\u4e86\u76ee\u524d\u51e0\u6b3e\u4e3b\u6d41\u7684\u4e0e Ansible \u529f\u80fd\u7c7b\u4f3c\u7684\u914d\u7f6e\u7ba1\u7406\u8f6f\u4ef6chef\u3001 Puppet\u3001Saltstack\uff0c\u8fd9\u91cc\u6240\u505a\u7684\u5bf9\u6bd4\u4e0d\u9488\u5bf9\u5404\u4e2a\u8f6f\u4ef6\u7684\u6027\u80fd\u4f5c\u6bd4\u8f83\uff0c\u53ea\u662f\u5bf9\u5404\u4e2a\u8f6f\u4ef6\u7684\u7279\u6027\u505a\u4e2a\u5bf9\u6bd4\u3002 Ansible Chef Puppet SaltStack \u7a0b\u5e8f\u8bed\u8a00 Python Ruby\uff0cErlang C++, Clojure Python2 \u914d\u7f6e\u6587\u4ef6\u8bed\u8a00 YAML\uff0cJSON Ruby Propfietary YAML \u6570\u636e\u5e93 \u5426 PostgreSQL PuppetDB \u65e0 \u4f20\u8f93\u65b9\u5f0f Ssh RabbitMQ Mcollective ZeroMQ \u53d1\u5e03\u65b9\u5f0f Push Pull Pull Push \u7ba1\u7406\u8282\u70b9 A\uff0cB\uff0cL\uff0cO\uff0cS Linux Linux L\uff0cB \u5ba2\u6237\u7aef \u5426 A\uff0cB\uff0cL\uff0cO\uff0cS\uff0cW A\uff0cB\uff0cL\uff0cO\uff0cS\uff0cW A\uff0cB\uff0cL\uff0cO\uff0cS\uff0cW \u65e0\u4ee3\u7406 \u662f \u5426 \u5426 \u5426 \u516c\u6709\u4e91\u7248\u672c AM AM/AZ/PR \u5426 \u5426 \u516c\u6709\u4e91\u7ba1\u7406 AM/AZ/OS/GCP Fog driver AM/AZ/VM/GCP salt Cloud \u67b6\u6784 Server server/client server/client server/client \u9010\u6b65\u90e8\u7f72 \u662f \u662f \u5426 \u5426 \u4f01\u4e1a\u7248UI Ansible Tower opscode Manage Puppet Enterprise SaltStack Enterprise \u5f00\u6e90\u7248UI Semaphore Chef Manage Foreman Slatpad\uff0cSaltshaker \u4f01\u4e1a\u7248\u672c \u662f \u662f \u662f \u662f \u521b\u5efa\u65f6\u95f4 2012\u5e743\u67086\u65e5 2009\u5e741\u670816\u65e5 2010\u5e749\u670815\u65e5 2011\u5e742\u670821\u65e5 Github Starts 42,547 6,198 5,710 10,747 Github Forks 18,764 2,417 2,138 4,815 Contributors 4,955 586 536 2,078 Commits 49,775 26,017 31,751 106,129 \u7edf\u8ba1\u65f6\u95f4: 2020\u5e7404\u670806\u65e5","title":"Ansible \u4e0e\u5176\u5b83\u914d\u7f6e\u7ba1\u7406\u7684\u5bf9\u6bd4"},{"location":"basic/Introduction/#_4","text":"\u6e90\u7801\uff1a https://github.com/ansible/ansible \u5b98\u65b9\u6587\u6863\uff1a http://docs.ansible.com/ Jinja2 \u4e2d\u6587\u6587\u6863\uff1a http://docs.jinkan.org/docs/jinja2/ yaml\u8bed\u6cd5\uff1a http://www.yaml.org/ ansible \u7535\u5b50\u4e66: https://www.ansible.com/resources/ebooks \u767d\u76ae\u4e66: https://www.ansible.com/resources/whitepapers \u7528\u6237\u6848\u4f8b: https://www.ansible.com/resources/case-studies","title":"\u8d44\u6e90"},{"location":"basic/Inventory/","text":"4. \u8ba4\u8bc6\u4e3b\u673a\u6e05\u5355 \u00b6 Ansible \u53ef\u540c\u65f6\u64cd\u4f5c\u5c5e\u4e8e\u4e00\u4e2a\u7ec4\u7684\u591a\u53f0\u4e3b\u673a, \u7ec4\u548c\u4e3b\u673a\u4e4b\u95f4\u7684\u5173\u7cfb\u901a\u8fc7 inventory \u6587\u4ef6\u914d\u7f6e. \u9ed8\u8ba4\u7684\u6587\u4ef6\u8def\u5f84\u4e3a /etc/ansible/hosts , \u6267\u884c\u547d\u4ee4\u7684\u65f6\u5019\u4f7f\u7528 -i \u53c2\u6570\u5373\u53ef\u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u3002 \u4e3b\u673a\u6e05\u5355\u793a\u4f8b \u00b6 \u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u4e3b\u8981\u6709 ini \u548c yaml \u683c\u5f0f\u4e24\u79cd\u8bed\u6cd5\u683c\u5f0f mail.example.com # \u5b9a\u4e49\u4e3b\u673afqdn\u5730\u5740, \u4e14\u5df2\u7ecf\u4e0e\u63a7\u5236\u8282\u70b9ssh\u4e92\u4fe1 [webservers] # \u65b9\u62ec\u53f7[]\u4e2d\u662f\u7ec4\u540d host1 # \u5b9a\u4e49\u4e3b\u673a\u540d\u79f0, \u4e14\u5df2\u7ecf\u4e0e\u63a7\u5236\u8282\u70b9ssh\u4e92\u4fe1 host2:5522 # \u6307\u5b9a\u8fde\u63a5\u4e3b\u673a\u548c\u7aef\u53e3\u53f7 localhost ansible_connection = local # ansible_connection\u53ef\u4ee5\u5b9a\u4e49\u8fde\u63a5\u7c7b\u578b, local\u662f\u5728\u672c\u5730\u6267\u884c host3 http_port = 80 maxRequestsPerChild=808 # \u5b9a\u4e49\u4e3b\u673a\u53d8\u91cf, \u9664\u4e86ansible\u5b9a\u4e49\u7684\u7279\u6b8a\u540d\u79f0\u5916\uff0c\u5176\u4ed6\u7684\u90fd\u662f\u4e3b\u673a\u53d8\u91cf host4 ansible_host = 192.168.1.50 ansible_port=2222 ansible_user=root ansible_password=12345 # \u6307\u5b9a\u522b\u540d\uff0c\u5b9a\u4e49\u4e3b\u673assh\u8fde\u63a5\u4fe1\u606f www[1:50].example.com # \u5b9a\u4e49 1-50\u8303\u56f4\u5185\u7684\u4e3b\u673a www-[a:f].example.com # \u5b9a\u4e49 a-f \u8303\u56f4\u5185\u5185\u7684\u4e3b\u673a [dbservers] three.example.com ansible_python_interpreter = /usr/local/bin/python3 # \u5b9a\u4e49python\u6267\u884cansible\uff0c\u8fd9\u4e2a\u662f\u6307\u5b9a\u88ab\u63a7\u8282\u70b9\u7684\u3002 192.168.77.123 ansible_ruby_interpreter = /usr/bin/ruby.1.9.3 # \u5b9a\u4e49ruby\u6267\u884c\u6587\u4ef6 [webservers:vars] # \u5b9a\u4e49webservers\u7ec4\u7684\u53d8\u91cf ntp_server = ntp.example.com proxy = proxy.example.com [server:children] # \u5b9a\u4e49server\u7ec4\u7684\u5b50\u6210\u5458 webservers dbservers [server:vars] # \u5b9a\u4e49server\u7ec4\u7684\u53d8\u91cf zabbix_server:192.168.77.121 \u4e0a\u5217\u914d\u7f6e\u7684\u4e00\u4e9b\u89e3\u91ca\uff1a \u4e3b\u673a\u53ef\u4ee5\u5728\u591a\u4e2a\u7ec4\u4e2d\u914d\u7f6e\u3002 ansible_connection \u662f\u6267\u884c\u4e3b\u673a\u7684\u8fde\u63a5\u7c7b\u578b\uff0c\u9ed8\u8ba4\u662fsmart ansible_host \u4e3b\u673assh\u8fde\u63a5\u5730\u5740 ansible_port \u4e3b\u673assh\u8fde\u63a5\u7aef\u53e3 ansible_user \u4e3b\u673assh\u8fde\u63a5\u7528\u6237 ansible_password \u4e3b\u673assh\u8fde\u63a5\u7528\u6237\u5bc6\u7801 ansible_python_interpreter \u6307\u5b9apython\u7684\u6267\u884c\u8def\u5f84 [webservers:vars] \u5b9a\u4e49webservers\u7ec4\u7684\u53d8\u91cf [server:children] \u5b9a\u4e49server\u7ec4\u7684\u5b50\u6210\u5458 \u4e5f\u53ef\u4f7f\u4f7f\u7528yaml\u683c\u5f0f\u6765\u8868\u793a all : children : \u200b usa : \u200b children : \u200b southeast : \u200b children : \u200b atlanta : \u200b hosts : \u200b host1 : \u200b host2 : \u200b raleigh : \u200b hosts : \u200b host2 : \u200b host3 : \u200b vars : \u200b some_server : foo.southeast.example.com \u200b halon_system_timeout : 30 \u200b self_destruct_countdown : 60 \u200b escape_pods : 2 \u200b northeast : \u200b northwest : \u200b southwest : yaml\u683c\u5f0f\u914d\u7f6e\u7684\u8fd8\u662f\u633a\u590d\u6742\u7684\uff0c\u53ef\u8bfb\u6027\u4e5f\u5dee\uff0c\u5efa\u8bae\u4f7f\u7528 ini \u65b9\u5f0f\u6765\u8bbe\u7f6e\u4e3b\u673a\u6e05\u5355\u3002 \u9ed8\u8ba4\u7ec4 \u00b6 \u5728\u4e3b\u673a\u6e05\u5355\u4e2d\uff0cansible\u4f1a\u81ea\u52a8\u7684\u751f\u6210\u4e24\u4e2a\u7ec4\u3002 all \u6240\u6709\u7684\u4e3b\u673a\u3002 ungrouped \u5305\u542b\u6ca1\u6709\u7ec4\u7684\u4e3b\u673a\u3002 \u5c3d\u7ba1\u8fd9\u4e24\u4e2a\u7ec4\u662f\u6c38\u8fdc\u5b58\u5728\u7684\uff0c\u4f46\u4e5f\u6709\u53ef\u80fd\u662f\u9690\u85cf\u7684\uff0c\u4e0d\u4f1a\u51fa\u73b0group_names\u4e4b\u7c7b\u7684\u7ec4\u5217\u8868\u4e2d\u3002 \u4e3b\u673a\u53d8\u91cf\u548c\u7ec4\u53d8\u91cf \u00b6 \u5982\u679c\u4f60\u4e0d\u60f3\u5728\u4e3b\u673a\u6e05\u5355\u4e2d\u5b9a\u4e49\u4e3b\u673a\u7684\u53d8\u91cf\u6216\u8005\u7ec4\u7684\u53d8\u91cf\uff0cansible\u8fd8\u652f\u6301\u5728\u7279\u5b9a\u7684\u76ee\u5f55\u4e2d\u5b9a\u4e49\u53d8\u91cf\u3002 \u53d8\u91cf\u6587\u4ef6\u5fc5\u987b\u4ee5yaml\u8bed\u6cd5\u5b9a\u4e49\u3002 \u5982\u9ed8\u8ba4\u5728 /etc/ansible/host_vars/ \u76ee\u5f55\u4e2d\u5b9a\u4e49\u4e3b\u673a\u53d8\u91cf\uff0c\u6587\u4ef6\u540d\u79f0\u4ee5\u4e3b\u673a\u540d\u79f0\u547d\u540d\uff0c\u7ed3\u675f\u53ef\u4ee5\u7528'.yml', '.yaml', '.json'\u4e09\u79cd\u683c\u5f0f\u3002 cat /etc/ansible/host_vars/host1 --- ntp_server: acme.example.org database_server: storage.example.org \u5982\u9ed8\u8ba4\u5728 /etc/ansible/group_vars/ \u76ee\u5f55\u4e2d\u5b9a\u4e49\u7ec4\u53d8\u91cf\uff0c\u6587\u4ef6\u540d\u79f0\u4ee5\u7ec4\u540d\u79f0\u547d\u540d\uff0c\u7ed3\u675f\u53ef\u4ee5\u7528'.yml', '.yaml', '.json'\u4e09\u79cd\u683c\u5f0f\u3002 cat /etc/ansible/group_vars/webservers --- ntp_server: acme.example.org database_server: storage.example.org \u53d8\u91cf\u5408\u5e76 \u00b6 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u591a\u79cd\u65b9\u5f0f\u7ed9\u4e3b\u673a\u5b9a\u4e49\u53d8\u91cf\uff0c\u5982\u679c\u5728\u5404\u4e2a\u73af\u8282\u90fd\u8bbe\u7f6e\u4e86\u53d8\u91cf\uff0c\u5230\u5e95\u54ea\u4e2a\u53d8\u91cf\u751f\u6548\u5462\uff1f\u8fd9\u5c31\u8981\u770bansible\u7684\u53d8\u91cf\u4f18\u5148\u7ea7\uff0c\u4f18\u5148\u7ea7\u9ad8\u7684\u4f1a\u8986\u76d6\u4f18\u5148\u7ea7\u4f4e\u7684\u53d8\u91cf\u3002 \u4f18\u5148\u987a\u5e8f\uff0call\u6700\u4f4e\uff0chost\u6700\u9ad8 all group parent group child group host \u76f8\u540c\u7ec4\u65f6\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6309\u5b57\u6bcd\u987a\u5e8f\u540e\u9762\u7ec4\u7684\u5b9a\u4e49\u4f1a\u8986\u76d6\u524d\u9762\u7684\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528ansible_group_priority\u8c03\u6574\u4f18\u5148\u7ea7\uff0c\u6570\u503c\u8d8a\u5927\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff0c\u9ed8\u8ba4\u4e3a1\uff0c\u76f8\u540c\u4f18\u5148\u7ea7\u65f6\uff0c\u540e\u8005\u4f18\u5148\u3002 [a_group:vars] testvar = a ansible_group_priority = 10 [b_group] testvar = b \u4f7f\u7528\u591a\u4e2a\u4e3b\u673a\u6e05\u5355 \u00b6 \u5728\u547d\u4ee4\u53c2\u6570\u4e2d\uff0c\u4f7f\u7528\u591a\u4e2a -i \u5c31\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u4e3b\u673a\u6e05\u5355 ansible all -i staging -i production -m ping ansible all -i /tmp/staging -i /tmp/production -m ping \u4e5f\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u76ee\u5f55 inventory/ 01-openstack.yml # configure inventory plugin to get hosts from Openstack cloud 02-dynamic-inventory.py # add additional hosts with dynamic inventory script 03-static-inventory # add static hosts group_vars/ all.yml # assign variables to all hosts ansible all -i inventory -m ping \u4e3b\u673a\u5185\u7f6e\u53d8\u91cf\u5217\u8868 \u00b6 \u7528\u4e8e\u4e3b\u673a\u8fde\u63a5 \u53c2\u6570 \u63cf\u8ff0 ansible_connection \u4e0e\u4e3b\u673a\u7684\u8fde\u63a5\u7c7b\u578b.\u6bd4\u5982:local, ssh \u6216\u8005 paramiko. Ansible 1.2 \u4ee5\u524d\u9ed8\u8ba4\u4f7f\u7528 paramiko.1.2 \u4ee5\u540e\u9ed8\u8ba4\u4f7f\u7528 'smart','smart' \u65b9\u5f0f\u4f1a\u6839\u636e\u662f\u5426\u652f\u6301 ControlPersist, \u6765\u5224\u65ad'ssh' \u65b9\u5f0f\u662f\u5426\u53ef\u884c. \u7528\u4e8e\u6240\u6709\u8fde\u63a5 \u53c2\u6570 \u63cf\u8ff0 ansible_host \u5c06\u8981\u8fde\u63a5\u7684\u8fdc\u7a0b\u4e3b\u673a\u540d.\u4e0e\u4f60\u60f3\u8981\u8bbe\u5b9a\u7684\u4e3b\u673a\u7684\u522b\u540d\u4e0d\u540c\u7684\u8bdd,\u53ef\u901a\u8fc7\u6b64\u53d8\u91cf\u8bbe\u7f6e. ansible_port \u8fde\u63a5\u7aef\u53e3\u53f7\uff0c\u5982\u679c\u662fssh\u7684\u8bdd\uff0c\u9ed8\u8ba4\u662f22 ansible_user \u7528\u4e8e\u8fde\u63a5\u8ba4\u8bc1\u7684\u7528\u6237\u540d ansible_password \u7528\u4e8e\u8fde\u63a5\u8ba4\u8bc1\u7684\u7528\u6237\u540d\u5bc6\u7801 ssh\u8fde\u63a5\u53c2\u6570 \u53c2\u6570 \u63cf\u8ff0 ansible_ssh_private_key_file ssh \u4f7f\u7528\u7684\u79c1\u94a5\u6587\u4ef6.\u9002\u7528\u4e8e\u6709\u591a\u4e2a\u5bc6\u94a5,\u800c\u4f60\u4e0d\u60f3\u4f7f\u7528 SSH \u4ee3\u7406\u7684\u60c5\u51b5. ansible_ssh_common_args \u6b64\u8bbe\u7f6e\u9644\u52a0\u5230sftp\uff0cscp\u548cssh\u7684\u7f3a\u7701\u547d\u4ee4\u884c ansible_sftp_extra_args \u6b64\u8bbe\u7f6e\u9644\u52a0\u5230\u9ed8\u8ba4sftp\u547d\u4ee4\u884c\u3002 ansible_scp_extra_args \u6b64\u8bbe\u7f6e\u9644\u52a0\u5230\u9ed8\u8ba4scp\u547d\u4ee4\u884c\u3002 ansible_ssh_extra_args \u6b64\u8bbe\u7f6e\u9644\u52a0\u5230\u9ed8\u8ba4ssh\u547d\u4ee4\u884c\u3002 ansible_ssh_pipelining \u786e\u5b9a\u662f\u5426\u4f7f\u7528SSH\u7ba1\u9053\u3002\u8fd9\u53ef\u4ee5\u8986\u76d6ansible.cfg\u4e2d\u5f97\u8bbe\u7f6e\u3002 ansible_ssh_executable ssh\u53ef\u6267\u884c\u6587\u4ef6 \u6743\u9650\u63d0\u5347\u53c2\u6570 \u53c2\u6570 \u63cf\u8ff0 ansible_become \u5f00\u542f\u63d0\u6743\uff0c\u7b49\u540c\u4e8e ansible_sudo \uff0c ansible_su ansible_become_method \u63d0\u6743\u65b9\u5f0f ansible_become_user \u63d0\u6743\u7528\u6237\uff0c\u7b49\u540c\u4e8e ansible_sudo_user \uff0c ansible_su_user ansible_become_password \u63d0\u6743\u5bc6\u7801,\u7b49\u540c\u4e8e ansible_sudo_password \uff0c ansible_su_password ansible_become_exe \u63d0\u6743\u6240\u7528\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u7b49\u540c\u4e8e ansible_sudo_exe , ansible_su_exe ansible_become_flags \u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570\uff0c\u7b49\u540c\u4e8e ansible_sudo_flags , ansible_su_flags \u8fdc\u7a0b\u4e3b\u673a\u73af\u5883\u53c2\u6570 \u53c2\u6570 \u63cf\u8ff0 ansible_shell_type \u76ee\u6807\u7cfb\u7edf\u7684shell\u7c7b\u578b.\u9ed8\u8ba4\u60c5\u51b5\u4e0b,\u547d\u4ee4\u7684\u6267\u884c\u4f7f\u7528 'sh' \u8bed\u6cd5,\u53ef\u8bbe\u7f6e\u4e3a 'csh' \u6216 'fish'. ansible_python_interpreter \u76ee\u6807\u4e3b\u673a\u7684 python \u8def\u5f84.\u9002\u7528\u4e8e\u7684\u60c5\u51b5: \u7cfb\u7edf\u4e2d\u6709\u591a\u4e2a Python, \u6216\u8005\u547d\u4ee4\u8def\u5f84\u4e0d\u662f\"/usr/bin/python\",\u6bd4\u5982 *BSD, \u6216\u8005 /usr/bin/python ansible_*_interpreter \u8fd9\u91cc\u7684\"*\"\u53ef\u4ee5\u662f ruby \u6216 perl \u6216\u5176\u4ed6\u8bed\u8a00\u7684\u89e3\u91ca\u5668\uff0c\u4f5c\u7528\u548cansible_python_interpreter \u7c7b\u4f3c ansible_shell_executable \u8fd9\u5c06\u8bbe\u7f6eansible\u63a7\u5236\u5668\u5c06\u5728\u76ee\u6807\u673a\u5668\u4e0a\u4f7f\u7528\u7684shell\uff0c\u8986\u76d6ansible.cfg\u4e2d\u7684\u914d\u7f6e\uff0c\u9ed8\u8ba4\u4e3a/bin/sh\u3002 \u975eSSH\u8fde\u63a5\u7c7b\u578b\u53c2\u6570 ansible\u9ed8\u8ba4\u662f\u4f7f\u7528 ssh \u8fde\u63a5\u4e3b\u673a\uff0c\u4f46\u4e5f\u4e0d\u9650\u5236\u4e8e\u8fd9\u79cd\u65b9\u5f0f\uff0c\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u4e3b\u673a\u7279\u5b9a\u53c2\u6570 ansible_connection = <connector> \uff0c\u6765\u66f4\u6539\u8fde\u63a5\u7c7b\u578b\u3002\u4ee5\u4e0b\u662f\u652f\u6301\u7684\u8fde\u63a5\u7c7b\u578b\u3002 \u53c2\u6570 \u63cf\u8ff0 local \u5728\u63a7\u5236\u7aef\u672c\u5730\u6267\u884c docker \u4f7f\u7528\u672c\u5730Docker\u5ba2\u6237\u7aef ansible_host \u5bb9\u5668\u8fde\u63a5\u7684\u4e3b\u673a ansible_port \u5bb9\u5668\u8fde\u63a5\u7684\u7aef\u53e3 ansible_become \u5982\u679c\u8bbe\u7f6e\u4e3atrue\uff0c\u5219\u4f1a\u4f7f\u7528begin_user\u5728\u5bb9\u5668\u5185\u8fdb\u884c\u64cd\u4f5c\u3002 ansible_docker_extra_args Docker \u7684\u989d\u5916\u53c2\u6570 \u4e00\u4e2a\u521b\u5efa\u5bb9\u5668\u7684\u5c0f\u4f8b\u5b50 - name : create jenkins container docker_container : docker_host : myserver.net:4243 name : my_jenkins image : jenkins - name : add container to inventory add_host : name : my_jenkins ansible_connection : docker ansible_docker_extra_args : \"--tlsverify --tlscacert=/path/to/ca.pem --tlscert=/path/to/client-cert.pem --tlskey=/path/to/client-key.pem -H=tcp://myserver.net:4243\" ansible_user : jenkins changed_when : false - name : create directory for ssh keys delegate_to : my_jenkins file : path : \"/var/jenkins_home/.ssh/jupiter\" state : directory \u5728\u8fd0\u884c\u7684\u65f6\u5019\u589e\u52a0\u4e3b\u673a \u00b6 \u4f7f\u7528 add_host \u6a21\u5757\u52a8\u6001\u6dfb\u52a0\u8fd0\u884c\u4e3b\u673a\uff0c\u6b64\u7c7b\u4e3b\u673a\u53ea\u6709\u5728\u8fd0\u884c\u65f6\u624d\u4f1a\u5411\u5185\u5b58\u4e2d\u6dfb\u52a0\uff0c\u8fd0\u884c\u7ed3\u675f\u540e\uff0c\u4e5f\u4e0d\u4f1a\u6dfb\u52a0\u5230\u9759\u6001\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u4e2d\u3002 - name : add new node into runtime inventory add_host : hostname : webserver groups : web \u200b ansible_host : 192.168.77.129 ansible_port : 22 \u9650\u5b9a\u4e3b\u673a\u6e05\u5355\u7684\u8fd0\u884c\u4e3b\u673a \u00b6 \u4f7f\u7528 --limit hostname \u53ef\u4ee5\u5728\u8fd0\u884c\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u53ea\u5141\u8bb8\u5728\u6b64\u4e3b\u673a\u4e0a\u8fd0\u884c\u3002 [ root@master ansible ] # ansible-playbook test.yml --list-hosts playbook : test.yml play #1 (test2): test2 TAGS: [] \u200b pattern : [ u'test2' ] \u200b hosts (3) : \u200b node1 \u200b node3 \u200b node2 [ root@master ansible ] # ansible-playbook test.yml --list-hosts --limit node3,node2 playbook : test.yml play #1 (test2): test2 TAGS: [] \u200b pattern : [ u'test2' ] \u200b hosts (2) : \u200b node3 \u200b node2 \u793a\u4f8b \u00b6 \u8fde\u63a5\u672c\u5730\u4e3b\u673a \u00b6 \u4e0d\u9700\u8981\u5728\u4e3b\u673a\u6e05\u5355\u91cc\u5b9a\u4e49\uff0c\u76f4\u63a5\u4f7f\u7528 localhost \u6216 127.0.0.1 \u5c31\u53ef\u4ee5\u8fde\u63a5\u672c\u5730\u4e86 # ansible localhost -m ping localhost | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } # ansible 127.0.0.1 -m ping 127 .0.0.1 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } \u4f7f\u7528\u522b\u540d\u8fde\u63a5\u4e3b\u673a \u00b6 \u5b9a\u4e49\u4e3b\u673a\u6e05\u5355 # cat /etc/ansible/hosts alias_host ansible_host = 192 .168.77.131 ansible_port = 22 ansible_user = root ansible_password = 123456 # \u6307\u5b9a\u522b\u540d\uff0c\u5b9a\u4e49\u4e3b\u673assh\u8fde\u63a5\u4fe1\u606f \u6d4b\u8bd5\u8fde\u901a\u6027 # ansible alias_host -m ping alias_host | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } \u4f7f\u7528 ssh \u79d8\u94a5\u8fde\u63a5\u4e3b\u673a \u00b6 \u5f00\u542f\u8fdc\u7a0b\u4e3b\u673a\u79d8\u94a5\u8ba4\u8bc1 # echo 'PubkeyAuthentication yes' >> /etc/ssh/sshd_config # systemctl restart sshd \u914d\u7f6e\u8fdc\u7a0b\u4e3b\u673a\u79d8\u94a5 # ssh-keygen -t rsa -P '' -b 4096 -f ~/.ssh/id_rsa # cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys # chmod 600 ~/.ssh/authorized_keys \u5c06\u521a\u521a\u751f\u6210\u7684\u79c1\u94a5 ~/.ssh/id_rsa \u62f7\u8d1d\u5230 ansible \u8282\u70b9 # mv id_rsa /opt/131.key # chmod 600 /opt/131.key \u5b9a\u4e49\u4e3b\u673a\u6e05\u5355 # cat /etc/ansible/hosts 192 .168.77.131 ansible_ssh_private_key_file = /opt/131.key \u4e0d\u6307\u5b9a ansible_user \u5219\u4f7f\u7528\u8fd0\u884cansible\u547d\u4ee4\u7684\u7528\u6237 Note \u5982\u679c private_key \u4f7f\u7528\u4e86 passphrase \uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u547d\u4ee4\uff0c\u5c06\u5bc6\u7801\u4fdd\u5b58\u5728 ssh-agent \u4e2d\u3002 ssh-agent bash ssh-add /opt/131.key \u6d4b\u8bd5\u8fde\u901a\u6027 # ansible 192.168.77.131 -m ping 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } \u4f7f\u7528 \u8df3\u677f\u673a \u8fde\u63a5\u4e3b\u673a \u00b6 \u901a\u8fc7 192.168.77.132 \u8fde\u63a5192.168.77.131\uff0c 192.168.77.132 \u9700\u5b89\u88c5 nc \u6dfb\u52a0132\u8282\u70b9\u5230kown_hosts # ssh 192.168.77.132 The authenticity of host '192.168.77.132 (192.168.77.132)' can 't be established. ECDSA key fingerprint is SHA256:2lWSIJMF9r8hnfLwlKONY07eQCeZaDVZ/xWZizr9wqs. ECDSA key fingerprint is MD5:be:82:d9:23:45:18:f2:e3:fa:32:56:65:c9:b1:4b:07. Are you sure you want to continue connecting (yes/no)? yes Warning: Permanently added ' 192 .168.77.132 ' ( ECDSA ) to the list of known hosts. \u4f7f\u7528ssh\u4ee3\u7406\u53c2\u6570\u914d\u7f6e \u5b9a\u4e49\u4e3b\u673a\u6e05\u5355 # cat /etc/ansible/hosts 192 .168.77.131 ansible_ssh_private_key_file = /root/131.key ansible_ssh_common_args = \"-o ProxyCommand=\\\"sshpass -p '123456' ssh -qay -p 22 root@192.168.77.132 'nc %h %p'\\\"\" ansible_ssh_common_args \u914d\u7f6essh\u8fde\u63a5\u7684\u53c2\u6570 \u6d4b\u8bd5\u8fde\u901a\u6027 # ansible 192.168.77.131 -m ping 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } \u4f7f\u7528\u672c\u5730ssh\u914d\u7f6e\u4e3b\u673a\u4ee3\u7406 \u914d\u7f6essh # cat ~/.ssh/config Host 192 .168.77.131 User root Port 22 TCPKeepAlive yes ForwardAgent yes ProxyCommand sshpass -p '123456' ssh -qaY -p 22 root@192.168.77.132 'nc %h %p' \u5b9a\u4e49\u4e3b\u673a\u6e05\u5355 # cat /etc/ansible/hosts 192 .168.77.131 ansible_ssh_private_key_file = /opt/131.key \u6d4b\u8bd5\u8fde\u901a\u6027 # ansible 192.168.77.131 -m ping 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } \u4f7f\u7528ssh\u4ee3\u7406 \u4e0d\u9700\u8981\u5728192.168.77.132\u4e0a\u5b89\u88c5nc\u8f6f\u4ef6\u4e86 \u5b9a\u4e49\u4e3b\u673a\u6e05\u5355 # cat /etc/ansible/hosts 192 .168.77.131 ansible_ssh_private_key_file = /root/131.key ansible_ssh_common_args = \"-o ProxyCommand=\\\"sshpass -p '123456' ssh -W %h:%p -q -p 22 root@192.168.77.132\\\"\" ansible_ssh_common_args \u914d\u7f6essh\u8fde\u63a5\u7684\u53c2\u6570 \u6d4b\u8bd5\u8fde\u901a\u6027 # ansible 192.168.77.131 -m ping 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } \u547d\u4ee4\u884c\u6307\u5b9a\u4e3b\u673a\u6e05\u5355 \u00b6 # ansible -i '192.168.77.131,192.168.77.132' 192.168.77.* -m ping -k SSH password: 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } 192 .168.77.132 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } \u901a\u8fc7 -i \u53c2\u6570\uff0c \u6307\u5b9a\u7528\u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\u5217\u8868\u5373\u53ef\u3002 \u4e0d\u8fc7\u4e0d\u80fd\u6307\u5b9a ansible_* \u5f00\u5934\u7684\u53d8\u91cf\uff0c\u5373\u4e0d\u80fd\u5b9a\u4e49\u8fde\u63a5\u5bc6\u7801\u3002 \u52a8\u6001\u4e3b\u673a\u6e05\u5355 \u00b6 ansible \u4e0d\u4ec5\u53ef\u4ee5\u4f7f\u7528 yaml , ini \u7b49\u683c\u5f0f\u7684\u9759\u6001\u6587\u4ef6\u914d\u7f6e\u4e3b\u673a\u6e05\u5355\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u52a8\u6001\u7684\u6e90\u4f5c\u4e3a\u4e3b\u673a\u6e05\u5355\uff0c\u8be6\u7ec6\u5185\u5bb9\u8bf7\u89c1 \u4f7f\u7528\u52a8\u6001\u4e3b\u673a","title":"4. \u8ba4\u8bc6\u4e3b\u673a\u6e05\u5355"},{"location":"basic/Inventory/#4","text":"Ansible \u53ef\u540c\u65f6\u64cd\u4f5c\u5c5e\u4e8e\u4e00\u4e2a\u7ec4\u7684\u591a\u53f0\u4e3b\u673a, \u7ec4\u548c\u4e3b\u673a\u4e4b\u95f4\u7684\u5173\u7cfb\u901a\u8fc7 inventory \u6587\u4ef6\u914d\u7f6e. \u9ed8\u8ba4\u7684\u6587\u4ef6\u8def\u5f84\u4e3a /etc/ansible/hosts , \u6267\u884c\u547d\u4ee4\u7684\u65f6\u5019\u4f7f\u7528 -i \u53c2\u6570\u5373\u53ef\u6307\u5b9a\u4e3b\u673a\u6e05\u5355\u3002","title":"4. \u8ba4\u8bc6\u4e3b\u673a\u6e05\u5355"},{"location":"basic/Inventory/#_1","text":"\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u4e3b\u8981\u6709 ini \u548c yaml \u683c\u5f0f\u4e24\u79cd\u8bed\u6cd5\u683c\u5f0f mail.example.com # \u5b9a\u4e49\u4e3b\u673afqdn\u5730\u5740, \u4e14\u5df2\u7ecf\u4e0e\u63a7\u5236\u8282\u70b9ssh\u4e92\u4fe1 [webservers] # \u65b9\u62ec\u53f7[]\u4e2d\u662f\u7ec4\u540d host1 # \u5b9a\u4e49\u4e3b\u673a\u540d\u79f0, \u4e14\u5df2\u7ecf\u4e0e\u63a7\u5236\u8282\u70b9ssh\u4e92\u4fe1 host2:5522 # \u6307\u5b9a\u8fde\u63a5\u4e3b\u673a\u548c\u7aef\u53e3\u53f7 localhost ansible_connection = local # ansible_connection\u53ef\u4ee5\u5b9a\u4e49\u8fde\u63a5\u7c7b\u578b, local\u662f\u5728\u672c\u5730\u6267\u884c host3 http_port = 80 maxRequestsPerChild=808 # \u5b9a\u4e49\u4e3b\u673a\u53d8\u91cf, \u9664\u4e86ansible\u5b9a\u4e49\u7684\u7279\u6b8a\u540d\u79f0\u5916\uff0c\u5176\u4ed6\u7684\u90fd\u662f\u4e3b\u673a\u53d8\u91cf host4 ansible_host = 192.168.1.50 ansible_port=2222 ansible_user=root ansible_password=12345 # \u6307\u5b9a\u522b\u540d\uff0c\u5b9a\u4e49\u4e3b\u673assh\u8fde\u63a5\u4fe1\u606f www[1:50].example.com # \u5b9a\u4e49 1-50\u8303\u56f4\u5185\u7684\u4e3b\u673a www-[a:f].example.com # \u5b9a\u4e49 a-f \u8303\u56f4\u5185\u5185\u7684\u4e3b\u673a [dbservers] three.example.com ansible_python_interpreter = /usr/local/bin/python3 # \u5b9a\u4e49python\u6267\u884cansible\uff0c\u8fd9\u4e2a\u662f\u6307\u5b9a\u88ab\u63a7\u8282\u70b9\u7684\u3002 192.168.77.123 ansible_ruby_interpreter = /usr/bin/ruby.1.9.3 # \u5b9a\u4e49ruby\u6267\u884c\u6587\u4ef6 [webservers:vars] # \u5b9a\u4e49webservers\u7ec4\u7684\u53d8\u91cf ntp_server = ntp.example.com proxy = proxy.example.com [server:children] # \u5b9a\u4e49server\u7ec4\u7684\u5b50\u6210\u5458 webservers dbservers [server:vars] # \u5b9a\u4e49server\u7ec4\u7684\u53d8\u91cf zabbix_server:192.168.77.121 \u4e0a\u5217\u914d\u7f6e\u7684\u4e00\u4e9b\u89e3\u91ca\uff1a \u4e3b\u673a\u53ef\u4ee5\u5728\u591a\u4e2a\u7ec4\u4e2d\u914d\u7f6e\u3002 ansible_connection \u662f\u6267\u884c\u4e3b\u673a\u7684\u8fde\u63a5\u7c7b\u578b\uff0c\u9ed8\u8ba4\u662fsmart ansible_host \u4e3b\u673assh\u8fde\u63a5\u5730\u5740 ansible_port \u4e3b\u673assh\u8fde\u63a5\u7aef\u53e3 ansible_user \u4e3b\u673assh\u8fde\u63a5\u7528\u6237 ansible_password \u4e3b\u673assh\u8fde\u63a5\u7528\u6237\u5bc6\u7801 ansible_python_interpreter \u6307\u5b9apython\u7684\u6267\u884c\u8def\u5f84 [webservers:vars] \u5b9a\u4e49webservers\u7ec4\u7684\u53d8\u91cf [server:children] \u5b9a\u4e49server\u7ec4\u7684\u5b50\u6210\u5458 \u4e5f\u53ef\u4f7f\u4f7f\u7528yaml\u683c\u5f0f\u6765\u8868\u793a all : children : \u200b usa : \u200b children : \u200b southeast : \u200b children : \u200b atlanta : \u200b hosts : \u200b host1 : \u200b host2 : \u200b raleigh : \u200b hosts : \u200b host2 : \u200b host3 : \u200b vars : \u200b some_server : foo.southeast.example.com \u200b halon_system_timeout : 30 \u200b self_destruct_countdown : 60 \u200b escape_pods : 2 \u200b northeast : \u200b northwest : \u200b southwest : yaml\u683c\u5f0f\u914d\u7f6e\u7684\u8fd8\u662f\u633a\u590d\u6742\u7684\uff0c\u53ef\u8bfb\u6027\u4e5f\u5dee\uff0c\u5efa\u8bae\u4f7f\u7528 ini \u65b9\u5f0f\u6765\u8bbe\u7f6e\u4e3b\u673a\u6e05\u5355\u3002","title":"\u4e3b\u673a\u6e05\u5355\u793a\u4f8b"},{"location":"basic/Inventory/#_2","text":"\u5728\u4e3b\u673a\u6e05\u5355\u4e2d\uff0cansible\u4f1a\u81ea\u52a8\u7684\u751f\u6210\u4e24\u4e2a\u7ec4\u3002 all \u6240\u6709\u7684\u4e3b\u673a\u3002 ungrouped \u5305\u542b\u6ca1\u6709\u7ec4\u7684\u4e3b\u673a\u3002 \u5c3d\u7ba1\u8fd9\u4e24\u4e2a\u7ec4\u662f\u6c38\u8fdc\u5b58\u5728\u7684\uff0c\u4f46\u4e5f\u6709\u53ef\u80fd\u662f\u9690\u85cf\u7684\uff0c\u4e0d\u4f1a\u51fa\u73b0group_names\u4e4b\u7c7b\u7684\u7ec4\u5217\u8868\u4e2d\u3002","title":"\u9ed8\u8ba4\u7ec4"},{"location":"basic/Inventory/#_3","text":"\u5982\u679c\u4f60\u4e0d\u60f3\u5728\u4e3b\u673a\u6e05\u5355\u4e2d\u5b9a\u4e49\u4e3b\u673a\u7684\u53d8\u91cf\u6216\u8005\u7ec4\u7684\u53d8\u91cf\uff0cansible\u8fd8\u652f\u6301\u5728\u7279\u5b9a\u7684\u76ee\u5f55\u4e2d\u5b9a\u4e49\u53d8\u91cf\u3002 \u53d8\u91cf\u6587\u4ef6\u5fc5\u987b\u4ee5yaml\u8bed\u6cd5\u5b9a\u4e49\u3002 \u5982\u9ed8\u8ba4\u5728 /etc/ansible/host_vars/ \u76ee\u5f55\u4e2d\u5b9a\u4e49\u4e3b\u673a\u53d8\u91cf\uff0c\u6587\u4ef6\u540d\u79f0\u4ee5\u4e3b\u673a\u540d\u79f0\u547d\u540d\uff0c\u7ed3\u675f\u53ef\u4ee5\u7528'.yml', '.yaml', '.json'\u4e09\u79cd\u683c\u5f0f\u3002 cat /etc/ansible/host_vars/host1 --- ntp_server: acme.example.org database_server: storage.example.org \u5982\u9ed8\u8ba4\u5728 /etc/ansible/group_vars/ \u76ee\u5f55\u4e2d\u5b9a\u4e49\u7ec4\u53d8\u91cf\uff0c\u6587\u4ef6\u540d\u79f0\u4ee5\u7ec4\u540d\u79f0\u547d\u540d\uff0c\u7ed3\u675f\u53ef\u4ee5\u7528'.yml', '.yaml', '.json'\u4e09\u79cd\u683c\u5f0f\u3002 cat /etc/ansible/group_vars/webservers --- ntp_server: acme.example.org database_server: storage.example.org","title":"\u4e3b\u673a\u53d8\u91cf\u548c\u7ec4\u53d8\u91cf"},{"location":"basic/Inventory/#_4","text":"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u591a\u79cd\u65b9\u5f0f\u7ed9\u4e3b\u673a\u5b9a\u4e49\u53d8\u91cf\uff0c\u5982\u679c\u5728\u5404\u4e2a\u73af\u8282\u90fd\u8bbe\u7f6e\u4e86\u53d8\u91cf\uff0c\u5230\u5e95\u54ea\u4e2a\u53d8\u91cf\u751f\u6548\u5462\uff1f\u8fd9\u5c31\u8981\u770bansible\u7684\u53d8\u91cf\u4f18\u5148\u7ea7\uff0c\u4f18\u5148\u7ea7\u9ad8\u7684\u4f1a\u8986\u76d6\u4f18\u5148\u7ea7\u4f4e\u7684\u53d8\u91cf\u3002 \u4f18\u5148\u987a\u5e8f\uff0call\u6700\u4f4e\uff0chost\u6700\u9ad8 all group parent group child group host \u76f8\u540c\u7ec4\u65f6\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6309\u5b57\u6bcd\u987a\u5e8f\u540e\u9762\u7ec4\u7684\u5b9a\u4e49\u4f1a\u8986\u76d6\u524d\u9762\u7684\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528ansible_group_priority\u8c03\u6574\u4f18\u5148\u7ea7\uff0c\u6570\u503c\u8d8a\u5927\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff0c\u9ed8\u8ba4\u4e3a1\uff0c\u76f8\u540c\u4f18\u5148\u7ea7\u65f6\uff0c\u540e\u8005\u4f18\u5148\u3002 [a_group:vars] testvar = a ansible_group_priority = 10 [b_group] testvar = b","title":"\u53d8\u91cf\u5408\u5e76"},{"location":"basic/Inventory/#_5","text":"\u5728\u547d\u4ee4\u53c2\u6570\u4e2d\uff0c\u4f7f\u7528\u591a\u4e2a -i \u5c31\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u4e3b\u673a\u6e05\u5355 ansible all -i staging -i production -m ping ansible all -i /tmp/staging -i /tmp/production -m ping \u4e5f\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u76ee\u5f55 inventory/ 01-openstack.yml # configure inventory plugin to get hosts from Openstack cloud 02-dynamic-inventory.py # add additional hosts with dynamic inventory script 03-static-inventory # add static hosts group_vars/ all.yml # assign variables to all hosts ansible all -i inventory -m ping","title":"\u4f7f\u7528\u591a\u4e2a\u4e3b\u673a\u6e05\u5355"},{"location":"basic/Inventory/#_6","text":"\u7528\u4e8e\u4e3b\u673a\u8fde\u63a5 \u53c2\u6570 \u63cf\u8ff0 ansible_connection \u4e0e\u4e3b\u673a\u7684\u8fde\u63a5\u7c7b\u578b.\u6bd4\u5982:local, ssh \u6216\u8005 paramiko. Ansible 1.2 \u4ee5\u524d\u9ed8\u8ba4\u4f7f\u7528 paramiko.1.2 \u4ee5\u540e\u9ed8\u8ba4\u4f7f\u7528 'smart','smart' \u65b9\u5f0f\u4f1a\u6839\u636e\u662f\u5426\u652f\u6301 ControlPersist, \u6765\u5224\u65ad'ssh' \u65b9\u5f0f\u662f\u5426\u53ef\u884c. \u7528\u4e8e\u6240\u6709\u8fde\u63a5 \u53c2\u6570 \u63cf\u8ff0 ansible_host \u5c06\u8981\u8fde\u63a5\u7684\u8fdc\u7a0b\u4e3b\u673a\u540d.\u4e0e\u4f60\u60f3\u8981\u8bbe\u5b9a\u7684\u4e3b\u673a\u7684\u522b\u540d\u4e0d\u540c\u7684\u8bdd,\u53ef\u901a\u8fc7\u6b64\u53d8\u91cf\u8bbe\u7f6e. ansible_port \u8fde\u63a5\u7aef\u53e3\u53f7\uff0c\u5982\u679c\u662fssh\u7684\u8bdd\uff0c\u9ed8\u8ba4\u662f22 ansible_user \u7528\u4e8e\u8fde\u63a5\u8ba4\u8bc1\u7684\u7528\u6237\u540d ansible_password \u7528\u4e8e\u8fde\u63a5\u8ba4\u8bc1\u7684\u7528\u6237\u540d\u5bc6\u7801 ssh\u8fde\u63a5\u53c2\u6570 \u53c2\u6570 \u63cf\u8ff0 ansible_ssh_private_key_file ssh \u4f7f\u7528\u7684\u79c1\u94a5\u6587\u4ef6.\u9002\u7528\u4e8e\u6709\u591a\u4e2a\u5bc6\u94a5,\u800c\u4f60\u4e0d\u60f3\u4f7f\u7528 SSH \u4ee3\u7406\u7684\u60c5\u51b5. ansible_ssh_common_args \u6b64\u8bbe\u7f6e\u9644\u52a0\u5230sftp\uff0cscp\u548cssh\u7684\u7f3a\u7701\u547d\u4ee4\u884c ansible_sftp_extra_args \u6b64\u8bbe\u7f6e\u9644\u52a0\u5230\u9ed8\u8ba4sftp\u547d\u4ee4\u884c\u3002 ansible_scp_extra_args \u6b64\u8bbe\u7f6e\u9644\u52a0\u5230\u9ed8\u8ba4scp\u547d\u4ee4\u884c\u3002 ansible_ssh_extra_args \u6b64\u8bbe\u7f6e\u9644\u52a0\u5230\u9ed8\u8ba4ssh\u547d\u4ee4\u884c\u3002 ansible_ssh_pipelining \u786e\u5b9a\u662f\u5426\u4f7f\u7528SSH\u7ba1\u9053\u3002\u8fd9\u53ef\u4ee5\u8986\u76d6ansible.cfg\u4e2d\u5f97\u8bbe\u7f6e\u3002 ansible_ssh_executable ssh\u53ef\u6267\u884c\u6587\u4ef6 \u6743\u9650\u63d0\u5347\u53c2\u6570 \u53c2\u6570 \u63cf\u8ff0 ansible_become \u5f00\u542f\u63d0\u6743\uff0c\u7b49\u540c\u4e8e ansible_sudo \uff0c ansible_su ansible_become_method \u63d0\u6743\u65b9\u5f0f ansible_become_user \u63d0\u6743\u7528\u6237\uff0c\u7b49\u540c\u4e8e ansible_sudo_user \uff0c ansible_su_user ansible_become_password \u63d0\u6743\u5bc6\u7801,\u7b49\u540c\u4e8e ansible_sudo_password \uff0c ansible_su_password ansible_become_exe \u63d0\u6743\u6240\u7528\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u7b49\u540c\u4e8e ansible_sudo_exe , ansible_su_exe ansible_become_flags \u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570\uff0c\u7b49\u540c\u4e8e ansible_sudo_flags , ansible_su_flags \u8fdc\u7a0b\u4e3b\u673a\u73af\u5883\u53c2\u6570 \u53c2\u6570 \u63cf\u8ff0 ansible_shell_type \u76ee\u6807\u7cfb\u7edf\u7684shell\u7c7b\u578b.\u9ed8\u8ba4\u60c5\u51b5\u4e0b,\u547d\u4ee4\u7684\u6267\u884c\u4f7f\u7528 'sh' \u8bed\u6cd5,\u53ef\u8bbe\u7f6e\u4e3a 'csh' \u6216 'fish'. ansible_python_interpreter \u76ee\u6807\u4e3b\u673a\u7684 python \u8def\u5f84.\u9002\u7528\u4e8e\u7684\u60c5\u51b5: \u7cfb\u7edf\u4e2d\u6709\u591a\u4e2a Python, \u6216\u8005\u547d\u4ee4\u8def\u5f84\u4e0d\u662f\"/usr/bin/python\",\u6bd4\u5982 *BSD, \u6216\u8005 /usr/bin/python ansible_*_interpreter \u8fd9\u91cc\u7684\"*\"\u53ef\u4ee5\u662f ruby \u6216 perl \u6216\u5176\u4ed6\u8bed\u8a00\u7684\u89e3\u91ca\u5668\uff0c\u4f5c\u7528\u548cansible_python_interpreter \u7c7b\u4f3c ansible_shell_executable \u8fd9\u5c06\u8bbe\u7f6eansible\u63a7\u5236\u5668\u5c06\u5728\u76ee\u6807\u673a\u5668\u4e0a\u4f7f\u7528\u7684shell\uff0c\u8986\u76d6ansible.cfg\u4e2d\u7684\u914d\u7f6e\uff0c\u9ed8\u8ba4\u4e3a/bin/sh\u3002 \u975eSSH\u8fde\u63a5\u7c7b\u578b\u53c2\u6570 ansible\u9ed8\u8ba4\u662f\u4f7f\u7528 ssh \u8fde\u63a5\u4e3b\u673a\uff0c\u4f46\u4e5f\u4e0d\u9650\u5236\u4e8e\u8fd9\u79cd\u65b9\u5f0f\uff0c\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u4e3b\u673a\u7279\u5b9a\u53c2\u6570 ansible_connection = <connector> \uff0c\u6765\u66f4\u6539\u8fde\u63a5\u7c7b\u578b\u3002\u4ee5\u4e0b\u662f\u652f\u6301\u7684\u8fde\u63a5\u7c7b\u578b\u3002 \u53c2\u6570 \u63cf\u8ff0 local \u5728\u63a7\u5236\u7aef\u672c\u5730\u6267\u884c docker \u4f7f\u7528\u672c\u5730Docker\u5ba2\u6237\u7aef ansible_host \u5bb9\u5668\u8fde\u63a5\u7684\u4e3b\u673a ansible_port \u5bb9\u5668\u8fde\u63a5\u7684\u7aef\u53e3 ansible_become \u5982\u679c\u8bbe\u7f6e\u4e3atrue\uff0c\u5219\u4f1a\u4f7f\u7528begin_user\u5728\u5bb9\u5668\u5185\u8fdb\u884c\u64cd\u4f5c\u3002 ansible_docker_extra_args Docker \u7684\u989d\u5916\u53c2\u6570 \u4e00\u4e2a\u521b\u5efa\u5bb9\u5668\u7684\u5c0f\u4f8b\u5b50 - name : create jenkins container docker_container : docker_host : myserver.net:4243 name : my_jenkins image : jenkins - name : add container to inventory add_host : name : my_jenkins ansible_connection : docker ansible_docker_extra_args : \"--tlsverify --tlscacert=/path/to/ca.pem --tlscert=/path/to/client-cert.pem --tlskey=/path/to/client-key.pem -H=tcp://myserver.net:4243\" ansible_user : jenkins changed_when : false - name : create directory for ssh keys delegate_to : my_jenkins file : path : \"/var/jenkins_home/.ssh/jupiter\" state : directory","title":"\u4e3b\u673a\u5185\u7f6e\u53d8\u91cf\u5217\u8868"},{"location":"basic/Inventory/#_7","text":"\u4f7f\u7528 add_host \u6a21\u5757\u52a8\u6001\u6dfb\u52a0\u8fd0\u884c\u4e3b\u673a\uff0c\u6b64\u7c7b\u4e3b\u673a\u53ea\u6709\u5728\u8fd0\u884c\u65f6\u624d\u4f1a\u5411\u5185\u5b58\u4e2d\u6dfb\u52a0\uff0c\u8fd0\u884c\u7ed3\u675f\u540e\uff0c\u4e5f\u4e0d\u4f1a\u6dfb\u52a0\u5230\u9759\u6001\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u4e2d\u3002 - name : add new node into runtime inventory add_host : hostname : webserver groups : web \u200b ansible_host : 192.168.77.129 ansible_port : 22","title":"\u5728\u8fd0\u884c\u7684\u65f6\u5019\u589e\u52a0\u4e3b\u673a"},{"location":"basic/Inventory/#_8","text":"\u4f7f\u7528 --limit hostname \u53ef\u4ee5\u5728\u8fd0\u884c\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u53ea\u5141\u8bb8\u5728\u6b64\u4e3b\u673a\u4e0a\u8fd0\u884c\u3002 [ root@master ansible ] # ansible-playbook test.yml --list-hosts playbook : test.yml play #1 (test2): test2 TAGS: [] \u200b pattern : [ u'test2' ] \u200b hosts (3) : \u200b node1 \u200b node3 \u200b node2 [ root@master ansible ] # ansible-playbook test.yml --list-hosts --limit node3,node2 playbook : test.yml play #1 (test2): test2 TAGS: [] \u200b pattern : [ u'test2' ] \u200b hosts (2) : \u200b node3 \u200b node2","title":"\u9650\u5b9a\u4e3b\u673a\u6e05\u5355\u7684\u8fd0\u884c\u4e3b\u673a"},{"location":"basic/Inventory/#_9","text":"","title":"\u793a\u4f8b"},{"location":"basic/Inventory/#_10","text":"\u4e0d\u9700\u8981\u5728\u4e3b\u673a\u6e05\u5355\u91cc\u5b9a\u4e49\uff0c\u76f4\u63a5\u4f7f\u7528 localhost \u6216 127.0.0.1 \u5c31\u53ef\u4ee5\u8fde\u63a5\u672c\u5730\u4e86 # ansible localhost -m ping localhost | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } # ansible 127.0.0.1 -m ping 127 .0.0.1 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" }","title":"\u8fde\u63a5\u672c\u5730\u4e3b\u673a"},{"location":"basic/Inventory/#_11","text":"\u5b9a\u4e49\u4e3b\u673a\u6e05\u5355 # cat /etc/ansible/hosts alias_host ansible_host = 192 .168.77.131 ansible_port = 22 ansible_user = root ansible_password = 123456 # \u6307\u5b9a\u522b\u540d\uff0c\u5b9a\u4e49\u4e3b\u673assh\u8fde\u63a5\u4fe1\u606f \u6d4b\u8bd5\u8fde\u901a\u6027 # ansible alias_host -m ping alias_host | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" }","title":"\u4f7f\u7528\u522b\u540d\u8fde\u63a5\u4e3b\u673a"},{"location":"basic/Inventory/#ssh","text":"\u5f00\u542f\u8fdc\u7a0b\u4e3b\u673a\u79d8\u94a5\u8ba4\u8bc1 # echo 'PubkeyAuthentication yes' >> /etc/ssh/sshd_config # systemctl restart sshd \u914d\u7f6e\u8fdc\u7a0b\u4e3b\u673a\u79d8\u94a5 # ssh-keygen -t rsa -P '' -b 4096 -f ~/.ssh/id_rsa # cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys # chmod 600 ~/.ssh/authorized_keys \u5c06\u521a\u521a\u751f\u6210\u7684\u79c1\u94a5 ~/.ssh/id_rsa \u62f7\u8d1d\u5230 ansible \u8282\u70b9 # mv id_rsa /opt/131.key # chmod 600 /opt/131.key \u5b9a\u4e49\u4e3b\u673a\u6e05\u5355 # cat /etc/ansible/hosts 192 .168.77.131 ansible_ssh_private_key_file = /opt/131.key \u4e0d\u6307\u5b9a ansible_user \u5219\u4f7f\u7528\u8fd0\u884cansible\u547d\u4ee4\u7684\u7528\u6237 Note \u5982\u679c private_key \u4f7f\u7528\u4e86 passphrase \uff0c\u53ef\u4f7f\u7528\u4e0b\u5217\u547d\u4ee4\uff0c\u5c06\u5bc6\u7801\u4fdd\u5b58\u5728 ssh-agent \u4e2d\u3002 ssh-agent bash ssh-add /opt/131.key \u6d4b\u8bd5\u8fde\u901a\u6027 # ansible 192.168.77.131 -m ping 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" }","title":"\u4f7f\u7528 ssh \u79d8\u94a5\u8fde\u63a5\u4e3b\u673a"},{"location":"basic/Inventory/#_12","text":"\u901a\u8fc7 192.168.77.132 \u8fde\u63a5192.168.77.131\uff0c 192.168.77.132 \u9700\u5b89\u88c5 nc \u6dfb\u52a0132\u8282\u70b9\u5230kown_hosts # ssh 192.168.77.132 The authenticity of host '192.168.77.132 (192.168.77.132)' can 't be established. ECDSA key fingerprint is SHA256:2lWSIJMF9r8hnfLwlKONY07eQCeZaDVZ/xWZizr9wqs. ECDSA key fingerprint is MD5:be:82:d9:23:45:18:f2:e3:fa:32:56:65:c9:b1:4b:07. Are you sure you want to continue connecting (yes/no)? yes Warning: Permanently added ' 192 .168.77.132 ' ( ECDSA ) to the list of known hosts. \u4f7f\u7528ssh\u4ee3\u7406\u53c2\u6570\u914d\u7f6e \u5b9a\u4e49\u4e3b\u673a\u6e05\u5355 # cat /etc/ansible/hosts 192 .168.77.131 ansible_ssh_private_key_file = /root/131.key ansible_ssh_common_args = \"-o ProxyCommand=\\\"sshpass -p '123456' ssh -qay -p 22 root@192.168.77.132 'nc %h %p'\\\"\" ansible_ssh_common_args \u914d\u7f6essh\u8fde\u63a5\u7684\u53c2\u6570 \u6d4b\u8bd5\u8fde\u901a\u6027 # ansible 192.168.77.131 -m ping 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } \u4f7f\u7528\u672c\u5730ssh\u914d\u7f6e\u4e3b\u673a\u4ee3\u7406 \u914d\u7f6essh # cat ~/.ssh/config Host 192 .168.77.131 User root Port 22 TCPKeepAlive yes ForwardAgent yes ProxyCommand sshpass -p '123456' ssh -qaY -p 22 root@192.168.77.132 'nc %h %p' \u5b9a\u4e49\u4e3b\u673a\u6e05\u5355 # cat /etc/ansible/hosts 192 .168.77.131 ansible_ssh_private_key_file = /opt/131.key \u6d4b\u8bd5\u8fde\u901a\u6027 # ansible 192.168.77.131 -m ping 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } \u4f7f\u7528ssh\u4ee3\u7406 \u4e0d\u9700\u8981\u5728192.168.77.132\u4e0a\u5b89\u88c5nc\u8f6f\u4ef6\u4e86 \u5b9a\u4e49\u4e3b\u673a\u6e05\u5355 # cat /etc/ansible/hosts 192 .168.77.131 ansible_ssh_private_key_file = /root/131.key ansible_ssh_common_args = \"-o ProxyCommand=\\\"sshpass -p '123456' ssh -W %h:%p -q -p 22 root@192.168.77.132\\\"\" ansible_ssh_common_args \u914d\u7f6essh\u8fde\u63a5\u7684\u53c2\u6570 \u6d4b\u8bd5\u8fde\u901a\u6027 # ansible 192.168.77.131 -m ping 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" }","title":"\u4f7f\u7528 \u8df3\u677f\u673a \u8fde\u63a5\u4e3b\u673a"},{"location":"basic/Inventory/#_13","text":"# ansible -i '192.168.77.131,192.168.77.132' 192.168.77.* -m ping -k SSH password: 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } 192 .168.77.132 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"ping\" : \"pong\" } \u901a\u8fc7 -i \u53c2\u6570\uff0c \u6307\u5b9a\u7528\u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\u5217\u8868\u5373\u53ef\u3002 \u4e0d\u8fc7\u4e0d\u80fd\u6307\u5b9a ansible_* \u5f00\u5934\u7684\u53d8\u91cf\uff0c\u5373\u4e0d\u80fd\u5b9a\u4e49\u8fde\u63a5\u5bc6\u7801\u3002","title":"\u547d\u4ee4\u884c\u6307\u5b9a\u4e3b\u673a\u6e05\u5355"},{"location":"basic/Inventory/#_14","text":"ansible \u4e0d\u4ec5\u53ef\u4ee5\u4f7f\u7528 yaml , ini \u7b49\u683c\u5f0f\u7684\u9759\u6001\u6587\u4ef6\u914d\u7f6e\u4e3b\u673a\u6e05\u5355\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u52a8\u6001\u7684\u6e90\u4f5c\u4e3a\u4e3b\u673a\u6e05\u5355\uff0c\u8be6\u7ec6\u5185\u5bb9\u8bf7\u89c1 \u4f7f\u7528\u52a8\u6001\u4e3b\u673a","title":"\u52a8\u6001\u4e3b\u673a\u6e05\u5355"},{"location":"basic/Jinja2/","text":"12. Jinja2 \u6a21\u677f\u8bed\u6cd5 \u00b6 Ansible\u4f7f\u7528 Jinja2 \u6a21\u677f\u6765\u542f\u7528\u52a8\u6001\u8868\u8fbe\u5f0f\u548c\u5bf9\u53d8\u91cf\u7684\u8bbf\u95ee\u3002 Note Jinja2 \u662f\u4e00\u4e2a Python \u7684\u529f\u80fd\u9f50\u5168\u7684\u6a21\u677f\u5f15\u64ce\u3002\u5b83\u6709\u5b8c\u6574\u7684 unicode \u652f\u6301\uff0c\u4e00\u4e2a\u53ef\u9009 \u7684\u96c6\u6210\u6c99\u7bb1\u6267\u884c\u73af\u5883\uff0c\u88ab\u5e7f\u6cdb\u4f7f\u7528\uff0c\u4ee5 BSD \u8bb8\u53ef\u8bc1\u6388\u6743\u3002 jinja2 \u6a21\u7248\u4e2d\u7684\u4e00\u4e9b\u8bed\u6cd5 \u00b6 \u5173\u4e8e Jinja2 \u5b8c\u6574\u7684\u4e2d\u6587\u8bf4\u660e \u8bf7\u79fb\u6b65\uff1a http://docs.jinkan.org/docs/jinja2/ \u53d8\u91cf \u00b6 \u53ef\u4ee5\u4f7f\u7528\u70b9 . \u6765\u8bbf\u95ee\u53d8\u91cf\u7684\u5c5e\u6027\uff0c\u4f5c\u4e3a\u66ff\u4ee3\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e0b\u6807\u8bed\u6cd5 [] , \u4e0b\u97622\u79cd\u65b9\u5f0f\u6548\u679c\u662f\u4e00\u6837\u7684 {{ foo.bar }} {{ foo['bar'] }} \u5982\u679c\u53d8\u91cf\u6216\u5c5e\u6027\u4e0d\u5b58\u5728\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u672a\u5b9a\u4e49\u503c\u3002 \u6ce8\u91ca \u00b6 \u8981\u628a\u6a21\u677f\u4e2d\u4e00\u884c\u7684\u90e8\u5206\u6ce8\u91ca\u6389\uff0c\u9ed8\u8ba4\u4f7f\u7528 {# ... #} \u6ce8\u91ca\u8bed\u6cd5\u3002 \u8f6c\u4e49 \u00b6 \u7b80\u5355\u7684\u4f7f\u7528\u5355\u5f15\u53f7\u8fdb\u884c\u8f6c\u4e49 \u5bf9\u4e8e\u8f83\u5927\u7684\u6bb5\u843d\uff0c\u4f7f\u7528raw\u8fdb\u884c\u8f6c\u4e49 {% raw %} <ul> {% for item in seq %} <li>{{ item }}</li> {% endfor %} </ul> {% endraw %} \u5305\u542b > \u3001 < \u3001 & \u6216 \" \u5b57\u7b26\u7684\u53d8\u91cf\uff0c\u5fc5\u987b\u8981\u624b\u52a8\u8f6c\u4e49, \u4f7f\u7528 e \u987e\u8651\u5668\u53ef\u4ee5\u8f6c\u4e49\u8fd9\u4e9b\u3002 {{ user.username | e }} \u7a7a\u767d\u63a7\u5236 \u00b6 \u5728\u5f00\u59cb\u6216\u7ed3\u675f\u653e\u7f6e\u4e00\u4e2a\u51cf\u53f7\uff08 - \uff09\uff0c\u53ef\u4ee5\u79fb\u9664\u5757\u524d\u6216\u5757\u540e\u7684\u7a7a\u767d\u3002 {% for item in seq -%} {{ item }} {%- endfor %} {%- if foo -%}...{% endif %} \u63a7\u5236\u7ed3\u6784 \u00b6 \u63a7\u5236\u7ed3\u6784\u6307\u7684\u662f\u6240\u6709\u7684\u90a3\u4e9b\u53ef\u4ee5\u63a7\u5236\u7a0b\u5e8f\u6d41\u7684\u4e1c\u897f \u2014\u2014 \u6761\u4ef6\uff08\u6bd4\u5982 if/elif/ekse \uff09\u3001 for \u5faa\u73af\u3001\u4ee5\u53ca\u5b8f\u548c\u5757\u4e4b\u7c7b\u7684\u4e1c\u897f\u3002\u63a7\u5236\u7ed3\u6784\u5728\u9ed8\u8ba4\u8bed\u6cd5\u4e2d\u4ee5 {% .. %} \u5757\u7684\u5f62\u5f0f \u51fa\u73b0\u3002 For \u00b6 \u904d\u5386\u5e8f\u5217 {% for user in users %} <li>{{ user.username|e }}</li> {% endfor %} \u8fed\u4ee3\u5b57\u5178 {% for key, value in my_dict.iteritems() %} <dt>{{ key|e }}</dt> <dd>{{ value|e }}</dd> {% endfor %} \u5faa\u73af 10 \u6b21\u8fed\u4ee3\u4e4b\u540e\u4f1a\u7ec8\u6b62\u5904\u7406 {% for user in users %} {%- if loop.index >= 10 %}{% break %}{% endif %} {%- endfor %} \u6761\u4ef6\u8fc7\u6ee4 {% for dir in data_dirs if dir != \"/\" %} data_dir = {{ dir }} {% else %} # no data dirs found {% endfor %} \u5728\u4e00\u4e2a for \u5faa\u73af\u5757\u4e2d\u4f60\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e9b\u7279\u6b8a\u7684\u53d8\u91cf: \u53d8\u91cf \u63cf\u8ff0 loop.index \u5f53\u524d\u5faa\u73af\u8fed\u4ee3\u7684\u6b21\u6570\uff08\u4ece 1 \u5f00\u59cb\uff09 loop.index0 \u5f53\u524d\u5faa\u73af\u8fed\u4ee3\u7684\u6b21\u6570\uff08\u4ece 0 \u5f00\u59cb\uff09 loop.revindex \u5230\u5faa\u73af\u7ed3\u675f\u9700\u8981\u8fed\u4ee3\u7684\u6b21\u6570\uff08\u4ece 1 \u5f00\u59cb\uff09 loop.revindex0 \u5230\u5faa\u73af\u7ed3\u675f\u9700\u8981\u8fed\u4ee3\u7684\u6b21\u6570\uff08\u4ece 0 \u5f00\u59cb\uff09 loop.first \u5982\u679c\u662f\u7b2c\u4e00\u6b21\u8fed\u4ee3\uff0c\u4e3a True \u3002 loop.last \u5982\u679c\u662f\u6700\u540e\u4e00\u6b21\u8fed\u4ee3\uff0c\u4e3a True \u3002 loop.length \u5e8f\u5217\u4e2d\u7684\u9879\u76ee\u6570\u3002 loop.cycle \u5728\u4e00\u4e32\u5e8f\u5217\u95f4\u671f\u53d6\u503c\u7684\u8f85\u52a9\u51fd\u6570 loop.depth \u6307\u793a\u5f53\u524d\u6e32\u67d3\u5728\u9012\u5f52\u5faa\u73af\u4e2d\u7684\u6df1\u5ea6\u3002 \u4ece1\u5f00\u59cb loop.depth0 \u6307\u793a\u5f53\u524d\u6e32\u67d3\u5728\u9012\u5f52\u5faa\u73af\u4e2d\u7684\u6df1\u5ea6\u3002 \u4ece0\u5f00\u59cb loop.previtem \u5faa\u73af\u7684\u4e0a\u4e00\u4e2a\u8fed\u4ee3\u4e2d\u7684\u9879\u76ee\u3002 \u5728\u7b2c\u4e00\u6b21\u8fed\u4ee3\u4e2d\u672a\u5b9a\u4e49\u3002 loop.nextitem \u5faa\u73af\u7684\u4ee5\u4e0b\u8fed\u4ee3\u4e2d\u7684\u9879\u76ee\u3002 \u5728\u4e0a\u4e00\u6b21\u8fed\u4ee3\u671f\u95f4\u672a\u5b9a\u4e49\u3002 loop.changed(*val) \u5982\u679c\u4ee5\u524d\u4f7f\u7528\u5176\u4ed6\u503c\u8c03\u7528\uff08\u6216\u6839\u672c\u672a\u8c03\u7528\uff09\uff0c\u5219\u4e3atrue\u3002 if \u8bed\u53e5 \u00b6 Jinja \u4e2d\u7684 if \u8bed\u53e5\u53ef\u6bd4 Python \u4e2d\u7684 if \u8bed\u53e5\u3002 {% if kenny.sick %} Kenny is sick. {% elif kenny.dead %} You killed Kenny! You bastard!!! {% else %} Kenny looks okay --- so far {% endif %} \u8fc7\u6ee4\u5668 \u00b6 \u53d8\u91cf\u53ef\u4ee5\u901a\u8fc7 \u8fc7\u6ee4\u5668 \u4fee\u6539\u3002\u8fc7\u6ee4\u5668\u4e0e\u53d8\u91cf\u7528\u7ba1\u9053\u7b26\u53f7\uff08 | \uff09\u5206\u5272\uff0c\u5e76\u4e14\u4e5f \u53ef\u4ee5\u7528\u5706\u62ec\u53f7\u4f20\u9012\u53ef\u9009\u53c2\u6570\u3002\u591a\u4e2a\u8fc7\u6ee4\u5668\u53ef\u4ee5\u94fe\u5f0f\u8c03\u7528\uff0c\u524d\u4e00\u4e2a\u8fc7\u6ee4\u5668\u7684\u8f93\u51fa\u4f1a\u88ab\u4f5c\u4e3a \u540e\u4e00\u4e2a\u8fc7\u6ee4\u5668\u7684\u8f93\u5165\u3002 {{ name | striptags | title }} \u8fc7\u6ee4\u5668\u6bb5\u5141\u8bb8\u4f60\u5728\u4e00\u5757\u6a21\u677f\u6570\u636e\u4e0a\u5e94\u7528\u5e38\u89c4 Jinja2 \u8fc7\u6ee4\u5668\u3002\u53ea\u9700\u8981\u628a\u4ee3\u7801\u7528 filter \u8282\u5305\u88f9\u8d77\u6765: {% filter upper %} This text becomes uppercase {% endfilter %} \u8d4b\u503c \u00b6 \u5728\u4ee3\u7801\u5757\u4e2d\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4e3a\u53d8\u91cf\u8d4b\u503c\u3002\u5728\u9876\u5c42\u7684\uff08\u5757\u3001\u5b8f\u3001\u5faa\u73af\u4e4b\u5916\uff09\u8d4b\u503c\u662f\u53ef\u5bfc\u51fa\u7684\uff0c\u5373 \u53ef\u4ee5\u4ece\u522b\u7684\u6a21\u677f\u4e2d\u5bfc\u5165\u3002 \u8d4b\u503c\u4f7f\u7528 set \u6807\u7b7e\uff0c\u5e76\u4e14\u53ef\u4ee5\u4e3a\u591a\u4e2a\u53d8\u91cf\u8d4b\u503c: {% set navigation = [('index.html', 'Index'), ('about.html', 'About')] %} {% set key, value = call_something() %} \u8868\u8fbe\u5f0f \u00b6 {% ... %} \u7528\u4e8e\u6267\u884c\u8bf8\u5982 for \u5faa\u73af \u6216\u8d4b\u503c\u7684\u8bed\u53e5 {{ ... }} \u628a\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u6253\u5370\u5230\u6a21\u677f\u4e0a if \u8868\u8fbe\u5f0f \u4e00\u822c\u7684\u8bed\u6cd5\u662f <do something> if <something is true> else <do something else> \u3002 {{ '[%s]' % page.title if page.title is defined else 'undefined' }} \u5b57\u9762\u91cf \u00b6 \u8868\u8fbe\u5f0f\u6700\u7b80\u5355\u7684\u5f62\u5f0f\u5c31\u662f\u5b57\u9762\u91cf\u3002\u5b57\u9762\u91cf\u8868\u793a\u8bf8\u5982\u5b57\u7b26\u4e32\u548c\u6570\u503c\u7684 Python \u5bf9\u8c61\u3002\u4e0b\u9762 \u7684\u5b57\u9762\u91cf\u662f\u53ef\u7528\u7684: \u503c \u8bf4\u660e \"Hello World\" \u53cc\u5f15\u53f7\u6216\u5355\u5f15\u53f7\u4e2d\u95f4\u7684\u4e00\u5207\u90fd\u662f\u5b57\u7b26\u4e32\u3002\u65e0\u8bba\u4f55\u65f6\u4f60\u9700\u8981\u5728\u6a21\u677f\u4e2d\u4f7f\u7528\u4e00\u4e2a\u5b57 \u7b26\u4e32\uff08\u6bd4\u5982\u51fd\u6570\u8c03\u7528\u3001\u8fc7\u6ee4\u5668\u6216\u53ea\u662f\u5305\u542b\u6216\u7ee7\u627f\u4e00\u4e2a\u6a21\u677f\u7684\u53c2\u6570\uff09\uff0c\u5b83\u4eec\u90fd\u662f \u6709\u7528\u7684\u3002 42/42.23 \u76f4\u63a5\u5199\u4e0b\u6570\u503c\u5c31\u53ef\u4ee5\u521b\u5efa\u6574\u6570\u548c\u6d6e\u70b9\u6570\u3002\u5982\u679c\u6709\u5c0f\u6570\u70b9\uff0c\u5219\u4e3a\u6d6e\u70b9\u6570\uff0c\u5426\u5219\u4e3a \u6574\u6570\u3002\u8bb0\u4f4f\u5728 Python \u91cc\uff0c 42 \u548c 42.0 \u662f\u4e0d\u4e00\u6837\u7684\u3002 ['list','of','objects'] \u4e00\u5bf9\u4e2d\u62ec\u53f7\u62ec\u8d77\u6765\u7684\u4e1c\u897f\u662f\u4e00\u4e2a\u5217\u8868\u3002\u5217\u8868\u7528\u4e8e\u5b58\u50a8\u548c\u8fed\u4ee3\u5e8f\u5217\u5316\u7684\u6570\u636e\u3002 ('tuple','of','values') \u5143\u7ec4\u4e0e\u5217\u8868\u7c7b\u4f3c\uff0c\u53ea\u662f\u4f60\u4e0d\u80fd\u4fee\u6539\u5143\u7ec4\u3002\u5982\u679c\u5143\u7ec4\u4e2d\u53ea\u6709\u4e00\u4e2a\u9879\uff0c\u4f60\u9700\u8981\u4ee5\u9017\u53f7 \u7ed3\u5c3e\u5b83\u3002\u5143\u7ec4\u901a\u5e38\u7528\u4e8e\u8868\u793a\u4e24\u4e2a\u6216\u66f4\u591a\u5143\u7d20\u7684\u9879\u3002\u66f4\u591a\u7ec6\u8282\u89c1\u4e0a\u9762\u7684\u4f8b\u5b50\u3002 Python \u4e2d\u7684\u5b57\u5178\u662f\u4e00\u79cd\u5173\u8054\u952e\u548c\u503c\u7684\u7ed3\u6784\u3002\u952e\u5fc5\u987b\u662f\u552f\u4e00\u7684\uff0c\u5e76\u4e14\u952e\u5fc5\u987b\u53ea\u6709\u4e00\u4e2a \u503c\u3002\u5b57\u5178\u5728\u6a21\u677f\u4e2d\u5f88\u5c11\u4f7f\u7528\uff0c\u7f55\u7528\u4e8e\u8bf8\u5982 xmlattr() \u8fc7\u6ee4\u5668\u4e4b\u7c7b\u3002 true/false true \u6c38\u8fdc\u662f true \uff0c\u800c false \u59cb\u7ec8\u662f false \u3002 Note \u200b \u7279\u6b8a\u5e38\u91cf true \u3001 false \u548c none \u5b9e\u9645\u4e0a\u662f\u5c0f\u5199\u7684\u3002\u56e0\u4e3a\u8fd9\u5728\u8fc7\u53bb\u4f1a\u5bfc\u81f4 \u6df7\u6dc6\uff0c\u8fc7\u53bb True\u6269\u5c55\u4e3a\u4e00\u4e2a\u88ab\u8ba4\u4e3afalse \u7684\u672a\u5b9a\u4e49\u7684\u53d8\u91cf\u3002\u6240\u6709\u7684\u8fd9\u4e09\u4e2a \u5e38\u91cf\u4e5f\u53ef\u4ee5\u88ab\u5199\u6210\u9996\u5b57\u6bcd\u5927\u5199\uff08 True \u3001 False \u548c None \uff09\u3002\u5c3d\u7ba1\u5982\u6b64\uff0c \u4e3a\u4e86\u4e00\u81f4\u6027\uff08\u6240\u6709\u7684 Jinja \u6807\u8bc6\u7b26\u662f\u5c0f\u5199\u7684\uff09\uff0c\u4f60\u5e94\u8be5\u4f7f\u7528\u5c0f\u5199\u7684\u7248\u672c\u3002 \u7b97\u672f \u00b6 Jinja \u5141\u8bb8\u4f60\u7528\u8ba1\u7b97\u503c\u3002\u8fd9\u5728\u6a21\u677f\u4e2d\u5f88\u5c11\u7528\u5230\uff0c\u4f46\u662f\u4e3a\u4e86\u5b8c\u6574\u6027\u5141\u8bb8\u5176\u5b58\u5728\u3002\u652f\u6301\u4e0b\u9762\u7684 \u8fd0\u7b97\u7b26: \u8fd0\u7b97\u7b26 \u8bf4\u660e + \u628a\u4e24\u4e2a\u5bf9\u8c61\u52a0\u5230\u4e00\u8d77\u3002\u901a\u5e38\u5bf9\u8c61\u662f\u7d20\u8d28\uff0c\u4f46\u662f\u5982\u679c\u4e24\u8005\u662f\u5b57\u7b26\u4e32\u6216\u5217\u8868\uff0c\u4f60\u53ef\u4ee5\u7528\u8fd9 \u79cd\u65b9\u5f0f\u6765\u8854\u63a5\u5b83\u4eec\u3002\u65e0\u8bba\u5982\u4f55\u8fd9\u4e0d\u662f\u9996\u9009\u7684\u8fde\u63a5\u5b57\u7b26\u4e32\u7684\u65b9\u5f0f\uff01\u8fde\u63a5\u5b57\u7b26\u4e32\u89c1 ~ \u8fd0\u7b97\u7b26\u3002 - \u7528\u7b2c\u4e00\u4e2a\u6570\u51cf\u53bb\u7b2c\u4e8c\u4e2a\u6570\u3002 / \u5bf9\u4e24\u4e2a\u6570\u505a\u9664\u6cd5\u3002\u8fd4\u56de\u503c\u4f1a\u662f\u4e00\u4e2a\u6d6e\u70b9\u6570\u3002 // \u5bf9\u4e24\u4e2a\u6570\u505a\u9664\u6cd5\uff0c\u8fd4\u56de\u6574\u6570\u5546\u3002 % \u8ba1\u7b97\u6574\u6570\u9664\u6cd5\u7684\u4f59\u6570\u3002 * \u7528\u53f3\u8fb9\u7684\u6570\u4e58\u5de6\u8fb9\u7684\u64cd\u4f5c\u6570\u3002 ** \u53d6\u5de6\u64cd\u4f5c\u6570\u7684\u53f3\u64cd\u4f5c\u6570\u6b21\u5e42\u3002 \u6bd4\u8f83\u8fd0\u7b97\u7b26 \u8fd0\u7b97\u7b26 \u8bf4\u660e == \u6bd4\u8f83\u4e24\u4e2a\u5bf9\u8c61\u662f\u5426\u76f8\u7b49\u3002 != \u6bd4\u8f83\u4e24\u4e2a\u5bf9\u8c61\u662f\u5426\u4e0d\u7b49\u3002 > \u5982\u679c\u5de6\u8fb9\u5927\u4e8e\u53f3\u8fb9\uff0c\u8fd4\u56de true \u3002 >= \u5982\u679c\u5de6\u8fb9\u5927\u4e8e\u7b49\u4e8e\u53f3\u8fb9\uff0c\u8fd4\u56de true \u3002 < \u5982\u679c\u5de6\u8fb9\u5c0f\u4e8e\u53f3\u8fb9\uff0c\u8fd4\u56de true \u3002 <= \u5982\u679c\u5de6\u8fb9\u5c0f\u4e8e\u7b49\u4e8e\u53f3\u8fb9\uff0c\u8fd4\u56de true \u3002 \u903b\u8f91\u8fd0\u7b97\u7b26 \u5bf9\u4e8e if \u8bed\u53e5\uff0c\u5728 for \u8fc7\u6ee4\u6216 if \u8868\u8fbe\u5f0f\u4e2d\uff0c\u5b83\u53ef\u4ee5\u7528\u4e8e\u8054\u5408\u591a\u4e2a\u8868\u8fbe\u5f0f: \u8fd0\u7b97\u7b26 \u8bf4\u660e and \u5982\u679c\u5de6\u64cd\u4f5c\u6570\u548c\u53f3\u64cd\u4f5c\u6570\u540c\u4e3a\u771f\uff0c\u8fd4\u56de true \u3002 or \u5982\u679c\u5de6\u64cd\u4f5c\u6570\u548c\u53f3\u64cd\u4f5c\u6570\u6709\u4e00\u4e2a\u4e3a\u771f\uff0c\u8fd4\u56de true \u3002 not \u5bf9\u4e00\u4e2a\u8868\u8fbe\u5f0f\u53d6\u53cd\uff08\u89c1\u4e0b\uff09\u3002 (expr) \u8868\u8fbe\u5f0f\u7ec4\u3002 !!! note \u63d0\u793a \u200b is \u548c in \u8fd0\u7b97\u7b26\u540c\u6837\u652f\u6301\u4f7f\u7528\u4e2d\u7f00\u8bb0\u6cd5: foo is not bar \u548c foo not in bar \u800c\u4e0d\u662f not foo is bar \u548c not foo in bar \u3002\u6240\u6709\u7684 \u5176\u5b83\u8868\u8fbe\u5f0f\u9700\u8981\u524d\u7f00\u8bb0\u6cd5 not (foo and bar) \u3002 \u5176\u5b83\u8fd0\u7b97\u7b26 \u4e0b\u9762\u7684\u8fd0\u7b97\u7b26\u975e\u5e38\u6709\u7528\uff0c\u4f46\u4e0d\u9002\u7528\u4e8e\u5176\u5b83\u7684\u4e24\u4e2a\u5206\u7c7b: \u8fd0\u7b97\u7b26 \u8bf4\u660e in \u8fd0\u884c\u5e8f\u5217/\u6620\u5c04\u5305\u542b\u68c0\u67e5\u3002\u5982\u679c\u5de6\u64cd\u4f5c\u6570\u5305\u542b\u4e8e\u53f3\u64cd\u4f5c\u6570\uff0c\u8fd4\u56de true \u3002\u6bd4\u5982 is \u8fd0\u884c\u4e00\u4e2a \u6d4b\u8bd5 \u3002 | \u5e94\u7528\u4e00\u4e2a \u8fc7\u6ee4\u5668 \u3002 ~ \u628a\u6240\u6709\u7684\u64cd\u4f5c\u6570\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\uff0c\u5e76\u4e14\u8fde\u63a5\u5b83\u4eec\u3002 () \u8c03\u7528\u4e00\u4e2a\u53ef\u8c03\u7528\u91cf: . / [] \u83b7\u53d6\u4e00\u4e2a\u5bf9\u8c61\u7684\u5c5e\u6027\u3002 Python\u5bf9\u8c61\u65b9\u6cd5 \u00b6 \u5728\u6a21\u677f\u4e2d\uff0c\u4e5f\u662f\u53ef\u4ee5\u4f7f\u7528python\u7684\u5bf9\u8c61\u65b9\u6cd5 \u5b57\u7b26\u4e32\u65b9\u6cd5 endswith: \u7528\u4e8e\u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u4ee5\u6307\u5b9a\u540e\u7f00\u7ed3\u5c3e\uff0c\u5982\u679c\u4ee5\u6307\u5b9a\u540e\u7f00\u7ed3\u5c3e\u8fd4\u56deTrue\uff0c\u5426\u5219\u8fd4\u56deFalse startswith: \u7528\u4e8e\u68c0\u67e5\u5b57\u7b26\u4e32\u662f\u5426\u662f\u4ee5\u6307\u5b9a\u5b50\u5b57\u7b26\u4e32\u5f00\u5934\uff0c\u5982\u679c\u662f\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False\u3002 split: \u6307\u5b9a\u5206\u9694\u7b26\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c\u5207\u7247\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\u683c rsplit: \u4e0esplit\u76f8\u540c\uff0c\u4f46\u4ece\u5b57\u7b26\u4e32\u7684\u672b\u5c3e\u5f00\u59cb\u5207\u7247 splitlines: \u6309\u7167\u884c('\\r', '\\r\\n', \\n')\u5206\u9694\uff0c\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u5404\u884c\u4f5c\u4e3a\u5143\u7d20\u7684\u5217\u8868 upper: \u8fd4\u56de\u5168\u90e8\u5927\u5199\u7684\u5b57\u7b26\u4e32 lower: \u8fd4\u56de\u5168\u90e8\u5c0f\u5199\u7684\u5b57\u7b26\u4e32 capitalize: \u5c06\u5b57\u7b26\u4e32\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u53d8\u6210\u5927\u5199,\u5176\u4ed6\u5b57\u6bcd\u53d8\u5c0f\u5199 \u5217\u8868\u65b9\u6cd5 index \u8fd4\u56de\u63d0\u4f9b\u503c\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u4f4d\u7f6e count \u7edf\u8ba1\u67d0\u4e2a\u5143\u7d20\u5728\u5217\u8868\u4e2d\u51fa\u73b0\u7684\u6b21\u6570 python \u7248\u672c\u5904\u7406 \u5728python2\u4e2d\uff0c\u4f7f\u7528 dict.keys() , dict.values() , dict.items() \u8fd4\u56de\u5b57\u5178\u7684\u5217\u8868\u5f62\u5f0f\u3002\u4f46\u662f\u5728python3\u4e2d\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u5219\u8fd4\u56de\u5b57\u5178\u5f62\u5f0f # Only works with Python 2 {{ hosts.keys() }} # Works with both Python 2 and Python 3 {{ hosts.keys() | list }} \u5728python2\u4e2d\uff0c\u5b57\u5178\u6709 iterkeys() , itervalues() , and iteritems() \u65b9\u6cd5\uff0c\u4f46\u662f\u5728python3\u4e2d\u8fd9\u4e9b\u65b9\u6cd5\u88ab\u5220\u9664\uff0cpython3\u5219\u4f7f\u7528 dict.keys() , dict.values() , dict.items() # Only works with Python 2 {{ hosts.iteritems() }} # Works with both Python 2 and Python 3 {{ hosts.items() | list }} \u5728 ansible \u4e2d\u4f7f\u7528Jinja2 \u00b6 \u83b7\u53d6\u5f53\u524d\u65f6\u95f4 \u00b6 \u4f7f\u7528 now() jinja2 \u51fd\u6570\u53ef\u4ee5\u83b7\u53d6\u5f53\u524d\u7684\u65f6\u95f4 ansible localhost -m debug -a \"msg={{ now(utc='True',fmt='%H-%m-%d %T') }}\" utc \u53c2\u6570\u53ef\u4ee5\u5f00\u542futc\u65f6\u95f4\uff0c fmt\u53c2\u6570\u4e3a\u65f6\u95f4\u7684\u683c\u5f0f\u5316\u8f93\u51fa\u3002 {{ }} \u4ee3\u8868\u628a\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u6253\u5370\u5230\u6a21\u677f\u4e0a \u8fc7\u6ee4\u5668 \u00b6 Ansible\u4e2d\u7684\u8fc7\u6ee4\u5668\u6765\u81ea Jinja2 \uff0c\u7528\u4e8e\u5728\u6a21\u677f\u8868\u8fbe\u5f0f\u4e2d\u8f6c\u6362\u6570\u636e\u3002 \u8fc7\u6ee4\u5668\u4e0e\u53d8\u91cf\u7528\u7ba1\u9053\u7b26\u53f7 | \u5206\u5272 \u683c\u5f0f\u5316\u6570\u636e\u8fc7\u6ee4\u5668 \u00b6 \u66f4\u6539\u6570\u636e\u683c\u5f0f\uff0c\u5176\u7ed3\u679c\u662f\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32 {{ some_variable | to_json }} {{ some_variable | to_yaml }} \u5bf9\u4e8e\u4eba\u7c7b\u53ef\u8bfb\u5f97\u8f93\u51fa {{ some_variable | to_nice_json }} {{ some_variable | to_nice_yaml }} \u8fd8\u53ef\u4ee5\u589e\u52a0\u53c2\u6570( new in 2.2) {{ some_variable | to_nice_json(indent=2) }} {{ some_variable | to_nice_yaml(indent=8) }} {{ some_variable | to_nice_yaml(indent=8, width=1337) }} indent \u6307\u5b9a\u7f29\u8fdb\u5b57\u7b26\u6570\uff0c width\u9650\u5236\u884c\u6570\u5bbd\u5ea6 \u4ecejson\u5b57\u7b26\u4e32\u8bfb\u53d6\uff0c\u5176\u7ed3\u679c\u4e3ajson\u7c7b\u578b {{ some_variable | from_json }} \u4eceyaml\u5b57\u7b26\u4e32\u8bfb\u53d6\uff0c\u5176\u7ed3\u679c\u4e3ayaml\u7c7b\u578b {{ some_variable | from_yaml }} \u793a\u4f8b\uff1a\u5c06json\u6587\u4ef6\u5185\u5bb9\u8d4b\u503c\u7ed9\u53d8\u91cf tasks: - shell: cat /some/path/to/file.json register: result - set_fact: myvar: \"{{ result.stdout | from_json }}\" \u4f7f\u7528`from_yaml_all \u89e3\u6790\u591a\u6bb5yaml\u5b57\u7b26\u4e32 tasks : - shell : cat /some/path/to/multidoc-file.yaml register : result - debug : msg : '{{ item }}' loop : '{{ result.stdout | from_yaml_all | list }}' \u5f3a\u5236\u5b9a\u4e49\u53d8\u91cf \u00b6 \u5982\u679c\u53d8\u91cf\u672a\u5b9a\u4e49\uff0c\u5219\u6765\u81ea ansible \u548c ansible.cfg \u7684\u9ed8\u8ba4\u884c\u4e3a\u4e3a\u5931\u8d25\uff0c\u4f46\u60a8\u53ef\u4ee5\u5c06\u5176\u5173\u95ed\u3002 {{ variable | mandatory }} \u672a\u5b9a\u4e49\u7684\u53d8\u91cf\u9ed8\u8ba4\u503c \u00b6 {{ result.cmd|default(5) }} {{ lookup('env', 'MY_USER') | default('admin', true) }} {{ lookup('env', 'MY_USER') | default('admin', false) }} \u5982\u679c\u53d8\u91cf\u672a\u5b9a\u4e49\uff0c\u5219\u5c06\u9ed8\u8ba4\u503c\u8d4b\u503c\u7ed9\u53d8\u91cf\uff0c\u5982\u679c\u5e0c\u671b\u53d8\u91cf\u503c\u4e3a\u7a7a\u7684\u65f6\u5019\u4e5f\u8d4b\u503c\uff0c\u9700\u5c06 default \u7b2c\u4e8c\u4e2a\u503c\u4e3a true \u7701\u7565\u53c2\u6570 \u00b6 - name : touch files with an optional mode file : dest : \"{{ item.path }}\" state : touch mode : \"{{ item.mode | default(omit) }}\" loop : - path : /tmp/foo - path : /tmp/bar - path : /tmp/baz mode : \"0444\" \u5bf9\u4e8e\u5217\u8868\u4e2d\u7684\u524d\u4e24\u4e2a\u6587\u4ef6\uff0c\u9ed8\u8ba4mode\u5c06\u7531\u7cfb\u7edf\u7684umask\u786e\u5b9a\uff0c\u56e0\u4e3a mode=parameter \u4e0d\u4f1a\u53d1\u9001\u5230\u6587\u4ef6\u6a21\u5757\uff0c\u800c\u6700\u540e\u5f97\u6587\u4ef6\u5c06\u63a5\u6536 mode=0444 \u9009\u9879\u3002 \u5217\u8868\u8fc7\u6ee4 \u00b6 \u53d6\u6700\u5c0f\u7684\u503c {{ list1 | min }} \u53d6\u6700\u5927\u7684\u503c {{ [3, 4, 2] | max }} \u5c55\u5e73\u5217\u8868 {{ [3, [4, 2] ] | flatten }} {{ [3, [4, [2]] ] | flatten(levels=1) }} # \u5c55\u5e73\u7b2c\u4e00\u7ea7 \u6570\u636e\u96c6\u8fc7\u6ee4 \u00b6 \u5bf9\u5217\u8868\u552f\u4e00\u8fc7\u6ee4 {{ list1 | unique }} \u5bf9\u4e24\u4e2a\u5217\u8868\u53bb\u91cd\u5408\u5e76 {{ list1 | union(list2) }} \u5bf9\u4e24\u4e2a\u5217\u8868\u505a\u4ea4\u96c6 {{ list1 | intersect(list2) }} \u627e\u5230\u4e24\u4e2a\u5217\u8868\u5dee\u5f02\u90e8\u5206(\u5728list1 \u4e0d\u5728list2 \u7684\u5dee\u5f02) {{ list1 | difference(list2) }} \u627e\u5230\u4e24\u4e2a\u5217\u8868\u90fd\u4e92\u76f8\u4e0d\u5728\u5bf9\u65b9\u5217\u8868\u7684\u90e8\u5206 {{ list1 | symmetric_difference(list2) }} \u5b57\u5178\u8fc7\u6ee4 \u00b6 \u5c06\u5b57\u5178\u53d8\u4e3a\u5217\u8868 {{ dict | dict2items }} \u8fd4\u56de\u7684\u5217\u8868 - key : Application value : payment - key : Environment value : dev \u53ef\u6307\u5b9a\u5217\u8868 key/vaule \u7684\u540d\u5b57 {{ files | dict2items(key_name='file', value_name='path') }} \u5c06\u5217\u8868\u8f6c\u6362\u4e3a\u5b57\u5178 {{ tags | items2dict }} \u8fd4\u56de\u7684\u5b57\u5178 Application : payment Environment : dev \u53ef\u6307\u5b9a\u5217\u8868 key/vaule \u7684\u540d\u5b57 {{ tags | items2dict(key_name='key', value_name='value') }} zip \u8fc7\u6ee4 \u00b6 \u4f7f\u7528 zip \u6765\u5408\u5e76\u5176\u4ed6\u5217\u8868 - name : give me list combo of two lists debug : msg : \"{{ [1,2,3,4,5] | zip(['a','b','c','d','e','f']) | list }}\" - name : give me shortest combo of two lists debug : msg : \"{{ [1,2,3] | zip(['a','b','c','d','e','f']) | list }}\" \u4f7f\u7528 zip_longest \u4ee5\u5143\u7d20\u6700\u591a\u4e3a\u5408\u5e76\u5bf9\u8c61 - name : give me longest combo of three lists , fill with X debug : msg : \"{{ [1,2,3] | zip_longest(['a','b','c','d','e','f'], [21, 22, 23], fillvalue='X') | list }}\" zip \u4e5f\u53ef\u4ee5\u7528\u4e8e\u6784\u9020\u5b57\u5178 {{ dict(keys_list | zip(values_list)) }} \u53d8\u91cf keys_list : - one - two values_list : - apple - orange \u8f6c\u6362\u540e one : apple two : orange \u5b50\u5143\u7d20\u8fc7\u6ee4\u5668 \u00b6 \u4f7f\u7528 subelements \u8fc7\u6ee4\u5bf9\u8c61\u7684\u5b50\u5143\u7d20 {{ users | subelements('groups', skip_missing=True) }} \u53d8\u91cf users : - name : alice authorized : - /tmp/alice/onekey.pub - /tmp/alice/twokey.pub groups : - wheel - docker - name : bob authorized : - /tmp/bob/id_rsa.pub groups : - docker \u8f6c\u6362\u540e - - name : alice groups : - wheel - docker authorized : - /tmp/alice/onekey.pub - /tmp/alice/twokey.pub - wheel - - name : alice groups : - wheel - docker authorized : - /tmp/alice/onekey.pub - /tmp/alice/twokey.pub - docker - - name : bob authorized : - /tmp/bob/id_rsa.pub groups : - docker - docker \u4e00\u4e2a\u5728\u5faa\u73af\u4e2d\u4f7f\u7528\u7684\u4f8b\u5b50 - name : Set authorized ssh key, extracting just that data from 'users' authorized_key : user : \"{{ item.0.name }}\" key : \"{{ lookup('file', item.1) }}\" loop : \"{{ users | subelements('authorized') }}\" \u968f\u673aMac\u5730\u5740\u8fc7\u6ee4\u5668 \u00b6 \u4ece\u4e00\u4e2a\u4ee5 52:54:00 \u5f00\u5934\u7684\u5b57\u7b26\u4e32\u524d\u7f00\u4e2d\u83b7\u53d6\u4e00\u4e2a\u968f\u673a\u7684MAC\u5730\u5740 \"{{ '52:54:00' | random_mac }}\" # => '52:54:00:ef:1c:03' \u4f7f\u7528\u56e0\u5b50\uff0c\u521b\u5efa\u968f\u673a\u4f46\u5e42\u7b49\u7684MAC\u5730\u5740 \"{{ '52:54:00' | random_mac(seed=inventory_hostname) }}\" \u968f\u673a\u6570\u8fc7\u6ee4 \u00b6 \u4ece\u5217\u8868\u4e2d\u968f\u673a\u83b7\u53d6\u5143\u7d20 {{ ['a','b','c','d','e','f']|random }} \u4ece0-59 \u7684\u6574\u6570\u4e2d\u968f\u673a\u83b7\u53d6\u4e00\u4e2a\u6570 {{ 59 | random}} \u4ece0-100 \u4e2d\u968f\u673a\u83b7\u53d6\u80fd\u88ab10 \u6574\u9664\u7684\u6570\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a0 10 20 30 40 50 ...100 \u7684\u968f\u673a\u6570\uff09 {{ 100 |random(step=10) }} \u4ece0-100 \u4e2d\u968f\u673a\u83b7\u53d61 \u5f00\u59cb\u6b65\u957f\u4e3a10 \u7684\u6570\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a1 11 21 31 41...91 \u7684\u968f\u673a\u6570\uff09 {{ 100 |random(1, 10) }} {{ 100 |random(start=1, step=10) }} \u4f7f\u7528\u56e0\u5b50\u521b\u5efa\u968f\u673a\u6570 \"{{ 60 | random(seed=inventory_hostname) }} * * * * root /script/from/cron\" \u968f\u673a\u5217\u8868\u8fc7\u6ee4 \u00b6 \u7ed9\u5df2\u5b58\u5728\u7684\u5217\u8868\u968f\u673a\u6392\u5e8f {{ ['a','b','c']|shuffle }} => ['c','a','b'] {{ ['a','b','c']|shuffle }} => ['b','c','a'] \u4f7f\u7528\u56e0\u5b50\u751f\u6210\u968f\u673a\u5217\u8868 {{ ['a','b','c'] | shuffle(seed=inventory_hostname) }} # => ['b','a','c'] \u6570\u5b66 \u00b6 \u83b7\u53d6\u5bf9\u6570, \u9ed8\u8ba4 e {{ myvar | log }} {{ myvar | log(10) }} \u83b7\u53d6n\u6b21\u5e42 {{ myvar | pow(2) }} {{ myvar | pow(5) }} \u83b7\u53d6\u5e73\u65b9\u6839 {{ myvar | root }} {{ myvar | root(5) }} JSON\u67e5\u8be2\u8fc7\u6ee4 \u00b6 \u8be5\u8fc7\u6ee4\u5668\u57fa\u4e8ejmespath\u6784\u5efa \u66f4\u591a\u7684\u793a\u4f8b jmespath examples . json\u8fc7\u6ee4\u5668\uff0c\u53ef\u4ee5\u5bf9\u590d\u6742\u7684json\u6570\u636e\u4f53\u63d0\u53d6\u4e00\u90e8\u5206\u6570\u636e\u3002 json\u7ed3\u6784\u4f53 { \"domain_definition\" : { \"domain\" : { \"cluster\" : [ { \"name\" : \"cluster1\" }, { \"name\" : \"cluster2\" } ], \"server\" : [ { \"name\" : \"server11\" , \"cluster\" : \"cluster1\" , \"port\" : \"8080\" }, { \"name\" : \"server12\" , \"cluster\" : \"cluster1\" , \"port\" : \"8090\" } ], \"library\" : [ { \"name\" : \"lib1\" , \"target\" : \"cluster1\" }, { \"name\" : \"lib2\" , \"target\" : \"cluster2\" } ] } } } \u8981\u4ece\u8fd9\u4e2a\u7ed3\u6784\u4e2d\u63d0\u53d6\u6240\u6709 cluster \uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u67e5\u8be2 - name : \"Display all cluster names\" debug : var : item loop : \"{{ domain_definition | json_query('domain.cluster[*].name') }}\" \u63d0\u53d6\u6240\u6709 server \u7684 name - name : \"Display all server names\" debug : var : item loop : \"{{ domain_definition | json_query('domain.server[*].name') }}\" \u63d0\u53d6 cluster1 \u7684 port - name : \"Display all ports from cluster1\" debug : var : item loop : \"{{ domain_definition | json_query(server_name_cluster1_query) }}\" vars : server_name_cluster1_query : \"domain.server[?cluster=='cluster1'].port\" \u4f7f\u7528\u5b57\u7b26\u4e32\u6765\u8fde\u63a5\u7aef\u53e3 - name : \"Display all ports from cluster1 as a string\" debug : msg : \"{{ domain_definition | json_query('domain.server[?cluster==`cluster1`].port') | join(', ') }}\" \u8fd9\u91cc\u4f7f\u7528\u53cd\u5f15\u53f7\u6765\u907f\u514d\u8f6c\u4e49 \u53ef\u4ee5\u4f7f\u7528\u5355\u5f15\u53f7\u8f6c\u4e49 - name : \"Display all ports from cluster1\" debug : var : item loop : \"{{ domain_definition | json_query('domain.server[?cluster==''cluster1''].port') }}\" ip\u5730\u5740\u8fc7\u6ee4 \u00b6 \u6d4b\u8bd5\u5b57\u7b26\u4e32\u662f\u6709\u6548\u7684ip\u5730\u5740\u4e0d {{ myvar | ipaddr }} \u5b57\u7b26\u4e32\u8f6cip\u534f\u8bae\u5730\u5740 {{ myvar | ipv4 }} {{ myvar | ipv6 }} \u4ececidr\u4e2d\u83b7\u53d6\u5730\u5740\u4fe1\u606f {{ '192.0.2.1/24' | ipaddr('address') }} Network CLI \u8fc7\u6ee4\u5668 \u00b6 \u4f7f\u7528 parse_cli \u8fc7\u6ee4\u5668\u5c06\u7f51\u7edc\u8bbe\u5907CLI\u547d\u4ee4\u7684\u8f93\u51fa\u8f6c\u6362\u4e3aJSON\u8f93\u51fa {{ output | parse_cli('path/to/spec') }} \u8fd8\u652f\u6301\u4f7f\u7528TextFSM\u5e93\u89e3\u6790CLI\u547d\u4ee4\u7684\u8f93\u51fa {{ output | parse_cli_textfsm('path/to/fsm') }} Network XML \u8fc7\u6ee4\u5668 \u00b6 \u4f7f\u7528 parse_xml \u8fc7\u6ee4\u5668\u5c06\u7f51\u7edc\u8bbe\u5907CLI\u547d\u4ee4\u7684\u8f93\u51fa\u8f6c\u6362\u4e3aXML\u8f93\u51fa {{ output | parse_xml('path/to/spec') }} Network VLAN \u8fc7\u6ee4\u5668 \u00b6 {{ [3003, 3004, 3005, 100, 1688, 3002, 3999] | vlan_parser }} \u8f93\u51fa ['100,1688,3002-3005,3999'] \u53e6\u4e00\u4e2ajinja2\u6a21\u677f\u4f8b\u5b50 {% set parsed_vlans = vlans | vlan_parser %} switchport trunk allowed vlan {{ parsed_vlans[0] }} {% for i in range (1, parsed_vlans | count) %} switchport trunk allowed vlan add {{ parsed_vlans[i] }} \u54c8\u5e0c\u8fc7\u6ee4\u5668 \u00b6 \u83b7\u53d6\u5b57\u7b26\u4e32\u5f97hash\u503c {{ 'test1'|hash('sha1') }} {{ 'test1'|hash('md5') }} \u83b7\u53d6\u5b57\u7b26\u4e32\u6821\u9a8c\u548c {{ 'test2'|checksum }} \u83b7\u53d6sha512\u5bc6\u7801\u54c8\u5e0c {{ 'passwordsaresecret'|password_hash('sha512') }} {{ 'secretpassword'|password_hash('sha256', 'mysecretsalt') }} \u5408\u5e76\u6563\u5217 \u00b6 {{ {'a':1, 'b':2}|combine({'b':3}) }} \u7ed3\u679c {'a':1, 'b':3} \u652f\u6301\u9012\u5f52\u5408\u5e76 {{ {'a':{'foo':1, 'bar':2}, 'b':2}|combine({'a':{'bar':3, 'baz':4}}, recursive=True) }} \u7ed3\u679c {'a':{'foo':1, 'bar':3, 'baz':4}, 'b':2} \u63d0\u53d6\u8fc7\u6ee4\u5668 \u00b6 \u4f7f\u7528 map extract \u7b5b\u9009\u5668\u5c06\u7d22\u5f15\u5217\u8868\u6620\u5c04\u5230\u5bb9\u5668\u4e2d\u7684\u503c\u4f5c\u4e3a\u5217\u8868\u8fd4\u56de {{ [0,2]|map('extract', ['x','y','z'] )| list }} # ['x', 'z'] {{ ['x','y']|map('extract', {'x': 42, 'y': 31})|list }} # [42, 31] {{ groups['x']|map('extract', hostvars, 'ec2_ip_address')|list }} \u8fd9\u9700\u8981\u7ec4'x'\u4e2d\u7684\u4e3b\u673a\u5217\u8868\uff0c\u5728\u4e3b\u673a\u4e2d\u67e5\u627e\u4e3b\u673a\uff0c\u7136\u540e\u67e5\u627e\u7ed3\u679c\u7684ec2_ip_address\u3002 \u6700\u540e\u7684\u7ed3\u679c\u662f\u7ec4'x'\u4e2d\u7684\u4e3b\u673a\u7684IP\u5730\u5740\u5217\u8868\u3002 {{ groups['test'] | map('extract', hostvars, 'ansible_default_ipv4.address')|list }} \u8fc7\u6ee4\u5668\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u7528\u4e8e\u5bb9\u5668\u5185\u7684\u9012\u5f52\u67e5\u627e\uff1a {{ ['a']|map('extract', b, ['x','y'])|list }} # b['a']['x']['y'] \u6ce8\u91ca\u8fc7\u6ee4 \u00b6 comment \u8fc7\u6ee4\u5668\u5141\u8bb8\u7528\u9009\u62e9\u7684\u6ce8\u91ca\u6837\u5f0f\u88c5\u9970\u6587\u672c\u3002 {{ \"Plain style (default)\" | comment }} \u8f93\u51fa # # Plain style (default) # \u6307\u5b9a\u7279\u5b9a\u7684\u6ce8\u91ca\u5b57\u7b26 {{ \"My Special Case\" | comment(decoration=\"! \") }} \u8f93\u51fa ! ! My Special Case ! \u8f93\u51fa\u5404\u79cd\u8bed\u8a00\u7684\u6ce8\u91ca\u98ce\u683c {{ \"C style\" | comment('c') }} {{ \"C block style\" | comment('cblock') }} {{ \"Erlang style\" | comment('erlang') }} {{ \"XML style\" | comment('xml') }} \u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49 {{ \"Custom style\" | comment('plain', prefix='#######\\n#', postfix='#\\n#######\\n ###\\n #') }} \u8f93\u51fa ####### # # Custom style # ####### ### # url \u5206\u5272\u8fc7\u6ee4\u5668 \u00b6 \u4f7f\u7528 urlsplit \u8fc7\u6ee4\u5668\u4eceurl\u5b57\u7b26\u4e32\u4e2d\u53d6\u5176\u4e2d\u7684\u4e00\u4e2a\u7247\u6bb5 {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('hostname') }} # => 'www.acme.com' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('netloc') }} # => 'user:password@www.acme.com:9000' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('username') }} # => 'user' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('password') }} # => 'password' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('path') }} # => '/dir/index.html' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('port') }} # => '9000' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('scheme') }} # => 'http' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('query') }} # => 'query=term' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('fragment') }} # => 'fragment' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit }} # => # { # \"fragment\": \"fragment\", # \"hostname\": \"www.acme.com\", # \"netloc\": \"user:password@www.acme.com:9000\", # \"password\": \"password\", # \"path\": \"/dir/index.html\", # \"port\": 9000, # \"query\": \"query=term\", # \"scheme\": \"http\", # \"username\": \"user\" # } \u6b63\u5219\u5339\u914d \u00b6 # search for \"foo\" in \"foobar\" {{ 'foobar' | regex_search('(foo)') }} # will return empty if it cannot find a match {{ 'ansible' | regex_search('(foobar)') }} # case insensitive search in multiline mode {{ 'foo\\nBAR' | regex_search(\"^bar\", multiline=True, ignorecase=True) }} \u641c\u7d22\u6240\u6709\u5339\u914d\u7684regex # Return a list of all IPv4 addresses in the string {{ 'Some DNS servers are 8.8.8.8 and 8.8.4.4' | regex_findall('\\\\b(?:[0-9]{1,3}\\\\.){3}[0-9]{1,3}\\\\b') }} \u6b63\u5219\u66ff\u6362 # convert \"ansible\" to \"able\" {{ 'ansible' | regex_replace('^a.*i(.*)$', 'a\\\\1') }} # convert \"foobar\" to \"bar\" {{ 'foobar' | regex_replace('^f.*o(.*)$', '\\\\1') }} # convert \"localhost:80\" to \"localhost, 80\" using named groups {{ 'localhost:80' | regex_replace('^(?P<host>.+):(?P<port>\\\\d+)$', '\\\\g<host>, \\\\g<port>') }} # convert \"localhost:80\" to \"localhost\" {{ 'localhost:80' | regex_replace(':80') }} \u8f6c\u4e49\u7279\u6b8a\u5b57\u7b26 # convert '^f.*o(.*)$' to '\\^f\\.\\*o\\(\\.\\*\\)\\$' {{ '^f.*o(.*)$' | regex_escape () }} # convert '^f.*o(.*)$' to '\\^f\\.\\*o(\\.\\*)\\$' {{ '^f.*o(.*)$' | regex_escape ( 'posix_basic' ) }} Kubernetes \u8fc7\u6ee4\u5668 \u00b6 \u4f7f\u7528 k8s_config_resource_name \u8fc7\u6ee4\u5668\u6765\u83b7\u53d6Kubernetes ConfigMap\u6216Secret\u7684\u540d\u79f0 {{ configmap_resource_definition | k8s_config_resource_name }} \u5176\u4ed6\u7684\u5e38\u7528\u8fc7\u6ee4 \u00b6 \u4e3ashell\u589e\u52a0\u53cc\u5f15\u53f7 - shell : echo {{ string_value | quote }} \u6839\u636eTrue\uff0cFalse\u6765\u8fd4\u56de\u503c {{ ('name' == 'John') | ternary('Mr','Ms') }} {{ enabled | ternary('no shutdown', 'shutdown', omit) }} # null \u4f7f\u7528\u7b2c\u4e09\u4e2a\u503c \u5217\u8868\u8f6c\u6362\u5b57\u7b26 {{ list | join(\" \") }} \u83b7\u53d6\u8def\u5f84\u7684\u6587\u4ef6\u540d {{ path | basename }} \u83b7\u53d6\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84 {{ '~/.ssh/id_rsa' | expanduser }} windows\u5e73\u53f0\u4e0b\u83b7\u53d6\u8def\u5f84\u7684\u6587\u4ef6\u540d {{ path | win_basename }} \u83b7\u53d6\u8def\u5f84\u4e2d\u7684\u76ee\u5f55 {{ path | dirname }} \u5c55\u5f00\u5305\u542b\u73af\u5883\u53d8\u91cf\u7684\u8def\u5f84 {{ path | expandvars }} \u83b7\u53d6\u8f6f\u8fde\u63a5\u7684\u771f\u5b9e\u8def\u5f84 {{ path | realpath }} {{ path | relpath('/etc') }} # \u6307\u5b9a\u542f\u70b9 \u83b7\u53d6\u6587\u4ef6\u540d\u7684\u540d\u79f0\u548c\u6269\u5c55\u540d {{ path | splitext }} base64\u7f16\u7801 {{ encoded | b64decode }} {{ decoded | string | b64encode }} {{ encoded | b64decode(encoding='utf-16-le') }} {{ decoded | string | b64encode(encoding='utf-16-le') }} \u4ece\u5b57\u7b26\u4e32\u521b\u5efaUUID\uff081.9\u7248\u4e2d\u7684\u65b0\u529f\u80fd\uff09 {{ hostname | to_uuid }} \u5c06\u8f6c\u6362\u4e3a\u5e03\u5c14\u7c7b\u578b\uff0c\u5982\"True\" \u5b57\u7b26\u4e32\u8f6c\u6362\u4e3aTrue - debug: msg=test when: some_string_value | bool \u65e5\u671f # Get total amount of seconds between two dates. Default date format is %Y-%m-%d %H:%M:%S but you can pass your own format {{ ((\"2016-08-14 20:00:12\" | to_datetime) - (\"2015-12-25\" | to_datetime('%Y-%m-%d'))).total_seconds() }} # Get remaining seconds after delta has been calculated. NOTE: This does NOT convert years, days, hours, etc to seconds. For that, use total_seconds() {{ ((\"2016-08-14 20:00:12\" | to_datetime) - (\"2016-08-14 18:00:00\" | to_datetime)).seconds }} # This expression evaluates to \"12\" and not \"132\". Delta is 2 hours, 12 seconds # get amount of days between two dates. This returns only number of days and discards remaining hours, minutes, and seconds {{ ((\"2016-08-14 20:00:12\" | to_datetime) - (\"2015-12-25\" | to_datetime('%Y-%m-%d'))).days }} \u683c\u5f0f\u5316\u65e5\u671f # Display year-month-day {{ '%Y-%m-%d' | strftime }} # Display hour:min:sec {{ '%H:%M:%S' | strftime }} # Use ansible_date_time.epoch fact {{ '%Y-%m-%d %H:%M:%S' | strftime(ansible_date_time.epoch) }} # Use arbitrary epoch value {{ '%Y-%m-%d' | strftime(0) }} # => 1970-01-01 {{ '%Y-%m-%d' | strftime(1441357287) }} # => 2015-09-04 \u67e5\u770b\u53d8\u91cf\u7684python\u7c7b\u578b {{ myvar | type }} \u7ec4\u5408\u8fc7\u6ee4\u5668 \u00b6 - name : give me largest permutations (order matters) debug : msg : \"{{ [1,2,3,4,5] | permutations | list }}\" - name : give me permutations of sets of three debug : msg : \"{{ [1,2,3,4,5] | permutations(3) | list }}\" - name : give me combinations for sets of two debug : msg : \"{{ [1,2,3,4,5] | combinations(2) | list }}\" Product \u8fc7\u6ee4\u5668 \u00b6 product \u8fc7\u6ee4\u5668\u8fd4\u56de\u8f93\u5165\u8fed\u4ee3\u7684\u7b1b\u5361\u5c14\u79ef\u3002 - name : generate multiple hostnames debug : msg : \"{{ ['foo', 'bar'] | product(['com']) | map('join', '.') | join(',') }}\" \u8f93\u51fa { \"msg\" : \"foo.com,bar.com\" } debug \u8fc7\u6ee4\u5668 \u00b6 {{ myvar | type_debug }} \u5b57\u8282\u8f6c\u6362 \u00b6 \u5c06\u6570\u5b57\u8f6c\u6362\u4e3a\u4eba\u7c7b\u53ef\u8bfb\u7684\u5b57\u7b26\u4e32 - name : \"Human Readable\" assert : that : - '\"1.00 Bytes\" == 1|human_readable' - '\"1.00 bits\" == 1|human_readable(isbits=True)' - '\"10.00 KB\" == 10240|human_readable' - '\"97.66 MB\" == 102400000|human_readable' - '\"0.10 GB\" == 102400000|human_readable(unit=\"G\")' - '\"0.10 Gb\" == 102400000|human_readable(isbits=True, unit=\"G\")' \u8fd4\u56de { \"changed\" : false , \"msg\" : \"All assertions passed\" } \u4ee5\u5b57\u8282\u683c\u5f0f\u8fd4\u56de\u7ed9\u5b9a\u7684\u5b57\u7b26\u4e32\u3002 - name : \"Human to Bytes\" assert : that : - \"{{'0'|human_to_bytes}} == 0\" - \"{{'0.1'|human_to_bytes}} == 0\" - \"{{'0.9'|human_to_bytes}} == 1\" - \"{{'1'|human_to_bytes}} == 1\" - \"{{'10.00 KB'|human_to_bytes}} == 10240\" - \"{{ '11 MB'|human_to_bytes}} == 11534336\" - \"{{ '1.1 GB'|human_to_bytes}} == 1181116006\" - \"{{'10.00 Kb'|human_to_bytes(isbits=True)}} == 10240\" \u8fd4\u56de { \"changed\" : false , \"msg\" : \"All assertions passed\" } \u6d4b\u8bd5 \u00b6 \u9664\u4e86\u8fc7\u6ee4\u5668\uff0c\u6240\u8c13\u7684\u201c\u6d4b\u8bd5\u201d\u4e5f\u662f\u53ef\u7528\u7684\u3002\u6d4b\u8bd5\u53ef\u4ee5\u7528\u4e8e\u5bf9\u7167\u666e\u901a\u8868\u8fbe\u5f0f\u6d4b\u8bd5\u4e00\u4e2a\u53d8\u91cf\u3002 \u8981\u6d4b\u8bd5\u4e00\u4e2a\u53d8\u91cf\u6216\u8868\u8fbe\u5f0f\uff0c\u4f60\u8981\u5728\u53d8\u91cf\u540e\u52a0\u4e0a\u4e00\u4e2a is \u4ee5\u53ca\u6d4b\u8bd5\u7684\u540d\u79f0\u3002\u4f8b\u5982\uff0c\u8981\u5f97\u51fa \u4e00\u4e2a\u503c\u662f\u5426\u5b9a\u4e49\u8fc7\uff0c\u4f60\u53ef\u4ee5\u7528 name is defined \uff0c\u8fd9\u4f1a\u6839\u636e name \u662f\u5426\u5b9a\u4e49\u8fd4\u56de true \u6216 false \u3002 \u6d4b\u8bd5\u8bed\u6cd5 \u00b6 variable is test_name \u4f8b\u5982 result is failed \u6d4b\u8bd5\u4e5f\u53ef\u4ee5\u63a5\u53d7\u53c2\u6570\u3002\u5982\u679c\u6d4b\u8bd5\u53ea\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570\uff0c\u4f60\u53ef\u4ee5\u7701\u53bb\u62ec\u53f7\u6765\u5206\u7ec4\u5b83\u4eec\u3002\u4f8b\u5982\uff0c \u4e0b\u9762\u7684\u4e24\u4e2a\u8868\u8fbe\u5f0f\u505a\u540c\u6837\u7684\u4e8b\u60c5: {% if loop.index is divisibleby 3 %} {% if loop.index is divisibleby(3) %} \u6d4b\u8bd5\u5b57\u7b26\u4e32 \u00b6 vars: url: \"http://example.com/users/foo/resources/bar\" tasks: - debug: msg: \"matched pattern 1\" when: url is match(\"http://example.com/users/.*/resources/.*\") - debug: msg: \"matched pattern 2\" when: url is search(\"/users/.*/resources/.*\") - debug: msg: \"matched pattern 3\" when: url is search(\"/users/\") - debug: msg: \"matched pattern 4\" when: url is regex(\"example.com/\\w+/foo\") match \u9700\u8981\u5728\u5b57\u7b26\u4e32\u4e2d\u5b8c\u5168\u5339\u914d\uff0c\u800c search \u53ea\u9700\u8981\u5339\u914d\u5b57\u7b26\u4e32\u7684\u5b50\u96c6\u3002\u5339\u914d\u6210\u529f\u8fd4\u56de True \uff0c\u4efb\u52a1\u5219\u6267\u884c\u3002 \u7248\u672c\u6bd4\u8f83 \u00b6 \u68c0\u67e5ansible_distribution_version\u7248\u672c\u662f\u5426\u5927\u4e8e\u6216\u7b49\u4e8e'12 .04'\uff0c\u6761\u4ef6\u6210\u7acb\u8fd4\u56deTrue\u3002 {{ ansible_distribution_version is version_compare('12.04', '>=') }} \u8fdb\u884c\u4e25\u683c\u7684\u7248\u672c\u68c0\u67e5 {{ sample_version_var is version_compare('1.0', operator='lt', strict=True) }} \u53ef\u63a5\u53d7\u7684\u8fd0\u7b97\u7b26 <, lt, <=, le, >, gt, >=, ge, ==, =, eq, !=, <>, ne \u5305\u542b\u6d4b\u8bd5 \u00b6 \u6d4b\u8bd5\u4e00\u4e2a\u5217\u8868\u662f\u5426\u5305\u542b\u53e6\u4e00\u4e2a\u5217\u8868\u3002 vars : a : [ 1 , 2 , 3 , 4 , 5 ] b : [ 2 , 3 ] tasks : - debug : msg : \"A includes B\" when : a is superset(b) - debug : msg : \"B is included in A\" when : b is subset(a) \u6d4b\u8bd5\u5217\u8868\u662f\u5426\u5305\u542b\u503c vars : lacp_groups : - master : lacp0 network : 10.65.100.0/24 gateway : 10.65.100.1 dns4 : - 10.65.100.10 - 10.65.100.11 interfaces : - em1 - em2 - master : lacp1 network : 10.65.120.0/24 gateway : 10.65.120.1 dns4 : - 10.65.100.10 - 10.65.100.11 interfaces : - em3 - em4 tasks : - debug : msg : \"{{ (lacp_groups|selectattr('interfaces', 'contains', 'em1')|first).master }}\" \u60a8\u53ef\u4ee5\u4f7f\u7528 any \u548c all \u6765\u68c0\u67e5\u5217\u8868\u4e2d\u7684\u4efb\u4f55\u5143\u7d20\u6216\u6240\u6709\u5143\u7d20\u662f\u5426\u4e3a\u771f vars : mylist : - 1 - \"{{ 3 == 3 }}\" - True myotherlist : - False - True tasks : - debug : msg : \"all are true!\" when : mylist is all - debug : msg : \"at least one is true\" when : myotherlist is any \u8def\u5f84\u6d4b\u8bd5 \u00b6 - debug: msg: \"path is a directory\" when: mypath is directory - debug: msg: \"path is a file\" when: mypath is file - debug: msg: \"path is a symlink\" when: mypath is link - debug: msg: \"path already exists\" when: mypath is exists - debug: msg: \"path is {{ (mypath is abs)|ternary('absolute','relative')}}\" - debug: msg: \"path is the same file as path2\" when: mypath is same_file(path2) - debug: msg: \"path is a mount\" when: mypath is mount \u6d4b\u8bd5\u547d\u4ee4\u7ed3\u679c \u00b6 \u4ee5\u4e0bplaybook\u662f\u68c0\u67e5\u4efb\u52a1\u72b6\u6001\u7684\u6d4b\u8bd5\u3002 tasks: - shell: /usr/bin/foo register: result ignore_errors: True - debug: msg=\"it failed\" when: result is failed - debug: msg=\"it changed\" when: result is changed - debug: msg=\"it succeeded in Ansible >= 2.1\" when: result is succeeded - debug: msg=\"it succeeded\" when: result is success - debug: msg=\"it was skipped\" when: result is skipped lookup \u63d2\u4ef6 \u00b6 lookup \u63d2\u4ef6\u5141\u8bb8\u8bbf\u95ee\u5916\u90e8\u6570\u636e\u6e90\u3002 # \u83b7\u53d6\u6587\u4ef6\u5185\u5bb9 vars : motd_value : \"{{ lookup('file', '/etc/motd') }}\" tasks : - debug : msg : \"motd value is {{ motd_value }}\" lookup \u66f4\u591a\u7684\u63d2\u4ef6\u4f7f\u7528\u8bf7\u770b lookup \u63d2\u4ef6 if \u8bed\u53e5 \u00b6 ad-hoc ansible localhost -m debug -a \"msg={%- if ansible_play_hosts.index(inventory_hostname) < 3 -%}master{%- else -%}slave{%- endif -%}\" playbook - debug : msg : >- { % - if ansible_play_hosts.index(inventory_hostname) < 3 -% } master { % - else -% } slave { % - endif -% } for \u8bed\u53e5 \u00b6 ad-hoc ansible localhost -m debug -a \"msg={%- for t in [1,2,3] -%}{{ t }}{%- endfor -%}\" playbook - debug : msg : |- {%- for t in [1,2,3] -%} {{ t }} {%- endfor -%} \u5728 when \u91cc\u4f7f\u7528 jinja2 \u8868\u8fbe\u5f0f \u00b6 - hosts : target_host tasks : - name : Show debug debug : msg='\u6761\u4ef6\u6ee1\u8db3\u4f60\u5c31\u4f1a\u770b\u5230\u6211\u3002' when : '{% if def_a_var|d(\"abc\") == \"abc\" %}{{ foo | d(\"true\") }}{% endif %}'","title":"12. Jinja2 \u6a21\u677f\u8bed\u6cd5"},{"location":"basic/Jinja2/#12-jinja2","text":"Ansible\u4f7f\u7528 Jinja2 \u6a21\u677f\u6765\u542f\u7528\u52a8\u6001\u8868\u8fbe\u5f0f\u548c\u5bf9\u53d8\u91cf\u7684\u8bbf\u95ee\u3002 Note Jinja2 \u662f\u4e00\u4e2a Python \u7684\u529f\u80fd\u9f50\u5168\u7684\u6a21\u677f\u5f15\u64ce\u3002\u5b83\u6709\u5b8c\u6574\u7684 unicode \u652f\u6301\uff0c\u4e00\u4e2a\u53ef\u9009 \u7684\u96c6\u6210\u6c99\u7bb1\u6267\u884c\u73af\u5883\uff0c\u88ab\u5e7f\u6cdb\u4f7f\u7528\uff0c\u4ee5 BSD \u8bb8\u53ef\u8bc1\u6388\u6743\u3002","title":"12. Jinja2 \u6a21\u677f\u8bed\u6cd5"},{"location":"basic/Jinja2/#jinja2","text":"\u5173\u4e8e Jinja2 \u5b8c\u6574\u7684\u4e2d\u6587\u8bf4\u660e \u8bf7\u79fb\u6b65\uff1a http://docs.jinkan.org/docs/jinja2/","title":"jinja2 \u6a21\u7248\u4e2d\u7684\u4e00\u4e9b\u8bed\u6cd5"},{"location":"basic/Jinja2/#_1","text":"\u53ef\u4ee5\u4f7f\u7528\u70b9 . \u6765\u8bbf\u95ee\u53d8\u91cf\u7684\u5c5e\u6027\uff0c\u4f5c\u4e3a\u66ff\u4ee3\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e0b\u6807\u8bed\u6cd5 [] , \u4e0b\u97622\u79cd\u65b9\u5f0f\u6548\u679c\u662f\u4e00\u6837\u7684 {{ foo.bar }} {{ foo['bar'] }} \u5982\u679c\u53d8\u91cf\u6216\u5c5e\u6027\u4e0d\u5b58\u5728\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u672a\u5b9a\u4e49\u503c\u3002","title":"\u53d8\u91cf"},{"location":"basic/Jinja2/#_2","text":"\u8981\u628a\u6a21\u677f\u4e2d\u4e00\u884c\u7684\u90e8\u5206\u6ce8\u91ca\u6389\uff0c\u9ed8\u8ba4\u4f7f\u7528 {# ... #} \u6ce8\u91ca\u8bed\u6cd5\u3002","title":"\u6ce8\u91ca"},{"location":"basic/Jinja2/#_3","text":"\u7b80\u5355\u7684\u4f7f\u7528\u5355\u5f15\u53f7\u8fdb\u884c\u8f6c\u4e49 \u5bf9\u4e8e\u8f83\u5927\u7684\u6bb5\u843d\uff0c\u4f7f\u7528raw\u8fdb\u884c\u8f6c\u4e49 {% raw %} <ul> {% for item in seq %} <li>{{ item }}</li> {% endfor %} </ul> {% endraw %} \u5305\u542b > \u3001 < \u3001 & \u6216 \" \u5b57\u7b26\u7684\u53d8\u91cf\uff0c\u5fc5\u987b\u8981\u624b\u52a8\u8f6c\u4e49, \u4f7f\u7528 e \u987e\u8651\u5668\u53ef\u4ee5\u8f6c\u4e49\u8fd9\u4e9b\u3002 {{ user.username | e }}","title":"\u8f6c\u4e49"},{"location":"basic/Jinja2/#_4","text":"\u5728\u5f00\u59cb\u6216\u7ed3\u675f\u653e\u7f6e\u4e00\u4e2a\u51cf\u53f7\uff08 - \uff09\uff0c\u53ef\u4ee5\u79fb\u9664\u5757\u524d\u6216\u5757\u540e\u7684\u7a7a\u767d\u3002 {% for item in seq -%} {{ item }} {%- endfor %} {%- if foo -%}...{% endif %}","title":"\u7a7a\u767d\u63a7\u5236"},{"location":"basic/Jinja2/#_5","text":"\u63a7\u5236\u7ed3\u6784\u6307\u7684\u662f\u6240\u6709\u7684\u90a3\u4e9b\u53ef\u4ee5\u63a7\u5236\u7a0b\u5e8f\u6d41\u7684\u4e1c\u897f \u2014\u2014 \u6761\u4ef6\uff08\u6bd4\u5982 if/elif/ekse \uff09\u3001 for \u5faa\u73af\u3001\u4ee5\u53ca\u5b8f\u548c\u5757\u4e4b\u7c7b\u7684\u4e1c\u897f\u3002\u63a7\u5236\u7ed3\u6784\u5728\u9ed8\u8ba4\u8bed\u6cd5\u4e2d\u4ee5 {% .. %} \u5757\u7684\u5f62\u5f0f \u51fa\u73b0\u3002","title":"\u63a7\u5236\u7ed3\u6784"},{"location":"basic/Jinja2/#for","text":"\u904d\u5386\u5e8f\u5217 {% for user in users %} <li>{{ user.username|e }}</li> {% endfor %} \u8fed\u4ee3\u5b57\u5178 {% for key, value in my_dict.iteritems() %} <dt>{{ key|e }}</dt> <dd>{{ value|e }}</dd> {% endfor %} \u5faa\u73af 10 \u6b21\u8fed\u4ee3\u4e4b\u540e\u4f1a\u7ec8\u6b62\u5904\u7406 {% for user in users %} {%- if loop.index >= 10 %}{% break %}{% endif %} {%- endfor %} \u6761\u4ef6\u8fc7\u6ee4 {% for dir in data_dirs if dir != \"/\" %} data_dir = {{ dir }} {% else %} # no data dirs found {% endfor %} \u5728\u4e00\u4e2a for \u5faa\u73af\u5757\u4e2d\u4f60\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e9b\u7279\u6b8a\u7684\u53d8\u91cf: \u53d8\u91cf \u63cf\u8ff0 loop.index \u5f53\u524d\u5faa\u73af\u8fed\u4ee3\u7684\u6b21\u6570\uff08\u4ece 1 \u5f00\u59cb\uff09 loop.index0 \u5f53\u524d\u5faa\u73af\u8fed\u4ee3\u7684\u6b21\u6570\uff08\u4ece 0 \u5f00\u59cb\uff09 loop.revindex \u5230\u5faa\u73af\u7ed3\u675f\u9700\u8981\u8fed\u4ee3\u7684\u6b21\u6570\uff08\u4ece 1 \u5f00\u59cb\uff09 loop.revindex0 \u5230\u5faa\u73af\u7ed3\u675f\u9700\u8981\u8fed\u4ee3\u7684\u6b21\u6570\uff08\u4ece 0 \u5f00\u59cb\uff09 loop.first \u5982\u679c\u662f\u7b2c\u4e00\u6b21\u8fed\u4ee3\uff0c\u4e3a True \u3002 loop.last \u5982\u679c\u662f\u6700\u540e\u4e00\u6b21\u8fed\u4ee3\uff0c\u4e3a True \u3002 loop.length \u5e8f\u5217\u4e2d\u7684\u9879\u76ee\u6570\u3002 loop.cycle \u5728\u4e00\u4e32\u5e8f\u5217\u95f4\u671f\u53d6\u503c\u7684\u8f85\u52a9\u51fd\u6570 loop.depth \u6307\u793a\u5f53\u524d\u6e32\u67d3\u5728\u9012\u5f52\u5faa\u73af\u4e2d\u7684\u6df1\u5ea6\u3002 \u4ece1\u5f00\u59cb loop.depth0 \u6307\u793a\u5f53\u524d\u6e32\u67d3\u5728\u9012\u5f52\u5faa\u73af\u4e2d\u7684\u6df1\u5ea6\u3002 \u4ece0\u5f00\u59cb loop.previtem \u5faa\u73af\u7684\u4e0a\u4e00\u4e2a\u8fed\u4ee3\u4e2d\u7684\u9879\u76ee\u3002 \u5728\u7b2c\u4e00\u6b21\u8fed\u4ee3\u4e2d\u672a\u5b9a\u4e49\u3002 loop.nextitem \u5faa\u73af\u7684\u4ee5\u4e0b\u8fed\u4ee3\u4e2d\u7684\u9879\u76ee\u3002 \u5728\u4e0a\u4e00\u6b21\u8fed\u4ee3\u671f\u95f4\u672a\u5b9a\u4e49\u3002 loop.changed(*val) \u5982\u679c\u4ee5\u524d\u4f7f\u7528\u5176\u4ed6\u503c\u8c03\u7528\uff08\u6216\u6839\u672c\u672a\u8c03\u7528\uff09\uff0c\u5219\u4e3atrue\u3002","title":"For"},{"location":"basic/Jinja2/#if","text":"Jinja \u4e2d\u7684 if \u8bed\u53e5\u53ef\u6bd4 Python \u4e2d\u7684 if \u8bed\u53e5\u3002 {% if kenny.sick %} Kenny is sick. {% elif kenny.dead %} You killed Kenny! You bastard!!! {% else %} Kenny looks okay --- so far {% endif %}","title":"if \u8bed\u53e5"},{"location":"basic/Jinja2/#_6","text":"\u53d8\u91cf\u53ef\u4ee5\u901a\u8fc7 \u8fc7\u6ee4\u5668 \u4fee\u6539\u3002\u8fc7\u6ee4\u5668\u4e0e\u53d8\u91cf\u7528\u7ba1\u9053\u7b26\u53f7\uff08 | \uff09\u5206\u5272\uff0c\u5e76\u4e14\u4e5f \u53ef\u4ee5\u7528\u5706\u62ec\u53f7\u4f20\u9012\u53ef\u9009\u53c2\u6570\u3002\u591a\u4e2a\u8fc7\u6ee4\u5668\u53ef\u4ee5\u94fe\u5f0f\u8c03\u7528\uff0c\u524d\u4e00\u4e2a\u8fc7\u6ee4\u5668\u7684\u8f93\u51fa\u4f1a\u88ab\u4f5c\u4e3a \u540e\u4e00\u4e2a\u8fc7\u6ee4\u5668\u7684\u8f93\u5165\u3002 {{ name | striptags | title }} \u8fc7\u6ee4\u5668\u6bb5\u5141\u8bb8\u4f60\u5728\u4e00\u5757\u6a21\u677f\u6570\u636e\u4e0a\u5e94\u7528\u5e38\u89c4 Jinja2 \u8fc7\u6ee4\u5668\u3002\u53ea\u9700\u8981\u628a\u4ee3\u7801\u7528 filter \u8282\u5305\u88f9\u8d77\u6765: {% filter upper %} This text becomes uppercase {% endfilter %}","title":"\u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#_7","text":"\u5728\u4ee3\u7801\u5757\u4e2d\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4e3a\u53d8\u91cf\u8d4b\u503c\u3002\u5728\u9876\u5c42\u7684\uff08\u5757\u3001\u5b8f\u3001\u5faa\u73af\u4e4b\u5916\uff09\u8d4b\u503c\u662f\u53ef\u5bfc\u51fa\u7684\uff0c\u5373 \u53ef\u4ee5\u4ece\u522b\u7684\u6a21\u677f\u4e2d\u5bfc\u5165\u3002 \u8d4b\u503c\u4f7f\u7528 set \u6807\u7b7e\uff0c\u5e76\u4e14\u53ef\u4ee5\u4e3a\u591a\u4e2a\u53d8\u91cf\u8d4b\u503c: {% set navigation = [('index.html', 'Index'), ('about.html', 'About')] %} {% set key, value = call_something() %}","title":"\u8d4b\u503c"},{"location":"basic/Jinja2/#_8","text":"{% ... %} \u7528\u4e8e\u6267\u884c\u8bf8\u5982 for \u5faa\u73af \u6216\u8d4b\u503c\u7684\u8bed\u53e5 {{ ... }} \u628a\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u6253\u5370\u5230\u6a21\u677f\u4e0a if \u8868\u8fbe\u5f0f \u4e00\u822c\u7684\u8bed\u6cd5\u662f <do something> if <something is true> else <do something else> \u3002 {{ '[%s]' % page.title if page.title is defined else 'undefined' }}","title":"\u8868\u8fbe\u5f0f"},{"location":"basic/Jinja2/#_9","text":"\u8868\u8fbe\u5f0f\u6700\u7b80\u5355\u7684\u5f62\u5f0f\u5c31\u662f\u5b57\u9762\u91cf\u3002\u5b57\u9762\u91cf\u8868\u793a\u8bf8\u5982\u5b57\u7b26\u4e32\u548c\u6570\u503c\u7684 Python \u5bf9\u8c61\u3002\u4e0b\u9762 \u7684\u5b57\u9762\u91cf\u662f\u53ef\u7528\u7684: \u503c \u8bf4\u660e \"Hello World\" \u53cc\u5f15\u53f7\u6216\u5355\u5f15\u53f7\u4e2d\u95f4\u7684\u4e00\u5207\u90fd\u662f\u5b57\u7b26\u4e32\u3002\u65e0\u8bba\u4f55\u65f6\u4f60\u9700\u8981\u5728\u6a21\u677f\u4e2d\u4f7f\u7528\u4e00\u4e2a\u5b57 \u7b26\u4e32\uff08\u6bd4\u5982\u51fd\u6570\u8c03\u7528\u3001\u8fc7\u6ee4\u5668\u6216\u53ea\u662f\u5305\u542b\u6216\u7ee7\u627f\u4e00\u4e2a\u6a21\u677f\u7684\u53c2\u6570\uff09\uff0c\u5b83\u4eec\u90fd\u662f \u6709\u7528\u7684\u3002 42/42.23 \u76f4\u63a5\u5199\u4e0b\u6570\u503c\u5c31\u53ef\u4ee5\u521b\u5efa\u6574\u6570\u548c\u6d6e\u70b9\u6570\u3002\u5982\u679c\u6709\u5c0f\u6570\u70b9\uff0c\u5219\u4e3a\u6d6e\u70b9\u6570\uff0c\u5426\u5219\u4e3a \u6574\u6570\u3002\u8bb0\u4f4f\u5728 Python \u91cc\uff0c 42 \u548c 42.0 \u662f\u4e0d\u4e00\u6837\u7684\u3002 ['list','of','objects'] \u4e00\u5bf9\u4e2d\u62ec\u53f7\u62ec\u8d77\u6765\u7684\u4e1c\u897f\u662f\u4e00\u4e2a\u5217\u8868\u3002\u5217\u8868\u7528\u4e8e\u5b58\u50a8\u548c\u8fed\u4ee3\u5e8f\u5217\u5316\u7684\u6570\u636e\u3002 ('tuple','of','values') \u5143\u7ec4\u4e0e\u5217\u8868\u7c7b\u4f3c\uff0c\u53ea\u662f\u4f60\u4e0d\u80fd\u4fee\u6539\u5143\u7ec4\u3002\u5982\u679c\u5143\u7ec4\u4e2d\u53ea\u6709\u4e00\u4e2a\u9879\uff0c\u4f60\u9700\u8981\u4ee5\u9017\u53f7 \u7ed3\u5c3e\u5b83\u3002\u5143\u7ec4\u901a\u5e38\u7528\u4e8e\u8868\u793a\u4e24\u4e2a\u6216\u66f4\u591a\u5143\u7d20\u7684\u9879\u3002\u66f4\u591a\u7ec6\u8282\u89c1\u4e0a\u9762\u7684\u4f8b\u5b50\u3002 Python \u4e2d\u7684\u5b57\u5178\u662f\u4e00\u79cd\u5173\u8054\u952e\u548c\u503c\u7684\u7ed3\u6784\u3002\u952e\u5fc5\u987b\u662f\u552f\u4e00\u7684\uff0c\u5e76\u4e14\u952e\u5fc5\u987b\u53ea\u6709\u4e00\u4e2a \u503c\u3002\u5b57\u5178\u5728\u6a21\u677f\u4e2d\u5f88\u5c11\u4f7f\u7528\uff0c\u7f55\u7528\u4e8e\u8bf8\u5982 xmlattr() \u8fc7\u6ee4\u5668\u4e4b\u7c7b\u3002 true/false true \u6c38\u8fdc\u662f true \uff0c\u800c false \u59cb\u7ec8\u662f false \u3002 Note \u200b \u7279\u6b8a\u5e38\u91cf true \u3001 false \u548c none \u5b9e\u9645\u4e0a\u662f\u5c0f\u5199\u7684\u3002\u56e0\u4e3a\u8fd9\u5728\u8fc7\u53bb\u4f1a\u5bfc\u81f4 \u6df7\u6dc6\uff0c\u8fc7\u53bb True\u6269\u5c55\u4e3a\u4e00\u4e2a\u88ab\u8ba4\u4e3afalse \u7684\u672a\u5b9a\u4e49\u7684\u53d8\u91cf\u3002\u6240\u6709\u7684\u8fd9\u4e09\u4e2a \u5e38\u91cf\u4e5f\u53ef\u4ee5\u88ab\u5199\u6210\u9996\u5b57\u6bcd\u5927\u5199\uff08 True \u3001 False \u548c None \uff09\u3002\u5c3d\u7ba1\u5982\u6b64\uff0c \u4e3a\u4e86\u4e00\u81f4\u6027\uff08\u6240\u6709\u7684 Jinja \u6807\u8bc6\u7b26\u662f\u5c0f\u5199\u7684\uff09\uff0c\u4f60\u5e94\u8be5\u4f7f\u7528\u5c0f\u5199\u7684\u7248\u672c\u3002","title":"\u5b57\u9762\u91cf"},{"location":"basic/Jinja2/#_10","text":"Jinja \u5141\u8bb8\u4f60\u7528\u8ba1\u7b97\u503c\u3002\u8fd9\u5728\u6a21\u677f\u4e2d\u5f88\u5c11\u7528\u5230\uff0c\u4f46\u662f\u4e3a\u4e86\u5b8c\u6574\u6027\u5141\u8bb8\u5176\u5b58\u5728\u3002\u652f\u6301\u4e0b\u9762\u7684 \u8fd0\u7b97\u7b26: \u8fd0\u7b97\u7b26 \u8bf4\u660e + \u628a\u4e24\u4e2a\u5bf9\u8c61\u52a0\u5230\u4e00\u8d77\u3002\u901a\u5e38\u5bf9\u8c61\u662f\u7d20\u8d28\uff0c\u4f46\u662f\u5982\u679c\u4e24\u8005\u662f\u5b57\u7b26\u4e32\u6216\u5217\u8868\uff0c\u4f60\u53ef\u4ee5\u7528\u8fd9 \u79cd\u65b9\u5f0f\u6765\u8854\u63a5\u5b83\u4eec\u3002\u65e0\u8bba\u5982\u4f55\u8fd9\u4e0d\u662f\u9996\u9009\u7684\u8fde\u63a5\u5b57\u7b26\u4e32\u7684\u65b9\u5f0f\uff01\u8fde\u63a5\u5b57\u7b26\u4e32\u89c1 ~ \u8fd0\u7b97\u7b26\u3002 - \u7528\u7b2c\u4e00\u4e2a\u6570\u51cf\u53bb\u7b2c\u4e8c\u4e2a\u6570\u3002 / \u5bf9\u4e24\u4e2a\u6570\u505a\u9664\u6cd5\u3002\u8fd4\u56de\u503c\u4f1a\u662f\u4e00\u4e2a\u6d6e\u70b9\u6570\u3002 // \u5bf9\u4e24\u4e2a\u6570\u505a\u9664\u6cd5\uff0c\u8fd4\u56de\u6574\u6570\u5546\u3002 % \u8ba1\u7b97\u6574\u6570\u9664\u6cd5\u7684\u4f59\u6570\u3002 * \u7528\u53f3\u8fb9\u7684\u6570\u4e58\u5de6\u8fb9\u7684\u64cd\u4f5c\u6570\u3002 ** \u53d6\u5de6\u64cd\u4f5c\u6570\u7684\u53f3\u64cd\u4f5c\u6570\u6b21\u5e42\u3002 \u6bd4\u8f83\u8fd0\u7b97\u7b26 \u8fd0\u7b97\u7b26 \u8bf4\u660e == \u6bd4\u8f83\u4e24\u4e2a\u5bf9\u8c61\u662f\u5426\u76f8\u7b49\u3002 != \u6bd4\u8f83\u4e24\u4e2a\u5bf9\u8c61\u662f\u5426\u4e0d\u7b49\u3002 > \u5982\u679c\u5de6\u8fb9\u5927\u4e8e\u53f3\u8fb9\uff0c\u8fd4\u56de true \u3002 >= \u5982\u679c\u5de6\u8fb9\u5927\u4e8e\u7b49\u4e8e\u53f3\u8fb9\uff0c\u8fd4\u56de true \u3002 < \u5982\u679c\u5de6\u8fb9\u5c0f\u4e8e\u53f3\u8fb9\uff0c\u8fd4\u56de true \u3002 <= \u5982\u679c\u5de6\u8fb9\u5c0f\u4e8e\u7b49\u4e8e\u53f3\u8fb9\uff0c\u8fd4\u56de true \u3002 \u903b\u8f91\u8fd0\u7b97\u7b26 \u5bf9\u4e8e if \u8bed\u53e5\uff0c\u5728 for \u8fc7\u6ee4\u6216 if \u8868\u8fbe\u5f0f\u4e2d\uff0c\u5b83\u53ef\u4ee5\u7528\u4e8e\u8054\u5408\u591a\u4e2a\u8868\u8fbe\u5f0f: \u8fd0\u7b97\u7b26 \u8bf4\u660e and \u5982\u679c\u5de6\u64cd\u4f5c\u6570\u548c\u53f3\u64cd\u4f5c\u6570\u540c\u4e3a\u771f\uff0c\u8fd4\u56de true \u3002 or \u5982\u679c\u5de6\u64cd\u4f5c\u6570\u548c\u53f3\u64cd\u4f5c\u6570\u6709\u4e00\u4e2a\u4e3a\u771f\uff0c\u8fd4\u56de true \u3002 not \u5bf9\u4e00\u4e2a\u8868\u8fbe\u5f0f\u53d6\u53cd\uff08\u89c1\u4e0b\uff09\u3002 (expr) \u8868\u8fbe\u5f0f\u7ec4\u3002 !!! note \u63d0\u793a \u200b is \u548c in \u8fd0\u7b97\u7b26\u540c\u6837\u652f\u6301\u4f7f\u7528\u4e2d\u7f00\u8bb0\u6cd5: foo is not bar \u548c foo not in bar \u800c\u4e0d\u662f not foo is bar \u548c not foo in bar \u3002\u6240\u6709\u7684 \u5176\u5b83\u8868\u8fbe\u5f0f\u9700\u8981\u524d\u7f00\u8bb0\u6cd5 not (foo and bar) \u3002 \u5176\u5b83\u8fd0\u7b97\u7b26 \u4e0b\u9762\u7684\u8fd0\u7b97\u7b26\u975e\u5e38\u6709\u7528\uff0c\u4f46\u4e0d\u9002\u7528\u4e8e\u5176\u5b83\u7684\u4e24\u4e2a\u5206\u7c7b: \u8fd0\u7b97\u7b26 \u8bf4\u660e in \u8fd0\u884c\u5e8f\u5217/\u6620\u5c04\u5305\u542b\u68c0\u67e5\u3002\u5982\u679c\u5de6\u64cd\u4f5c\u6570\u5305\u542b\u4e8e\u53f3\u64cd\u4f5c\u6570\uff0c\u8fd4\u56de true \u3002\u6bd4\u5982 is \u8fd0\u884c\u4e00\u4e2a \u6d4b\u8bd5 \u3002 | \u5e94\u7528\u4e00\u4e2a \u8fc7\u6ee4\u5668 \u3002 ~ \u628a\u6240\u6709\u7684\u64cd\u4f5c\u6570\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\uff0c\u5e76\u4e14\u8fde\u63a5\u5b83\u4eec\u3002 () \u8c03\u7528\u4e00\u4e2a\u53ef\u8c03\u7528\u91cf: . / [] \u83b7\u53d6\u4e00\u4e2a\u5bf9\u8c61\u7684\u5c5e\u6027\u3002","title":"\u7b97\u672f"},{"location":"basic/Jinja2/#python","text":"\u5728\u6a21\u677f\u4e2d\uff0c\u4e5f\u662f\u53ef\u4ee5\u4f7f\u7528python\u7684\u5bf9\u8c61\u65b9\u6cd5 \u5b57\u7b26\u4e32\u65b9\u6cd5 endswith: \u7528\u4e8e\u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u4ee5\u6307\u5b9a\u540e\u7f00\u7ed3\u5c3e\uff0c\u5982\u679c\u4ee5\u6307\u5b9a\u540e\u7f00\u7ed3\u5c3e\u8fd4\u56deTrue\uff0c\u5426\u5219\u8fd4\u56deFalse startswith: \u7528\u4e8e\u68c0\u67e5\u5b57\u7b26\u4e32\u662f\u5426\u662f\u4ee5\u6307\u5b9a\u5b50\u5b57\u7b26\u4e32\u5f00\u5934\uff0c\u5982\u679c\u662f\u5219\u8fd4\u56de True\uff0c\u5426\u5219\u8fd4\u56de False\u3002 split: \u6307\u5b9a\u5206\u9694\u7b26\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c\u5207\u7247\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\u683c rsplit: \u4e0esplit\u76f8\u540c\uff0c\u4f46\u4ece\u5b57\u7b26\u4e32\u7684\u672b\u5c3e\u5f00\u59cb\u5207\u7247 splitlines: \u6309\u7167\u884c('\\r', '\\r\\n', \\n')\u5206\u9694\uff0c\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u5404\u884c\u4f5c\u4e3a\u5143\u7d20\u7684\u5217\u8868 upper: \u8fd4\u56de\u5168\u90e8\u5927\u5199\u7684\u5b57\u7b26\u4e32 lower: \u8fd4\u56de\u5168\u90e8\u5c0f\u5199\u7684\u5b57\u7b26\u4e32 capitalize: \u5c06\u5b57\u7b26\u4e32\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u53d8\u6210\u5927\u5199,\u5176\u4ed6\u5b57\u6bcd\u53d8\u5c0f\u5199 \u5217\u8868\u65b9\u6cd5 index \u8fd4\u56de\u63d0\u4f9b\u503c\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u4f4d\u7f6e count \u7edf\u8ba1\u67d0\u4e2a\u5143\u7d20\u5728\u5217\u8868\u4e2d\u51fa\u73b0\u7684\u6b21\u6570 python \u7248\u672c\u5904\u7406 \u5728python2\u4e2d\uff0c\u4f7f\u7528 dict.keys() , dict.values() , dict.items() \u8fd4\u56de\u5b57\u5178\u7684\u5217\u8868\u5f62\u5f0f\u3002\u4f46\u662f\u5728python3\u4e2d\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u5219\u8fd4\u56de\u5b57\u5178\u5f62\u5f0f # Only works with Python 2 {{ hosts.keys() }} # Works with both Python 2 and Python 3 {{ hosts.keys() | list }} \u5728python2\u4e2d\uff0c\u5b57\u5178\u6709 iterkeys() , itervalues() , and iteritems() \u65b9\u6cd5\uff0c\u4f46\u662f\u5728python3\u4e2d\u8fd9\u4e9b\u65b9\u6cd5\u88ab\u5220\u9664\uff0cpython3\u5219\u4f7f\u7528 dict.keys() , dict.values() , dict.items() # Only works with Python 2 {{ hosts.iteritems() }} # Works with both Python 2 and Python 3 {{ hosts.items() | list }}","title":"Python\u5bf9\u8c61\u65b9\u6cd5"},{"location":"basic/Jinja2/#ansible-jinja2","text":"","title":"\u5728 ansible \u4e2d\u4f7f\u7528Jinja2"},{"location":"basic/Jinja2/#_11","text":"\u4f7f\u7528 now() jinja2 \u51fd\u6570\u53ef\u4ee5\u83b7\u53d6\u5f53\u524d\u7684\u65f6\u95f4 ansible localhost -m debug -a \"msg={{ now(utc='True',fmt='%H-%m-%d %T') }}\" utc \u53c2\u6570\u53ef\u4ee5\u5f00\u542futc\u65f6\u95f4\uff0c fmt\u53c2\u6570\u4e3a\u65f6\u95f4\u7684\u683c\u5f0f\u5316\u8f93\u51fa\u3002 {{ }} \u4ee3\u8868\u628a\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u6253\u5370\u5230\u6a21\u677f\u4e0a","title":"\u83b7\u53d6\u5f53\u524d\u65f6\u95f4"},{"location":"basic/Jinja2/#_12","text":"Ansible\u4e2d\u7684\u8fc7\u6ee4\u5668\u6765\u81ea Jinja2 \uff0c\u7528\u4e8e\u5728\u6a21\u677f\u8868\u8fbe\u5f0f\u4e2d\u8f6c\u6362\u6570\u636e\u3002 \u8fc7\u6ee4\u5668\u4e0e\u53d8\u91cf\u7528\u7ba1\u9053\u7b26\u53f7 | \u5206\u5272","title":"\u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#_13","text":"\u66f4\u6539\u6570\u636e\u683c\u5f0f\uff0c\u5176\u7ed3\u679c\u662f\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32 {{ some_variable | to_json }} {{ some_variable | to_yaml }} \u5bf9\u4e8e\u4eba\u7c7b\u53ef\u8bfb\u5f97\u8f93\u51fa {{ some_variable | to_nice_json }} {{ some_variable | to_nice_yaml }} \u8fd8\u53ef\u4ee5\u589e\u52a0\u53c2\u6570( new in 2.2) {{ some_variable | to_nice_json(indent=2) }} {{ some_variable | to_nice_yaml(indent=8) }} {{ some_variable | to_nice_yaml(indent=8, width=1337) }} indent \u6307\u5b9a\u7f29\u8fdb\u5b57\u7b26\u6570\uff0c width\u9650\u5236\u884c\u6570\u5bbd\u5ea6 \u4ecejson\u5b57\u7b26\u4e32\u8bfb\u53d6\uff0c\u5176\u7ed3\u679c\u4e3ajson\u7c7b\u578b {{ some_variable | from_json }} \u4eceyaml\u5b57\u7b26\u4e32\u8bfb\u53d6\uff0c\u5176\u7ed3\u679c\u4e3ayaml\u7c7b\u578b {{ some_variable | from_yaml }} \u793a\u4f8b\uff1a\u5c06json\u6587\u4ef6\u5185\u5bb9\u8d4b\u503c\u7ed9\u53d8\u91cf tasks: - shell: cat /some/path/to/file.json register: result - set_fact: myvar: \"{{ result.stdout | from_json }}\" \u4f7f\u7528`from_yaml_all \u89e3\u6790\u591a\u6bb5yaml\u5b57\u7b26\u4e32 tasks : - shell : cat /some/path/to/multidoc-file.yaml register : result - debug : msg : '{{ item }}' loop : '{{ result.stdout | from_yaml_all | list }}'","title":"\u683c\u5f0f\u5316\u6570\u636e\u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#_14","text":"\u5982\u679c\u53d8\u91cf\u672a\u5b9a\u4e49\uff0c\u5219\u6765\u81ea ansible \u548c ansible.cfg \u7684\u9ed8\u8ba4\u884c\u4e3a\u4e3a\u5931\u8d25\uff0c\u4f46\u60a8\u53ef\u4ee5\u5c06\u5176\u5173\u95ed\u3002 {{ variable | mandatory }}","title":"\u5f3a\u5236\u5b9a\u4e49\u53d8\u91cf"},{"location":"basic/Jinja2/#_15","text":"{{ result.cmd|default(5) }} {{ lookup('env', 'MY_USER') | default('admin', true) }} {{ lookup('env', 'MY_USER') | default('admin', false) }} \u5982\u679c\u53d8\u91cf\u672a\u5b9a\u4e49\uff0c\u5219\u5c06\u9ed8\u8ba4\u503c\u8d4b\u503c\u7ed9\u53d8\u91cf\uff0c\u5982\u679c\u5e0c\u671b\u53d8\u91cf\u503c\u4e3a\u7a7a\u7684\u65f6\u5019\u4e5f\u8d4b\u503c\uff0c\u9700\u5c06 default \u7b2c\u4e8c\u4e2a\u503c\u4e3a true","title":"\u672a\u5b9a\u4e49\u7684\u53d8\u91cf\u9ed8\u8ba4\u503c"},{"location":"basic/Jinja2/#_16","text":"- name : touch files with an optional mode file : dest : \"{{ item.path }}\" state : touch mode : \"{{ item.mode | default(omit) }}\" loop : - path : /tmp/foo - path : /tmp/bar - path : /tmp/baz mode : \"0444\" \u5bf9\u4e8e\u5217\u8868\u4e2d\u7684\u524d\u4e24\u4e2a\u6587\u4ef6\uff0c\u9ed8\u8ba4mode\u5c06\u7531\u7cfb\u7edf\u7684umask\u786e\u5b9a\uff0c\u56e0\u4e3a mode=parameter \u4e0d\u4f1a\u53d1\u9001\u5230\u6587\u4ef6\u6a21\u5757\uff0c\u800c\u6700\u540e\u5f97\u6587\u4ef6\u5c06\u63a5\u6536 mode=0444 \u9009\u9879\u3002","title":"\u7701\u7565\u53c2\u6570"},{"location":"basic/Jinja2/#_17","text":"\u53d6\u6700\u5c0f\u7684\u503c {{ list1 | min }} \u53d6\u6700\u5927\u7684\u503c {{ [3, 4, 2] | max }} \u5c55\u5e73\u5217\u8868 {{ [3, [4, 2] ] | flatten }} {{ [3, [4, [2]] ] | flatten(levels=1) }} # \u5c55\u5e73\u7b2c\u4e00\u7ea7","title":"\u5217\u8868\u8fc7\u6ee4"},{"location":"basic/Jinja2/#_18","text":"\u5bf9\u5217\u8868\u552f\u4e00\u8fc7\u6ee4 {{ list1 | unique }} \u5bf9\u4e24\u4e2a\u5217\u8868\u53bb\u91cd\u5408\u5e76 {{ list1 | union(list2) }} \u5bf9\u4e24\u4e2a\u5217\u8868\u505a\u4ea4\u96c6 {{ list1 | intersect(list2) }} \u627e\u5230\u4e24\u4e2a\u5217\u8868\u5dee\u5f02\u90e8\u5206(\u5728list1 \u4e0d\u5728list2 \u7684\u5dee\u5f02) {{ list1 | difference(list2) }} \u627e\u5230\u4e24\u4e2a\u5217\u8868\u90fd\u4e92\u76f8\u4e0d\u5728\u5bf9\u65b9\u5217\u8868\u7684\u90e8\u5206 {{ list1 | symmetric_difference(list2) }}","title":"\u6570\u636e\u96c6\u8fc7\u6ee4"},{"location":"basic/Jinja2/#_19","text":"\u5c06\u5b57\u5178\u53d8\u4e3a\u5217\u8868 {{ dict | dict2items }} \u8fd4\u56de\u7684\u5217\u8868 - key : Application value : payment - key : Environment value : dev \u53ef\u6307\u5b9a\u5217\u8868 key/vaule \u7684\u540d\u5b57 {{ files | dict2items(key_name='file', value_name='path') }} \u5c06\u5217\u8868\u8f6c\u6362\u4e3a\u5b57\u5178 {{ tags | items2dict }} \u8fd4\u56de\u7684\u5b57\u5178 Application : payment Environment : dev \u53ef\u6307\u5b9a\u5217\u8868 key/vaule \u7684\u540d\u5b57 {{ tags | items2dict(key_name='key', value_name='value') }}","title":"\u5b57\u5178\u8fc7\u6ee4"},{"location":"basic/Jinja2/#zip","text":"\u4f7f\u7528 zip \u6765\u5408\u5e76\u5176\u4ed6\u5217\u8868 - name : give me list combo of two lists debug : msg : \"{{ [1,2,3,4,5] | zip(['a','b','c','d','e','f']) | list }}\" - name : give me shortest combo of two lists debug : msg : \"{{ [1,2,3] | zip(['a','b','c','d','e','f']) | list }}\" \u4f7f\u7528 zip_longest \u4ee5\u5143\u7d20\u6700\u591a\u4e3a\u5408\u5e76\u5bf9\u8c61 - name : give me longest combo of three lists , fill with X debug : msg : \"{{ [1,2,3] | zip_longest(['a','b','c','d','e','f'], [21, 22, 23], fillvalue='X') | list }}\" zip \u4e5f\u53ef\u4ee5\u7528\u4e8e\u6784\u9020\u5b57\u5178 {{ dict(keys_list | zip(values_list)) }} \u53d8\u91cf keys_list : - one - two values_list : - apple - orange \u8f6c\u6362\u540e one : apple two : orange","title":"zip \u8fc7\u6ee4"},{"location":"basic/Jinja2/#_20","text":"\u4f7f\u7528 subelements \u8fc7\u6ee4\u5bf9\u8c61\u7684\u5b50\u5143\u7d20 {{ users | subelements('groups', skip_missing=True) }} \u53d8\u91cf users : - name : alice authorized : - /tmp/alice/onekey.pub - /tmp/alice/twokey.pub groups : - wheel - docker - name : bob authorized : - /tmp/bob/id_rsa.pub groups : - docker \u8f6c\u6362\u540e - - name : alice groups : - wheel - docker authorized : - /tmp/alice/onekey.pub - /tmp/alice/twokey.pub - wheel - - name : alice groups : - wheel - docker authorized : - /tmp/alice/onekey.pub - /tmp/alice/twokey.pub - docker - - name : bob authorized : - /tmp/bob/id_rsa.pub groups : - docker - docker \u4e00\u4e2a\u5728\u5faa\u73af\u4e2d\u4f7f\u7528\u7684\u4f8b\u5b50 - name : Set authorized ssh key, extracting just that data from 'users' authorized_key : user : \"{{ item.0.name }}\" key : \"{{ lookup('file', item.1) }}\" loop : \"{{ users | subelements('authorized') }}\"","title":"\u5b50\u5143\u7d20\u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#mac","text":"\u4ece\u4e00\u4e2a\u4ee5 52:54:00 \u5f00\u5934\u7684\u5b57\u7b26\u4e32\u524d\u7f00\u4e2d\u83b7\u53d6\u4e00\u4e2a\u968f\u673a\u7684MAC\u5730\u5740 \"{{ '52:54:00' | random_mac }}\" # => '52:54:00:ef:1c:03' \u4f7f\u7528\u56e0\u5b50\uff0c\u521b\u5efa\u968f\u673a\u4f46\u5e42\u7b49\u7684MAC\u5730\u5740 \"{{ '52:54:00' | random_mac(seed=inventory_hostname) }}\"","title":"\u968f\u673aMac\u5730\u5740\u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#_21","text":"\u4ece\u5217\u8868\u4e2d\u968f\u673a\u83b7\u53d6\u5143\u7d20 {{ ['a','b','c','d','e','f']|random }} \u4ece0-59 \u7684\u6574\u6570\u4e2d\u968f\u673a\u83b7\u53d6\u4e00\u4e2a\u6570 {{ 59 | random}} \u4ece0-100 \u4e2d\u968f\u673a\u83b7\u53d6\u80fd\u88ab10 \u6574\u9664\u7684\u6570\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a0 10 20 30 40 50 ...100 \u7684\u968f\u673a\u6570\uff09 {{ 100 |random(step=10) }} \u4ece0-100 \u4e2d\u968f\u673a\u83b7\u53d61 \u5f00\u59cb\u6b65\u957f\u4e3a10 \u7684\u6570\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a1 11 21 31 41...91 \u7684\u968f\u673a\u6570\uff09 {{ 100 |random(1, 10) }} {{ 100 |random(start=1, step=10) }} \u4f7f\u7528\u56e0\u5b50\u521b\u5efa\u968f\u673a\u6570 \"{{ 60 | random(seed=inventory_hostname) }} * * * * root /script/from/cron\"","title":"\u968f\u673a\u6570\u8fc7\u6ee4"},{"location":"basic/Jinja2/#_22","text":"\u7ed9\u5df2\u5b58\u5728\u7684\u5217\u8868\u968f\u673a\u6392\u5e8f {{ ['a','b','c']|shuffle }} => ['c','a','b'] {{ ['a','b','c']|shuffle }} => ['b','c','a'] \u4f7f\u7528\u56e0\u5b50\u751f\u6210\u968f\u673a\u5217\u8868 {{ ['a','b','c'] | shuffle(seed=inventory_hostname) }} # => ['b','a','c']","title":"\u968f\u673a\u5217\u8868\u8fc7\u6ee4"},{"location":"basic/Jinja2/#_23","text":"\u83b7\u53d6\u5bf9\u6570, \u9ed8\u8ba4 e {{ myvar | log }} {{ myvar | log(10) }} \u83b7\u53d6n\u6b21\u5e42 {{ myvar | pow(2) }} {{ myvar | pow(5) }} \u83b7\u53d6\u5e73\u65b9\u6839 {{ myvar | root }} {{ myvar | root(5) }}","title":"\u6570\u5b66"},{"location":"basic/Jinja2/#json","text":"\u8be5\u8fc7\u6ee4\u5668\u57fa\u4e8ejmespath\u6784\u5efa \u66f4\u591a\u7684\u793a\u4f8b jmespath examples . json\u8fc7\u6ee4\u5668\uff0c\u53ef\u4ee5\u5bf9\u590d\u6742\u7684json\u6570\u636e\u4f53\u63d0\u53d6\u4e00\u90e8\u5206\u6570\u636e\u3002 json\u7ed3\u6784\u4f53 { \"domain_definition\" : { \"domain\" : { \"cluster\" : [ { \"name\" : \"cluster1\" }, { \"name\" : \"cluster2\" } ], \"server\" : [ { \"name\" : \"server11\" , \"cluster\" : \"cluster1\" , \"port\" : \"8080\" }, { \"name\" : \"server12\" , \"cluster\" : \"cluster1\" , \"port\" : \"8090\" } ], \"library\" : [ { \"name\" : \"lib1\" , \"target\" : \"cluster1\" }, { \"name\" : \"lib2\" , \"target\" : \"cluster2\" } ] } } } \u8981\u4ece\u8fd9\u4e2a\u7ed3\u6784\u4e2d\u63d0\u53d6\u6240\u6709 cluster \uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u67e5\u8be2 - name : \"Display all cluster names\" debug : var : item loop : \"{{ domain_definition | json_query('domain.cluster[*].name') }}\" \u63d0\u53d6\u6240\u6709 server \u7684 name - name : \"Display all server names\" debug : var : item loop : \"{{ domain_definition | json_query('domain.server[*].name') }}\" \u63d0\u53d6 cluster1 \u7684 port - name : \"Display all ports from cluster1\" debug : var : item loop : \"{{ domain_definition | json_query(server_name_cluster1_query) }}\" vars : server_name_cluster1_query : \"domain.server[?cluster=='cluster1'].port\" \u4f7f\u7528\u5b57\u7b26\u4e32\u6765\u8fde\u63a5\u7aef\u53e3 - name : \"Display all ports from cluster1 as a string\" debug : msg : \"{{ domain_definition | json_query('domain.server[?cluster==`cluster1`].port') | join(', ') }}\" \u8fd9\u91cc\u4f7f\u7528\u53cd\u5f15\u53f7\u6765\u907f\u514d\u8f6c\u4e49 \u53ef\u4ee5\u4f7f\u7528\u5355\u5f15\u53f7\u8f6c\u4e49 - name : \"Display all ports from cluster1\" debug : var : item loop : \"{{ domain_definition | json_query('domain.server[?cluster==''cluster1''].port') }}\"","title":"JSON\u67e5\u8be2\u8fc7\u6ee4"},{"location":"basic/Jinja2/#ip","text":"\u6d4b\u8bd5\u5b57\u7b26\u4e32\u662f\u6709\u6548\u7684ip\u5730\u5740\u4e0d {{ myvar | ipaddr }} \u5b57\u7b26\u4e32\u8f6cip\u534f\u8bae\u5730\u5740 {{ myvar | ipv4 }} {{ myvar | ipv6 }} \u4ececidr\u4e2d\u83b7\u53d6\u5730\u5740\u4fe1\u606f {{ '192.0.2.1/24' | ipaddr('address') }}","title":"ip\u5730\u5740\u8fc7\u6ee4"},{"location":"basic/Jinja2/#network-cli","text":"\u4f7f\u7528 parse_cli \u8fc7\u6ee4\u5668\u5c06\u7f51\u7edc\u8bbe\u5907CLI\u547d\u4ee4\u7684\u8f93\u51fa\u8f6c\u6362\u4e3aJSON\u8f93\u51fa {{ output | parse_cli('path/to/spec') }} \u8fd8\u652f\u6301\u4f7f\u7528TextFSM\u5e93\u89e3\u6790CLI\u547d\u4ee4\u7684\u8f93\u51fa {{ output | parse_cli_textfsm('path/to/fsm') }}","title":"Network CLI \u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#network-xml","text":"\u4f7f\u7528 parse_xml \u8fc7\u6ee4\u5668\u5c06\u7f51\u7edc\u8bbe\u5907CLI\u547d\u4ee4\u7684\u8f93\u51fa\u8f6c\u6362\u4e3aXML\u8f93\u51fa {{ output | parse_xml('path/to/spec') }}","title":"Network XML \u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#network-vlan","text":"{{ [3003, 3004, 3005, 100, 1688, 3002, 3999] | vlan_parser }} \u8f93\u51fa ['100,1688,3002-3005,3999'] \u53e6\u4e00\u4e2ajinja2\u6a21\u677f\u4f8b\u5b50 {% set parsed_vlans = vlans | vlan_parser %} switchport trunk allowed vlan {{ parsed_vlans[0] }} {% for i in range (1, parsed_vlans | count) %} switchport trunk allowed vlan add {{ parsed_vlans[i] }}","title":"Network VLAN \u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#_24","text":"\u83b7\u53d6\u5b57\u7b26\u4e32\u5f97hash\u503c {{ 'test1'|hash('sha1') }} {{ 'test1'|hash('md5') }} \u83b7\u53d6\u5b57\u7b26\u4e32\u6821\u9a8c\u548c {{ 'test2'|checksum }} \u83b7\u53d6sha512\u5bc6\u7801\u54c8\u5e0c {{ 'passwordsaresecret'|password_hash('sha512') }} {{ 'secretpassword'|password_hash('sha256', 'mysecretsalt') }}","title":"\u54c8\u5e0c\u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#_25","text":"{{ {'a':1, 'b':2}|combine({'b':3}) }} \u7ed3\u679c {'a':1, 'b':3} \u652f\u6301\u9012\u5f52\u5408\u5e76 {{ {'a':{'foo':1, 'bar':2}, 'b':2}|combine({'a':{'bar':3, 'baz':4}}, recursive=True) }} \u7ed3\u679c {'a':{'foo':1, 'bar':3, 'baz':4}, 'b':2}","title":"\u5408\u5e76\u6563\u5217"},{"location":"basic/Jinja2/#_26","text":"\u4f7f\u7528 map extract \u7b5b\u9009\u5668\u5c06\u7d22\u5f15\u5217\u8868\u6620\u5c04\u5230\u5bb9\u5668\u4e2d\u7684\u503c\u4f5c\u4e3a\u5217\u8868\u8fd4\u56de {{ [0,2]|map('extract', ['x','y','z'] )| list }} # ['x', 'z'] {{ ['x','y']|map('extract', {'x': 42, 'y': 31})|list }} # [42, 31] {{ groups['x']|map('extract', hostvars, 'ec2_ip_address')|list }} \u8fd9\u9700\u8981\u7ec4'x'\u4e2d\u7684\u4e3b\u673a\u5217\u8868\uff0c\u5728\u4e3b\u673a\u4e2d\u67e5\u627e\u4e3b\u673a\uff0c\u7136\u540e\u67e5\u627e\u7ed3\u679c\u7684ec2_ip_address\u3002 \u6700\u540e\u7684\u7ed3\u679c\u662f\u7ec4'x'\u4e2d\u7684\u4e3b\u673a\u7684IP\u5730\u5740\u5217\u8868\u3002 {{ groups['test'] | map('extract', hostvars, 'ansible_default_ipv4.address')|list }} \u8fc7\u6ee4\u5668\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u7528\u4e8e\u5bb9\u5668\u5185\u7684\u9012\u5f52\u67e5\u627e\uff1a {{ ['a']|map('extract', b, ['x','y'])|list }} # b['a']['x']['y']","title":"\u63d0\u53d6\u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#_27","text":"comment \u8fc7\u6ee4\u5668\u5141\u8bb8\u7528\u9009\u62e9\u7684\u6ce8\u91ca\u6837\u5f0f\u88c5\u9970\u6587\u672c\u3002 {{ \"Plain style (default)\" | comment }} \u8f93\u51fa # # Plain style (default) # \u6307\u5b9a\u7279\u5b9a\u7684\u6ce8\u91ca\u5b57\u7b26 {{ \"My Special Case\" | comment(decoration=\"! \") }} \u8f93\u51fa ! ! My Special Case ! \u8f93\u51fa\u5404\u79cd\u8bed\u8a00\u7684\u6ce8\u91ca\u98ce\u683c {{ \"C style\" | comment('c') }} {{ \"C block style\" | comment('cblock') }} {{ \"Erlang style\" | comment('erlang') }} {{ \"XML style\" | comment('xml') }} \u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49 {{ \"Custom style\" | comment('plain', prefix='#######\\n#', postfix='#\\n#######\\n ###\\n #') }} \u8f93\u51fa ####### # # Custom style # ####### ### #","title":"\u6ce8\u91ca\u8fc7\u6ee4"},{"location":"basic/Jinja2/#url","text":"\u4f7f\u7528 urlsplit \u8fc7\u6ee4\u5668\u4eceurl\u5b57\u7b26\u4e32\u4e2d\u53d6\u5176\u4e2d\u7684\u4e00\u4e2a\u7247\u6bb5 {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('hostname') }} # => 'www.acme.com' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('netloc') }} # => 'user:password@www.acme.com:9000' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('username') }} # => 'user' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('password') }} # => 'password' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('path') }} # => '/dir/index.html' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('port') }} # => '9000' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('scheme') }} # => 'http' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('query') }} # => 'query=term' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit('fragment') }} # => 'fragment' {{ \"http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment\" | urlsplit }} # => # { # \"fragment\": \"fragment\", # \"hostname\": \"www.acme.com\", # \"netloc\": \"user:password@www.acme.com:9000\", # \"password\": \"password\", # \"path\": \"/dir/index.html\", # \"port\": 9000, # \"query\": \"query=term\", # \"scheme\": \"http\", # \"username\": \"user\" # }","title":"url \u5206\u5272\u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#_28","text":"# search for \"foo\" in \"foobar\" {{ 'foobar' | regex_search('(foo)') }} # will return empty if it cannot find a match {{ 'ansible' | regex_search('(foobar)') }} # case insensitive search in multiline mode {{ 'foo\\nBAR' | regex_search(\"^bar\", multiline=True, ignorecase=True) }} \u641c\u7d22\u6240\u6709\u5339\u914d\u7684regex # Return a list of all IPv4 addresses in the string {{ 'Some DNS servers are 8.8.8.8 and 8.8.4.4' | regex_findall('\\\\b(?:[0-9]{1,3}\\\\.){3}[0-9]{1,3}\\\\b') }} \u6b63\u5219\u66ff\u6362 # convert \"ansible\" to \"able\" {{ 'ansible' | regex_replace('^a.*i(.*)$', 'a\\\\1') }} # convert \"foobar\" to \"bar\" {{ 'foobar' | regex_replace('^f.*o(.*)$', '\\\\1') }} # convert \"localhost:80\" to \"localhost, 80\" using named groups {{ 'localhost:80' | regex_replace('^(?P<host>.+):(?P<port>\\\\d+)$', '\\\\g<host>, \\\\g<port>') }} # convert \"localhost:80\" to \"localhost\" {{ 'localhost:80' | regex_replace(':80') }} \u8f6c\u4e49\u7279\u6b8a\u5b57\u7b26 # convert '^f.*o(.*)$' to '\\^f\\.\\*o\\(\\.\\*\\)\\$' {{ '^f.*o(.*)$' | regex_escape () }} # convert '^f.*o(.*)$' to '\\^f\\.\\*o(\\.\\*)\\$' {{ '^f.*o(.*)$' | regex_escape ( 'posix_basic' ) }}","title":"\u6b63\u5219\u5339\u914d"},{"location":"basic/Jinja2/#kubernetes","text":"\u4f7f\u7528 k8s_config_resource_name \u8fc7\u6ee4\u5668\u6765\u83b7\u53d6Kubernetes ConfigMap\u6216Secret\u7684\u540d\u79f0 {{ configmap_resource_definition | k8s_config_resource_name }}","title":"Kubernetes \u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#_29","text":"\u4e3ashell\u589e\u52a0\u53cc\u5f15\u53f7 - shell : echo {{ string_value | quote }} \u6839\u636eTrue\uff0cFalse\u6765\u8fd4\u56de\u503c {{ ('name' == 'John') | ternary('Mr','Ms') }} {{ enabled | ternary('no shutdown', 'shutdown', omit) }} # null \u4f7f\u7528\u7b2c\u4e09\u4e2a\u503c \u5217\u8868\u8f6c\u6362\u5b57\u7b26 {{ list | join(\" \") }} \u83b7\u53d6\u8def\u5f84\u7684\u6587\u4ef6\u540d {{ path | basename }} \u83b7\u53d6\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84 {{ '~/.ssh/id_rsa' | expanduser }} windows\u5e73\u53f0\u4e0b\u83b7\u53d6\u8def\u5f84\u7684\u6587\u4ef6\u540d {{ path | win_basename }} \u83b7\u53d6\u8def\u5f84\u4e2d\u7684\u76ee\u5f55 {{ path | dirname }} \u5c55\u5f00\u5305\u542b\u73af\u5883\u53d8\u91cf\u7684\u8def\u5f84 {{ path | expandvars }} \u83b7\u53d6\u8f6f\u8fde\u63a5\u7684\u771f\u5b9e\u8def\u5f84 {{ path | realpath }} {{ path | relpath('/etc') }} # \u6307\u5b9a\u542f\u70b9 \u83b7\u53d6\u6587\u4ef6\u540d\u7684\u540d\u79f0\u548c\u6269\u5c55\u540d {{ path | splitext }} base64\u7f16\u7801 {{ encoded | b64decode }} {{ decoded | string | b64encode }} {{ encoded | b64decode(encoding='utf-16-le') }} {{ decoded | string | b64encode(encoding='utf-16-le') }} \u4ece\u5b57\u7b26\u4e32\u521b\u5efaUUID\uff081.9\u7248\u4e2d\u7684\u65b0\u529f\u80fd\uff09 {{ hostname | to_uuid }} \u5c06\u8f6c\u6362\u4e3a\u5e03\u5c14\u7c7b\u578b\uff0c\u5982\"True\" \u5b57\u7b26\u4e32\u8f6c\u6362\u4e3aTrue - debug: msg=test when: some_string_value | bool \u65e5\u671f # Get total amount of seconds between two dates. Default date format is %Y-%m-%d %H:%M:%S but you can pass your own format {{ ((\"2016-08-14 20:00:12\" | to_datetime) - (\"2015-12-25\" | to_datetime('%Y-%m-%d'))).total_seconds() }} # Get remaining seconds after delta has been calculated. NOTE: This does NOT convert years, days, hours, etc to seconds. For that, use total_seconds() {{ ((\"2016-08-14 20:00:12\" | to_datetime) - (\"2016-08-14 18:00:00\" | to_datetime)).seconds }} # This expression evaluates to \"12\" and not \"132\". Delta is 2 hours, 12 seconds # get amount of days between two dates. This returns only number of days and discards remaining hours, minutes, and seconds {{ ((\"2016-08-14 20:00:12\" | to_datetime) - (\"2015-12-25\" | to_datetime('%Y-%m-%d'))).days }} \u683c\u5f0f\u5316\u65e5\u671f # Display year-month-day {{ '%Y-%m-%d' | strftime }} # Display hour:min:sec {{ '%H:%M:%S' | strftime }} # Use ansible_date_time.epoch fact {{ '%Y-%m-%d %H:%M:%S' | strftime(ansible_date_time.epoch) }} # Use arbitrary epoch value {{ '%Y-%m-%d' | strftime(0) }} # => 1970-01-01 {{ '%Y-%m-%d' | strftime(1441357287) }} # => 2015-09-04 \u67e5\u770b\u53d8\u91cf\u7684python\u7c7b\u578b {{ myvar | type }}","title":"\u5176\u4ed6\u7684\u5e38\u7528\u8fc7\u6ee4"},{"location":"basic/Jinja2/#_30","text":"- name : give me largest permutations (order matters) debug : msg : \"{{ [1,2,3,4,5] | permutations | list }}\" - name : give me permutations of sets of three debug : msg : \"{{ [1,2,3,4,5] | permutations(3) | list }}\" - name : give me combinations for sets of two debug : msg : \"{{ [1,2,3,4,5] | combinations(2) | list }}\"","title":"\u7ec4\u5408\u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#product","text":"product \u8fc7\u6ee4\u5668\u8fd4\u56de\u8f93\u5165\u8fed\u4ee3\u7684\u7b1b\u5361\u5c14\u79ef\u3002 - name : generate multiple hostnames debug : msg : \"{{ ['foo', 'bar'] | product(['com']) | map('join', '.') | join(',') }}\" \u8f93\u51fa { \"msg\" : \"foo.com,bar.com\" }","title":"Product  \u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#debug","text":"{{ myvar | type_debug }}","title":"debug \u8fc7\u6ee4\u5668"},{"location":"basic/Jinja2/#_31","text":"\u5c06\u6570\u5b57\u8f6c\u6362\u4e3a\u4eba\u7c7b\u53ef\u8bfb\u7684\u5b57\u7b26\u4e32 - name : \"Human Readable\" assert : that : - '\"1.00 Bytes\" == 1|human_readable' - '\"1.00 bits\" == 1|human_readable(isbits=True)' - '\"10.00 KB\" == 10240|human_readable' - '\"97.66 MB\" == 102400000|human_readable' - '\"0.10 GB\" == 102400000|human_readable(unit=\"G\")' - '\"0.10 Gb\" == 102400000|human_readable(isbits=True, unit=\"G\")' \u8fd4\u56de { \"changed\" : false , \"msg\" : \"All assertions passed\" } \u4ee5\u5b57\u8282\u683c\u5f0f\u8fd4\u56de\u7ed9\u5b9a\u7684\u5b57\u7b26\u4e32\u3002 - name : \"Human to Bytes\" assert : that : - \"{{'0'|human_to_bytes}} == 0\" - \"{{'0.1'|human_to_bytes}} == 0\" - \"{{'0.9'|human_to_bytes}} == 1\" - \"{{'1'|human_to_bytes}} == 1\" - \"{{'10.00 KB'|human_to_bytes}} == 10240\" - \"{{ '11 MB'|human_to_bytes}} == 11534336\" - \"{{ '1.1 GB'|human_to_bytes}} == 1181116006\" - \"{{'10.00 Kb'|human_to_bytes(isbits=True)}} == 10240\" \u8fd4\u56de { \"changed\" : false , \"msg\" : \"All assertions passed\" }","title":"\u5b57\u8282\u8f6c\u6362"},{"location":"basic/Jinja2/#_32","text":"\u9664\u4e86\u8fc7\u6ee4\u5668\uff0c\u6240\u8c13\u7684\u201c\u6d4b\u8bd5\u201d\u4e5f\u662f\u53ef\u7528\u7684\u3002\u6d4b\u8bd5\u53ef\u4ee5\u7528\u4e8e\u5bf9\u7167\u666e\u901a\u8868\u8fbe\u5f0f\u6d4b\u8bd5\u4e00\u4e2a\u53d8\u91cf\u3002 \u8981\u6d4b\u8bd5\u4e00\u4e2a\u53d8\u91cf\u6216\u8868\u8fbe\u5f0f\uff0c\u4f60\u8981\u5728\u53d8\u91cf\u540e\u52a0\u4e0a\u4e00\u4e2a is \u4ee5\u53ca\u6d4b\u8bd5\u7684\u540d\u79f0\u3002\u4f8b\u5982\uff0c\u8981\u5f97\u51fa \u4e00\u4e2a\u503c\u662f\u5426\u5b9a\u4e49\u8fc7\uff0c\u4f60\u53ef\u4ee5\u7528 name is defined \uff0c\u8fd9\u4f1a\u6839\u636e name \u662f\u5426\u5b9a\u4e49\u8fd4\u56de true \u6216 false \u3002","title":"\u6d4b\u8bd5"},{"location":"basic/Jinja2/#_33","text":"variable is test_name \u4f8b\u5982 result is failed \u6d4b\u8bd5\u4e5f\u53ef\u4ee5\u63a5\u53d7\u53c2\u6570\u3002\u5982\u679c\u6d4b\u8bd5\u53ea\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570\uff0c\u4f60\u53ef\u4ee5\u7701\u53bb\u62ec\u53f7\u6765\u5206\u7ec4\u5b83\u4eec\u3002\u4f8b\u5982\uff0c \u4e0b\u9762\u7684\u4e24\u4e2a\u8868\u8fbe\u5f0f\u505a\u540c\u6837\u7684\u4e8b\u60c5: {% if loop.index is divisibleby 3 %} {% if loop.index is divisibleby(3) %}","title":"\u6d4b\u8bd5\u8bed\u6cd5"},{"location":"basic/Jinja2/#_34","text":"vars: url: \"http://example.com/users/foo/resources/bar\" tasks: - debug: msg: \"matched pattern 1\" when: url is match(\"http://example.com/users/.*/resources/.*\") - debug: msg: \"matched pattern 2\" when: url is search(\"/users/.*/resources/.*\") - debug: msg: \"matched pattern 3\" when: url is search(\"/users/\") - debug: msg: \"matched pattern 4\" when: url is regex(\"example.com/\\w+/foo\") match \u9700\u8981\u5728\u5b57\u7b26\u4e32\u4e2d\u5b8c\u5168\u5339\u914d\uff0c\u800c search \u53ea\u9700\u8981\u5339\u914d\u5b57\u7b26\u4e32\u7684\u5b50\u96c6\u3002\u5339\u914d\u6210\u529f\u8fd4\u56de True \uff0c\u4efb\u52a1\u5219\u6267\u884c\u3002","title":"\u6d4b\u8bd5\u5b57\u7b26\u4e32"},{"location":"basic/Jinja2/#_35","text":"\u68c0\u67e5ansible_distribution_version\u7248\u672c\u662f\u5426\u5927\u4e8e\u6216\u7b49\u4e8e'12 .04'\uff0c\u6761\u4ef6\u6210\u7acb\u8fd4\u56deTrue\u3002 {{ ansible_distribution_version is version_compare('12.04', '>=') }} \u8fdb\u884c\u4e25\u683c\u7684\u7248\u672c\u68c0\u67e5 {{ sample_version_var is version_compare('1.0', operator='lt', strict=True) }} \u53ef\u63a5\u53d7\u7684\u8fd0\u7b97\u7b26 <, lt, <=, le, >, gt, >=, ge, ==, =, eq, !=, <>, ne","title":"\u7248\u672c\u6bd4\u8f83"},{"location":"basic/Jinja2/#_36","text":"\u6d4b\u8bd5\u4e00\u4e2a\u5217\u8868\u662f\u5426\u5305\u542b\u53e6\u4e00\u4e2a\u5217\u8868\u3002 vars : a : [ 1 , 2 , 3 , 4 , 5 ] b : [ 2 , 3 ] tasks : - debug : msg : \"A includes B\" when : a is superset(b) - debug : msg : \"B is included in A\" when : b is subset(a) \u6d4b\u8bd5\u5217\u8868\u662f\u5426\u5305\u542b\u503c vars : lacp_groups : - master : lacp0 network : 10.65.100.0/24 gateway : 10.65.100.1 dns4 : - 10.65.100.10 - 10.65.100.11 interfaces : - em1 - em2 - master : lacp1 network : 10.65.120.0/24 gateway : 10.65.120.1 dns4 : - 10.65.100.10 - 10.65.100.11 interfaces : - em3 - em4 tasks : - debug : msg : \"{{ (lacp_groups|selectattr('interfaces', 'contains', 'em1')|first).master }}\" \u60a8\u53ef\u4ee5\u4f7f\u7528 any \u548c all \u6765\u68c0\u67e5\u5217\u8868\u4e2d\u7684\u4efb\u4f55\u5143\u7d20\u6216\u6240\u6709\u5143\u7d20\u662f\u5426\u4e3a\u771f vars : mylist : - 1 - \"{{ 3 == 3 }}\" - True myotherlist : - False - True tasks : - debug : msg : \"all are true!\" when : mylist is all - debug : msg : \"at least one is true\" when : myotherlist is any","title":"\u5305\u542b\u6d4b\u8bd5"},{"location":"basic/Jinja2/#_37","text":"- debug: msg: \"path is a directory\" when: mypath is directory - debug: msg: \"path is a file\" when: mypath is file - debug: msg: \"path is a symlink\" when: mypath is link - debug: msg: \"path already exists\" when: mypath is exists - debug: msg: \"path is {{ (mypath is abs)|ternary('absolute','relative')}}\" - debug: msg: \"path is the same file as path2\" when: mypath is same_file(path2) - debug: msg: \"path is a mount\" when: mypath is mount","title":"\u8def\u5f84\u6d4b\u8bd5"},{"location":"basic/Jinja2/#_38","text":"\u4ee5\u4e0bplaybook\u662f\u68c0\u67e5\u4efb\u52a1\u72b6\u6001\u7684\u6d4b\u8bd5\u3002 tasks: - shell: /usr/bin/foo register: result ignore_errors: True - debug: msg=\"it failed\" when: result is failed - debug: msg=\"it changed\" when: result is changed - debug: msg=\"it succeeded in Ansible >= 2.1\" when: result is succeeded - debug: msg=\"it succeeded\" when: result is success - debug: msg=\"it was skipped\" when: result is skipped","title":"\u6d4b\u8bd5\u547d\u4ee4\u7ed3\u679c"},{"location":"basic/Jinja2/#lookup","text":"lookup \u63d2\u4ef6\u5141\u8bb8\u8bbf\u95ee\u5916\u90e8\u6570\u636e\u6e90\u3002 # \u83b7\u53d6\u6587\u4ef6\u5185\u5bb9 vars : motd_value : \"{{ lookup('file', '/etc/motd') }}\" tasks : - debug : msg : \"motd value is {{ motd_value }}\" lookup \u66f4\u591a\u7684\u63d2\u4ef6\u4f7f\u7528\u8bf7\u770b lookup \u63d2\u4ef6","title":"lookup \u63d2\u4ef6"},{"location":"basic/Jinja2/#if_1","text":"ad-hoc ansible localhost -m debug -a \"msg={%- if ansible_play_hosts.index(inventory_hostname) < 3 -%}master{%- else -%}slave{%- endif -%}\" playbook - debug : msg : >- { % - if ansible_play_hosts.index(inventory_hostname) < 3 -% } master { % - else -% } slave { % - endif -% }","title":"if \u8bed\u53e5"},{"location":"basic/Jinja2/#for_1","text":"ad-hoc ansible localhost -m debug -a \"msg={%- for t in [1,2,3] -%}{{ t }}{%- endfor -%}\" playbook - debug : msg : |- {%- for t in [1,2,3] -%} {{ t }} {%- endfor -%}","title":"for \u8bed\u53e5"},{"location":"basic/Jinja2/#when-jinja2","text":"- hosts : target_host tasks : - name : Show debug debug : msg='\u6761\u4ef6\u6ee1\u8db3\u4f60\u5c31\u4f1a\u770b\u5230\u6211\u3002' when : '{% if def_a_var|d(\"abc\") == \"abc\" %}{{ foo | d(\"true\") }}{% endif %}'","title":"\u5728 when \u91cc\u4f7f\u7528 jinja2 \u8868\u8fbe\u5f0f"},{"location":"basic/Patterns/","text":"5. Patterns \u5339\u914d \u00b6 Patterns \u662f\u5b9a\u4e49Ansible\u8981\u6267\u884c\u7684\u4e3b\u673a\u3002Ansible Patterns \u53ef\u4ee5\u5f15\u7528\u4e00\u4e2a\u4e3b\u673a\uff0c\u4e00\u4e2aIP\u5730\u5740\uff0c\u4e00\u4e2a\u6e05\u5355\u7ec4\uff0c\u4e00\u4e2a\u96c6\u5408\u7ec4\u6216\u6e05\u5355\u4e2d\u7684\u6240\u6709\u4e3b\u673a\u3002 Patterns \u5177\u6709\u9ad8\u5ea6\u7684\u7075\u6d3b\u6027\uff0c\u60a8\u53ef\u4ee5\u6392\u9664\u6216\u8981\u6c42\u4e3b\u673a\u7684\u5b50\u96c6\uff0c\u4f7f\u7528 \u901a\u914d\u7b26 \u6216 \u6b63\u5219\u8868\u8fbe\u5f0f \u6765\u5b9a\u4e49 Patterns \u3002 \u547d\u4ee4\u683c\u5f0f ansible <pattern> -m <module_name> -a \"<module options>\" ansible-playbook -l <pattern> [options] playbook.yml \u4f7f\u7528\u793a\u4f8b ansible * -m service -a \"name=httpd state=restarted\" ansible-playbook -l all playbook.yml \u5728 playbook \u7684\u5267\u672c\u4e2d\uff0c\u9700\u8981\u5728\u6bcf\u4e2a play \u4e2d hosts: \u884c\u4e2d\u5b9a\u4e49 - name: <play_name> hosts: <pattern> \u4f7f\u7528\u793a\u4f8b - name: restart webservers hosts: webservers \u5e38\u7528\u5339\u914d \u00b6 \u63cf\u8ff0 Pattern(s) Targets \u6240\u6709\u4e3b\u673a all \u6216\u8005 * \u4e3b\u673a\u6e05\u5355\u4e2d\u7684\u6240\u6709\u4e3b\u673a \u4e00\u4e2a\u4e3b\u673a(\u7cbe\u786e\u5339\u914d) host1 \u6216\u8005 192.168.77.131 host1 \u6216\u8005 192.168.77.131 \u591a\u4e2a\u4e3b\u673a host1:host2 \u6216\u8005 host1,host2 host1:host2 \u6216\u8005 host1,host2 \u4e00\u4e2a\u7ec4 webservers webservers \u7ec4\u4e2d\u7684\u4e3b\u673a \u591a\u4e2a\u7ec4(\u6216\u5339\u914d) webservers:dbservers webservers \u548c dbservers \u6240\u6709\u7684\u4e3b\u673a \u6392\u9664\u7ec4(\u975e\u6a21\u5f0f\u5339\u914d) webservers:!atlanta webservers \u7ec4\u4e2d\u9664 atlanta \u4e4b\u5916\u7684\u6240\u6709\u4e3b\u673a \u4ea4\u96c6\u7ec4(\u4ea4\u96c6\u5339\u914d) webservers:&dbservers webservers \u548c dbservers \u90fd\u5b58\u5728\u7684\u4e3b\u673a \u901a\u914d\u7b26\u5339\u914d *.com web*.com:dbserver * \u8868\u793a\u6240\u6709\u5b57\u7b26 \u7ec4\u5408\u5339\u914d webservers:dbservers:&staging:!phoenix \u5728webservers \u6216\u8005dbservers \u7ec4\u4e2d\uff0c\u5fc5\u987b\u8fd8\u5b58\u5728\u4e8estaging \u7ec4\u4e2d\uff0c\u4f46\u662f\u4e0d\u5728phoenix \u7ec4\u4e2d \u5c40\u9650\u6027 \u00b6 Patterns \u4f9d\u8d56\u4e8e \u4e3b\u673a\u6e05\u5355 (inventory)\uff0c\u5982\u679c\u8bf4\u5339\u914d\u4e0d\u5230\u4e3b\u673a\u6e05\u5355\u91cc\u7684\u6570\u636e\uff0c\u5219\u4f1a\u8fd4\u56de\u5982\u4e0b\u8b66\u544a # ansible none -m ping [ WARNING ] : Could not match supplied host pattern, ignoring: none [ WARNING ] : No hosts matched, nothing to do \u9ad8\u7ea7\u7279\u6027 \u00b6 \u4f7f\u7528\u53d8\u91cf \u00b6 \u5728ansible-palybook \u547d\u4ee4\u4e2d\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u53d8\u91cf\u6765\u7ec4\u6210\u8fd9\u6837\u7684\u8868\u8fbe\u5f0f\uff0c\u4f46\u662f\u4f60\u5fc5\u987b\u4f7f\u7528 -e \u7684\u9009\u9879\u6765\u6307\u5b9a\u8fd9\u4e2a\u8868\u8fbe\u5f0f playbook # cat playbook.yml --- - name: Using variables in patterns hosts: \"{{ hosts }}\" tasks: - name: ping ping: \u6267\u884cplaybook ansible-playbook playbook.yml -e \"hosts=192.168.77.131\" ansible-playbook playbook.yml -e \"hosts=192.168.77.132\" \u4f7f\u7528\u5207\u7247 \u00b6 \u53ef\u4ee5\u4f7f\u7528\u4e0b\u6807\u6765\u9009\u62e9\u7ec4\u4e2d\u7684\u5404\u4e2a\u4e3b\u673a\u6216\u8303\u56f4\uff0c\u7c7b\u4f3cpython\u4e2d\u7684\u5207\u7247 webservers[0] webservers[1:] webservers[0:25] [0] \u8868\u793a\u7ec4\u7b2c\u4e00\u4e2a\u6210\u5458 [1:] \u8868\u793a\u7ec4\u5185\u7b2c2\u4e2a\u542b\u7b2c2\u4e2a\u4e4b\u540e\u7684\u6240\u6709\u6210\u5458 [0:25] \u8868\u793a\u7ec4\u7b2c1\u4e2a\u5230\u7b2c24\u4e2a\u6210\u5458 \u6b63\u5219\u8868\u8fbe\u5f0f \u00b6 \u5728\u5f00\u5934\u7684\u5730\u65b9\u4f7f\u7528\u201c~\u201d\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f ~(web|db).*\\.example\\.com \u9650\u5b9a\u4e3b\u673a \u00b6 \u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u884c\u9009\u9879\u66f4\u6539playbook\u4e2d\u5b9a\u4e49\u7684Patterns \u7684\u884c\u4e3a ansible-playbook site.yml -l 192.168.77.129 ansible-playbook site.yml -l @retry_hosts.txt \u53ea\u6267\u884c -l \u540e\u7684\u4e3b\u673a, @ \u5f00\u5934\u6307\u5b9a\u6587\u4ef6","title":"5. Patterns \u5339\u914d"},{"location":"basic/Patterns/#5-patterns","text":"Patterns \u662f\u5b9a\u4e49Ansible\u8981\u6267\u884c\u7684\u4e3b\u673a\u3002Ansible Patterns \u53ef\u4ee5\u5f15\u7528\u4e00\u4e2a\u4e3b\u673a\uff0c\u4e00\u4e2aIP\u5730\u5740\uff0c\u4e00\u4e2a\u6e05\u5355\u7ec4\uff0c\u4e00\u4e2a\u96c6\u5408\u7ec4\u6216\u6e05\u5355\u4e2d\u7684\u6240\u6709\u4e3b\u673a\u3002 Patterns \u5177\u6709\u9ad8\u5ea6\u7684\u7075\u6d3b\u6027\uff0c\u60a8\u53ef\u4ee5\u6392\u9664\u6216\u8981\u6c42\u4e3b\u673a\u7684\u5b50\u96c6\uff0c\u4f7f\u7528 \u901a\u914d\u7b26 \u6216 \u6b63\u5219\u8868\u8fbe\u5f0f \u6765\u5b9a\u4e49 Patterns \u3002 \u547d\u4ee4\u683c\u5f0f ansible <pattern> -m <module_name> -a \"<module options>\" ansible-playbook -l <pattern> [options] playbook.yml \u4f7f\u7528\u793a\u4f8b ansible * -m service -a \"name=httpd state=restarted\" ansible-playbook -l all playbook.yml \u5728 playbook \u7684\u5267\u672c\u4e2d\uff0c\u9700\u8981\u5728\u6bcf\u4e2a play \u4e2d hosts: \u884c\u4e2d\u5b9a\u4e49 - name: <play_name> hosts: <pattern> \u4f7f\u7528\u793a\u4f8b - name: restart webservers hosts: webservers","title":"5. Patterns \u5339\u914d"},{"location":"basic/Patterns/#_1","text":"\u63cf\u8ff0 Pattern(s) Targets \u6240\u6709\u4e3b\u673a all \u6216\u8005 * \u4e3b\u673a\u6e05\u5355\u4e2d\u7684\u6240\u6709\u4e3b\u673a \u4e00\u4e2a\u4e3b\u673a(\u7cbe\u786e\u5339\u914d) host1 \u6216\u8005 192.168.77.131 host1 \u6216\u8005 192.168.77.131 \u591a\u4e2a\u4e3b\u673a host1:host2 \u6216\u8005 host1,host2 host1:host2 \u6216\u8005 host1,host2 \u4e00\u4e2a\u7ec4 webservers webservers \u7ec4\u4e2d\u7684\u4e3b\u673a \u591a\u4e2a\u7ec4(\u6216\u5339\u914d) webservers:dbservers webservers \u548c dbservers \u6240\u6709\u7684\u4e3b\u673a \u6392\u9664\u7ec4(\u975e\u6a21\u5f0f\u5339\u914d) webservers:!atlanta webservers \u7ec4\u4e2d\u9664 atlanta \u4e4b\u5916\u7684\u6240\u6709\u4e3b\u673a \u4ea4\u96c6\u7ec4(\u4ea4\u96c6\u5339\u914d) webservers:&dbservers webservers \u548c dbservers \u90fd\u5b58\u5728\u7684\u4e3b\u673a \u901a\u914d\u7b26\u5339\u914d *.com web*.com:dbserver * \u8868\u793a\u6240\u6709\u5b57\u7b26 \u7ec4\u5408\u5339\u914d webservers:dbservers:&staging:!phoenix \u5728webservers \u6216\u8005dbservers \u7ec4\u4e2d\uff0c\u5fc5\u987b\u8fd8\u5b58\u5728\u4e8estaging \u7ec4\u4e2d\uff0c\u4f46\u662f\u4e0d\u5728phoenix \u7ec4\u4e2d","title":"\u5e38\u7528\u5339\u914d"},{"location":"basic/Patterns/#_2","text":"Patterns \u4f9d\u8d56\u4e8e \u4e3b\u673a\u6e05\u5355 (inventory)\uff0c\u5982\u679c\u8bf4\u5339\u914d\u4e0d\u5230\u4e3b\u673a\u6e05\u5355\u91cc\u7684\u6570\u636e\uff0c\u5219\u4f1a\u8fd4\u56de\u5982\u4e0b\u8b66\u544a # ansible none -m ping [ WARNING ] : Could not match supplied host pattern, ignoring: none [ WARNING ] : No hosts matched, nothing to do","title":"\u5c40\u9650\u6027"},{"location":"basic/Patterns/#_3","text":"","title":"\u9ad8\u7ea7\u7279\u6027"},{"location":"basic/Patterns/#_4","text":"\u5728ansible-palybook \u547d\u4ee4\u4e2d\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u53d8\u91cf\u6765\u7ec4\u6210\u8fd9\u6837\u7684\u8868\u8fbe\u5f0f\uff0c\u4f46\u662f\u4f60\u5fc5\u987b\u4f7f\u7528 -e \u7684\u9009\u9879\u6765\u6307\u5b9a\u8fd9\u4e2a\u8868\u8fbe\u5f0f playbook # cat playbook.yml --- - name: Using variables in patterns hosts: \"{{ hosts }}\" tasks: - name: ping ping: \u6267\u884cplaybook ansible-playbook playbook.yml -e \"hosts=192.168.77.131\" ansible-playbook playbook.yml -e \"hosts=192.168.77.132\"","title":"\u4f7f\u7528\u53d8\u91cf"},{"location":"basic/Patterns/#_5","text":"\u53ef\u4ee5\u4f7f\u7528\u4e0b\u6807\u6765\u9009\u62e9\u7ec4\u4e2d\u7684\u5404\u4e2a\u4e3b\u673a\u6216\u8303\u56f4\uff0c\u7c7b\u4f3cpython\u4e2d\u7684\u5207\u7247 webservers[0] webservers[1:] webservers[0:25] [0] \u8868\u793a\u7ec4\u7b2c\u4e00\u4e2a\u6210\u5458 [1:] \u8868\u793a\u7ec4\u5185\u7b2c2\u4e2a\u542b\u7b2c2\u4e2a\u4e4b\u540e\u7684\u6240\u6709\u6210\u5458 [0:25] \u8868\u793a\u7ec4\u7b2c1\u4e2a\u5230\u7b2c24\u4e2a\u6210\u5458","title":"\u4f7f\u7528\u5207\u7247"},{"location":"basic/Patterns/#_6","text":"\u5728\u5f00\u5934\u7684\u5730\u65b9\u4f7f\u7528\u201c~\u201d\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f ~(web|db).*\\.example\\.com","title":"\u6b63\u5219\u8868\u8fbe\u5f0f"},{"location":"basic/Patterns/#_7","text":"\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u884c\u9009\u9879\u66f4\u6539playbook\u4e2d\u5b9a\u4e49\u7684Patterns \u7684\u884c\u4e3a ansible-playbook site.yml -l 192.168.77.129 ansible-playbook site.yml -l @retry_hosts.txt \u53ea\u6267\u884c -l \u540e\u7684\u4e3b\u673a, @ \u5f00\u5934\u6307\u5b9a\u6587\u4ef6","title":"\u9650\u5b9a\u4e3b\u673a"},{"location":"basic/Playbook-features/","text":"15. Playbook \u9ad8\u7ea7\u7279\u6027 \u00b6 \u6743\u9650\u63d0\u5347 \u00b6 Ansible\u4f7f\u7528\u73b0\u6709\u7684\u6743\u9650\u5347\u7ea7\u7cfb\u7edf\u6765\u6267\u884c\u5177\u6709 root \u6743\u9650\u6216\u5176\u4ed6\u7528\u6237\u6743\u9650\u7684\u4efb\u52a1\u3002\u56e0\u4e3a\u8fd9\u4e2a\u7279\u6027\u5141\u8bb8\u60a8\u6210\u4e3a\u53e6\u4e00\u4e2a\u7528\u6237\uff0c\u4e0e\u767b\u5f55\u5230\u673a\u5668\u7684\u7528\u6237(\u8fdc\u7a0b\u7528\u6237)\u4e0d\u540c\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u5176\u79f0\u4e3a become \u3002 become \u5173\u952e\u5b57\u5229\u7528\u73b0\u6709\u7684\u6743\u9650\u5347\u7ea7\u5de5\u5177\uff0c\u5982 sudo \u3001 su \u3001 pfexec \u3001 doas \u3001 pbrun \u3001 dzdo \u3001 ksu \u3001 runas \u3001 machinectl \u7b49\u3002 \u4f7f\u7528become \u00b6 \u4f60\u53ef\u4ee5\u5728 play \u6216 task \u4e0a\u4f7f\u7528 become \uff0c\u540c\u65f6\u4f7f\u7528\u65f6\uff0c\u4f18\u5148\u7ea7\u89c4\u5219\u4f1a\u51b3\u5b9a\u54ea\u4e2a\u751f\u6548\u3002 become \u6307\u4ee4 \u00b6 become \u8bbe\u7f6e yes \u5373\u5f00\u542f\u63d0\u5347\u6743\u9650 become_user \u6307\u5b9a\u63d0\u5347\u6743\u9650\u7684\u7528\u6237 become_method \u6307\u5b9a\u63d0\u5347\u6743\u9650\u7684\u65b9\u5f0f\uff0c\u6709sudo\uff0csu\uff0crunas\u7b49\u3002 become_flags \u4f20\u7ed9\u53ef\u6267\u884c\u6587\u4ef6\u7684\u53c2\u6570 \u4f8b\u5982\uff0c\u542f\u52a8\u670d\u52a1\u9700\u8981 root \u6743\u9650 - name : Ensure the httpd service is running service : name : httpd state : started become : yes \u4ee5apache\u7528\u6237\u8eab\u4efd\u8fd0\u884c\u547d\u4ee4 - name : Run a command as the apache user command : somecommand become : yes become_user : apache \u5f53shell\u4e3anologin\u65f6\uff0c\u4f5c\u4e3anobody\u7528\u6237\u6267\u884c\u67d0\u4e9b\u64cd\u4f5c - name : Run a command as nobody command : somecommand become : yes become_method : su become_user : nobody become_flags : '-s /bin/sh' become \u53d8\u91cf \u00b6 \u5728\u4e3b\u673a\u6e05\u5355\u4e2d\u53ef\u4ee5\u4e3a\u8282\u70b9\u5b9a\u4e49\u4e0d\u540c\u7684 become \u9009\u9879\uff0c\u4f7f\u7528\u4e0b\u5217\u53d8\u91cf ansible_become \u5f00\u542f\u63d0\u5347\u6743\u9650 ansible_become_method \u63d0\u5347\u6743\u9650\u7684\u65b9\u5f0f\uff0c\u6709sudo\uff0csu\uff0crunas\u7b49\u3002 ansible_become_user \u63d0\u5347\u6743\u9650\u7684\u7528\u6237 ansible_become_pass \u63d0\u5347\u6743\u9650\u7684\u7528\u6237\u5bc6\u7801 \u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5e0c\u671b\u5728\u4e00\u4e2a\u540d\u4e3awebserver\u7684\u670d\u52a1\u5668\u4e0a\u4ee5root\u8eab\u4efd\u8fd0\u884c\u6240\u6709\u4efb\u52a1\uff0c\u4f46\u662f\u60a8\u53ea\u80fd\u4f5c\u4e3amanager\u7528\u6237\u8fde\u63a5\uff0c\u90a3\u4e48\u60a8\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3c\u8fd9\u6837\u7684\u5e93\u5b58\u6761\u76ee webserver ansible_user = manager ansible_become=yes become \u547d\u4ee4\u884c\u9009\u9879 \u00b6 --become\uff0c-b --ask-become-pass, -K \u544a\u8bc9\u7a0b\u5e8f\u63d0\u5347\u6743\u9650\u7684\u7528\u6237\u5bc6\u7801 --become-method \u63d0\u5347\u6743\u9650\u7684\u65b9\u5f0f\uff0c\u6709sudo\uff0csu\uff0crunas\u7b49\u3002 --become-user \u63d0\u5347\u6743\u9650\u7684\u7528\u6237 ansible -i hosts node1 -m shell -a \"whoami\" --become --become-method = su --become-user = root --ask-become-pass ansible-playbook -i hosts test.yml --become --become-method = su --become-user = root --ask-become-pass become\u7684\u4e00\u4e9b\u9650\u5236\u548c\u98ce\u9669 \u00b6 \u6210\u4e3a\u65e0\u7279\u6743\u7528\u6237\u7684\u98ce\u9669 \u4e0d\u662f\u6240\u6709\u7684\u8fde\u63a5\u63d2\u4ef6\u90fd\u652f\u6301\u7279\u6743\u5347\u7ea7 \u6bcf\u4e2a\u4e3b\u673a\u53ea\u80fd\u542f\u7528\u4e00\u4e2a\u7279\u6743\u5347\u7ea7\u6a21\u5f0f(su,sudo...) \u7279\u6743\u5347\u7ea7\u4e0d\u80fd\u9650\u5236\u67d0\u4e9b\u547d\u4ee4\u80fd\u5347\u7ea7\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4ansible\u6267\u884c\u65f6\u51fa\u73b0\u9519\u8bef\u3002 \u4e0d\u80fd\u8bbf\u95ee\u7531 pam_systemd \u586b\u5145\u7684\u73af\u5883\u53d8\u91cf \u7f51\u7edc\u6a21\u5757\u4f7f\u7528become \u00b6 \u4ece2.6\u7248\u5f00\u59cb\uff0cAnsible\u5728\u6240\u6709\u652f\u6301enable\u6a21\u5f0f\u7684\u7f51\u7edc\u8bbe\u5907\u4e0a\u8fdb\u884c\u7279\u6743\u5347\u7ea7(\u8fdb\u5165enable\u6a21\u5f0f\u6216\u7279\u6743EXEC\u6a21\u5f0f) \u4f60\u5fc5\u987b\u5c06\u8fde\u63a5\u7c7b\u578b\u8bbe\u7f6e\u4e3a connection: network_cli \u6216 connection: httpapi \uff0c\u624d\u80fd\u5728\u7f51\u7edc\u8bbe\u5907\u4e0a\u4f7f\u7528 become \u8fdb\u884c\u6743\u9650\u5347\u7ea7\u3002 \u82e5\u8981\u8bbe\u7f6e\u7279\u5b9a\u4efb\u52a1\u7684 enable \u6a21\u5f0f\uff0c\u8bf7\u5728\u4efb\u52a1\u7ea7\u522b\u4e0a\u6dfb\u52a0 become - name : Gather facts (eos) eos_facts : gather_subset : - \"!hardware\" become : yes become_method : enable \u82e5\u8981\u4e3a\u5355\u4e2aplay\u4e2d\u7684\u6240\u6709\u4efb\u52a1\u8bbe\u7f6e enable \u6a21\u5f0f\uff0c\u8bf7\u5728play\u7ea7\u522b\u4e0a\u6dfb\u52a0 become - hosts : eos-switches become : yes become_method : enable tasks : - name : Gather facts (eos) eos_facts : gather_subset : - \"!hardware\" \u8bbe\u7f6e\u6240\u6709\u4efb\u52a1\u7684 enable \u6a21\u5f0f \u00b6 \u901a\u5e38\uff0c\u60a8\u5e0c\u671b\u6240\u6709play\u4e2d\u7684\u6240\u6709\u4efb\u52a1\u90fd\u4f7f\u7528\u7279\u6743\u6a21\u5f0f\u8fd0\u884c\uff0c\u8fd9\u6700\u597d\u901a\u8fc7\u4f7f\u7528\u7ec4\u53d8\u91cf\u6765\u5b9e\u73b0 ansible_connection : network_cli ansible_network_os : eos ansible_user : myuser ansible_become : yes ansible_become_method : enable enable\u6a21\u5f0f\u7684\u5bc6\u7801 \u00b6 \u5982\u679c\u9700\u8981\u5bc6\u7801\u624d\u80fd\u8fdb\u5165 enable \u6a21\u5f0f\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u4e4b\u4e00\u8fdb\u884c\u6307\u5b9a \u63d0\u4f9b --ask-become-pass \u547d\u4ee4\u884c\u9009\u9879 \u8bbe\u7f6e ansible_become_password \u8fde\u63a5\u53d8\u91cf authorize \u548c auth_pass \u00b6 ansible \u4f9d\u7136\u652f\u6301 connection: local \u8fde\u63a5\u4e0b\u7684 enable \u6a21\u5f0f - hosts : eos-switches ansible_connection : local tasks : - name : Gather facts (eos) eos_facts : gather_subset : - \"!hardware\" provider : authorize : yes auth_pass : \" {{ secret_auth_pass }}\" windows \u4f7f\u7528become \u00b6 \u4eceAnsible 2.3\u5f00\u59cb\uff0c\u53ef\u4ee5\u901a\u8fc7 runas \u65b9\u6cd5\u5728Windows\u4e3b\u673a\u4e0a\u4f7f\u7528 become \u3002\u5728Windows\u4e0a\u7684Become\u4f7f\u7528\u4e0e\u5728\u975eWindows\u4e3b\u673a\u4e0a\u76f8\u540c\u7684\u5e93\u5b58\u8bbe\u7f6e\u548c\u8c03\u7528\u53c2\u6570\uff0c\u56e0\u6b64\u8bbe\u7f6e\u548c\u53d8\u91cf\u540d\u4e0e\u672c\u6587\u6863\u4e2d\u5b9a\u4e49\u7684\u76f8\u540c\u3002 Windows\u4e2d\u7684\u8bb8\u591a\u4efb\u52a1\u9700\u8981\u7ba1\u7406\u6743\u9650\u624d\u80fd\u5b8c\u6210\u3002\u5f53\u4f7f\u7528runas become\u65b9\u6cd5\u65f6\uff0cAnsible\u5c06\u5c1d\u8bd5\u4f7f\u7528\u8fdc\u7a0b\u7528\u6237\u53ef\u7528\u7684\u5168\u90e8\u7279\u6743\u8fd0\u884c\u6a21\u5757\u3002\u5982\u679c\u672a\u80fd\u63d0\u5347\u7528\u6237\u4ee4\u724c\uff0c\u5219\u5728\u6267\u884c\u671f\u95f4\u5c06\u7ee7\u7eed\u4f7f\u7528\u6709\u9650\u7684\u4ee4\u724c\u3002 \u7528\u6237\u5fc5\u987b\u5177\u6709 SeDebugPrivilege \u624d\u80fd\u8fd0\u884c\u5177\u6709\u63d0\u5347\u7279\u6743\u7684\u6210\u4e3a\u8fdb\u7a0b\u3002\u8fd9\u4e2a\u7279\u6743\u9ed8\u8ba4\u5206\u914d\u7ed9\u7ba1\u7406\u5458\u3002\u5982\u679c\u8c03\u8bd5\u7279\u6743\u4e0d\u53ef\u7528\uff0c\u5219become\u8fdb\u7a0b\u5c06\u4f7f\u7528\u4e00\u7ec4\u6709\u9650\u7684\u7279\u6743\u548c\u7ec4\u8fd0\u884c\u3002 - win_whoami : become : yes \u5728\u8fd4\u56de\u7684 label.account_name \u4e2d\u4f53\u73b0\u4e86\u662f\u5426\u83b7\u53d6\u7279\u6743 Medium : Ansible\u672a\u80fd\u5f97\u5230\u63d0\u5347\u7684\u4ee4\u724c\uff0c\u5e76\u8fd0\u884c\u5728\u4e00\u4e2a\u6709\u9650\u7684\u4ee4\u724c\u3002 High : \u83b7\u5f97\u4e86\u63d0\u5347\u7684\u4ee4\u724c\uff0c\u5e76\u5728\u4efb\u52a1\u4e2d\u4f7f\u7528 System : NT AUTHORITY\\System \u5e10\u6237\u88ab\u4f7f\u7528\uff0c\u5e76\u4e14\u5177\u6709\u6700\u9ad8\u7ea7\u522b\u7684\u53ef\u7528\u7279\u6743\u3002 \u5982\u679c\u5728\u5927\u4e8e2.5\u7684Ansible\u7248\u672c\u4e0a\u8fd0\u884c\u6216\u6b63\u5e38\u7684runas\u5347\u7ea7\u8fc7\u7a0b\u5931\u8d25\uff0c\u53ef\u4ee5\u901a\u8fc7 \u5c06 become_user \u8bbe\u7f6e\u4e3a System \u4ee5\u4fbf\u62e5\u6709\u6700\u9ad8\u6743\u9650 \u4e3aWinRM\u8fde\u63a5\u7528\u6237\u6388\u4e88 SeTcbPrivilege \u6743\u9650\uff0c SeTcbPrivilege \u662f\u4e00\u79cd\u9ad8\u7ea7\u7279\u6743\uff0c\u5b83\u6388\u4e88\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u7684\u5b8c\u5168\u63a7\u5236\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u4efb\u52a1\u5728Windows\u4e3b\u673a\u4e0a\u8bbe\u7f6e\u6b64\u7279\u6743 - name : grant the ansible user the SeTcbPrivilege right win_user_right : name : SeTcbPrivilege users : '{{ansible_user}}' action : add \u5173\u95ed\u4e3b\u673a\u4e0a\u7684UAC\u5e76\u91cd\u542f\u4e3b\u673a, UAC\u662f\u4e00\u79cd\u5b89\u5168\u534f\u8bae\uff0c\u5b83\u88ab\u8bbe\u8ba1\u4e3a\u4f7f\u7528\u6700\u5c11\u7279\u6743\u539f\u5219\u8fd0\u884c\u5e10\u6237\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u4efb\u52a1\u6765\u5173\u95edUAC - name : turn UAC off win_regedit : path : HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system name : EnableLUA data : 0 type : dword state : present register : uac_result - name : reboot after disabling UAC win_reboot : when : uac_result is changed \u6388\u4e88 SeTcbPrivilege \u6216\u5173\u95edUAC\u53ef\u80fd\u4f1a\u5bfc\u81f4Windows\u5b89\u5168\u6f0f\u6d1e\uff0c\u5982\u679c\u91c7\u53d6\u4e86\u8fd9\u4e9b\u6b65\u9aa4\uff0c\u5e94\u8be5\u8c28\u614e\u5bf9\u5f85\u3002 LocalService\u8d26\u53f7 \u00b6 \u5728Ansible 2.5\u7248\u672c\u4e4b\u524d\uff0cbecome\u53ea\u80fd\u5728\u672c\u5730\u6216\u57df\u7528\u6237\u5e10\u6237\u7684Windows\u4e0a\u5de5\u4f5c\u3002\u5728\u8fd9\u4e9b\u65e7\u7248\u672c\u4e2d\uff0c\u50cf System \u6216 NetworkService \u8fd9\u6837\u7684\u672c\u5730\u670d\u52a1\u5e10\u6237\u4e0d\u80fd\u7528\u4f5c\u7528\u6237\u3002\u81eaAnsible 2.5\u53d1\u5e03\u4ee5\u6765\uff0c\u8fd9\u4e00\u9650\u5236\u5df2\u7ecf\u89e3\u9664\u3002\u53ef\u4ee5\u5728\u6210\u4e3a\u7528\u6237\u4e0b\u9762\u8bbe\u7f6e\u7684\u4e09\u4e2a\u670d\u52a1\u5e10\u6237\u662f System NetworkService LocalService \u7531\u4e8e\u672c\u5730\u670d\u52a1\u5e10\u6237\u6ca1\u6709\u5bc6\u7801\uff0c\u6240\u4ee5 ansible_become_password \u53c2\u6570\u4e0d\u662f\u5fc5\u9700\u7684\uff0c\u5982\u679c\u6307\u5b9a\u4e86\u8be5\u53c2\u6570\u4e5f\u4f1a\u88ab\u88ab\u5ffd\u7565\u3002 \u65e0\u9700\u4e3abecome\u8bbe\u7f6e\u5bc6\u7801 \u00b6 \u4eceAnsible 2.8\u5f00\u59cb\uff0cbecome\u53ef\u4ee5\u88ab\u7528\u6765\u6210\u4e3a\u4e00\u4e2aWindows\u672c\u5730\u6216\u57df\u5e10\u6237\uff0c\u800c\u4e0d\u9700\u8981\u8be5\u5e10\u6237\u7684\u5bc6\u7801\u3002\u8981\u4f7f\u6b64\u65b9\u6cd5\u5de5\u4f5c\uff0c\u5fc5\u987b\u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42 \u8be5\u8fde\u63a5\u7528\u6237\u62e5\u6709 SeDebugPrivilege \u6743\u9650 \u8be5\u8fde\u63a5\u7528\u6237\u5c5e\u4e8e BUILTIN\\Administrators \u7ec4 \u8be5\u8fde\u63a5\u7528\u6237\u62e5\u6709 SeBatchLogonRight \u6216 SeNetworkLogonRight \u7528\u6237\u6743\u9650 \u901a\u8fc7\u4e24\u79cd\u4e0d\u540c\u7684\u65b9\u6cd5\u4e4b\u4e00\u53ef\u4ee5\u4f7f\u7528\u4f7f\u7528\u65e0\u5bc6\u7801\u65b9\u5f0f\uff1a \u590d\u5236\u73b0\u6709\u7684\u767b\u5f55\u4f1a\u8bdd\u4ee4\u724c(\u5982\u679c\u5e10\u6237\u5df2\u7ecf\u767b\u5f55) \u4f7f\u7528S4U\u751f\u6210\u4ec5\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u6709\u6548\u7684\u767b\u5f55\u4ee4\u724c \u6ca1\u6709\u5bc6\u7801\u7684\u5e10\u6237 \u00b6 Ansible\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u6ca1\u6709\u5bc6\u7801\u7684Windows\u5e10\u6237(\u50cfGuest\u5e10\u6237)\u3002\u8981\u6210\u4e3a\u4e00\u4e2a\u6ca1\u6709\u5bc6\u7801\u7684\u5e10\u6237\uff0c\u5fc5\u987b\u8bbe\u7f6e ansible_become_password: '' \u3002 \u8981\u60f3\u5b9e\u73b0\u65e0\u5bc6\u7801\u767b\u5f55\uff0c\u8fd8\u9700\u8981\u5c06\u672c\u5730\u7b56\u7565\u5e10\u6237:\u5c06\u672c\u5730\u5e10\u6237\u4f7f\u7528\u7a7a\u767d\u5bc6\u7801\u9650\u5236\u4e3a\u4ec5\u7528\u4e8e\u63a7\u5236\u53f0\u767b\u5f55\u7981\u7528\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u7ec4\u7b56\u7565\u5bf9\u8c61(GPO)\u5b8c\u6210\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u53ef\u80fd\u7684\u4efb\u52a1\u5b8c\u6210 - name : allow blank password on become win_regedit : path : HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa name : LimitBlankPasswordUse data : 0 type : dword state : present become\u7684\u53c2\u6570 \u00b6 windows\u652f\u6301\u7684 ansible_become_flags \u6709\u4e24\u4e2a logon_type , logon_flags logon_type \u662f\u6307\u5b9a\u767b\u5f55\u64cd\u4f5c\u7c7b\u578b\uff0c\u6709\u4ee5\u4e0b\u53ef\u9009\u9879: interactive: \u9ed8\u8ba4\u767b\u5f55\u7c7b\u578b\u3002\u8be5\u6d41\u7a0b\u5c06\u5728\u4e0e\u672c\u5730\u8fd0\u884c\u6d41\u7a0b\u76f8\u540c\u7684\u4e0a\u4e0b\u6587\u4e2d\u8fd0\u884c\u3002\u8fd9\u7ed5\u8fc7\u4e86\u6240\u6709\u7684WinRM\u9650\u5236\uff0c\u662f\u63a8\u8350\u4f7f\u7528\u7684\u65b9\u6cd5\u3002 batch: \u5728\u7c7b\u4f3c\u4e8e\u8bbe\u7f6e\u4e86\u5bc6\u7801\u7684\u8c03\u5ea6\u4efb\u52a1\u7684\u6279\u5904\u7406\u4e0a\u4e0b\u6587\u4e2d\u8fd0\u884c\u8be5\u8fdb\u7a0b\u3002 new_credentials: \u5728\u4e0e\u8c03\u7528\u7528\u6237\u76f8\u540c\u7684\u51ed\u636e\u4e0b\u8fd0\u884c network: \u5728\u6ca1\u6709\u4efb\u4f55\u7f13\u5b58\u51ed\u636e\u7684\u7f51\u7edc\u4e0a\u4e0b\u6587\u4e2d\u8fd0\u884c\u8fdb\u7a0b\u3002 network_cleartext: \u4e0e\u7f51\u7edc\u767b\u5f55\u7c7b\u578b\u7c7b\u4f3c\uff0c\u4f46\u7f13\u5b58\u51ed\u636e\u4ee5\u4fbf\u5b83\u53ef\u4ee5\u8bbf\u95ee\u7f51\u7edc\u8d44\u6e90\u3002 logon_flags \u6307\u5b9a\u5728\u521b\u5efa\u65b0\u8fdb\u7a0b\u65f6\uff0cWindows\u5c06\u5982\u4f55\u8bb0\u5f55\u7528\u6237\u7684\u767b\u5f55\u3002 \u6709\u4ee5\u4e0b\u53ef\u9009\u9879: with_profile\uff1a \u9ed8\u8ba4\u503c\u3002 \u8be5\u8fc7\u7a0b\u4f1a\u5c06HKEY_USERS\u6ce8\u518c\u8868\u9879\u4e2d\u7684\u7528\u6237\u4e2a\u4eba\u8d44\u6599\u52a0\u8f7d\u5230HKEY_CURRENT_USER\u3002 netcredentials_only\uff1a \u8be5\u8fc7\u7a0b\u5c06\u4f7f\u7528\u4e0e\u8c03\u7528\u65b9\u76f8\u540c\u7684\u4ee4\u724c\uff0c\u4f46\u662f\u5728\u8bbf\u95ee\u8fdc\u7a0b\u8d44\u6e90\u65f6\u5c06\u4f7f\u7528begin_user\u548cbegin_password\u3002 \u4e00\u4e9b\u4f8b\u5b50 - name : copy a file from a fileshare with custom credentials win_copy : src : \\\\server\\share\\data\\file.txt dest : C:\\temp\\file.txt remote_src : yes vars : ansible_become : yes ansible_become_method : runas ansible_become_user : DOMAIN\\user ansible_become_password : Password01 ansible_become_flags : logon_type=new_credentials logon_flags=netcredentials_only - name : run a command under a batch logon win_whoami : become : yes become_flags : logon_type=batch - name : run a command and not load the user profile win_whomai : become : yes become_flags : logon_flags= \u9650\u5236 \u00b6 \u4ec5\u5f53\u4f7f\u7528Ansible 2.7\u6216\u66f4\u9ad8\u7248\u672c\u65f6\uff0c async \u548c become \u4efb\u52a1\u624d\u80fd\u5728Windows Server 2008\u30012008 R2\u548cWindows 7\u4e0a\u8fd0\u884c\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c become \u7528\u6237\u4f7f\u7528\u4ea4\u4e92\u5f0f\u4f1a\u8bdd\u767b\u5f55\uff0c\u56e0\u6b64\u5b83\u5fc5\u987b\u6709\u6743\u5728Windows\u4e3b\u673a\u4e0a\u8fdb\u884c\u767b\u5f55\u3002 \u5982\u679c\u5b83\u4e0d\u7ee7\u627fSeAllowLogOnLocally\u7279\u6743\u6216\u7ee7\u627fSeDenyLogOnLocally\u7279\u6743\uff0c\u5219\u63d0\u6743\u8fc7\u7a0b\u5c06\u5931\u8d25\u3002 \u6dfb\u52a0\u7279\u6743\u6216\u8bbe\u7f6elogon_type\u6807\u5fd7\u4ee5\u66f4\u6539\u4f7f\u7528\u7684\u767b\u5f55\u7c7b\u578b\u3002 \u5728Ansible version 2.3\u4e4b\u524d\uff0c\u53ea\u6709\u5f53 ansible_winrm_transport \u662fbasic\u6216credssp\u65f6\uff0cbecome\u624d\u80fd\u5de5\u4f5c\u3002\u8fd9\u4e2a\u9650\u5236\u5df2\u7ecf\u88ab\u89e3\u9664\uff0c\u81ea\u4ece2.4\u7248\u7684Ansible\u4e3a\u6240\u6709\u4e3b\u673a\u9664\u4e86Windows Server 2008(\u975eR2\u7248\u672c)\u3002 \u4e8c\u7ea7\u767b\u5f55\u670d\u52a1 seclogon \u5fc5\u987b\u8fd0\u884c\u624d\u80fd\u4f7f\u7528 ansible_become_method: runas \u5f02\u6b65\u64cd\u4f5c\u548c\u8f6e\u8be2 \u00b6 \u9ed8\u8ba4\u60c5\u51b5\u4e0bplaybook\u4e2d\u7684\u4efb\u52a1\u6267\u884c\u65f6\u4f1a\u4e00\u76f4\u4fdd\u6301\u8fde\u63a5,\u76f4\u5230\u8be5\u4efb\u52a1\u5728\u6bcf\u4e2a\u8282\u70b9\u90fd\u6267\u884c\u5b8c\u6bd5.\u6709\u65f6\u8fd9\u662f\u4e0d\u5fc5\u8981\u7684,\u6bd4\u5982\u6709\u4e9b\u64cd\u4f5c\u8fd0\u884c\u65f6\u95f4\u6bd4SSH\u8d85\u65f6\u65f6\u95f4\u8fd8\u8981\u957f.\u89e3\u51b3\u8be5\u95ee\u9898\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u662f\u5f02\u6b65\u6267\u884c\u5b83\u4eec,\u7136\u540e\u8f6e\u8be2\u76f4\u5230\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5. \u4f60\u4e5f\u53ef\u4ee5\u5bf9\u6267\u884c\u65f6\u95f4\u975e\u5e38\u957f\uff08\u6709\u53ef\u80fd\u906d\u9047\u8d85\u65f6\uff09\u7684\u64cd\u4f5c\u4f7f\u7528\u5f02\u6b65\u6a21\u5f0f. \u4e3a\u4e86\u5f02\u6b65\u542f\u52a8\u4e00\u4e2a\u4efb\u52a1,\u53ef\u4ee5\u6307\u5b9a\u5176\u6700\u5927\u8d85\u65f6\u65f6\u95f4\u4ee5\u53ca\u8f6e\u8be2\u5176\u72b6\u6001\u7684\u9891\u7387.\u5982\u679c\u4f60\u6ca1\u6709\u4e3a poll \u6307\u5b9a\u503c,\u90a3\u4e48\u9ed8\u8ba4\u7684\u8f6e\u8be2\u9891\u7387\u662f15\u79d2\u949f\u3002 \u4f8b\u5982\u4e0b\u9762\u7684palybook --- - hosts : 192.168.77.131 tasks : - shell : sleep 100 && hostname async : 100 poll : 0 register : result - debug : var=result - async_status : jid={{ result.ansible_job_id }} register : job_result until : job_result.finished retries : 30 poll\u6307\u5b9a\u4efb\u52a1\u7684\u8f6e\u8bad\u503c\uff0cpoll=0\u65f6\uff0c\u4efb\u52a1\u6267\u884c\u540e\uff0c\u4f1a\u7acb\u5373\u6267\u884c\u4e0b\u4e00\u6761\u4efb\u52a1\u3002poll>0\u65f6\uff0c\u4f1a\u963b\u585e\u4efb\u52a1\uff0c\u76f4\u5230\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\u6216\u8d85\u65f6\u3002\u6ca1\u6709\u8bbe\u7f6e\u7684\u65f6\u5019\uff0c\u53d6\u9ed8\u8ba4\u503c DEFAULT_POLL_INTERVAL \u7b2c\u4e00\u4e2a\u4efb\u52a1\uff0c\u6307\u5b9ashell\u4efb\u52a1\u4e3a\u5f02\u6b65\u6267\u884c\uff0c100\u79d2\u540e\u4efb\u52a1\u5931\u8d25\u3002 \u7b2c\u4e8c\u4e2a\u4efb\u52a1\uff0c\u83b7\u53d6\u5f02\u6b65\u4efb\u52a1\u7684\u8fd4\u56de\u503c\uff0c\u5176\u76ee\u7684\u662f\u83b7\u53d6jid\u3002 \u7b2c\u4e09\u4e2a\u4efb\u52a1\uff0c\u68c0\u67e5jid\u5f02\u6b65\u4efb\u52a1\u7684\u72b6\u6001\uff0c\u5f53\u5f02\u6b65\u4efb\u52a1\u7684finished\u4e0d\u4e3a0\u65f6\uff0c\u5f02\u6b65\u4efb\u52a1\u6267\u884c\u6210\u529f\u3002\u68c0\u67e5\u6b21\u6570\u4e3a30\u6b21\uff0c\u95f4\u96945\u79d2\u3002 \u8fd0\u884cplaybook\u7684\u7ed3\u679c\u4fe1\u606f # ansible-playbook asynctest.yml -vv ansible-playbook 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible-playbook python version = 2 .7.5 ( default, Aug 4 2017 , 00 :39:18 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-16 )] Using /etc/ansible/ansible.cfg as config file PLAYBOOK: asynctest.yaml ****************************************************************************************************************** 1 plays in asynctest.yaml PLAY [ 192 .168.77.131 ] ********************************************************************************************************************* TASK [ Gathering Facts ] ******************************************************************************************************************** task path: /etc/ansible/asynctest.yaml:2 ok: [ 192 .168.77.131 ] META: ran handlers TASK [ shell ] ****************************************************************************************************************************** task path: /etc/ansible/asynctest.yaml:5 changed: [ 192 .168.77.131 ] = > { \"ansible_job_id\" : \"965275577324.14846\" , \"changed\" : true, \"finished\" : 0 , \"results_file\" : \"/root/.ansible_async/965275577324.14846\" , \"started\" : 1 } TASK [ debug ] ****************************************************************************************************************************** task path: /etc/ansible/asynctest.yaml:9 ok: [ 192 .168.77.131 ] = > { \"result\" : { \"ansible_job_id\" : \"965275577324.14846\" , \"changed\" : true, \"failed\" : false, \"finished\" : 0 , \"results_file\" : \"/root/.ansible_async/965275577324.14846\" , \"started\" : 1 } } TASK [ async_status ] *********************************************************************************************************************** task path: /etc/ansible/asynctest.yaml:11 FAILED - RETRYING: async_status ( 30 retries left ) . FAILED - RETRYING: async_status ( 29 retries left ) . FAILED - RETRYING: async_status ( 28 retries left ) . FAILED - RETRYING: async_status ( 27 retries left ) . FAILED - RETRYING: async_status ( 26 retries left ) . FAILED - RETRYING: async_status ( 25 retries left ) . FAILED - RETRYING: async_status ( 24 retries left ) . FAILED - RETRYING: async_status ( 23 retries left ) . FAILED - RETRYING: async_status ( 22 retries left ) . FAILED - RETRYING: async_status ( 21 retries left ) . FAILED - RETRYING: async_status ( 20 retries left ) . FAILED - RETRYING: async_status ( 19 retries left ) . FAILED - RETRYING: async_status ( 18 retries left ) . FAILED - RETRYING: async_status ( 17 retries left ) . FAILED - RETRYING: async_status ( 16 retries left ) . FAILED - RETRYING: async_status ( 15 retries left ) . FAILED - RETRYING: async_status ( 14 retries left ) . FAILED - RETRYING: async_status ( 13 retries left ) . FAILED - RETRYING: async_status ( 12 retries left ) . FAILED - RETRYING: async_status ( 11 retries left ) . changed: [ 192 .168.77.131 ] = > { \"ansible_job_id\" : \"965275577324.14846\" , \"attempts\" : 21 , \"changed\" : true, \"cmd\" : \"sleep 100 && hostname\" , \"delta\" : \"0:01:40.069235\" , \"end\" : \"2020-04-03 21:59:52.442879\" , \"finished\" : 1 , \"rc\" : 0 , \"start\" : \"2020-04-03 21:58:12.373644\" , \"stderr\" : \"\" , \"stderr_lines\" : [] , \"stdout\" : \"node131\" , \"stdout_lines\" : [ \"node131\" ]} META: ran handlers META: ran handlers PLAY RECAP ******************************************************************************************************************************** 192 .168.77.131 : ok = 4 changed = 2 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u4f7f\u7528ansible\u6765\u6267\u884c\u5f02\u6b65 # ansible 192.168.77.131 -B 3600 -P 0 -o -m shell -a \"sleep 30\" -vv ansible 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible python version = 2 .7.5 ( default, Aug 4 2017 , 00 :39:18 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-16 )] Using /etc/ansible/ansible.cfg as config file META: ran handlers 192 .168.77.131 | CHANGED = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"ansible_job_id\" : \"71761724165.16525\" , \"changed\" : true, \"finished\" : 0 , \"results_file\" : \"/root/.ansible_async/71761724165.16525\" , \"started\" : 1 } META: ran handlers META: ran handlers \u4f7f\u7528 async_status \u6765\u83b7\u53d6\u5f02\u6b65\u72b6\u6001\u4fe1\u606f # ansible 192.168.77.131 -m async_status -a \"jid=71761724165.16525\" 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"ansible_job_id\" : \"71761724165.16525\" , \"changed\" : false, \"finished\" : 0 , \"started\" : 1 } # .... \u7b49\u5f85\u4efb\u52a1\u6267\u884c\u5b8c\u6210 # ansible 192.168.77.131 -m async_status -a \"jid=71761724165.16525\" 192 .168.77.131 | CHANGED = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"ansible_job_id\" : \"71761724165.16525\" , \"changed\" : true, \"cmd\" : \"sleep 30\" , \"delta\" : \"0:00:30.059717\" , \"end\" : \"2020-04-03 22:09:37.777453\" , \"finished\" : 1 , \"rc\" : 0 , \"start\" : \"2020-04-03 22:09:07.717736\" , \"stderr\" : \"\" , \"stderr_lines\" : [] , \"stdout\" : \"\" , \"stdout_lines\" : [] } \u6ce8\u610f\uff1a\u5728\u4f7f\u7528'command', 'win_command', 'shell', 'win_shell', 'raw'\u6a21\u5757\u65f6\uff0c\u662f\u4e0d\u4f1a\u8fd4\u56de\u4fe1\u606f\u7684\u3002 \u9650\u5236\u5e76\u53d1\u8fd0\u884c\u7684\u4efb\u52a1\u6570\u91cf\u7684\u540c\u65f6\u8fd0\u884c\u591a\u4e2a\u5f02\u6b65\u4efb\u52a1 ##################### # main.yml ##################### - name : Run items asynchronously in batch of two items vars : sleep_durations : - 1 - 2 - 3 - 4 - 5 durations : \"{{ item }}\" include_tasks : execute_batch.yml loop : \"{{ sleep_durations | batch(2) | list }}\" ##################### # execute_batch.yml ##################### - name : Async sleeping for batched_items command : sleep {{ async_item }} async : 45 poll : 0 loop : \"{{ durations }}\" loop_control : loop_var : \"async_item\" register : async_results - name : Check sync status async_status : jid : \"{{ async_result_item.ansible_job_id }}\" loop : \"{{ async_results.results }}\" loop_control : loop_var : \"async_result_item\" register : async_poll_results until : async_poll_results.finished retries : 30 \u4e00\u4e2a\u91cd\u542f\u670d\u52a1\u5668\u7684playbook --- - hosts : 192.168.77.131 gather_facts : no become : yes tasks : - name : Check the uptime prior reboot shell : uptime register : UPTIME_PRE_REBOOT - debug : msg={{UPTIME_PRE_REBOOT.stdout}} - name : Reboot node and stop polling. shell : reboot async : 10 # Do not care for 10 sec poll : 0 # Fire & Forget - name : wait for host to finish reboot wait_for : port : \"{{ (ansible_port|default(ansible_ssh_port))|default(22) }}\" host : '{{ (ansible_ssh_host|default(ansible_host))|default(inventory_hostname) }}' search_regex : OpenSSH delay : 10 # Do not check for at least 10 sec connection : local - name : Check the uptime post reboot shell : uptime register : UPTIME_POST_REBOOT - debug : msg={{UPTIME_POST_REBOOT.stdout}} \u5f02\u6b65\u4efb\u52a1\u7684\u72b6\u6001\u6587\u4ef6 \u00b6 \u5f02\u6b65\u4efb\u52a1\u7684\u72b6\u6001\u6587\u4ef6\u4ee5jid\u547d\u540d\u7684\u65b9\u5f0f\u5b58\u653e\u5728\u8fdc\u7aef\u4e3b\u673a\u7684\u7528\u6237\u76ee\u5f55\u4e0b\u7684.ansible_async\u76ee\u5f55\uff0c\u672c\u6b21\u4f7f\u7528\u7684\u662froot\u8fde\u63a5\u8fdc\u7aef\uff0c\u6240\u4ee5\u76ee\u5f55\u662f/root/.ansible_async\u3002 \u67e5\u770b\u72b6\u6001\u6587\u4ef6 # cat /root/.ansible_async/71761724165.16525 { \"started\" : 1 , \"finished\" : 0 , \"ansible_job_id\" : \"71761724165.16525\" } # \u4efb\u52a1\u7ed3\u675f\u540e # cat /root/.ansible_async/71761724165.16525 { \"changed\" : true, \"end\" : \"2020-04-03 22:09:37.777453\" , \"stdout\" : \"\" , \"cmd\" : \"sleep 30\" , \"start\" : \"2020-04-03 22:09:07.717736\" , \"delta\" : \"0:00:30.059717\" , \"stderr\" : \"\" , \"rc\" : 0 , \"invocation\" : { \"module_args\" : { \"warn\" : true, \"executable\" : null, \"_uses_shell\" : true, \"strip_empty_ends\" : true, \"_raw_params\" : \"sleep 30\" , \"removes\" : null, \"argv\" : null, \"creates\" : null, \"chdir\" : null, \"stdin_add_newline\" : true, \"stdin\" : null }}} \u5f02\u6b65\u4efb\u52a1\u7684\u8fd4\u56de\u503c \u00b6 { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" }, \"ansible_job_id\" : \"662217446295.16055\" , \"changed\" : true , \"finished\" : 0 , \"results_file\" : \"/root/.ansible_async/662217446295.16055\" , \"started\" : 1 } ansible_job_id \u5f02\u6b65\u4efb\u52a1id\uff0c results_file\u5f02\u6b65\u4efb\u52a1\u7684\u72b6\u6001\u6587\u4ef6 \u5f02\u6b65\u4efb\u52a1\u72b6\u6001\u7684\u8fd4\u56de\u503c \u00b6 \u53ef\u901a\u8fc7 async_status \u83b7\u53d6\uff0casync_status \u662f\u8bfb\u53d6\u8fdc\u7aef\u7684\u5f02\u6b65\u4efb\u52a1\u72b6\u6001\u6587\u4ef6\u6765\u83b7\u5f97\u4efb\u52a1\u72b6\u6001\uff0c\u5982\u679casync\u8bbe\u7f6e\u7684\u65f6\u95f4\u592a\u77ed\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u83b7\u53d6\u4e0d\u5230\u72b6\u6001\u6587\u4ef6\uff0c\u56e0\u4e3a\u8fd8\u6ca1\u751f\u6210\u8fd9\u4e2a\u6587\u4ef6\u3002 \u6267\u884c\u4e2d\u7684\u8fd4\u56de\u503c { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"ansible_job_id\" : \"71761724165.16525\" , \"changed\" : false, \"finished\" : 0 , \"started\" : 1 } \u6267\u884c\u5b8c\u6210\u540e\u7684\u8fd4\u56de\u503c { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"ansible_job_id\" : \"71761724165.16525\" , \"changed\" : true, \"cmd\" : \"sleep 30\" , \"delta\" : \"0:00:30.059717\" , \"end\" : \"2020-04-03 22:09:37.777453\" , \"finished\" : 1 , \"rc\" : 0 , \"start\" : \"2020-04-03 22:09:07.717736\" , \"stderr\" : \"\" , \"stderr_lines\" : [] , \"stdout\" : \"\" , \"stdout_lines\" : [] } \u68c0\u67e5\u6a21\u5f0f \u00b6 \u5f53ansible-playbook\u6267\u884c\u65f6\u52a0\u4e0a --check \u9009\u9879\u65f6\uff0c\u5b83\u4e0d\u4f1a\u5bf9\u8fdc\u7a0b\u7cfb\u7edf\u505a\u4efb\u4f55\u66f4\u6539\u3002\u652f\u6301\u68c0\u67e5\u6a21\u5f0f\u7684\u6a21\u5757\u5c06\u62a5\u544a\u5b83\u4eec\u5c06\u8fdb\u884c\u7684\u66f4\u6539\uff0c\u800c\u4e0d\u662f\u8fdb\u884c\u66f4\u6539\u3002\u4e0d\u652f\u6301\u68c0\u67e5\u6a21\u5f0f\u7684\u5176\u4ed6\u6a21\u5757\u4e5f\u5c06\u4e0d\u91c7\u53d6\u4efb\u4f55\u64cd\u4f5c\uff0c\u53ea\u662f\u4e0d\u62a5\u544a\u5b83\u4eec\u53ef\u80fd\u505a\u4e86\u54ea\u4e9b\u66f4\u6539\u3002 \u6267\u884c\u4f8b\u5b50 ansible-playbook foo.yml --check \u4e5f\u53ef\u4ee5\u5728\u4efb\u52a1\u4e2d\u4f7f\u7528\u68c0\u67e5\u6a21\u5f0f tasks : - name : this task will make changes to the system even in check mode command : /something/to/run --even-in-check-mode check_mode : no - name : this task will always run under checkmode and not change the system lineinfile : line : \"important config\" dest : /path/to/myconfig.conf state : present check_mode : yes ansible_check_mode \u53d8\u91cf\u662f\u7528\u6765\u5b58\u50a8\u5f53\u524d\u662f\u5426\u662f\u68c0\u67e5\u6a21\u5f0f\u7684\u5e03\u5c14\u7c7b\u578b tasks : - name : this task will be skipped in check mode git : repo : ssh://git@github.com/mylogin/hello.git dest : /home/mylogin/hello when : not ansible_check_mode - name : this task will ignore errors in check mode git : repo : ssh://git@github.com/mylogin/hello.git dest : /home/mylogin/hello ignore_errors : \"{{ ansible_check_mode }}\" diff\u6a21\u5757 ansible-playbook\u7684 --diff \u9009\u9879\u53ef\u4e0e --check \u914d\u5408\u4f7f\u7528\uff08\u5982\u4e0a\u8be6\u8ff0\uff09\uff0c\u4f46\u4e5f\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\u3002 \u63d0\u4f9b\u6b64\u6807\u5fd7\u4e14\u6a21\u5757\u652f\u6301\u6b64\u6807\u5fd7\u65f6\uff0cAnsible\u5c06\u62a5\u544a\u6240\u505a\u7684\u66f4\u6539\uff0c\u6216\u8005\u5982\u679c\u4e0e --check \u4e00\u8d77\u4f7f\u7528\uff0c\u5219\u5c06\u62a5\u544a\u6240\u505a\u7684\u66f4\u6539\u3002 - hosts : localhost tasks : - name : debug. debug : msg=123 check_mode : no - name : add hosts. lineinfile : line : \"127.0.0.2 localhost\" dest : /etc/hosts state : present check_mode : yes - name : add hosts. lineinfile : line : \"127.0.0.2 localhost\" dest : /etc/hosts state : present diff : no diff: no \u7981\u6b62\u5bf9\u6bd4 \u68c0\u67e5\u5e76\u5bf9\u6bd4\u66f4\u6539 ansible-playbook foo.yml --check --diff debug \u529f\u80fd \u00b6 Ansible\u628a\u4e00\u4e2a debugger \u4f5c\u4e3a strategy \u63d2\u4ef6\u7684\u4e00\u90e8\u5206\u3002\u6b64\u8c03\u8bd5\u5668\u4f7f\u60a8\u80fd\u591f\u4f5c\u4e3a\u4efb\u52a1\u8fdb\u884c\u8c03\u8bd5\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u963b\u585e\u8fd0\u884c\u7684\u3002\u4f46\u4f7f\u7528 debug \u6a21\u5757\u4e5f\u53ef\u4ee5\u8c03\u8bd5\u53d8\u91cf\u6216\u8868\u8fbe\u5f0f\uff0c\u800c\u4e0d\u5fc5\u963b\u585eplaybook\u3002 \u6709\u591a\u79cd\u4f7f\u7528\u8c03\u8bd5\u5668\u7684\u65b9\u6cd5\u3002 \u4f7f\u7528 debugger \u5173\u952e\u5b57 \u00b6 debugger\u63d0\u4f9b\u51e0\u4e2a\u503c \u53ef\u9009\u503c \u8bf4\u660e always \u603b\u662f\u8c03\u7528\u8c03\u8bd5\u5668\uff0c\u800c\u4e0d\u7ba1\u7ed3\u679c\u5982\u4f55 never \u4e0d\u7ba1\u7ed3\u679c\u5982\u4f55\uff0c\u90fd\u4e0d\u8981\u8c03\u7528\u8c03\u8bd5\u5668 on_failed \u53ea\u6709\u5728\u4efb\u52a1\u5931\u8d25\u65f6\u624d\u8c03\u7528\u8c03\u8bd5\u5668 on_unreachable \u53ea\u6709\u5728\u4e3b\u673a\u65e0\u6cd5\u8bbf\u95ee\u65f6\u624d\u8c03\u7528\u8c03\u8bd5\u5668 on_skipped \u53ea\u6709\u5728\u4efb\u52a1\u88ab\u8df3\u8fc7\u65f6\u624d\u8c03\u7528\u8c03\u8bd5\u5668 \u5728play\u4e2d\u4f7f\u7528 - name : Play hosts : all debugger : on_skipped tasks : - name : Execute a command command : true when : False \u5728task\u4e2d\u4f7f\u7528 - name : Execute a command command : false debugger : on_failed \u5f53play\u548ctask\u540c\u65f6\u4f7f\u7528 debugger \u65f6\uff0ctask\u7684\u751f\u6548 - name : Play hosts : all debugger : never tasks : - name : Execute a command command : false debugger : on_failed \u914d\u7f6e\u6216\u73af\u5883\u53d8\u91cf \u00b6 \u5728 ansible.cfg \u4e0a\u914d\u7f6e [defaults] enable_task_debugger = True \u6216\u8005\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf ANSIBLE_ENABLE_TASK_DEBUGGER = True ansible-playbook -i hosts site.yml \u4f7f\u7528 strategy \u63d2\u4ef6 \u00b6 \u4f7f\u7528 strategy \u63d2\u4ef6 debug - hosts : test strategy : debug tasks : ... \u6216\u8005\u4fee\u6539\u914d\u7f6e\u548c\u73af\u5883\u53d8\u91cf [defaults] strategy = debug \u73af\u5883\u53d8\u91cf ANSIBLE_STRATEGY = debug \u8c03\u8bd5 debugger \u00b6 \u4f7f\u7528\u4ee5\u4e0b\u4f8b\u5b50 - hosts : 192.168.77.131 debugger : on_failed gather_facts : no vars : var1 : value1 tasks : - name : wrong variable ping : data={{ wrong_var }} \u4ee5\u4e0aplaybook\uff0c\u5728\u6267\u884c\u5230\u9519\u8bef\u7684\u4efb\u52a1\u65f6\uff0c\u4f1a\u8fdb\u5165debug\u6a21\u5f0f\u4e0b # ansible-playbook debuger.yaml PLAY [ 192 .168.77.131 ] ***************************************************************************************** TASK [ wrong variable ] ***************************************************************************************** fatal: [ 192 .168.77.131 ] : FAILED! = > { \"msg\" : \"The task includes an option with an undefined variable. The error was: 'wrong_var' is undefined\\n\\nThe error appears to be in '/etc/ansible/debuger.yaml': line 7, column 7, but may\\nbe elsewhere in the file depending on the exact syntax problem.\\n\\nThe offending line appears to be:\\n\\n tasks:\\n - name: wrong variable\\n ^ here\\n\" } [ 192 .168.77.131 ] TASK: wrong variable ( debug ) > p result._result { '_ansible_no_log' : False, 'failed' : True, 'msg' : u \"The task includes an option with an undefined variable. The error was: 'wrong_var' is undefined\\n\\nThe error appears to be in '/etc/ansible/debuger.yaml': line 7, column 7, but may\\nbe elsewhere in the file depending on the exact syntax problem.\\n\\nThe offending line appears to be:\\n\\n tasks:\\n - name: wrong variable\\n ^ here\\n\" } [ 192 .168.77.131 ] TASK: wrong variable ( debug ) > p task.args { u 'data' : u '{{ wrong_var }}' } [ 192 .168.77.131 ] TASK: wrong variable ( debug ) > task.args [ 'data' ] = '{{ var1 }}' [ 192 .168.77.131 ] TASK: wrong variable ( debug ) > p task.args { u 'data' : '{{ var1 }}' } [ 192 .168.77.131 ] TASK: wrong variable ( debug ) > redo ok: [ 192 .168.77.131 ] PLAY RECAP ***************************************************************************************** 192 .168.77.131 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u901a\u8fc7\u8c03\u8bd5\uff0c\u6211\u4eec\u4f7fplaybook\u4ee5\u6210\u529f\u8fd0\u884c\u5b8c\u6bd5\u3002 debugger \u6a21\u5f0f\u4e0b\u7684\u53ef\u7528\u6307\u4ee4 \u6307\u4ee4 \u8bf4\u660e p \u663e\u793a\u6b64\u6b21\u5931\u8d25\u7684\u539f\u56e0 p task \u663e\u793a\u6b64\u6b21\u4efb\u52a1\u7684\u540d\u79f0 p task.args \u663e\u793a\u6a21\u5757\u7684\u53c2\u6570 p task_vars \u663e\u793a\u4efb\u52a1\u7684\u53ef\u7528\u53d8\u91cf p host \u663e\u793a\u6267\u884c\u6b64\u6b21\u4efb\u52a1\u7684\u4e3b\u673a p result \u663e\u793a\u6b64\u6b21\u4efb\u52a1\u7684\u7ed3\u679c p vars \u663e\u793a\u5f53\u524d\u7684\u53d8\u91cf vars[key] = value \u66f4\u65b0vars\u4e2d\u7684\u503c task.args[key] = value \u66f4\u65b0\u6a21\u5757\u7684\u53c2\u6570\u3002 u(pdate_task) \u4ece\u539f\u59cb\u4efb\u52a1\u6570\u636e\u7ed3\u6784\u548c\u5e26\u6709\u66f4\u65b0\u7684task_vars\u7684\u6a21\u677f\u4e2d\u91cd\u65b0\u521b\u5efa\u4efb\u52a1 r(edo) \u518d\u6b21\u6267\u884c\u6b64\u4efb\u52a1 c(ontinue) \u7ee7\u7eed\u6267\u884c q(uit) \u9000\u51fadebug\u6a21\u5f0f \u4e0e free \u7b56\u7565\u4e00\u8d77\u4f7f\u7528 \u00b6 \u5f53 debugger \u4e0e free \u7b56\u7565\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u5728\u8c03\u8bd5\u5668\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u65f6\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u5176\u4ed6\u4efb\u52a1\u6392\u961f\u6216\u6267\u884c\u3002\u4f46\u4f7f\u7528 redo \u65f6\uff0c\u53ef\u80fd\u56de\u5bfc\u81f4\u5f53\u524d\u4efb\u52a1\u5728\u5176\u4ed6\u4efb\u52a1\u4e4b\u540e\u6267\u884c \u4f7f\u7528 debug \u6a21\u5757 \u00b6 \u5728\u6267\u884c\u671f\u95f4\u6253\u5370\u8bed\u53e5\uff0c\u4f7f\u7528 debug \u6a21\u5757\u53ef\u4ee5\u8c03\u8bd5\u53d8\u91cf\u6216\u8868\u8fbe\u5f0f\uff0c\u800c\u4e0d\u5fc5\u963b\u585eplaybook\u3002 \u6253\u5370\u81ea\u5b9a\u4e49\u7684\u4fe1\u606f tasks : - debug : msg=\"System {{ inventory_hostname }} has uuid {{ ansible_product_uuid }}\" \u8c03\u8bd5\u53d8\u91cf tasks : - debug : var=result verbosity=2 \u6eda\u52a8\u6267\u884c \u00b6 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAnsible\u4f1a\u5e76\u884c\u5730\u7ba1\u7406\u4e00\u4e2a\u5267\u672c\u4e2d\u5f15\u7528\u7684\u6240\u6709\u673a\u5668\u3002\u5bf9\u4e8e\u6eda\u52a8\u66f4\u65b0\u7528\u4f8b\uff0c\u53ef\u4ee5\u4f7f\u7528 serial \u5173\u952e\u5b57\u5b9a\u4e49Ansible\u5e76\u884c\u6267\u884c\u591a\u5c11\u53f0\u4e3b\u673a --- - name : test play hosts : webservers serial : 3 gather_facts : False tasks : - name : task one command : hostname - name : task two command : hostname \u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u6709100\u4e2a\u4e3b\u673a\uff0c\u7ec4\u201cwebservers\u201d\u4e2d\u76843\u4e2a\u4e3b\u673a\u5c06\u5b8c\u6210playbook\uff0c\u7136\u540e\u518d\u79fb\u52a8\u5230\u63a5\u4e0b\u6765\u76843\u4e2a\u4e3b\u673a\u3002 \u8fd8\u53ef\u4ee5\u4f7f\u7528\u767e\u5206\u6bd4 serial : \"30%\" \u4eceAnsible 2.2\u5f00\u59cb\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u5217\u8868\u4f5c\u4e3a\u6279\u91cf\u6267\u884c\u7684\u4f9d\u636e --- - name : test play hosts : webservers serial : - 1 - 5 - 10 \u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u7b2c\u4e00\u6279\u6267\u884c\u5c06\u5305\u542b\u4e00\u4e2a\u4e3b\u673a\uff0c\u4e0b\u4e00\u6279\u5c06\u5305\u542b5\u4e2a\u4e3b\u673a\uff0c\u5e76\u4e14(\u5982\u679c\u8fd8\u5269\u4e0b\u4efb\u4f55\u4e3b\u673a)\uff0c\u63a5\u4e0b\u6765\u7684\u6bcf\u4e00\u6279\u5c06\u5305\u542b10\u4e2a\u4e3b\u673a\uff0c\u76f4\u5230\u6240\u6709\u53ef\u7528\u7684\u4e3b\u673a\u90fd\u88ab\u4f7f\u7528\u3002 \u53ef\u4ee5\u5728\u5217\u8868\u4e2d\u4f7f\u7528\u767e\u5206\u6bd4 --- - name : test play hosts : webservers serial : - \"10%\" - \"20%\" - \"100%\" \u4e5f\u53ef\u4ee5\u6df7\u5408\u4f7f\u7528 --- - name : test play hosts : webservers serial : - 1 - 5 - \"20%\" \u6307\u5b9a\u6700\u5927\u5931\u8d25\u6570\u76ee \u00b6 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53ea\u8981\u7ec4\u4e2d\u6709\u5c1a\u672a\u5931\u8d25\u7684\u4e3b\u673a\uff0cAnsible\u5c06\u7ee7\u7eed\u6267\u884c\u64cd\u4f5c\u3002 \u5728\u4e00\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f8b\u5982\u5229\u7528\u4e0a\u8ff0\u6eda\u52a8\u66f4\u65b0\uff0c\u53ef\u80fd\u5e0c\u671b\u5728\u8fbe\u5230\u5931\u8d25\u7684\u7279\u5b9a\u9608\u503c\u65f6\u4e2d\u6b62\u4efb\u52a1\u3002 --- - hosts : webservers max_fail_percentage : 30 serial : 10 \u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u5982\u679c\u7ec4\u4e2d\u768410\u53f0\u670d\u52a1\u5668\u4e2d\u67093\u53f0\u4ee5\u4e0a\u53d1\u751f\u6545\u969c\uff0c\u5219\u5c06\u7ec8\u6b62\u5176\u4f59\u7684\u64cd\u4f5c\u3002 \u59d4\u6258 \u00b6 \u5728\u4efb\u52a1\u4e0a\u4f7f\u7528 delegate_to \u5173\u952e\u5b57,\u53ef\u4ee5\u5c06\u4efb\u52a1\u59d4\u6258\u7ed9\u6307\u5b9a\u4e3b\u673a\u53bb\u6267\u884c\u3002 --- - hosts : webservers serial : 5 tasks : - name : take out of load balancer pool command : /usr/bin/take_out_of_pool {{ inventory_hostname }} delegate_to : 127.0.0.1 - name : actual steps would go here yum : name : acme-web-stack state : latest - name : add back to load balancer pool command : /usr/bin/add_back_to_pool {{ inventory_hostname }} delegate_to : 127.0.0.1 delegate_to: 127.0.0.1 \u662f\u5c06\u4efb\u52a1\u59d4\u6d3e\u5230ansible\u672c\u5730\u53bb\u6267\u884c\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u7b80\u5199\u7684 local_action \u53bb\u6267\u884c --- # ... tasks : - name : take out of load balancer pool local_action : command /usr/bin/take_out_of_pool {{ inventory_hostname }} # ... - name : add back to load balancer pool local_action : command /usr/bin/add_back_to_pool {{ inventory_hostname }} \u4e00\u4e2a\u4f8b\u5b50 - hosts : db_servers tasks : - name : ifconfig command : fconfig delegate_to : 127.0.0.1 - name : ifconfig local_action : command ifconfig - hosts : app_servers tasks : - name : gather facts from db servers setup : delegate_to : \"{{item}}\" delegate_facts : True with_items : \"{{groups['dbservers']}}\" delegate_facts \u6307\u5b9a\u6536\u96c6\u59d4\u6258\u4e3b\u673a\u7684facts\u6570\u636e \u4ee5\u4e0a\u5c06\u4e3a dbservers \u7ec4\u4e2d\u7684\u673a\u5668\u6536\u96c6 facts \uff0c\u5e76\u5c06 facts \u5206\u914d\u7ed9\u8fd9\u4e9b\u673a\u5668\uff0c\u800c\u4e0d\u662f app_servers \u3002 \u4efb\u52a1\u53ea\u8fd0\u884c\u4e00\u6b21 \u00b6 \u901a\u8fc7\u5728\u4efb\u52a1\u4e0a\u914d\u7f6e run_once \u6765\u5b9e\u73b0\u5f53\u524d\u4efb\u52a1\u5728 play \u4e2d\u53ea\u6267\u884c\u4e00\u6b21 - tasks : - command : ifconfig run_once : true \u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u5c06\u53ea\u4f1a\u5728\u7b2c\u4e00\u4e2a\u6267\u884c\u4e3b\u673a\u4e0a\u6267\u884c\uff0c\u5176\u4f59\u7684\u4e3b\u673a\u5219\u4e0d\u6267\u884c\u3002 \u6709\u70b9\u7c7b\u4f3c\u4e8e\u4f7f\u7528when\u6761\u4ef6\u5224\u65ad - command : /opt/application/upgrade_db.py when : inventory_hostname == webservers[0] \u672c\u5730\u6267\u884c \u00b6 \u4e3aplaybook\u6307\u5b9a connection=local \u5c06\u4f1a\u4f7f\u4efb\u52a1\u5728\u672c\u5730\u6267\u884c\uff0c\u800c\u4e0d\u662f\u4f7f\u7528ssh\u8fde\u63a5\u8fdc\u7aef\u3002 \u6267\u884cplaybook ansible-playbook playbook.yml --connection = local \u5728play\u4e2d\u6307\u5b9a --- - hosts : 127.0.0.1 connection : local \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf \u00b6 \u4e3a\u8fd0\u884c\u7a0b\u5e8f\u6307\u5b9a\u73af\u5883\u53d8\u91cf\uff0c\u9700\u6307\u5b9a environment \u5173\u952e\u5b57 - tasks : - apt : name=cobbler state=installed environment : http_proxy : http://proxy.example.com:8080 PATH : /var/local/nvm/versions/node/v4.2.1/bin:{{ ansible_env.PATH }} \u4e5f\u53ef\u4ee5\u5728play\u7ea7\u522b\u4f7f\u7528 - hosts : testhost roles : - php - nginx environment : http_proxy : http://proxy.example.com:8080 \u9519\u8bef\u5904\u7406 \u00b6 \u5ffd\u7565\u9519\u8bef \u00b6 ignore_errors \u6a21\u5757\u53ef\u4ee5\u5728\u4efb\u52a1\u6267\u884c\u9519\u8bef\u65f6\uff0c\u5ffd\u7565\u9519\u8bef\u5e76\u7ee7\u7eed\u6267\u884c\u4efb\u52a1\u3002 - tasks : - command : /bin/false ignore_errors : true - debug : msg=\"false\" \u91cd\u7f6e\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a \u00b6 \u8fde\u63a5\u8fdc\u7aef\u4e3b\u673a\u5931\u8d25\u65f6\uff0cansible\u4f1a\u5c06\u4e3b\u673a\u8bbe\u7f6e\u4e3a\u4e0d\u53ef\u5230\u8fbe\uff0c\u8fd9\u5c06\u4ece\u8fd0\u884c\u7684\u6d3b\u52a8\u4e3b\u673a\u5217\u8868\u4e2d\u5220\u9664\u5b83\u4eec\u3002\u8981\u4ece\u8fd9\u4e9b\u95ee\u9898\u4e2d\u6062\u590d\uff0c\u9700\u6267\u884c\u4e0b\u5217\u52a8\u4f5c\u6062\u590d\u4e3b\u673a\u3002 - meta : clear_host_errors \u5373\u4f7f\u4efb\u52a1\u5931\u8d25\uff0chandlers\u4e5f\u6267\u884c \u00b6 \u4ee5\u4e0b3\u4e2d\u65b9\u6cd5\u5747\u53ef\u4f7f\u7528 \u547d\u4ee4\u884c\u52a0\u4e0a --force-handlers \u53c2\u6570 \u914d\u7f6e\u6587\u4ef6\u52a0\u4e0a force_handlers = True playbook\u91cc\u8bbe\u7f6e force_handlers: True \u63a7\u5236\u4efb\u52a1\u5931\u8d25 \u00b6 \u4f7f\u7528 failed_when \u9009\u9879\u65f6\uff0c\u5f53\u6761\u4ef6\u4e3a\u771f\u65f6\uff0c\u53ef\u4f7f\u5f53\u524d\u4efb\u52a1\u4ee5\u5931\u8d25\u8fd4\u56de \u60a8\u53ef\u4ee5\u901a\u8fc7\u5728\u547d\u4ee4\u7684\u8f93\u51fa\u4e2d\u641c\u7d22\u4e00\u4e2a\u5355\u8bcd\u6216\u77ed\u8bed\u6765\u68c0\u67e5\u662f\u5426\u547d\u4ee4\u6267\u884c\u662f\u5426\u5931\u8d25 - name : Fail task when the command error output prints FAILED command : /usr/bin/example-command -x -y -z register : command_result failed_when : \"'FAILED' in command_result.stderr\" \u6216\u8005\u6839\u636e\u8fd4\u56de\u503c - name : Fail task when both files are identical raw : diff foo/file1 bar/file2 register : diff_cmd failed_when : diff_cmd.rc == 0 or diff_cmd.rc >= 2 \u5728\u4ee5\u524d\u7684\u7248\u672c\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u5b8c\u6210\u4e0a\u8ff0\u64cd\u4f5c - name : this command prints FAILED when it fails command : /usr/bin/example-command -x -y -z register : command_result ignore_errors : True - name : fail the play if the previous command did not succeed fail : msg : \"the command failed\" when : \"'FAILED' in command_result.stderr\" \u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u5e76\u884c\u6761\u4ef6\uff0c\u8fd9\u4e9b\u6761\u4ef6\u4e4b\u95f4\u662f and \u5173\u7cfb - name : Check if a file exists in temp and fail task if it does command : ls /tmp/this_should_not_be_here register : result failed_when : - result.rc == 0 - '\"No such\" not in result.stdout' \u4f7f\u7528 or \u6761\u4ef6 failed_when : result.rc == 0 or \"No such\" not in result.stdout \u5982\u679c\u4e00\u884c\u5199\u4e0d\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u591a\u884c\u8868\u793a - name : example of many failed_when conditions with OR shell : \"./myBinary\" register : ret failed_when : > (\"No such file or directory\" in ret.stdout) or (ret.stderr != '') or (ret.rc == 10) \u66f4\u6539\u4efb\u52a1changed\u72b6\u6001 \u00b6 \u6307\u5b9a changed_when \u6761\u4ef6\u65f6\uff0c\u5f53\u6761\u4ef6\u4e3a\u771f\uff0c\u4efb\u52a1\u7684 changed \u4e3a\u771f\uff0c\u5373\u8868\u793a\u5f53\u524d\u4efb\u52a1\u505a\u4e86\u66f4\u6539\u3002 tasks : - shell : /usr/bin/billybass --mode=\"take me to the river\" register : bass_result changed_when : \"bass_result.rc != 2\" # this will never report 'changed' status - shell : wall 'beep' changed_when : False \u4f7f\u7528\u591a\u4e2a\u6761\u4ef6 - command : /bin/fake_command register : result ignore_errors : True changed_when : - '\"ERROR\" in result.stderr' - result.rc == 2 \u51fa\u73b0\u9519\u8bef\u65f6\u7acb\u5373\u4e2d\u65ad\u6267\u884c \u00b6 \u4f7f\u7528 any_errors_fatal \u9009\u9879\u65f6\uff0c\u53ea\u8981playbook\u4e2d\u51fa\u73b0\u4e00\u4e2a\u9519\u8bef\u4efb\u52a1,ansible\u7acb\u5373\u505c\u6b62\u8fd0\u884c\u3002\u5df2\u4fdd\u8bc1\u6240\u6709\u4efb\u52a1\u7684\u6b63\u786e\u8fd0\u884c\u3002 --- - hosts : load_balancers_dc_a any_errors_fatal : True tasks : - name : 'shutting down datacenter [ A ]' command : /usr/bin/disable-dc - hosts : frontends_dc_a tasks : - name : 'stopping service' command : /usr/bin/stop-software - name : 'updating software' command : /usr/bin/upgrade-software - hosts : load_balancers_dc_a tasks : - name : 'Starting datacenter [ A ]' command : /usr/bin/enable-dc \u4f7f\u7528blocks \u00b6 \u4f7f\u7528 blocks \u7684 rescue \u6765\u5b9e\u73b0\u5bf9\u9519\u8bef\u4efb\u52a1\u7684\u5904\u7406 tasks : - name : Handle the error block : - debug : msg : 'I execute normally' - name : i force a failure command : /bin/false - debug : msg : 'I never execute, due to the above task failing, :-(' rescue : - debug : msg : 'I caught an error, can do stuff here to fix it, :-)' YAML \u8bed\u6cd5 \u00b6 YAML \u8bed\u6cd5\u89c1 \u8be6\u7ec6\u4ecb\u7ecd Prompts\uff1a \u8fd0\u884c\u65f6\uff0c\u63d0\u793a\u8f93\u5165\u5185\u5bb9 \u00b6 \u5728\u8fd0\u884cplaybook\u65f6\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u63d0\u793a\u7528\u6237\u8f93\u5165\u67d0\u4e9b\u5185\u5bb9\uff0c\u53ef\u4ee5\u901a\u8fc7 vars_prompt \u5b9e\u73b0\u8fd9\u4e00\u70b9\u3002 - hosts : test gather_facts : no vars_prompt : - name : \"name\" prompt : \"what is your name?\" default : \"user\" private : yes confirm : yes tasks : - debug : msg={{ name }} vars_prompt \u7684\u53c2\u6570 name: \u5b9a\u4e49\u53d8\u91cf\u540d\u79f0\uff0c\u5373\u8f93\u5165\u7684\u5185\u5bb9\u8d4b\u503c\u7ed9\u6b64\u53d8\u91cf prompt\uff1a\u8f93\u5165\u5f97\u63d0\u793a\u4fe1\u606f default\uff1a \u8f93\u5165\u7684\u9ed8\u8ba4\u503c\uff0c\u6ca1\u6709\u8f93\u5165\u4efb\u4f55\u5185\u5bb9\u7684\u65f6\u5019\uff0c\u628a\u6b64\u503c\u8d4b\u503c\u7ed9\u53d8\u91cf private\uff1a\u662f\u5426\u9690\u85cf\u8f93\u5165\u5f97\u5185\u5bb9 confirm\uff1a\u662f\u5426\u8981\u518d\u6b21\u786e\u8ba4\u8f93\u5165 unsafe: \u4e0d\u6821\u9a8c\u8f93\u5165\u7684\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u8f93\u5165\u7279\u6b8a\u5b57\u7b26\uff0c\u53ef\u5f00\u542f\u6b64\u9009\u9879 \u5982\u679c\u5b89\u88c5\u4e86 Passlib , vars_prompt \u8fd8\u53ef\u4ee5\u5bf9\u8f93\u5165\u7684\u503c\u8fdb\u884c\u52a0\u5bc6 - hosts : test gather_facts : no vars_prompt : - name : \"pass\" prompt : \"Enter password2\" private : yes encrypt : \"sha512_crypt\" confirm : yes salt_size : 7 tasks : - debug : msg={{ pass }} \u53ef\u4ee5\u4f7f\u7528\u7684\u52a0\u5bc6\u65b9\u6848 des_crypt - DES Crypt bsdi_crypt - BSDi Crypt bigcrypt - BigCrypt crypt16 - Crypt16 md5_crypt - MD5 Crypt bcrypt - BCrypt sha1_crypt - SHA-1 Crypt sun_md5_crypt - Sun MD5 Crypt sha256_crypt - SHA-256 Crypt sha512_crypt - SHA-512 Crypt apr_md5_crypt - Apache\u2019s MD5-Crypt variant phpass - PHPass\u2019 Portable Hash pbkdf2_digest - Generic PBKDF2 Hashes cta_pbkdf2_sha1 - Cryptacular\u2019s PBKDF2 hash dlitz_pbkdf2_sha1 - Dwayne Litzenberger\u2019s PBKDF2 hash scram - SCRAM Hash bsd_nthash - FreeBSD\u2019s MCF-compatible nthash encoding \u6807\u8bb0 \u00b6 \u5982\u679c\u4f60\u6709\u4e00\u4e2a\u5927\u578b\u5267\u672c\uff0c\u4f46\u4f60\u53ea\u5e0c\u671b\u8fd0\u884c\u5b83\u7684\u4e00\u4e2a\u7279\u5b9a\u7684\u90e8\u5206\uff0c\u800c\u4e0d\u662f\u8fd0\u884c\u5267\u672c\u4e2d\u7684\u6240\u6709\u4efb\u52a1\u3002\u8fd9\u65f6\u5019\uff0c\u4f60\u53ef\u4ee5\u4e3a\u8fd0\u884c\u7684\u4efb\u52a1\u6307\u5b9a\u4e00\u4e2a\u5171\u540c\u7684 tags \u6807\u8bb0\u4efb\u52a1 \u00b6 tasks : - yum : name : - httpd - memcached state : present tags : - packages - template : src : templates/src.j2 dest : /etc/foo.conf tags : - configuration \u6807\u7b7e\u540d\u79f0\u53ef\u4ee5\u91cd\u540d \u663e\u793aplaybook\u4e2d\u7684\u6240\u6709\u6807\u8bb0\u4efb\u52a1 ansible-playbook example.yml --list-tags \u6267\u884c\u6240\u6709\u6807\u8bb0\u540d\u79f0\u4e3apackages\u548cconfiguration\u7684\u4efb\u52a1 ansible-playbook example.yml --tags \"configuration,packages\" \u8df3\u8fc7\u6240\u6709\u6807\u8bb0\u540d\u79f0\u4e3aconfiguration\u7684\u4efb\u52a1 ansible-playbook example.yml --skip-tags \"configuration\" \u6807\u8bb0playbook \u00b6 - hosts : all tags : - bar tasks : ... - hosts : all tags : [ 'foo' ] tasks : ... play\u91cc\u7684\u6240\u6709tasks\u5c06\u4f1a\u7ee7\u627fplay\u7684tags \u6807\u8bb0role \u00b6 - roles : - { role : webserver , port : 5000 , tags : [ 'web' , 'foo' ] } role\u91cc\u7684tasks\u5c06\u4f1a\u7ee7\u627frole\u7684tags \u6807\u8bb0\u5305\u542b \u00b6 - import_role : name : myrole tags : [ web , foo ] - import_tasks : foo.yml tags : [ web , foo ] \u5305\u542b\u7684role\u548ctasks\u4e2d\u7684\u4efb\u52a1\u5c06\u4f1a\u7ee7\u627ftags\uff0c\u52a8\u6001\u5305\u542b\u5219\u4e0d\u7ee7\u627ftag \u7279\u6b8a\u6807\u8bb0 \u00b6 \u4f7f\u7528 always \u6807\u7b7e\u53ef\u4ee5\u59cb\u7ec8\u8fd0\u884c\u6807\u8bb0\u7684\u4efb\u52a1 tasks : - debug : msg : \"Always runs\" tags : - always - debug : msg : \"runs when you use tag1\" tags : - tag1 \u8fd8\u6709\u53e6\u59164\u4e2a\u7279\u6b8a\u5173\u952e\u5b57\u7528\u4e8e\u6807\u7b7e\uff0c never \u963b\u6b62\u4efb\u52a1\u8fd0\u884c tagged \u4ec5\u8fd0\u884c\u5df2\u6807\u8bb0 untagged \u8fd0\u884c\u53ea\u6709\u672a\u6807\u8bb0 all \u8fd0\u884c\u6240\u6709\u4efb\u52a1 \u9ed8\u8ba4\u60c5\u51b5\u4e0bansible\u8fd0\u884c\u5c31\u50cf\u6307\u5b9a\u4e86 -tags all Vault \u52a0\u5bc6 \u00b6 Vault \u52a0\u5bc6\u4f7f\u7528\u65b9\u6cd5\u89c1 \u8be6\u7ec6\u4ecb\u7ecd \u4ece\u67d0\u4e2a\u4efb\u52a1\u5f00\u59cb\u6267\u884c \u00b6 \u4e3aansible-playbook\u6307\u5b9a --start-at-task \uff0c\u5c31\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u4efb\u52a1\u5f00\u59cb\u6267\u884c ansible-playbook playbook.yml --start-at-task = \"install packages\" \u4e00\u6b65\u4e00\u6b65\u7684\u6267\u884c \u00b6 ansible\u4e5f\u53ef\u4ee5\u4e00\u6b65\u4e00\u6b65\u4ea4\u4e92\u7684\u6267\u884c\uff0c\u6267\u884c\u6bcf\u4e00\u6b65\u90fd\u9700\u8981\u786e\u8ba4\u662f\u5426\u7ee7\u7eed ansible-playbook playbook.yml --step \u6a21\u5757\u9ed8\u8ba4\u503c \u00b6 \u4f60\u53ef\u4ee5\u4e3a\u591a\u4e2a\u76f8\u540c\u7684\u6a21\u5757\u6307\u5b9a\u9ed8\u8ba4\u503c,\u800c\u4e0d\u5fc5\u91cd\u590d\u586b\u5199\u3002 - hosts : localhost module_defaults : file : owner : root group : root mode : 0755 tasks : - file : state : touch path : /tmp/file1 - file : state : touch path : /tmp/file2 - file : state : touch path : /tmp/file3 \u53ef\u4ee5\u5728play\u3001block\u548ctask\u7ea7\u522b\u4f7f\u7528module_defaults\u5c5e\u6027\u3002 - block : - debug : msg : \"a different message\" module_defaults : debug : msg : \"a default message\" - file : state : touch path : /tmp/file1 module_defaults : file : {} \u5728playbook\u4e2d\uff0c\u60a8\u53ef\u4ee5\u4e3a\u6574\u4e2a\u6a21\u5757\u7ec4\u8bbe\u7f6e\u6a21\u5757\u9ed8\u8ba4\u503c\uff0c\u4f8b\u5982\u8bbe\u7f6e\u4e00\u4e2a\u516c\u5171AWS\u533a\u57df\u3002 # example_play.yml - hosts : localhost module_defaults : group/aws : region : us-west-2 tasks : - aws_s3_bucket_info : # now the region is shared between both info modules - ec2_ami_info : filters : name : 'RHEL*7.5*' \u53ef\u7528\u4e8egroup\u7684\u6a21\u5757 Group Purpose Ansible Version aws Amazon Web Services 2.7 azure Azure 2.7 gcp Google Cloud Platform 2.7 k8s Kubernetes 2.8 os OpenStack 2.8 \u7b49\u5f85 \u00b6 \u4f7f\u7528 wait_for \u6a21\u5757\uff0c\u53ef\u4ee5\u7b49\u5f85\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u624d\u53ef\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u7684\u4efb\u52a1\u3002 \u7b49\u5f85\u7aef\u53e3\u53ef\u7528,\u624d\u80fd\u7ee7\u7eed\u6267\u884c\u4efb\u52a1 - wait_for : port=8000 delay=10 \u7b49\u5f85\u76f4\u5230\u9501\u5b9a\u6587\u4ef6\u88ab\u5220\u9664 wait_for : path=/var/lock/file.lock state=absent Playbook \u5173\u952e\u5b57 \u00b6 Playbook \u53ef\u7528\u7684\u5173\u952e\u5b57\u89c1 \u8be6\u7ec6\u5217\u8868 lookup \u63d2\u4ef6 \u00b6 lookup \u63d2\u4ef6\u5141\u8bb8\u8bbf\u95ee\u5916\u90e8\u6570\u636e\u6e90\u3002\u4e0e\u6240\u6709\u6a21\u677f\u4e00\u6837\uff0c\u8fd9\u4e9b\u63d2\u4ef6\u662f\u5728Ansible control\u8282\u70b9\u4e0a\u6267\u884c\u7684\u3002 \u4f7f\u7528 file \u83b7\u53d6\u6587\u4ef6\u5185\u5bb9 \u00b6 --- - hosts : all vars : contents : \"{{ lookup('file', '/etc/foo.txt') }}\" tasks : - debug : msg=\"the value of foo.txt is {{ contents }}\" \u4f7f\u7528 env \u83b7\u53d6\u53d8\u91cf \u00b6 --- - hosts : all vars : local_home : \"{{ lookup('env','HOME') }}\" tasks : - debug : var=local_home \u4f7f\u7528 password \u751f\u6210\u5bc6\u7801\u5b57\u7b26\u4e32 \u00b6 --- - hosts : all tasks : # \u4f7f\u7528\u53ea\u6709ascii\u5b57\u6bcd\u4e14\u957f\u5ea6\u4e3a8\u7684\u968f\u673a\u5bc6\u7801\u521b\u5efa\u4e00\u4e2amysql\u7528\u6237: - mysql_user : name={{ client }} password=\"{{ lookup('password', '/tmp/passwordfile chars=ascii_letters length=8') }}\" priv={{ client }}_{{ tier }}_{{ role }}.*:ALL # \u4f7f\u7528\u53ea\u6709\u6570\u5b57\u7684\u968f\u673a\u5bc6\u7801\u521b\u5efa\u4e00\u4e2amysql\u7528\u6237: - mysql_user : name={{ client }} password=\"{{ lookup('password', '/tmp/passwordfile chars=digits') }}\" priv={{ client }}_{{ tier }}_{{ role }}.*:ALL # \u4f7f\u7528\u8bb8\u591a\u4e0d\u540c\u7684\u5b57\u7b26\u96c6\u4f7f\u7528\u968f\u673a\u5bc6\u7801\u521b\u5efa\u4e00\u4e2amysql\u7528\u6237\uff1a - mysql_user : name={{ client }} password=\"{{ lookup('password', '/tmp/passwordfile chars=ascii_letters,digits,hexdigits,punctuation') }}\" priv={{ client }}_{{ tier }}_{{ role }}.*:ALL \u5982\u679c\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u5219\u4e0d\u4f1a\u5411\u5176\u5199\u5165\u4efb\u4f55\u6570\u636e\u3002 \u5982\u679c\u6587\u4ef6\u6709\u5185\u5bb9\uff0c\u90a3\u4e9b\u5185\u5bb9\u5c06\u4f5c\u4e3a\u5bc6\u7801\u8bfb\u5165\u3002 \u7a7a\u6587\u4ef6\u5bfc\u81f4\u5bc6\u7801\u4ee5\u7a7a\u5b57\u7b26\u4e32\u8fd4\u56de\u3002 \u4f7f\u7528 csvfile \u8bfb\u53d6csv\u6587\u4ef6 \u00b6 # f.csv Symbol,Atomic Number,Atomic Mass H,1,1.008 He,2,4.0026 Li,3,6.94 Be,4,9.012 B,5,10.81 - debug : msg=\"The atomic number of Lithium is {{ lookup('csvfile', 'Li file=elements.csv delimiter=,') }}\" - debug : msg=\"The atomic mass of Lithium is {{ lookup('csvfile', 'Li file=elements.csv delimiter=, col=2') }}\" \u53c2\u6570\u63cf\u8ff0 \u53c2\u6570 \u9ed8\u8ba4\u503c \u63cf\u8ff0 file ansible.csv \u8981\u52a0\u8f7d\u7684\u6587\u4ef6\u540d\u79f0 col 1 \u8981\u8f93\u51fa\u7684\u5217\uff0c\u7d22\u5f15\u4ece0\u5f00\u59cb delimiter TAB \u6587\u4ef6\u7684\u5206\u9694\u7b26 default empty string \u5982\u679ckey\u4e0d\u5728csv\u6587\u4ef6\u4e2d\uff0c\u5219\u4e3a\u9ed8\u8ba4\u8fd4\u56de\u503c encoding utf-8 \u4f7f\u7528\u7684CSV\u6587\u4ef6\u7684\u7f16\u7801\uff08\u5b57\u7b26\u96c6\uff09(added in version 2.1) \u4f7f\u7528 ini \u8bfb\u53d6ini\u6587\u4ef6 \u00b6 \u5728section\u4e0b\u67e5\u627e\u4ee5key1 = value1\u7684\u683c\u5f0f\u6765\u8bfb\u53d6\u6587\u4ef6\u7684\u5185\u5bb9\u3002 # users.ini [production] # My production information user = robert pass = somerandompassword [integration] # My integration information user = gertrude pass = anotherpassword tasks : - debug : msg=\"User in integration is {{ lookup('ini', 'user section=integration file=users.ini') }}\" - debug : msg=\"User in production is {{ lookup('ini', 'pass section=production file=users.ini') }}\" ini \u53c2\u6570\u683c\u5f0f lookup('ini', 'key [type=<properties|ini>] [section=section] [file=file.ini] [re=true] [default=<defaultvalue>]') \u7b2c\u4e00\u4e2a\u503c\u5fc5\u987b\u662fini\u6587\u4ef6\u91cc\u7684key \u53c2\u6570\u63cf\u8ff0 \u5b57\u6bb5 \u9ed8\u8ba4\u503c \u63cf\u8ff0 type ini \u6587\u4ef6\u7c7b\u578b\u3002 \u53ef\u4ee5\u662fini\u6216properties \uff08\u5bf9\u4e8ejavaproperties \uff09\u3002 file ansible.ini \u8981\u52a0\u8f7d\u7684\u6587\u4ef6\u540d\u79f0 section global \u5728\u54ea\u91cc\u67e5\u627ekey re False \u5f00\u542f\u6b63\u5219\u5339\u914d default empty string \u5982\u679ckey\u4e0d\u5728\u6587\u4ef6\u4e2d\uff0c\u5219\u4e3a\u9ed8\u8ba4\u8fd4\u56de\u503c \u4f7f\u7528 dig dns\u67e5\u8be2 \u00b6 \u6b64\u6a21\u5757\u4f9d\u8d56 dnspython \u5e93 tasks : - debug : msg=\"The IPv4 address for example.com. is {{ lookup('dig', 'example.com.')}}\" - debug : msg=\"The TXT record for example.org. is {{ lookup('dig', 'example.org.', 'qtype=TXT') }}\" - debug : msg=\"The TXT record for example.org. is {{ lookup('dig', 'example.org./TXT') }}\" \u5176\u4ed6\u63d2\u4ef6 tasks : - debug : msg=\"{{ lookup('env','HOME') }} is an environment variable\" - debug : msg=\"{{ lookup('pipe','date') }} is the raw result of running this command\" # redis_kv lookup requires the Python redis package - debug : msg=\"{{ lookup('redis_kv', 'redis://localhost:6379,somekey') }} is value in Redis for somekey\" # dnstxt lookup requires the Python dnspython package - debug : msg=\"{{ lookup('dnstxt', 'example.com') }} is a DNS TXT record for example.com\" - debug : msg=\"{{ lookup('template', './some_template.j2') }} is a value from evaluation of this template\" # loading a json file from a template as a string - debug : msg=\"{{ lookup('template', './some_json.json.j2', convert_data=False) }} is a value from evaluation of this template\" - debug : msg=\"{{ lookup('etcd', 'foo') }} is a value from a locally running etcd\" # shelvefile lookup retrieves a string value corresponding to a key inside a Python shelve file - debug : msg=\"{{ lookup('shelvefile', 'file=path_to_some_shelve_file.db key=key_to_retrieve') }}","title":"15. Playbook \u9ad8\u7ea7\u7279\u6027"},{"location":"basic/Playbook-features/#15-playbook","text":"","title":"15. Playbook \u9ad8\u7ea7\u7279\u6027"},{"location":"basic/Playbook-features/#_1","text":"Ansible\u4f7f\u7528\u73b0\u6709\u7684\u6743\u9650\u5347\u7ea7\u7cfb\u7edf\u6765\u6267\u884c\u5177\u6709 root \u6743\u9650\u6216\u5176\u4ed6\u7528\u6237\u6743\u9650\u7684\u4efb\u52a1\u3002\u56e0\u4e3a\u8fd9\u4e2a\u7279\u6027\u5141\u8bb8\u60a8\u6210\u4e3a\u53e6\u4e00\u4e2a\u7528\u6237\uff0c\u4e0e\u767b\u5f55\u5230\u673a\u5668\u7684\u7528\u6237(\u8fdc\u7a0b\u7528\u6237)\u4e0d\u540c\uff0c\u6240\u4ee5\u6211\u4eec\u5c06\u5176\u79f0\u4e3a become \u3002 become \u5173\u952e\u5b57\u5229\u7528\u73b0\u6709\u7684\u6743\u9650\u5347\u7ea7\u5de5\u5177\uff0c\u5982 sudo \u3001 su \u3001 pfexec \u3001 doas \u3001 pbrun \u3001 dzdo \u3001 ksu \u3001 runas \u3001 machinectl \u7b49\u3002","title":"\u6743\u9650\u63d0\u5347"},{"location":"basic/Playbook-features/#become","text":"\u4f60\u53ef\u4ee5\u5728 play \u6216 task \u4e0a\u4f7f\u7528 become \uff0c\u540c\u65f6\u4f7f\u7528\u65f6\uff0c\u4f18\u5148\u7ea7\u89c4\u5219\u4f1a\u51b3\u5b9a\u54ea\u4e2a\u751f\u6548\u3002","title":"\u4f7f\u7528become"},{"location":"basic/Playbook-features/#become_1","text":"become \u8bbe\u7f6e yes \u5373\u5f00\u542f\u63d0\u5347\u6743\u9650 become_user \u6307\u5b9a\u63d0\u5347\u6743\u9650\u7684\u7528\u6237 become_method \u6307\u5b9a\u63d0\u5347\u6743\u9650\u7684\u65b9\u5f0f\uff0c\u6709sudo\uff0csu\uff0crunas\u7b49\u3002 become_flags \u4f20\u7ed9\u53ef\u6267\u884c\u6587\u4ef6\u7684\u53c2\u6570 \u4f8b\u5982\uff0c\u542f\u52a8\u670d\u52a1\u9700\u8981 root \u6743\u9650 - name : Ensure the httpd service is running service : name : httpd state : started become : yes \u4ee5apache\u7528\u6237\u8eab\u4efd\u8fd0\u884c\u547d\u4ee4 - name : Run a command as the apache user command : somecommand become : yes become_user : apache \u5f53shell\u4e3anologin\u65f6\uff0c\u4f5c\u4e3anobody\u7528\u6237\u6267\u884c\u67d0\u4e9b\u64cd\u4f5c - name : Run a command as nobody command : somecommand become : yes become_method : su become_user : nobody become_flags : '-s /bin/sh'","title":"become \u6307\u4ee4"},{"location":"basic/Playbook-features/#become_2","text":"\u5728\u4e3b\u673a\u6e05\u5355\u4e2d\u53ef\u4ee5\u4e3a\u8282\u70b9\u5b9a\u4e49\u4e0d\u540c\u7684 become \u9009\u9879\uff0c\u4f7f\u7528\u4e0b\u5217\u53d8\u91cf ansible_become \u5f00\u542f\u63d0\u5347\u6743\u9650 ansible_become_method \u63d0\u5347\u6743\u9650\u7684\u65b9\u5f0f\uff0c\u6709sudo\uff0csu\uff0crunas\u7b49\u3002 ansible_become_user \u63d0\u5347\u6743\u9650\u7684\u7528\u6237 ansible_become_pass \u63d0\u5347\u6743\u9650\u7684\u7528\u6237\u5bc6\u7801 \u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5e0c\u671b\u5728\u4e00\u4e2a\u540d\u4e3awebserver\u7684\u670d\u52a1\u5668\u4e0a\u4ee5root\u8eab\u4efd\u8fd0\u884c\u6240\u6709\u4efb\u52a1\uff0c\u4f46\u662f\u60a8\u53ea\u80fd\u4f5c\u4e3amanager\u7528\u6237\u8fde\u63a5\uff0c\u90a3\u4e48\u60a8\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3c\u8fd9\u6837\u7684\u5e93\u5b58\u6761\u76ee webserver ansible_user = manager ansible_become=yes","title":"become \u53d8\u91cf"},{"location":"basic/Playbook-features/#become_3","text":"--become\uff0c-b --ask-become-pass, -K \u544a\u8bc9\u7a0b\u5e8f\u63d0\u5347\u6743\u9650\u7684\u7528\u6237\u5bc6\u7801 --become-method \u63d0\u5347\u6743\u9650\u7684\u65b9\u5f0f\uff0c\u6709sudo\uff0csu\uff0crunas\u7b49\u3002 --become-user \u63d0\u5347\u6743\u9650\u7684\u7528\u6237 ansible -i hosts node1 -m shell -a \"whoami\" --become --become-method = su --become-user = root --ask-become-pass ansible-playbook -i hosts test.yml --become --become-method = su --become-user = root --ask-become-pass","title":"become \u547d\u4ee4\u884c\u9009\u9879"},{"location":"basic/Playbook-features/#become_4","text":"\u6210\u4e3a\u65e0\u7279\u6743\u7528\u6237\u7684\u98ce\u9669 \u4e0d\u662f\u6240\u6709\u7684\u8fde\u63a5\u63d2\u4ef6\u90fd\u652f\u6301\u7279\u6743\u5347\u7ea7 \u6bcf\u4e2a\u4e3b\u673a\u53ea\u80fd\u542f\u7528\u4e00\u4e2a\u7279\u6743\u5347\u7ea7\u6a21\u5f0f(su,sudo...) \u7279\u6743\u5347\u7ea7\u4e0d\u80fd\u9650\u5236\u67d0\u4e9b\u547d\u4ee4\u80fd\u5347\u7ea7\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4ansible\u6267\u884c\u65f6\u51fa\u73b0\u9519\u8bef\u3002 \u4e0d\u80fd\u8bbf\u95ee\u7531 pam_systemd \u586b\u5145\u7684\u73af\u5883\u53d8\u91cf","title":"become\u7684\u4e00\u4e9b\u9650\u5236\u548c\u98ce\u9669"},{"location":"basic/Playbook-features/#become_5","text":"\u4ece2.6\u7248\u5f00\u59cb\uff0cAnsible\u5728\u6240\u6709\u652f\u6301enable\u6a21\u5f0f\u7684\u7f51\u7edc\u8bbe\u5907\u4e0a\u8fdb\u884c\u7279\u6743\u5347\u7ea7(\u8fdb\u5165enable\u6a21\u5f0f\u6216\u7279\u6743EXEC\u6a21\u5f0f) \u4f60\u5fc5\u987b\u5c06\u8fde\u63a5\u7c7b\u578b\u8bbe\u7f6e\u4e3a connection: network_cli \u6216 connection: httpapi \uff0c\u624d\u80fd\u5728\u7f51\u7edc\u8bbe\u5907\u4e0a\u4f7f\u7528 become \u8fdb\u884c\u6743\u9650\u5347\u7ea7\u3002 \u82e5\u8981\u8bbe\u7f6e\u7279\u5b9a\u4efb\u52a1\u7684 enable \u6a21\u5f0f\uff0c\u8bf7\u5728\u4efb\u52a1\u7ea7\u522b\u4e0a\u6dfb\u52a0 become - name : Gather facts (eos) eos_facts : gather_subset : - \"!hardware\" become : yes become_method : enable \u82e5\u8981\u4e3a\u5355\u4e2aplay\u4e2d\u7684\u6240\u6709\u4efb\u52a1\u8bbe\u7f6e enable \u6a21\u5f0f\uff0c\u8bf7\u5728play\u7ea7\u522b\u4e0a\u6dfb\u52a0 become - hosts : eos-switches become : yes become_method : enable tasks : - name : Gather facts (eos) eos_facts : gather_subset : - \"!hardware\"","title":"\u7f51\u7edc\u6a21\u5757\u4f7f\u7528become"},{"location":"basic/Playbook-features/#enable","text":"\u901a\u5e38\uff0c\u60a8\u5e0c\u671b\u6240\u6709play\u4e2d\u7684\u6240\u6709\u4efb\u52a1\u90fd\u4f7f\u7528\u7279\u6743\u6a21\u5f0f\u8fd0\u884c\uff0c\u8fd9\u6700\u597d\u901a\u8fc7\u4f7f\u7528\u7ec4\u53d8\u91cf\u6765\u5b9e\u73b0 ansible_connection : network_cli ansible_network_os : eos ansible_user : myuser ansible_become : yes ansible_become_method : enable","title":"\u8bbe\u7f6e\u6240\u6709\u4efb\u52a1\u7684enable\u6a21\u5f0f"},{"location":"basic/Playbook-features/#enable_1","text":"\u5982\u679c\u9700\u8981\u5bc6\u7801\u624d\u80fd\u8fdb\u5165 enable \u6a21\u5f0f\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u4e4b\u4e00\u8fdb\u884c\u6307\u5b9a \u63d0\u4f9b --ask-become-pass \u547d\u4ee4\u884c\u9009\u9879 \u8bbe\u7f6e ansible_become_password \u8fde\u63a5\u53d8\u91cf","title":"enable\u6a21\u5f0f\u7684\u5bc6\u7801"},{"location":"basic/Playbook-features/#authorize-auth_pass","text":"ansible \u4f9d\u7136\u652f\u6301 connection: local \u8fde\u63a5\u4e0b\u7684 enable \u6a21\u5f0f - hosts : eos-switches ansible_connection : local tasks : - name : Gather facts (eos) eos_facts : gather_subset : - \"!hardware\" provider : authorize : yes auth_pass : \" {{ secret_auth_pass }}\"","title":"authorize \u548c auth_pass"},{"location":"basic/Playbook-features/#windows-become","text":"\u4eceAnsible 2.3\u5f00\u59cb\uff0c\u53ef\u4ee5\u901a\u8fc7 runas \u65b9\u6cd5\u5728Windows\u4e3b\u673a\u4e0a\u4f7f\u7528 become \u3002\u5728Windows\u4e0a\u7684Become\u4f7f\u7528\u4e0e\u5728\u975eWindows\u4e3b\u673a\u4e0a\u76f8\u540c\u7684\u5e93\u5b58\u8bbe\u7f6e\u548c\u8c03\u7528\u53c2\u6570\uff0c\u56e0\u6b64\u8bbe\u7f6e\u548c\u53d8\u91cf\u540d\u4e0e\u672c\u6587\u6863\u4e2d\u5b9a\u4e49\u7684\u76f8\u540c\u3002 Windows\u4e2d\u7684\u8bb8\u591a\u4efb\u52a1\u9700\u8981\u7ba1\u7406\u6743\u9650\u624d\u80fd\u5b8c\u6210\u3002\u5f53\u4f7f\u7528runas become\u65b9\u6cd5\u65f6\uff0cAnsible\u5c06\u5c1d\u8bd5\u4f7f\u7528\u8fdc\u7a0b\u7528\u6237\u53ef\u7528\u7684\u5168\u90e8\u7279\u6743\u8fd0\u884c\u6a21\u5757\u3002\u5982\u679c\u672a\u80fd\u63d0\u5347\u7528\u6237\u4ee4\u724c\uff0c\u5219\u5728\u6267\u884c\u671f\u95f4\u5c06\u7ee7\u7eed\u4f7f\u7528\u6709\u9650\u7684\u4ee4\u724c\u3002 \u7528\u6237\u5fc5\u987b\u5177\u6709 SeDebugPrivilege \u624d\u80fd\u8fd0\u884c\u5177\u6709\u63d0\u5347\u7279\u6743\u7684\u6210\u4e3a\u8fdb\u7a0b\u3002\u8fd9\u4e2a\u7279\u6743\u9ed8\u8ba4\u5206\u914d\u7ed9\u7ba1\u7406\u5458\u3002\u5982\u679c\u8c03\u8bd5\u7279\u6743\u4e0d\u53ef\u7528\uff0c\u5219become\u8fdb\u7a0b\u5c06\u4f7f\u7528\u4e00\u7ec4\u6709\u9650\u7684\u7279\u6743\u548c\u7ec4\u8fd0\u884c\u3002 - win_whoami : become : yes \u5728\u8fd4\u56de\u7684 label.account_name \u4e2d\u4f53\u73b0\u4e86\u662f\u5426\u83b7\u53d6\u7279\u6743 Medium : Ansible\u672a\u80fd\u5f97\u5230\u63d0\u5347\u7684\u4ee4\u724c\uff0c\u5e76\u8fd0\u884c\u5728\u4e00\u4e2a\u6709\u9650\u7684\u4ee4\u724c\u3002 High : \u83b7\u5f97\u4e86\u63d0\u5347\u7684\u4ee4\u724c\uff0c\u5e76\u5728\u4efb\u52a1\u4e2d\u4f7f\u7528 System : NT AUTHORITY\\System \u5e10\u6237\u88ab\u4f7f\u7528\uff0c\u5e76\u4e14\u5177\u6709\u6700\u9ad8\u7ea7\u522b\u7684\u53ef\u7528\u7279\u6743\u3002 \u5982\u679c\u5728\u5927\u4e8e2.5\u7684Ansible\u7248\u672c\u4e0a\u8fd0\u884c\u6216\u6b63\u5e38\u7684runas\u5347\u7ea7\u8fc7\u7a0b\u5931\u8d25\uff0c\u53ef\u4ee5\u901a\u8fc7 \u5c06 become_user \u8bbe\u7f6e\u4e3a System \u4ee5\u4fbf\u62e5\u6709\u6700\u9ad8\u6743\u9650 \u4e3aWinRM\u8fde\u63a5\u7528\u6237\u6388\u4e88 SeTcbPrivilege \u6743\u9650\uff0c SeTcbPrivilege \u662f\u4e00\u79cd\u9ad8\u7ea7\u7279\u6743\uff0c\u5b83\u6388\u4e88\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u7684\u5b8c\u5168\u63a7\u5236\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u4efb\u52a1\u5728Windows\u4e3b\u673a\u4e0a\u8bbe\u7f6e\u6b64\u7279\u6743 - name : grant the ansible user the SeTcbPrivilege right win_user_right : name : SeTcbPrivilege users : '{{ansible_user}}' action : add \u5173\u95ed\u4e3b\u673a\u4e0a\u7684UAC\u5e76\u91cd\u542f\u4e3b\u673a, UAC\u662f\u4e00\u79cd\u5b89\u5168\u534f\u8bae\uff0c\u5b83\u88ab\u8bbe\u8ba1\u4e3a\u4f7f\u7528\u6700\u5c11\u7279\u6743\u539f\u5219\u8fd0\u884c\u5e10\u6237\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u4efb\u52a1\u6765\u5173\u95edUAC - name : turn UAC off win_regedit : path : HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system name : EnableLUA data : 0 type : dword state : present register : uac_result - name : reboot after disabling UAC win_reboot : when : uac_result is changed \u6388\u4e88 SeTcbPrivilege \u6216\u5173\u95edUAC\u53ef\u80fd\u4f1a\u5bfc\u81f4Windows\u5b89\u5168\u6f0f\u6d1e\uff0c\u5982\u679c\u91c7\u53d6\u4e86\u8fd9\u4e9b\u6b65\u9aa4\uff0c\u5e94\u8be5\u8c28\u614e\u5bf9\u5f85\u3002","title":"windows \u4f7f\u7528become"},{"location":"basic/Playbook-features/#localservice","text":"\u5728Ansible 2.5\u7248\u672c\u4e4b\u524d\uff0cbecome\u53ea\u80fd\u5728\u672c\u5730\u6216\u57df\u7528\u6237\u5e10\u6237\u7684Windows\u4e0a\u5de5\u4f5c\u3002\u5728\u8fd9\u4e9b\u65e7\u7248\u672c\u4e2d\uff0c\u50cf System \u6216 NetworkService \u8fd9\u6837\u7684\u672c\u5730\u670d\u52a1\u5e10\u6237\u4e0d\u80fd\u7528\u4f5c\u7528\u6237\u3002\u81eaAnsible 2.5\u53d1\u5e03\u4ee5\u6765\uff0c\u8fd9\u4e00\u9650\u5236\u5df2\u7ecf\u89e3\u9664\u3002\u53ef\u4ee5\u5728\u6210\u4e3a\u7528\u6237\u4e0b\u9762\u8bbe\u7f6e\u7684\u4e09\u4e2a\u670d\u52a1\u5e10\u6237\u662f System NetworkService LocalService \u7531\u4e8e\u672c\u5730\u670d\u52a1\u5e10\u6237\u6ca1\u6709\u5bc6\u7801\uff0c\u6240\u4ee5 ansible_become_password \u53c2\u6570\u4e0d\u662f\u5fc5\u9700\u7684\uff0c\u5982\u679c\u6307\u5b9a\u4e86\u8be5\u53c2\u6570\u4e5f\u4f1a\u88ab\u88ab\u5ffd\u7565\u3002","title":"LocalService\u8d26\u53f7"},{"location":"basic/Playbook-features/#become_6","text":"\u4eceAnsible 2.8\u5f00\u59cb\uff0cbecome\u53ef\u4ee5\u88ab\u7528\u6765\u6210\u4e3a\u4e00\u4e2aWindows\u672c\u5730\u6216\u57df\u5e10\u6237\uff0c\u800c\u4e0d\u9700\u8981\u8be5\u5e10\u6237\u7684\u5bc6\u7801\u3002\u8981\u4f7f\u6b64\u65b9\u6cd5\u5de5\u4f5c\uff0c\u5fc5\u987b\u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42 \u8be5\u8fde\u63a5\u7528\u6237\u62e5\u6709 SeDebugPrivilege \u6743\u9650 \u8be5\u8fde\u63a5\u7528\u6237\u5c5e\u4e8e BUILTIN\\Administrators \u7ec4 \u8be5\u8fde\u63a5\u7528\u6237\u62e5\u6709 SeBatchLogonRight \u6216 SeNetworkLogonRight \u7528\u6237\u6743\u9650 \u901a\u8fc7\u4e24\u79cd\u4e0d\u540c\u7684\u65b9\u6cd5\u4e4b\u4e00\u53ef\u4ee5\u4f7f\u7528\u4f7f\u7528\u65e0\u5bc6\u7801\u65b9\u5f0f\uff1a \u590d\u5236\u73b0\u6709\u7684\u767b\u5f55\u4f1a\u8bdd\u4ee4\u724c(\u5982\u679c\u5e10\u6237\u5df2\u7ecf\u767b\u5f55) \u4f7f\u7528S4U\u751f\u6210\u4ec5\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u6709\u6548\u7684\u767b\u5f55\u4ee4\u724c","title":"\u65e0\u9700\u4e3abecome\u8bbe\u7f6e\u5bc6\u7801"},{"location":"basic/Playbook-features/#_2","text":"Ansible\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u6ca1\u6709\u5bc6\u7801\u7684Windows\u5e10\u6237(\u50cfGuest\u5e10\u6237)\u3002\u8981\u6210\u4e3a\u4e00\u4e2a\u6ca1\u6709\u5bc6\u7801\u7684\u5e10\u6237\uff0c\u5fc5\u987b\u8bbe\u7f6e ansible_become_password: '' \u3002 \u8981\u60f3\u5b9e\u73b0\u65e0\u5bc6\u7801\u767b\u5f55\uff0c\u8fd8\u9700\u8981\u5c06\u672c\u5730\u7b56\u7565\u5e10\u6237:\u5c06\u672c\u5730\u5e10\u6237\u4f7f\u7528\u7a7a\u767d\u5bc6\u7801\u9650\u5236\u4e3a\u4ec5\u7528\u4e8e\u63a7\u5236\u53f0\u767b\u5f55\u7981\u7528\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u7ec4\u7b56\u7565\u5bf9\u8c61(GPO)\u5b8c\u6210\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u53ef\u80fd\u7684\u4efb\u52a1\u5b8c\u6210 - name : allow blank password on become win_regedit : path : HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa name : LimitBlankPasswordUse data : 0 type : dword state : present","title":"\u6ca1\u6709\u5bc6\u7801\u7684\u5e10\u6237"},{"location":"basic/Playbook-features/#become_7","text":"windows\u652f\u6301\u7684 ansible_become_flags \u6709\u4e24\u4e2a logon_type , logon_flags logon_type \u662f\u6307\u5b9a\u767b\u5f55\u64cd\u4f5c\u7c7b\u578b\uff0c\u6709\u4ee5\u4e0b\u53ef\u9009\u9879: interactive: \u9ed8\u8ba4\u767b\u5f55\u7c7b\u578b\u3002\u8be5\u6d41\u7a0b\u5c06\u5728\u4e0e\u672c\u5730\u8fd0\u884c\u6d41\u7a0b\u76f8\u540c\u7684\u4e0a\u4e0b\u6587\u4e2d\u8fd0\u884c\u3002\u8fd9\u7ed5\u8fc7\u4e86\u6240\u6709\u7684WinRM\u9650\u5236\uff0c\u662f\u63a8\u8350\u4f7f\u7528\u7684\u65b9\u6cd5\u3002 batch: \u5728\u7c7b\u4f3c\u4e8e\u8bbe\u7f6e\u4e86\u5bc6\u7801\u7684\u8c03\u5ea6\u4efb\u52a1\u7684\u6279\u5904\u7406\u4e0a\u4e0b\u6587\u4e2d\u8fd0\u884c\u8be5\u8fdb\u7a0b\u3002 new_credentials: \u5728\u4e0e\u8c03\u7528\u7528\u6237\u76f8\u540c\u7684\u51ed\u636e\u4e0b\u8fd0\u884c network: \u5728\u6ca1\u6709\u4efb\u4f55\u7f13\u5b58\u51ed\u636e\u7684\u7f51\u7edc\u4e0a\u4e0b\u6587\u4e2d\u8fd0\u884c\u8fdb\u7a0b\u3002 network_cleartext: \u4e0e\u7f51\u7edc\u767b\u5f55\u7c7b\u578b\u7c7b\u4f3c\uff0c\u4f46\u7f13\u5b58\u51ed\u636e\u4ee5\u4fbf\u5b83\u53ef\u4ee5\u8bbf\u95ee\u7f51\u7edc\u8d44\u6e90\u3002 logon_flags \u6307\u5b9a\u5728\u521b\u5efa\u65b0\u8fdb\u7a0b\u65f6\uff0cWindows\u5c06\u5982\u4f55\u8bb0\u5f55\u7528\u6237\u7684\u767b\u5f55\u3002 \u6709\u4ee5\u4e0b\u53ef\u9009\u9879: with_profile\uff1a \u9ed8\u8ba4\u503c\u3002 \u8be5\u8fc7\u7a0b\u4f1a\u5c06HKEY_USERS\u6ce8\u518c\u8868\u9879\u4e2d\u7684\u7528\u6237\u4e2a\u4eba\u8d44\u6599\u52a0\u8f7d\u5230HKEY_CURRENT_USER\u3002 netcredentials_only\uff1a \u8be5\u8fc7\u7a0b\u5c06\u4f7f\u7528\u4e0e\u8c03\u7528\u65b9\u76f8\u540c\u7684\u4ee4\u724c\uff0c\u4f46\u662f\u5728\u8bbf\u95ee\u8fdc\u7a0b\u8d44\u6e90\u65f6\u5c06\u4f7f\u7528begin_user\u548cbegin_password\u3002 \u4e00\u4e9b\u4f8b\u5b50 - name : copy a file from a fileshare with custom credentials win_copy : src : \\\\server\\share\\data\\file.txt dest : C:\\temp\\file.txt remote_src : yes vars : ansible_become : yes ansible_become_method : runas ansible_become_user : DOMAIN\\user ansible_become_password : Password01 ansible_become_flags : logon_type=new_credentials logon_flags=netcredentials_only - name : run a command under a batch logon win_whoami : become : yes become_flags : logon_type=batch - name : run a command and not load the user profile win_whomai : become : yes become_flags : logon_flags=","title":"become\u7684\u53c2\u6570"},{"location":"basic/Playbook-features/#_3","text":"\u4ec5\u5f53\u4f7f\u7528Ansible 2.7\u6216\u66f4\u9ad8\u7248\u672c\u65f6\uff0c async \u548c become \u4efb\u52a1\u624d\u80fd\u5728Windows Server 2008\u30012008 R2\u548cWindows 7\u4e0a\u8fd0\u884c\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c become \u7528\u6237\u4f7f\u7528\u4ea4\u4e92\u5f0f\u4f1a\u8bdd\u767b\u5f55\uff0c\u56e0\u6b64\u5b83\u5fc5\u987b\u6709\u6743\u5728Windows\u4e3b\u673a\u4e0a\u8fdb\u884c\u767b\u5f55\u3002 \u5982\u679c\u5b83\u4e0d\u7ee7\u627fSeAllowLogOnLocally\u7279\u6743\u6216\u7ee7\u627fSeDenyLogOnLocally\u7279\u6743\uff0c\u5219\u63d0\u6743\u8fc7\u7a0b\u5c06\u5931\u8d25\u3002 \u6dfb\u52a0\u7279\u6743\u6216\u8bbe\u7f6elogon_type\u6807\u5fd7\u4ee5\u66f4\u6539\u4f7f\u7528\u7684\u767b\u5f55\u7c7b\u578b\u3002 \u5728Ansible version 2.3\u4e4b\u524d\uff0c\u53ea\u6709\u5f53 ansible_winrm_transport \u662fbasic\u6216credssp\u65f6\uff0cbecome\u624d\u80fd\u5de5\u4f5c\u3002\u8fd9\u4e2a\u9650\u5236\u5df2\u7ecf\u88ab\u89e3\u9664\uff0c\u81ea\u4ece2.4\u7248\u7684Ansible\u4e3a\u6240\u6709\u4e3b\u673a\u9664\u4e86Windows Server 2008(\u975eR2\u7248\u672c)\u3002 \u4e8c\u7ea7\u767b\u5f55\u670d\u52a1 seclogon \u5fc5\u987b\u8fd0\u884c\u624d\u80fd\u4f7f\u7528 ansible_become_method: runas","title":"\u9650\u5236"},{"location":"basic/Playbook-features/#_4","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0bplaybook\u4e2d\u7684\u4efb\u52a1\u6267\u884c\u65f6\u4f1a\u4e00\u76f4\u4fdd\u6301\u8fde\u63a5,\u76f4\u5230\u8be5\u4efb\u52a1\u5728\u6bcf\u4e2a\u8282\u70b9\u90fd\u6267\u884c\u5b8c\u6bd5.\u6709\u65f6\u8fd9\u662f\u4e0d\u5fc5\u8981\u7684,\u6bd4\u5982\u6709\u4e9b\u64cd\u4f5c\u8fd0\u884c\u65f6\u95f4\u6bd4SSH\u8d85\u65f6\u65f6\u95f4\u8fd8\u8981\u957f.\u89e3\u51b3\u8be5\u95ee\u9898\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u662f\u5f02\u6b65\u6267\u884c\u5b83\u4eec,\u7136\u540e\u8f6e\u8be2\u76f4\u5230\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5. \u4f60\u4e5f\u53ef\u4ee5\u5bf9\u6267\u884c\u65f6\u95f4\u975e\u5e38\u957f\uff08\u6709\u53ef\u80fd\u906d\u9047\u8d85\u65f6\uff09\u7684\u64cd\u4f5c\u4f7f\u7528\u5f02\u6b65\u6a21\u5f0f. \u4e3a\u4e86\u5f02\u6b65\u542f\u52a8\u4e00\u4e2a\u4efb\u52a1,\u53ef\u4ee5\u6307\u5b9a\u5176\u6700\u5927\u8d85\u65f6\u65f6\u95f4\u4ee5\u53ca\u8f6e\u8be2\u5176\u72b6\u6001\u7684\u9891\u7387.\u5982\u679c\u4f60\u6ca1\u6709\u4e3a poll \u6307\u5b9a\u503c,\u90a3\u4e48\u9ed8\u8ba4\u7684\u8f6e\u8be2\u9891\u7387\u662f15\u79d2\u949f\u3002 \u4f8b\u5982\u4e0b\u9762\u7684palybook --- - hosts : 192.168.77.131 tasks : - shell : sleep 100 && hostname async : 100 poll : 0 register : result - debug : var=result - async_status : jid={{ result.ansible_job_id }} register : job_result until : job_result.finished retries : 30 poll\u6307\u5b9a\u4efb\u52a1\u7684\u8f6e\u8bad\u503c\uff0cpoll=0\u65f6\uff0c\u4efb\u52a1\u6267\u884c\u540e\uff0c\u4f1a\u7acb\u5373\u6267\u884c\u4e0b\u4e00\u6761\u4efb\u52a1\u3002poll>0\u65f6\uff0c\u4f1a\u963b\u585e\u4efb\u52a1\uff0c\u76f4\u5230\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\u6216\u8d85\u65f6\u3002\u6ca1\u6709\u8bbe\u7f6e\u7684\u65f6\u5019\uff0c\u53d6\u9ed8\u8ba4\u503c DEFAULT_POLL_INTERVAL \u7b2c\u4e00\u4e2a\u4efb\u52a1\uff0c\u6307\u5b9ashell\u4efb\u52a1\u4e3a\u5f02\u6b65\u6267\u884c\uff0c100\u79d2\u540e\u4efb\u52a1\u5931\u8d25\u3002 \u7b2c\u4e8c\u4e2a\u4efb\u52a1\uff0c\u83b7\u53d6\u5f02\u6b65\u4efb\u52a1\u7684\u8fd4\u56de\u503c\uff0c\u5176\u76ee\u7684\u662f\u83b7\u53d6jid\u3002 \u7b2c\u4e09\u4e2a\u4efb\u52a1\uff0c\u68c0\u67e5jid\u5f02\u6b65\u4efb\u52a1\u7684\u72b6\u6001\uff0c\u5f53\u5f02\u6b65\u4efb\u52a1\u7684finished\u4e0d\u4e3a0\u65f6\uff0c\u5f02\u6b65\u4efb\u52a1\u6267\u884c\u6210\u529f\u3002\u68c0\u67e5\u6b21\u6570\u4e3a30\u6b21\uff0c\u95f4\u96945\u79d2\u3002 \u8fd0\u884cplaybook\u7684\u7ed3\u679c\u4fe1\u606f # ansible-playbook asynctest.yml -vv ansible-playbook 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible-playbook python version = 2 .7.5 ( default, Aug 4 2017 , 00 :39:18 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-16 )] Using /etc/ansible/ansible.cfg as config file PLAYBOOK: asynctest.yaml ****************************************************************************************************************** 1 plays in asynctest.yaml PLAY [ 192 .168.77.131 ] ********************************************************************************************************************* TASK [ Gathering Facts ] ******************************************************************************************************************** task path: /etc/ansible/asynctest.yaml:2 ok: [ 192 .168.77.131 ] META: ran handlers TASK [ shell ] ****************************************************************************************************************************** task path: /etc/ansible/asynctest.yaml:5 changed: [ 192 .168.77.131 ] = > { \"ansible_job_id\" : \"965275577324.14846\" , \"changed\" : true, \"finished\" : 0 , \"results_file\" : \"/root/.ansible_async/965275577324.14846\" , \"started\" : 1 } TASK [ debug ] ****************************************************************************************************************************** task path: /etc/ansible/asynctest.yaml:9 ok: [ 192 .168.77.131 ] = > { \"result\" : { \"ansible_job_id\" : \"965275577324.14846\" , \"changed\" : true, \"failed\" : false, \"finished\" : 0 , \"results_file\" : \"/root/.ansible_async/965275577324.14846\" , \"started\" : 1 } } TASK [ async_status ] *********************************************************************************************************************** task path: /etc/ansible/asynctest.yaml:11 FAILED - RETRYING: async_status ( 30 retries left ) . FAILED - RETRYING: async_status ( 29 retries left ) . FAILED - RETRYING: async_status ( 28 retries left ) . FAILED - RETRYING: async_status ( 27 retries left ) . FAILED - RETRYING: async_status ( 26 retries left ) . FAILED - RETRYING: async_status ( 25 retries left ) . FAILED - RETRYING: async_status ( 24 retries left ) . FAILED - RETRYING: async_status ( 23 retries left ) . FAILED - RETRYING: async_status ( 22 retries left ) . FAILED - RETRYING: async_status ( 21 retries left ) . FAILED - RETRYING: async_status ( 20 retries left ) . FAILED - RETRYING: async_status ( 19 retries left ) . FAILED - RETRYING: async_status ( 18 retries left ) . FAILED - RETRYING: async_status ( 17 retries left ) . FAILED - RETRYING: async_status ( 16 retries left ) . FAILED - RETRYING: async_status ( 15 retries left ) . FAILED - RETRYING: async_status ( 14 retries left ) . FAILED - RETRYING: async_status ( 13 retries left ) . FAILED - RETRYING: async_status ( 12 retries left ) . FAILED - RETRYING: async_status ( 11 retries left ) . changed: [ 192 .168.77.131 ] = > { \"ansible_job_id\" : \"965275577324.14846\" , \"attempts\" : 21 , \"changed\" : true, \"cmd\" : \"sleep 100 && hostname\" , \"delta\" : \"0:01:40.069235\" , \"end\" : \"2020-04-03 21:59:52.442879\" , \"finished\" : 1 , \"rc\" : 0 , \"start\" : \"2020-04-03 21:58:12.373644\" , \"stderr\" : \"\" , \"stderr_lines\" : [] , \"stdout\" : \"node131\" , \"stdout_lines\" : [ \"node131\" ]} META: ran handlers META: ran handlers PLAY RECAP ******************************************************************************************************************************** 192 .168.77.131 : ok = 4 changed = 2 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u4f7f\u7528ansible\u6765\u6267\u884c\u5f02\u6b65 # ansible 192.168.77.131 -B 3600 -P 0 -o -m shell -a \"sleep 30\" -vv ansible 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible python version = 2 .7.5 ( default, Aug 4 2017 , 00 :39:18 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-16 )] Using /etc/ansible/ansible.cfg as config file META: ran handlers 192 .168.77.131 | CHANGED = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"ansible_job_id\" : \"71761724165.16525\" , \"changed\" : true, \"finished\" : 0 , \"results_file\" : \"/root/.ansible_async/71761724165.16525\" , \"started\" : 1 } META: ran handlers META: ran handlers \u4f7f\u7528 async_status \u6765\u83b7\u53d6\u5f02\u6b65\u72b6\u6001\u4fe1\u606f # ansible 192.168.77.131 -m async_status -a \"jid=71761724165.16525\" 192 .168.77.131 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"ansible_job_id\" : \"71761724165.16525\" , \"changed\" : false, \"finished\" : 0 , \"started\" : 1 } # .... \u7b49\u5f85\u4efb\u52a1\u6267\u884c\u5b8c\u6210 # ansible 192.168.77.131 -m async_status -a \"jid=71761724165.16525\" 192 .168.77.131 | CHANGED = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"ansible_job_id\" : \"71761724165.16525\" , \"changed\" : true, \"cmd\" : \"sleep 30\" , \"delta\" : \"0:00:30.059717\" , \"end\" : \"2020-04-03 22:09:37.777453\" , \"finished\" : 1 , \"rc\" : 0 , \"start\" : \"2020-04-03 22:09:07.717736\" , \"stderr\" : \"\" , \"stderr_lines\" : [] , \"stdout\" : \"\" , \"stdout_lines\" : [] } \u6ce8\u610f\uff1a\u5728\u4f7f\u7528'command', 'win_command', 'shell', 'win_shell', 'raw'\u6a21\u5757\u65f6\uff0c\u662f\u4e0d\u4f1a\u8fd4\u56de\u4fe1\u606f\u7684\u3002 \u9650\u5236\u5e76\u53d1\u8fd0\u884c\u7684\u4efb\u52a1\u6570\u91cf\u7684\u540c\u65f6\u8fd0\u884c\u591a\u4e2a\u5f02\u6b65\u4efb\u52a1 ##################### # main.yml ##################### - name : Run items asynchronously in batch of two items vars : sleep_durations : - 1 - 2 - 3 - 4 - 5 durations : \"{{ item }}\" include_tasks : execute_batch.yml loop : \"{{ sleep_durations | batch(2) | list }}\" ##################### # execute_batch.yml ##################### - name : Async sleeping for batched_items command : sleep {{ async_item }} async : 45 poll : 0 loop : \"{{ durations }}\" loop_control : loop_var : \"async_item\" register : async_results - name : Check sync status async_status : jid : \"{{ async_result_item.ansible_job_id }}\" loop : \"{{ async_results.results }}\" loop_control : loop_var : \"async_result_item\" register : async_poll_results until : async_poll_results.finished retries : 30 \u4e00\u4e2a\u91cd\u542f\u670d\u52a1\u5668\u7684playbook --- - hosts : 192.168.77.131 gather_facts : no become : yes tasks : - name : Check the uptime prior reboot shell : uptime register : UPTIME_PRE_REBOOT - debug : msg={{UPTIME_PRE_REBOOT.stdout}} - name : Reboot node and stop polling. shell : reboot async : 10 # Do not care for 10 sec poll : 0 # Fire & Forget - name : wait for host to finish reboot wait_for : port : \"{{ (ansible_port|default(ansible_ssh_port))|default(22) }}\" host : '{{ (ansible_ssh_host|default(ansible_host))|default(inventory_hostname) }}' search_regex : OpenSSH delay : 10 # Do not check for at least 10 sec connection : local - name : Check the uptime post reboot shell : uptime register : UPTIME_POST_REBOOT - debug : msg={{UPTIME_POST_REBOOT.stdout}}","title":"\u5f02\u6b65\u64cd\u4f5c\u548c\u8f6e\u8be2"},{"location":"basic/Playbook-features/#_5","text":"\u5f02\u6b65\u4efb\u52a1\u7684\u72b6\u6001\u6587\u4ef6\u4ee5jid\u547d\u540d\u7684\u65b9\u5f0f\u5b58\u653e\u5728\u8fdc\u7aef\u4e3b\u673a\u7684\u7528\u6237\u76ee\u5f55\u4e0b\u7684.ansible_async\u76ee\u5f55\uff0c\u672c\u6b21\u4f7f\u7528\u7684\u662froot\u8fde\u63a5\u8fdc\u7aef\uff0c\u6240\u4ee5\u76ee\u5f55\u662f/root/.ansible_async\u3002 \u67e5\u770b\u72b6\u6001\u6587\u4ef6 # cat /root/.ansible_async/71761724165.16525 { \"started\" : 1 , \"finished\" : 0 , \"ansible_job_id\" : \"71761724165.16525\" } # \u4efb\u52a1\u7ed3\u675f\u540e # cat /root/.ansible_async/71761724165.16525 { \"changed\" : true, \"end\" : \"2020-04-03 22:09:37.777453\" , \"stdout\" : \"\" , \"cmd\" : \"sleep 30\" , \"start\" : \"2020-04-03 22:09:07.717736\" , \"delta\" : \"0:00:30.059717\" , \"stderr\" : \"\" , \"rc\" : 0 , \"invocation\" : { \"module_args\" : { \"warn\" : true, \"executable\" : null, \"_uses_shell\" : true, \"strip_empty_ends\" : true, \"_raw_params\" : \"sleep 30\" , \"removes\" : null, \"argv\" : null, \"creates\" : null, \"chdir\" : null, \"stdin_add_newline\" : true, \"stdin\" : null }}}","title":"\u5f02\u6b65\u4efb\u52a1\u7684\u72b6\u6001\u6587\u4ef6"},{"location":"basic/Playbook-features/#_6","text":"{ \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" }, \"ansible_job_id\" : \"662217446295.16055\" , \"changed\" : true , \"finished\" : 0 , \"results_file\" : \"/root/.ansible_async/662217446295.16055\" , \"started\" : 1 } ansible_job_id \u5f02\u6b65\u4efb\u52a1id\uff0c results_file\u5f02\u6b65\u4efb\u52a1\u7684\u72b6\u6001\u6587\u4ef6","title":"\u5f02\u6b65\u4efb\u52a1\u7684\u8fd4\u56de\u503c"},{"location":"basic/Playbook-features/#_7","text":"\u53ef\u901a\u8fc7 async_status \u83b7\u53d6\uff0casync_status \u662f\u8bfb\u53d6\u8fdc\u7aef\u7684\u5f02\u6b65\u4efb\u52a1\u72b6\u6001\u6587\u4ef6\u6765\u83b7\u5f97\u4efb\u52a1\u72b6\u6001\uff0c\u5982\u679casync\u8bbe\u7f6e\u7684\u65f6\u95f4\u592a\u77ed\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u83b7\u53d6\u4e0d\u5230\u72b6\u6001\u6587\u4ef6\uff0c\u56e0\u4e3a\u8fd8\u6ca1\u751f\u6210\u8fd9\u4e2a\u6587\u4ef6\u3002 \u6267\u884c\u4e2d\u7684\u8fd4\u56de\u503c { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"ansible_job_id\" : \"71761724165.16525\" , \"changed\" : false, \"finished\" : 0 , \"started\" : 1 } \u6267\u884c\u5b8c\u6210\u540e\u7684\u8fd4\u56de\u503c { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"ansible_job_id\" : \"71761724165.16525\" , \"changed\" : true, \"cmd\" : \"sleep 30\" , \"delta\" : \"0:00:30.059717\" , \"end\" : \"2020-04-03 22:09:37.777453\" , \"finished\" : 1 , \"rc\" : 0 , \"start\" : \"2020-04-03 22:09:07.717736\" , \"stderr\" : \"\" , \"stderr_lines\" : [] , \"stdout\" : \"\" , \"stdout_lines\" : [] }","title":"\u5f02\u6b65\u4efb\u52a1\u72b6\u6001\u7684\u8fd4\u56de\u503c"},{"location":"basic/Playbook-features/#_8","text":"\u5f53ansible-playbook\u6267\u884c\u65f6\u52a0\u4e0a --check \u9009\u9879\u65f6\uff0c\u5b83\u4e0d\u4f1a\u5bf9\u8fdc\u7a0b\u7cfb\u7edf\u505a\u4efb\u4f55\u66f4\u6539\u3002\u652f\u6301\u68c0\u67e5\u6a21\u5f0f\u7684\u6a21\u5757\u5c06\u62a5\u544a\u5b83\u4eec\u5c06\u8fdb\u884c\u7684\u66f4\u6539\uff0c\u800c\u4e0d\u662f\u8fdb\u884c\u66f4\u6539\u3002\u4e0d\u652f\u6301\u68c0\u67e5\u6a21\u5f0f\u7684\u5176\u4ed6\u6a21\u5757\u4e5f\u5c06\u4e0d\u91c7\u53d6\u4efb\u4f55\u64cd\u4f5c\uff0c\u53ea\u662f\u4e0d\u62a5\u544a\u5b83\u4eec\u53ef\u80fd\u505a\u4e86\u54ea\u4e9b\u66f4\u6539\u3002 \u6267\u884c\u4f8b\u5b50 ansible-playbook foo.yml --check \u4e5f\u53ef\u4ee5\u5728\u4efb\u52a1\u4e2d\u4f7f\u7528\u68c0\u67e5\u6a21\u5f0f tasks : - name : this task will make changes to the system even in check mode command : /something/to/run --even-in-check-mode check_mode : no - name : this task will always run under checkmode and not change the system lineinfile : line : \"important config\" dest : /path/to/myconfig.conf state : present check_mode : yes ansible_check_mode \u53d8\u91cf\u662f\u7528\u6765\u5b58\u50a8\u5f53\u524d\u662f\u5426\u662f\u68c0\u67e5\u6a21\u5f0f\u7684\u5e03\u5c14\u7c7b\u578b tasks : - name : this task will be skipped in check mode git : repo : ssh://git@github.com/mylogin/hello.git dest : /home/mylogin/hello when : not ansible_check_mode - name : this task will ignore errors in check mode git : repo : ssh://git@github.com/mylogin/hello.git dest : /home/mylogin/hello ignore_errors : \"{{ ansible_check_mode }}\" diff\u6a21\u5757 ansible-playbook\u7684 --diff \u9009\u9879\u53ef\u4e0e --check \u914d\u5408\u4f7f\u7528\uff08\u5982\u4e0a\u8be6\u8ff0\uff09\uff0c\u4f46\u4e5f\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\u3002 \u63d0\u4f9b\u6b64\u6807\u5fd7\u4e14\u6a21\u5757\u652f\u6301\u6b64\u6807\u5fd7\u65f6\uff0cAnsible\u5c06\u62a5\u544a\u6240\u505a\u7684\u66f4\u6539\uff0c\u6216\u8005\u5982\u679c\u4e0e --check \u4e00\u8d77\u4f7f\u7528\uff0c\u5219\u5c06\u62a5\u544a\u6240\u505a\u7684\u66f4\u6539\u3002 - hosts : localhost tasks : - name : debug. debug : msg=123 check_mode : no - name : add hosts. lineinfile : line : \"127.0.0.2 localhost\" dest : /etc/hosts state : present check_mode : yes - name : add hosts. lineinfile : line : \"127.0.0.2 localhost\" dest : /etc/hosts state : present diff : no diff: no \u7981\u6b62\u5bf9\u6bd4 \u68c0\u67e5\u5e76\u5bf9\u6bd4\u66f4\u6539 ansible-playbook foo.yml --check --diff","title":"\u68c0\u67e5\u6a21\u5f0f"},{"location":"basic/Playbook-features/#debug","text":"Ansible\u628a\u4e00\u4e2a debugger \u4f5c\u4e3a strategy \u63d2\u4ef6\u7684\u4e00\u90e8\u5206\u3002\u6b64\u8c03\u8bd5\u5668\u4f7f\u60a8\u80fd\u591f\u4f5c\u4e3a\u4efb\u52a1\u8fdb\u884c\u8c03\u8bd5\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u963b\u585e\u8fd0\u884c\u7684\u3002\u4f46\u4f7f\u7528 debug \u6a21\u5757\u4e5f\u53ef\u4ee5\u8c03\u8bd5\u53d8\u91cf\u6216\u8868\u8fbe\u5f0f\uff0c\u800c\u4e0d\u5fc5\u963b\u585eplaybook\u3002 \u6709\u591a\u79cd\u4f7f\u7528\u8c03\u8bd5\u5668\u7684\u65b9\u6cd5\u3002","title":"debug \u529f\u80fd"},{"location":"basic/Playbook-features/#debugger","text":"debugger\u63d0\u4f9b\u51e0\u4e2a\u503c \u53ef\u9009\u503c \u8bf4\u660e always \u603b\u662f\u8c03\u7528\u8c03\u8bd5\u5668\uff0c\u800c\u4e0d\u7ba1\u7ed3\u679c\u5982\u4f55 never \u4e0d\u7ba1\u7ed3\u679c\u5982\u4f55\uff0c\u90fd\u4e0d\u8981\u8c03\u7528\u8c03\u8bd5\u5668 on_failed \u53ea\u6709\u5728\u4efb\u52a1\u5931\u8d25\u65f6\u624d\u8c03\u7528\u8c03\u8bd5\u5668 on_unreachable \u53ea\u6709\u5728\u4e3b\u673a\u65e0\u6cd5\u8bbf\u95ee\u65f6\u624d\u8c03\u7528\u8c03\u8bd5\u5668 on_skipped \u53ea\u6709\u5728\u4efb\u52a1\u88ab\u8df3\u8fc7\u65f6\u624d\u8c03\u7528\u8c03\u8bd5\u5668 \u5728play\u4e2d\u4f7f\u7528 - name : Play hosts : all debugger : on_skipped tasks : - name : Execute a command command : true when : False \u5728task\u4e2d\u4f7f\u7528 - name : Execute a command command : false debugger : on_failed \u5f53play\u548ctask\u540c\u65f6\u4f7f\u7528 debugger \u65f6\uff0ctask\u7684\u751f\u6548 - name : Play hosts : all debugger : never tasks : - name : Execute a command command : false debugger : on_failed","title":"\u4f7f\u7528 debugger \u5173\u952e\u5b57"},{"location":"basic/Playbook-features/#_9","text":"\u5728 ansible.cfg \u4e0a\u914d\u7f6e [defaults] enable_task_debugger = True \u6216\u8005\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf ANSIBLE_ENABLE_TASK_DEBUGGER = True ansible-playbook -i hosts site.yml","title":"\u914d\u7f6e\u6216\u73af\u5883\u53d8\u91cf"},{"location":"basic/Playbook-features/#strategy","text":"\u4f7f\u7528 strategy \u63d2\u4ef6 debug - hosts : test strategy : debug tasks : ... \u6216\u8005\u4fee\u6539\u914d\u7f6e\u548c\u73af\u5883\u53d8\u91cf [defaults] strategy = debug \u73af\u5883\u53d8\u91cf ANSIBLE_STRATEGY = debug","title":"\u4f7f\u7528 strategy \u63d2\u4ef6"},{"location":"basic/Playbook-features/#debugger_1","text":"\u4f7f\u7528\u4ee5\u4e0b\u4f8b\u5b50 - hosts : 192.168.77.131 debugger : on_failed gather_facts : no vars : var1 : value1 tasks : - name : wrong variable ping : data={{ wrong_var }} \u4ee5\u4e0aplaybook\uff0c\u5728\u6267\u884c\u5230\u9519\u8bef\u7684\u4efb\u52a1\u65f6\uff0c\u4f1a\u8fdb\u5165debug\u6a21\u5f0f\u4e0b # ansible-playbook debuger.yaml PLAY [ 192 .168.77.131 ] ***************************************************************************************** TASK [ wrong variable ] ***************************************************************************************** fatal: [ 192 .168.77.131 ] : FAILED! = > { \"msg\" : \"The task includes an option with an undefined variable. The error was: 'wrong_var' is undefined\\n\\nThe error appears to be in '/etc/ansible/debuger.yaml': line 7, column 7, but may\\nbe elsewhere in the file depending on the exact syntax problem.\\n\\nThe offending line appears to be:\\n\\n tasks:\\n - name: wrong variable\\n ^ here\\n\" } [ 192 .168.77.131 ] TASK: wrong variable ( debug ) > p result._result { '_ansible_no_log' : False, 'failed' : True, 'msg' : u \"The task includes an option with an undefined variable. The error was: 'wrong_var' is undefined\\n\\nThe error appears to be in '/etc/ansible/debuger.yaml': line 7, column 7, but may\\nbe elsewhere in the file depending on the exact syntax problem.\\n\\nThe offending line appears to be:\\n\\n tasks:\\n - name: wrong variable\\n ^ here\\n\" } [ 192 .168.77.131 ] TASK: wrong variable ( debug ) > p task.args { u 'data' : u '{{ wrong_var }}' } [ 192 .168.77.131 ] TASK: wrong variable ( debug ) > task.args [ 'data' ] = '{{ var1 }}' [ 192 .168.77.131 ] TASK: wrong variable ( debug ) > p task.args { u 'data' : '{{ var1 }}' } [ 192 .168.77.131 ] TASK: wrong variable ( debug ) > redo ok: [ 192 .168.77.131 ] PLAY RECAP ***************************************************************************************** 192 .168.77.131 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u901a\u8fc7\u8c03\u8bd5\uff0c\u6211\u4eec\u4f7fplaybook\u4ee5\u6210\u529f\u8fd0\u884c\u5b8c\u6bd5\u3002 debugger \u6a21\u5f0f\u4e0b\u7684\u53ef\u7528\u6307\u4ee4 \u6307\u4ee4 \u8bf4\u660e p \u663e\u793a\u6b64\u6b21\u5931\u8d25\u7684\u539f\u56e0 p task \u663e\u793a\u6b64\u6b21\u4efb\u52a1\u7684\u540d\u79f0 p task.args \u663e\u793a\u6a21\u5757\u7684\u53c2\u6570 p task_vars \u663e\u793a\u4efb\u52a1\u7684\u53ef\u7528\u53d8\u91cf p host \u663e\u793a\u6267\u884c\u6b64\u6b21\u4efb\u52a1\u7684\u4e3b\u673a p result \u663e\u793a\u6b64\u6b21\u4efb\u52a1\u7684\u7ed3\u679c p vars \u663e\u793a\u5f53\u524d\u7684\u53d8\u91cf vars[key] = value \u66f4\u65b0vars\u4e2d\u7684\u503c task.args[key] = value \u66f4\u65b0\u6a21\u5757\u7684\u53c2\u6570\u3002 u(pdate_task) \u4ece\u539f\u59cb\u4efb\u52a1\u6570\u636e\u7ed3\u6784\u548c\u5e26\u6709\u66f4\u65b0\u7684task_vars\u7684\u6a21\u677f\u4e2d\u91cd\u65b0\u521b\u5efa\u4efb\u52a1 r(edo) \u518d\u6b21\u6267\u884c\u6b64\u4efb\u52a1 c(ontinue) \u7ee7\u7eed\u6267\u884c q(uit) \u9000\u51fadebug\u6a21\u5f0f","title":"\u8c03\u8bd5 debugger"},{"location":"basic/Playbook-features/#free","text":"\u5f53 debugger \u4e0e free \u7b56\u7565\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u5728\u8c03\u8bd5\u5668\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u65f6\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u5176\u4ed6\u4efb\u52a1\u6392\u961f\u6216\u6267\u884c\u3002\u4f46\u4f7f\u7528 redo \u65f6\uff0c\u53ef\u80fd\u56de\u5bfc\u81f4\u5f53\u524d\u4efb\u52a1\u5728\u5176\u4ed6\u4efb\u52a1\u4e4b\u540e\u6267\u884c","title":"\u4e0efree\u7b56\u7565\u4e00\u8d77\u4f7f\u7528"},{"location":"basic/Playbook-features/#debug_1","text":"\u5728\u6267\u884c\u671f\u95f4\u6253\u5370\u8bed\u53e5\uff0c\u4f7f\u7528 debug \u6a21\u5757\u53ef\u4ee5\u8c03\u8bd5\u53d8\u91cf\u6216\u8868\u8fbe\u5f0f\uff0c\u800c\u4e0d\u5fc5\u963b\u585eplaybook\u3002 \u6253\u5370\u81ea\u5b9a\u4e49\u7684\u4fe1\u606f tasks : - debug : msg=\"System {{ inventory_hostname }} has uuid {{ ansible_product_uuid }}\" \u8c03\u8bd5\u53d8\u91cf tasks : - debug : var=result verbosity=2","title":"\u4f7f\u7528 debug \u6a21\u5757"},{"location":"basic/Playbook-features/#_10","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAnsible\u4f1a\u5e76\u884c\u5730\u7ba1\u7406\u4e00\u4e2a\u5267\u672c\u4e2d\u5f15\u7528\u7684\u6240\u6709\u673a\u5668\u3002\u5bf9\u4e8e\u6eda\u52a8\u66f4\u65b0\u7528\u4f8b\uff0c\u53ef\u4ee5\u4f7f\u7528 serial \u5173\u952e\u5b57\u5b9a\u4e49Ansible\u5e76\u884c\u6267\u884c\u591a\u5c11\u53f0\u4e3b\u673a --- - name : test play hosts : webservers serial : 3 gather_facts : False tasks : - name : task one command : hostname - name : task two command : hostname \u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u6709100\u4e2a\u4e3b\u673a\uff0c\u7ec4\u201cwebservers\u201d\u4e2d\u76843\u4e2a\u4e3b\u673a\u5c06\u5b8c\u6210playbook\uff0c\u7136\u540e\u518d\u79fb\u52a8\u5230\u63a5\u4e0b\u6765\u76843\u4e2a\u4e3b\u673a\u3002 \u8fd8\u53ef\u4ee5\u4f7f\u7528\u767e\u5206\u6bd4 serial : \"30%\" \u4eceAnsible 2.2\u5f00\u59cb\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u5217\u8868\u4f5c\u4e3a\u6279\u91cf\u6267\u884c\u7684\u4f9d\u636e --- - name : test play hosts : webservers serial : - 1 - 5 - 10 \u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u7b2c\u4e00\u6279\u6267\u884c\u5c06\u5305\u542b\u4e00\u4e2a\u4e3b\u673a\uff0c\u4e0b\u4e00\u6279\u5c06\u5305\u542b5\u4e2a\u4e3b\u673a\uff0c\u5e76\u4e14(\u5982\u679c\u8fd8\u5269\u4e0b\u4efb\u4f55\u4e3b\u673a)\uff0c\u63a5\u4e0b\u6765\u7684\u6bcf\u4e00\u6279\u5c06\u5305\u542b10\u4e2a\u4e3b\u673a\uff0c\u76f4\u5230\u6240\u6709\u53ef\u7528\u7684\u4e3b\u673a\u90fd\u88ab\u4f7f\u7528\u3002 \u53ef\u4ee5\u5728\u5217\u8868\u4e2d\u4f7f\u7528\u767e\u5206\u6bd4 --- - name : test play hosts : webservers serial : - \"10%\" - \"20%\" - \"100%\" \u4e5f\u53ef\u4ee5\u6df7\u5408\u4f7f\u7528 --- - name : test play hosts : webservers serial : - 1 - 5 - \"20%\"","title":"\u6eda\u52a8\u6267\u884c"},{"location":"basic/Playbook-features/#_11","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53ea\u8981\u7ec4\u4e2d\u6709\u5c1a\u672a\u5931\u8d25\u7684\u4e3b\u673a\uff0cAnsible\u5c06\u7ee7\u7eed\u6267\u884c\u64cd\u4f5c\u3002 \u5728\u4e00\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f8b\u5982\u5229\u7528\u4e0a\u8ff0\u6eda\u52a8\u66f4\u65b0\uff0c\u53ef\u80fd\u5e0c\u671b\u5728\u8fbe\u5230\u5931\u8d25\u7684\u7279\u5b9a\u9608\u503c\u65f6\u4e2d\u6b62\u4efb\u52a1\u3002 --- - hosts : webservers max_fail_percentage : 30 serial : 10 \u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u5982\u679c\u7ec4\u4e2d\u768410\u53f0\u670d\u52a1\u5668\u4e2d\u67093\u53f0\u4ee5\u4e0a\u53d1\u751f\u6545\u969c\uff0c\u5219\u5c06\u7ec8\u6b62\u5176\u4f59\u7684\u64cd\u4f5c\u3002","title":"\u6307\u5b9a\u6700\u5927\u5931\u8d25\u6570\u76ee"},{"location":"basic/Playbook-features/#_12","text":"\u5728\u4efb\u52a1\u4e0a\u4f7f\u7528 delegate_to \u5173\u952e\u5b57,\u53ef\u4ee5\u5c06\u4efb\u52a1\u59d4\u6258\u7ed9\u6307\u5b9a\u4e3b\u673a\u53bb\u6267\u884c\u3002 --- - hosts : webservers serial : 5 tasks : - name : take out of load balancer pool command : /usr/bin/take_out_of_pool {{ inventory_hostname }} delegate_to : 127.0.0.1 - name : actual steps would go here yum : name : acme-web-stack state : latest - name : add back to load balancer pool command : /usr/bin/add_back_to_pool {{ inventory_hostname }} delegate_to : 127.0.0.1 delegate_to: 127.0.0.1 \u662f\u5c06\u4efb\u52a1\u59d4\u6d3e\u5230ansible\u672c\u5730\u53bb\u6267\u884c\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u7b80\u5199\u7684 local_action \u53bb\u6267\u884c --- # ... tasks : - name : take out of load balancer pool local_action : command /usr/bin/take_out_of_pool {{ inventory_hostname }} # ... - name : add back to load balancer pool local_action : command /usr/bin/add_back_to_pool {{ inventory_hostname }} \u4e00\u4e2a\u4f8b\u5b50 - hosts : db_servers tasks : - name : ifconfig command : fconfig delegate_to : 127.0.0.1 - name : ifconfig local_action : command ifconfig - hosts : app_servers tasks : - name : gather facts from db servers setup : delegate_to : \"{{item}}\" delegate_facts : True with_items : \"{{groups['dbservers']}}\" delegate_facts \u6307\u5b9a\u6536\u96c6\u59d4\u6258\u4e3b\u673a\u7684facts\u6570\u636e \u4ee5\u4e0a\u5c06\u4e3a dbservers \u7ec4\u4e2d\u7684\u673a\u5668\u6536\u96c6 facts \uff0c\u5e76\u5c06 facts \u5206\u914d\u7ed9\u8fd9\u4e9b\u673a\u5668\uff0c\u800c\u4e0d\u662f app_servers \u3002","title":"\u59d4\u6258"},{"location":"basic/Playbook-features/#_13","text":"\u901a\u8fc7\u5728\u4efb\u52a1\u4e0a\u914d\u7f6e run_once \u6765\u5b9e\u73b0\u5f53\u524d\u4efb\u52a1\u5728 play \u4e2d\u53ea\u6267\u884c\u4e00\u6b21 - tasks : - command : ifconfig run_once : true \u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u5c06\u53ea\u4f1a\u5728\u7b2c\u4e00\u4e2a\u6267\u884c\u4e3b\u673a\u4e0a\u6267\u884c\uff0c\u5176\u4f59\u7684\u4e3b\u673a\u5219\u4e0d\u6267\u884c\u3002 \u6709\u70b9\u7c7b\u4f3c\u4e8e\u4f7f\u7528when\u6761\u4ef6\u5224\u65ad - command : /opt/application/upgrade_db.py when : inventory_hostname == webservers[0]","title":"\u4efb\u52a1\u53ea\u8fd0\u884c\u4e00\u6b21"},{"location":"basic/Playbook-features/#_14","text":"\u4e3aplaybook\u6307\u5b9a connection=local \u5c06\u4f1a\u4f7f\u4efb\u52a1\u5728\u672c\u5730\u6267\u884c\uff0c\u800c\u4e0d\u662f\u4f7f\u7528ssh\u8fde\u63a5\u8fdc\u7aef\u3002 \u6267\u884cplaybook ansible-playbook playbook.yml --connection = local \u5728play\u4e2d\u6307\u5b9a --- - hosts : 127.0.0.1 connection : local","title":"\u672c\u5730\u6267\u884c"},{"location":"basic/Playbook-features/#_15","text":"\u4e3a\u8fd0\u884c\u7a0b\u5e8f\u6307\u5b9a\u73af\u5883\u53d8\u91cf\uff0c\u9700\u6307\u5b9a environment \u5173\u952e\u5b57 - tasks : - apt : name=cobbler state=installed environment : http_proxy : http://proxy.example.com:8080 PATH : /var/local/nvm/versions/node/v4.2.1/bin:{{ ansible_env.PATH }} \u4e5f\u53ef\u4ee5\u5728play\u7ea7\u522b\u4f7f\u7528 - hosts : testhost roles : - php - nginx environment : http_proxy : http://proxy.example.com:8080","title":"\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf"},{"location":"basic/Playbook-features/#_16","text":"","title":"\u9519\u8bef\u5904\u7406"},{"location":"basic/Playbook-features/#_17","text":"ignore_errors \u6a21\u5757\u53ef\u4ee5\u5728\u4efb\u52a1\u6267\u884c\u9519\u8bef\u65f6\uff0c\u5ffd\u7565\u9519\u8bef\u5e76\u7ee7\u7eed\u6267\u884c\u4efb\u52a1\u3002 - tasks : - command : /bin/false ignore_errors : true - debug : msg=\"false\"","title":"\u5ffd\u7565\u9519\u8bef"},{"location":"basic/Playbook-features/#_18","text":"\u8fde\u63a5\u8fdc\u7aef\u4e3b\u673a\u5931\u8d25\u65f6\uff0cansible\u4f1a\u5c06\u4e3b\u673a\u8bbe\u7f6e\u4e3a\u4e0d\u53ef\u5230\u8fbe\uff0c\u8fd9\u5c06\u4ece\u8fd0\u884c\u7684\u6d3b\u52a8\u4e3b\u673a\u5217\u8868\u4e2d\u5220\u9664\u5b83\u4eec\u3002\u8981\u4ece\u8fd9\u4e9b\u95ee\u9898\u4e2d\u6062\u590d\uff0c\u9700\u6267\u884c\u4e0b\u5217\u52a8\u4f5c\u6062\u590d\u4e3b\u673a\u3002 - meta : clear_host_errors","title":"\u91cd\u7f6e\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a"},{"location":"basic/Playbook-features/#handlers","text":"\u4ee5\u4e0b3\u4e2d\u65b9\u6cd5\u5747\u53ef\u4f7f\u7528 \u547d\u4ee4\u884c\u52a0\u4e0a --force-handlers \u53c2\u6570 \u914d\u7f6e\u6587\u4ef6\u52a0\u4e0a force_handlers = True playbook\u91cc\u8bbe\u7f6e force_handlers: True","title":"\u5373\u4f7f\u4efb\u52a1\u5931\u8d25\uff0chandlers\u4e5f\u6267\u884c"},{"location":"basic/Playbook-features/#_19","text":"\u4f7f\u7528 failed_when \u9009\u9879\u65f6\uff0c\u5f53\u6761\u4ef6\u4e3a\u771f\u65f6\uff0c\u53ef\u4f7f\u5f53\u524d\u4efb\u52a1\u4ee5\u5931\u8d25\u8fd4\u56de \u60a8\u53ef\u4ee5\u901a\u8fc7\u5728\u547d\u4ee4\u7684\u8f93\u51fa\u4e2d\u641c\u7d22\u4e00\u4e2a\u5355\u8bcd\u6216\u77ed\u8bed\u6765\u68c0\u67e5\u662f\u5426\u547d\u4ee4\u6267\u884c\u662f\u5426\u5931\u8d25 - name : Fail task when the command error output prints FAILED command : /usr/bin/example-command -x -y -z register : command_result failed_when : \"'FAILED' in command_result.stderr\" \u6216\u8005\u6839\u636e\u8fd4\u56de\u503c - name : Fail task when both files are identical raw : diff foo/file1 bar/file2 register : diff_cmd failed_when : diff_cmd.rc == 0 or diff_cmd.rc >= 2 \u5728\u4ee5\u524d\u7684\u7248\u672c\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u5b8c\u6210\u4e0a\u8ff0\u64cd\u4f5c - name : this command prints FAILED when it fails command : /usr/bin/example-command -x -y -z register : command_result ignore_errors : True - name : fail the play if the previous command did not succeed fail : msg : \"the command failed\" when : \"'FAILED' in command_result.stderr\" \u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u5e76\u884c\u6761\u4ef6\uff0c\u8fd9\u4e9b\u6761\u4ef6\u4e4b\u95f4\u662f and \u5173\u7cfb - name : Check if a file exists in temp and fail task if it does command : ls /tmp/this_should_not_be_here register : result failed_when : - result.rc == 0 - '\"No such\" not in result.stdout' \u4f7f\u7528 or \u6761\u4ef6 failed_when : result.rc == 0 or \"No such\" not in result.stdout \u5982\u679c\u4e00\u884c\u5199\u4e0d\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u591a\u884c\u8868\u793a - name : example of many failed_when conditions with OR shell : \"./myBinary\" register : ret failed_when : > (\"No such file or directory\" in ret.stdout) or (ret.stderr != '') or (ret.rc == 10)","title":"\u63a7\u5236\u4efb\u52a1\u5931\u8d25"},{"location":"basic/Playbook-features/#changed","text":"\u6307\u5b9a changed_when \u6761\u4ef6\u65f6\uff0c\u5f53\u6761\u4ef6\u4e3a\u771f\uff0c\u4efb\u52a1\u7684 changed \u4e3a\u771f\uff0c\u5373\u8868\u793a\u5f53\u524d\u4efb\u52a1\u505a\u4e86\u66f4\u6539\u3002 tasks : - shell : /usr/bin/billybass --mode=\"take me to the river\" register : bass_result changed_when : \"bass_result.rc != 2\" # this will never report 'changed' status - shell : wall 'beep' changed_when : False \u4f7f\u7528\u591a\u4e2a\u6761\u4ef6 - command : /bin/fake_command register : result ignore_errors : True changed_when : - '\"ERROR\" in result.stderr' - result.rc == 2","title":"\u66f4\u6539\u4efb\u52a1changed\u72b6\u6001"},{"location":"basic/Playbook-features/#_20","text":"\u4f7f\u7528 any_errors_fatal \u9009\u9879\u65f6\uff0c\u53ea\u8981playbook\u4e2d\u51fa\u73b0\u4e00\u4e2a\u9519\u8bef\u4efb\u52a1,ansible\u7acb\u5373\u505c\u6b62\u8fd0\u884c\u3002\u5df2\u4fdd\u8bc1\u6240\u6709\u4efb\u52a1\u7684\u6b63\u786e\u8fd0\u884c\u3002 --- - hosts : load_balancers_dc_a any_errors_fatal : True tasks : - name : 'shutting down datacenter [ A ]' command : /usr/bin/disable-dc - hosts : frontends_dc_a tasks : - name : 'stopping service' command : /usr/bin/stop-software - name : 'updating software' command : /usr/bin/upgrade-software - hosts : load_balancers_dc_a tasks : - name : 'Starting datacenter [ A ]' command : /usr/bin/enable-dc","title":"\u51fa\u73b0\u9519\u8bef\u65f6\u7acb\u5373\u4e2d\u65ad\u6267\u884c"},{"location":"basic/Playbook-features/#blocks","text":"\u4f7f\u7528 blocks \u7684 rescue \u6765\u5b9e\u73b0\u5bf9\u9519\u8bef\u4efb\u52a1\u7684\u5904\u7406 tasks : - name : Handle the error block : - debug : msg : 'I execute normally' - name : i force a failure command : /bin/false - debug : msg : 'I never execute, due to the above task failing, :-(' rescue : - debug : msg : 'I caught an error, can do stuff here to fix it, :-)'","title":"\u4f7f\u7528blocks"},{"location":"basic/Playbook-features/#yaml","text":"YAML \u8bed\u6cd5\u89c1 \u8be6\u7ec6\u4ecb\u7ecd","title":"YAML \u8bed\u6cd5"},{"location":"basic/Playbook-features/#prompts","text":"\u5728\u8fd0\u884cplaybook\u65f6\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u63d0\u793a\u7528\u6237\u8f93\u5165\u67d0\u4e9b\u5185\u5bb9\uff0c\u53ef\u4ee5\u901a\u8fc7 vars_prompt \u5b9e\u73b0\u8fd9\u4e00\u70b9\u3002 - hosts : test gather_facts : no vars_prompt : - name : \"name\" prompt : \"what is your name?\" default : \"user\" private : yes confirm : yes tasks : - debug : msg={{ name }} vars_prompt \u7684\u53c2\u6570 name: \u5b9a\u4e49\u53d8\u91cf\u540d\u79f0\uff0c\u5373\u8f93\u5165\u7684\u5185\u5bb9\u8d4b\u503c\u7ed9\u6b64\u53d8\u91cf prompt\uff1a\u8f93\u5165\u5f97\u63d0\u793a\u4fe1\u606f default\uff1a \u8f93\u5165\u7684\u9ed8\u8ba4\u503c\uff0c\u6ca1\u6709\u8f93\u5165\u4efb\u4f55\u5185\u5bb9\u7684\u65f6\u5019\uff0c\u628a\u6b64\u503c\u8d4b\u503c\u7ed9\u53d8\u91cf private\uff1a\u662f\u5426\u9690\u85cf\u8f93\u5165\u5f97\u5185\u5bb9 confirm\uff1a\u662f\u5426\u8981\u518d\u6b21\u786e\u8ba4\u8f93\u5165 unsafe: \u4e0d\u6821\u9a8c\u8f93\u5165\u7684\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u8f93\u5165\u7279\u6b8a\u5b57\u7b26\uff0c\u53ef\u5f00\u542f\u6b64\u9009\u9879 \u5982\u679c\u5b89\u88c5\u4e86 Passlib , vars_prompt \u8fd8\u53ef\u4ee5\u5bf9\u8f93\u5165\u7684\u503c\u8fdb\u884c\u52a0\u5bc6 - hosts : test gather_facts : no vars_prompt : - name : \"pass\" prompt : \"Enter password2\" private : yes encrypt : \"sha512_crypt\" confirm : yes salt_size : 7 tasks : - debug : msg={{ pass }} \u53ef\u4ee5\u4f7f\u7528\u7684\u52a0\u5bc6\u65b9\u6848 des_crypt - DES Crypt bsdi_crypt - BSDi Crypt bigcrypt - BigCrypt crypt16 - Crypt16 md5_crypt - MD5 Crypt bcrypt - BCrypt sha1_crypt - SHA-1 Crypt sun_md5_crypt - Sun MD5 Crypt sha256_crypt - SHA-256 Crypt sha512_crypt - SHA-512 Crypt apr_md5_crypt - Apache\u2019s MD5-Crypt variant phpass - PHPass\u2019 Portable Hash pbkdf2_digest - Generic PBKDF2 Hashes cta_pbkdf2_sha1 - Cryptacular\u2019s PBKDF2 hash dlitz_pbkdf2_sha1 - Dwayne Litzenberger\u2019s PBKDF2 hash scram - SCRAM Hash bsd_nthash - FreeBSD\u2019s MCF-compatible nthash encoding","title":"Prompts\uff1a \u8fd0\u884c\u65f6\uff0c\u63d0\u793a\u8f93\u5165\u5185\u5bb9"},{"location":"basic/Playbook-features/#_21","text":"\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u5927\u578b\u5267\u672c\uff0c\u4f46\u4f60\u53ea\u5e0c\u671b\u8fd0\u884c\u5b83\u7684\u4e00\u4e2a\u7279\u5b9a\u7684\u90e8\u5206\uff0c\u800c\u4e0d\u662f\u8fd0\u884c\u5267\u672c\u4e2d\u7684\u6240\u6709\u4efb\u52a1\u3002\u8fd9\u65f6\u5019\uff0c\u4f60\u53ef\u4ee5\u4e3a\u8fd0\u884c\u7684\u4efb\u52a1\u6307\u5b9a\u4e00\u4e2a\u5171\u540c\u7684 tags","title":"\u6807\u8bb0"},{"location":"basic/Playbook-features/#_22","text":"tasks : - yum : name : - httpd - memcached state : present tags : - packages - template : src : templates/src.j2 dest : /etc/foo.conf tags : - configuration \u6807\u7b7e\u540d\u79f0\u53ef\u4ee5\u91cd\u540d \u663e\u793aplaybook\u4e2d\u7684\u6240\u6709\u6807\u8bb0\u4efb\u52a1 ansible-playbook example.yml --list-tags \u6267\u884c\u6240\u6709\u6807\u8bb0\u540d\u79f0\u4e3apackages\u548cconfiguration\u7684\u4efb\u52a1 ansible-playbook example.yml --tags \"configuration,packages\" \u8df3\u8fc7\u6240\u6709\u6807\u8bb0\u540d\u79f0\u4e3aconfiguration\u7684\u4efb\u52a1 ansible-playbook example.yml --skip-tags \"configuration\"","title":"\u6807\u8bb0\u4efb\u52a1"},{"location":"basic/Playbook-features/#playbook","text":"- hosts : all tags : - bar tasks : ... - hosts : all tags : [ 'foo' ] tasks : ... play\u91cc\u7684\u6240\u6709tasks\u5c06\u4f1a\u7ee7\u627fplay\u7684tags","title":"\u6807\u8bb0playbook"},{"location":"basic/Playbook-features/#role","text":"- roles : - { role : webserver , port : 5000 , tags : [ 'web' , 'foo' ] } role\u91cc\u7684tasks\u5c06\u4f1a\u7ee7\u627frole\u7684tags","title":"\u6807\u8bb0role"},{"location":"basic/Playbook-features/#_23","text":"- import_role : name : myrole tags : [ web , foo ] - import_tasks : foo.yml tags : [ web , foo ] \u5305\u542b\u7684role\u548ctasks\u4e2d\u7684\u4efb\u52a1\u5c06\u4f1a\u7ee7\u627ftags\uff0c\u52a8\u6001\u5305\u542b\u5219\u4e0d\u7ee7\u627ftag","title":"\u6807\u8bb0\u5305\u542b"},{"location":"basic/Playbook-features/#_24","text":"\u4f7f\u7528 always \u6807\u7b7e\u53ef\u4ee5\u59cb\u7ec8\u8fd0\u884c\u6807\u8bb0\u7684\u4efb\u52a1 tasks : - debug : msg : \"Always runs\" tags : - always - debug : msg : \"runs when you use tag1\" tags : - tag1 \u8fd8\u6709\u53e6\u59164\u4e2a\u7279\u6b8a\u5173\u952e\u5b57\u7528\u4e8e\u6807\u7b7e\uff0c never \u963b\u6b62\u4efb\u52a1\u8fd0\u884c tagged \u4ec5\u8fd0\u884c\u5df2\u6807\u8bb0 untagged \u8fd0\u884c\u53ea\u6709\u672a\u6807\u8bb0 all \u8fd0\u884c\u6240\u6709\u4efb\u52a1 \u9ed8\u8ba4\u60c5\u51b5\u4e0bansible\u8fd0\u884c\u5c31\u50cf\u6307\u5b9a\u4e86 -tags all","title":"\u7279\u6b8a\u6807\u8bb0"},{"location":"basic/Playbook-features/#vault","text":"Vault \u52a0\u5bc6\u4f7f\u7528\u65b9\u6cd5\u89c1 \u8be6\u7ec6\u4ecb\u7ecd","title":"Vault \u52a0\u5bc6"},{"location":"basic/Playbook-features/#_25","text":"\u4e3aansible-playbook\u6307\u5b9a --start-at-task \uff0c\u5c31\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u4efb\u52a1\u5f00\u59cb\u6267\u884c ansible-playbook playbook.yml --start-at-task = \"install packages\"","title":"\u4ece\u67d0\u4e2a\u4efb\u52a1\u5f00\u59cb\u6267\u884c"},{"location":"basic/Playbook-features/#_26","text":"ansible\u4e5f\u53ef\u4ee5\u4e00\u6b65\u4e00\u6b65\u4ea4\u4e92\u7684\u6267\u884c\uff0c\u6267\u884c\u6bcf\u4e00\u6b65\u90fd\u9700\u8981\u786e\u8ba4\u662f\u5426\u7ee7\u7eed ansible-playbook playbook.yml --step","title":"\u4e00\u6b65\u4e00\u6b65\u7684\u6267\u884c"},{"location":"basic/Playbook-features/#_27","text":"\u4f60\u53ef\u4ee5\u4e3a\u591a\u4e2a\u76f8\u540c\u7684\u6a21\u5757\u6307\u5b9a\u9ed8\u8ba4\u503c,\u800c\u4e0d\u5fc5\u91cd\u590d\u586b\u5199\u3002 - hosts : localhost module_defaults : file : owner : root group : root mode : 0755 tasks : - file : state : touch path : /tmp/file1 - file : state : touch path : /tmp/file2 - file : state : touch path : /tmp/file3 \u53ef\u4ee5\u5728play\u3001block\u548ctask\u7ea7\u522b\u4f7f\u7528module_defaults\u5c5e\u6027\u3002 - block : - debug : msg : \"a different message\" module_defaults : debug : msg : \"a default message\" - file : state : touch path : /tmp/file1 module_defaults : file : {} \u5728playbook\u4e2d\uff0c\u60a8\u53ef\u4ee5\u4e3a\u6574\u4e2a\u6a21\u5757\u7ec4\u8bbe\u7f6e\u6a21\u5757\u9ed8\u8ba4\u503c\uff0c\u4f8b\u5982\u8bbe\u7f6e\u4e00\u4e2a\u516c\u5171AWS\u533a\u57df\u3002 # example_play.yml - hosts : localhost module_defaults : group/aws : region : us-west-2 tasks : - aws_s3_bucket_info : # now the region is shared between both info modules - ec2_ami_info : filters : name : 'RHEL*7.5*' \u53ef\u7528\u4e8egroup\u7684\u6a21\u5757 Group Purpose Ansible Version aws Amazon Web Services 2.7 azure Azure 2.7 gcp Google Cloud Platform 2.7 k8s Kubernetes 2.8 os OpenStack 2.8","title":"\u6a21\u5757\u9ed8\u8ba4\u503c"},{"location":"basic/Playbook-features/#_28","text":"\u4f7f\u7528 wait_for \u6a21\u5757\uff0c\u53ef\u4ee5\u7b49\u5f85\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u624d\u53ef\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u7684\u4efb\u52a1\u3002 \u7b49\u5f85\u7aef\u53e3\u53ef\u7528,\u624d\u80fd\u7ee7\u7eed\u6267\u884c\u4efb\u52a1 - wait_for : port=8000 delay=10 \u7b49\u5f85\u76f4\u5230\u9501\u5b9a\u6587\u4ef6\u88ab\u5220\u9664 wait_for : path=/var/lock/file.lock state=absent","title":"\u7b49\u5f85"},{"location":"basic/Playbook-features/#playbook_1","text":"Playbook \u53ef\u7528\u7684\u5173\u952e\u5b57\u89c1 \u8be6\u7ec6\u5217\u8868","title":"Playbook \u5173\u952e\u5b57"},{"location":"basic/Playbook-features/#lookup","text":"lookup \u63d2\u4ef6\u5141\u8bb8\u8bbf\u95ee\u5916\u90e8\u6570\u636e\u6e90\u3002\u4e0e\u6240\u6709\u6a21\u677f\u4e00\u6837\uff0c\u8fd9\u4e9b\u63d2\u4ef6\u662f\u5728Ansible control\u8282\u70b9\u4e0a\u6267\u884c\u7684\u3002","title":"lookup \u63d2\u4ef6"},{"location":"basic/Playbook-features/#file","text":"--- - hosts : all vars : contents : \"{{ lookup('file', '/etc/foo.txt') }}\" tasks : - debug : msg=\"the value of foo.txt is {{ contents }}\"","title":"\u4f7f\u7528 file \u83b7\u53d6\u6587\u4ef6\u5185\u5bb9"},{"location":"basic/Playbook-features/#env","text":"--- - hosts : all vars : local_home : \"{{ lookup('env','HOME') }}\" tasks : - debug : var=local_home","title":"\u4f7f\u7528 env \u83b7\u53d6\u53d8\u91cf"},{"location":"basic/Playbook-features/#password","text":"--- - hosts : all tasks : # \u4f7f\u7528\u53ea\u6709ascii\u5b57\u6bcd\u4e14\u957f\u5ea6\u4e3a8\u7684\u968f\u673a\u5bc6\u7801\u521b\u5efa\u4e00\u4e2amysql\u7528\u6237: - mysql_user : name={{ client }} password=\"{{ lookup('password', '/tmp/passwordfile chars=ascii_letters length=8') }}\" priv={{ client }}_{{ tier }}_{{ role }}.*:ALL # \u4f7f\u7528\u53ea\u6709\u6570\u5b57\u7684\u968f\u673a\u5bc6\u7801\u521b\u5efa\u4e00\u4e2amysql\u7528\u6237: - mysql_user : name={{ client }} password=\"{{ lookup('password', '/tmp/passwordfile chars=digits') }}\" priv={{ client }}_{{ tier }}_{{ role }}.*:ALL # \u4f7f\u7528\u8bb8\u591a\u4e0d\u540c\u7684\u5b57\u7b26\u96c6\u4f7f\u7528\u968f\u673a\u5bc6\u7801\u521b\u5efa\u4e00\u4e2amysql\u7528\u6237\uff1a - mysql_user : name={{ client }} password=\"{{ lookup('password', '/tmp/passwordfile chars=ascii_letters,digits,hexdigits,punctuation') }}\" priv={{ client }}_{{ tier }}_{{ role }}.*:ALL \u5982\u679c\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u5219\u4e0d\u4f1a\u5411\u5176\u5199\u5165\u4efb\u4f55\u6570\u636e\u3002 \u5982\u679c\u6587\u4ef6\u6709\u5185\u5bb9\uff0c\u90a3\u4e9b\u5185\u5bb9\u5c06\u4f5c\u4e3a\u5bc6\u7801\u8bfb\u5165\u3002 \u7a7a\u6587\u4ef6\u5bfc\u81f4\u5bc6\u7801\u4ee5\u7a7a\u5b57\u7b26\u4e32\u8fd4\u56de\u3002","title":"\u4f7f\u7528 password \u751f\u6210\u5bc6\u7801\u5b57\u7b26\u4e32"},{"location":"basic/Playbook-features/#csvfile-csv","text":"# f.csv Symbol,Atomic Number,Atomic Mass H,1,1.008 He,2,4.0026 Li,3,6.94 Be,4,9.012 B,5,10.81 - debug : msg=\"The atomic number of Lithium is {{ lookup('csvfile', 'Li file=elements.csv delimiter=,') }}\" - debug : msg=\"The atomic mass of Lithium is {{ lookup('csvfile', 'Li file=elements.csv delimiter=, col=2') }}\" \u53c2\u6570\u63cf\u8ff0 \u53c2\u6570 \u9ed8\u8ba4\u503c \u63cf\u8ff0 file ansible.csv \u8981\u52a0\u8f7d\u7684\u6587\u4ef6\u540d\u79f0 col 1 \u8981\u8f93\u51fa\u7684\u5217\uff0c\u7d22\u5f15\u4ece0\u5f00\u59cb delimiter TAB \u6587\u4ef6\u7684\u5206\u9694\u7b26 default empty string \u5982\u679ckey\u4e0d\u5728csv\u6587\u4ef6\u4e2d\uff0c\u5219\u4e3a\u9ed8\u8ba4\u8fd4\u56de\u503c encoding utf-8 \u4f7f\u7528\u7684CSV\u6587\u4ef6\u7684\u7f16\u7801\uff08\u5b57\u7b26\u96c6\uff09(added in version 2.1)","title":"\u4f7f\u7528 csvfile \u8bfb\u53d6csv\u6587\u4ef6"},{"location":"basic/Playbook-features/#ini-ini","text":"\u5728section\u4e0b\u67e5\u627e\u4ee5key1 = value1\u7684\u683c\u5f0f\u6765\u8bfb\u53d6\u6587\u4ef6\u7684\u5185\u5bb9\u3002 # users.ini [production] # My production information user = robert pass = somerandompassword [integration] # My integration information user = gertrude pass = anotherpassword tasks : - debug : msg=\"User in integration is {{ lookup('ini', 'user section=integration file=users.ini') }}\" - debug : msg=\"User in production is {{ lookup('ini', 'pass section=production file=users.ini') }}\" ini \u53c2\u6570\u683c\u5f0f lookup('ini', 'key [type=<properties|ini>] [section=section] [file=file.ini] [re=true] [default=<defaultvalue>]') \u7b2c\u4e00\u4e2a\u503c\u5fc5\u987b\u662fini\u6587\u4ef6\u91cc\u7684key \u53c2\u6570\u63cf\u8ff0 \u5b57\u6bb5 \u9ed8\u8ba4\u503c \u63cf\u8ff0 type ini \u6587\u4ef6\u7c7b\u578b\u3002 \u53ef\u4ee5\u662fini\u6216properties \uff08\u5bf9\u4e8ejavaproperties \uff09\u3002 file ansible.ini \u8981\u52a0\u8f7d\u7684\u6587\u4ef6\u540d\u79f0 section global \u5728\u54ea\u91cc\u67e5\u627ekey re False \u5f00\u542f\u6b63\u5219\u5339\u914d default empty string \u5982\u679ckey\u4e0d\u5728\u6587\u4ef6\u4e2d\uff0c\u5219\u4e3a\u9ed8\u8ba4\u8fd4\u56de\u503c","title":"\u4f7f\u7528 ini  \u8bfb\u53d6ini\u6587\u4ef6"},{"location":"basic/Playbook-features/#dig-dns","text":"\u6b64\u6a21\u5757\u4f9d\u8d56 dnspython \u5e93 tasks : - debug : msg=\"The IPv4 address for example.com. is {{ lookup('dig', 'example.com.')}}\" - debug : msg=\"The TXT record for example.org. is {{ lookup('dig', 'example.org.', 'qtype=TXT') }}\" - debug : msg=\"The TXT record for example.org. is {{ lookup('dig', 'example.org./TXT') }}\" \u5176\u4ed6\u63d2\u4ef6 tasks : - debug : msg=\"{{ lookup('env','HOME') }} is an environment variable\" - debug : msg=\"{{ lookup('pipe','date') }} is the raw result of running this command\" # redis_kv lookup requires the Python redis package - debug : msg=\"{{ lookup('redis_kv', 'redis://localhost:6379,somekey') }} is value in Redis for somekey\" # dnstxt lookup requires the Python dnspython package - debug : msg=\"{{ lookup('dnstxt', 'example.com') }} is a DNS TXT record for example.com\" - debug : msg=\"{{ lookup('template', './some_template.j2') }} is a value from evaluation of this template\" # loading a json file from a template as a string - debug : msg=\"{{ lookup('template', './some_json.json.j2', convert_data=False) }} is a value from evaluation of this template\" - debug : msg=\"{{ lookup('etcd', 'foo') }} is a value from a locally running etcd\" # shelvefile lookup retrieves a string value corresponding to a key inside a Python shelve file - debug : msg=\"{{ lookup('shelvefile', 'file=path_to_some_shelve_file.db key=key_to_retrieve') }}","title":"\u4f7f\u7528 dig dns\u67e5\u8be2"},{"location":"basic/Playbook/","text":"8. \u4f7f\u7528 Playbook \u00b6 Playbook \uff08\u5267\u672c\uff09 \u662f Ansible \u6307\u4ee4\u7684\u96c6\u5408\uff0c\u5176\u5229\u7528 YAML \u8bed\u8a00\u7f16\u5199\uff0c\u81ea\u4e0a\u800c\u4e0b\u6309\u987a\u5e8f\u4e00\u6b21\u6267\u884c\u3002 \u5982\u679cAnsible\u6a21\u5757\u662f\u4f60\u7684\u8f66\u95f4\u7684\u5de5\u5177\uff0c\u90a3playbook\u5219\u662f\u4f60\u7684\u6307\u5bfc\u624b\u518c\uff0c\u4f60\u7684\u4e3b\u673a\u6e05\u5355(inventory)\u662f\u4f60\u7684\u539f\u6750\u6599\u3002 play\u7684\u4e3b\u8981\u529f\u80fd\u5728\u4e8e\u5c06\u4e8b\u5148\u5f52\u5e76\u4e3a\u4e00\u7ec4\u7684\u4e3b\u673a\u88c5\u626e\u6210\u4e8b\u5148\u901a\u8fc7ansible\u4e2d\u7684task\u5b9a\u4e49\u597d\u7684\u89d2\u8272\u3002\u4ece\u6839\u672c\u4e0a\u6765\u8bb2\u6240\u8c13task\u65e0\u975e\u662f\u8c03\u7528ansible\u7684\u4e00\u4e2amodule\u3002\u5c06\u591a\u4e2aplay\u7ec4\u7ec7\u5728\u4e00\u4e2aplaybook\u4e2d\u5373\u53ef\u4ee5\u8ba9\u5b83\u4eec\u8054\u540c\u8d77\u6765\u6309\u4e8b\u5148\u7f16\u6392\u7684\u673a\u5236\u540c\u5531\u4e00\u53f0\u5927\u620f\u3002\u5176\u4e3b\u8981\u6709\u4ee5\u4e0b\u56db\u90e8\u5206\u6784\u6210: Target section\uff1a \u5b9a\u4e49\u5c06\u8981\u6267\u884c playbook \u7684\u8fdc\u7a0b\u4e3b\u673a\u7ec4 Variable section\uff1a \u5b9a\u4e49 playbook \u8fd0\u884c\u65f6\u9700\u8981\u4f7f\u7528\u7684\u53d8\u91cf Task section\uff1a \u5b9a\u4e49\u5c06\u8981\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u6267\u884c\u7684\u4efb\u52a1\u5217\u8868 Handler section\uff1a \u5b9a\u4e49 task \u6267\u884c\u5b8c\u6210\u4ee5\u540e\u9700\u8981\u8c03\u7528\u7684\u4efb\u52a1 Playbook \u793a\u4f8b \u00b6 centos7 \u73af\u5883 \u5f00\u59cb\u4e66\u5199\u6211\u4eec\u7b2c\u4e00\u4e2aplaybook \u7b2c\u4e00\u6b65\uff1a \u5b9a\u4e49\u6211\u4eec\u5f97\u4e3b\u673a\u6e05\u5355 [web] 192.168.77.129 ansible_ssh_pass = 123456 192.168.77.130 ansible_ssh_pass = 123456 \u6ce8\uff1a\u8fd9\u91cc\u5982\u679c\u505a\u4e86ssh\u514d\u5bc6\u7801\u767b\u9646\uff0c\u53ef\u4ee5\u53bb\u6389ansible_ssh_pass \u7b2c\u4e8c\u6b65\uff1a \u660e\u786eplaybook\u505a\u54ea\u4e9b\u4efb\u52a1 web\u7ec4\u7684\u4e3b\u673a\u5b8c\u6210\u4e0b\u5217\u4efb\u52a1 \u8fdc\u7a0b\u6267\u884c\u7528\u6237\u4e3aroot \u5b89\u88c5httpd apache\u914d\u7f6e\u6587\u4ef6\u5b9e\u73b0\u81ea\u5b9a\u4e49http\u7aef\u53e3\u548c\u5ba2\u6237\u7aef\u8fde\u63a5\u6570 \u5728\u914d\u7f6e\u6587\u4ef6\u53d8\u66f4\u7684\u65f6\u5019\uff0c\u91cd\u542fhttpd \u542f\u52a8httpd\uff0c\u5e76\u8bbe\u7f6e\u5176\u5f00\u673a\u81ea\u542f\u52a8 \u7b2c\u4e09\u6b65\uff1a \u4e66\u5199playbook playbook \u4f7f\u7528 YAML \u6807\u8bb0\u8bed\u8a00 (see YAML Syntax ) \u6765\u63cf\u8ff0\u4efb\u52a1\u7684\u7f16\u6392 --- - hosts : web # Target section remote_user : root vars : # Variable section http_port : 80 max_clients : 200 tasks : # Task section - name : ensure apache is at the latest version yum : name : httpd state : latest - name : write the apache config file template : src : httpd.j2 dest : /etc/httpd/conf/httpd.conf notify : - restart apache - name : ensure apache is running service : name : httpd state : started handlers : # Handler section - name : restart apache service : name : httpd state : restarted remote_user vars \u7b49\u7b49\u8fd9\u4e9b\u90fd\u662fansible\u7684playbook\u5bf9\u8c61\u7684\u5173\u952e\u5b57, \u5168\u90e8\u53ef\u7528\u7684\u5173\u952e\u5b57\u5217\u8868\u89c1 Ansible \u5173\u952e\u5b57 \u5f53\u524d\u76ee\u5f55\u4e0b\u7684 httpd.j2 \u6587\u4ef6\u5185\u5bb9 ServerRoot \"/etc/httpd\" Listen {{ http_port }} Include conf.modules.d/*.conf User apache Group apache ServerAdmin root@localhost <Directory /> AllowOverride none Require all denied </Directory> DocumentRoot \"/var/www/html\" <Directory \"/var/www\"> AllowOverride None Require all granted </Directory> <Directory \"/var/www/html\"> Options Indexes FollowSymLinks AllowOverride None Require all granted </Directory> <IfModule dir_module> DirectoryIndex index.html </IfModule> <Files \".ht*\"> Require all denied </Files> ErrorLog \"logs/error_log\" LogLevel warn <IfModule log_config_module> LogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" combined LogFormat \"%h %l %u %t \\\"%r\\\" %>s %b\" common <IfModule logio_module> LogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\" %I %O\" combinedio </IfModule> CustomLog \"logs/access_log\" combined </IfModule> <IfModule alias_module> ScriptAlias /cgi-bin/ \"/var/www/cgi-bin/\" </IfModule> <Directory \"/var/www/cgi-bin\"> AllowOverride None Options None Require all granted </Directory> <IfModule mime_module> TypesConfig /etc/mime.types AddType application/x-compress .Z AddType application/x-gzip .gz .tgz AddType text/html .shtml AddOutputFilter INCLUDES .shtml </IfModule> AddDefaultCharset UTF-8 <IfModule mime_magic_module> MIMEMagicFile conf/magic </IfModule> <IfModule mpm_prefork_module> ServerLimit 256 StartServers 5 MinSpareServers 5 MaxSpareServers 10 MaxClients {{ max_clients }} MaxRequestsPerChild 0 </IfModule> EnableSendfile on IncludeOptional conf.d/*.conf \u9898\u5916\uff1a\u4e00\u4e2aplaybook\u6587\u4ef6\u53ef\u4ee5\u62e5\u6709\u591a\u4e2aplay, \u6bd4\u5982\u6211\u4eec\u5728\u52a0\u4e00\u4e2a databases \u7ec4\u7684\u6570\u636e\u5e93\u5b89\u88c5\u64cd\u4f5c --- - hosts : webservers remote_user : root tasks : - name : ensure apache is at the latest version yum : name : httpd state : latest - name : write the apache config file template : src : httpd.j2 dest : /etc/httpd/conf/httpd.conf - hosts : databases remote_user : root tasks : - name : ensure postgresql is at the latest version yum : name : postgresql state : latest - name : ensure that postgresql is started service : name : postgresql state : started \u7b2c\u56db\u6b65\uff1a \u8fd0\u884cplaybok ansible-playbook -i hosts test.yml \u6ce8\uff1a\u8fd8\u6709\u4e00\u79cd\u8fd0\u884c\u65b9\u5f0f \u5728yml\u6587\u4ef6\u5934\u90e8\u52a0\u5165 #!/bin/env ansible-playbook \u5728\u7ed9yml\u6587\u4ef6\u6267\u884c\u6743\u9650 chmod +x t.yml \u8fd0\u884cplaybook ./t.yml \u4e3b\u673a\u548c\u7528\u6237 \u00b6 \u5bf9\u4e8e\u6bcf\u4e2aplaybok\u7684play,\u90fd\u4f1a\u6709\u4e00\u4e2a\u4e3b\u673a\u548c\u8fdc\u7a0b\u7528\u6237\u6765\u786e\u5b9a\u54ea\u4e9b\u4e3b\u673a\u4e3a\u76ee\u6807 --- - hosts : webservers remote_user : root hosts \u5b9a\u4e49\u4e86\u4e3b\u673a\u6e05\u5355\u7684 patterns \u6765\u786e\u5b9a\u54ea\u4e9b\u4e3b\u673a\u4e3a\u6267\u884c\u76ee\u6807\u3002 remote_user \u6307\u5b9a\u6267\u884c\u76ee\u6807\u4e3b\u673a\u7684\u6267\u884c\u7528\u6237\u3002 remote_user \u4e5f\u53ef\u4ee5\u4e3a\u6bcf\u4e2a task \u8bbe\u7f6e --- - hosts : webservers remote_user : root tasks : - name : test connection ping : remote_user : yourname \u5982\u679c\u4f60\u60f3\u8981\u4e3a\u6267\u884c\u63d0\u5347\u6743\u9650\uff0c\u53ef\u4ee5\u8bbe\u7f6e become \u63d0\u6743\u53c2\u6570 --- - hosts : webservers remote_user : yourname become : yes \u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4e3a\u6bcf\u4e2a task \u8bbe\u7f6e --- - hosts : webservers remote_user : yourname tasks : - service : name : nginx state : started become : yes become_user : root become_method : sudo become \u76f8\u5173\u53c2\u6570 become \u662f\u5426\u5f00\u542f\u63d0\u6743 become_method \u6307\u5b9a\u63d0\u5347\u65b9\u5f0f become_user \u6307\u5b9a\u63d0\u5347\u7528\u6237 become_flags \u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570 \u4e3b\u673a\u7684\u6267\u884c\u987a\u5e8f \u00b6 --- - name : exec order hosts : all order : sorted gather_facts : False tasks : - debug : var : inventory_hostname play \u4e5f\u53ef\u4ee5\u52a0\u4e0a name \u6765\u6807\u8bc6\u540d\u79f0, gather_facts \u5b9a\u4e49\u4e0d\u83b7\u53d6\u4e3b\u673afact\u6570\u636e order \u53c2\u6570\u53ef\u4ee5\u63a7\u5236\u4e3b\u673a\u7684 \u8fd0\u884c\u987a\u5e8f \uff0c \u9ed8\u8ba4\u662f inventory \u6309\u4e3b\u673a\u6e05\u5355\u7684\u4ece\u4e0a\u5230\u4e0b\u987a\u5e8f\u4f9d\u6b21\u6267\u884c\uff0c\u5176\u4ed6\u7684\u53ef\u9009\u503c\u5982\u4e0b\u8868\uff1a \u53ef\u9009\u503c \u8bf4\u660e inventory \u9ed8\u8ba4\u503c\uff0c\u6309\u4e3b\u673a\u6e05\u5355\u7684\u4ece\u4e0a\u5230\u4e0b\u987a\u5e8f\u4f9d\u6b21\u6267\u884c reverse_inventory \u6309\u4e3b\u673a\u6e05\u5355\u7684\u4ece\u4e0b\u5230\u4e0a\u987a\u5e8f\u4f9d\u6b21\u6267\u884c sorted \u4ee5\u4e3b\u673a\u540d\u79f0\u6309\u5b57\u6bcd\u987a\u5e8f\u6392\u5e8f reverse_sorted \u4ee5\u4e3b\u673a\u540d\u79f0\u6309\u5b57\u6bcd\u987a\u5e8f\u53cd\u5e8f\u6392\u5e8f shuffle \u968f\u673a\u6392\u5e8f \u4efb\u52a1\u5217\u8868 \u00b6 \u6bcf\u4e2aplay\u5305\u542b\u4e00\u7ec4\u4efb\u52a1\u5217\u8868\uff0c \u4efb\u52a1\u4e4b\u95f4\u662f\u6309\u7167\u4ece\u4e0a\u5f80\u4e0b\u987a\u5e8f\u6267\u884c\u7684\uff0c\u6267\u884c\u5b8c\u4e0a\u4e00\u4e2a\u4efb\u52a1\u518d\u53bb\u6267\u884c\u4e0b\u4e00\u4e2a\u4efb\u52a1\u3002 \u8fd0\u884c\u4ece\u4e0a\u5230\u4e0b\u8fd0\u884c\u7684\u5267\u672c\u65f6\uff0c\u4efb\u52a1\u5931\u8d25\u7684\u4e3b\u673a\u5c06\u4ece\u6574\u4e2a\u5267\u672c\u7684\u8f6e\u6362\u4e2d\u5220\u9664\u3002 \u5982\u679c\u5931\u8d25\uff0c\u53ea\u9700\u66f4\u6b63\u5267\u672c\u6587\u4ef6\u5e76\u91cd\u65b0\u8fd0\u884c\u5373\u53ef\u3002 \u6bcf\u4e2a\u4efb\u52a1(task)\u7684\u76ee\u6807\u662f\u6267\u884c\u5e26\u6709\u7279\u5b9a\u53c2\u6570\u7684\u6a21\u5757\u3002 \u53d8\u91cf\u53ef\u4ee5\u5728\u6a21\u5757\u7684\u53c2\u6570\u4e2d\u4f7f\u7528\u3002 \u6a21\u5757\u5e94\u8be5\u662f\u5e42\u7b49\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u4e00\u4e2a\u5e8f\u5217\u4e2d\u591a\u6b21\u8fd0\u884c\u4e00\u4e2a\u6a21\u5757\u5e94\u8be5\u4e0e\u53ea\u8fd0\u884c\u5b83\u4e00\u6b21\u5177\u6709\u76f8\u540c\u7684\u6548\u679c\u3002\u5b9e\u73b0\u5e42\u7b49\u6027\u7684\u4e00\u79cd\u65b9\u6cd5\u662f\u8ba9\u4e00\u4e2a\u6a21\u5757\u68c0\u67e5\u5b83\u6240\u671f\u671b\u7684\u6700\u7ec8\u72b6\u6001\u662f\u5426\u5df2\u7ecf\u5b9e\u73b0\uff0c\u5982\u679c\u5df2\u7ecf\u5b9e\u73b0\uff0c\u5219\u9000\u51fa\u800c\u4e0d\u6267\u884c\u4efb\u4f55\u64cd\u4f5c\u3002\u5982\u679cplaybook\u4f7f\u7528\u7684\u6240\u6709\u6a21\u5757\u90fd\u662f\u5e42\u7b49\u7684\uff0c\u90a3\u4e48playbook\u672c\u8eab\u53ef\u80fd\u4e5f\u662f\u5e42\u7b49\u7684\uff0c\u6240\u4ee5\u91cd\u65b0\u8fd0\u884cplaybook\u5e94\u8be5\u662f\u5b89\u5168\u7684\u3002 \u6bcf\u4e2a\u4efb\u52a1\u90fd\u5e94\u8be5\u6709\u4e00\u4e2a\u540d\u79f0(names)\uff0c\u5b83\u5305\u542b\u5728\u8fd0\u884c\u5267\u672c\u7684\u8f93\u51fa\u4e2d\u3002\u8fd9\u662f\u4eba\u7c7b\u53ef\u8bfb\u7684\u8f93\u51fa\uff0c\u56e0\u6b64\u63d0\u4f9b\u6bcf\u4e2a\u4efb\u52a1\u6b65\u9aa4\u7684\u826f\u597d\u63cf\u8ff0\u975e\u5e38\u6709\u7528\u3002\u4f46\u662f\uff0c\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u540d\u79f0\uff0c\u90a3\u4e48\u5c06\u4f7f\u7528\u63d0\u4f9b\u7ed9 \u2018action\u2019 \u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a\u8f93\u51fa\u3002 \u4efb\u52a1\u793a\u4f8b tasks : - name : make sure apache is running service : name : httpd state : started \u4e5f\u53ef\u4ee5\u4f7f\u7528 key=value \u7684\u5f62\u5f0f\u8868\u793a\u6a21\u5757\u53c2\u6570 tasks : - name : make sure apache is running service : name=httpd state=started command \u548c shell \u6a21\u5757\u53ea\u6709\u4e00\u7ec4\u53c2\u6570\uff0c\u53ef\u4ee5\u76f4\u63a5\u5199\u5728\u6a21\u5757\u540e\u9762 tasks : - name : enable selinux command : /sbin/setenforce 1 - name : run this command and ignore the result shell : /usr/bin/somecommand || /bin/true \u5982\u679c\u60f3\u5ffd\u7565\u6a21\u5757\u7684\u6267\u884c\u9519\u8bef\uff0c\u53ef\u4ee5\u4e3a\u6a21\u5757\u6dfb\u52a0 ignore_errors tasks : - name : run this command and ignore the result shell : /usr/bin/somecommand ignore_errors : True \u5982\u679c\u884c\u592a\u957f\u4e86\uff0c\u53ef\u4ee5\u6362\u884c\u7f29\u8fdb\u8868\u793a tasks : - name : Copy ansible inventory file to client copy : src=/etc/ansible/hosts dest=/etc/ansible/hosts owner=root group=root mode=0644 \u4e5f\u53ef\u4ee5\u4f7f\u7528\u53d8\u91cf vhost tasks : - name : create a virtual host file for {{ vhost }} template : src : somefile.j2 dest : /etc/httpd/conf.d/{{ vhost }} task\u8fd8\u6709\u4e00\u79cd\u53e4\u8001\u7684\u6807\u8bb0\u65b9\u6cd5\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528\u8fd9\u7c7b\u5f62\u5f0f\u6765\u6807\u8bb0\u4efb\u52a1\u3002 action : template src=templates/foo.j2 dest=/etc/foo.conf \u4e8b\u4ef6\u5904\u7406Handlers \u00b6 \u8fd9\u4e9b notify \u52a8\u4f5c\u5728play\u4e2d\u6bcf\u4e2a\u4efb\u52a1\u5757\u7ed3\u675f\u65f6\u89e6\u53d1\uff0c\u5e76\u4e14\u5373\u4f7f\u7531\u591a\u4e2a\u4e0d\u540c\u7684\u4efb\u52a1\u901a\u77e5\uff0c\u4e5f\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\u3002 - name : template configuration file template : src : template.j2 dest : /etc/foo.conf notify : - restart memcached - restart apache notify \u5b9a\u4e49\u7684\u65f6handlers\u91cc\u7684\u4efb\u52a1\u540d\u79f0\u5217\u8868 Handlers \u4e5f\u662f\u4efb\u52a1\u5217\u8868\uff0c\u4e0e\u5e38\u89c4\u4efb\u52a1\u6ca1\u6709\u4ec0\u4e48\u4e0d\u540c\uff0c\u5b83\u4eec\u7531\u5168\u5c40\u60df\u4e00\u7684\u540d\u79f0\u5f15\u7528\uff0c\u5e76\u7531 notify \u52a8\u4f5c\u901a\u77e5\u3002\u5982\u679c\u6ca1\u6709\u901a\u77e5\u5904\u7406\u7a0b\u5e8f\uff0c\u5b83\u5c06\u4e0d\u4f1a\u8fd0\u884c\u3002\u4e0d\u7ba1\u6709\u591a\u5c11\u4efb\u52a1\u901a\u77e5\u4e00\u4e2a\u5904\u7406\u7a0b\u5e8f\uff0c\u5b83\u90fd\u5c06\u53ea\u8fd0\u884c\u4e00\u6b21\uff0c\u5373\u5728\u4e00\u4e2a\u7279\u5b9a play \u4e2d\u7684\u6240\u6709\u4efb\u52a1\u5b8c\u6210\u4e4b\u540e\u3002 handlers : - name : restart memcached service : name : memcached state : restarted - name : restart apache service : name : apache state : restarted Handlers \u91cc\u7684\u4efb\u52a1\u540d\u79f0 \u4e0d\u80fd\u4f7f\u7528 \u53d8\u91cf \u5728 ansible 2.2\u4e4b\u540e\uff0chandlers \u652f\u6301 listen \u6765\u5b9e\u73b0\u76d1\u542c\u4e00\u4e2a\u901a\u77e5\u7a0b\u5e8f\u6765\u5b9e\u73b0\u6267\u884c\u591a\u4e2a\u901a\u77e5\u4efb\u52a1\u3002 handlers : - name : restart memcached service : name : memcached state : restarted listen : \"restart web services\" - name : restart apache service : name : apache state : restarted listen : \"restart web services\" tasks : - name : restart everything command : echo \"this task will restart the web services\" notify : \"restart web services\" \u6267\u884c Playbook \u00b6 \u4f7f\u7528 ansible-playbook \u547d\u4ee4\u6267\u884c playbook ansible-playbook playbook.yml -f 10 \u5728\u6267\u884cplaybook\u524d\uff0c\u53ef\u4ee5\u505a\u4e9b\u68c0\u67e5 \u68c0\u67e5palybook\u8bed\u6cd5 ansible-playbook -i hosts httpd.yml --syntax-check \u5217\u51fa\u8981\u6267\u884c\u7684\u4e3b\u673a ansible-playbook -i hosts httpd.yml --list-hosts \u5217\u51fa\u8981\u6267\u884c\u5f97\u4efb\u52a1 ansible-playbook -i hosts httpd.yml --list-tasks \u4e5f\u53ef\u4ee5\u4f7f\u7528 ansible-lint \u547d\u4ee4\u8fdb\u884c\u8be6\u7ec6\u68c0\u67e5playbook\u6587\u4ef6 ansible-lint httpd.yml ansible-lint \u9ed8\u8ba4\u89c4\u5219 \u9875\u9762\u63cf\u8ff0\u4e86\u6bcf\u4e00\u4e2a\u9519\u8bef\u4fe1\u606f\u3002 playbook\u6267\u884c\u987a\u5e8f \u00b6 \u4e00\u4e2aplaybook\u7684\u5185\u5bb9\uff0c\u662f\u6309\u7167\u4e0b\u5217\u8868\u4f9d\u6b21\u6267\u884c\u7684 Variable loading \u53d8\u91cf\u52a0\u8f7d Fact gatherin \u662f\u5426\u83b7\u53d6fact\u6570\u636e The pre_tasks execution \u6267\u884cpre_tasks\u4efb\u52a1 Handlers notified from the pre_tasks execution \u6267\u884cpre_tasks\u4efb\u52a1\u91cc\u7684\u4e8b\u4ef6\u901a\u77e5 Roles execution \u6267\u884croles\u89d2\u8272 Tasks execution \u6267\u884ctasks\u4efb\u52a1 Handlers notified from roles or tasks execution \u6267\u884ctasks\u4efb\u52a1\u91cc\u7684\u4e8b\u4ef6\u901a\u77e5 The post_tasks execution \u6267\u884cpost_tasks\u4efb\u52a1 Handlers notified from post_tasks execution \u6267\u884cpost_tasks\u4efb\u52a1\u91cc\u7684\u4e8b\u4ef6\u901a\u77e5","title":"8. \u4f7f\u7528 Playbook"},{"location":"basic/Playbook/#8-playbook","text":"Playbook \uff08\u5267\u672c\uff09 \u662f Ansible \u6307\u4ee4\u7684\u96c6\u5408\uff0c\u5176\u5229\u7528 YAML \u8bed\u8a00\u7f16\u5199\uff0c\u81ea\u4e0a\u800c\u4e0b\u6309\u987a\u5e8f\u4e00\u6b21\u6267\u884c\u3002 \u5982\u679cAnsible\u6a21\u5757\u662f\u4f60\u7684\u8f66\u95f4\u7684\u5de5\u5177\uff0c\u90a3playbook\u5219\u662f\u4f60\u7684\u6307\u5bfc\u624b\u518c\uff0c\u4f60\u7684\u4e3b\u673a\u6e05\u5355(inventory)\u662f\u4f60\u7684\u539f\u6750\u6599\u3002 play\u7684\u4e3b\u8981\u529f\u80fd\u5728\u4e8e\u5c06\u4e8b\u5148\u5f52\u5e76\u4e3a\u4e00\u7ec4\u7684\u4e3b\u673a\u88c5\u626e\u6210\u4e8b\u5148\u901a\u8fc7ansible\u4e2d\u7684task\u5b9a\u4e49\u597d\u7684\u89d2\u8272\u3002\u4ece\u6839\u672c\u4e0a\u6765\u8bb2\u6240\u8c13task\u65e0\u975e\u662f\u8c03\u7528ansible\u7684\u4e00\u4e2amodule\u3002\u5c06\u591a\u4e2aplay\u7ec4\u7ec7\u5728\u4e00\u4e2aplaybook\u4e2d\u5373\u53ef\u4ee5\u8ba9\u5b83\u4eec\u8054\u540c\u8d77\u6765\u6309\u4e8b\u5148\u7f16\u6392\u7684\u673a\u5236\u540c\u5531\u4e00\u53f0\u5927\u620f\u3002\u5176\u4e3b\u8981\u6709\u4ee5\u4e0b\u56db\u90e8\u5206\u6784\u6210: Target section\uff1a \u5b9a\u4e49\u5c06\u8981\u6267\u884c playbook \u7684\u8fdc\u7a0b\u4e3b\u673a\u7ec4 Variable section\uff1a \u5b9a\u4e49 playbook \u8fd0\u884c\u65f6\u9700\u8981\u4f7f\u7528\u7684\u53d8\u91cf Task section\uff1a \u5b9a\u4e49\u5c06\u8981\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u6267\u884c\u7684\u4efb\u52a1\u5217\u8868 Handler section\uff1a \u5b9a\u4e49 task \u6267\u884c\u5b8c\u6210\u4ee5\u540e\u9700\u8981\u8c03\u7528\u7684\u4efb\u52a1","title":"8. \u4f7f\u7528 Playbook"},{"location":"basic/Playbook/#playbook","text":"centos7 \u73af\u5883 \u5f00\u59cb\u4e66\u5199\u6211\u4eec\u7b2c\u4e00\u4e2aplaybook \u7b2c\u4e00\u6b65\uff1a \u5b9a\u4e49\u6211\u4eec\u5f97\u4e3b\u673a\u6e05\u5355 [web] 192.168.77.129 ansible_ssh_pass = 123456 192.168.77.130 ansible_ssh_pass = 123456 \u6ce8\uff1a\u8fd9\u91cc\u5982\u679c\u505a\u4e86ssh\u514d\u5bc6\u7801\u767b\u9646\uff0c\u53ef\u4ee5\u53bb\u6389ansible_ssh_pass \u7b2c\u4e8c\u6b65\uff1a \u660e\u786eplaybook\u505a\u54ea\u4e9b\u4efb\u52a1 web\u7ec4\u7684\u4e3b\u673a\u5b8c\u6210\u4e0b\u5217\u4efb\u52a1 \u8fdc\u7a0b\u6267\u884c\u7528\u6237\u4e3aroot \u5b89\u88c5httpd apache\u914d\u7f6e\u6587\u4ef6\u5b9e\u73b0\u81ea\u5b9a\u4e49http\u7aef\u53e3\u548c\u5ba2\u6237\u7aef\u8fde\u63a5\u6570 \u5728\u914d\u7f6e\u6587\u4ef6\u53d8\u66f4\u7684\u65f6\u5019\uff0c\u91cd\u542fhttpd \u542f\u52a8httpd\uff0c\u5e76\u8bbe\u7f6e\u5176\u5f00\u673a\u81ea\u542f\u52a8 \u7b2c\u4e09\u6b65\uff1a \u4e66\u5199playbook playbook \u4f7f\u7528 YAML \u6807\u8bb0\u8bed\u8a00 (see YAML Syntax ) \u6765\u63cf\u8ff0\u4efb\u52a1\u7684\u7f16\u6392 --- - hosts : web # Target section remote_user : root vars : # Variable section http_port : 80 max_clients : 200 tasks : # Task section - name : ensure apache is at the latest version yum : name : httpd state : latest - name : write the apache config file template : src : httpd.j2 dest : /etc/httpd/conf/httpd.conf notify : - restart apache - name : ensure apache is running service : name : httpd state : started handlers : # Handler section - name : restart apache service : name : httpd state : restarted remote_user vars \u7b49\u7b49\u8fd9\u4e9b\u90fd\u662fansible\u7684playbook\u5bf9\u8c61\u7684\u5173\u952e\u5b57, \u5168\u90e8\u53ef\u7528\u7684\u5173\u952e\u5b57\u5217\u8868\u89c1 Ansible \u5173\u952e\u5b57 \u5f53\u524d\u76ee\u5f55\u4e0b\u7684 httpd.j2 \u6587\u4ef6\u5185\u5bb9 ServerRoot \"/etc/httpd\" Listen {{ http_port }} Include conf.modules.d/*.conf User apache Group apache ServerAdmin root@localhost <Directory /> AllowOverride none Require all denied </Directory> DocumentRoot \"/var/www/html\" <Directory \"/var/www\"> AllowOverride None Require all granted </Directory> <Directory \"/var/www/html\"> Options Indexes FollowSymLinks AllowOverride None Require all granted </Directory> <IfModule dir_module> DirectoryIndex index.html </IfModule> <Files \".ht*\"> Require all denied </Files> ErrorLog \"logs/error_log\" LogLevel warn <IfModule log_config_module> LogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" combined LogFormat \"%h %l %u %t \\\"%r\\\" %>s %b\" common <IfModule logio_module> LogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\" %I %O\" combinedio </IfModule> CustomLog \"logs/access_log\" combined </IfModule> <IfModule alias_module> ScriptAlias /cgi-bin/ \"/var/www/cgi-bin/\" </IfModule> <Directory \"/var/www/cgi-bin\"> AllowOverride None Options None Require all granted </Directory> <IfModule mime_module> TypesConfig /etc/mime.types AddType application/x-compress .Z AddType application/x-gzip .gz .tgz AddType text/html .shtml AddOutputFilter INCLUDES .shtml </IfModule> AddDefaultCharset UTF-8 <IfModule mime_magic_module> MIMEMagicFile conf/magic </IfModule> <IfModule mpm_prefork_module> ServerLimit 256 StartServers 5 MinSpareServers 5 MaxSpareServers 10 MaxClients {{ max_clients }} MaxRequestsPerChild 0 </IfModule> EnableSendfile on IncludeOptional conf.d/*.conf \u9898\u5916\uff1a\u4e00\u4e2aplaybook\u6587\u4ef6\u53ef\u4ee5\u62e5\u6709\u591a\u4e2aplay, \u6bd4\u5982\u6211\u4eec\u5728\u52a0\u4e00\u4e2a databases \u7ec4\u7684\u6570\u636e\u5e93\u5b89\u88c5\u64cd\u4f5c --- - hosts : webservers remote_user : root tasks : - name : ensure apache is at the latest version yum : name : httpd state : latest - name : write the apache config file template : src : httpd.j2 dest : /etc/httpd/conf/httpd.conf - hosts : databases remote_user : root tasks : - name : ensure postgresql is at the latest version yum : name : postgresql state : latest - name : ensure that postgresql is started service : name : postgresql state : started \u7b2c\u56db\u6b65\uff1a \u8fd0\u884cplaybok ansible-playbook -i hosts test.yml \u6ce8\uff1a\u8fd8\u6709\u4e00\u79cd\u8fd0\u884c\u65b9\u5f0f \u5728yml\u6587\u4ef6\u5934\u90e8\u52a0\u5165 #!/bin/env ansible-playbook \u5728\u7ed9yml\u6587\u4ef6\u6267\u884c\u6743\u9650 chmod +x t.yml \u8fd0\u884cplaybook ./t.yml","title":"Playbook \u793a\u4f8b"},{"location":"basic/Playbook/#_1","text":"\u5bf9\u4e8e\u6bcf\u4e2aplaybok\u7684play,\u90fd\u4f1a\u6709\u4e00\u4e2a\u4e3b\u673a\u548c\u8fdc\u7a0b\u7528\u6237\u6765\u786e\u5b9a\u54ea\u4e9b\u4e3b\u673a\u4e3a\u76ee\u6807 --- - hosts : webservers remote_user : root hosts \u5b9a\u4e49\u4e86\u4e3b\u673a\u6e05\u5355\u7684 patterns \u6765\u786e\u5b9a\u54ea\u4e9b\u4e3b\u673a\u4e3a\u6267\u884c\u76ee\u6807\u3002 remote_user \u6307\u5b9a\u6267\u884c\u76ee\u6807\u4e3b\u673a\u7684\u6267\u884c\u7528\u6237\u3002 remote_user \u4e5f\u53ef\u4ee5\u4e3a\u6bcf\u4e2a task \u8bbe\u7f6e --- - hosts : webservers remote_user : root tasks : - name : test connection ping : remote_user : yourname \u5982\u679c\u4f60\u60f3\u8981\u4e3a\u6267\u884c\u63d0\u5347\u6743\u9650\uff0c\u53ef\u4ee5\u8bbe\u7f6e become \u63d0\u6743\u53c2\u6570 --- - hosts : webservers remote_user : yourname become : yes \u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4e3a\u6bcf\u4e2a task \u8bbe\u7f6e --- - hosts : webservers remote_user : yourname tasks : - service : name : nginx state : started become : yes become_user : root become_method : sudo become \u76f8\u5173\u53c2\u6570 become \u662f\u5426\u5f00\u542f\u63d0\u6743 become_method \u6307\u5b9a\u63d0\u5347\u65b9\u5f0f become_user \u6307\u5b9a\u63d0\u5347\u7528\u6237 become_flags \u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570","title":"\u4e3b\u673a\u548c\u7528\u6237"},{"location":"basic/Playbook/#_2","text":"--- - name : exec order hosts : all order : sorted gather_facts : False tasks : - debug : var : inventory_hostname play \u4e5f\u53ef\u4ee5\u52a0\u4e0a name \u6765\u6807\u8bc6\u540d\u79f0, gather_facts \u5b9a\u4e49\u4e0d\u83b7\u53d6\u4e3b\u673afact\u6570\u636e order \u53c2\u6570\u53ef\u4ee5\u63a7\u5236\u4e3b\u673a\u7684 \u8fd0\u884c\u987a\u5e8f \uff0c \u9ed8\u8ba4\u662f inventory \u6309\u4e3b\u673a\u6e05\u5355\u7684\u4ece\u4e0a\u5230\u4e0b\u987a\u5e8f\u4f9d\u6b21\u6267\u884c\uff0c\u5176\u4ed6\u7684\u53ef\u9009\u503c\u5982\u4e0b\u8868\uff1a \u53ef\u9009\u503c \u8bf4\u660e inventory \u9ed8\u8ba4\u503c\uff0c\u6309\u4e3b\u673a\u6e05\u5355\u7684\u4ece\u4e0a\u5230\u4e0b\u987a\u5e8f\u4f9d\u6b21\u6267\u884c reverse_inventory \u6309\u4e3b\u673a\u6e05\u5355\u7684\u4ece\u4e0b\u5230\u4e0a\u987a\u5e8f\u4f9d\u6b21\u6267\u884c sorted \u4ee5\u4e3b\u673a\u540d\u79f0\u6309\u5b57\u6bcd\u987a\u5e8f\u6392\u5e8f reverse_sorted \u4ee5\u4e3b\u673a\u540d\u79f0\u6309\u5b57\u6bcd\u987a\u5e8f\u53cd\u5e8f\u6392\u5e8f shuffle \u968f\u673a\u6392\u5e8f","title":"\u4e3b\u673a\u7684\u6267\u884c\u987a\u5e8f"},{"location":"basic/Playbook/#_3","text":"\u6bcf\u4e2aplay\u5305\u542b\u4e00\u7ec4\u4efb\u52a1\u5217\u8868\uff0c \u4efb\u52a1\u4e4b\u95f4\u662f\u6309\u7167\u4ece\u4e0a\u5f80\u4e0b\u987a\u5e8f\u6267\u884c\u7684\uff0c\u6267\u884c\u5b8c\u4e0a\u4e00\u4e2a\u4efb\u52a1\u518d\u53bb\u6267\u884c\u4e0b\u4e00\u4e2a\u4efb\u52a1\u3002 \u8fd0\u884c\u4ece\u4e0a\u5230\u4e0b\u8fd0\u884c\u7684\u5267\u672c\u65f6\uff0c\u4efb\u52a1\u5931\u8d25\u7684\u4e3b\u673a\u5c06\u4ece\u6574\u4e2a\u5267\u672c\u7684\u8f6e\u6362\u4e2d\u5220\u9664\u3002 \u5982\u679c\u5931\u8d25\uff0c\u53ea\u9700\u66f4\u6b63\u5267\u672c\u6587\u4ef6\u5e76\u91cd\u65b0\u8fd0\u884c\u5373\u53ef\u3002 \u6bcf\u4e2a\u4efb\u52a1(task)\u7684\u76ee\u6807\u662f\u6267\u884c\u5e26\u6709\u7279\u5b9a\u53c2\u6570\u7684\u6a21\u5757\u3002 \u53d8\u91cf\u53ef\u4ee5\u5728\u6a21\u5757\u7684\u53c2\u6570\u4e2d\u4f7f\u7528\u3002 \u6a21\u5757\u5e94\u8be5\u662f\u5e42\u7b49\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u4e00\u4e2a\u5e8f\u5217\u4e2d\u591a\u6b21\u8fd0\u884c\u4e00\u4e2a\u6a21\u5757\u5e94\u8be5\u4e0e\u53ea\u8fd0\u884c\u5b83\u4e00\u6b21\u5177\u6709\u76f8\u540c\u7684\u6548\u679c\u3002\u5b9e\u73b0\u5e42\u7b49\u6027\u7684\u4e00\u79cd\u65b9\u6cd5\u662f\u8ba9\u4e00\u4e2a\u6a21\u5757\u68c0\u67e5\u5b83\u6240\u671f\u671b\u7684\u6700\u7ec8\u72b6\u6001\u662f\u5426\u5df2\u7ecf\u5b9e\u73b0\uff0c\u5982\u679c\u5df2\u7ecf\u5b9e\u73b0\uff0c\u5219\u9000\u51fa\u800c\u4e0d\u6267\u884c\u4efb\u4f55\u64cd\u4f5c\u3002\u5982\u679cplaybook\u4f7f\u7528\u7684\u6240\u6709\u6a21\u5757\u90fd\u662f\u5e42\u7b49\u7684\uff0c\u90a3\u4e48playbook\u672c\u8eab\u53ef\u80fd\u4e5f\u662f\u5e42\u7b49\u7684\uff0c\u6240\u4ee5\u91cd\u65b0\u8fd0\u884cplaybook\u5e94\u8be5\u662f\u5b89\u5168\u7684\u3002 \u6bcf\u4e2a\u4efb\u52a1\u90fd\u5e94\u8be5\u6709\u4e00\u4e2a\u540d\u79f0(names)\uff0c\u5b83\u5305\u542b\u5728\u8fd0\u884c\u5267\u672c\u7684\u8f93\u51fa\u4e2d\u3002\u8fd9\u662f\u4eba\u7c7b\u53ef\u8bfb\u7684\u8f93\u51fa\uff0c\u56e0\u6b64\u63d0\u4f9b\u6bcf\u4e2a\u4efb\u52a1\u6b65\u9aa4\u7684\u826f\u597d\u63cf\u8ff0\u975e\u5e38\u6709\u7528\u3002\u4f46\u662f\uff0c\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u540d\u79f0\uff0c\u90a3\u4e48\u5c06\u4f7f\u7528\u63d0\u4f9b\u7ed9 \u2018action\u2019 \u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a\u8f93\u51fa\u3002 \u4efb\u52a1\u793a\u4f8b tasks : - name : make sure apache is running service : name : httpd state : started \u4e5f\u53ef\u4ee5\u4f7f\u7528 key=value \u7684\u5f62\u5f0f\u8868\u793a\u6a21\u5757\u53c2\u6570 tasks : - name : make sure apache is running service : name=httpd state=started command \u548c shell \u6a21\u5757\u53ea\u6709\u4e00\u7ec4\u53c2\u6570\uff0c\u53ef\u4ee5\u76f4\u63a5\u5199\u5728\u6a21\u5757\u540e\u9762 tasks : - name : enable selinux command : /sbin/setenforce 1 - name : run this command and ignore the result shell : /usr/bin/somecommand || /bin/true \u5982\u679c\u60f3\u5ffd\u7565\u6a21\u5757\u7684\u6267\u884c\u9519\u8bef\uff0c\u53ef\u4ee5\u4e3a\u6a21\u5757\u6dfb\u52a0 ignore_errors tasks : - name : run this command and ignore the result shell : /usr/bin/somecommand ignore_errors : True \u5982\u679c\u884c\u592a\u957f\u4e86\uff0c\u53ef\u4ee5\u6362\u884c\u7f29\u8fdb\u8868\u793a tasks : - name : Copy ansible inventory file to client copy : src=/etc/ansible/hosts dest=/etc/ansible/hosts owner=root group=root mode=0644 \u4e5f\u53ef\u4ee5\u4f7f\u7528\u53d8\u91cf vhost tasks : - name : create a virtual host file for {{ vhost }} template : src : somefile.j2 dest : /etc/httpd/conf.d/{{ vhost }} task\u8fd8\u6709\u4e00\u79cd\u53e4\u8001\u7684\u6807\u8bb0\u65b9\u6cd5\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528\u8fd9\u7c7b\u5f62\u5f0f\u6765\u6807\u8bb0\u4efb\u52a1\u3002 action : template src=templates/foo.j2 dest=/etc/foo.conf","title":"\u4efb\u52a1\u5217\u8868"},{"location":"basic/Playbook/#handlers","text":"\u8fd9\u4e9b notify \u52a8\u4f5c\u5728play\u4e2d\u6bcf\u4e2a\u4efb\u52a1\u5757\u7ed3\u675f\u65f6\u89e6\u53d1\uff0c\u5e76\u4e14\u5373\u4f7f\u7531\u591a\u4e2a\u4e0d\u540c\u7684\u4efb\u52a1\u901a\u77e5\uff0c\u4e5f\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\u3002 - name : template configuration file template : src : template.j2 dest : /etc/foo.conf notify : - restart memcached - restart apache notify \u5b9a\u4e49\u7684\u65f6handlers\u91cc\u7684\u4efb\u52a1\u540d\u79f0\u5217\u8868 Handlers \u4e5f\u662f\u4efb\u52a1\u5217\u8868\uff0c\u4e0e\u5e38\u89c4\u4efb\u52a1\u6ca1\u6709\u4ec0\u4e48\u4e0d\u540c\uff0c\u5b83\u4eec\u7531\u5168\u5c40\u60df\u4e00\u7684\u540d\u79f0\u5f15\u7528\uff0c\u5e76\u7531 notify \u52a8\u4f5c\u901a\u77e5\u3002\u5982\u679c\u6ca1\u6709\u901a\u77e5\u5904\u7406\u7a0b\u5e8f\uff0c\u5b83\u5c06\u4e0d\u4f1a\u8fd0\u884c\u3002\u4e0d\u7ba1\u6709\u591a\u5c11\u4efb\u52a1\u901a\u77e5\u4e00\u4e2a\u5904\u7406\u7a0b\u5e8f\uff0c\u5b83\u90fd\u5c06\u53ea\u8fd0\u884c\u4e00\u6b21\uff0c\u5373\u5728\u4e00\u4e2a\u7279\u5b9a play \u4e2d\u7684\u6240\u6709\u4efb\u52a1\u5b8c\u6210\u4e4b\u540e\u3002 handlers : - name : restart memcached service : name : memcached state : restarted - name : restart apache service : name : apache state : restarted Handlers \u91cc\u7684\u4efb\u52a1\u540d\u79f0 \u4e0d\u80fd\u4f7f\u7528 \u53d8\u91cf \u5728 ansible 2.2\u4e4b\u540e\uff0chandlers \u652f\u6301 listen \u6765\u5b9e\u73b0\u76d1\u542c\u4e00\u4e2a\u901a\u77e5\u7a0b\u5e8f\u6765\u5b9e\u73b0\u6267\u884c\u591a\u4e2a\u901a\u77e5\u4efb\u52a1\u3002 handlers : - name : restart memcached service : name : memcached state : restarted listen : \"restart web services\" - name : restart apache service : name : apache state : restarted listen : \"restart web services\" tasks : - name : restart everything command : echo \"this task will restart the web services\" notify : \"restart web services\"","title":"\u4e8b\u4ef6\u5904\u7406Handlers"},{"location":"basic/Playbook/#playbook_1","text":"\u4f7f\u7528 ansible-playbook \u547d\u4ee4\u6267\u884c playbook ansible-playbook playbook.yml -f 10 \u5728\u6267\u884cplaybook\u524d\uff0c\u53ef\u4ee5\u505a\u4e9b\u68c0\u67e5 \u68c0\u67e5palybook\u8bed\u6cd5 ansible-playbook -i hosts httpd.yml --syntax-check \u5217\u51fa\u8981\u6267\u884c\u7684\u4e3b\u673a ansible-playbook -i hosts httpd.yml --list-hosts \u5217\u51fa\u8981\u6267\u884c\u5f97\u4efb\u52a1 ansible-playbook -i hosts httpd.yml --list-tasks \u4e5f\u53ef\u4ee5\u4f7f\u7528 ansible-lint \u547d\u4ee4\u8fdb\u884c\u8be6\u7ec6\u68c0\u67e5playbook\u6587\u4ef6 ansible-lint httpd.yml ansible-lint \u9ed8\u8ba4\u89c4\u5219 \u9875\u9762\u63cf\u8ff0\u4e86\u6bcf\u4e00\u4e2a\u9519\u8bef\u4fe1\u606f\u3002","title":"\u6267\u884c Playbook"},{"location":"basic/Playbook/#playbook_2","text":"\u4e00\u4e2aplaybook\u7684\u5185\u5bb9\uff0c\u662f\u6309\u7167\u4e0b\u5217\u8868\u4f9d\u6b21\u6267\u884c\u7684 Variable loading \u53d8\u91cf\u52a0\u8f7d Fact gatherin \u662f\u5426\u83b7\u53d6fact\u6570\u636e The pre_tasks execution \u6267\u884cpre_tasks\u4efb\u52a1 Handlers notified from the pre_tasks execution \u6267\u884cpre_tasks\u4efb\u52a1\u91cc\u7684\u4e8b\u4ef6\u901a\u77e5 Roles execution \u6267\u884croles\u89d2\u8272 Tasks execution \u6267\u884ctasks\u4efb\u52a1 Handlers notified from roles or tasks execution \u6267\u884ctasks\u4efb\u52a1\u91cc\u7684\u4e8b\u4ef6\u901a\u77e5 The post_tasks execution \u6267\u884cpost_tasks\u4efb\u52a1 Handlers notified from post_tasks execution \u6267\u884cpost_tasks\u4efb\u52a1\u91cc\u7684\u4e8b\u4ef6\u901a\u77e5","title":"playbook\u6267\u884c\u987a\u5e8f"},{"location":"basic/Quickstart/","text":"3. \u5feb\u901f\u5f00\u59cb \u00b6 \u8ddf\u7740\u6211\uff0c\u4e00\u6b65\u4e00\u6b65\u7684\u5f00\u59cb ansible \u795e\u5947\u4e4b\u65c5\u5427\uff01 \u73af\u5883\u4fe1\u606f \u00b6 control os: centos 7.7 ansible version: 2.9.6 \u4efb\u52a1 \u00b6 \u6211\u4eec\u5c06\u8981\u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u5b89\u88c5\u90e8\u7f72 nginx \u670d\u52a1 \u6b65\u9aa4 \u00b6 0. \u5b89\u88c5ansible \u00b6 \u672c\u6b21\u4f7f\u7528\u7684\u662f Centos 7.7 x64 \u7cfb\u7edf yum install -y epel-release sed -e 's!^mirrorlist=!#mirrorlist=!g' \\ -e 's!^metalink=!#metalink=!g' \\ -e 's!^#baseurl=!baseurl=!g' \\ -e 's!//download\\.fedoraproject\\.org/pub!//mirrors.ustc.edu.cn!g' \\ -e 's!http://mirrors\\.ustc!https://mirrors.ustc!g' \\ -i /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel-testing.repo yum install -y ansible yum update python-jinja2 1. \u5b9a\u4e49\u4e3b\u673a\u6e05\u5355 \u00b6 \u5b9a\u4e49\u4e00\u4e2a\u7b80\u5355\u7684\u901a\u8fc7ssh\u8ba4\u8bc1\u7684\u4e3b\u673a\u6e05\u5355\uff0c\u66f4\u591a\u914d\u7f6e\u89c1 cat /etc/ansible/hosts 192.168.77.135 ansible_ssh_user=root ansible_ssh_pass=123456 \u4e3b\u673a\u6e05\u5355\u4e2d\u7684\u914d\u7f6e\u542b\u4e49 192.168.77.135 \u5b9a\u4e49\u8fdc\u7a0b\u4e3b\u673aip\u5730\u5740 ansible_ssh_user \u8fde\u63a5\u8fdc\u7a0b\u4e3b\u673a\u7684\u7528\u6237 ansible_ssh_pass \u8fde\u63a5\u8fdc\u7a0b\u4e3b\u673a\u7684\u7528\u6237\u5bc6\u7801 2. \u6267\u884cansible\u547d\u4ee4 \u00b6 \u6d4b\u8bd5\u8fde\u63a5\u72b6\u6001 ansible 192 .168.77.135 -m ping \u547d\u4ee4\u4e2d\u7684\u542b\u4e49 - 192.168.77.135 \u7528\u4e8e\u5339\u914d\u4e3b\u673a\u6e05\u5355\u4e2d\u7684\u4e3b\u673a\u540d\u79f0 - -m ping \u6307\u5b9a ping \u6a21\u5757\uff0c\u7528\u4e8e\u6d4b\u8bd5\u4e0e\u8fdc\u7a0b\u4e3b\u673a\u7684\u8fde\u63a5\u72b6\u6001 \u5b89\u88c5Nginx ansible 192 .168.77.135 -m yum -a 'name=nginx' \u547d\u4ee4\u4e2d\u7684\u542b\u4e49 - 192.168.77.135 \u7528\u4e8e\u5339\u914d\u4e3b\u673a\u6e05\u5355\u4e2d\u7684\u4e3b\u673a\u540d\u79f0 - -m yum \u6307\u5b9a yum \u6a21\u5757\uff0c\u7528\u4e8e\u5b89\u88c5\u8f6f\u4ef6 - -a 'name=nginx' \u6307\u5b9a\u6a21\u5757\u7684\u53c2\u6570\uff0c name \u662f\u8f6f\u4ef6\u7684\u540d\u79f0\uff0c\u9ed8\u8ba4\u64cd\u4f5c\u662f\u5b89\u88c5\u3002 \u542f\u52a8Nginx ansible 192 .168.77.135 -m systemd -a 'name=nginx state=started enabled=yes' \u547d\u4ee4\u4e2d\u7684\u542b\u4e49 - 192.168.77.135 \u7528\u4e8e\u5339\u914d\u4e3b\u673a\u6e05\u5355\u4e2d\u7684\u4e3b\u673a\u540d\u79f0 - -m systemd \u6307\u5b9a systemd \u6a21\u5757\uff0c\u7528\u4e8e\u7ba1\u7406\u7cfb\u7edf\u670d\u52a1 - -a 'name=nginx state=started enabled=yes' \u6307\u5b9a\u6a21\u5757\u7684\u53c2\u6570\uff0c name \u662f\u8f6f\u4ef6\u7684\u540d\u79f0\uff0c state \u6307\u5b9a\u7ba1\u7406\u72b6\u6001\uff0c enabled \u662f\u5426\u5f00\u542f\u81ea\u542f\u52a8\u3002 3. \u9a8c\u8bc1 \u00b6 curl http://192.168.77.135:8080 3. \u6267\u884cansible playbook \u00b6 \u5b9a\u4e49 playbook \u4e5f\u5c31\u662f\u4efb\u52a1\u7f16\u6392\uff0c\u5c06\u4e0a\u97623\u4e2a\u6b65\u9aa4\u5408\u5e76\u5728\u4e00\u8d77\u3002 # File: install_nginx.yml --- - hosts: 192 .168.77.135 tasks: - name: \u5b89\u88c5 nginx. yum: name = nginx - name: \u542f\u52a8 nginx. systemd: name = nginx state = started enabled = yes - name: \u68c0\u67e5 nginx. uri: url = http://127.0.0.1 register: curl_result until : curl_result.status == 200 retries: 5 delay: 3 changed_when: false check_mode: no \u6267\u884c playbook ansible-playbook install_nginx.yml \u606d\u559c\u4f60\uff0c\u4f60\u5df2\u7ecf\u5b66\u4f1a\u600e\u4e48\u4f7f\u7528ansible\u4e86\u3002\u4e0b\u9762\u7684\u8bfe\u7a0b\u4f1a\u4f7f\u4f60\u66f4\u52a0\u6df1\u5165\u7684\u4e86\u89e3 ansible \u3002","title":"3. \u5feb\u901f\u5f00\u59cb"},{"location":"basic/Quickstart/#3","text":"\u8ddf\u7740\u6211\uff0c\u4e00\u6b65\u4e00\u6b65\u7684\u5f00\u59cb ansible \u795e\u5947\u4e4b\u65c5\u5427\uff01","title":"3. \u5feb\u901f\u5f00\u59cb"},{"location":"basic/Quickstart/#_1","text":"control os: centos 7.7 ansible version: 2.9.6","title":"\u73af\u5883\u4fe1\u606f"},{"location":"basic/Quickstart/#_2","text":"\u6211\u4eec\u5c06\u8981\u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u5b89\u88c5\u90e8\u7f72 nginx \u670d\u52a1","title":"\u4efb\u52a1"},{"location":"basic/Quickstart/#_3","text":"","title":"\u6b65\u9aa4"},{"location":"basic/Quickstart/#0-ansible","text":"\u672c\u6b21\u4f7f\u7528\u7684\u662f Centos 7.7 x64 \u7cfb\u7edf yum install -y epel-release sed -e 's!^mirrorlist=!#mirrorlist=!g' \\ -e 's!^metalink=!#metalink=!g' \\ -e 's!^#baseurl=!baseurl=!g' \\ -e 's!//download\\.fedoraproject\\.org/pub!//mirrors.ustc.edu.cn!g' \\ -e 's!http://mirrors\\.ustc!https://mirrors.ustc!g' \\ -i /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel-testing.repo yum install -y ansible yum update python-jinja2","title":"0. \u5b89\u88c5ansible"},{"location":"basic/Quickstart/#1","text":"\u5b9a\u4e49\u4e00\u4e2a\u7b80\u5355\u7684\u901a\u8fc7ssh\u8ba4\u8bc1\u7684\u4e3b\u673a\u6e05\u5355\uff0c\u66f4\u591a\u914d\u7f6e\u89c1 cat /etc/ansible/hosts 192.168.77.135 ansible_ssh_user=root ansible_ssh_pass=123456 \u4e3b\u673a\u6e05\u5355\u4e2d\u7684\u914d\u7f6e\u542b\u4e49 192.168.77.135 \u5b9a\u4e49\u8fdc\u7a0b\u4e3b\u673aip\u5730\u5740 ansible_ssh_user \u8fde\u63a5\u8fdc\u7a0b\u4e3b\u673a\u7684\u7528\u6237 ansible_ssh_pass \u8fde\u63a5\u8fdc\u7a0b\u4e3b\u673a\u7684\u7528\u6237\u5bc6\u7801","title":"1. \u5b9a\u4e49\u4e3b\u673a\u6e05\u5355"},{"location":"basic/Quickstart/#2-ansible","text":"\u6d4b\u8bd5\u8fde\u63a5\u72b6\u6001 ansible 192 .168.77.135 -m ping \u547d\u4ee4\u4e2d\u7684\u542b\u4e49 - 192.168.77.135 \u7528\u4e8e\u5339\u914d\u4e3b\u673a\u6e05\u5355\u4e2d\u7684\u4e3b\u673a\u540d\u79f0 - -m ping \u6307\u5b9a ping \u6a21\u5757\uff0c\u7528\u4e8e\u6d4b\u8bd5\u4e0e\u8fdc\u7a0b\u4e3b\u673a\u7684\u8fde\u63a5\u72b6\u6001 \u5b89\u88c5Nginx ansible 192 .168.77.135 -m yum -a 'name=nginx' \u547d\u4ee4\u4e2d\u7684\u542b\u4e49 - 192.168.77.135 \u7528\u4e8e\u5339\u914d\u4e3b\u673a\u6e05\u5355\u4e2d\u7684\u4e3b\u673a\u540d\u79f0 - -m yum \u6307\u5b9a yum \u6a21\u5757\uff0c\u7528\u4e8e\u5b89\u88c5\u8f6f\u4ef6 - -a 'name=nginx' \u6307\u5b9a\u6a21\u5757\u7684\u53c2\u6570\uff0c name \u662f\u8f6f\u4ef6\u7684\u540d\u79f0\uff0c\u9ed8\u8ba4\u64cd\u4f5c\u662f\u5b89\u88c5\u3002 \u542f\u52a8Nginx ansible 192 .168.77.135 -m systemd -a 'name=nginx state=started enabled=yes' \u547d\u4ee4\u4e2d\u7684\u542b\u4e49 - 192.168.77.135 \u7528\u4e8e\u5339\u914d\u4e3b\u673a\u6e05\u5355\u4e2d\u7684\u4e3b\u673a\u540d\u79f0 - -m systemd \u6307\u5b9a systemd \u6a21\u5757\uff0c\u7528\u4e8e\u7ba1\u7406\u7cfb\u7edf\u670d\u52a1 - -a 'name=nginx state=started enabled=yes' \u6307\u5b9a\u6a21\u5757\u7684\u53c2\u6570\uff0c name \u662f\u8f6f\u4ef6\u7684\u540d\u79f0\uff0c state \u6307\u5b9a\u7ba1\u7406\u72b6\u6001\uff0c enabled \u662f\u5426\u5f00\u542f\u81ea\u542f\u52a8\u3002","title":"2. \u6267\u884cansible\u547d\u4ee4"},{"location":"basic/Quickstart/#3_1","text":"curl http://192.168.77.135:8080","title":"3. \u9a8c\u8bc1"},{"location":"basic/Quickstart/#3-ansible-playbook","text":"\u5b9a\u4e49 playbook \u4e5f\u5c31\u662f\u4efb\u52a1\u7f16\u6392\uff0c\u5c06\u4e0a\u97623\u4e2a\u6b65\u9aa4\u5408\u5e76\u5728\u4e00\u8d77\u3002 # File: install_nginx.yml --- - hosts: 192 .168.77.135 tasks: - name: \u5b89\u88c5 nginx. yum: name = nginx - name: \u542f\u52a8 nginx. systemd: name = nginx state = started enabled = yes - name: \u68c0\u67e5 nginx. uri: url = http://127.0.0.1 register: curl_result until : curl_result.status == 200 retries: 5 delay: 3 changed_when: false check_mode: no \u6267\u884c playbook ansible-playbook install_nginx.yml \u606d\u559c\u4f60\uff0c\u4f60\u5df2\u7ecf\u5b66\u4f1a\u600e\u4e48\u4f7f\u7528ansible\u4e86\u3002\u4e0b\u9762\u7684\u8bfe\u7a0b\u4f1a\u4f7f\u4f60\u66f4\u52a0\u6df1\u5165\u7684\u4e86\u89e3 ansible \u3002","title":"3. \u6267\u884cansible playbook"},{"location":"basic/Variables/","text":"10. \u4f7f\u7528\u53d8\u91cf \u00b6 \u867d\u7136\u81ea\u52a8\u5316\u7684\u5b58\u5728\u662f\u4e3a\u4e86\u8ba9\u4e8b\u60c5\u66f4\u5bb9\u6613\u91cd\u590d\uff0c\u4f46\u5e76\u975e\u6240\u6709\u7684\u7cfb\u7edf\u90fd\u662f\u5b8c\u5168\u76f8\u540c\u7684;\u6709\u4e9b\u53ef\u80fd\u9700\u8981\u7684\u914d\u7f6e\u4e0e\u5176\u4ed6\u7684\u7a0d\u6709\u4e0d\u540c\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6240\u89c2\u5bdf\u5230\u7684\u4e00\u4e2a\u7cfb\u7edf\u7684\u884c\u4e3a\u6216\u72b6\u6001\u53ef\u80fd\u4f1a\u5f71\u54cd\u60a8\u914d\u7f6e\u5176\u4ed6\u7cfb\u7edf\u7684\u65b9\u5f0f\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u627e\u5230\u4e00\u4e2a\u7cfb\u7edf\u7684IP\u5730\u5740\uff0c\u5e76\u5c06\u5176\u7528\u4f5c\u53e6\u4e00\u4e2a\u7cfb\u7edf\u4e0a\u7684\u914d\u7f6e\u503c\u3002 Ansible\u4f7f\u7528 \u53d8\u91cf( variables ) \u6765\u5e2e\u52a9\u5904\u7406\u7cfb\u7edf\u4e4b\u95f4\u7684\u5dee\u5f02\u3002 \u521b\u5efa\u6709\u6548\u7684\u53d8\u91cf\u540d \u00b6 \u5728\u4f7f\u7528\u53d8\u91cf\u4e4b\u524d\uff0c\u4f60\u8981\u5148\u77e5\u9053\u4ec0\u4e48\u662f \u6709\u6548 \u7684\u53d8\u91cf\u540d\u79f0, \u4ee5\u4e0b\u662f\u53d8\u91cf\u540d\u7684\u9075\u5faa\u89c4\u5219 \u53d8\u91cf\u540d\u79f0\u5e94\u4e3a \u5b57\u6bcd \uff0c \u6570\u5b57 \u548c \u4e0b\u5212\u7ebf \u3002 \u53d8\u91cf\u5e94\u59cb\u7ec8 \u4ee5\u5b57\u6bcd\u5f00\u5934 \u3002 \u53d8\u91cf\u540d\u4e0d\u5e94\u4e0epython\u5c5e\u6027\u548c\u65b9\u6cd5\u540d\u51b2\u7a81\u3002 YAML\u8fd8\u652f\u6301\u5c06\u952e\u6620\u5c04\u5230\u503c\u7684\u5b57\u5178 foo : field1 : one field2 : two \u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u65b9\u62ec\u53f7\u7b26\u53f7\u6216\u70b9\u7b26\u53f7\u6765\u5f15\u7528\u5b57\u5178\u4e2d\u7684\u7279\u5b9a\u5b57\u6bb5 foo['field1'] foo.field2 Note \u5982\u679c\u9009\u62e9\u4f7f\u7528\u70b9\u8868\u793a\u6cd5\uff0c\u8bf7\u6ce8\u610f\u67d0\u4e9b\u952e\u53ef\u80fd\u4f1a\u5f15\u8d77\u95ee\u9898\uff0c\u56e0\u4e3a\u5b83\u4eec\u4e0epython\u8bcd\u5178\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u51b2\u7a81\u3002 \u5982\u679c\u60a8\u4f7f\u7528\u4ee5\u4e24\u4e2a\u4e0b\u5212\u7ebf\u5f00\u5934\u548c\u7ed3\u5c3e\u7684\u952e\uff08\u8fd9\u4e9b\u952e\u5728python\u4e2d\u4fdd\u7559\u4e86\u7279\u6b8a\u542b\u4e49\uff09\u6216\u4e3a\u4efb\u4f55\u5df2\u77e5\u7684\u516c\u5171\u5c5e\u6027\uff0c\u5219\u5e94\u4f7f\u7528\u65b9\u62ec\u53f7\u800c\u4e0d\u662f\u70b9\u7b26\u53f7\u3002add , append , as_integer_ratio , bit_length , capitalize , center , clear , conjugate , copy , count , decode , denominator , difference , difference_update , discard , encode , endswith , expandtabs , extend , find , format , fromhex , fromkeys , get , has_key , hex , imag , index , insert , intersection , intersection_update , isalnum , isalpha , isdecimal , isdigit , isdisjoint , is_integer , islower , isnumeric , isspace , issubset , issuperset , istitle , isupper , items , iteritems , iterkeys , itervalues , join , keys , ljust , lower , lstrip , numerator , partition , pop , popitem , real , remove , replace , reverse , rfind , rindex , rjust , rpartition , rsplit , rstrip , setdefault , sort , split , splitlines , startswith , strip , swapcase , symmetric_difference , symmetric_difference_update , title , translate , union , update , upper , values , viewitems , viewkeys , viewvalues , zfill \u53d8\u91cf\u4f7f\u7528 \u00b6 \u901a\u8fc7\u547d\u4ee4\u884c\u4f20\u9012\u53d8\u91cf(extra vars) \u00b6 \u901a\u8fc7 --extra-vars \u6216 -e \u9009\u9879\u6765\u4f20\u9012 key=value \u53d8\u91cf ansible-playbook release.yml -e \"user=starbuck\" \u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u4f20\u9012\u5b57\u5178 ansible-playbook arcade.yml -e '{\"pacman\":\"mrs\",\"ghosts\":[\"inky\",\"pinky\",\"clyde\",\"sue\"]}' \u53d8\u91cf\u6587\u4ef6\u7684\u8bdd\uff0c\u4e5f\u662f\u53ef\u4ee5\u7684 ansible-playbook test.yml -e @variables.yaml yaml\u683c\u5f0f\u7684\u53d8\u91cf\uff0c\u4e5f\u662f\u53ef\u4ee5\u4f20\u9012\u7684 ansible-playbook arcade.yml --extra-vars ' pacman: mrs ghosts: - inky - pinky - clyde - sue' \u5728inventory \u4e2d\u5b9a\u4e49\u53d8\u91cf\uff08inventory vars) \u00b6 \u901a\u5e38\uff0c\u60a8\u9700\u8981\u4e3a\u5355\u4e2a\u4e3b\u673a\u6216\u6e05\u5355\u4e2d\u7684\u4e00\u7ec4\u4e3b\u673a\u8bbe\u7f6e\u53d8\u91cf\u3002 host3 http_port = 80 # \u5b9a\u4e49\u4e3b\u673a\u53d8\u91cf [webservers:vars] # \u5b9a\u4e49\u7ec4\u7684\u53d8\u91cf ntp_server = ntp.example.com \u5728play\u4e2d\u5b9a\u4e49\u53d8\u91cf\uff08play vars\uff09 \u00b6 \u4f60\u53ef\u4ee5\u901a\u8fc7 play \u7684 vars \u5173\u952e\u5b57\u6765\u5b9a\u4e49\u53d8\u91cf - hosts : webservers vars : http_port : 80 \u5728\u89d2\u8272\u548c\u6587\u4ef6\u5305\u542b\u4e2d\u5b9a\u4e49\u53d8\u91cf(play include_vars) \u00b6 \u901a\u8fc7\u5728playbook\u4e2d\u5b9a\u4e49 include_vars \u6a21\u5757\uff0c\u6765\u5305\u542b\u53d8\u91cf\u6587\u4ef6 - hosts : webservers tasks : include_vars : myvars.yml \u5728play\u4e2d\u5305\u542b\u53d8\u91cf\u6587\u4ef6(play vars_files) \u00b6 \u4f60\u53ef\u4ee5\u901a\u8fc7 play \u7684 vars_files \u5173\u952e\u5b57\u6765\u5b9a\u4e49\u53d8\u91cf\u7684\u6587\u4ef6 - hosts : webservers vars_files : - /vars/external_vars.yml \u5b9a\u4e49\u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf\uff08role defaults vars\uff09 \u00b6 \u5728\u89d2\u8272\u76ee\u5f55\u4e2d\u6dfb\u52a0\u4e00\u4e2a defaults/main.yml \u6587\u4ef6\u3002\u6587\u4ef6\u91cc\u5b58\u50a8\u7740 yaml \u6216 json \u683c\u5f0f\u7684\u6570\u636e\u3002 # file: roles/x/defaults/main.yml http_port : 80 \u5b9a\u4e49\u89d2\u8272\u53d8\u91cf\uff08role vars\uff09 \u00b6 \u5728\u89d2\u8272\u76ee\u5f55\u4e2d\u6dfb\u52a0\u4e00\u4e2a vars/main.yml \u6587\u4ef6\u3002\u6587\u4ef6\u91cc\u5b58\u50a8\u7740 yaml \u6216 json \u683c\u5f0f\u7684\u6570\u636e\u3002 # file: roles/x/vars/main.yml http_port : 80 \u4ee5\u4ea4\u4e92\u65b9\u5f0f\u83b7\u53d6\u53d8\u91cf\u503c( play vars_prompt) \u00b6 --- - hosts : server vars_prompt : - name : web prompt : 'Please input the web server:' private : no \u5b9a\u4e49\u89d2\u8272\u53d8\u91cf\uff08role and include vars) \u00b6 \u5728\u5f15\u5165\u89d2\u8272\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u50cf\u89d2\u8272\u4f20\u9012\u4e00\u4e9b\u53d8\u91cf roles : - { role : app_user , name : Ian } name \u5c31\u662f\u4f20\u9012\u7ed9\u89d2\u8272\u7684\u53d8\u91cf \u6ce8\u518c\u53d8\u91cf\uff08registered vars\uff09 \u00b6 \u53d8\u91cf\u7684\u53e6\u4e00\u4e2a\u4e3b\u8981\u7528\u9014\u662f\u8fd0\u884c\u547d\u4ee4\u5e76\u5c06\u8be5\u547d\u4ee4\u7684\u7ed3\u679c\u6ce8\u518c\u4e3a\u53d8\u91cf\u3002\u5f53\u60a8\u6267\u884c\u4e00\u4e2a\u4efb\u52a1\u5e76\u5c06\u8fd4\u56de\u503c\u4fdd\u5b58\u5728\u4e00\u4e2a\u53d8\u91cf\u4e2d\u4f9b\u4ee5\u540e\u7684\u4efb\u52a1\u4f7f\u7528\u65f6\uff0c\u60a8\u5c06\u521b\u5efa\u4e00\u4e2a\u5df2\u6ce8\u518c\u7684\u53d8\u91cf\u3002 --- - hosts : all tasks : - shell : uptime register : result - name : show uptime debug : var=result \u6b64\u9009\u9879\u5c06\u4efb\u52a1\u7684\u7ed3\u679c\u5b58\u50a8\u5728\u53d8\u91cf\u4e2d\uff0c\u7ed3\u679c\u53c2\u6570\u53ef\u4ee5\u7528\u5728\u6a21\u7248\u4e2d\u3002\u540d\u79f0\u4e3aresult\uff0c\u4f7f\u7528debug\u6765\u8f93\u51faresult\u7684\u4fe1\u606f\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528 {{ hostvars[inventory_hostname].result.stdout }} \u53ef\u4ee5\u83b7\u5f97\u6ce8\u518c\u53d8\u91cf\u7684 \u7ed3\u679c\u56e0\u6a21\u5757\u800c\u5f02\u3002 \u6bcf\u4e2a\u6a21\u5757\u7684\u6587\u6863\u90fd\u5305\u542b\u4e00\u4e2a RETURN \u90e8\u5206\uff0c\u63cf\u8ff0\u8be5\u6a21\u5757\u7684\u8fd4\u56de\u503c\u3002 \u8981\u67e5\u770b\u7279\u5b9a\u4efb\u52a1\u7684\u503c\uff0c\u8bf7\u4f7f\u7528 -v \u8fd0\u884c\u60a8\u7684\u5267\u672c\u3002 \u6ce8\u518c\u53d8\u91cf\u4ec5\u5b58\u50a8\u5728\u5185\u5b58\u4e2d, \u5f53\u60a8\u7528\u5faa\u73af\u5728\u4efb\u52a1\u4e2d\u6ce8\u518c\u4e00\u4e2a\u53d8\u91cf\u65f6\uff0c\u5df2\u6ce8\u518c\u7684\u53d8\u91cf\u5305\u542b\u5faa\u73af\u4e2d\u6bcf\u4e2a\u9879\u7684\u503c\u3002\u5728\u5faa\u73af\u671f\u95f4\u653e\u7f6e\u5728\u53d8\u91cf\u4e2d\u7684\u6570\u636e\u7ed3\u6784\u5c06\u5305\u542b\u4e00\u4e2aresults\u5c5e\u6027\uff0c\u5b83\u662f\u6765\u81ea\u6a21\u5757\u7684\u6240\u6709\u54cd\u5e94\u7684\u5217\u8868\u3002 \u4ee5\u4e0b\u662f\u4e00\u4e9b\u91cd\u8981\u7684\u6ce8\u518c\u53d8\u91cf\u7684\u7ec4\u4ef6\uff1a changed: \u663e\u793a\u662f\u5426\u5df2\u66f4\u6539 cmd: \u6267\u884c\u7684\u547d\u4ee4 rc: \u547d\u4ee4\u7684\u8fd4\u56de\u7801 stdout:\u547d\u4ee4\u7684\u8f93\u51fa stdout_lines: \u9010\u884c\u8f93\u51fa stderr: \u5982\u679c\u6709\u9519\u8bef\uff0c\u5219\u8f93\u51fa\u9519\u8bef\u7684\u4fe1\u606f stderr_lines: \u9010\u884c\u8f93\u51fa\u9519\u8bef\u4fe1\u606f \u52a8\u6001\u521b\u5efafact\u53d8\u91cf \u00b6 \u4f7f\u7528 set_fact \u5728\u8fd0\u884c\u4e2d\u8bbe\u7f6e facts \u53d8\u91cf tasks : - command : whoami register : result - set_fact : w={{result.stdout}} - debug : var=w \u53d8\u91cf\u4f18\u5148\u7ea7 \u00b6 \u4e0a\u9762\u5217\u51fa\u4e86\u5927\u90e8\u5206\u7684\u53d8\u91cf\u5b9a\u4e49\u4f4d\u7f6e\uff0c\u8fd9\u4e9b\u4e0d\u540c\u4f4d\u7f6e\u7684\u53d8\u91cf\u90fd\u662f\u6709\u4f18\u5148\u7ea7\u7684\uff0c\u5728\u4e0d\u540c\u4f4d\u7f6e\u4e0a\u540c\u65f6\u8bbe\u7f6e\u65f6\uff0c\u9ad8\u4f18\u5148\u7ea7\u7684\u4f1a\u8986\u76d6\u6389\u4f4e\u4f18\u5148\u7ea7\u7684\u53d8\u91cf\uff0c \u4e0b\u9762\u662f\u4f18\u5148\u7ea7\u4ece\u6700\u5c0f\u5230\u6700\u5927\u7684\u987a\u5e8f(\u6700\u540e\u5217\u51fa\u7684\u53d8\u91cf\u662f\u6700\u9ad8\u4f18\u5148\u7ea7) command line values (eg \u201c-u user\u201d) role defaults inventory file or script group vars inventory group_vars/all playbook group_vars/all inventory group_vars/* playbook group_vars/* inventory file or script host vars inventory host_vars/* playbook host_vars/* host facts / cached set_facts play vars play vars_prompt play vars_files role vars (defined in role/vars/main.yml) block vars (only for tasks in block) task vars (only for the task) include_vars set_facts / registered vars role (and include_role) params include params extra vars (always win precedence) \u547d\u4ee4\u884c\u53d8\u91cf Note \u4e0a\u8ff0\u63cf\u8ff0\u7684\u662f\u9ed8\u8ba4\u89c4\u5219\u53d8\u91cf\u8986\u76d6 hash_behaviour=replace , \u4f7f\u7528 merge \u53ef\u4ee5\u66f4\u6539\u4e3a\u5408\u5e76\u3002 \u53d8\u91cf\u8303\u56f4 \u00b6 \u60a8\u53ef\u4ee5\u6839\u636e\u5e0c\u671b\u7684\u8303\u56f4\u6765\u51b3\u5b9a\u5728\u4f55\u5904\u8bbe\u7f6e\u53d8\u91cf\u3002Ansible\u6709\u4e09\u4e2a\u4e3b\u8981\u7684\u8303\u56f4 \u5168\u5c40\uff1a\u8fd9\u662f\u7531config\uff0c\u73af\u5883\u53d8\u91cf\u548c\u547d\u4ee4\u884c\u8bbe\u7f6e\u7684 play\uff1a\u6bcf\u4e2aplay\u548c\u5305\u542b\u7684\u7ed3\u6784\uff0cvars\u6761\u76ee(vars; vars_files; vars_prompt)\uff0c\u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf\u548cvars\u3002 \u4e3b\u673a\uff1a\u76f4\u63a5\u4e0e\u4e3b\u673a\u76f8\u5173\u8054\u7684\u53d8\u91cf\uff0c\u50cfinventory, include_vars, facts or registered \u4f7f\u7528\u53d8\u91cf \u00b6 \u5728jinja2\u4e2d\u4f7f\u7528 \u00b6 \u4e00\u65e6\u5b9a\u4e49\u4e86\u53d8\u91cf\uff0c\u5c31\u53ef\u4ee5\u5728\u4f7f\u7528Jinja2\u6a21\u677f\u7cfb\u7edf\u7684\u5267\u672c\u4e2d\u4f7f\u7528\u5b83\u4eec\u3002\u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684Jinja2\u6a21\u677f My amp goes to {{ max_amp_value }} \u8fd9\u4e2a\u8868\u8fbe\u5f0f\u63d0\u4f9b\u4e86\u6700\u57fa\u672c\u7684\u53d8\u91cf\u66ff\u6362\u5f62\u5f0f\u3002 \u60a8\u53ef\u4ee5\u5728\u5267\u672c\u4e2d\u4f7f\u7528\u76f8\u540c\u7684\u8bed\u6cd5\u3002\u4f8b\u5982 template : src=foo.cfg.j2 dest={{ remote_install_path }}/foo.cfg \u4f7f\u7528Jinja2\u8fc7\u6ee4\u5668\u8f6c\u6362\u53d8\u91cf \u00b6 Jinja2\u8fc7\u6ee4\u5668\u5141\u8bb8\u60a8\u5728\u6a21\u677f\u8868\u8fbe\u5f0f\u4e2d\u8f6c\u6362\u53d8\u91cf\u7684\u503c\u3002\u4f8b\u5982\uff0c capitalize \u8fc7\u6ee4\u5668\u5c06\u4f20\u9012\u7ed9\u5b83\u7684\u4efb\u4f55\u503c\u90fd\u5927\u5199; to_yaml \u548c to_json \u8fc7\u6ee4\u5668\u4f1a\u66f4\u6539\u53d8\u91cf\u503c\u7684\u683c\u5f0f\u3002 YAML\u8bed\u6cd5\u8981\u6c42\uff0c\u5982\u679c\u60a8\u4ee5 {{foo}} \u5f00\u59cb\u4e00\u4e2a\u503c\uff0c\u5219\u5fc5\u987b \u7528\u5f15\u53f7\u5305\u88f9\u6574\u884c \uff0c\u56e0\u4e3a\u5b83\u5e0c\u671b\u786e\u4fdd\u60a8\u6ca1\u6709\u8bd5\u56fe\u542f\u52a8YAML\u5b57\u5178\u3002YAML\u8bed\u6cd5\u6587\u6863\u5bf9\u6b64\u8fdb\u884c\u4e86\u4ecb\u7ecd\u3002 \u4e0b\u9762\u8fd9\u4e2a\u65f6\u9519\u8bef\u7684\u5199\u6cd5 - hosts : app_servers vars : app_path : {{ base_path }} /22 \u8fd9\u6837\u5199\uff0c\u624d\u662f\u5bf9\u7684\u3002 - hosts : app_servers vars : app_path : \"{{ base_path }}/22\" \u4ece\u7cfb\u7edf\u4e2d\u53d1\u73b0\u53d8\u91cf:Facts \u00b6 \u8fd8\u6709\u5176\u4ed6\u5730\u65b9\u53ef\u4ee5\u4f7f\u7528\u53d8\u91cf\uff0c\u4f46\u662f\u8fd9\u4e9b\u662f\u88ab\u53d1\u73b0\u7684\u53d8\u91cf\u7c7b\u578b\uff0c\u4e0d\u662f\u7531\u7528\u6237\u8bbe\u7f6e\u7684\u3002 Facts \u662f\u901a\u8fc7\u4e0e\u8fdc\u7a0b\u7cfb\u7edf\u5bf9\u8bdd\u800c\u83b7\u5f97\u7684\u4fe1\u606f\u3002\u6570\u636e\u5b58\u50a8\u5728 ansible_facts \u53d8\u91cf\u4e2d\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e0b\u5217\u793a\u4f8b\u6765\u83b7\u53d6\u53d8\u91cf\u4e2d\u7684\u4fe1\u606f - debug : var=ansible_facts \u6216\u8005\u4f7f\u7528 setup \u6a21\u5757 ansible hostname -m setup \u8bbf\u95ee\u590d\u6742\u53d8\u91cf\u6570\u636e \u00b6 \u4f7f\u7528\u5d4c\u5957\u6570\u636e\u7ed3\u6784\u8bbf\u95ee\u53d8\u91cf {{ ansible_facts[\"eth0\"][\"ipv4\"][\"address\"] }} \u6216\u8005\u4f7f\u7528 . \u7b26\u53f7 {{ ansible_facts.eth0.ipv4.address }} \u7c7b\u4f3c\u5730\uff0c\u8fd9\u662f\u6211\u4eec\u8bbf\u95ee\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u65b9\u5f0f {{ foo[0] }} \u4f7f\u7528\u5185\u7f6e\u53d8\u91cf \u00b6 ansible \u63d0\u4f9b\u4e86\u8bb8\u591a\u5185\u7f6e\u53d8\u91cf\uff0c\u6765\u5e2e\u52a9\u5927\u5bb6\u83b7\u53d6\u5f53\u524d\u8fd0\u884c\u7684\u8bf8\u591a\u4fe1\u606f\uff0c\u901a\u8fc7\u5185\u7f6e\u53d8\u91cf\uff0c\u6211\u4eec\u53ef\u4ee5\u505a\u66f4\u591a\u7684\u4e8b\u60c5\uff0c\u6bd4\u5982\u83b7\u53d6\u4e3b\u673a\u7684\u81ea\u5b9a\u4e49fact\uff0c\u83b7\u53d6\u5f53\u524d\u8fd0\u884c\u7684\u4e3b\u673a\u7b49\u7b49\u3002 \u9b54\u672f\u53d8\u91cf \u00b6 \u53d8\u91cf\u540d\u79f0 \u8bf4\u660e \u4f7f\u7528 ansible_check_mode \u662f\u5426\u5904\u4e8e\u68c0\u67e5\u6a21\u5f0f\uff0c\u8fd4\u56de\u5e03\u5c14\u503c {{ ansible_check_mode }} ansible_dependent_role_names \u5f53\u524d\u5267\u672c\u4f9d\u8d56\u7684\u89d2\u8272\u540d\u79f0 {{ ansible_dependent_role_names}} ansible_diff_mode \u662f\u5426\u5904\u4e8e\u5bf9\u6bd4\u6a21\u5f0f\uff0c\u8fd4\u56de\u5e03\u5c14\u503c {{ ansible_diff_mode }} ansible_forks \u8fd4\u56de\u6700\u5927\u5e76\u884c\u8fd0\u884c\u7684\u6570\u91cf {{ ansible_forks }} ansible_inventory_sources \u7528\u4f5c\u4e3b\u673a\u6e05\u5355\u7684\u8d44\u6e90\u5217\u8868 {{ ansible_inventory_sources }} ansible_limit CLI\u9009\u9879 --limit \u7684\u5185\u5bb9 {{ ansible_limit }} ansible_loop \u901a\u8fc7 loop_control.extended \u542f\u7528\u65f6\uff0c\u5305\u542b\u6269\u5c55\u5faa\u73af\u4fe1\u606f\u7684\u5b57\u5178/\u6620\u5c04 {{ ansible_loop }} ansible_loop_var \u63d0\u4f9b\u7ed9 loop_control.loop_var \u7684\u503c\u7684\u540d\u79f0 {{ ansible_loop_var }} ansible_index_var \u63d0\u4f9b\u7ed9 loop_control.index_var \u7684\u503c\u7684\u540d\u79f0 {{ ansible_index_var }} ansible_parent_role_paths \u5f53\u901a\u8fc7 include_role \u6216 import_role \u64cd\u4f5c\u6267\u884c\u5f53\u524d\u89d2\u8272\u65f6\uff0c\u6b64\u53d8\u91cf\u5305\u542b\u6240\u6709\u7236\u89d2\u8272\u7684\u5217\u8868\uff0c\u800c\u6700\u65b0\u89d2\u8272\uff08\u5373\u5305\u542b/\u5bfc\u5165\u8be5\u89d2\u8272\u7684\u89d2\u8272\uff09\u662f\u5217\u8868\u4e2d\u7684\u7b2c\u4e00\u9879\u3002 {{ ansible_parent_role_paths }} ansible_play_hosts ansible_play_batch \u5305\u542b\u5f53\u524d\u8fd0\u884c\u7684\u4e3b\u673a\u5217\u8868\uff0c\u53d7serial\u53c2\u6570\u5f71\u54cd `{{ ansible_play_hosts }} {{ ansible_play_batch }}` ansible_play_hosts_all \u6240\u6709\u6267\u884c\u4e3b\u673a\u7684\u5217\u8868 {{ ansible_play_hosts_all }} ansible_play_role_names \u5f53\u524d\u5bfc\u5165\u5230\u5f53\u524d\u5267\u672c\u4e2d\u7684\u89d2\u8272\u7684\u540d\u79f0 {{ ansible_play_role_names }} ansible_playbook_python \u63a7\u5236\u5668\u4e0aAnsible\u4f7f\u7528\u7684python\u89e3\u91ca\u5668\u7684\u8def\u5f84 {{ ansible_playbook_python }} ansible_role_names \u5f53\u524d\u5bfc\u5165\u89d2\u8272\u7684\u540d\u79f0 {{ ansible_role_names }} ansible_run_tags --tags CLI\u9009\u9879\u7684\u5185\u5bb9\uff0c\u8be5\u9009\u9879\u6307\u5b9a\u5f53\u524d\u8fd0\u884c\u5c06\u5305\u62ec\u54ea\u4e9b\u6807\u7b7e\u3002 {{ ansible_run_tags}} ansible_search_path action \u63d2\u4ef6 lookups \u7684\u5f53\u524d\u641c\u7d22\u8def\u5f84 {{ ansible_search_path}} ansible_skip_tags --skip \u6807\u8bb0CLI\u9009\u9879\u7684\u5185\u5bb9\uff0c\u8be5\u9009\u9879\u6307\u5b9a\u5728\u5f53\u524d\u8fd0\u884c\u4e2d\u5c06\u8df3\u8fc7\u54ea\u4e9b\u6807\u8bb0\u3002 {{ ansible_skip_tags}} ansible_verbosity Ansible\u7684\u8be6\u7ec6\u7248\u672c\u4fe1\u606f {{ ansible_verbosity }} ansible_version ansible\u7248\u672c\u4fe1\u606f {{ ansible_version }} ansible_playbook_python ansible\u7684python\u53ef\u6267\u884c\u8def\u5f84 {{ ansible_playbook_python }} groups_name \u5f53\u524d\u4e3b\u673a\u6240\u5728\u7ec4\u7684\u4e3b\u673a\u5217\u8868 {% if 'webserver' in group_names %} # some part of a configuration file that only applies to webservers {% endif %} groups \u5305\u542b\u8bbe\u5907\u6e05\u5355\u7ec4\u5185\u7684\u6240\u6709\u4e3b\u673a {% for host in groups[\u2018db_servers\u2019] %} {{ host }} {% endfor %} hostvars \u5305\u542b\u8fd0\u884c\u7684\u6240\u6709\u53d8\u91cf\u4fe1\u606f {{ hostvars['db.example.com'].ansible_eth0.ipv4.address }} inventory_hostname \u5f53\u524d\u8fd0\u884c\u4e3b\u673a\u7684\u5e93\u5b58\u914d\u7f6e\u540d\u79f0 {{ inventory_hostname }} {{ hostvars[inventory_hostname] }} inventory_hostname_short inventory_hostname \u7684\u7b80\u77ed\u7248\u672c {{ inventory_hostname_short }} inventory_dir \u5b58\u653e\u4e3b\u673a\u6e05\u5355\u7684\u76ee\u5f55 {{ inventory_dir }} inventory_file \u4e3b\u673a\u6e05\u5355\u7684\u6587\u4ef6\u540d {{ inventory_file }} omit \u5141\u8bb8\u60a8\u5ffd\u7565\u67d0\u4e2a\u9009\u9879\u7684\u7279\u6b8a\u53d8\u91cf - user: name=bob home={{ bobs_home ansible_play_name \u5f53\u524d\u6b63\u5728\u6267\u884c\u7684 play name {{ ansible_play_name }} playbook_dir playbook\u7684\u8def\u5f84 {{ playbook_dir }} role_name \u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u89d2\u8272\u540d\u79f0\u3002 {{ role_name }} role_path \u8fd4\u56de\u7684\u5f53\u524d\u89d2\u8272\u8def\u5f84\uff0c\u53ea\u5728role\u4e2d\u8d77\u4f5c\u7528 {{ role_path }} Facts \u53d8\u91cf \u00b6 \u53d8\u91cf\u540d\u79f0 \u8bf4\u660e \u4f7f\u7528 ansible_facts \u5305\u542b\u6240\u6709\u8fd0\u884c\u7684\u4e3b\u673a\u6536\u96c6\u6570\u636e {{ ansible_facts }} ansible_local inventory_hostname \u4e3b\u673a\u81ea\u5b9a\u4e49\u7684\u672c\u5730fact\u53d8\u91cf {{ ansible_local }} \u8fde\u63a5\u53d8\u91cf \u00b6 \u53d8\u91cf\u540d\u79f0 \u8bf4\u660e \u4f7f\u7528 ansible_become_user \u6743\u9650\u63d0\u5347\u7684\u7528\u6237 {{ ansible_become_user }} ansible_connection \u4f7f\u7528\u7684\u8fde\u63a5\u63d2\u4ef6 {{ ansible_connection }} ansible_host \u5f53\u524d\u4f7f\u7528\u7684\u8fdc\u7aef\u4e3b\u673a\u7684 ip/name \u540d\u79f0 {{ ansible_host }} ansible_python_interpreter ansible\u5728\u8fdc\u7aef\u7684python\u53ef\u6267\u884c\u8def\u5f84 {{ ansible_python_interpreter }} ansible_user \u4f7f\u7528ansible\u767b\u5f55\u8fdc\u7aef\u7684\u7528\u6237 {{ ansible_user }}","title":"10. \u4f7f\u7528\u53d8\u91cf"},{"location":"basic/Variables/#10","text":"\u867d\u7136\u81ea\u52a8\u5316\u7684\u5b58\u5728\u662f\u4e3a\u4e86\u8ba9\u4e8b\u60c5\u66f4\u5bb9\u6613\u91cd\u590d\uff0c\u4f46\u5e76\u975e\u6240\u6709\u7684\u7cfb\u7edf\u90fd\u662f\u5b8c\u5168\u76f8\u540c\u7684;\u6709\u4e9b\u53ef\u80fd\u9700\u8981\u7684\u914d\u7f6e\u4e0e\u5176\u4ed6\u7684\u7a0d\u6709\u4e0d\u540c\u3002\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6240\u89c2\u5bdf\u5230\u7684\u4e00\u4e2a\u7cfb\u7edf\u7684\u884c\u4e3a\u6216\u72b6\u6001\u53ef\u80fd\u4f1a\u5f71\u54cd\u60a8\u914d\u7f6e\u5176\u4ed6\u7cfb\u7edf\u7684\u65b9\u5f0f\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u627e\u5230\u4e00\u4e2a\u7cfb\u7edf\u7684IP\u5730\u5740\uff0c\u5e76\u5c06\u5176\u7528\u4f5c\u53e6\u4e00\u4e2a\u7cfb\u7edf\u4e0a\u7684\u914d\u7f6e\u503c\u3002 Ansible\u4f7f\u7528 \u53d8\u91cf( variables ) \u6765\u5e2e\u52a9\u5904\u7406\u7cfb\u7edf\u4e4b\u95f4\u7684\u5dee\u5f02\u3002","title":"10. \u4f7f\u7528\u53d8\u91cf"},{"location":"basic/Variables/#_1","text":"\u5728\u4f7f\u7528\u53d8\u91cf\u4e4b\u524d\uff0c\u4f60\u8981\u5148\u77e5\u9053\u4ec0\u4e48\u662f \u6709\u6548 \u7684\u53d8\u91cf\u540d\u79f0, \u4ee5\u4e0b\u662f\u53d8\u91cf\u540d\u7684\u9075\u5faa\u89c4\u5219 \u53d8\u91cf\u540d\u79f0\u5e94\u4e3a \u5b57\u6bcd \uff0c \u6570\u5b57 \u548c \u4e0b\u5212\u7ebf \u3002 \u53d8\u91cf\u5e94\u59cb\u7ec8 \u4ee5\u5b57\u6bcd\u5f00\u5934 \u3002 \u53d8\u91cf\u540d\u4e0d\u5e94\u4e0epython\u5c5e\u6027\u548c\u65b9\u6cd5\u540d\u51b2\u7a81\u3002 YAML\u8fd8\u652f\u6301\u5c06\u952e\u6620\u5c04\u5230\u503c\u7684\u5b57\u5178 foo : field1 : one field2 : two \u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u65b9\u62ec\u53f7\u7b26\u53f7\u6216\u70b9\u7b26\u53f7\u6765\u5f15\u7528\u5b57\u5178\u4e2d\u7684\u7279\u5b9a\u5b57\u6bb5 foo['field1'] foo.field2 Note \u5982\u679c\u9009\u62e9\u4f7f\u7528\u70b9\u8868\u793a\u6cd5\uff0c\u8bf7\u6ce8\u610f\u67d0\u4e9b\u952e\u53ef\u80fd\u4f1a\u5f15\u8d77\u95ee\u9898\uff0c\u56e0\u4e3a\u5b83\u4eec\u4e0epython\u8bcd\u5178\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u51b2\u7a81\u3002 \u5982\u679c\u60a8\u4f7f\u7528\u4ee5\u4e24\u4e2a\u4e0b\u5212\u7ebf\u5f00\u5934\u548c\u7ed3\u5c3e\u7684\u952e\uff08\u8fd9\u4e9b\u952e\u5728python\u4e2d\u4fdd\u7559\u4e86\u7279\u6b8a\u542b\u4e49\uff09\u6216\u4e3a\u4efb\u4f55\u5df2\u77e5\u7684\u516c\u5171\u5c5e\u6027\uff0c\u5219\u5e94\u4f7f\u7528\u65b9\u62ec\u53f7\u800c\u4e0d\u662f\u70b9\u7b26\u53f7\u3002add , append , as_integer_ratio , bit_length , capitalize , center , clear , conjugate , copy , count , decode , denominator , difference , difference_update , discard , encode , endswith , expandtabs , extend , find , format , fromhex , fromkeys , get , has_key , hex , imag , index , insert , intersection , intersection_update , isalnum , isalpha , isdecimal , isdigit , isdisjoint , is_integer , islower , isnumeric , isspace , issubset , issuperset , istitle , isupper , items , iteritems , iterkeys , itervalues , join , keys , ljust , lower , lstrip , numerator , partition , pop , popitem , real , remove , replace , reverse , rfind , rindex , rjust , rpartition , rsplit , rstrip , setdefault , sort , split , splitlines , startswith , strip , swapcase , symmetric_difference , symmetric_difference_update , title , translate , union , update , upper , values , viewitems , viewkeys , viewvalues , zfill","title":"\u521b\u5efa\u6709\u6548\u7684\u53d8\u91cf\u540d"},{"location":"basic/Variables/#_2","text":"","title":"\u53d8\u91cf\u4f7f\u7528"},{"location":"basic/Variables/#extra-vars","text":"\u901a\u8fc7 --extra-vars \u6216 -e \u9009\u9879\u6765\u4f20\u9012 key=value \u53d8\u91cf ansible-playbook release.yml -e \"user=starbuck\" \u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u4f20\u9012\u5b57\u5178 ansible-playbook arcade.yml -e '{\"pacman\":\"mrs\",\"ghosts\":[\"inky\",\"pinky\",\"clyde\",\"sue\"]}' \u53d8\u91cf\u6587\u4ef6\u7684\u8bdd\uff0c\u4e5f\u662f\u53ef\u4ee5\u7684 ansible-playbook test.yml -e @variables.yaml yaml\u683c\u5f0f\u7684\u53d8\u91cf\uff0c\u4e5f\u662f\u53ef\u4ee5\u4f20\u9012\u7684 ansible-playbook arcade.yml --extra-vars ' pacman: mrs ghosts: - inky - pinky - clyde - sue'","title":"\u901a\u8fc7\u547d\u4ee4\u884c\u4f20\u9012\u53d8\u91cf(extra vars)"},{"location":"basic/Variables/#inventory-inventory-vars","text":"\u901a\u5e38\uff0c\u60a8\u9700\u8981\u4e3a\u5355\u4e2a\u4e3b\u673a\u6216\u6e05\u5355\u4e2d\u7684\u4e00\u7ec4\u4e3b\u673a\u8bbe\u7f6e\u53d8\u91cf\u3002 host3 http_port = 80 # \u5b9a\u4e49\u4e3b\u673a\u53d8\u91cf [webservers:vars] # \u5b9a\u4e49\u7ec4\u7684\u53d8\u91cf ntp_server = ntp.example.com","title":"\u5728inventory \u4e2d\u5b9a\u4e49\u53d8\u91cf\uff08inventory vars)"},{"location":"basic/Variables/#playplay-vars","text":"\u4f60\u53ef\u4ee5\u901a\u8fc7 play \u7684 vars \u5173\u952e\u5b57\u6765\u5b9a\u4e49\u53d8\u91cf - hosts : webservers vars : http_port : 80","title":"\u5728play\u4e2d\u5b9a\u4e49\u53d8\u91cf\uff08play vars\uff09"},{"location":"basic/Variables/#play-include_vars","text":"\u901a\u8fc7\u5728playbook\u4e2d\u5b9a\u4e49 include_vars \u6a21\u5757\uff0c\u6765\u5305\u542b\u53d8\u91cf\u6587\u4ef6 - hosts : webservers tasks : include_vars : myvars.yml","title":"\u5728\u89d2\u8272\u548c\u6587\u4ef6\u5305\u542b\u4e2d\u5b9a\u4e49\u53d8\u91cf(play include_vars)"},{"location":"basic/Variables/#playplay-vars_files","text":"\u4f60\u53ef\u4ee5\u901a\u8fc7 play \u7684 vars_files \u5173\u952e\u5b57\u6765\u5b9a\u4e49\u53d8\u91cf\u7684\u6587\u4ef6 - hosts : webservers vars_files : - /vars/external_vars.yml","title":"\u5728play\u4e2d\u5305\u542b\u53d8\u91cf\u6587\u4ef6(play vars_files)"},{"location":"basic/Variables/#role-defaults-vars","text":"\u5728\u89d2\u8272\u76ee\u5f55\u4e2d\u6dfb\u52a0\u4e00\u4e2a defaults/main.yml \u6587\u4ef6\u3002\u6587\u4ef6\u91cc\u5b58\u50a8\u7740 yaml \u6216 json \u683c\u5f0f\u7684\u6570\u636e\u3002 # file: roles/x/defaults/main.yml http_port : 80","title":"\u5b9a\u4e49\u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf\uff08role defaults vars\uff09"},{"location":"basic/Variables/#role-vars","text":"\u5728\u89d2\u8272\u76ee\u5f55\u4e2d\u6dfb\u52a0\u4e00\u4e2a vars/main.yml \u6587\u4ef6\u3002\u6587\u4ef6\u91cc\u5b58\u50a8\u7740 yaml \u6216 json \u683c\u5f0f\u7684\u6570\u636e\u3002 # file: roles/x/vars/main.yml http_port : 80","title":"\u5b9a\u4e49\u89d2\u8272\u53d8\u91cf\uff08role  vars\uff09"},{"location":"basic/Variables/#play-vars_prompt","text":"--- - hosts : server vars_prompt : - name : web prompt : 'Please input the web server:' private : no","title":"\u4ee5\u4ea4\u4e92\u65b9\u5f0f\u83b7\u53d6\u53d8\u91cf\u503c( play vars_prompt)"},{"location":"basic/Variables/#role-and-include-vars","text":"\u5728\u5f15\u5165\u89d2\u8272\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u50cf\u89d2\u8272\u4f20\u9012\u4e00\u4e9b\u53d8\u91cf roles : - { role : app_user , name : Ian } name \u5c31\u662f\u4f20\u9012\u7ed9\u89d2\u8272\u7684\u53d8\u91cf","title":"\u5b9a\u4e49\u89d2\u8272\u53d8\u91cf\uff08role and include vars)"},{"location":"basic/Variables/#registered-vars","text":"\u53d8\u91cf\u7684\u53e6\u4e00\u4e2a\u4e3b\u8981\u7528\u9014\u662f\u8fd0\u884c\u547d\u4ee4\u5e76\u5c06\u8be5\u547d\u4ee4\u7684\u7ed3\u679c\u6ce8\u518c\u4e3a\u53d8\u91cf\u3002\u5f53\u60a8\u6267\u884c\u4e00\u4e2a\u4efb\u52a1\u5e76\u5c06\u8fd4\u56de\u503c\u4fdd\u5b58\u5728\u4e00\u4e2a\u53d8\u91cf\u4e2d\u4f9b\u4ee5\u540e\u7684\u4efb\u52a1\u4f7f\u7528\u65f6\uff0c\u60a8\u5c06\u521b\u5efa\u4e00\u4e2a\u5df2\u6ce8\u518c\u7684\u53d8\u91cf\u3002 --- - hosts : all tasks : - shell : uptime register : result - name : show uptime debug : var=result \u6b64\u9009\u9879\u5c06\u4efb\u52a1\u7684\u7ed3\u679c\u5b58\u50a8\u5728\u53d8\u91cf\u4e2d\uff0c\u7ed3\u679c\u53c2\u6570\u53ef\u4ee5\u7528\u5728\u6a21\u7248\u4e2d\u3002\u540d\u79f0\u4e3aresult\uff0c\u4f7f\u7528debug\u6765\u8f93\u51faresult\u7684\u4fe1\u606f\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528 {{ hostvars[inventory_hostname].result.stdout }} \u53ef\u4ee5\u83b7\u5f97\u6ce8\u518c\u53d8\u91cf\u7684 \u7ed3\u679c\u56e0\u6a21\u5757\u800c\u5f02\u3002 \u6bcf\u4e2a\u6a21\u5757\u7684\u6587\u6863\u90fd\u5305\u542b\u4e00\u4e2a RETURN \u90e8\u5206\uff0c\u63cf\u8ff0\u8be5\u6a21\u5757\u7684\u8fd4\u56de\u503c\u3002 \u8981\u67e5\u770b\u7279\u5b9a\u4efb\u52a1\u7684\u503c\uff0c\u8bf7\u4f7f\u7528 -v \u8fd0\u884c\u60a8\u7684\u5267\u672c\u3002 \u6ce8\u518c\u53d8\u91cf\u4ec5\u5b58\u50a8\u5728\u5185\u5b58\u4e2d, \u5f53\u60a8\u7528\u5faa\u73af\u5728\u4efb\u52a1\u4e2d\u6ce8\u518c\u4e00\u4e2a\u53d8\u91cf\u65f6\uff0c\u5df2\u6ce8\u518c\u7684\u53d8\u91cf\u5305\u542b\u5faa\u73af\u4e2d\u6bcf\u4e2a\u9879\u7684\u503c\u3002\u5728\u5faa\u73af\u671f\u95f4\u653e\u7f6e\u5728\u53d8\u91cf\u4e2d\u7684\u6570\u636e\u7ed3\u6784\u5c06\u5305\u542b\u4e00\u4e2aresults\u5c5e\u6027\uff0c\u5b83\u662f\u6765\u81ea\u6a21\u5757\u7684\u6240\u6709\u54cd\u5e94\u7684\u5217\u8868\u3002 \u4ee5\u4e0b\u662f\u4e00\u4e9b\u91cd\u8981\u7684\u6ce8\u518c\u53d8\u91cf\u7684\u7ec4\u4ef6\uff1a changed: \u663e\u793a\u662f\u5426\u5df2\u66f4\u6539 cmd: \u6267\u884c\u7684\u547d\u4ee4 rc: \u547d\u4ee4\u7684\u8fd4\u56de\u7801 stdout:\u547d\u4ee4\u7684\u8f93\u51fa stdout_lines: \u9010\u884c\u8f93\u51fa stderr: \u5982\u679c\u6709\u9519\u8bef\uff0c\u5219\u8f93\u51fa\u9519\u8bef\u7684\u4fe1\u606f stderr_lines: \u9010\u884c\u8f93\u51fa\u9519\u8bef\u4fe1\u606f","title":"\u6ce8\u518c\u53d8\u91cf\uff08registered vars\uff09"},{"location":"basic/Variables/#fact","text":"\u4f7f\u7528 set_fact \u5728\u8fd0\u884c\u4e2d\u8bbe\u7f6e facts \u53d8\u91cf tasks : - command : whoami register : result - set_fact : w={{result.stdout}} - debug : var=w","title":"\u52a8\u6001\u521b\u5efafact\u53d8\u91cf"},{"location":"basic/Variables/#_3","text":"\u4e0a\u9762\u5217\u51fa\u4e86\u5927\u90e8\u5206\u7684\u53d8\u91cf\u5b9a\u4e49\u4f4d\u7f6e\uff0c\u8fd9\u4e9b\u4e0d\u540c\u4f4d\u7f6e\u7684\u53d8\u91cf\u90fd\u662f\u6709\u4f18\u5148\u7ea7\u7684\uff0c\u5728\u4e0d\u540c\u4f4d\u7f6e\u4e0a\u540c\u65f6\u8bbe\u7f6e\u65f6\uff0c\u9ad8\u4f18\u5148\u7ea7\u7684\u4f1a\u8986\u76d6\u6389\u4f4e\u4f18\u5148\u7ea7\u7684\u53d8\u91cf\uff0c \u4e0b\u9762\u662f\u4f18\u5148\u7ea7\u4ece\u6700\u5c0f\u5230\u6700\u5927\u7684\u987a\u5e8f(\u6700\u540e\u5217\u51fa\u7684\u53d8\u91cf\u662f\u6700\u9ad8\u4f18\u5148\u7ea7) command line values (eg \u201c-u user\u201d) role defaults inventory file or script group vars inventory group_vars/all playbook group_vars/all inventory group_vars/* playbook group_vars/* inventory file or script host vars inventory host_vars/* playbook host_vars/* host facts / cached set_facts play vars play vars_prompt play vars_files role vars (defined in role/vars/main.yml) block vars (only for tasks in block) task vars (only for the task) include_vars set_facts / registered vars role (and include_role) params include params extra vars (always win precedence) \u547d\u4ee4\u884c\u53d8\u91cf Note \u4e0a\u8ff0\u63cf\u8ff0\u7684\u662f\u9ed8\u8ba4\u89c4\u5219\u53d8\u91cf\u8986\u76d6 hash_behaviour=replace , \u4f7f\u7528 merge \u53ef\u4ee5\u66f4\u6539\u4e3a\u5408\u5e76\u3002","title":"\u53d8\u91cf\u4f18\u5148\u7ea7"},{"location":"basic/Variables/#_4","text":"\u60a8\u53ef\u4ee5\u6839\u636e\u5e0c\u671b\u7684\u8303\u56f4\u6765\u51b3\u5b9a\u5728\u4f55\u5904\u8bbe\u7f6e\u53d8\u91cf\u3002Ansible\u6709\u4e09\u4e2a\u4e3b\u8981\u7684\u8303\u56f4 \u5168\u5c40\uff1a\u8fd9\u662f\u7531config\uff0c\u73af\u5883\u53d8\u91cf\u548c\u547d\u4ee4\u884c\u8bbe\u7f6e\u7684 play\uff1a\u6bcf\u4e2aplay\u548c\u5305\u542b\u7684\u7ed3\u6784\uff0cvars\u6761\u76ee(vars; vars_files; vars_prompt)\uff0c\u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf\u548cvars\u3002 \u4e3b\u673a\uff1a\u76f4\u63a5\u4e0e\u4e3b\u673a\u76f8\u5173\u8054\u7684\u53d8\u91cf\uff0c\u50cfinventory, include_vars, facts or registered","title":"\u53d8\u91cf\u8303\u56f4"},{"location":"basic/Variables/#_5","text":"","title":"\u4f7f\u7528\u53d8\u91cf"},{"location":"basic/Variables/#jinja2","text":"\u4e00\u65e6\u5b9a\u4e49\u4e86\u53d8\u91cf\uff0c\u5c31\u53ef\u4ee5\u5728\u4f7f\u7528Jinja2\u6a21\u677f\u7cfb\u7edf\u7684\u5267\u672c\u4e2d\u4f7f\u7528\u5b83\u4eec\u3002\u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684Jinja2\u6a21\u677f My amp goes to {{ max_amp_value }} \u8fd9\u4e2a\u8868\u8fbe\u5f0f\u63d0\u4f9b\u4e86\u6700\u57fa\u672c\u7684\u53d8\u91cf\u66ff\u6362\u5f62\u5f0f\u3002 \u60a8\u53ef\u4ee5\u5728\u5267\u672c\u4e2d\u4f7f\u7528\u76f8\u540c\u7684\u8bed\u6cd5\u3002\u4f8b\u5982 template : src=foo.cfg.j2 dest={{ remote_install_path }}/foo.cfg","title":"\u5728jinja2\u4e2d\u4f7f\u7528"},{"location":"basic/Variables/#jinja2_1","text":"Jinja2\u8fc7\u6ee4\u5668\u5141\u8bb8\u60a8\u5728\u6a21\u677f\u8868\u8fbe\u5f0f\u4e2d\u8f6c\u6362\u53d8\u91cf\u7684\u503c\u3002\u4f8b\u5982\uff0c capitalize \u8fc7\u6ee4\u5668\u5c06\u4f20\u9012\u7ed9\u5b83\u7684\u4efb\u4f55\u503c\u90fd\u5927\u5199; to_yaml \u548c to_json \u8fc7\u6ee4\u5668\u4f1a\u66f4\u6539\u53d8\u91cf\u503c\u7684\u683c\u5f0f\u3002 YAML\u8bed\u6cd5\u8981\u6c42\uff0c\u5982\u679c\u60a8\u4ee5 {{foo}} \u5f00\u59cb\u4e00\u4e2a\u503c\uff0c\u5219\u5fc5\u987b \u7528\u5f15\u53f7\u5305\u88f9\u6574\u884c \uff0c\u56e0\u4e3a\u5b83\u5e0c\u671b\u786e\u4fdd\u60a8\u6ca1\u6709\u8bd5\u56fe\u542f\u52a8YAML\u5b57\u5178\u3002YAML\u8bed\u6cd5\u6587\u6863\u5bf9\u6b64\u8fdb\u884c\u4e86\u4ecb\u7ecd\u3002 \u4e0b\u9762\u8fd9\u4e2a\u65f6\u9519\u8bef\u7684\u5199\u6cd5 - hosts : app_servers vars : app_path : {{ base_path }} /22 \u8fd9\u6837\u5199\uff0c\u624d\u662f\u5bf9\u7684\u3002 - hosts : app_servers vars : app_path : \"{{ base_path }}/22\"","title":"\u4f7f\u7528Jinja2\u8fc7\u6ee4\u5668\u8f6c\u6362\u53d8\u91cf"},{"location":"basic/Variables/#facts","text":"\u8fd8\u6709\u5176\u4ed6\u5730\u65b9\u53ef\u4ee5\u4f7f\u7528\u53d8\u91cf\uff0c\u4f46\u662f\u8fd9\u4e9b\u662f\u88ab\u53d1\u73b0\u7684\u53d8\u91cf\u7c7b\u578b\uff0c\u4e0d\u662f\u7531\u7528\u6237\u8bbe\u7f6e\u7684\u3002 Facts \u662f\u901a\u8fc7\u4e0e\u8fdc\u7a0b\u7cfb\u7edf\u5bf9\u8bdd\u800c\u83b7\u5f97\u7684\u4fe1\u606f\u3002\u6570\u636e\u5b58\u50a8\u5728 ansible_facts \u53d8\u91cf\u4e2d\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e0b\u5217\u793a\u4f8b\u6765\u83b7\u53d6\u53d8\u91cf\u4e2d\u7684\u4fe1\u606f - debug : var=ansible_facts \u6216\u8005\u4f7f\u7528 setup \u6a21\u5757 ansible hostname -m setup","title":"\u4ece\u7cfb\u7edf\u4e2d\u53d1\u73b0\u53d8\u91cf:Facts"},{"location":"basic/Variables/#_6","text":"\u4f7f\u7528\u5d4c\u5957\u6570\u636e\u7ed3\u6784\u8bbf\u95ee\u53d8\u91cf {{ ansible_facts[\"eth0\"][\"ipv4\"][\"address\"] }} \u6216\u8005\u4f7f\u7528 . \u7b26\u53f7 {{ ansible_facts.eth0.ipv4.address }} \u7c7b\u4f3c\u5730\uff0c\u8fd9\u662f\u6211\u4eec\u8bbf\u95ee\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u65b9\u5f0f {{ foo[0] }}","title":"\u8bbf\u95ee\u590d\u6742\u53d8\u91cf\u6570\u636e"},{"location":"basic/Variables/#_7","text":"ansible \u63d0\u4f9b\u4e86\u8bb8\u591a\u5185\u7f6e\u53d8\u91cf\uff0c\u6765\u5e2e\u52a9\u5927\u5bb6\u83b7\u53d6\u5f53\u524d\u8fd0\u884c\u7684\u8bf8\u591a\u4fe1\u606f\uff0c\u901a\u8fc7\u5185\u7f6e\u53d8\u91cf\uff0c\u6211\u4eec\u53ef\u4ee5\u505a\u66f4\u591a\u7684\u4e8b\u60c5\uff0c\u6bd4\u5982\u83b7\u53d6\u4e3b\u673a\u7684\u81ea\u5b9a\u4e49fact\uff0c\u83b7\u53d6\u5f53\u524d\u8fd0\u884c\u7684\u4e3b\u673a\u7b49\u7b49\u3002","title":"\u4f7f\u7528\u5185\u7f6e\u53d8\u91cf"},{"location":"basic/Variables/#_8","text":"\u53d8\u91cf\u540d\u79f0 \u8bf4\u660e \u4f7f\u7528 ansible_check_mode \u662f\u5426\u5904\u4e8e\u68c0\u67e5\u6a21\u5f0f\uff0c\u8fd4\u56de\u5e03\u5c14\u503c {{ ansible_check_mode }} ansible_dependent_role_names \u5f53\u524d\u5267\u672c\u4f9d\u8d56\u7684\u89d2\u8272\u540d\u79f0 {{ ansible_dependent_role_names}} ansible_diff_mode \u662f\u5426\u5904\u4e8e\u5bf9\u6bd4\u6a21\u5f0f\uff0c\u8fd4\u56de\u5e03\u5c14\u503c {{ ansible_diff_mode }} ansible_forks \u8fd4\u56de\u6700\u5927\u5e76\u884c\u8fd0\u884c\u7684\u6570\u91cf {{ ansible_forks }} ansible_inventory_sources \u7528\u4f5c\u4e3b\u673a\u6e05\u5355\u7684\u8d44\u6e90\u5217\u8868 {{ ansible_inventory_sources }} ansible_limit CLI\u9009\u9879 --limit \u7684\u5185\u5bb9 {{ ansible_limit }} ansible_loop \u901a\u8fc7 loop_control.extended \u542f\u7528\u65f6\uff0c\u5305\u542b\u6269\u5c55\u5faa\u73af\u4fe1\u606f\u7684\u5b57\u5178/\u6620\u5c04 {{ ansible_loop }} ansible_loop_var \u63d0\u4f9b\u7ed9 loop_control.loop_var \u7684\u503c\u7684\u540d\u79f0 {{ ansible_loop_var }} ansible_index_var \u63d0\u4f9b\u7ed9 loop_control.index_var \u7684\u503c\u7684\u540d\u79f0 {{ ansible_index_var }} ansible_parent_role_paths \u5f53\u901a\u8fc7 include_role \u6216 import_role \u64cd\u4f5c\u6267\u884c\u5f53\u524d\u89d2\u8272\u65f6\uff0c\u6b64\u53d8\u91cf\u5305\u542b\u6240\u6709\u7236\u89d2\u8272\u7684\u5217\u8868\uff0c\u800c\u6700\u65b0\u89d2\u8272\uff08\u5373\u5305\u542b/\u5bfc\u5165\u8be5\u89d2\u8272\u7684\u89d2\u8272\uff09\u662f\u5217\u8868\u4e2d\u7684\u7b2c\u4e00\u9879\u3002 {{ ansible_parent_role_paths }} ansible_play_hosts ansible_play_batch \u5305\u542b\u5f53\u524d\u8fd0\u884c\u7684\u4e3b\u673a\u5217\u8868\uff0c\u53d7serial\u53c2\u6570\u5f71\u54cd `{{ ansible_play_hosts }} {{ ansible_play_batch }}` ansible_play_hosts_all \u6240\u6709\u6267\u884c\u4e3b\u673a\u7684\u5217\u8868 {{ ansible_play_hosts_all }} ansible_play_role_names \u5f53\u524d\u5bfc\u5165\u5230\u5f53\u524d\u5267\u672c\u4e2d\u7684\u89d2\u8272\u7684\u540d\u79f0 {{ ansible_play_role_names }} ansible_playbook_python \u63a7\u5236\u5668\u4e0aAnsible\u4f7f\u7528\u7684python\u89e3\u91ca\u5668\u7684\u8def\u5f84 {{ ansible_playbook_python }} ansible_role_names \u5f53\u524d\u5bfc\u5165\u89d2\u8272\u7684\u540d\u79f0 {{ ansible_role_names }} ansible_run_tags --tags CLI\u9009\u9879\u7684\u5185\u5bb9\uff0c\u8be5\u9009\u9879\u6307\u5b9a\u5f53\u524d\u8fd0\u884c\u5c06\u5305\u62ec\u54ea\u4e9b\u6807\u7b7e\u3002 {{ ansible_run_tags}} ansible_search_path action \u63d2\u4ef6 lookups \u7684\u5f53\u524d\u641c\u7d22\u8def\u5f84 {{ ansible_search_path}} ansible_skip_tags --skip \u6807\u8bb0CLI\u9009\u9879\u7684\u5185\u5bb9\uff0c\u8be5\u9009\u9879\u6307\u5b9a\u5728\u5f53\u524d\u8fd0\u884c\u4e2d\u5c06\u8df3\u8fc7\u54ea\u4e9b\u6807\u8bb0\u3002 {{ ansible_skip_tags}} ansible_verbosity Ansible\u7684\u8be6\u7ec6\u7248\u672c\u4fe1\u606f {{ ansible_verbosity }} ansible_version ansible\u7248\u672c\u4fe1\u606f {{ ansible_version }} ansible_playbook_python ansible\u7684python\u53ef\u6267\u884c\u8def\u5f84 {{ ansible_playbook_python }} groups_name \u5f53\u524d\u4e3b\u673a\u6240\u5728\u7ec4\u7684\u4e3b\u673a\u5217\u8868 {% if 'webserver' in group_names %} # some part of a configuration file that only applies to webservers {% endif %} groups \u5305\u542b\u8bbe\u5907\u6e05\u5355\u7ec4\u5185\u7684\u6240\u6709\u4e3b\u673a {% for host in groups[\u2018db_servers\u2019] %} {{ host }} {% endfor %} hostvars \u5305\u542b\u8fd0\u884c\u7684\u6240\u6709\u53d8\u91cf\u4fe1\u606f {{ hostvars['db.example.com'].ansible_eth0.ipv4.address }} inventory_hostname \u5f53\u524d\u8fd0\u884c\u4e3b\u673a\u7684\u5e93\u5b58\u914d\u7f6e\u540d\u79f0 {{ inventory_hostname }} {{ hostvars[inventory_hostname] }} inventory_hostname_short inventory_hostname \u7684\u7b80\u77ed\u7248\u672c {{ inventory_hostname_short }} inventory_dir \u5b58\u653e\u4e3b\u673a\u6e05\u5355\u7684\u76ee\u5f55 {{ inventory_dir }} inventory_file \u4e3b\u673a\u6e05\u5355\u7684\u6587\u4ef6\u540d {{ inventory_file }} omit \u5141\u8bb8\u60a8\u5ffd\u7565\u67d0\u4e2a\u9009\u9879\u7684\u7279\u6b8a\u53d8\u91cf - user: name=bob home={{ bobs_home ansible_play_name \u5f53\u524d\u6b63\u5728\u6267\u884c\u7684 play name {{ ansible_play_name }} playbook_dir playbook\u7684\u8def\u5f84 {{ playbook_dir }} role_name \u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u89d2\u8272\u540d\u79f0\u3002 {{ role_name }} role_path \u8fd4\u56de\u7684\u5f53\u524d\u89d2\u8272\u8def\u5f84\uff0c\u53ea\u5728role\u4e2d\u8d77\u4f5c\u7528 {{ role_path }}","title":"\u9b54\u672f\u53d8\u91cf"},{"location":"basic/Variables/#facts_1","text":"\u53d8\u91cf\u540d\u79f0 \u8bf4\u660e \u4f7f\u7528 ansible_facts \u5305\u542b\u6240\u6709\u8fd0\u884c\u7684\u4e3b\u673a\u6536\u96c6\u6570\u636e {{ ansible_facts }} ansible_local inventory_hostname \u4e3b\u673a\u81ea\u5b9a\u4e49\u7684\u672c\u5730fact\u53d8\u91cf {{ ansible_local }}","title":"Facts \u53d8\u91cf"},{"location":"basic/Variables/#_9","text":"\u53d8\u91cf\u540d\u79f0 \u8bf4\u660e \u4f7f\u7528 ansible_become_user \u6743\u9650\u63d0\u5347\u7684\u7528\u6237 {{ ansible_become_user }} ansible_connection \u4f7f\u7528\u7684\u8fde\u63a5\u63d2\u4ef6 {{ ansible_connection }} ansible_host \u5f53\u524d\u4f7f\u7528\u7684\u8fdc\u7aef\u4e3b\u673a\u7684 ip/name \u540d\u79f0 {{ ansible_host }} ansible_python_interpreter ansible\u5728\u8fdc\u7aef\u7684python\u53ef\u6267\u884c\u8def\u5f84 {{ ansible_python_interpreter }} ansible_user \u4f7f\u7528ansible\u767b\u5f55\u8fdc\u7aef\u7684\u7528\u6237 {{ ansible_user }}","title":"\u8fde\u63a5\u53d8\u91cf"},{"location":"basic/Reference/Config/","text":"Ansible \u914d\u7f6e \u00b6 Ansible \u652f\u6301\u51e0\u4e2a\u6e90\u6765\u914d\u7f6e\u5b83\u7684\u884c\u4e3a\uff0c\u5305\u62ec\u4e00\u4e2a\u540d\u4e3a ansible.cfg \u7684ini\u6587\u4ef6\u3001\u73af\u5883\u53d8\u91cf\u3001\u547d\u4ee4\u884c\u9009\u9879\u3001playbook\u5173\u952e\u5b57\u548c\u53d8\u91cf\u3002 \u914d\u7f6e\u6587\u4ef6 \u00b6 Ansible \u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u5b58\u653e\u5728\u4e0d\u540c\u7684\u4f4d\u7f6e\uff0c\u4f46\u53ea\u6709\u4e00\u4e2a\u53ef\u7528\u3002\u5728\u4e0b\u5217\u5217\u8868\u4e2d\uff0cansible\u4ece\u4e0a\u5f80\u4e0b\u4f9d\u6b21\u68c0\u67e5\uff0c\u68c0\u67e5\u5230\u54ea\u4e2a\u53ef\u7528\u5c31\u7528\u54ea\u4e2a\u3002 ANSIBLE_CONFIG \u73af\u5883\u53d8\u91cf\uff0c\u53ef\u4ee5\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e ./ansible.cfg \u5b58\u5728\u4e8e\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55 ~/.ansible.cfg \u5b58\u5728\u4e0e\u5f53\u524d\u7528\u6237\u5bb6\u76ee\u5f55 /etc/ansible/ansible.cfg \u83b7\u53d6\u9ed8\u8ba4\u914d\u7f6e \u00b6 \u4f7f\u7528\u6e90\u7801\u6216\u8005pip\u65b9\u5f0f\u5b89\u88c5\u65f6\uff0c\u9700\u8981\u53e6\u884c\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u4ee5\u5728ansible\u4ed3\u5e93\u4e2d\u83b7\u53d6\u6700\u65b0\u7684\u914d\u7f6e\u6587\u4ef6 https://raw.github.com/ansible/ansible/devel/examples/ansible.cfg Note \u914d\u7f6e\u6587\u4ef6\u662fINI\u683c\u5f0f\u7684\u4e00\u79cd\u53d8\u4f53\u3002\u5f53\u6ce8\u91ca\u5f00\u59cb\u884c\u65f6\uff0c\u6563\u5217\u7b26\u53f7\uff08#\uff09\u548c\u5206\u53f7\uff08;\uff09\u90fd\u88ab\u5141\u8bb8\u4f5c\u4e3a\u6ce8\u91ca\u6807\u8bb0\u3002 \u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6 \u00b6 \u4e0b\u5217\u662fcentos7\u7cfb\u7edf\u4e0a\u7684ansible 2.9.6\u7248\u672c\u914d\u7f6e # config file for ansible -- https://ansible.com/ # =============================================== # nearly all parameters can be overridden in ansible-playbook # or with command line flags. ansible will read ANSIBLE_CONFIG, # ansible.cfg in the current working directory, .ansible.cfg in # the home directory or /etc/ansible/ansible.cfg, whichever it # finds first [defaults] # some basic default values... #inventory = /etc/ansible/hosts #library = /usr/share/my_modules/ #module_utils = /usr/share/my_module_utils/ #remote_tmp = ~/.ansible/tmp #local_tmp = ~/.ansible/tmp #plugin_filters_cfg = /etc/ansible/plugin_filters.yml #forks = 5 #poll_interval = 15 #sudo_user = root #ask_sudo_pass = True #ask_pass = True #transport = smart #remote_port = 22 #module_lang = C #module_set_locale = False # plays will gather facts by default, which contain information about # the remote system. # # smart - gather by default, but don't regather if already gathered # implicit - gather by default, turn off with gather_facts: False # explicit - do not gather by default, must say gather_facts: True #gathering = implicit # This only affects the gathering done by a play's gather_facts directive, # by default gathering retrieves all facts subsets # all - gather all subsets # network - gather min and network facts # hardware - gather hardware facts (longest facts to retrieve) # virtual - gather min and virtual facts # facter - import facts from facter # ohai - import facts from ohai # You can combine them using comma (ex: network,virtual) # You can negate them using ! (ex: !hardware,!facter,!ohai) # A minimal set of facts is always gathered. #gather_subset = all # some hardware related facts are collected # with a maximum timeout of 10 seconds. This # option lets you increase or decrease that # timeout to something more suitable for the # environment. # gather_timeout = 10 # Ansible facts are available inside the ansible_facts.* dictionary # namespace. This setting maintains the behaviour which was the default prior # to 2.5, duplicating these variables into the main namespace, each with a # prefix of 'ansible_'. # This variable is set to True by default for backwards compatibility. It # will be changed to a default of 'False' in a future release. # ansible_facts. # inject_facts_as_vars = True # additional paths to search for roles in, colon separated #roles_path = /etc/ansible/roles # uncomment this to disable SSH key host checking #host_key_checking = False # change the default callback, you can only have one 'stdout' type enabled at a time. #stdout_callback = skippy ## Ansible ships with some plugins that require whitelisting, ## this is done to avoid running all of a type by default. ## These setting lists those that you want enabled for your system. ## Custom plugins should not need this unless plugin author specifies it. # enable callback plugins, they can output to stdout but cannot be 'stdout' type. #callback_whitelist = timer, mail # Determine whether includes in tasks and handlers are \"static\" by # default. As of 2.0, includes are dynamic by default. Setting these # values to True will make includes behave more like they did in the # 1.x versions. #task_includes_static = False #handler_includes_static = False # Controls if a missing handler for a notification event is an error or a warning #error_on_missing_handler = True # change this for alternative sudo implementations #sudo_exe = sudo # What flags to pass to sudo # WARNING: leaving out the defaults might create unexpected behaviours #sudo_flags = -H -S -n # SSH timeout #timeout = 10 # default user to use for playbooks if user is not specified # (/usr/bin/ansible will use current user as default) #remote_user = root # logging is off by default unless this path is defined # if so defined, consider logrotate #log_path = /var/log/ansible.log # default module name for /usr/bin/ansible #module_name = command # use this shell for commands executed under sudo # you may need to change this to bin/bash in rare instances # if sudo is constrained #executable = /bin/sh # if inventory variables overlap, does the higher precedence one win # or are hash values merged together? The default is 'replace' but # this can also be set to 'merge'. #hash_behaviour = replace # by default, variables from roles will be visible in the global variable # scope. To prevent this, the following option can be enabled, and only # tasks and handlers within the role will see the variables there #private_role_vars = yes # list any Jinja2 extensions to enable here: #jinja2_extensions = jinja2.ext.do,jinja2.ext.i18n # if set, always use this private key file for authentication, same as # if passing --private-key to ansible or ansible-playbook #private_key_file = /path/to/file # If set, configures the path to the Vault password file as an alternative to # specifying --vault-password-file on the command line. #vault_password_file = /path/to/vault_password_file # format of string {{ ansible_managed }} available within Jinja2 # templates indicates to users editing templates files will be replaced. # replacing {file}, {host} and {uid} and strftime codes with proper values. #ansible_managed = Ansible managed: {file} modified on %Y-%m-%d %H:%M:%S by {uid} on {host} # {file}, {host}, {uid}, and the timestamp can all interfere with idempotence # in some situations so the default is a static string: #ansible_managed = Ansible managed # by default, ansible-playbook will display \"Skipping [host]\" if it determines a task # should not be run on a host. Set this to \"False\" if you don't want to see these \"Skipping\" # messages. NOTE: the task header will still be shown regardless of whether or not the # task is skipped. #display_skipped_hosts = True # by default, if a task in a playbook does not include a name: field then # ansible-playbook will construct a header that includes the task's action but # not the task's args. This is a security feature because ansible cannot know # if the *module* considers an argument to be no_log at the time that the # header is printed. If your environment doesn't have a problem securing # stdout from ansible-playbook (or you have manually specified no_log in your # playbook on all of the tasks where you have secret information) then you can # safely set this to True to get more informative messages. #display_args_to_stdout = False # by default (as of 1.3), Ansible will raise errors when attempting to dereference # Jinja2 variables that are not set in templates or action lines. Uncomment this line # to revert the behavior to pre-1.3. #error_on_undefined_vars = False # by default (as of 1.6), Ansible may display warnings based on the configuration of the # system running ansible itself. This may include warnings about 3rd party packages or # other conditions that should be resolved if possible. # to disable these warnings, set the following value to False: #system_warnings = True # by default (as of 1.4), Ansible may display deprecation warnings for language # features that should no longer be used and will be removed in future versions. # to disable these warnings, set the following value to False: #deprecation_warnings = True # (as of 1.8), Ansible can optionally warn when usage of the shell and # command module appear to be simplified by using a default Ansible module # instead. These warnings can be silenced by adjusting the following # setting or adding warn=yes or warn=no to the end of the command line # parameter string. This will for example suggest using the git module # instead of shelling out to the git command. # command_warnings = False # set plugin path directories here, separate with colons #action_plugins = /usr/share/ansible/plugins/action #become_plugins = /usr/share/ansible/plugins/become #cache_plugins = /usr/share/ansible/plugins/cache #callback_plugins = /usr/share/ansible/plugins/callback #connection_plugins = /usr/share/ansible/plugins/connection #lookup_plugins = /usr/share/ansible/plugins/lookup #inventory_plugins = /usr/share/ansible/plugins/inventory #vars_plugins = /usr/share/ansible/plugins/vars #filter_plugins = /usr/share/ansible/plugins/filter #test_plugins = /usr/share/ansible/plugins/test #terminal_plugins = /usr/share/ansible/plugins/terminal #strategy_plugins = /usr/share/ansible/plugins/strategy # by default, ansible will use the 'linear' strategy but you may want to try # another one #strategy = free # by default callbacks are not loaded for /bin/ansible, enable this if you # want, for example, a notification or logging callback to also apply to # /bin/ansible runs #bin_ansible_callbacks = False # don't like cows? that's unfortunate. # set to 1 if you don't want cowsay support or export ANSIBLE_NOCOWS=1 #nocows = 1 # set which cowsay stencil you'd like to use by default. When set to 'random', # a random stencil will be selected for each task. The selection will be filtered # against the `cow_whitelist` option below. #cow_selection = default #cow_selection = random # when using the 'random' option for cowsay, stencils will be restricted to this list. # it should be formatted as a comma-separated list with no spaces between names. # NOTE: line continuations here are for formatting purposes only, as the INI parser # in python does not support them. #cow_whitelist=bud-frogs,bunny,cheese,daemon,default,dragon,elephant-in-snake,elephant,eyes,\\ # hellokitty,kitty,luke-koala,meow,milk,moofasa,moose,ren,sheep,small,stegosaurus,\\ # stimpy,supermilker,three-eyes,turkey,turtle,tux,udder,vader-koala,vader,www # don't like colors either? # set to 1 if you don't want colors, or export ANSIBLE_NOCOLOR=1 #nocolor = 1 # if set to a persistent type (not 'memory', for example 'redis') fact values # from previous runs in Ansible will be stored. This may be useful when # wanting to use, for example, IP information from one group of servers # without having to talk to them in the same playbook run to get their # current IP information. #fact_caching = memory #This option tells Ansible where to cache facts. The value is plugin dependent. #For the jsonfile plugin, it should be a path to a local directory. #For the redis plugin, the value is a host:port:database triplet: fact_caching_connection = localhost:6379:0 #fact_caching_connection=/tmp # retry files # When a playbook fails a .retry file can be created that will be placed in ~/ # You can enable this feature by setting retry_files_enabled to True # and you can change the location of the files by setting retry_files_save_path #retry_files_enabled = False #retry_files_save_path = ~/.ansible-retry # squash actions # Ansible can optimise actions that call modules with list parameters # when looping. Instead of calling the module once per with_ item, the # module is called once with all items at once. Currently this only works # under limited circumstances, and only with parameters named 'name'. #squash_actions = apk,apt,dnf,homebrew,pacman,pkgng,yum,zypper # prevents logging of task data, off by default #no_log = False # prevents logging of tasks, but only on the targets, data is still logged on the master/controller #no_target_syslog = False # controls whether Ansible will raise an error or warning if a task has no # choice but to create world readable temporary files to execute a module on # the remote machine. This option is False by default for security. Users may # turn this on to have behaviour more like Ansible prior to 2.1.x. See # https://docs.ansible.com/ansible/become.html#becoming-an-unprivileged-user # for more secure ways to fix this than enabling this option. #allow_world_readable_tmpfiles = False # controls the compression level of variables sent to # worker processes. At the default of 0, no compression # is used. This value must be an integer from 0 to 9. #var_compression_level = 9 # controls what compression method is used for new-style ansible modules when # they are sent to the remote system. The compression types depend on having # support compiled into both the controller's python and the client's python. # The names should match with the python Zipfile compression types: # * ZIP_STORED (no compression. available everywhere) # * ZIP_DEFLATED (uses zlib, the default) # These values may be set per host via the ansible_module_compression inventory # variable #module_compression = 'ZIP_DEFLATED' # This controls the cutoff point (in bytes) on --diff for files # set to 0 for unlimited (RAM may suffer!). #max_diff_size = 1048576 # This controls how ansible handles multiple --tags and --skip-tags arguments # on the CLI. If this is True then multiple arguments are merged together. If # it is False, then the last specified argument is used and the others are ignored. # This option will be removed in 2.8. #merge_multiple_cli_flags = True # Controls showing custom stats at the end, off by default #show_custom_stats = True # Controls which files to ignore when using a directory as inventory with # possibly multiple sources (both static and dynamic) #inventory_ignore_extensions = ~, .orig, .bak, .ini, .cfg, .retry, .pyc, .pyo # This family of modules use an alternative execution path optimized for network appliances # only update this setting if you know how this works, otherwise it can break module execution #network_group_modules=eos, nxos, ios, iosxr, junos, vyos # When enabled, this option allows lookups (via variables like {{lookup('foo')}} or when used as # a loop with `with_foo`) to return data that is not marked \"unsafe\". This means the data may contain # jinja2 templating language which will be run through the templating engine. # ENABLING THIS COULD BE A SECURITY RISK #allow_unsafe_lookups = False # set default errors for all plays #any_errors_fatal = False [inventory] # enable inventory plugins, default: 'host_list', 'script', 'auto', 'yaml', 'ini', 'toml' #enable_plugins = host_list, virtualbox, yaml, constructed # ignore these extensions when parsing a directory as inventory source #ignore_extensions = .pyc, .pyo, .swp, .bak, ~, .rpm, .md, .txt, ~, .orig, .ini, .cfg, .retry # ignore files matching these patterns when parsing a directory as inventory source #ignore_patterns= # If 'true' unparsed inventory sources become fatal errors, they are warnings otherwise. #unparsed_is_failed=False [privilege_escalation] #become=True #become_method=sudo #become_user=root #become_ask_pass=False [paramiko_connection] # uncomment this line to cause the paramiko connection plugin to not record new host # keys encountered. Increases performance on new host additions. Setting works independently of the # host key checking setting above. #record_host_keys=False # by default, Ansible requests a pseudo-terminal for commands executed under sudo. Uncomment this # line to disable this behaviour. #pty=False # paramiko will default to looking for SSH keys initially when trying to # authenticate to remote devices. This is a problem for some network devices # that close the connection after a key failure. Uncomment this line to # disable the Paramiko look for keys function #look_for_keys = False # When using persistent connections with Paramiko, the connection runs in a # background process. If the host doesn't already have a valid SSH key, by # default Ansible will prompt to add the host key. This will cause connections # running in background processes to fail. Uncomment this line to have # Paramiko automatically add host keys. #host_key_auto_add = True [ssh_connection] # ssh arguments to use # Leaving off ControlPersist will result in poor performance, so use # paramiko on older platforms rather than removing it, -C controls compression use #ssh_args = -C -o ControlMaster=auto -o ControlPersist=60s # The base directory for the ControlPath sockets. # This is the \"%(directory)s\" in the control_path option # # Example: # control_path_dir = /tmp/.ansible/cp #control_path_dir = ~/.ansible/cp # The path to use for the ControlPath sockets. This defaults to a hashed string of the hostname, # port and username (empty string in the config). The hash mitigates a common problem users # found with long hostnames and the conventional %(directory)s/ansible-ssh-%%h-%%p-%%r format. # In those cases, a \"too long for Unix domain socket\" ssh error would occur. # # Example: # control_path = %(directory)s/%%h-%%r #control_path = # Enabling pipelining reduces the number of SSH operations required to # execute a module on the remote server. This can result in a significant # performance improvement when enabled, however when using \"sudo:\" you must # first disable 'requiretty' in /etc/sudoers # # By default, this option is disabled to preserve compatibility with # sudoers configurations that have requiretty (the default on many distros). # #pipelining = False # Control the mechanism for transferring files (old) # * smart = try sftp and then try scp [default] # * True = use scp only # * False = use sftp only #scp_if_ssh = smart # Control the mechanism for transferring files (new) # If set, this will override the scp_if_ssh option # * sftp = use sftp to transfer files # * scp = use scp to transfer files # * piped = use 'dd' over SSH to transfer files # * smart = try sftp, scp, and piped, in that order [default] #transfer_method = smart # if False, sftp will not use batch mode to transfer files. This may cause some # types of file transfer failures impossible to catch however, and should # only be disabled if your sftp version has problems with batch mode #sftp_batch_mode = False # The -tt argument is passed to ssh when pipelining is not enabled because sudo # requires a tty by default. #usetty = True # Number of times to retry an SSH connection to a host, in case of UNREACHABLE. # For each retry attempt, there is an exponential backoff, # so after the first attempt there is 1s wait, then 2s, 4s etc. up to 30s (max). #retries = 3 [persistent_connection] # Configures the persistent connection timeout value in seconds. This value is # how long the persistent connection will remain idle before it is destroyed. # If the connection doesn't receive a request before the timeout value # expires, the connection is shutdown. The default value is 30 seconds. #connect_timeout = 30 # The command timeout value defines the amount of time to wait for a command # or RPC call before timing out. The value for the command timeout must # be less than the value of the persistent connection idle timeout (connect_timeout) # The default value is 30 second. #command_timeout = 30 [accelerate] #accelerate_port = 5099 #accelerate_timeout = 30 #accelerate_connect_timeout = 5.0 # The daemon timeout is measured in minutes. This time is measured # from the last activity to the accelerate daemon. #accelerate_daemon_timeout = 30 # If set to yes, accelerate_multi_key will allow multiple # private keys to be uploaded to it, though each user must # have access to the system via SSH to add a new key. The default # is \"no\". #accelerate_multi_key = yes [selinux] # file systems that require special treatment when dealing with security context # the default behaviour that copies the existing context or uses the user default # needs to be changed to use the file system dependent context. #special_context_filesystems=nfs,vboxsf,fuse,ramfs,9p,vfat # Set this to yes to allow libvirt_lxc connections to work without SELinux. #libvirt_lxc_noseclabel = yes [colors] #highlight = white #verbose = blue #warn = bright purple #error = red #debug = dark gray #deprecate = purple #skip = cyan #unreachable = red #ok = green #changed = yellow #diff_add = green #diff_remove = red #diff_lines = cyan [diff] # Always print diff when running ( same as always running with -D/--diff ) # always = no # Set how many context lines to show in diff # context = 3 \u5e38\u7528\u8bbe\u7f6e \u00b6 \u4e0b\u5217\u5217\u51fa\u4e86\u5e38\u7528\u7684\u4e00\u4e9b\u8bbe\u7f6e\uff0c\u53ef\u7528\u4f5c\u53c2\u8003\u3002 [defaults] # Set the log_path log_path = ~/ansible.log # Additional default options for Ansible forks = 20 host_key_checking = False retry_files_enabled = False retry_files_save_path = ~/ansible-installer-retries nocows = True remote_user = root roles_path = roles/ gathering = smart fact_caching = jsonfile fact_caching_connection = $HOME/ansible/facts fact_caching_timeout = 600 callback_whitelist = profile_tasks inventory_ignore_extensions = secrets.py, .pyc, .cfg, .crt, .ini # work around privilege escalation timeouts in ansible: timeout = 30 host_key_checking = False # Uncomment to use the provided example inventory #inventory = inventory/hosts.example ansible_managed = Ansible managed: {file} modified by {uid} on {host} [inventory] # fail more helpfully when the inventory file does not parse (Ansible 2.4+) unparsed_is_failed = true # Additional ssh options for OpenShift Ansible [ssh_connection] retries = 15 pipelining = True ssh_args = -o ControlMaster=auto -o ControlPersist=600s timeout = 10 # shorten the ControlPath which is often too long; when it is, # ssh connection reuse silently fails, making everything slower. control_path = %(directory)s/%%h-%%r ansible-config \u00b6 \u4f7f\u7528 ansible-config \u7a0b\u5e8f\u53ef\u4ee5\u67e5\u770b\u6240\u6709\u53ef\u7528\u7684\u914d\u7f6e\u8bbe\u7f6e\u3001\u4ee5\u53ca\u5b83\u4eec\u7684\u9ed8\u8ba4\u503c\u3001\u8fd8\u6709\u5b83\u4eec\u7684\u5f53\u524d\u503c\u6765\u81ea\u4f55\u5904\u3002 \u67e5\u770b\u5f53\u524d\u914d\u7f6e\u6587\u4ef6 ansible-config view \u67e5\u770b\u5f53\u524d\u914d\u7f6e ansible-config dump \u67e5\u770b\u914d\u7f6e\u9879\u8bf4\u660e ansible-config list \u914d\u7f6e\u7684\u4f18\u5148\u7ea7 \u00b6 Ansible \u63d0\u4f9b\u4e86\u56db\u79cd\u8d44\u6e90\u6765\u63a7\u5236\u5b83\u7684\u884c\u4e3a\u3002\u6309\u7167\u4ece\u6700\u4f4e(\u6700\u5bb9\u6613\u88ab\u8986\u76d6)\u5230\u6700\u9ad8(\u8986\u76d6\u6240\u6709\u5176\u4ed6)\u7684\u4f18\u5148\u7ea7\u987a\u5e8f\uff0c\u8fd9\u4e9b\u7c7b\u522b\u662f Configuration settings \u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e Note Ansible \u914d\u7f6e\u6587\u4ef6\u62e5\u6709\u6700\u4f4e\u7684\u4f18\u5148\u7ea7\uff0c\u4f46\u6587\u4ef6\u53ef\u4ee5\u5b58\u653e\u5728\u4e0d\u540c\u7684\u4f4d\u7f6e\uff0c\u5176\u4e2d\u53ea\u6709\u4e00\u4e2a\u53ef\u7528\u3002\u5728\u4e0b\u5217\u5217\u8868\u4e2d\uff0cansible\u4ece\u4e0a\u5f80\u4e0b\u4f9d\u6b21\u68c0\u67e5\uff0c\u68c0\u67e5\u5230\u54ea\u4e2a\u53ef\u7528\u5c31\u7528\u54ea\u4e2a\u3002 ANSIBLE_CONFIG \u73af\u5883\u53d8\u91cf\uff0c\u53ef\u4ee5\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e ./ansible.cfg \u5b58\u5728\u4e8e\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55 ~/.ansible.cfg \u5b58\u5728\u4e0e\u5f53\u524d\u7528\u6237\u5bb6\u76ee\u5f55 /etc/ansible/ansible.cfg Command-line options \u547d\u4ee4\u884c\u9009\u9879 Note \u547d\u4ee4\u884c\u9009\u9879\u5c06\u8986\u76d6\u4efb\u4f55\u914d\u7f6e\u6587\u4ef6\u7684\u8bbe\u7f6e # \u6307\u5b9a\u591a\u4e2a-u\u65f6\uff0c\u540e\u9762\u7684\u8986\u76d6\u524d\u9762 ansible -u mike -m ping myhost -u carol # \u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a-i\u9009\u9879 ansible -i /path/inventory1 -i /path/inventory2 -m ping all Playbook keywords playbook\u5173\u952e\u5b57 Note playbook\u5173\u952e\u5b57 \u5c06\u8986\u76d6\u547d\u4ee4\u884c\u9009\u9879\u548c\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u8bbe\u7f6e \u5728playbook\u5173\u952e\u5b57\u4e2d\uff0c\u4f18\u5148\u7ea7\u4e0eplaybook\u672c\u8eab\u4e00\u8d77\u53d8\u52a8;\u8d8a\u5177\u4f53\u7684\u8bbe\u7f6e\u8d8a\u80fd\u6218\u80dc\u8d8a\u7b3c\u7edf\u7684\u8bbe\u7f6e\uff0c\u5982 tasks > blocks/includes/imports/roles > play - hosts : all connection : ssh tasks : - name : This task uses ssh. ping : - name : This task uses paramiko. connection : paramiko ping : Variables \u53d8\u91cf Note \u53d8\u91cf\u5c06\u8986\u76d6playbook\u5173\u952e\u5b57\u3001\u547d\u4ee4\u884c\u9009\u9879\u548c\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e \u5728playbook\u4e2d\u4f7f\u7528 vars \u8bbe\u7f6e\u53d8\u91cf\uff0c\u5176\u4e2d\u53d8\u91cf\u4f18\u5148\u7ea7\u4e5f\u662f\u9075\u5b88\u5177\u4f53\u4f18\u5148\u7684\u7b56\u7565\u3002 - hosts : cloud gather_facts : false become : yes vars : ansible_become_user : admin tasks : - name : This task uses admin as the become user. dnf : name : some-service state : latest - block : - name : This task uses service-admin as the become user. # a task to configure the new service - name : This task also uses service-admin as the become user, defined in the block. # second task to configure the service vars : ansible_become_user : service-admin - name : This task (outside of the block) uses admin as the become user again. service : name : some-service state : restarted \u5728\u547d\u4ee4\u884c\u5de5\u5177\u4e2d\u4f7f\u7528 -e \u6307\u5b9a\u53d8\u91cf\u65f6\uff0c\u5c06\u8986\u76d6playbook\u4e2d\u7684\u53d8\u91cf ansible -u carol -e 'ansible_user=brian' -a whoami all \u914d\u7f6e\u9879 \u00b6 \u5217\u51fa ansible \u76ee\u524d\u7248\u672c\uff08 2.9.6 \uff09\u53ef\u7528\u7684\u9009\u9879\u914d\u7f6e \u73af\u5883\u53d8\u91cf Ini key Ini section \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e ANSIBLE_ACTION_WARNINGS action_warnings defaults boolean True \u8f93\u51fa\u4efb\u52a1\u7684\u8b66\u544a\u4fe1\u606f ANSIBLE_AGNOSTIC_BECOME_PROMPT agnostic_become_prompt privilege_escalation boolean True \u8f93\u51fa\u6743\u9650\u63d0\u5347\u63d0\u793a allow_world_readable_tmpfiles defaults boolean False \u662f\u5426\u5728\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u521b\u5efa\u4e34\u65f6\u76ee\u5f55\u65f6\u663e\u793a\u8b66\u544a\u800c\u4e0d\u662f\u5931\u8d25\u3002 ANSIBLE_CONNECTION_PATH ansible_connection_path persistent_connection path None \u6307\u5b9a\u5728\u4f55\u5904\u67e5\u627eansibl-connection\u811a\u672c\uff0c\u4e3a\u7a7a\u65f6\uff0c\u5c06\u5728\u5f53\u524d\u76ee\u5f55\u67e5\u627e ANSIBLE_COW_PATH cowpath defaults string None \u6307\u5b9a\u4e00\u4e2a\u81ea\u5b9a\u4e49cowsay\u8def\u5f84 ANSIBLE_COW_SELECTION cow_selection defaults defaults \u9009\u62e9\u4e00\u4e2a\u7279\u5b9a\u7684cowsay\u6a21\u677f ANSIBLE_COW_WHITELIST cow_whitelist defaults list [\u2018bud-frogs , \u2018bunny , \u2018cheese , \u2018daemon , \u2018default , \u2018dragon , \u2018elephant-in-snake , \u2018elephant , \u2018eyes , \u2018hellokitty , \u2018kitty , \u2018luke-koala , \u2018meow , \u2018milk , \u2018moofasa , \u2018moose , \u2018ren , \u2018sheep , \u2018small , \u2018stegosaurus , \u2018stimpy , \u2018supermilker , \u2018three-eyes , \u2018turkey , \u2018turtle , \u2018tux , \u2018udder , \u2018vader-koala , \u2018vader , \u2018www ] Cowsay\u6a21\u677f\u767d\u540d\u5355 ANSIBLE_FORCE_COLOR force_color defaults boolean False \u5f3a\u5236\u8f93\u51fa\u989c\u8272 ANSIBLE_NOCOLOR nocolor defaults boolean False \u662f\u5426\u5141\u8bb8\u7740\u8272\u663e\u793a\u4fe1\u606f\u3002 ANSIBLE_NOCOWS nocows defaults boolean False \u5982\u679c\u4f60\u5df2\u7ecf\u5b89\u88c5\u4e86cowsay\uff0c\u4f46\u662f\u60f3\u907f\u514d\u4f7f\u7528 cows \uff0c\u8bf7\u4f7f\u7528\u8fd9\u4e2a\u3002 ANSIBLE_PIPELINING pipelining connection boolean False \u8fde\u63a5\u7ba1\u9053 ANSIBLE_SSH_PIPELINING pipelining ssh_connection boolean False \u542f\u7528\u7ba1\u9053\u6a21\u5f0f\uff0c \u542f\u7528\u540e\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002 ANSIBLE_SSH_ARGS ssh_args ssh_connection -C -o ControlMaster=auto -o ControlPersist=60s ssh\u53c2\u6570 ANSIBLE_CONNECTION_PATH ansible_connection_path persistent_connection path None \u6307\u5b9a\u5728\u4f55\u5904\u67e5\u627eansibl-connection\u811a\u672c\uff0c\u4e3a\u7a7a\u65f6\uff0c\u5c06\u5728\u5f53\u524d\u76ee\u5f55\u67e5\u627e ANSIBLE_SSH_CONTROL_PATH_DIR control_path_dir ssh_connection ~/.ansible/cp ssh\u63a7\u5236\u8def\u5f84\u7684\u76ee\u5f55 ANSIBLE_SSH_CONTROL_PATH control_path ssh_connection None \u8fd9\u662f\u4fdd\u5b58ssh\u7684ControlPath\u5957\u63a5\u5b57\u7684\u4f4d\u7f6e\uff0c\u5b83\u4f7f\u7528ssh\u7684\u53d8\u91cf\u66ff\u6362\u3002 ANSIBLE_SSH_EXECUTABLE ssh_executable ssh_connection ssh \u5b9a\u4e49\u4e86ssh\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u4f4d\u7f6e ANSIBLE_SSH_RETRIES retries ssh_connection integer 0 ssh\u5c1d\u8bd5\u5efa\u7acb\u8fde\u63a5\u7684\u6b21\u6570 ANSIBLE_ANY_ERRORS_FATAL any_errors_fatal defaults boolean False \u4e3aTrue\uff0c\u5219\u4efb\u52a1\u5931\u8d25\u5c06\u88ab\u89c6\u4e3a\u81f4\u547d\u9519\u8bef\uff0c\u4f1a\u7acb\u5373\u505c\u6b62\u6267\u884c ANSIBLE_BECOME_ALLOW_SAME_USER become_allow_same_user privilege_escalation boolean False \u5f53\u8fde\u63a5\u7528\u6237\u548cbecome\u7528\u6237\u4e00\u81f4\u65f6\uff0c\u662f\u5426\u8df3\u8fc7become ANSIBLE_BECOME_PLUGINS become_plugins defaults pathspec ~/.ansible/plugins/become:/usr/share/ansible/plugins/become become \u63d2\u4ef6\u8def\u5f84 ANSIBLE_INVENTORY inventory defaults pathlist /etc/ansible/hosts \u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\u6587\u4ef6\u5217\u8868 ANSIBLE_LIBRARY library defaults pathspec ~/.ansible/plugins/modules:/usr/share/ansible/plugins/modules \u5192\u53f7\u5206\u9694\u7684\u6a21\u5757\u8def\u5f84 ANSIBLE_MODULE_UTILS module_utils defaults pathspec ~/.ansible/plugins/module_utils:/usr/share/ansible/plugins/module_utils \u7528\u4e8e\u5b58\u653e\u6a21\u5757\u5171\u4eab\u7684\u6587\u4ef6 remote_tmp defaults tmppath ~/.ansible/tmp \u8282\u70b9\u7684\u4e34\u65f6\u76ee\u5f55 ANSIBLE_LOCAL_TEMP local_tmp defaults tmppath ~/.ansible/tmp \u63a7\u5236\u7aef\u7684\u4e34\u65f6\u76ee\u5f55 plugin_filters_cfg defaults /etc/ansible/plugin_filters.yml \u63d2\u4ef6\u8fc7\u6ee4\u5668\u6587\u4ef6 ANSIBLE_FORKS forks defaults integer 5 \u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u6267\u884c\u4efb\u52a1\u7684\u6700\u5927\u6570\u3002 ANSIBLE_POLL_INTERVAL poll_interval defaults integer 15 \u6307\u5b9a\u5f02\u6b65\u4efb\u52a1\u7684\u8f6e\u8be2\u95f4\u9694\u65f6\u95f4 ANSIBLE_SUDO_USER sudo_user defaults None sudo\u7684\u7528\u6237\uff0c\u5c06\u57282.8\u5e9f\u5f03 ANSIBLE_ASK_SUDO_PASS ask_sudo_pass defaults boolean False \u662f\u5426\u63d0\u793a\u8f93\u5165sudo\u7528\u6237\u7684\u5bc6\u7801\uff0c\u5c06\u57282.8\u5e9f\u5f03 ANSIBLE_ASK_PASS ask_pass defaults boolean False \u662f\u5426\u63d0\u793a\u8f93\u5165ssh\u8fde\u63a5\u5bc6\u7801\uff0c\u4f7f\u7528ssh\u79d8\u94a5\u94fe\u63a5\u4e0d\u9700\u8981\u6253\u5f00\u6b64\u9879\u3002 ANSIBLE_TRANSPORT transport defaults smart \u9ed8\u8ba4\u8fde\u63a5\u63d2\u4ef6 ANSIBLE_REMOTE_PORT remote_port defaults integer None \u7528\u4e8e\u8fdc\u7a0b\u8fde\u63a5\u7684\u7aef\u53e3\uff0c\u4e3a\u7a7a\u65f6\uff0c\u5c06\u7528\u63d2\u4ef6\u9ed8\u8ba4\u503c ANSIBLE_MODULE_LANG module_lang defaults \u5728\u76ee\u6807\u4e0a\u6267\u884c\u65f6\u7528\u4e8e\u6a21\u5757\u7684\u8bed\u8a00\u533a\u57df\u8bbe\u7f6e\u3002 \u5982\u679c\u4e3a\u7a7a\uff0c\u5b83\u4f1a\u5c1d\u8bd5\u5c06\u5176\u81ea\u8eab\u8bbe\u7f6e\u4e3a\u63a7\u5236\u5668\u4e0a\u7684LANG\u73af\u5883\u53d8\u91cf\u3002\u4ec5\u5728module_set_locale\u4e3ature\u7684\u65f6\u5019\u3002 ANSIBLE_MODULE_SET_LOCALE module_set_locale defaults boolean False \u63a7\u5236\u5728\u76ee\u6807\u4e0a\u6267\u884c\u65f6\u662f\u5426\u4e3a\u6a21\u5757\u8bbe\u7f6e\u8bed\u8a00\u73af\u5883\u3002 ANSIBLE_GATHERING gathering defaults implicit \u662f\u5426\u6536\u96c6fact\u4fe1\u606f ANSIBLE_GATHER_SUBSET gather_subset defaults all \u8bbe\u7f6e\u6536\u96c6fact\u7684\u5206\u7ec4\u6a21\u5757 ANSIBLE_GATHER_TIMEOUT gather_timeout defaults integer 10 \u8bbe\u7f6e\u8d85\u65f6\u503c\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002 ANSIBLE_ROLES_PATH roles_path defaults pathspec ~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles \u641c\u7d22roles\u7684\u8def\u5f84 ANSIBLE_HOST_KEY_CHECKING host_key_checking defaults boolean True \u8fde\u63a5\u4e3b\u673a\u65f6\u662f\u5426\u8fdb\u884c\u4e3b\u673a\u5bc6\u94a5\u68c0\u67e5 ANSIBLE_STDOUT_CALLBACK stdout_callback defaults defaults \u8bbe\u7f6eansible\u663e\u793a\u8f93\u51fa\u7684callback\uff0c\u53ea\u80fd\u8bbe\u7f6e\u4e00\u4e2a\u3002 ANSIBLE_CALLBACK_WHITELIST callback_whitelist defaults list [] callback\u7684\u767d\u540d\u5355\u5217\u8868\uff0c\u53ea\u6709\u5728\u8fd9\u4e2a\u5217\u8868\u4e2d\uff0cansible\u624d\u4f1a\u4f7f\u7528\u3002 ANSIBLE_TASK_INCLUDES_STATIC task_includes_static defaults boolean False \u662f\u5426\u5c06include\u8bbe\u7f6e\u4e3a\u9759\u6001\u5305\u542b\u30022.8\u5e9f\u5f03 ANSIBLE_HANDLER_INCLUDES_STATIC handler_includes_static defaults boolean False \u662f\u5426\u5c06include\u8bbe\u7f6e\u4e3a\u9759\u6001\u5305\u542b\u30022.8\u5e9f\u5f03 ANSIBLE_ERROR_ON_MISSING_HANDLER error_on_missing_handler defaults boolean True \u662f\u5426\u5728handler\u7a0b\u5e8f\u7f3a\u5c11\u6216\u9519\u8bef\u7684\u65f6\u5019\uff0c\u63d0\u793a\u8b66\u544a\u800c\u4e0d\u662f\u9519\u8bef\u3002 ANSIBLE_SUDO_EXE sudo_exe defaults sudo \u6307\u5b9a\u4e00\u4e2a\u201csudo\u201d\u53ef\u6267\u884c\u6587\u4ef6\uff0c2.8\u5e9f\u5f03 ANSIBLE_SUDO_FLAGS sudo_flags defaults -H -S -n \u6307\u5b9asudo\u7684\u53c2\u6570\uff0c2.8\u5e9f\u5f03 ANSIBLE_TIMEOUT Timeout defaults integer 10 \u8fde\u63a5\u63d2\u4ef6\u4f7f\u7528\u7684\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\u3002 ANSIBLE_REMOTE_USER remote_user defaults None \u8bbe\u7f6e\u76ee\u6807\u7684\u767b\u5f55\u7528\u6237\uff0c\u5982\u679c\u4e3a\u7a7a\uff0c\u5219\u4e3a\u8fd0\u884cansible\u7684\u7528\u6237 ANSIBLE_LOG_PATH log_path defaults None \u5728\u63a7\u5236\u5668\u4e0a\u7684\u65e5\u5fd7\u6587\u4ef6\u8def\u5f84\uff0c\u7528\u4e8e\u8bb0\u5f55ansible\u8fd0\u884c\u7684\u65e5\u5fd7\u3002 module_name defaults command AdHoc\u547d\u4ee4\u4e00\u8d77\u4f7f\u7528\uff0c\u6ca1\u6709\u6307\u5b9a-m\u6a21\u5757\u7684\u5c31\u7528\u8fd9\u4e2a\u9ed8\u8ba4\u503c ANSIBLE_EXECUTABLE executable defaults /bin/sh \u5728\u8282\u70b9\u4e0a\uff0cansible\u6267\u884c\u7684shell\u89e3\u91ca\u5668\u3002 ANSIBLE_HASH_BEHAVIOUR hash_behaviour defaults string replace \u63a7\u5236Ansible\u4e2d\u7684\u53d8\u91cf\u5408\u5e76\u65b9\u5f0f\u3002 ANSIBLE_PRIVATE_ROLE_VARS private_role_vars defaults boolean False \u4f7f\u89d2\u8272\u53d8\u91cf\u65e0\u6cd5\u4ece\u5176\u4ed6\u89d2\u8272\u8bbf\u95ee\u3002 ANSIBLE_JINJA2_EXTENSIONS jinja2_extensions defaults [] \u542f\u7528\u989d\u5916\u7684Jinja2\u6269\u5c55\u5217\u8868 ANSIBLE_PRIVATE_KEY_FILE private_key_file defaults None \u8fde\u63a5\u8bc1\u4e66\u6216\u5bc6\u7801\uff0c-private-key\u7684\u9ed8\u8ba4\u503c ANSIBLE_VAULT_PASSWORD_FILE vault_password_file defaults path None \u8981\u4f7f\u7528\u7684vault\u5bc6\u7801\u6587\u4ef6\u3002 \u7b49\u540c\u4e8e-vault-password-file\u6216-vault-id ansible_managed defaults Ansible managed \u5728\u6a21\u677fansible_managed\u7684\u503c DISPLAY_SKIPPED_HOSTS display_skipped_hosts defaults boolean True \u5728\u9ed8\u8ba4callback\u63d2\u4ef6\u4e2d\u662f\u5426\u663e\u793a\u8df3\u8fc7\u7684\u4e3b\u673a\u4fe1\u606f\u3002 ANSIBLE_DISPLAY_ARGS_TO_STDOUT display_args_to_stdout defaults boolean False \u662f\u5426\u5728callback\u4e2d\u663e\u793a\u4efb\u52a1\u7684\u53c2\u6570\u4fe1\u606f ANSIBLE_ERROR_ON_UNDEFINED_VARS error_on_undefined_vars defaults boolean True \u6a21\u677f\u4e2d\u51fa\u73b0\u9519\u8bef\u6216\u672a\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u662f\u5426\u63d0\u793a\u9519\u8bef\u4fe1\u606f\u3002 ANSIBLE_SYSTEM_WARNINGS system_warnings defaults boolean True \u662f\u5426\u663e\u793a\u7cfb\u7edf\u8b66\u544a\u4fe1\u606f\u3002 ANSIBLE_DEPRECATION_WARNINGS deprecation_warnings defaults boolean True \u662f\u5426\u663e\u793a\u6a21\u5757\u88ab\u5f03\u7528\u7684\u8b66\u544a\u4fe1\u606f\u3002 ANSIBLE_COMMAND_WARNINGS command_warnings defaults boolean True \u662f\u5426\u663e\u793a\uff0c\u5728shell\u548ccommand\u6a21\u5757\u4e2d\u4f7f\u7528\u4e0eansible\u6a21\u5757\u7c7b\u4f3c\u7684\u8b66\u544a\u4fe1\u606f\u3002 ANSIBLE_ACTION_PLUGINS action_plugins defaults pathspec ~/.ansible/plugins/action:/usr/share/ansible/plugins/action action\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_CACHE_PLUGINS cache_plugins defaults pathspec ~/.ansible/plugins/cache:/usr/share/ansible/plugins/cache cache\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_CALLBACK_PLUGINS callback_plugins defaults pathspec ~/.ansible/plugins/callback:/usr/share/ansible/plugins/callback callback\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_CONNECTION_PLUGINS connection_plugins defaults pathspec ~/.ansible/plugins/connection:/usr/share/ansible/plugins/connection connection\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_LOOKUP_PLUGINS lookup_plugins defaults pathspec ~/.ansible/plugins/lookup:/usr/share/ansible/plugins/lookup lookup\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_INVENTORY_PLUGINS inventory_plugins defaults pathspec ~/.ansible/plugins/inventory:/usr/share/ansible/plugins/inventory inventory\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_VARS_PLUGINS vars_plugins defaults pathspec ~/.ansible/plugins/vars:/usr/share/ansible/plugins/vars vars\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_FILTER_PLUGINS filter_plugins defaults pathspec ~/.ansible/plugins/filter:/usr/share/ansible/plugins/filter filter\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_TEST_PLUGINS test_plugins defaults pathspec ~/.ansible/plugins/test:/usr/share/ansible/plugins/test test\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_TERMINAL_PLUGINS terminal_plugins defaults pathspec ~/.ansible/plugins/terminal:/usr/share/ansible/plugins/terminal terminal\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_STRATEGY_PLUGINS strategy_plugins defaults pathspec ~/.ansible/plugins/strategy:/usr/share/ansible/plugins/strategy strategy\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_STRATEGY strategy defaults linear \u9ed8\u8ba4\u7b56\u7565 ANSIBLE_LOAD_CALLBACK_PLUGINS bin_ansible_callbacks defaults boolean False \u63a7\u5236\u8fd0\u884cansible\u65f6\uff0c\u662f\u5426\u52a0\u8f7dcallback\u63d2\u4ef6 ANSIBLE_CACHE_PLUGIN fact_caching defaults memory \u9009\u62e9\u4f7f\u7528\u54ea\u4e2a\u7f13\u5b58\u63d2\u4ef6\u4e3afact\u5b58\u50a8\u6240\u7528 ANSIBLE_CACHE_PLUGIN_CONNECTION fact_caching_connection defaults none \u5b9a\u4e49\u7f13\u5b58\u63d2\u4ef6\u7684\u8fde\u63a5 ANSIBLE_CACHE_PLUGIN_PREFIX fact_caching_prefix defaults ansible_facts \u7f13\u5b58\u63d2\u4ef6\u6587\u4ef6/\u8868\u7684\u524d\u7f00 ANSIBLE_CACHE_PLUGIN_TIMEOUT fact_caching_timeout defaults integer 86400 \u7f13\u5b58\u63d2\u4ef6\u6570\u636e\u7684\u8fc7\u671f\u8d85\u65f6\u65f6\u95f4 ANSIBLE_RETRY_FILES_ENABLED retry_files_enabled defaults boolean True \u63a7\u5236\u7740\u4e00\u4e2a\u5931\u8d25\u7684Ansible\u5267\u672c\u5e94\u8be5\u521b\u5efa\u4e00\u4e2a.retry\u6587\u4ef6\u3002 ANSIBLE_RETRY_FILES_SAVE_PATH retry_files_save_path defaults path none \u4fdd\u5b58.retry\u6587\u4ef6\u7684\u8def\u5f84\u3002 ANSIBLE_SQUASH_ACTIONS squash_actions defaults list apk, apt, dnf, homebrew, openbsd_pkg, pacman, pkgng, yum, zypper \u5728\u4f7f\u7528with_\u5faa\u73af\u65f6\uff0cAnsible\u53ef\u4ee5\u4f18\u5316\u8c03\u7528\u652f\u6301\u5217\u8868\u53c2\u6570\u7684\u6a21\u5757\u7684\u64cd\u4f5c\u3002\u4f7f\u53c2\u6570\u7ec4\u5408\u4e3a\u4e00\u4e2a\u5217\u8868\u4f20\u9012\u7ed9\u6a21\u5757\u3002 ANSIBLE_NO_LOG no_log defaults boolean False \u63a7\u5236Ansible\u7684\u663e\u793a\u548c\u8bb0\u5f55\u4efb\u52a1\u4fe1\u606f\u65e5\u5fd7\u3002 ANSIBLE_NO_TARGET_SYSLOG no_target_syslog defaults boolean False \u6267\u884c\u4efb\u52a1\u65f6\uff0cAnsible\u65e5\u5fd7\u662f\u5426\u663e\u793a\u5728\u76ee\u6807\u7cfb\u7edf\u65e5\u5fd7\u3002 module_compression defaults ZIP_DEFLATED \u5c06Python\u6a21\u5757\u4f20\u8f93\u5230\u76ee\u6807\u65f6\u4f7f\u7528\u7684\u538b\u7f29\u65b9\u6848\u3002 ANSIBLE_MAX_DIFF_SIZE max_diff_size defaults int 104448 \u8981\u663e\u793a\u5dee\u5f02\u6587\u4ef6\u7684\u6700\u5927\u6587\u4ef6\u5927\u5c0f ANSIBLE_SHOW_CUSTOM_STATS show_custom_stats defaults boolean False \u662f\u5426\u901a\u8fc7set_stats\u63d2\u4ef6\u8bbe\u7f6e\u7684\u81ea\u5b9a\u4e49\u7edf\u8ba1\u4fe1\u606f\u6dfb\u52a0\u5230\u9ed8\u8ba4\u8f93\u51fa ANSIBLE_INVENTORY_IGNORE inventory_ignore_extensions defaults {{(BLACKLIST_EXTS + ( \u2018~ , \u2018.orig , \u2018.ini , \u2018.cfg , \u2018.retry`))}} \u5c06\u76ee\u5f55\u7528\u4f5c\u5e93\u5b58\u6e90\u65f6\u5ffd\u7565\u7684\u6269\u5c55\u540d\u5217\u8868 allow_unsafe_lookups defaults boolean False \u4e3aTrue\u65f6\uff0c\u6b64\u9009\u9879\u5141\u8bb8\u67e5\u627e\u63d2\u4ef6\uff08\u65e0\u8bba\u5728\u53d8\u91cf\u4e2d\u7528\u4f5c ANSIBLE_INVENTORY_ENABLED enable_plugins inventory [\u2018host_list , \u2018script , \u2018yaml , \u2018ini , \u2018auto`] \u542f\u7528\u7684\u5e93\u5b58\u63d2\u4ef6\u5217\u8868\uff0c\u4e5f\u51b3\u5b9a\u4e86\u5b83\u4eec\u7684\u4f7f\u7528\u987a\u5e8f\u3002 ANSIBLE_INVENTORY_IGNORE ignore_extensions inventory {{(BLACKLIST_EXTS + ( \u2018~ , \u2018.orig , \u2018.ini , \u2018.cfg , \u2018.retry`))}} \u5c06\u76ee\u5f55\u7528\u4f5c\u5e93\u5b58\u6e90\u65f6\u5ffd\u7565\u7684\u6269\u5c55\u540d\u5217\u8868 ANSIBLE_INVENTORY_IGNORE_REGEX ignore_patterns inventory list [] \u5c06\u76ee\u5f55\u7528\u4f5c\u5e93\u5b58\u6e90\u65f6\u8981\u5ffd\u7565\u7684\u6a21\u5f0f\u5217\u8868 ANSIBLE_INVENTORY_UNPARSED_FAILED unparsed_is_failed inventory boolean False \u4e3atrue\u65f6\uff0c\u672a\u5206\u7c7b\u7684\u4e3b\u673a\u4f1a\u63d0\u793a\u81f4\u547d\u9519\u8bef\u3002 ANSIBLE_BECOME become privilege_escalation boolean False \u662f\u5426\u5f00\u542f\u7279\u6743\u5347\u7ea7 ANSIBLE_BECOME_METHOD become_method privilege_escalation sudo \u7279\u6743\u5347\u7ea7\u7684\u65b9\u5f0f ANSIBLE_BECOME_USER become_user privilege_escalation root \u7279\u6743\u5347\u7ea7\u7684\u7528\u6237 ANSIBLE_BECOME_ASK_PASS become_ask_pass privilege_escalation boolean False \u8f93\u5165\u7279\u6743\u5347\u7ea7\u7684\u5bc6\u7801 ANSIBLE_BECOME_FLAGS become_flags privilege_escalation \u4f20\u9012\u7ed9\u7279\u6743\u5347\u7ea7\u53ef\u6267\u884c\u6587\u4ef6\u7684\u53c2\u6570\u3002 ANSIBLE_BECOME_EXE become_exe privilege_escalation None \u53ef\u6267\u884c\u6587\u4ef6 ANSIBLE_PARAMIKO_LOOK_FOR_KEYS look_for_keys paramiko_connection boolean True paramiko\u5728\u5c1d\u8bd5\u5411\u8fdc\u7a0b\u8bbe\u5907\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u65f6\u9ed8\u8ba4\u67e5\u627eSSH\u5bc6\u94a5\u3002 ANSIBLE_PARAMIKO_HOST_KEY_AUTO_ADD host_key_auto_add paramiko_connection boolean False \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAnsible\u5c06\u63d0\u793a\u6dfb\u52a0\u4e3b\u673a\u5bc6\u94a5\u3002 \u8fd9\u5c06\u5bfc\u81f4\u5728\u540e\u53f0\u8fdb\u7a0b\u4e2d\u8fd0\u884c\u7684\u8fde\u63a5\u5931\u8d25\u3002\u4e3atrue\u65f6\uff0cParamiko\u81ea\u52a8\u6dfb\u52a0\u4e3b\u673a\u5bc6\u94a5\u3002 ANSIBLE_SCP_IF_SSH scp_if_ssh ssh_connection smart \u901a\u8fc7ssh\u4f20\u8f93\u6587\u4ef6\u65f6\u4f7f\u7528\u7684\u9996\u9009\u65b9\u6cd5\uff0c\u4f7f\u7528smart\u65f6\uff0c\u5148\u5c1d\u8bd5sftp\uff0c\u5728\u5c1d\u8bd5scp\u3002 ANSIBLE_SSH_TRANSFER_METHOD transfer_method ssh_connection None \u901a\u8fc7ssh\u4f20\u8f93\u6587\u4ef6\u65f6\u4f7f\u7528\u7684\u9996\u9009\u65b9\u6cd5\uff0c\u5982\u679c\u914d\u7f6e\u4e86\uff0c\u4f1a\u8986\u76d6scp_if_ssh ANSIBLE_SFTP_BATCH_MODE sftp_batch_mode ssh_connection boolean True \u5982\u679c\u4e3aFalse\uff0csftp\u5c06\u4e0d\u4f7f\u7528\u6279\u5904\u7406\u6a21\u5f0f\u4f20\u8f93\u6587\u4ef6\u3002 ANSIBLE_PERSISTENT_CONNECT_TIMEOUT connect_timeout persistent_connection integer 30 \u63a7\u5236\u8fde\u63a5\u4fdd\u6301\u7a7a\u95f2\u72b6\u6001\u7684\u65f6\u95f4\u3002 ANSIBLE_PERSISTENT_CONNECT_RETRY_TIMEOUT connect_retry_timeout persistent_connection integer 15 \u63a7\u5236\u8fde\u63a5\u91cd\u8bd5\u8d85\u65f6\u65f6\u95f4 ANSIBLE_PERSISTENT_CONNECT_TIMEOUT command_timeout persistent_connection integer 30 \u63a7\u5236\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 ANSIBLE_SELINUX_SPECIAL_FS special_context_filesystems selinux list fuse, nfs, vboxsf, ramfs, 9p, vfat \u5728\u5904\u7406\u5b89\u5168\u4e0a\u4e0b\u6587\u65f6\u9700\u8981\u7279\u6b8a\u5904\u7406\u7684\u6587\u4ef6\u7cfb\u7edf LIBVIRT_LXC_NOSECLABEL libvirt_lxc_noseclabel selinux boolean False \u901a\u8fc7\u5c06-noseclabel\u4f20\u9012\u7ed9virsh\uff0c\u5141\u8bb8libvirt_lxc\u8fde\u63a5\u5728\u6ca1\u6709SELinux\u7684\u60c5\u51b5\u4e0b\u5de5\u4f5c\u3002 ANSIBLE_COLOR_HIGHLIGHT highlight colors white \u5b9a\u4e49\u7528\u4e8e\u7a81\u51fa\u663e\u793a\u7684\u989c\u8272 ANSIBLE_COLOR_VERBOSE verbose colors blue \u5b9a\u4e49\u53d1\u51fa\u8be6\u7ec6\u6d88\u606f\u65f6\u8981\u4f7f\u7528\u7684\u989c\u8272\u3002 \u5373\u90a3\u4e9b\u7528'-v'\u8868\u793a\u7684\u3002 ANSIBLE_COLOR_WARN warn colors bright purple \u5b9a\u4e49\u53d1\u51fa\u8b66\u544a\u6d88\u606f\u65f6\u8981\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_ERROR error colors red \u5b9a\u4e49\u53d1\u51fa\u9519\u8bef\u6d88\u606f\u65f6\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_DEBUG debug colors dark gray \u5b9a\u4e49\u53d1\u51fa\u8c03\u8bd5\u6d88\u606f\u65f6\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_DEPRECATE deprecate colors purple \u5b9a\u4e49\u53d1\u51fa\u5f03\u7528\u6d88\u606f\u65f6\u8981\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_UNREACHABLE unreachable colors bright red \u5b9a\u4e49\u5728\u201c\u65e0\u6cd5\u5230\u8fbe\u201d\u72b6\u6001\u4e0b\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_CHANGED changed colors yellow \u5b9a\u4e49\u5728\u201c\u66f4\u6539\u201d\u4efb\u52a1\u72b6\u6001\u4e0a\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_DIFF_ADD diff_add colors green \u5b9a\u4e49\u5728\u5dee\u5f02\u4e2d\u663e\u793a\u6dfb\u52a0\u884c\u65f6\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_DIFF_REMOVE diff_remove colors red \u5b9a\u4e49\u5728\u5dee\u5f02\u4e2d\u663e\u793a\u5df2\u5220\u9664\u884c\u65f6\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_DIFF_LINES diff_lines colors cyan \u5b9a\u4e49\u663e\u793a\u5dee\u5f02\u65f6\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_DIFF_ALWAYS always diff boolean False \u662f\u5426\u663e\u793a\u6a21\u5757\u5728\u5904\u4e8e\u201c\u66f4\u6539\u201d\u72b6\u6001\u65f6\u663e\u793a\u5dee\u5f02\uff0c\u76f8\u5f53\u4e8e--diff\u3002 ANSIBLE_DIFF_CONTEXT context diff integer 3 \u5728\u663e\u793a\u6587\u4ef6\u4e4b\u95f4\u7684\u5dee\u5f02\u65f6\u663e\u793a\u591a\u5c11\u884c\u4e0a\u4e0b\u6587\u3002 ANSIBLE_YAML_FILENAME_EXT yaml_valid_extensions defaults List [ .yml , .yaml , .json ] yaml\u6587\u4ef6\u7684\u6269\u5c55\u540d \u8be6\u7ec6\u89c1 \u5b98\u7f51","title":"5. Ansible \u914d\u7f6e"},{"location":"basic/Reference/Config/#ansible","text":"Ansible \u652f\u6301\u51e0\u4e2a\u6e90\u6765\u914d\u7f6e\u5b83\u7684\u884c\u4e3a\uff0c\u5305\u62ec\u4e00\u4e2a\u540d\u4e3a ansible.cfg \u7684ini\u6587\u4ef6\u3001\u73af\u5883\u53d8\u91cf\u3001\u547d\u4ee4\u884c\u9009\u9879\u3001playbook\u5173\u952e\u5b57\u548c\u53d8\u91cf\u3002","title":"Ansible \u914d\u7f6e"},{"location":"basic/Reference/Config/#_1","text":"Ansible \u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u5b58\u653e\u5728\u4e0d\u540c\u7684\u4f4d\u7f6e\uff0c\u4f46\u53ea\u6709\u4e00\u4e2a\u53ef\u7528\u3002\u5728\u4e0b\u5217\u5217\u8868\u4e2d\uff0cansible\u4ece\u4e0a\u5f80\u4e0b\u4f9d\u6b21\u68c0\u67e5\uff0c\u68c0\u67e5\u5230\u54ea\u4e2a\u53ef\u7528\u5c31\u7528\u54ea\u4e2a\u3002 ANSIBLE_CONFIG \u73af\u5883\u53d8\u91cf\uff0c\u53ef\u4ee5\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e ./ansible.cfg \u5b58\u5728\u4e8e\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55 ~/.ansible.cfg \u5b58\u5728\u4e0e\u5f53\u524d\u7528\u6237\u5bb6\u76ee\u5f55 /etc/ansible/ansible.cfg","title":"\u914d\u7f6e\u6587\u4ef6"},{"location":"basic/Reference/Config/#_2","text":"\u4f7f\u7528\u6e90\u7801\u6216\u8005pip\u65b9\u5f0f\u5b89\u88c5\u65f6\uff0c\u9700\u8981\u53e6\u884c\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\uff0c\u53ef\u4ee5\u5728ansible\u4ed3\u5e93\u4e2d\u83b7\u53d6\u6700\u65b0\u7684\u914d\u7f6e\u6587\u4ef6 https://raw.github.com/ansible/ansible/devel/examples/ansible.cfg Note \u914d\u7f6e\u6587\u4ef6\u662fINI\u683c\u5f0f\u7684\u4e00\u79cd\u53d8\u4f53\u3002\u5f53\u6ce8\u91ca\u5f00\u59cb\u884c\u65f6\uff0c\u6563\u5217\u7b26\u53f7\uff08#\uff09\u548c\u5206\u53f7\uff08;\uff09\u90fd\u88ab\u5141\u8bb8\u4f5c\u4e3a\u6ce8\u91ca\u6807\u8bb0\u3002","title":"\u83b7\u53d6\u9ed8\u8ba4\u914d\u7f6e"},{"location":"basic/Reference/Config/#_3","text":"\u4e0b\u5217\u662fcentos7\u7cfb\u7edf\u4e0a\u7684ansible 2.9.6\u7248\u672c\u914d\u7f6e # config file for ansible -- https://ansible.com/ # =============================================== # nearly all parameters can be overridden in ansible-playbook # or with command line flags. ansible will read ANSIBLE_CONFIG, # ansible.cfg in the current working directory, .ansible.cfg in # the home directory or /etc/ansible/ansible.cfg, whichever it # finds first [defaults] # some basic default values... #inventory = /etc/ansible/hosts #library = /usr/share/my_modules/ #module_utils = /usr/share/my_module_utils/ #remote_tmp = ~/.ansible/tmp #local_tmp = ~/.ansible/tmp #plugin_filters_cfg = /etc/ansible/plugin_filters.yml #forks = 5 #poll_interval = 15 #sudo_user = root #ask_sudo_pass = True #ask_pass = True #transport = smart #remote_port = 22 #module_lang = C #module_set_locale = False # plays will gather facts by default, which contain information about # the remote system. # # smart - gather by default, but don't regather if already gathered # implicit - gather by default, turn off with gather_facts: False # explicit - do not gather by default, must say gather_facts: True #gathering = implicit # This only affects the gathering done by a play's gather_facts directive, # by default gathering retrieves all facts subsets # all - gather all subsets # network - gather min and network facts # hardware - gather hardware facts (longest facts to retrieve) # virtual - gather min and virtual facts # facter - import facts from facter # ohai - import facts from ohai # You can combine them using comma (ex: network,virtual) # You can negate them using ! (ex: !hardware,!facter,!ohai) # A minimal set of facts is always gathered. #gather_subset = all # some hardware related facts are collected # with a maximum timeout of 10 seconds. This # option lets you increase or decrease that # timeout to something more suitable for the # environment. # gather_timeout = 10 # Ansible facts are available inside the ansible_facts.* dictionary # namespace. This setting maintains the behaviour which was the default prior # to 2.5, duplicating these variables into the main namespace, each with a # prefix of 'ansible_'. # This variable is set to True by default for backwards compatibility. It # will be changed to a default of 'False' in a future release. # ansible_facts. # inject_facts_as_vars = True # additional paths to search for roles in, colon separated #roles_path = /etc/ansible/roles # uncomment this to disable SSH key host checking #host_key_checking = False # change the default callback, you can only have one 'stdout' type enabled at a time. #stdout_callback = skippy ## Ansible ships with some plugins that require whitelisting, ## this is done to avoid running all of a type by default. ## These setting lists those that you want enabled for your system. ## Custom plugins should not need this unless plugin author specifies it. # enable callback plugins, they can output to stdout but cannot be 'stdout' type. #callback_whitelist = timer, mail # Determine whether includes in tasks and handlers are \"static\" by # default. As of 2.0, includes are dynamic by default. Setting these # values to True will make includes behave more like they did in the # 1.x versions. #task_includes_static = False #handler_includes_static = False # Controls if a missing handler for a notification event is an error or a warning #error_on_missing_handler = True # change this for alternative sudo implementations #sudo_exe = sudo # What flags to pass to sudo # WARNING: leaving out the defaults might create unexpected behaviours #sudo_flags = -H -S -n # SSH timeout #timeout = 10 # default user to use for playbooks if user is not specified # (/usr/bin/ansible will use current user as default) #remote_user = root # logging is off by default unless this path is defined # if so defined, consider logrotate #log_path = /var/log/ansible.log # default module name for /usr/bin/ansible #module_name = command # use this shell for commands executed under sudo # you may need to change this to bin/bash in rare instances # if sudo is constrained #executable = /bin/sh # if inventory variables overlap, does the higher precedence one win # or are hash values merged together? The default is 'replace' but # this can also be set to 'merge'. #hash_behaviour = replace # by default, variables from roles will be visible in the global variable # scope. To prevent this, the following option can be enabled, and only # tasks and handlers within the role will see the variables there #private_role_vars = yes # list any Jinja2 extensions to enable here: #jinja2_extensions = jinja2.ext.do,jinja2.ext.i18n # if set, always use this private key file for authentication, same as # if passing --private-key to ansible or ansible-playbook #private_key_file = /path/to/file # If set, configures the path to the Vault password file as an alternative to # specifying --vault-password-file on the command line. #vault_password_file = /path/to/vault_password_file # format of string {{ ansible_managed }} available within Jinja2 # templates indicates to users editing templates files will be replaced. # replacing {file}, {host} and {uid} and strftime codes with proper values. #ansible_managed = Ansible managed: {file} modified on %Y-%m-%d %H:%M:%S by {uid} on {host} # {file}, {host}, {uid}, and the timestamp can all interfere with idempotence # in some situations so the default is a static string: #ansible_managed = Ansible managed # by default, ansible-playbook will display \"Skipping [host]\" if it determines a task # should not be run on a host. Set this to \"False\" if you don't want to see these \"Skipping\" # messages. NOTE: the task header will still be shown regardless of whether or not the # task is skipped. #display_skipped_hosts = True # by default, if a task in a playbook does not include a name: field then # ansible-playbook will construct a header that includes the task's action but # not the task's args. This is a security feature because ansible cannot know # if the *module* considers an argument to be no_log at the time that the # header is printed. If your environment doesn't have a problem securing # stdout from ansible-playbook (or you have manually specified no_log in your # playbook on all of the tasks where you have secret information) then you can # safely set this to True to get more informative messages. #display_args_to_stdout = False # by default (as of 1.3), Ansible will raise errors when attempting to dereference # Jinja2 variables that are not set in templates or action lines. Uncomment this line # to revert the behavior to pre-1.3. #error_on_undefined_vars = False # by default (as of 1.6), Ansible may display warnings based on the configuration of the # system running ansible itself. This may include warnings about 3rd party packages or # other conditions that should be resolved if possible. # to disable these warnings, set the following value to False: #system_warnings = True # by default (as of 1.4), Ansible may display deprecation warnings for language # features that should no longer be used and will be removed in future versions. # to disable these warnings, set the following value to False: #deprecation_warnings = True # (as of 1.8), Ansible can optionally warn when usage of the shell and # command module appear to be simplified by using a default Ansible module # instead. These warnings can be silenced by adjusting the following # setting or adding warn=yes or warn=no to the end of the command line # parameter string. This will for example suggest using the git module # instead of shelling out to the git command. # command_warnings = False # set plugin path directories here, separate with colons #action_plugins = /usr/share/ansible/plugins/action #become_plugins = /usr/share/ansible/plugins/become #cache_plugins = /usr/share/ansible/plugins/cache #callback_plugins = /usr/share/ansible/plugins/callback #connection_plugins = /usr/share/ansible/plugins/connection #lookup_plugins = /usr/share/ansible/plugins/lookup #inventory_plugins = /usr/share/ansible/plugins/inventory #vars_plugins = /usr/share/ansible/plugins/vars #filter_plugins = /usr/share/ansible/plugins/filter #test_plugins = /usr/share/ansible/plugins/test #terminal_plugins = /usr/share/ansible/plugins/terminal #strategy_plugins = /usr/share/ansible/plugins/strategy # by default, ansible will use the 'linear' strategy but you may want to try # another one #strategy = free # by default callbacks are not loaded for /bin/ansible, enable this if you # want, for example, a notification or logging callback to also apply to # /bin/ansible runs #bin_ansible_callbacks = False # don't like cows? that's unfortunate. # set to 1 if you don't want cowsay support or export ANSIBLE_NOCOWS=1 #nocows = 1 # set which cowsay stencil you'd like to use by default. When set to 'random', # a random stencil will be selected for each task. The selection will be filtered # against the `cow_whitelist` option below. #cow_selection = default #cow_selection = random # when using the 'random' option for cowsay, stencils will be restricted to this list. # it should be formatted as a comma-separated list with no spaces between names. # NOTE: line continuations here are for formatting purposes only, as the INI parser # in python does not support them. #cow_whitelist=bud-frogs,bunny,cheese,daemon,default,dragon,elephant-in-snake,elephant,eyes,\\ # hellokitty,kitty,luke-koala,meow,milk,moofasa,moose,ren,sheep,small,stegosaurus,\\ # stimpy,supermilker,three-eyes,turkey,turtle,tux,udder,vader-koala,vader,www # don't like colors either? # set to 1 if you don't want colors, or export ANSIBLE_NOCOLOR=1 #nocolor = 1 # if set to a persistent type (not 'memory', for example 'redis') fact values # from previous runs in Ansible will be stored. This may be useful when # wanting to use, for example, IP information from one group of servers # without having to talk to them in the same playbook run to get their # current IP information. #fact_caching = memory #This option tells Ansible where to cache facts. The value is plugin dependent. #For the jsonfile plugin, it should be a path to a local directory. #For the redis plugin, the value is a host:port:database triplet: fact_caching_connection = localhost:6379:0 #fact_caching_connection=/tmp # retry files # When a playbook fails a .retry file can be created that will be placed in ~/ # You can enable this feature by setting retry_files_enabled to True # and you can change the location of the files by setting retry_files_save_path #retry_files_enabled = False #retry_files_save_path = ~/.ansible-retry # squash actions # Ansible can optimise actions that call modules with list parameters # when looping. Instead of calling the module once per with_ item, the # module is called once with all items at once. Currently this only works # under limited circumstances, and only with parameters named 'name'. #squash_actions = apk,apt,dnf,homebrew,pacman,pkgng,yum,zypper # prevents logging of task data, off by default #no_log = False # prevents logging of tasks, but only on the targets, data is still logged on the master/controller #no_target_syslog = False # controls whether Ansible will raise an error or warning if a task has no # choice but to create world readable temporary files to execute a module on # the remote machine. This option is False by default for security. Users may # turn this on to have behaviour more like Ansible prior to 2.1.x. See # https://docs.ansible.com/ansible/become.html#becoming-an-unprivileged-user # for more secure ways to fix this than enabling this option. #allow_world_readable_tmpfiles = False # controls the compression level of variables sent to # worker processes. At the default of 0, no compression # is used. This value must be an integer from 0 to 9. #var_compression_level = 9 # controls what compression method is used for new-style ansible modules when # they are sent to the remote system. The compression types depend on having # support compiled into both the controller's python and the client's python. # The names should match with the python Zipfile compression types: # * ZIP_STORED (no compression. available everywhere) # * ZIP_DEFLATED (uses zlib, the default) # These values may be set per host via the ansible_module_compression inventory # variable #module_compression = 'ZIP_DEFLATED' # This controls the cutoff point (in bytes) on --diff for files # set to 0 for unlimited (RAM may suffer!). #max_diff_size = 1048576 # This controls how ansible handles multiple --tags and --skip-tags arguments # on the CLI. If this is True then multiple arguments are merged together. If # it is False, then the last specified argument is used and the others are ignored. # This option will be removed in 2.8. #merge_multiple_cli_flags = True # Controls showing custom stats at the end, off by default #show_custom_stats = True # Controls which files to ignore when using a directory as inventory with # possibly multiple sources (both static and dynamic) #inventory_ignore_extensions = ~, .orig, .bak, .ini, .cfg, .retry, .pyc, .pyo # This family of modules use an alternative execution path optimized for network appliances # only update this setting if you know how this works, otherwise it can break module execution #network_group_modules=eos, nxos, ios, iosxr, junos, vyos # When enabled, this option allows lookups (via variables like {{lookup('foo')}} or when used as # a loop with `with_foo`) to return data that is not marked \"unsafe\". This means the data may contain # jinja2 templating language which will be run through the templating engine. # ENABLING THIS COULD BE A SECURITY RISK #allow_unsafe_lookups = False # set default errors for all plays #any_errors_fatal = False [inventory] # enable inventory plugins, default: 'host_list', 'script', 'auto', 'yaml', 'ini', 'toml' #enable_plugins = host_list, virtualbox, yaml, constructed # ignore these extensions when parsing a directory as inventory source #ignore_extensions = .pyc, .pyo, .swp, .bak, ~, .rpm, .md, .txt, ~, .orig, .ini, .cfg, .retry # ignore files matching these patterns when parsing a directory as inventory source #ignore_patterns= # If 'true' unparsed inventory sources become fatal errors, they are warnings otherwise. #unparsed_is_failed=False [privilege_escalation] #become=True #become_method=sudo #become_user=root #become_ask_pass=False [paramiko_connection] # uncomment this line to cause the paramiko connection plugin to not record new host # keys encountered. Increases performance on new host additions. Setting works independently of the # host key checking setting above. #record_host_keys=False # by default, Ansible requests a pseudo-terminal for commands executed under sudo. Uncomment this # line to disable this behaviour. #pty=False # paramiko will default to looking for SSH keys initially when trying to # authenticate to remote devices. This is a problem for some network devices # that close the connection after a key failure. Uncomment this line to # disable the Paramiko look for keys function #look_for_keys = False # When using persistent connections with Paramiko, the connection runs in a # background process. If the host doesn't already have a valid SSH key, by # default Ansible will prompt to add the host key. This will cause connections # running in background processes to fail. Uncomment this line to have # Paramiko automatically add host keys. #host_key_auto_add = True [ssh_connection] # ssh arguments to use # Leaving off ControlPersist will result in poor performance, so use # paramiko on older platforms rather than removing it, -C controls compression use #ssh_args = -C -o ControlMaster=auto -o ControlPersist=60s # The base directory for the ControlPath sockets. # This is the \"%(directory)s\" in the control_path option # # Example: # control_path_dir = /tmp/.ansible/cp #control_path_dir = ~/.ansible/cp # The path to use for the ControlPath sockets. This defaults to a hashed string of the hostname, # port and username (empty string in the config). The hash mitigates a common problem users # found with long hostnames and the conventional %(directory)s/ansible-ssh-%%h-%%p-%%r format. # In those cases, a \"too long for Unix domain socket\" ssh error would occur. # # Example: # control_path = %(directory)s/%%h-%%r #control_path = # Enabling pipelining reduces the number of SSH operations required to # execute a module on the remote server. This can result in a significant # performance improvement when enabled, however when using \"sudo:\" you must # first disable 'requiretty' in /etc/sudoers # # By default, this option is disabled to preserve compatibility with # sudoers configurations that have requiretty (the default on many distros). # #pipelining = False # Control the mechanism for transferring files (old) # * smart = try sftp and then try scp [default] # * True = use scp only # * False = use sftp only #scp_if_ssh = smart # Control the mechanism for transferring files (new) # If set, this will override the scp_if_ssh option # * sftp = use sftp to transfer files # * scp = use scp to transfer files # * piped = use 'dd' over SSH to transfer files # * smart = try sftp, scp, and piped, in that order [default] #transfer_method = smart # if False, sftp will not use batch mode to transfer files. This may cause some # types of file transfer failures impossible to catch however, and should # only be disabled if your sftp version has problems with batch mode #sftp_batch_mode = False # The -tt argument is passed to ssh when pipelining is not enabled because sudo # requires a tty by default. #usetty = True # Number of times to retry an SSH connection to a host, in case of UNREACHABLE. # For each retry attempt, there is an exponential backoff, # so after the first attempt there is 1s wait, then 2s, 4s etc. up to 30s (max). #retries = 3 [persistent_connection] # Configures the persistent connection timeout value in seconds. This value is # how long the persistent connection will remain idle before it is destroyed. # If the connection doesn't receive a request before the timeout value # expires, the connection is shutdown. The default value is 30 seconds. #connect_timeout = 30 # The command timeout value defines the amount of time to wait for a command # or RPC call before timing out. The value for the command timeout must # be less than the value of the persistent connection idle timeout (connect_timeout) # The default value is 30 second. #command_timeout = 30 [accelerate] #accelerate_port = 5099 #accelerate_timeout = 30 #accelerate_connect_timeout = 5.0 # The daemon timeout is measured in minutes. This time is measured # from the last activity to the accelerate daemon. #accelerate_daemon_timeout = 30 # If set to yes, accelerate_multi_key will allow multiple # private keys to be uploaded to it, though each user must # have access to the system via SSH to add a new key. The default # is \"no\". #accelerate_multi_key = yes [selinux] # file systems that require special treatment when dealing with security context # the default behaviour that copies the existing context or uses the user default # needs to be changed to use the file system dependent context. #special_context_filesystems=nfs,vboxsf,fuse,ramfs,9p,vfat # Set this to yes to allow libvirt_lxc connections to work without SELinux. #libvirt_lxc_noseclabel = yes [colors] #highlight = white #verbose = blue #warn = bright purple #error = red #debug = dark gray #deprecate = purple #skip = cyan #unreachable = red #ok = green #changed = yellow #diff_add = green #diff_remove = red #diff_lines = cyan [diff] # Always print diff when running ( same as always running with -D/--diff ) # always = no # Set how many context lines to show in diff # context = 3","title":"\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6"},{"location":"basic/Reference/Config/#_4","text":"\u4e0b\u5217\u5217\u51fa\u4e86\u5e38\u7528\u7684\u4e00\u4e9b\u8bbe\u7f6e\uff0c\u53ef\u7528\u4f5c\u53c2\u8003\u3002 [defaults] # Set the log_path log_path = ~/ansible.log # Additional default options for Ansible forks = 20 host_key_checking = False retry_files_enabled = False retry_files_save_path = ~/ansible-installer-retries nocows = True remote_user = root roles_path = roles/ gathering = smart fact_caching = jsonfile fact_caching_connection = $HOME/ansible/facts fact_caching_timeout = 600 callback_whitelist = profile_tasks inventory_ignore_extensions = secrets.py, .pyc, .cfg, .crt, .ini # work around privilege escalation timeouts in ansible: timeout = 30 host_key_checking = False # Uncomment to use the provided example inventory #inventory = inventory/hosts.example ansible_managed = Ansible managed: {file} modified by {uid} on {host} [inventory] # fail more helpfully when the inventory file does not parse (Ansible 2.4+) unparsed_is_failed = true # Additional ssh options for OpenShift Ansible [ssh_connection] retries = 15 pipelining = True ssh_args = -o ControlMaster=auto -o ControlPersist=600s timeout = 10 # shorten the ControlPath which is often too long; when it is, # ssh connection reuse silently fails, making everything slower. control_path = %(directory)s/%%h-%%r","title":"\u5e38\u7528\u8bbe\u7f6e"},{"location":"basic/Reference/Config/#ansible-config","text":"\u4f7f\u7528 ansible-config \u7a0b\u5e8f\u53ef\u4ee5\u67e5\u770b\u6240\u6709\u53ef\u7528\u7684\u914d\u7f6e\u8bbe\u7f6e\u3001\u4ee5\u53ca\u5b83\u4eec\u7684\u9ed8\u8ba4\u503c\u3001\u8fd8\u6709\u5b83\u4eec\u7684\u5f53\u524d\u503c\u6765\u81ea\u4f55\u5904\u3002 \u67e5\u770b\u5f53\u524d\u914d\u7f6e\u6587\u4ef6 ansible-config view \u67e5\u770b\u5f53\u524d\u914d\u7f6e ansible-config dump \u67e5\u770b\u914d\u7f6e\u9879\u8bf4\u660e ansible-config list","title":"ansible-config"},{"location":"basic/Reference/Config/#_5","text":"Ansible \u63d0\u4f9b\u4e86\u56db\u79cd\u8d44\u6e90\u6765\u63a7\u5236\u5b83\u7684\u884c\u4e3a\u3002\u6309\u7167\u4ece\u6700\u4f4e(\u6700\u5bb9\u6613\u88ab\u8986\u76d6)\u5230\u6700\u9ad8(\u8986\u76d6\u6240\u6709\u5176\u4ed6)\u7684\u4f18\u5148\u7ea7\u987a\u5e8f\uff0c\u8fd9\u4e9b\u7c7b\u522b\u662f Configuration settings \u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e Note Ansible \u914d\u7f6e\u6587\u4ef6\u62e5\u6709\u6700\u4f4e\u7684\u4f18\u5148\u7ea7\uff0c\u4f46\u6587\u4ef6\u53ef\u4ee5\u5b58\u653e\u5728\u4e0d\u540c\u7684\u4f4d\u7f6e\uff0c\u5176\u4e2d\u53ea\u6709\u4e00\u4e2a\u53ef\u7528\u3002\u5728\u4e0b\u5217\u5217\u8868\u4e2d\uff0cansible\u4ece\u4e0a\u5f80\u4e0b\u4f9d\u6b21\u68c0\u67e5\uff0c\u68c0\u67e5\u5230\u54ea\u4e2a\u53ef\u7528\u5c31\u7528\u54ea\u4e2a\u3002 ANSIBLE_CONFIG \u73af\u5883\u53d8\u91cf\uff0c\u53ef\u4ee5\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\u7684\u4f4d\u7f6e ./ansible.cfg \u5b58\u5728\u4e8e\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55 ~/.ansible.cfg \u5b58\u5728\u4e0e\u5f53\u524d\u7528\u6237\u5bb6\u76ee\u5f55 /etc/ansible/ansible.cfg Command-line options \u547d\u4ee4\u884c\u9009\u9879 Note \u547d\u4ee4\u884c\u9009\u9879\u5c06\u8986\u76d6\u4efb\u4f55\u914d\u7f6e\u6587\u4ef6\u7684\u8bbe\u7f6e # \u6307\u5b9a\u591a\u4e2a-u\u65f6\uff0c\u540e\u9762\u7684\u8986\u76d6\u524d\u9762 ansible -u mike -m ping myhost -u carol # \u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a-i\u9009\u9879 ansible -i /path/inventory1 -i /path/inventory2 -m ping all Playbook keywords playbook\u5173\u952e\u5b57 Note playbook\u5173\u952e\u5b57 \u5c06\u8986\u76d6\u547d\u4ee4\u884c\u9009\u9879\u548c\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u8bbe\u7f6e \u5728playbook\u5173\u952e\u5b57\u4e2d\uff0c\u4f18\u5148\u7ea7\u4e0eplaybook\u672c\u8eab\u4e00\u8d77\u53d8\u52a8;\u8d8a\u5177\u4f53\u7684\u8bbe\u7f6e\u8d8a\u80fd\u6218\u80dc\u8d8a\u7b3c\u7edf\u7684\u8bbe\u7f6e\uff0c\u5982 tasks > blocks/includes/imports/roles > play - hosts : all connection : ssh tasks : - name : This task uses ssh. ping : - name : This task uses paramiko. connection : paramiko ping : Variables \u53d8\u91cf Note \u53d8\u91cf\u5c06\u8986\u76d6playbook\u5173\u952e\u5b57\u3001\u547d\u4ee4\u884c\u9009\u9879\u548c\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e \u5728playbook\u4e2d\u4f7f\u7528 vars \u8bbe\u7f6e\u53d8\u91cf\uff0c\u5176\u4e2d\u53d8\u91cf\u4f18\u5148\u7ea7\u4e5f\u662f\u9075\u5b88\u5177\u4f53\u4f18\u5148\u7684\u7b56\u7565\u3002 - hosts : cloud gather_facts : false become : yes vars : ansible_become_user : admin tasks : - name : This task uses admin as the become user. dnf : name : some-service state : latest - block : - name : This task uses service-admin as the become user. # a task to configure the new service - name : This task also uses service-admin as the become user, defined in the block. # second task to configure the service vars : ansible_become_user : service-admin - name : This task (outside of the block) uses admin as the become user again. service : name : some-service state : restarted \u5728\u547d\u4ee4\u884c\u5de5\u5177\u4e2d\u4f7f\u7528 -e \u6307\u5b9a\u53d8\u91cf\u65f6\uff0c\u5c06\u8986\u76d6playbook\u4e2d\u7684\u53d8\u91cf ansible -u carol -e 'ansible_user=brian' -a whoami all","title":"\u914d\u7f6e\u7684\u4f18\u5148\u7ea7"},{"location":"basic/Reference/Config/#_6","text":"\u5217\u51fa ansible \u76ee\u524d\u7248\u672c\uff08 2.9.6 \uff09\u53ef\u7528\u7684\u9009\u9879\u914d\u7f6e \u73af\u5883\u53d8\u91cf Ini key Ini section \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e ANSIBLE_ACTION_WARNINGS action_warnings defaults boolean True \u8f93\u51fa\u4efb\u52a1\u7684\u8b66\u544a\u4fe1\u606f ANSIBLE_AGNOSTIC_BECOME_PROMPT agnostic_become_prompt privilege_escalation boolean True \u8f93\u51fa\u6743\u9650\u63d0\u5347\u63d0\u793a allow_world_readable_tmpfiles defaults boolean False \u662f\u5426\u5728\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u521b\u5efa\u4e34\u65f6\u76ee\u5f55\u65f6\u663e\u793a\u8b66\u544a\u800c\u4e0d\u662f\u5931\u8d25\u3002 ANSIBLE_CONNECTION_PATH ansible_connection_path persistent_connection path None \u6307\u5b9a\u5728\u4f55\u5904\u67e5\u627eansibl-connection\u811a\u672c\uff0c\u4e3a\u7a7a\u65f6\uff0c\u5c06\u5728\u5f53\u524d\u76ee\u5f55\u67e5\u627e ANSIBLE_COW_PATH cowpath defaults string None \u6307\u5b9a\u4e00\u4e2a\u81ea\u5b9a\u4e49cowsay\u8def\u5f84 ANSIBLE_COW_SELECTION cow_selection defaults defaults \u9009\u62e9\u4e00\u4e2a\u7279\u5b9a\u7684cowsay\u6a21\u677f ANSIBLE_COW_WHITELIST cow_whitelist defaults list [\u2018bud-frogs , \u2018bunny , \u2018cheese , \u2018daemon , \u2018default , \u2018dragon , \u2018elephant-in-snake , \u2018elephant , \u2018eyes , \u2018hellokitty , \u2018kitty , \u2018luke-koala , \u2018meow , \u2018milk , \u2018moofasa , \u2018moose , \u2018ren , \u2018sheep , \u2018small , \u2018stegosaurus , \u2018stimpy , \u2018supermilker , \u2018three-eyes , \u2018turkey , \u2018turtle , \u2018tux , \u2018udder , \u2018vader-koala , \u2018vader , \u2018www ] Cowsay\u6a21\u677f\u767d\u540d\u5355 ANSIBLE_FORCE_COLOR force_color defaults boolean False \u5f3a\u5236\u8f93\u51fa\u989c\u8272 ANSIBLE_NOCOLOR nocolor defaults boolean False \u662f\u5426\u5141\u8bb8\u7740\u8272\u663e\u793a\u4fe1\u606f\u3002 ANSIBLE_NOCOWS nocows defaults boolean False \u5982\u679c\u4f60\u5df2\u7ecf\u5b89\u88c5\u4e86cowsay\uff0c\u4f46\u662f\u60f3\u907f\u514d\u4f7f\u7528 cows \uff0c\u8bf7\u4f7f\u7528\u8fd9\u4e2a\u3002 ANSIBLE_PIPELINING pipelining connection boolean False \u8fde\u63a5\u7ba1\u9053 ANSIBLE_SSH_PIPELINING pipelining ssh_connection boolean False \u542f\u7528\u7ba1\u9053\u6a21\u5f0f\uff0c \u542f\u7528\u540e\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002 ANSIBLE_SSH_ARGS ssh_args ssh_connection -C -o ControlMaster=auto -o ControlPersist=60s ssh\u53c2\u6570 ANSIBLE_CONNECTION_PATH ansible_connection_path persistent_connection path None \u6307\u5b9a\u5728\u4f55\u5904\u67e5\u627eansibl-connection\u811a\u672c\uff0c\u4e3a\u7a7a\u65f6\uff0c\u5c06\u5728\u5f53\u524d\u76ee\u5f55\u67e5\u627e ANSIBLE_SSH_CONTROL_PATH_DIR control_path_dir ssh_connection ~/.ansible/cp ssh\u63a7\u5236\u8def\u5f84\u7684\u76ee\u5f55 ANSIBLE_SSH_CONTROL_PATH control_path ssh_connection None \u8fd9\u662f\u4fdd\u5b58ssh\u7684ControlPath\u5957\u63a5\u5b57\u7684\u4f4d\u7f6e\uff0c\u5b83\u4f7f\u7528ssh\u7684\u53d8\u91cf\u66ff\u6362\u3002 ANSIBLE_SSH_EXECUTABLE ssh_executable ssh_connection ssh \u5b9a\u4e49\u4e86ssh\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u4f4d\u7f6e ANSIBLE_SSH_RETRIES retries ssh_connection integer 0 ssh\u5c1d\u8bd5\u5efa\u7acb\u8fde\u63a5\u7684\u6b21\u6570 ANSIBLE_ANY_ERRORS_FATAL any_errors_fatal defaults boolean False \u4e3aTrue\uff0c\u5219\u4efb\u52a1\u5931\u8d25\u5c06\u88ab\u89c6\u4e3a\u81f4\u547d\u9519\u8bef\uff0c\u4f1a\u7acb\u5373\u505c\u6b62\u6267\u884c ANSIBLE_BECOME_ALLOW_SAME_USER become_allow_same_user privilege_escalation boolean False \u5f53\u8fde\u63a5\u7528\u6237\u548cbecome\u7528\u6237\u4e00\u81f4\u65f6\uff0c\u662f\u5426\u8df3\u8fc7become ANSIBLE_BECOME_PLUGINS become_plugins defaults pathspec ~/.ansible/plugins/become:/usr/share/ansible/plugins/become become \u63d2\u4ef6\u8def\u5f84 ANSIBLE_INVENTORY inventory defaults pathlist /etc/ansible/hosts \u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\u6587\u4ef6\u5217\u8868 ANSIBLE_LIBRARY library defaults pathspec ~/.ansible/plugins/modules:/usr/share/ansible/plugins/modules \u5192\u53f7\u5206\u9694\u7684\u6a21\u5757\u8def\u5f84 ANSIBLE_MODULE_UTILS module_utils defaults pathspec ~/.ansible/plugins/module_utils:/usr/share/ansible/plugins/module_utils \u7528\u4e8e\u5b58\u653e\u6a21\u5757\u5171\u4eab\u7684\u6587\u4ef6 remote_tmp defaults tmppath ~/.ansible/tmp \u8282\u70b9\u7684\u4e34\u65f6\u76ee\u5f55 ANSIBLE_LOCAL_TEMP local_tmp defaults tmppath ~/.ansible/tmp \u63a7\u5236\u7aef\u7684\u4e34\u65f6\u76ee\u5f55 plugin_filters_cfg defaults /etc/ansible/plugin_filters.yml \u63d2\u4ef6\u8fc7\u6ee4\u5668\u6587\u4ef6 ANSIBLE_FORKS forks defaults integer 5 \u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u6267\u884c\u4efb\u52a1\u7684\u6700\u5927\u6570\u3002 ANSIBLE_POLL_INTERVAL poll_interval defaults integer 15 \u6307\u5b9a\u5f02\u6b65\u4efb\u52a1\u7684\u8f6e\u8be2\u95f4\u9694\u65f6\u95f4 ANSIBLE_SUDO_USER sudo_user defaults None sudo\u7684\u7528\u6237\uff0c\u5c06\u57282.8\u5e9f\u5f03 ANSIBLE_ASK_SUDO_PASS ask_sudo_pass defaults boolean False \u662f\u5426\u63d0\u793a\u8f93\u5165sudo\u7528\u6237\u7684\u5bc6\u7801\uff0c\u5c06\u57282.8\u5e9f\u5f03 ANSIBLE_ASK_PASS ask_pass defaults boolean False \u662f\u5426\u63d0\u793a\u8f93\u5165ssh\u8fde\u63a5\u5bc6\u7801\uff0c\u4f7f\u7528ssh\u79d8\u94a5\u94fe\u63a5\u4e0d\u9700\u8981\u6253\u5f00\u6b64\u9879\u3002 ANSIBLE_TRANSPORT transport defaults smart \u9ed8\u8ba4\u8fde\u63a5\u63d2\u4ef6 ANSIBLE_REMOTE_PORT remote_port defaults integer None \u7528\u4e8e\u8fdc\u7a0b\u8fde\u63a5\u7684\u7aef\u53e3\uff0c\u4e3a\u7a7a\u65f6\uff0c\u5c06\u7528\u63d2\u4ef6\u9ed8\u8ba4\u503c ANSIBLE_MODULE_LANG module_lang defaults \u5728\u76ee\u6807\u4e0a\u6267\u884c\u65f6\u7528\u4e8e\u6a21\u5757\u7684\u8bed\u8a00\u533a\u57df\u8bbe\u7f6e\u3002 \u5982\u679c\u4e3a\u7a7a\uff0c\u5b83\u4f1a\u5c1d\u8bd5\u5c06\u5176\u81ea\u8eab\u8bbe\u7f6e\u4e3a\u63a7\u5236\u5668\u4e0a\u7684LANG\u73af\u5883\u53d8\u91cf\u3002\u4ec5\u5728module_set_locale\u4e3ature\u7684\u65f6\u5019\u3002 ANSIBLE_MODULE_SET_LOCALE module_set_locale defaults boolean False \u63a7\u5236\u5728\u76ee\u6807\u4e0a\u6267\u884c\u65f6\u662f\u5426\u4e3a\u6a21\u5757\u8bbe\u7f6e\u8bed\u8a00\u73af\u5883\u3002 ANSIBLE_GATHERING gathering defaults implicit \u662f\u5426\u6536\u96c6fact\u4fe1\u606f ANSIBLE_GATHER_SUBSET gather_subset defaults all \u8bbe\u7f6e\u6536\u96c6fact\u7684\u5206\u7ec4\u6a21\u5757 ANSIBLE_GATHER_TIMEOUT gather_timeout defaults integer 10 \u8bbe\u7f6e\u8d85\u65f6\u503c\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002 ANSIBLE_ROLES_PATH roles_path defaults pathspec ~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles \u641c\u7d22roles\u7684\u8def\u5f84 ANSIBLE_HOST_KEY_CHECKING host_key_checking defaults boolean True \u8fde\u63a5\u4e3b\u673a\u65f6\u662f\u5426\u8fdb\u884c\u4e3b\u673a\u5bc6\u94a5\u68c0\u67e5 ANSIBLE_STDOUT_CALLBACK stdout_callback defaults defaults \u8bbe\u7f6eansible\u663e\u793a\u8f93\u51fa\u7684callback\uff0c\u53ea\u80fd\u8bbe\u7f6e\u4e00\u4e2a\u3002 ANSIBLE_CALLBACK_WHITELIST callback_whitelist defaults list [] callback\u7684\u767d\u540d\u5355\u5217\u8868\uff0c\u53ea\u6709\u5728\u8fd9\u4e2a\u5217\u8868\u4e2d\uff0cansible\u624d\u4f1a\u4f7f\u7528\u3002 ANSIBLE_TASK_INCLUDES_STATIC task_includes_static defaults boolean False \u662f\u5426\u5c06include\u8bbe\u7f6e\u4e3a\u9759\u6001\u5305\u542b\u30022.8\u5e9f\u5f03 ANSIBLE_HANDLER_INCLUDES_STATIC handler_includes_static defaults boolean False \u662f\u5426\u5c06include\u8bbe\u7f6e\u4e3a\u9759\u6001\u5305\u542b\u30022.8\u5e9f\u5f03 ANSIBLE_ERROR_ON_MISSING_HANDLER error_on_missing_handler defaults boolean True \u662f\u5426\u5728handler\u7a0b\u5e8f\u7f3a\u5c11\u6216\u9519\u8bef\u7684\u65f6\u5019\uff0c\u63d0\u793a\u8b66\u544a\u800c\u4e0d\u662f\u9519\u8bef\u3002 ANSIBLE_SUDO_EXE sudo_exe defaults sudo \u6307\u5b9a\u4e00\u4e2a\u201csudo\u201d\u53ef\u6267\u884c\u6587\u4ef6\uff0c2.8\u5e9f\u5f03 ANSIBLE_SUDO_FLAGS sudo_flags defaults -H -S -n \u6307\u5b9asudo\u7684\u53c2\u6570\uff0c2.8\u5e9f\u5f03 ANSIBLE_TIMEOUT Timeout defaults integer 10 \u8fde\u63a5\u63d2\u4ef6\u4f7f\u7528\u7684\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\u3002 ANSIBLE_REMOTE_USER remote_user defaults None \u8bbe\u7f6e\u76ee\u6807\u7684\u767b\u5f55\u7528\u6237\uff0c\u5982\u679c\u4e3a\u7a7a\uff0c\u5219\u4e3a\u8fd0\u884cansible\u7684\u7528\u6237 ANSIBLE_LOG_PATH log_path defaults None \u5728\u63a7\u5236\u5668\u4e0a\u7684\u65e5\u5fd7\u6587\u4ef6\u8def\u5f84\uff0c\u7528\u4e8e\u8bb0\u5f55ansible\u8fd0\u884c\u7684\u65e5\u5fd7\u3002 module_name defaults command AdHoc\u547d\u4ee4\u4e00\u8d77\u4f7f\u7528\uff0c\u6ca1\u6709\u6307\u5b9a-m\u6a21\u5757\u7684\u5c31\u7528\u8fd9\u4e2a\u9ed8\u8ba4\u503c ANSIBLE_EXECUTABLE executable defaults /bin/sh \u5728\u8282\u70b9\u4e0a\uff0cansible\u6267\u884c\u7684shell\u89e3\u91ca\u5668\u3002 ANSIBLE_HASH_BEHAVIOUR hash_behaviour defaults string replace \u63a7\u5236Ansible\u4e2d\u7684\u53d8\u91cf\u5408\u5e76\u65b9\u5f0f\u3002 ANSIBLE_PRIVATE_ROLE_VARS private_role_vars defaults boolean False \u4f7f\u89d2\u8272\u53d8\u91cf\u65e0\u6cd5\u4ece\u5176\u4ed6\u89d2\u8272\u8bbf\u95ee\u3002 ANSIBLE_JINJA2_EXTENSIONS jinja2_extensions defaults [] \u542f\u7528\u989d\u5916\u7684Jinja2\u6269\u5c55\u5217\u8868 ANSIBLE_PRIVATE_KEY_FILE private_key_file defaults None \u8fde\u63a5\u8bc1\u4e66\u6216\u5bc6\u7801\uff0c-private-key\u7684\u9ed8\u8ba4\u503c ANSIBLE_VAULT_PASSWORD_FILE vault_password_file defaults path None \u8981\u4f7f\u7528\u7684vault\u5bc6\u7801\u6587\u4ef6\u3002 \u7b49\u540c\u4e8e-vault-password-file\u6216-vault-id ansible_managed defaults Ansible managed \u5728\u6a21\u677fansible_managed\u7684\u503c DISPLAY_SKIPPED_HOSTS display_skipped_hosts defaults boolean True \u5728\u9ed8\u8ba4callback\u63d2\u4ef6\u4e2d\u662f\u5426\u663e\u793a\u8df3\u8fc7\u7684\u4e3b\u673a\u4fe1\u606f\u3002 ANSIBLE_DISPLAY_ARGS_TO_STDOUT display_args_to_stdout defaults boolean False \u662f\u5426\u5728callback\u4e2d\u663e\u793a\u4efb\u52a1\u7684\u53c2\u6570\u4fe1\u606f ANSIBLE_ERROR_ON_UNDEFINED_VARS error_on_undefined_vars defaults boolean True \u6a21\u677f\u4e2d\u51fa\u73b0\u9519\u8bef\u6216\u672a\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u662f\u5426\u63d0\u793a\u9519\u8bef\u4fe1\u606f\u3002 ANSIBLE_SYSTEM_WARNINGS system_warnings defaults boolean True \u662f\u5426\u663e\u793a\u7cfb\u7edf\u8b66\u544a\u4fe1\u606f\u3002 ANSIBLE_DEPRECATION_WARNINGS deprecation_warnings defaults boolean True \u662f\u5426\u663e\u793a\u6a21\u5757\u88ab\u5f03\u7528\u7684\u8b66\u544a\u4fe1\u606f\u3002 ANSIBLE_COMMAND_WARNINGS command_warnings defaults boolean True \u662f\u5426\u663e\u793a\uff0c\u5728shell\u548ccommand\u6a21\u5757\u4e2d\u4f7f\u7528\u4e0eansible\u6a21\u5757\u7c7b\u4f3c\u7684\u8b66\u544a\u4fe1\u606f\u3002 ANSIBLE_ACTION_PLUGINS action_plugins defaults pathspec ~/.ansible/plugins/action:/usr/share/ansible/plugins/action action\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_CACHE_PLUGINS cache_plugins defaults pathspec ~/.ansible/plugins/cache:/usr/share/ansible/plugins/cache cache\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_CALLBACK_PLUGINS callback_plugins defaults pathspec ~/.ansible/plugins/callback:/usr/share/ansible/plugins/callback callback\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_CONNECTION_PLUGINS connection_plugins defaults pathspec ~/.ansible/plugins/connection:/usr/share/ansible/plugins/connection connection\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_LOOKUP_PLUGINS lookup_plugins defaults pathspec ~/.ansible/plugins/lookup:/usr/share/ansible/plugins/lookup lookup\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_INVENTORY_PLUGINS inventory_plugins defaults pathspec ~/.ansible/plugins/inventory:/usr/share/ansible/plugins/inventory inventory\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_VARS_PLUGINS vars_plugins defaults pathspec ~/.ansible/plugins/vars:/usr/share/ansible/plugins/vars vars\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_FILTER_PLUGINS filter_plugins defaults pathspec ~/.ansible/plugins/filter:/usr/share/ansible/plugins/filter filter\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_TEST_PLUGINS test_plugins defaults pathspec ~/.ansible/plugins/test:/usr/share/ansible/plugins/test test\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_TERMINAL_PLUGINS terminal_plugins defaults pathspec ~/.ansible/plugins/terminal:/usr/share/ansible/plugins/terminal terminal\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_STRATEGY_PLUGINS strategy_plugins defaults pathspec ~/.ansible/plugins/strategy:/usr/share/ansible/plugins/strategy strategy\u63d2\u4ef6\u7684\u641c\u7d22\u8def\u5f84 ANSIBLE_STRATEGY strategy defaults linear \u9ed8\u8ba4\u7b56\u7565 ANSIBLE_LOAD_CALLBACK_PLUGINS bin_ansible_callbacks defaults boolean False \u63a7\u5236\u8fd0\u884cansible\u65f6\uff0c\u662f\u5426\u52a0\u8f7dcallback\u63d2\u4ef6 ANSIBLE_CACHE_PLUGIN fact_caching defaults memory \u9009\u62e9\u4f7f\u7528\u54ea\u4e2a\u7f13\u5b58\u63d2\u4ef6\u4e3afact\u5b58\u50a8\u6240\u7528 ANSIBLE_CACHE_PLUGIN_CONNECTION fact_caching_connection defaults none \u5b9a\u4e49\u7f13\u5b58\u63d2\u4ef6\u7684\u8fde\u63a5 ANSIBLE_CACHE_PLUGIN_PREFIX fact_caching_prefix defaults ansible_facts \u7f13\u5b58\u63d2\u4ef6\u6587\u4ef6/\u8868\u7684\u524d\u7f00 ANSIBLE_CACHE_PLUGIN_TIMEOUT fact_caching_timeout defaults integer 86400 \u7f13\u5b58\u63d2\u4ef6\u6570\u636e\u7684\u8fc7\u671f\u8d85\u65f6\u65f6\u95f4 ANSIBLE_RETRY_FILES_ENABLED retry_files_enabled defaults boolean True \u63a7\u5236\u7740\u4e00\u4e2a\u5931\u8d25\u7684Ansible\u5267\u672c\u5e94\u8be5\u521b\u5efa\u4e00\u4e2a.retry\u6587\u4ef6\u3002 ANSIBLE_RETRY_FILES_SAVE_PATH retry_files_save_path defaults path none \u4fdd\u5b58.retry\u6587\u4ef6\u7684\u8def\u5f84\u3002 ANSIBLE_SQUASH_ACTIONS squash_actions defaults list apk, apt, dnf, homebrew, openbsd_pkg, pacman, pkgng, yum, zypper \u5728\u4f7f\u7528with_\u5faa\u73af\u65f6\uff0cAnsible\u53ef\u4ee5\u4f18\u5316\u8c03\u7528\u652f\u6301\u5217\u8868\u53c2\u6570\u7684\u6a21\u5757\u7684\u64cd\u4f5c\u3002\u4f7f\u53c2\u6570\u7ec4\u5408\u4e3a\u4e00\u4e2a\u5217\u8868\u4f20\u9012\u7ed9\u6a21\u5757\u3002 ANSIBLE_NO_LOG no_log defaults boolean False \u63a7\u5236Ansible\u7684\u663e\u793a\u548c\u8bb0\u5f55\u4efb\u52a1\u4fe1\u606f\u65e5\u5fd7\u3002 ANSIBLE_NO_TARGET_SYSLOG no_target_syslog defaults boolean False \u6267\u884c\u4efb\u52a1\u65f6\uff0cAnsible\u65e5\u5fd7\u662f\u5426\u663e\u793a\u5728\u76ee\u6807\u7cfb\u7edf\u65e5\u5fd7\u3002 module_compression defaults ZIP_DEFLATED \u5c06Python\u6a21\u5757\u4f20\u8f93\u5230\u76ee\u6807\u65f6\u4f7f\u7528\u7684\u538b\u7f29\u65b9\u6848\u3002 ANSIBLE_MAX_DIFF_SIZE max_diff_size defaults int 104448 \u8981\u663e\u793a\u5dee\u5f02\u6587\u4ef6\u7684\u6700\u5927\u6587\u4ef6\u5927\u5c0f ANSIBLE_SHOW_CUSTOM_STATS show_custom_stats defaults boolean False \u662f\u5426\u901a\u8fc7set_stats\u63d2\u4ef6\u8bbe\u7f6e\u7684\u81ea\u5b9a\u4e49\u7edf\u8ba1\u4fe1\u606f\u6dfb\u52a0\u5230\u9ed8\u8ba4\u8f93\u51fa ANSIBLE_INVENTORY_IGNORE inventory_ignore_extensions defaults {{(BLACKLIST_EXTS + ( \u2018~ , \u2018.orig , \u2018.ini , \u2018.cfg , \u2018.retry`))}} \u5c06\u76ee\u5f55\u7528\u4f5c\u5e93\u5b58\u6e90\u65f6\u5ffd\u7565\u7684\u6269\u5c55\u540d\u5217\u8868 allow_unsafe_lookups defaults boolean False \u4e3aTrue\u65f6\uff0c\u6b64\u9009\u9879\u5141\u8bb8\u67e5\u627e\u63d2\u4ef6\uff08\u65e0\u8bba\u5728\u53d8\u91cf\u4e2d\u7528\u4f5c ANSIBLE_INVENTORY_ENABLED enable_plugins inventory [\u2018host_list , \u2018script , \u2018yaml , \u2018ini , \u2018auto`] \u542f\u7528\u7684\u5e93\u5b58\u63d2\u4ef6\u5217\u8868\uff0c\u4e5f\u51b3\u5b9a\u4e86\u5b83\u4eec\u7684\u4f7f\u7528\u987a\u5e8f\u3002 ANSIBLE_INVENTORY_IGNORE ignore_extensions inventory {{(BLACKLIST_EXTS + ( \u2018~ , \u2018.orig , \u2018.ini , \u2018.cfg , \u2018.retry`))}} \u5c06\u76ee\u5f55\u7528\u4f5c\u5e93\u5b58\u6e90\u65f6\u5ffd\u7565\u7684\u6269\u5c55\u540d\u5217\u8868 ANSIBLE_INVENTORY_IGNORE_REGEX ignore_patterns inventory list [] \u5c06\u76ee\u5f55\u7528\u4f5c\u5e93\u5b58\u6e90\u65f6\u8981\u5ffd\u7565\u7684\u6a21\u5f0f\u5217\u8868 ANSIBLE_INVENTORY_UNPARSED_FAILED unparsed_is_failed inventory boolean False \u4e3atrue\u65f6\uff0c\u672a\u5206\u7c7b\u7684\u4e3b\u673a\u4f1a\u63d0\u793a\u81f4\u547d\u9519\u8bef\u3002 ANSIBLE_BECOME become privilege_escalation boolean False \u662f\u5426\u5f00\u542f\u7279\u6743\u5347\u7ea7 ANSIBLE_BECOME_METHOD become_method privilege_escalation sudo \u7279\u6743\u5347\u7ea7\u7684\u65b9\u5f0f ANSIBLE_BECOME_USER become_user privilege_escalation root \u7279\u6743\u5347\u7ea7\u7684\u7528\u6237 ANSIBLE_BECOME_ASK_PASS become_ask_pass privilege_escalation boolean False \u8f93\u5165\u7279\u6743\u5347\u7ea7\u7684\u5bc6\u7801 ANSIBLE_BECOME_FLAGS become_flags privilege_escalation \u4f20\u9012\u7ed9\u7279\u6743\u5347\u7ea7\u53ef\u6267\u884c\u6587\u4ef6\u7684\u53c2\u6570\u3002 ANSIBLE_BECOME_EXE become_exe privilege_escalation None \u53ef\u6267\u884c\u6587\u4ef6 ANSIBLE_PARAMIKO_LOOK_FOR_KEYS look_for_keys paramiko_connection boolean True paramiko\u5728\u5c1d\u8bd5\u5411\u8fdc\u7a0b\u8bbe\u5907\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u65f6\u9ed8\u8ba4\u67e5\u627eSSH\u5bc6\u94a5\u3002 ANSIBLE_PARAMIKO_HOST_KEY_AUTO_ADD host_key_auto_add paramiko_connection boolean False \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAnsible\u5c06\u63d0\u793a\u6dfb\u52a0\u4e3b\u673a\u5bc6\u94a5\u3002 \u8fd9\u5c06\u5bfc\u81f4\u5728\u540e\u53f0\u8fdb\u7a0b\u4e2d\u8fd0\u884c\u7684\u8fde\u63a5\u5931\u8d25\u3002\u4e3atrue\u65f6\uff0cParamiko\u81ea\u52a8\u6dfb\u52a0\u4e3b\u673a\u5bc6\u94a5\u3002 ANSIBLE_SCP_IF_SSH scp_if_ssh ssh_connection smart \u901a\u8fc7ssh\u4f20\u8f93\u6587\u4ef6\u65f6\u4f7f\u7528\u7684\u9996\u9009\u65b9\u6cd5\uff0c\u4f7f\u7528smart\u65f6\uff0c\u5148\u5c1d\u8bd5sftp\uff0c\u5728\u5c1d\u8bd5scp\u3002 ANSIBLE_SSH_TRANSFER_METHOD transfer_method ssh_connection None \u901a\u8fc7ssh\u4f20\u8f93\u6587\u4ef6\u65f6\u4f7f\u7528\u7684\u9996\u9009\u65b9\u6cd5\uff0c\u5982\u679c\u914d\u7f6e\u4e86\uff0c\u4f1a\u8986\u76d6scp_if_ssh ANSIBLE_SFTP_BATCH_MODE sftp_batch_mode ssh_connection boolean True \u5982\u679c\u4e3aFalse\uff0csftp\u5c06\u4e0d\u4f7f\u7528\u6279\u5904\u7406\u6a21\u5f0f\u4f20\u8f93\u6587\u4ef6\u3002 ANSIBLE_PERSISTENT_CONNECT_TIMEOUT connect_timeout persistent_connection integer 30 \u63a7\u5236\u8fde\u63a5\u4fdd\u6301\u7a7a\u95f2\u72b6\u6001\u7684\u65f6\u95f4\u3002 ANSIBLE_PERSISTENT_CONNECT_RETRY_TIMEOUT connect_retry_timeout persistent_connection integer 15 \u63a7\u5236\u8fde\u63a5\u91cd\u8bd5\u8d85\u65f6\u65f6\u95f4 ANSIBLE_PERSISTENT_CONNECT_TIMEOUT command_timeout persistent_connection integer 30 \u63a7\u5236\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 ANSIBLE_SELINUX_SPECIAL_FS special_context_filesystems selinux list fuse, nfs, vboxsf, ramfs, 9p, vfat \u5728\u5904\u7406\u5b89\u5168\u4e0a\u4e0b\u6587\u65f6\u9700\u8981\u7279\u6b8a\u5904\u7406\u7684\u6587\u4ef6\u7cfb\u7edf LIBVIRT_LXC_NOSECLABEL libvirt_lxc_noseclabel selinux boolean False \u901a\u8fc7\u5c06-noseclabel\u4f20\u9012\u7ed9virsh\uff0c\u5141\u8bb8libvirt_lxc\u8fde\u63a5\u5728\u6ca1\u6709SELinux\u7684\u60c5\u51b5\u4e0b\u5de5\u4f5c\u3002 ANSIBLE_COLOR_HIGHLIGHT highlight colors white \u5b9a\u4e49\u7528\u4e8e\u7a81\u51fa\u663e\u793a\u7684\u989c\u8272 ANSIBLE_COLOR_VERBOSE verbose colors blue \u5b9a\u4e49\u53d1\u51fa\u8be6\u7ec6\u6d88\u606f\u65f6\u8981\u4f7f\u7528\u7684\u989c\u8272\u3002 \u5373\u90a3\u4e9b\u7528'-v'\u8868\u793a\u7684\u3002 ANSIBLE_COLOR_WARN warn colors bright purple \u5b9a\u4e49\u53d1\u51fa\u8b66\u544a\u6d88\u606f\u65f6\u8981\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_ERROR error colors red \u5b9a\u4e49\u53d1\u51fa\u9519\u8bef\u6d88\u606f\u65f6\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_DEBUG debug colors dark gray \u5b9a\u4e49\u53d1\u51fa\u8c03\u8bd5\u6d88\u606f\u65f6\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_DEPRECATE deprecate colors purple \u5b9a\u4e49\u53d1\u51fa\u5f03\u7528\u6d88\u606f\u65f6\u8981\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_UNREACHABLE unreachable colors bright red \u5b9a\u4e49\u5728\u201c\u65e0\u6cd5\u5230\u8fbe\u201d\u72b6\u6001\u4e0b\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_CHANGED changed colors yellow \u5b9a\u4e49\u5728\u201c\u66f4\u6539\u201d\u4efb\u52a1\u72b6\u6001\u4e0a\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_DIFF_ADD diff_add colors green \u5b9a\u4e49\u5728\u5dee\u5f02\u4e2d\u663e\u793a\u6dfb\u52a0\u884c\u65f6\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_DIFF_REMOVE diff_remove colors red \u5b9a\u4e49\u5728\u5dee\u5f02\u4e2d\u663e\u793a\u5df2\u5220\u9664\u884c\u65f6\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_COLOR_DIFF_LINES diff_lines colors cyan \u5b9a\u4e49\u663e\u793a\u5dee\u5f02\u65f6\u4f7f\u7528\u7684\u989c\u8272 ANSIBLE_DIFF_ALWAYS always diff boolean False \u662f\u5426\u663e\u793a\u6a21\u5757\u5728\u5904\u4e8e\u201c\u66f4\u6539\u201d\u72b6\u6001\u65f6\u663e\u793a\u5dee\u5f02\uff0c\u76f8\u5f53\u4e8e--diff\u3002 ANSIBLE_DIFF_CONTEXT context diff integer 3 \u5728\u663e\u793a\u6587\u4ef6\u4e4b\u95f4\u7684\u5dee\u5f02\u65f6\u663e\u793a\u591a\u5c11\u884c\u4e0a\u4e0b\u6587\u3002 ANSIBLE_YAML_FILENAME_EXT yaml_valid_extensions defaults List [ .yml , .yaml , .json ] yaml\u6587\u4ef6\u7684\u6269\u5c55\u540d \u8be6\u7ec6\u89c1 \u5b98\u7f51","title":"\u914d\u7f6e\u9879"},{"location":"basic/Reference/Keywords/","text":"Ansible \u5173\u952e\u5b57 \u00b6 ansible 2.9 \u8fd9\u4e9b\u662f\u5e38\u89c1\u5267\u672c\u5bf9\u8c61\u4e0a\u53ef\u7528\u7684\u5173\u952e\u5b57\u3002 Play \u00b6 \u5728 play \u4e0b\u53ef\u7528\u7684\u5173\u952e\u5b57 key desc any_errors_fatal \u6709\u4efb\u52a1\u9519\u8bef\u65f6\uff0c\u7acb\u5373\u505c\u6b62 become \u662f\u5426\u63d0\u6743 become_exe become_flags \u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570 become_method \u63d0\u6743\u5f97\u65b9\u5f0f become_user \u63d0\u6743\u7684\u7528\u6237 check_mode \u5f53\u4e3a True \u65f6\uff0c\u53ea\u68c0\u67e5\uff0c\u4e0d\u505a\u4fee\u6539 collections connection \u8fde\u63a5\u65b9\u5f0f debugger \u5f00\u542f debugger \u6a21\u5f0f diff \u5bf9\u6bd4\u66f4\u6539\u7684\u6587\u4ef6 environment \u5b9a\u4e49\u8fdc\u7aef\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf fact_path \u6307\u5b9a\u5b58\u50a8 fact \u7684\u76ee\u5f55 force_handlers \u4efb\u52a1\u5931\u8d25\u540e\uff0c\u662f\u5426\u4f9d\u7136\u6267\u884c handlers \u4e2d\u7684\u4efb\u52a1 gather_facts \u662f\u5426\u83b7\u53d6\u8fdc\u7aef\u7cfb\u7edf\u5f97 facts gather_subset \u83b7\u53d6 facts \u5f97\u54ea\u4e9b\u952e\u503c gather_timeout \u83b7\u53d6 facts \u7684\u8d85\u65f6\u65f6\u95f4 handlers \u5b9a\u4e49 task \u6267\u884c\u5b8c\u6210\u4ee5\u540e\u9700\u8981\u8c03\u7528\u7684\u4efb\u52a1 hosts \u6307\u5b9a\u8fd0\u884c\u5f97\u4e3b\u673a ignore_errors \u5e03\u5c14\u503c\uff0c\u662f\u5426\u5ffd\u7565\u9519\u8bef ignore_unreachable \u5e03\u5c14\u503c\uff0c\u53ef\u4ee5\u5ffd\u7565\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u5e76\u7ee7\u7eed max_fail_percentage \u5355\u4f4d\u767e\u5206\u6bd4\u3002\u6700\u5927\u7684\u9519\u8bef\u4e3b\u673a\u6570\uff0c\u8d85\u8fc7\u5219\u7acb\u5373\u505c\u6b62 ansbile module_defaults \u6307\u5b9a\u6a21\u5757\u7684\u9ed8\u8ba4\u53c2\u6570\u503c\u3002 name \u5b9a\u4e49\u540d\u79f0 no_log \u4e0d\u8bb0\u5f55\u65e5\u5fd7 order \u6267\u884c\u4e3b\u673a\u7684\u987a\u5e8f port \u5b9a\u4e49 ssh \u7684\u8fde\u63a5\u7aef\u53e3 post_tasks \u6267\u884c\u4efb\u52a1\u540e\u8981\u6267\u884c\u7684\u4efb\u52a1 pre_tasks \u6267\u884c\u4efb\u52a1\u524d\u8981\u6267\u884c\u7684\u4efb\u52a1 remote_user \u8fdc\u7a0b\u767b\u9646\u7684\u7528\u6237 roles \u5b9a\u4e49\u89d2\u8272 run_once \u4efb\u52a1\u53ea\u8fd0\u884c\u4e00\u6b21 serial \u4efb\u52a1\u6bcf\u6b21\u6267\u884c\u7684\u4e3b\u673a\u6570 strategy play \u8fd0\u884c\u7b56\u7565 tags \u6807\u8bb0\u6807\u7b7e tasks \u5b9a\u4e49\u4efb\u52a1 throttle \u9650\u5236\u5e76\u53d1\u4efb\u52a1\u5728 tasks\uff0cblocks \u548c playbook \u7ea7\u522b\u4e0a\u8fd0\u884c\u7684\u6570\u91cf\u3002\u4e0d\u80fd\u9ad8\u4e8e serial \u548c forks \u6570 vars \u5b9a\u4e49\u53d8\u91cf vars_files \u5305\u542b\u53d8\u91cf\u6587\u4ef6 vars_prompt \u8981\u6c42\u7528\u6237\u8f93\u5165\u5185\u5bb9 Role \u00b6 \u5728 role \u4e0b\u53ef\u7528\u7684\u5173\u952e\u5b57 key desc any_errors_fatal \u6709\u4efb\u52a1\u9519\u8bef\u65f6\uff0c\u7acb\u5373\u505c\u6b62 become \u662f\u5426\u63d0\u6743 become_exe become_flags \u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570 become_method \u63d0\u6743\u7684\u65b9\u5f0f become_user \u63d0\u6743\u7684\u7528\u6237 check_mode \u5f53\u4e3a True \u65f6\uff0c\u53ea\u68c0\u67e5\uff0c\u4e0d\u505a\u4fee\u6539 collections connection \u8fde\u63a5\u65b9\u5f0f debugger \u5f00\u542f debugger \u6a21\u5f0f delegate_facts \u59d4\u6258 facts delegate_to \u4efb\u52a1\u59d4\u6d3e diff \u5bf9\u6bd4\u66f4\u6539\u7684\u6587\u4ef6 environment \u5b9a\u4e49\u8fdc\u7aef\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf ignore_errors \u662f\u5426\u5ffd\u7565\u9519\u8bef ignore_unreachable \u5e03\u5c14\u503c\uff0c\u53ef\u4ee5\u5ffd\u7565\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u5e76\u7ee7\u7eed module_defaults \u6307\u5b9a\u6a21\u5757\u7684\u9ed8\u8ba4\u53c2\u6570\u503c\u3002 name \u5b9a\u4e49\u4efb\u52a1\u5f97\u540d\u79f0 no_log \u4e0d\u8bb0\u5f55\u65e5\u5fd7 port \u5b9a\u4e49 ssh \u7684\u8fde\u63a5\u7aef\u53e3 remote_user \u8fdc\u7aef\u7cfb\u7edf\u7684\u6267\u884c\u7528\u6237 run_once \u53ea\u8fd0\u884c\u4e00\u6b21 tags \u6807\u8bb0\u6807\u7b7e throttle \u9650\u5236\u5e76\u53d1\u4efb\u52a1\u5728 tasks\uff0cblocks \u548c playbook \u7ea7\u522b\u4e0a\u8fd0\u884c\u7684\u6570\u91cf\u3002\u4e0d\u80fd\u9ad8\u4e8e serial \u548c forks \u6570 vars \u5b9a\u4e49\u53d8\u91cf when \u6761\u4ef6\u8868\u8fbe\u5f0f\u7ed3\u679c\u4e3a True \u5219\u6267\u884c block Block \u00b6 \u5728 block \u4e0b\u53ef\u7528\u7684\u5173\u952e\u5b57 key desc always Block \u4e2d\u6267\u884c\u7684\u4efb\u52a1\u5217\u8868\uff0c\u65e0\u8bba\u662f\u5426\u5b58\u5728\u9519\u8bef\u90fd\u4f1a\u6267\u884c\u3002 any_errors_fatal \u6709\u9519\u8bef\u65f6\u7acb\u5373\u4e2d\u65ad ansbile become \u662f\u5426\u63d0\u6743 become_exe become_flags \u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570 become_method \u63d0\u6743\u7684\u65b9\u5f0f become_user \u63d0\u6743\u7684\u7528\u6237 block \u5206\u7ec4\u91cc\u7684\u4efb\u52a1\u5217\u8868 check_mode \u5f53\u4e3a True \u65f6\uff0c\u53ea\u68c0\u67e5\uff0c\u4e0d\u505a\u4fee\u6539 collections connection \u8fde\u63a5\u65b9\u5f0f debugger \u5f00\u542f debugger \u6a21\u5f0f delegate_facts \u5e03\u5c14\u503c\uff0c\u5c06 facts \u5e94\u7528\u4e8e\u59d4\u6d3e\u7684\u4e3b\u673a\u3002 delegate_to \u4efb\u52a1\u59d4\u6d3e diff \u5bf9\u6bd4\u66f4\u6539\u7684\u6587\u4ef6 environment \u5b9a\u4e49\u8fdc\u7aef\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf ignore_errors \u662f\u5426\u5ffd\u7565\u9519\u8bef ignore_unreachable \u5e03\u5c14\u503c\uff0c\u53ef\u4ee5\u5ffd\u7565\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u5e76\u7ee7\u7eed module_defaults \u6307\u5b9a\u6a21\u5757\u7684\u9ed8\u8ba4\u53c2\u6570\u503c\u3002 name \u5b9a\u4e49 block \u540d\u79f0 no_log \u4e0d\u8bb0\u5f55\u65e5\u5fd7 port \u5b9a\u4e49 ssh \u7684\u8fde\u63a5\u7aef\u53e3 remote_user \u8fdc\u7aef\u7cfb\u7edf\u7684\u6267\u884c\u7528\u6237 rescue block \u4e2d\u7684\u4efb\u52a1\u5728\u6267\u884c\u4e2d\uff0c\u5982\u679c\u6709\u4efb\u4f55\u9519\u8bef\uff0c\u5c06\u6267\u884c rescue \u4e2d\u7684\u4efb\u52a1\u3002 run_once \u53ea\u8fd0\u884c\u4e00\u6b21 tags \u6807\u8bb0\u6807\u7b7e throttle \u9650\u5236\u5e76\u53d1\u4efb\u52a1\u5728 tasks\uff0cblocks \u548c playbook \u7ea7\u522b\u4e0a\u8fd0\u884c\u7684\u6570\u91cf\u3002\u4e0d\u80fd\u9ad8\u4e8e serial \u548c forks \u6570 vars \u5b9a\u4e49\u53d8\u91cf when \u6761\u4ef6\u8868\u8fbe\u5f0f\u7ed3\u679c\u4e3a True \u5219\u6267\u884c block Task \u00b6 \u5728 task \u4e0b\u53ef\u7528\u7684\u5173\u952e\u5b57 key desc action \u6267\u884c\u52a8\u4f5c any_errors_fatal \u4e3a True \u65f6\uff0c\u53ea\u8981\u4efb\u52a1\u6709\u9519\u8bef\uff0c\u5c31\u7acb\u5373\u505c\u6b62 ansible args \u5b9a\u4e49\u4efb\u52a1\u5f97\u53c2\u6570 async \u662f\u5426\u5f02\u6b65\u6267\u884c\u4efb\u52a1 become \u662f\u5426\u63d0\u6743 become_exe become_flags \u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570 become_method \u63d0\u6743\u7684\u65b9\u5f0f become_user \u63d0\u6743\u7684\u7528\u6237 changed_when \u6761\u4ef6\u8868\u8fbe\u5f0f\u4e3a True \u65f6\uff0c\u4f7f\u4efb\u52a1\u72b6\u6001\u4e3a changed check_mode \u4e3a True \u65f6\uff0c\u53ea\u68c0\u67e5\u8fd0\u884c\u72b6\u6001\uff0c\u5728\u8fdc\u7aef\u4e0d\u505a\u4efb\u4f55\u4fee\u6539 collections connection \u8fde\u63a5\u65b9\u5f0f debugger \u5f00\u542f debugger \u6a21\u5f0f delay \u7b49\u5f85\u591a\u5c11\u79d2\uff0c\u624d\u6267\u884c\u4efb\u52a1 delegate_facts \u5e03\u5c14\u503c\uff0c\u5c06 facts \u5e94\u7528\u4e8e\u59d4\u6d3e\u7684\u4e3b\u673a\u3002 delegate_to \u4efb\u52a1\u59d4\u6d3e diff \u5bf9\u6bd4\u66f4\u6539\u7684\u6587\u4ef6 environment \u5b9a\u4e49\u8fdc\u7aef\u7684\u73af\u5883\u53d8\u91cf failed_when \u6761\u4ef6\u8868\u8fbe\u5f0f\u4e3a True \u65f6\uff0c\u4f7f\u4efb\u52a1\u4e3a\u5931\u8d25\u72b6\u6001 ignore_errors \u662f\u5426\u5ffd\u7565\u9519\u8bef ignore_unreachable \u5e03\u5c14\u503c\uff0c\u53ef\u4ee5\u5ffd\u7565\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u5e76\u7ee7\u7eed local_action \u672c\u5730\u6267\u884c loop \u5faa\u73af loop_control \u6539\u53d8\u5faa\u73af\u7684\u53d8\u91cf\u9879 module_defaults \u6307\u5b9a\u6a21\u5757\u7684\u9ed8\u8ba4\u53c2\u6570\u503c\u3002 name \u5b9a\u4e49\u540d\u79f0 no_log \u4e0d\u8bb0\u5f55\u65e5\u5fd7 notify \u7528\u4e8e\u4efb\u52a1\u6267\u884c\u5b8c\uff0c\u6267\u884c handlers \u91cc\u7684\u4efb\u52a1 poll \u8f6e\u8be2\u65f6\u95f4 port \u5b9a\u4e49 ssh \u7684\u8fde\u63a5\u7aef\u53e3 register \u6ce8\u518c\u53d8\u91cf remote_user \u8fdc\u7aef\u7cfb\u7edf\u7684\u6267\u884c\u7528\u6237 retries \u91cd\u8bd5\u6b21\u6570 run_once \u53ea\u8fd0\u884c\u4e00\u6b21 tags \u6807\u8bb0\u4e3a\u6807\u7b7e throttle \u9650\u5236\u5e76\u53d1\u4efb\u52a1\u5728 tasks\uff0cblocks \u548c playbook \u7ea7\u522b\u4e0a\u8fd0\u884c\u7684\u6570\u91cf\u3002\u4e0d\u80fd\u9ad8\u4e8e serial \u548c forks \u6570 until \u76f4\u5230\u4e3a\u771f\u65f6\uff0c\u624d\u7ee7\u7eed\u6267\u884c\u4efb\u52a1 vars \u5b9a\u4e49\u53d8\u91cf when \u6761\u4ef6\u8868\u8fbe\u5f0f\uff0c\u7ed3\u679c\u4e3a True \u5219\u6267\u884c task with_ \u5faa\u73af\u63d2\u4ef6","title":"3. \u5173\u952e\u5b57\u4f7f\u7528"},{"location":"basic/Reference/Keywords/#ansible","text":"ansible 2.9 \u8fd9\u4e9b\u662f\u5e38\u89c1\u5267\u672c\u5bf9\u8c61\u4e0a\u53ef\u7528\u7684\u5173\u952e\u5b57\u3002","title":"Ansible \u5173\u952e\u5b57"},{"location":"basic/Reference/Keywords/#play","text":"\u5728 play \u4e0b\u53ef\u7528\u7684\u5173\u952e\u5b57 key desc any_errors_fatal \u6709\u4efb\u52a1\u9519\u8bef\u65f6\uff0c\u7acb\u5373\u505c\u6b62 become \u662f\u5426\u63d0\u6743 become_exe become_flags \u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570 become_method \u63d0\u6743\u5f97\u65b9\u5f0f become_user \u63d0\u6743\u7684\u7528\u6237 check_mode \u5f53\u4e3a True \u65f6\uff0c\u53ea\u68c0\u67e5\uff0c\u4e0d\u505a\u4fee\u6539 collections connection \u8fde\u63a5\u65b9\u5f0f debugger \u5f00\u542f debugger \u6a21\u5f0f diff \u5bf9\u6bd4\u66f4\u6539\u7684\u6587\u4ef6 environment \u5b9a\u4e49\u8fdc\u7aef\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf fact_path \u6307\u5b9a\u5b58\u50a8 fact \u7684\u76ee\u5f55 force_handlers \u4efb\u52a1\u5931\u8d25\u540e\uff0c\u662f\u5426\u4f9d\u7136\u6267\u884c handlers \u4e2d\u7684\u4efb\u52a1 gather_facts \u662f\u5426\u83b7\u53d6\u8fdc\u7aef\u7cfb\u7edf\u5f97 facts gather_subset \u83b7\u53d6 facts \u5f97\u54ea\u4e9b\u952e\u503c gather_timeout \u83b7\u53d6 facts \u7684\u8d85\u65f6\u65f6\u95f4 handlers \u5b9a\u4e49 task \u6267\u884c\u5b8c\u6210\u4ee5\u540e\u9700\u8981\u8c03\u7528\u7684\u4efb\u52a1 hosts \u6307\u5b9a\u8fd0\u884c\u5f97\u4e3b\u673a ignore_errors \u5e03\u5c14\u503c\uff0c\u662f\u5426\u5ffd\u7565\u9519\u8bef ignore_unreachable \u5e03\u5c14\u503c\uff0c\u53ef\u4ee5\u5ffd\u7565\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u5e76\u7ee7\u7eed max_fail_percentage \u5355\u4f4d\u767e\u5206\u6bd4\u3002\u6700\u5927\u7684\u9519\u8bef\u4e3b\u673a\u6570\uff0c\u8d85\u8fc7\u5219\u7acb\u5373\u505c\u6b62 ansbile module_defaults \u6307\u5b9a\u6a21\u5757\u7684\u9ed8\u8ba4\u53c2\u6570\u503c\u3002 name \u5b9a\u4e49\u540d\u79f0 no_log \u4e0d\u8bb0\u5f55\u65e5\u5fd7 order \u6267\u884c\u4e3b\u673a\u7684\u987a\u5e8f port \u5b9a\u4e49 ssh \u7684\u8fde\u63a5\u7aef\u53e3 post_tasks \u6267\u884c\u4efb\u52a1\u540e\u8981\u6267\u884c\u7684\u4efb\u52a1 pre_tasks \u6267\u884c\u4efb\u52a1\u524d\u8981\u6267\u884c\u7684\u4efb\u52a1 remote_user \u8fdc\u7a0b\u767b\u9646\u7684\u7528\u6237 roles \u5b9a\u4e49\u89d2\u8272 run_once \u4efb\u52a1\u53ea\u8fd0\u884c\u4e00\u6b21 serial \u4efb\u52a1\u6bcf\u6b21\u6267\u884c\u7684\u4e3b\u673a\u6570 strategy play \u8fd0\u884c\u7b56\u7565 tags \u6807\u8bb0\u6807\u7b7e tasks \u5b9a\u4e49\u4efb\u52a1 throttle \u9650\u5236\u5e76\u53d1\u4efb\u52a1\u5728 tasks\uff0cblocks \u548c playbook \u7ea7\u522b\u4e0a\u8fd0\u884c\u7684\u6570\u91cf\u3002\u4e0d\u80fd\u9ad8\u4e8e serial \u548c forks \u6570 vars \u5b9a\u4e49\u53d8\u91cf vars_files \u5305\u542b\u53d8\u91cf\u6587\u4ef6 vars_prompt \u8981\u6c42\u7528\u6237\u8f93\u5165\u5185\u5bb9","title":"Play"},{"location":"basic/Reference/Keywords/#role","text":"\u5728 role \u4e0b\u53ef\u7528\u7684\u5173\u952e\u5b57 key desc any_errors_fatal \u6709\u4efb\u52a1\u9519\u8bef\u65f6\uff0c\u7acb\u5373\u505c\u6b62 become \u662f\u5426\u63d0\u6743 become_exe become_flags \u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570 become_method \u63d0\u6743\u7684\u65b9\u5f0f become_user \u63d0\u6743\u7684\u7528\u6237 check_mode \u5f53\u4e3a True \u65f6\uff0c\u53ea\u68c0\u67e5\uff0c\u4e0d\u505a\u4fee\u6539 collections connection \u8fde\u63a5\u65b9\u5f0f debugger \u5f00\u542f debugger \u6a21\u5f0f delegate_facts \u59d4\u6258 facts delegate_to \u4efb\u52a1\u59d4\u6d3e diff \u5bf9\u6bd4\u66f4\u6539\u7684\u6587\u4ef6 environment \u5b9a\u4e49\u8fdc\u7aef\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf ignore_errors \u662f\u5426\u5ffd\u7565\u9519\u8bef ignore_unreachable \u5e03\u5c14\u503c\uff0c\u53ef\u4ee5\u5ffd\u7565\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u5e76\u7ee7\u7eed module_defaults \u6307\u5b9a\u6a21\u5757\u7684\u9ed8\u8ba4\u53c2\u6570\u503c\u3002 name \u5b9a\u4e49\u4efb\u52a1\u5f97\u540d\u79f0 no_log \u4e0d\u8bb0\u5f55\u65e5\u5fd7 port \u5b9a\u4e49 ssh \u7684\u8fde\u63a5\u7aef\u53e3 remote_user \u8fdc\u7aef\u7cfb\u7edf\u7684\u6267\u884c\u7528\u6237 run_once \u53ea\u8fd0\u884c\u4e00\u6b21 tags \u6807\u8bb0\u6807\u7b7e throttle \u9650\u5236\u5e76\u53d1\u4efb\u52a1\u5728 tasks\uff0cblocks \u548c playbook \u7ea7\u522b\u4e0a\u8fd0\u884c\u7684\u6570\u91cf\u3002\u4e0d\u80fd\u9ad8\u4e8e serial \u548c forks \u6570 vars \u5b9a\u4e49\u53d8\u91cf when \u6761\u4ef6\u8868\u8fbe\u5f0f\u7ed3\u679c\u4e3a True \u5219\u6267\u884c block","title":"Role"},{"location":"basic/Reference/Keywords/#block","text":"\u5728 block \u4e0b\u53ef\u7528\u7684\u5173\u952e\u5b57 key desc always Block \u4e2d\u6267\u884c\u7684\u4efb\u52a1\u5217\u8868\uff0c\u65e0\u8bba\u662f\u5426\u5b58\u5728\u9519\u8bef\u90fd\u4f1a\u6267\u884c\u3002 any_errors_fatal \u6709\u9519\u8bef\u65f6\u7acb\u5373\u4e2d\u65ad ansbile become \u662f\u5426\u63d0\u6743 become_exe become_flags \u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570 become_method \u63d0\u6743\u7684\u65b9\u5f0f become_user \u63d0\u6743\u7684\u7528\u6237 block \u5206\u7ec4\u91cc\u7684\u4efb\u52a1\u5217\u8868 check_mode \u5f53\u4e3a True \u65f6\uff0c\u53ea\u68c0\u67e5\uff0c\u4e0d\u505a\u4fee\u6539 collections connection \u8fde\u63a5\u65b9\u5f0f debugger \u5f00\u542f debugger \u6a21\u5f0f delegate_facts \u5e03\u5c14\u503c\uff0c\u5c06 facts \u5e94\u7528\u4e8e\u59d4\u6d3e\u7684\u4e3b\u673a\u3002 delegate_to \u4efb\u52a1\u59d4\u6d3e diff \u5bf9\u6bd4\u66f4\u6539\u7684\u6587\u4ef6 environment \u5b9a\u4e49\u8fdc\u7aef\u7cfb\u7edf\u7684\u73af\u5883\u53d8\u91cf ignore_errors \u662f\u5426\u5ffd\u7565\u9519\u8bef ignore_unreachable \u5e03\u5c14\u503c\uff0c\u53ef\u4ee5\u5ffd\u7565\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u5e76\u7ee7\u7eed module_defaults \u6307\u5b9a\u6a21\u5757\u7684\u9ed8\u8ba4\u53c2\u6570\u503c\u3002 name \u5b9a\u4e49 block \u540d\u79f0 no_log \u4e0d\u8bb0\u5f55\u65e5\u5fd7 port \u5b9a\u4e49 ssh \u7684\u8fde\u63a5\u7aef\u53e3 remote_user \u8fdc\u7aef\u7cfb\u7edf\u7684\u6267\u884c\u7528\u6237 rescue block \u4e2d\u7684\u4efb\u52a1\u5728\u6267\u884c\u4e2d\uff0c\u5982\u679c\u6709\u4efb\u4f55\u9519\u8bef\uff0c\u5c06\u6267\u884c rescue \u4e2d\u7684\u4efb\u52a1\u3002 run_once \u53ea\u8fd0\u884c\u4e00\u6b21 tags \u6807\u8bb0\u6807\u7b7e throttle \u9650\u5236\u5e76\u53d1\u4efb\u52a1\u5728 tasks\uff0cblocks \u548c playbook \u7ea7\u522b\u4e0a\u8fd0\u884c\u7684\u6570\u91cf\u3002\u4e0d\u80fd\u9ad8\u4e8e serial \u548c forks \u6570 vars \u5b9a\u4e49\u53d8\u91cf when \u6761\u4ef6\u8868\u8fbe\u5f0f\u7ed3\u679c\u4e3a True \u5219\u6267\u884c block","title":"Block"},{"location":"basic/Reference/Keywords/#task","text":"\u5728 task \u4e0b\u53ef\u7528\u7684\u5173\u952e\u5b57 key desc action \u6267\u884c\u52a8\u4f5c any_errors_fatal \u4e3a True \u65f6\uff0c\u53ea\u8981\u4efb\u52a1\u6709\u9519\u8bef\uff0c\u5c31\u7acb\u5373\u505c\u6b62 ansible args \u5b9a\u4e49\u4efb\u52a1\u5f97\u53c2\u6570 async \u662f\u5426\u5f02\u6b65\u6267\u884c\u4efb\u52a1 become \u662f\u5426\u63d0\u6743 become_exe become_flags \u63d0\u6743\u547d\u4ee4\u7684\u53c2\u6570 become_method \u63d0\u6743\u7684\u65b9\u5f0f become_user \u63d0\u6743\u7684\u7528\u6237 changed_when \u6761\u4ef6\u8868\u8fbe\u5f0f\u4e3a True \u65f6\uff0c\u4f7f\u4efb\u52a1\u72b6\u6001\u4e3a changed check_mode \u4e3a True \u65f6\uff0c\u53ea\u68c0\u67e5\u8fd0\u884c\u72b6\u6001\uff0c\u5728\u8fdc\u7aef\u4e0d\u505a\u4efb\u4f55\u4fee\u6539 collections connection \u8fde\u63a5\u65b9\u5f0f debugger \u5f00\u542f debugger \u6a21\u5f0f delay \u7b49\u5f85\u591a\u5c11\u79d2\uff0c\u624d\u6267\u884c\u4efb\u52a1 delegate_facts \u5e03\u5c14\u503c\uff0c\u5c06 facts \u5e94\u7528\u4e8e\u59d4\u6d3e\u7684\u4e3b\u673a\u3002 delegate_to \u4efb\u52a1\u59d4\u6d3e diff \u5bf9\u6bd4\u66f4\u6539\u7684\u6587\u4ef6 environment \u5b9a\u4e49\u8fdc\u7aef\u7684\u73af\u5883\u53d8\u91cf failed_when \u6761\u4ef6\u8868\u8fbe\u5f0f\u4e3a True \u65f6\uff0c\u4f7f\u4efb\u52a1\u4e3a\u5931\u8d25\u72b6\u6001 ignore_errors \u662f\u5426\u5ffd\u7565\u9519\u8bef ignore_unreachable \u5e03\u5c14\u503c\uff0c\u53ef\u4ee5\u5ffd\u7565\u65e0\u6cd5\u8bbf\u95ee\u7684\u4e3b\u673a\u5e76\u7ee7\u7eed local_action \u672c\u5730\u6267\u884c loop \u5faa\u73af loop_control \u6539\u53d8\u5faa\u73af\u7684\u53d8\u91cf\u9879 module_defaults \u6307\u5b9a\u6a21\u5757\u7684\u9ed8\u8ba4\u53c2\u6570\u503c\u3002 name \u5b9a\u4e49\u540d\u79f0 no_log \u4e0d\u8bb0\u5f55\u65e5\u5fd7 notify \u7528\u4e8e\u4efb\u52a1\u6267\u884c\u5b8c\uff0c\u6267\u884c handlers \u91cc\u7684\u4efb\u52a1 poll \u8f6e\u8be2\u65f6\u95f4 port \u5b9a\u4e49 ssh \u7684\u8fde\u63a5\u7aef\u53e3 register \u6ce8\u518c\u53d8\u91cf remote_user \u8fdc\u7aef\u7cfb\u7edf\u7684\u6267\u884c\u7528\u6237 retries \u91cd\u8bd5\u6b21\u6570 run_once \u53ea\u8fd0\u884c\u4e00\u6b21 tags \u6807\u8bb0\u4e3a\u6807\u7b7e throttle \u9650\u5236\u5e76\u53d1\u4efb\u52a1\u5728 tasks\uff0cblocks \u548c playbook \u7ea7\u522b\u4e0a\u8fd0\u884c\u7684\u6570\u91cf\u3002\u4e0d\u80fd\u9ad8\u4e8e serial \u548c forks \u6570 until \u76f4\u5230\u4e3a\u771f\u65f6\uff0c\u624d\u7ee7\u7eed\u6267\u884c\u4efb\u52a1 vars \u5b9a\u4e49\u53d8\u91cf when \u6761\u4ef6\u8868\u8fbe\u5f0f\uff0c\u7ed3\u679c\u4e3a True \u5219\u6267\u884c task with_ \u5faa\u73af\u63d2\u4ef6","title":"Task"},{"location":"basic/Reference/Module/","text":"Ansible Modules \u00b6 Note (D): \u6709\u8fd9\u4e2a\u6807\u8bc6\u7684\uff0c\u5c31\u8868\u793a\u88ab\u5f03\u7528\u7684\u3002 \u66f4\u65b0\u4e8e 2020-04\uff0c\u6700\u65b0\u5217\u8868\u89c1 \u5b98\u7f51 Cloud modules \u00b6 Alicloud \u00b6 ali_instance \u2013 Create, Start, Stop, Restart or Terminate an Instance in ECS. Add or Remove Instance to/from a Security Group ali_instance_info \u2013 Gather information on instances of Alibaba Cloud ECS Amazon \u00b6 aws_acm_info \u2013 Retrieve certificate information from AWS Certificate Manager service aws_api_gateway \u2013 Manage AWS API Gateway APIs aws_application_scaling_policy \u2013 Manage Application Auto Scaling Scaling Policies aws_az_info \u2013 Gather information about availability zones in AWS aws_batch_compute_environment \u2013 Manage AWS Batch Compute Environments aws_batch_job_definition \u2013 Manage AWS Batch Job Definitions aws_batch_job_queue \u2013 Manage AWS Batch Job Queues aws_caller_info \u2013 Get information about the user and account being used to make AWS calls aws_codebuild \u2013 Create or delete an AWS CodeBuild project aws_codecommit \u2013 Manage repositories in AWS CodeCommit aws_codepipeline \u2013 Create or delete AWS CodePipelines aws_config_aggregation_authorization \u2013 Manage cross-account AWS Config authorizations aws_config_aggregator \u2013 Manage AWS Config aggregations across multiple accounts aws_config_delivery_channel \u2013 Manage AWS Config delivery channels aws_config_recorder \u2013 Manage AWS Config Recorders aws_config_rule \u2013 Manage AWS Config resources aws_direct_connect_connection \u2013 Creates, deletes, modifies a DirectConnect connection aws_direct_connect_gateway \u2013 Manage AWS Direct Connect Gateway aws_direct_connect_link_aggregation_group \u2013 Manage Direct Connect LAG bundles aws_direct_connect_virtual_interface \u2013 Manage Direct Connect virtual interfaces aws_eks_cluster \u2013 Manage Elastic Kubernetes Service Clusters aws_elasticbeanstalk_app \u2013 create, update, and delete an elastic beanstalk application aws_glue_connection \u2013 Manage an AWS Glue connection aws_glue_job \u2013 Manage an AWS Glue job aws_inspector_target \u2013 Create, Update and Delete Amazon Inspector Assessment Targets aws_kms \u2013 Perform various KMS management tasks aws_kms_info \u2013 Gather information about AWS KMS keys aws_netapp_cvs_active_directory \u2013 NetApp AWS CloudVolumes Service Manage Active Directory aws_netapp_cvs_FileSystems \u2013 NetApp AWS Cloud Volumes Service Manage FileSystem aws_netapp_cvs_pool \u2013 NetApp AWS Cloud Volumes Service Manage Pools aws_netapp_cvs_snapshots \u2013 NetApp AWS Cloud Volumes Service Manage Snapshots aws_region_info \u2013 Gather information about AWS regions aws_s3 \u2013 manage objects in S3 aws_s3_bucket_info \u2013 Lists S3 buckets in AWS aws_s3_cors \u2013 Manage CORS for S3 buckets in AWS aws_secret \u2013 Manage secrets stored in AWS Secrets Manager aws_ses_identity \u2013 Manages SES email and domain identity aws_ses_identity_policy \u2013 Manages SES sending authorization policies aws_ses_rule_set \u2013 Manages SES inbound receipt rule sets aws_sgw_info \u2013 Fetch AWS Storage Gateway information aws_ssm_parameter_store \u2013 Manage key-value pairs in aws parameter store aws_waf_condition \u2013 create and delete WAF Conditions aws_waf_info \u2013 Retrieve information for WAF ACLs, Rule , Conditions and Filters aws_waf_rule \u2013 create and delete WAF Rules aws_waf_web_acl \u2013 create and delete WAF Web ACLs cloudformation \u2013 Create or delete an AWS CloudFormation stack cloudformation_info \u2013 Obtain information about an AWS CloudFormation stack cloudformation_stack_set \u2013 Manage groups of CloudFormation stacks cloudfront_distribution \u2013 create, update and delete aws cloudfront distributions cloudfront_info \u2013 Obtain facts about an AWS CloudFront distribution cloudfront_invalidation \u2013 create invalidations for aws cloudfront distributions cloudfront_origin_access_identity \u2013 create, update and delete origin access identities for a cloudfront distribution cloudtrail \u2013 manage CloudTrail create, delete, update cloudwatchevent_rule \u2013 Manage CloudWatch Event rules and targets cloudwatchlogs_log_group \u2013 create or delete log_group in CloudWatchLogs cloudwatchlogs_log_group_info \u2013 get information about log_group in CloudWatchLogs data_pipeline \u2013 Create and manage AWS Datapipelines dms_endpoint \u2013 creates or destroys a data migration services endpoint dms_replication_subnet_group \u2013 creates or destroys a data migration services subnet group dynamodb_table \u2013 Create, update or delete AWS Dynamo DB tables dynamodb_ttl \u2013 set TTL for a given DynamoDB table ec2 \u2013 create, terminate, start or stop an instance in ec2 ec2_ami \u2013 create or destroy an image in ec2 ec2_ami_copy \u2013 copies AMI between AWS regions, return new image id ec2_ami_info \u2013 Gather information about ec2 AMIs ec2_asg \u2013 Create or delete AWS Autoscaling Groups ec2_asg_info \u2013 Gather information about ec2 Auto Scaling Groups (ASGs) in AWS ec2_asg_lifecycle_hook \u2013 Create, delete or update AWS ASG Lifecycle Hooks ec2_customer_gateway \u2013 Manage an AWS customer gateway ec2_customer_gateway_info \u2013 Gather information about customer gateways in AWS ec2_eip \u2013 manages EC2 elastic IP (EIP) addresses ec2_eip_info \u2013 List EC2 EIP details ec2_elb \u2013 De-registers or registers instances from EC2 ELBs ec2_elb_info \u2013 Gather information about EC2 Elastic Load Balancers in AWS ec2_elb_lb \u2013 Creates, updates or destroys an Amazon ELB ec2_eni \u2013 Create and optionally attach an Elastic Network Interface (ENI) to an instance ec2_eni_info \u2013 Gather information about ec2 ENI interfaces in AWS ec2_group \u2013 maintain an ec2 VPC security group ec2_group_info \u2013 Gather information about ec2 security groups in AWS ec2_instance \u2013 Create & manage EC2 instances ec2_instance_info \u2013 Gather information about ec2 instances in AWS ec2_key \u2013 create or delete an ec2 key pair ec2_launch_template \u2013 Manage EC2 launch templates ec2_lc \u2013 Create or delete AWS Autoscaling Launch Configurations ec2_lc_find \u2013 Find AWS Autoscaling Launch Configurations ec2_lc_info \u2013 Gather information about AWS Autoscaling Launch Configurations ec2_metadata_facts \u2013 Gathers facts (instance metadata) about remote hosts within ec2 ec2_metric_alarm \u2013 Create/update or delete AWS Cloudwatch \u2018metric alarms\u2019 ec2_placement_group \u2013 Create or delete an EC2 Placement Group ec2_placement_group_info \u2013 List EC2 Placement Group(s) details ec2_scaling_policy \u2013 Create or delete AWS scaling policies for Autoscaling groups ec2_snapshot \u2013 creates a snapshot from an existing volume ec2_snapshot_copy \u2013 copies an EC2 snapshot and returns the new Snapshot ID ec2_snapshot_info \u2013 Gather information about ec2 volume snapshots in AWS ec2_tag \u2013 create and remove tags on ec2 resources ec2_transit_gateway \u2013 Create and delete AWS Transit Gateways ec2_transit_gateway_info \u2013 Gather information about ec2 transit gateways in AWS ec2_vol \u2013 create and attach a volume, return volume id and device map ec2_vol_info \u2013 Gather information about ec2 volumes in AWS ec2_vpc_dhcp_option \u2013 Manages DHCP Options, and can ensure the DHCP options for the given VPC match what\u2019s requested ec2_vpc_dhcp_option_info \u2013 Gather information about dhcp options sets in AWS ec2_vpc_egress_igw \u2013 Manage an AWS VPC Egress Only Internet gateway ec2_vpc_endpoint \u2013 Create and delete AWS VPC Endpoints ec2_vpc_endpoint_info \u2013 Retrieves AWS VPC endpoints details using AWS methods ec2_vpc_igw \u2013 Manage an AWS VPC Internet gateway ec2_vpc_igw_info \u2013 Gather information about internet gateways in AWS ec2_vpc_nacl \u2013 create and delete Network ACLs ec2_vpc_nacl_info \u2013 Gather information about Network ACLs in an AWS VPC ec2_vpc_nat_gateway \u2013 Manage AWS VPC NAT Gateways ec2_vpc_nat_gateway_info \u2013 Retrieves AWS VPC Managed Nat Gateway details using AWS methods ec2_vpc_net \u2013 Configure AWS virtual private clouds ec2_vpc_net_info \u2013 Gather information about ec2 VPCs in AWS ec2_vpc_peer \u2013 create, delete, accept, and reject VPC peering connections between two VPCs ec2_vpc_peering_info \u2013 Retrieves AWS VPC Peering details using AWS methods ec2_vpc_route_table \u2013 Manage route tables for AWS virtual private clouds ec2_vpc_route_table_info \u2013 Gather information about ec2 VPC route tables in AWS ec2_vpc_subnet \u2013 Manage subnets in AWS virtual private clouds ec2_vpc_subnet_info \u2013 Gather information about ec2 VPC subnets in AWS ec2_vpc_vgw \u2013 Create and delete AWS VPN Virtual Gateways ec2_vpc_vgw_info \u2013 Gather information about virtual gateways in AWS ec2_vpc_vpn \u2013 Create, modify, and delete EC2 VPN connections ec2_vpc_vpn_info \u2013 Gather information about VPN Connections in AWS ec2_win_password \u2013 gets the default administrator password for ec2 windows instances ecs_attribute \u2013 manage ecs attributes ecs_cluster \u2013 create or terminate ecs clusters ecs_ecr \u2013 Manage Elastic Container Registry repositories ecs_service \u2013 create, terminate, start or stop a service in ecs ecs_service_info \u2013 list or describe services in ecs ecs_task \u2013 run, start or stop a task in ecs ecs_taskdefinition \u2013 register a task definition in ecs ecs_taskdefinition_info \u2013 describe a task definition in ecs efs \u2013 create and maintain EFS file systems efs_info \u2013 Get information about Amazon EFS file systems elasticache \u2013 Manage cache clusters in Amazon Elasticache elasticache_info \u2013 Retrieve information for AWS Elasticache clusters elasticache_parameter_group \u2013 Manage cache security groups in Amazon Elasticache elasticache_snapshot \u2013 Manage cache snapshots in Amazon Elasticache elasticache_subnet_group \u2013 manage Elasticache subnet groups elb_application_lb \u2013 Manage an Application load balancer elb_application_lb_info \u2013 Gather information about application ELBs in AWS elb_classic_lb \u2013 Creates or destroys Amazon ELB elb_classic_lb_info \u2013 Gather information about EC2 Elastic Load Balancers in AWS elb_instance \u2013 De-registers or registers instances from EC2 ELBs elb_network_lb \u2013 Manage a Network Load Balancer elb_target \u2013 Manage a target in a target group elb_target_group \u2013 Manage a target group for an Application or Network load balancer elb_target_group_info \u2013 Gather information about ELB target groups in AWS elb_target_info \u2013 Gathers which target groups a target is associated with execute_lambda \u2013 Execute an AWS Lambda function iam \u2013 Manage IAM users, groups, roles and keys iam_cert \u2013 Manage server certificates for use on ELBs and CloudFront iam_group \u2013 Manage AWS IAM groups iam_managed_policy \u2013 Manage User Managed IAM policies iam_mfa_device_info \u2013 List the MFA (Multi-Factor Authentication) devices registered for a user iam_password_policy \u2013 Update an IAM Password Policy iam_policy \u2013 Manage IAM policies for users, groups, and roles iam_role \u2013 Manage AWS IAM roles iam_role_info \u2013 Gather information on IAM roles iam_server_certificate_info \u2013 Retrieve the information of a server certificate iam_user \u2013 Manage AWS IAM users kinesis_stream \u2013 Manage a Kinesis Stream lambda \u2013 Manage AWS Lambda functions lambda_alias \u2013 Creates, updates or deletes AWS Lambda function aliases lambda_event \u2013 Creates, updates or deletes AWS Lambda function event mappings lambda_facts \u2013 Gathers AWS Lambda function details as Ansible facts (D) lambda_info \u2013 Gathers AWS Lambda function details lambda_policy \u2013 Creates, updates or deletes AWS Lambda policy statements lightsail \u2013 Create or delete a virtual machine instance in AWS Lightsail rds \u2013 create, delete, or modify Amazon rds instances, rds snapshots, and related facts rds_instance \u2013 Manage RDS instances rds_instance_info \u2013 obtain information about one or more RDS instances rds_param_group \u2013 manage RDS parameter groups rds_snapshot \u2013 manage Amazon RDS snapshots rds_snapshot_info \u2013 obtain information about one or more RDS snapshots rds_subnet_group \u2013 manage RDS database subnet groups redshift \u2013 create, delete, or modify an Amazon Redshift instance redshift_cross_region_snapshots \u2013 Manage Redshift Cross Region Snapshots redshift_info \u2013 Gather information about Redshift cluster(s) redshift_subnet_group \u2013 manage Redshift cluster subnet groups route53 \u2013 add or delete entries in Amazons Route53 DNS service route53_health_check \u2013 add or delete health-checks in Amazons Route53 DNS service route53_info \u2013 Retrieves route53 details using AWS methods route53_zone \u2013 add or delete Route53 zones s3_bucket \u2013 Manage S3 buckets in AWS, DigitalOcean, Ceph, Walrus and FakeS3 s3_bucket_notification \u2013 Creates, updates or deletes S3 Bucket notification for lambda s3_lifecycle \u2013 Manage s3 bucket lifecycle rules in AWS s3_logging \u2013 Manage logging facility of an s3 bucket in AWS s3_sync \u2013 Efficiently upload multiple files to S3 s3_website \u2013 Configure an s3 bucket as a website sns \u2013 Send Amazon Simple Notification Service messages sns_topic \u2013 Manages AWS SNS topics and subscriptions sqs_queue \u2013 Creates or deletes AWS SQS queues sts_assume_role \u2013 Assume a role using AWS Security Token Service and obtain temporary credentials sts_session_token \u2013 Obtain a session token from the AWS Security Token Service Atomic \u00b6 atomic_container \u2013 Manage the containers on the atomic host platform atomic_host \u2013 Manage the atomic host platform atomic_image \u2013 Manage the container images on the atomic host platform Azure \u00b6 azure_rm_acs \u2013 Manage an Azure Container Service(ACS) instance azure_rm_aks \u2013 Manage a managed Azure Container Service (AKS) instance azure_rm_aks_info \u2013 Get Azure Kubernetes Service facts azure_rm_aksversion_info \u2013 Get available kubernetes versions supported by Azure Kubernetes Service azure_rm_appgateway \u2013 Manage Application Gateway instance azure_rm_applicationsecuritygroup \u2013 Manage Azure Application Security Group azure_rm_applicationsecuritygroup_info \u2013 Get Azure Application Security Group facts azure_rm_appserviceplan \u2013 Manage App Service Plan azure_rm_appserviceplan_info \u2013 Get azure app service plan facts azure_rm_automationaccount \u2013 Manage Azure Automation account azure_rm_automationaccount_info \u2013 Get Azure automation account facts azure_rm_autoscale \u2013 Manage Azure autoscale setting azure_rm_autoscale_info \u2013 Get Azure Auto Scale Setting facts azure_rm_availabilityset \u2013 Manage Azure Availability Set azure_rm_availabilityset_info \u2013 Get Azure Availability Set facts azure_rm_azurefirewall \u2013 Manage Azure Firewall instance azure_rm_azurefirewall_info \u2013 Get AzureFirewall info azure_rm_batchaccount \u2013 Manages a Batch Account on Azure azure_rm_cdnendpoint \u2013 Manage a Azure CDN endpoint azure_rm_cdnendpoint_info \u2013 Get Azure CDN endpoint facts azure_rm_cdnprofile \u2013 Manage a Azure CDN profile azure_rm_cdnprofile_info \u2013 Get Azure CDN profile facts azure_rm_containerinstance \u2013 Manage an Azure Container Instance azure_rm_containerinstance_info \u2013 Get Azure Container Instance facts azure_rm_containerregistry \u2013 Manage an Azure Container Registry azure_rm_containerregistry_info \u2013 Get Azure Container Registry facts azure_rm_cosmosdbaccount \u2013 Manage Azure Database Account instance azure_rm_cosmosdbaccount_info \u2013 Get Azure Cosmos DB Account facts azure_rm_deployment \u2013 Create or destroy Azure Resource Manager template deployments azure_rm_deployment_info \u2013 Get Azure Deployment facts azure_rm_devtestlab \u2013 Manage Azure DevTest Lab instance azure_rm_devtestlab_info \u2013 Get Azure DevTest Lab facts azure_rm_devtestlabarmtemplate_info \u2013 Get Azure DevTest Lab ARM Template facts azure_rm_devtestlabartifact_info \u2013 Get Azure DevTest Lab Artifact facts azure_rm_devtestlabartifactsource \u2013 Manage Azure DevTest Labs Artifacts Source instance azure_rm_devtestlabartifactsource_info \u2013 Get Azure DevTest Lab Artifact Source facts azure_rm_devtestlabcustomimage \u2013 Manage Azure DevTest Lab Custom Image instance azure_rm_devtestlabcustomimage_info \u2013 Get Azure DevTest Lab Custom Image facts azure_rm_devtestlabenvironment \u2013 Manage Azure DevTest Lab Environment instance azure_rm_devtestlabenvironment_info \u2013 Get Azure Environment facts azure_rm_devtestlabpolicy \u2013 Manage Azure Policy instance azure_rm_devtestlabpolicy_info \u2013 Get Azure DTL Policy facts azure_rm_devtestlabschedule \u2013 Manage Azure DevTest Lab Schedule instance azure_rm_devtestlabschedule_info \u2013 Get Azure Schedule facts azure_rm_devtestlabvirtualmachine \u2013 Manage Azure DevTest Lab Virtual Machine instance azure_rm_devtestlabvirtualmachine_info \u2013 Get Azure DevTest Lab Virtual Machine facts azure_rm_devtestlabvirtualnetwork \u2013 Manage Azure DevTest Lab Virtual Network instance azure_rm_devtestlabvirtualnetwork_info \u2013 Get Azure DevTest Lab Virtual Network facts azure_rm_dnsrecordset \u2013 Create, delete and update DNS record sets and records azure_rm_dnsrecordset_info \u2013 Get DNS Record Set facts azure_rm_dnszone \u2013 Manage Azure DNS zones azure_rm_dnszone_info \u2013 Get DNS zone facts azure_rm_functionapp \u2013 Manage Azure Function Apps azure_rm_functionapp_info \u2013 Get Azure Function App facts azure_rm_gallery \u2013 Manage Azure Shared Image Gallery instance azure_rm_gallery_info \u2013 Get Azure Shared Image Gallery info azure_rm_galleryimage \u2013 Manage Azure SIG Image instance azure_rm_galleryimage_info \u2013 Get Azure SIG Image info azure_rm_galleryimageversion \u2013 Manage Azure SIG Image Version instance azure_rm_galleryimageversion_info \u2013 Get Azure SIG Image Version info azure_rm_hdinsightcluster \u2013 Manage Azure HDInsight Cluster instance azure_rm_hdinsightcluster_info \u2013 Get Azure HDInsight Cluster facts azure_rm_image \u2013 Manage Azure image azure_rm_image_info \u2013 Get facts about azure custom images azure_rm_iotdevice \u2013 Manage Azure IoT hub device azure_rm_iotdevice_info \u2013 Facts of Azure IoT hub device azure_rm_iotdevicemodule \u2013 Manage Azure IoT hub device module azure_rm_iothub \u2013 Manage Azure IoT hub azure_rm_iothub_info \u2013 Get IoT Hub facts azure_rm_iothubconsumergroup \u2013 Manage Azure IoT hub azure_rm_keyvault \u2013 Manage Key Vault instance azure_rm_keyvault_info \u2013 Get Azure Key Vault facts azure_rm_keyvaultkey \u2013 Use Azure KeyVault keys azure_rm_keyvaultkey_info \u2013 Get Azure Key Vault key facts azure_rm_keyvaultsecret \u2013 Use Azure KeyVault Secrets azure_rm_loadbalancer \u2013 Manage Azure load balancers azure_rm_loadbalancer_info \u2013 Get load balancer facts azure_rm_lock \u2013 Manage Azure locks azure_rm_lock_info \u2013 Manage Azure locks azure_rm_loganalyticsworkspace \u2013 Manage Azure Log Analytics workspaces azure_rm_loganalyticsworkspace_info \u2013 Get facts of Azure Log Analytics workspaces azure_rm_manageddisk \u2013 Manage Azure Manage Disks azure_rm_manageddisk_info \u2013 Get managed disk facts azure_rm_mariadbconfiguration \u2013 Manage Configuration instance azure_rm_mariadbconfiguration_info \u2013 Get Azure MariaDB Configuration facts azure_rm_mariadbdatabase \u2013 Manage MariaDB Database instance azure_rm_mariadbdatabase_info \u2013 Get Azure MariaDB Database facts azure_rm_mariadbfirewallrule \u2013 Manage MariaDB firewall rule instance azure_rm_mariadbfirewallrule_info \u2013 Get Azure MariaDB Firewall Rule facts azure_rm_mariadbserver \u2013 Manage MariaDB Server instance azure_rm_mariadbserver_info \u2013 Get Azure MariaDB Server facts azure_rm_monitorlogprofile \u2013 Manage Azure Monitor log profile azure_rm_mysqlconfiguration \u2013 Manage Configuration instance azure_rm_mysqlconfiguration_info \u2013 Get Azure MySQL Configuration facts azure_rm_mysqldatabase \u2013 Manage MySQL Database instance azure_rm_mysqldatabase_info \u2013 Get Azure MySQL Database facts azure_rm_mysqlfirewallrule \u2013 Manage MySQL firewall rule instance azure_rm_mysqlfirewallrule_info \u2013 Get Azure MySQL Firewall Rule facts azure_rm_mysqlserver \u2013 Manage MySQL Server instance azure_rm_mysqlserver_info \u2013 Get Azure MySQL Server facts azure_rm_networkinterface \u2013 Manage Azure network interfaces azure_rm_networkinterface_info \u2013 Get network interface facts azure_rm_postgresqlconfiguration \u2013 Manage Azure PostgreSQL Configuration azure_rm_postgresqlconfiguration_info \u2013 Get Azure PostgreSQL Configuration facts azure_rm_postgresqldatabase \u2013 Manage PostgreSQL Database instance azure_rm_postgresqldatabase_info \u2013 Get Azure PostgreSQL Database facts azure_rm_postgresqlfirewallrule \u2013 Manage PostgreSQL firewall rule instance azure_rm_postgresqlfirewallrule_info \u2013 Get Azure PostgreSQL Firewall Rule facts azure_rm_postgresqlserver \u2013 Manage PostgreSQL Server instance azure_rm_postgresqlserver_info \u2013 Get Azure PostgreSQL Server facts azure_rm_publicipaddress \u2013 Manage Azure Public IP Addresses azure_rm_publicipaddress_info \u2013 Get public IP facts azure_rm_rediscache \u2013 Manage Azure Cache for Redis instance azure_rm_rediscache_info \u2013 Get Azure Cache for Redis instance facts azure_rm_rediscachefirewallrule \u2013 Manage Azure Cache for Redis Firewall rules azure_rm_resource \u2013 Create any Azure resource azure_rm_resource_info \u2013 Generic facts of Azure resources azure_rm_resourcegroup \u2013 Manage Azure resource groups azure_rm_resourcegroup_info \u2013 Get resource group facts azure_rm_roleassignment \u2013 Manage Azure Role Assignment azure_rm_roleassignment_info \u2013 Gets Azure Role Assignment facts azure_rm_roledefinition \u2013 Manage Azure Role Definition azure_rm_roledefinition_info \u2013 Get Azure Role Definition facts azure_rm_route \u2013 Manage Azure route resource azure_rm_routetable \u2013 Manage Azure route table resource azure_rm_routetable_info \u2013 Get route table facts azure_rm_securitygroup \u2013 Manage Azure network security groups azure_rm_securitygroup_info \u2013 Get security group facts azure_rm_servicebus \u2013 Manage Azure Service Bus azure_rm_servicebus_info \u2013 Get servicebus facts azure_rm_servicebusqueue \u2013 Manage Azure Service Bus queue azure_rm_servicebussaspolicy \u2013 Manage Azure Service Bus SAS policy azure_rm_servicebustopic \u2013 Manage Azure Service Bus azure_rm_servicebustopicsubscription \u2013 Manage Azure Service Bus subscription azure_rm_snapshot \u2013 Manage Azure Snapshot instance azure_rm_sqldatabase \u2013 Manage SQL Database instance azure_rm_sqldatabase_info \u2013 Get Azure SQL Database facts azure_rm_sqlfirewallrule \u2013 Manage Firewall Rule instance azure_rm_sqlfirewallrule_info \u2013 Get Azure SQL Firewall Rule facts azure_rm_sqlserver \u2013 Manage SQL Server instance azure_rm_sqlserver_info \u2013 Get SQL Server facts azure_rm_storageaccount \u2013 Manage Azure storage accounts azure_rm_storageaccount_info \u2013 Get storage account facts azure_rm_storageblob \u2013 Manage blob containers and blob objects azure_rm_subnet \u2013 Manage Azure subnets azure_rm_subnet_info \u2013 Get Azure Subnet facts azure_rm_trafficmanagerendpoint \u2013 Manage Azure Traffic Manager endpoint azure_rm_trafficmanagerendpoint_info \u2013 Get Azure Traffic Manager endpoint facts azure_rm_trafficmanagerprofile \u2013 Manage Azure Traffic Manager profile azure_rm_trafficmanagerprofile_info \u2013 Get Azure Traffic Manager profile facts azure_rm_virtualmachine \u2013 Manage Azure virtual machines azure_rm_virtualmachine_info \u2013 Get virtual machine facts azure_rm_virtualmachineextension \u2013 Managed Azure Virtual Machine extension azure_rm_virtualmachineextension_info \u2013 Get Azure Virtual Machine Extension facts azure_rm_virtualmachineimage_info \u2013 Get virtual machine image facts azure_rm_virtualmachinescaleset \u2013 Manage Azure virtual machine scale sets azure_rm_virtualmachinescaleset_info \u2013 Get Virtual Machine Scale Set facts azure_rm_virtualmachinescalesetextension \u2013 Manage Azure Virtual Machine Scale Set (VMSS) extensions azure_rm_virtualmachinescalesetextension_info \u2013 Get Azure Virtual Machine Scale Set Extension facts azure_rm_virtualmachinescalesetinstance \u2013 Get Azure Virtual Machine Scale Set Instance facts azure_rm_virtualmachinescalesetinstance_info \u2013 Get Azure Virtual Machine Scale Set Instance facts azure_rm_virtualnetwork \u2013 Manage Azure virtual networks azure_rm_virtualnetwork_info \u2013 Get virtual network facts azure_rm_virtualnetworkgateway \u2013 Manage Azure virtual network gateways azure_rm_virtualnetworkpeering \u2013 Manage Azure Virtual Network Peering azure_rm_virtualnetworkpeering_info \u2013 Get facts of Azure Virtual Network Peering azure_rm_webapp \u2013 Manage Web App instances azure_rm_webapp_info \u2013 Get Azure web app facts azure_rm_webappslot \u2013 Manage Azure Web App slot Centurylink \u00b6 clc_aa_policy \u2013 Create or Delete Anti Affinity Policies at CenturyLink Cloud clc_alert_policy \u2013 Create or Delete Alert Policies at CenturyLink Cloud clc_blueprint_package \u2013 deploys a blue print package on a set of servers in CenturyLink Cloud clc_firewall_policy \u2013 Create/delete/update firewall policies clc_group \u2013 Create/delete Server Groups at Centurylink Cloud clc_loadbalancer \u2013 Create, Delete shared loadbalancers in CenturyLink Cloud clc_modify_server \u2013 modify servers in CenturyLink Cloud clc_publicip \u2013 Add and Delete public ips on servers in CenturyLink Cloud clc_server \u2013 Create, Delete, Start and Stop servers in CenturyLink Cloud clc_server_snapshot \u2013 Create, Delete and Restore server snapshots in CenturyLink Cloud Cloudscale \u00b6 cloudscale_floating_ip \u2013 Manages floating IPs on the cloudscale.ch IaaS service cloudscale_server \u2013 Manages servers on the cloudscale.ch IaaS service cloudscale_server_group \u2013 Manages server groups on the cloudscale.ch IaaS service cloudscale_volume \u2013 Manages volumes on the cloudscale.ch IaaS service Cloudstack \u00b6 cs_account \u2013 Manages accounts on Apache CloudStack based clouds cs_affinitygroup \u2013 Manages affinity groups on Apache CloudStack based clouds cs_cluster \u2013 Manages host clusters on Apache CloudStack based clouds cs_configuration \u2013 Manages configuration on Apache CloudStack based clouds cs_disk_offering \u2013 Manages disk offerings on Apache CloudStack based clouds cs_domain \u2013 Manages domains on Apache CloudStack based clouds cs_facts \u2013 Gather facts on instances of Apache CloudStack based clouds cs_firewall \u2013 Manages firewall rules on Apache CloudStack based clouds cs_host \u2013 Manages hosts on Apache CloudStack based clouds cs_image_store \u2013 Manages CloudStack Image Stores cs_instance \u2013 Manages instances and virtual machines on Apache CloudStack based clouds cs_instance_facts \u2013 Gathering facts from the API of instances from Apache CloudStack based clouds (D) cs_instance_info \u2013 Gathering information from the API of instances from Apache CloudStack based clouds cs_instance_nic \u2013 Manages NICs of an instance on Apache CloudStack based clouds cs_instance_nic_secondaryip \u2013 Manages secondary IPs of an instance on Apache CloudStack based clouds cs_instance_password_reset \u2013 Allows resetting VM the default passwords on Apache CloudStack based clouds cs_instancegroup \u2013 Manages instance groups on Apache CloudStack based clouds cs_ip_address \u2013 Manages public IP address associations on Apache CloudStack based clouds cs_iso \u2013 Manages ISO images on Apache CloudStack based clouds cs_loadbalancer_rule \u2013 Manages load balancer rules on Apache CloudStack based clouds cs_loadbalancer_rule_member \u2013 Manages load balancer rule members on Apache CloudStack based clouds cs_network \u2013 Manages networks on Apache CloudStack based clouds cs_network_acl \u2013 Manages network access control lists (ACL) on Apache CloudStack based clouds cs_network_acl_rule \u2013 Manages network access control list (ACL) rules on Apache CloudStack based clouds cs_network_offering \u2013 Manages network offerings on Apache CloudStack based clouds cs_physical_network \u2013 Manages physical networks on Apache CloudStack based clouds cs_pod \u2013 Manages pods on Apache CloudStack based clouds cs_portforward \u2013 Manages port forwarding rules on Apache CloudStack based clouds cs_project \u2013 Manages projects on Apache CloudStack based clouds cs_region \u2013 Manages regions on Apache CloudStack based clouds cs_resourcelimit \u2013 Manages resource limits on Apache CloudStack based clouds cs_role \u2013 Manages user roles on Apache CloudStack based clouds cs_role_permission \u2013 Manages role permissions on Apache CloudStack based clouds cs_router \u2013 Manages routers on Apache CloudStack based clouds cs_securitygroup \u2013 Manages security groups on Apache CloudStack based clouds cs_securitygroup_rule \u2013 Manages security group rules on Apache CloudStack based clouds cs_service_offering \u2013 Manages service offerings on Apache CloudStack based clouds cs_snapshot_policy \u2013 Manages volume snapshot policies on Apache CloudStack based clouds cs_sshkeypair \u2013 Manages SSH keys on Apache CloudStack based clouds cs_staticnat \u2013 Manages static NATs on Apache CloudStack based clouds cs_storage_pool \u2013 Manages Primary Storage Pools on Apache CloudStack based clouds cs_template \u2013 Manages templates on Apache CloudStack based clouds cs_traffic_type \u2013 Manages traffic types on CloudStack Physical Networks cs_user \u2013 Manages users on Apache CloudStack based clouds cs_vlan_ip_range \u2013 Manages VLAN IP ranges on Apache CloudStack based clouds cs_vmsnapshot \u2013 Manages VM snapshots on Apache CloudStack based clouds cs_volume \u2013 Manages volumes on Apache CloudStack based clouds cs_vpc \u2013 Manages VPCs on Apache CloudStack based clouds cs_vpc_offering \u2013 Manages vpc offerings on Apache CloudStack based clouds cs_vpn_connection \u2013 Manages site-to-site VPN connections on Apache CloudStack based clouds cs_vpn_customer_gateway \u2013 Manages site-to-site VPN customer gateway configurations on Apache CloudStack based clouds cs_vpn_gateway \u2013 Manages site-to-site VPN gateways on Apache CloudStack based clouds cs_zone \u2013 Manages zones on Apache CloudStack based clouds cs_zone_facts \u2013 Gathering facts of zones from Apache CloudStack based clouds (D) cs_zone_info \u2013 Gathering information about zones from Apache CloudStack based clouds Digital_Ocean \u00b6 digital_ocean \u2013 Create/delete a droplet/SSH_key in DigitalOcean (D) digital_ocean_account_info \u2013 Gather information about DigitalOcean User account digital_ocean_block_storage \u2013 Create/destroy or attach/detach Block Storage volumes in DigitalOcean digital_ocean_certificate \u2013 Manage certificates in DigitalOcean digital_ocean_certificate_info \u2013 Gather information about DigitalOcean certificates digital_ocean_domain \u2013 Create/delete a DNS domain in DigitalOcean digital_ocean_domain_info \u2013 Gather information about DigitalOcean Domains digital_ocean_droplet \u2013 Create and delete a DigitalOcean droplet digital_ocean_firewall_info \u2013 Gather information about DigitalOcean firewalls digital_ocean_floating_ip \u2013 Manage DigitalOcean Floating IPs digital_ocean_floating_ip_info \u2013 DigitalOcean Floating IPs information digital_ocean_image_info \u2013 Gather information about DigitalOcean images digital_ocean_load_balancer_info \u2013 Gather information about DigitalOcean load balancers digital_ocean_region_info \u2013 Gather information about DigitalOcean regions digital_ocean_size_info \u2013 Gather information about DigitalOcean Droplet sizes digital_ocean_snapshot_info \u2013 Gather information about DigitalOcean Snapshot digital_ocean_sshkey \u2013 Manage DigitalOcean SSH keys digital_ocean_sshkey_facts \u2013 DigitalOcean SSH keys facts (D) digital_ocean_sshkey_info \u2013 Gather information about DigitalOcean SSH keys digital_ocean_tag \u2013 Create and remove tag(s) to DigitalOcean resource digital_ocean_tag_info \u2013 Gather information about DigitalOcean tags digital_ocean_volume_info \u2013 Gather information about DigitalOcean volumes Dimensiondata \u00b6 dimensiondata_network \u2013 Create, update, and delete MCP 1.0 & 2.0 networks dimensiondata_vlan \u2013 Manage a VLAN in a Cloud Control network domain Docker \u00b6 docker_compose \u2013 Manage multi-container Docker applications with Docker Compose docker_config \u2013 Manage docker configs docker_container \u2013 manage docker containers docker_container_info \u2013 Retrieves facts about docker container docker_host_info \u2013 Retrieves facts about docker host and lists of objects of the services docker_image \u2013 Manage docker images docker_image_info \u2013 Inspect docker images docker_login \u2013 Log into a Docker registry docker_network \u2013 Manage Docker networks docker_network_info \u2013 Retrieves facts about docker network docker_node \u2013 Manage Docker Swarm node docker_node_info \u2013 Retrieves facts about docker swarm node from Swarm Manager docker_prune \u2013 Allows to prune various docker objects docker_secret \u2013 Manage docker secrets docker_stack \u2013 docker stack module docker_swarm \u2013 Manage Swarm cluster docker_swarm_info \u2013 Retrieves facts about Docker Swarm cluster docker_swarm_service \u2013 docker swarm service docker_swarm_service_info \u2013 Retrieves information about docker services from a Swarm Manager docker_volume \u2013 Manage Docker volumes docker_volume_info \u2013 Retrieve facts about Docker volumes Google \u00b6 gc_storage \u2013 This module manages objects/buckets in Google Cloud Storage gcdns_record \u2013 Creates or removes resource records in Google Cloud DNS (D) gcdns_zone \u2013 Creates or removes zones in Google Cloud DNS (D) gce \u2013 create or terminate GCE instances (D) gce_eip \u2013 Create or Destroy Global or Regional External IP addresses gce_img \u2013 utilize GCE image resources gce_instance_template \u2013 create or destroy instance templates of Compute Engine of GCP gce_labels \u2013 Create, Update or Destroy GCE Labels gce_lb \u2013 create/destroy GCE load-balancer resources gce_mig \u2013 Create, Update or Destroy a Managed Instance Group (MIG) gce_net \u2013 create/destroy GCE networks and firewall rules gce_pd \u2013 utilize GCE persistent disk resources gce_snapshot \u2013 Create or destroy snapshots for GCE storage volumes gce_tag \u2013 add or remove tag(s) to/from GCE instances gcp_appengine_firewall_rule \u2013 Creates a GCP FirewallRule gcp_appengine_firewall_rule_info \u2013 Gather info for GCP FirewallRule gcp_backend_service \u2013 Create or Destroy a Backend Service (D) gcp_bigquery_dataset \u2013 Creates a GCP Dataset gcp_bigquery_dataset_info \u2013 Gather info for GCP Dataset gcp_bigquery_table \u2013 Creates a GCP Table gcp_bigquery_table_info \u2013 Gather info for GCP Table gcp_cloudbuild_trigger \u2013 Creates a GCP Trigger gcp_cloudbuild_trigger_info \u2013 Gather info for GCP Trigger gcp_cloudfunctions_cloud_function \u2013 Creates a GCP CloudFunction gcp_cloudfunctions_cloud_function_info \u2013 Gather info for GCP CloudFunction gcp_cloudscheduler_job \u2013 Creates a GCP Job gcp_cloudscheduler_job_info \u2013 Gather info for GCP Job gcp_cloudtasks_queue \u2013 Creates a GCP Queue gcp_cloudtasks_queue_info \u2013 Gather info for GCP Queue gcp_compute_address \u2013 Creates a GCP Address gcp_compute_address_info \u2013 Gather info for GCP Address gcp_compute_autoscaler \u2013 Creates a GCP Autoscaler gcp_compute_autoscaler_info \u2013 Gather info for GCP Autoscaler gcp_compute_backend_bucket \u2013 Creates a GCP BackendBucket gcp_compute_backend_bucket_info \u2013 Gather info for GCP BackendBucket gcp_compute_backend_service \u2013 Creates a GCP BackendService gcp_compute_backend_service_info \u2013 Gather info for GCP BackendService gcp_compute_disk \u2013 Creates a GCP Disk gcp_compute_disk_info \u2013 Gather info for GCP Disk gcp_compute_firewall \u2013 Creates a GCP Firewall gcp_compute_firewall_info \u2013 Gather info for GCP Firewall gcp_compute_forwarding_rule \u2013 Creates a GCP ForwardingRule gcp_compute_forwarding_rule_info \u2013 Gather info for GCP ForwardingRule gcp_compute_global_address \u2013 Creates a GCP GlobalAddress gcp_compute_global_address_info \u2013 Gather info for GCP GlobalAddress gcp_compute_global_forwarding_rule \u2013 Creates a GCP GlobalForwardingRule gcp_compute_global_forwarding_rule_info \u2013 Gather info for GCP GlobalForwardingRule gcp_compute_health_check \u2013 Creates a GCP HealthCheck gcp_compute_health_check_info \u2013 Gather info for GCP HealthCheck gcp_compute_http_health_check \u2013 Creates a GCP HttpHealthCheck gcp_compute_http_health_check_info \u2013 Gather info for GCP HttpHealthCheck gcp_compute_https_health_check \u2013 Creates a GCP HttpsHealthCheck gcp_compute_https_health_check_info \u2013 Gather info for GCP HttpsHealthCheck gcp_compute_image \u2013 Creates a GCP Image gcp_compute_image_info \u2013 Gather info for GCP Image gcp_compute_instance \u2013 Creates a GCP Instance gcp_compute_instance_group \u2013 Creates a GCP InstanceGroup gcp_compute_instance_group_info \u2013 Gather info for GCP InstanceGroup gcp_compute_instance_group_manager \u2013 Creates a GCP InstanceGroupManager gcp_compute_instance_group_manager_info \u2013 Gather info for GCP InstanceGroupManager gcp_compute_instance_info \u2013 Gather info for GCP Instance gcp_compute_instance_template \u2013 Creates a GCP InstanceTemplate gcp_compute_instance_template_info \u2013 Gather info for GCP InstanceTemplate gcp_compute_interconnect_attachment \u2013 Creates a GCP InterconnectAttachment gcp_compute_interconnect_attachment_info \u2013 Gather info for GCP InterconnectAttachment gcp_compute_network \u2013 Creates a GCP Network gcp_compute_network_info \u2013 Gather info for GCP Network gcp_compute_region_disk \u2013 Creates a GCP RegionDisk gcp_compute_region_disk_info \u2013 Gather info for GCP RegionDisk gcp_compute_route \u2013 Creates a GCP Route gcp_compute_route_info \u2013 Gather info for GCP Route gcp_compute_router \u2013 Creates a GCP Router gcp_compute_router_info \u2013 Gather info for GCP Router gcp_compute_snapshot \u2013 Creates a GCP Snapshot gcp_compute_snapshot_info \u2013 Gather info for GCP Snapshot gcp_compute_ssl_certificate \u2013 Creates a GCP SslCertificate gcp_compute_ssl_certificate_info \u2013 Gather info for GCP SslCertificate gcp_compute_ssl_policy \u2013 Creates a GCP SslPolicy gcp_compute_ssl_policy_info \u2013 Gather info for GCP SslPolicy gcp_compute_subnetwork \u2013 Creates a GCP Subnetwork gcp_compute_subnetwork_info \u2013 Gather info for GCP Subnetwork gcp_compute_target_http_proxy \u2013 Creates a GCP TargetHttpProxy gcp_compute_target_http_proxy_info \u2013 Gather info for GCP TargetHttpProxy gcp_compute_target_https_proxy \u2013 Creates a GCP TargetHttpsProxy gcp_compute_target_https_proxy_info \u2013 Gather info for GCP TargetHttpsProxy gcp_compute_target_pool \u2013 Creates a GCP TargetPool gcp_compute_target_pool_info \u2013 Gather info for GCP TargetPool gcp_compute_target_ssl_proxy \u2013 Creates a GCP TargetSslProxy gcp_compute_target_ssl_proxy_info \u2013 Gather info for GCP TargetSslProxy gcp_compute_target_tcp_proxy \u2013 Creates a GCP TargetTcpProxy gcp_compute_target_tcp_proxy_info \u2013 Gather info for GCP TargetTcpProxy gcp_compute_target_vpn_gateway \u2013 Creates a GCP TargetVpnGateway gcp_compute_target_vpn_gateway_info \u2013 Gather info for GCP TargetVpnGateway gcp_compute_url_map \u2013 Creates a GCP UrlMap gcp_compute_url_map_info \u2013 Gather info for GCP UrlMap gcp_compute_vpn_tunnel \u2013 Creates a GCP VpnTunnel gcp_compute_vpn_tunnel_info \u2013 Gather info for GCP VpnTunnel gcp_container_cluster \u2013 Creates a GCP Cluster gcp_container_cluster_info \u2013 Gather info for GCP Cluster gcp_container_node_pool \u2013 Creates a GCP NodePool gcp_container_node_pool_info \u2013 Gather info for GCP NodePool gcp_dns_managed_zone \u2013 Creates a GCP ManagedZone gcp_dns_managed_zone_info \u2013 Gather info for GCP ManagedZone gcp_dns_resource_record_set \u2013 Creates a GCP ResourceRecordSet gcp_dns_resource_record_set_info \u2013 Gather info for GCP ResourceRecordSet gcp_filestore_instance \u2013 Creates a GCP Instance gcp_filestore_instance_info \u2013 Gather info for GCP Instance gcp_forwarding_rule \u2013 Create, Update or Destroy a Forwarding_Rule (D) gcp_healthcheck \u2013 Create, Update or Destroy a Healthcheck (D) gcp_iam_role \u2013 Creates a GCP Role gcp_iam_role_info \u2013 Gather info for GCP Role gcp_iam_service_account \u2013 Creates a GCP ServiceAccount gcp_iam_service_account_info \u2013 Gather info for GCP ServiceAccount gcp_iam_service_account_key \u2013 Creates a GCP ServiceAccountKey gcp_kms_crypto_key \u2013 Creates a GCP CryptoKey gcp_kms_crypto_key_info \u2013 Gather info for GCP CryptoKey gcp_kms_key_ring \u2013 Creates a GCP KeyRing gcp_kms_key_ring_info \u2013 Gather info for GCP KeyRing gcp_mlengine_model \u2013 Creates a GCP Model gcp_mlengine_model_info \u2013 Gather info for GCP Model gcp_mlengine_version \u2013 Creates a GCP Version gcp_mlengine_version_info \u2013 Gather info for GCP Version gcp_pubsub_subscription \u2013 Creates a GCP Subscription gcp_pubsub_subscription_info \u2013 Gather info for GCP Subscription gcp_pubsub_topic \u2013 Creates a GCP Topic gcp_pubsub_topic_info \u2013 Gather info for GCP Topic gcp_redis_instance \u2013 Creates a GCP Instance gcp_redis_instance_info \u2013 Gather info for GCP Instance gcp_resourcemanager_project \u2013 Creates a GCP Project gcp_resourcemanager_project_info \u2013 Gather info for GCP Project gcp_sourcerepo_repository \u2013 Creates a GCP Repository gcp_sourcerepo_repository_info \u2013 Gather info for GCP Repository gcp_spanner_database \u2013 Creates a GCP Database gcp_spanner_database_info \u2013 Gather info for GCP Database gcp_spanner_instance \u2013 Creates a GCP Instance gcp_spanner_instance_info \u2013 Gather info for GCP Instance gcp_sql_database \u2013 Creates a GCP Database gcp_sql_database_info \u2013 Gather info for GCP Database gcp_sql_instance \u2013 Creates a GCP Instance gcp_sql_instance_info \u2013 Gather info for GCP Instance gcp_sql_user \u2013 Creates a GCP User gcp_sql_user_info \u2013 Gather info for GCP User gcp_storage_bucket \u2013 Creates a GCP Bucket gcp_storage_bucket_access_control \u2013 Creates a GCP BucketAccessControl gcp_storage_object \u2013 Creates a GCP Object gcp_target_proxy \u2013 Create, Update or Destroy a Target_Proxy (D) gcp_tpu_node \u2013 Creates a GCP Node gcp_tpu_node_info \u2013 Gather info for GCP Node gcp_url_map \u2013 Create, Update or Destroy a Url_Map (D) gcpubsub \u2013 Create and Delete Topics/Subscriptions, Publish and pull messages on PubSub gcpubsub_info \u2013 List Topics/Subscriptions and Messages from Google PubSub gcspanner \u2013 Create and Delete Instances/Databases on Spanner (D) Hcloud \u00b6 hcloud_datacenter_info \u2013 Gather info about the Hetzner Cloud datacenters hcloud_floating_ip_info \u2013 Gather infos about the Hetzner Cloud Floating IPs hcloud_image_info \u2013 Gather infos about your Hetzner Cloud images hcloud_location_info \u2013 Gather infos about your Hetzner Cloud locations hcloud_network \u2013 Create and manage cloud Networks on the Hetzner Cloud hcloud_network_info \u2013 Gather info about your Hetzner Cloud networks hcloud_rdns \u2013 Create and manage reverse DNS entries on the Hetzner Cloud hcloud_route \u2013 Create and delete cloud routes on the Hetzner Cloud hcloud_server \u2013 Create and manage cloud servers on the Hetzner Cloud hcloud_server_info \u2013 Gather infos about your Hetzner Cloud servers hcloud_server_network \u2013 Manage the relationship between Hetzner Cloud Networks and servers hcloud_server_type_info \u2013 Gather infos about the Hetzner Cloud server types hcloud_ssh_key \u2013 Create and manage ssh keys on the Hetzner Cloud hcloud_ssh_key_info \u2013 Gather infos about your Hetzner Cloud ssh_keys hcloud_subnetwork \u2013 Manage cloud subnetworks on the Hetzner Cloud hcloud_volume \u2013 Create and manage block volumes on the Hetzner Cloud hcloud_volume_info \u2013 Gather infos about your Hetzner Cloud volumes Heroku \u00b6 heroku_collaborator \u2013 Add or delete app collaborators on Heroku Huawei \u00b6 hwc_network_vpc \u2013 Creates a Huawei Cloud VPC hwc_smn_topic \u2013 Creates a resource of SMNTopic in Huaweicloud Cloud Kubevirt \u00b6 kubevirt_cdi_upload \u2013 Upload local VM images to CDI Upload Proxy kubevirt_preset \u2013 Manage KubeVirt virtual machine presets kubevirt_pvc \u2013 Manage PVCs on Kubernetes kubevirt_rs \u2013 Manage KubeVirt virtual machine replica sets kubevirt_template \u2013 Manage KubeVirt templates kubevirt_vm \u2013 Manage KubeVirt virtual machine Linode \u00b6 linode \u2013 Manage instances on the Linode Public Cloud linode_v4 \u2013 Manage instances on the Linode cloud Lxc \u00b6 lxc_container \u2013 Manage LXC Containers Lxd \u00b6 lxd_container \u2013 Manage LXD Containers lxd_profile \u2013 Manage LXD profiles Memset \u00b6 memset_dns_reload \u2013 Request reload of Memset\u2019s DNS infrastructure, memset_memstore_info \u2013 Retrieve Memstore product usage information memset_server_info \u2013 Retrieve server information memset_zone \u2013 Creates and deletes Memset DNS zones memset_zone_domain \u2013 Create and delete domains in Memset DNS zones memset_zone_record \u2013 Create and delete records in Memset DNS zones Misc \u00b6 cloud_init_data_facts \u2013 Retrieve facts of cloud-init helm \u2013 Manages Kubernetes packages with the Helm package manager ovirt \u2013 oVirt/RHEV platform management proxmox \u2013 management of instances in Proxmox VE cluster proxmox_kvm \u2013 Management of Qemu(KVM) Virtual Machines in Proxmox VE cluster proxmox_template \u2013 management of OS templates in Proxmox VE cluster rhevm \u2013 RHEV/oVirt automation serverless \u2013 Manages a Serverless Framework project terraform \u2013 Manages a Terraform deployment (and plans) virt \u2013 Manages virtual machines supported by libvirt virt_net \u2013 Manage libvirt network configuration virt_pool \u2013 Manage libvirt storage pools xenserver_facts \u2013 get facts reported on xenserver Oneandone \u00b6 oneandone_firewall_policy \u2013 Configure 1&1 firewall policy oneandone_load_balancer \u2013 Configure 1&1 load balancer oneandone_monitoring_policy \u2013 Configure 1&1 monitoring policy oneandone_private_network \u2013 Configure 1&1 private networking oneandone_public_ip \u2013 Configure 1&1 public IPs oneandone_server \u2013 Create, destroy, start, stop, and reboot a 1&1 Host server Online \u00b6 online_server_facts \u2013 Gather facts about Online servers (D) online_server_info \u2013 Gather information about Online servers online_user_facts \u2013 Gather facts about Online user (D) online_user_info \u2013 Gather information about Online user Opennebula \u00b6 one_host \u2013 Manages OpenNebula Hosts one_image \u2013 Manages OpenNebula images one_image_info \u2013 Gather information on OpenNebula images one_service \u2013 Deploy and manage OpenNebula services one_vm \u2013 Creates or terminates OpenNebula instances Openstack \u00b6 os_auth \u2013 Retrieve an auth token os_client_config \u2013 Get OpenStack Client config os_coe_cluster \u2013 Add/Remove COE cluster from OpenStack Cloud os_coe_cluster_template \u2013 Add/Remove COE cluster template from OpenStack Cloud os_flavor_info \u2013 Retrieve information about one or more flavors os_floating_ip \u2013 Add/Remove floating IP from an instance os_group \u2013 Manage OpenStack Identity Groups os_group_info \u2013 Retrieve info about one or more OpenStack groups os_image \u2013 Add/Delete images from OpenStack Cloud os_image_info \u2013 Retrieve information about an image within OpenStack os_ironic \u2013 Create/Delete Bare Metal Resources from OpenStack os_ironic_inspect \u2013 Explicitly triggers baremetal node introspection in ironic os_ironic_node \u2013 Activate/Deactivate Bare Metal Resources from OpenStack os_keypair \u2013 Add/Delete a keypair from OpenStack os_keystone_domain \u2013 Manage OpenStack Identity Domains os_keystone_domain_info \u2013 Retrieve information about one or more OpenStack domains os_keystone_endpoint \u2013 Manage OpenStack Identity service endpoints os_keystone_role \u2013 Manage OpenStack Identity Roles os_keystone_service \u2013 Manage OpenStack Identity services os_listener \u2013 Add/Delete a listener for a load balancer from OpenStack Cloud os_loadbalancer \u2013 Add/Delete load balancer from OpenStack Cloud os_member \u2013 Add/Delete a member for a pool in load balancer from OpenStack Cloud os_network \u2013 Creates/removes networks from OpenStack os_networks_info \u2013 Retrieve information about one or more OpenStack networks os_nova_flavor \u2013 Manage OpenStack compute flavors os_nova_host_aggregate \u2013 Manage OpenStack host aggregates os_object \u2013 Create or Delete objects and containers from OpenStack os_pool \u2013 Add/Delete a pool in the load balancing service from OpenStack Cloud os_port \u2013 Add/Update/Delete ports from an OpenStack cloud os_port_info \u2013 Retrieve information about ports within OpenStack os_project \u2013 Manage OpenStack Projects os_project_access \u2013 Manage OpenStack compute flavors access os_project_info \u2013 Retrieve information about one or more OpenStack projects os_quota \u2013 Manage OpenStack Quotas os_recordset \u2013 Manage OpenStack DNS recordsets os_router \u2013 Create or delete routers from OpenStack os_security_group \u2013 Add/Delete security groups from an OpenStack cloud os_security_group_rule \u2013 Add/Delete rule from an existing security group os_server \u2013 Create/Delete Compute Instances from OpenStack os_server_action \u2013 Perform actions on Compute Instances from OpenStack os_server_group \u2013 Manage OpenStack server groups os_server_info \u2013 Retrieve information about one or more compute instances os_server_metadata \u2013 Add/Update/Delete Metadata in Compute Instances from OpenStack os_server_volume \u2013 Attach/Detach Volumes from OpenStack VM\u2019s os_stack \u2013 Add/Remove Heat Stack os_subnet \u2013 Add/Remove subnet to an OpenStack network os_subnets_info \u2013 Retrieve information about one or more OpenStack subnets os_user \u2013 Manage OpenStack Identity Users os_user_group \u2013 Associate OpenStack Identity users and groups os_user_info \u2013 Retrieve information about one or more OpenStack users os_user_role \u2013 Associate OpenStack Identity users and roles os_volume \u2013 Create/Delete Cinder Volumes os_volume_snapshot \u2013 Create/Delete Cinder Volume Snapshots os_zone \u2013 Manage OpenStack DNS zones Oracle \u00b6 oci_vcn \u2013 Manage Virtual Cloud Networks(VCN) in OCI Ovh \u00b6 ovh_ip_failover \u2013 Manage OVH IP failover address ovh_ip_loadbalancing_backend \u2013 Manage OVH IP LoadBalancing backends Ovirt \u00b6 ovirt_affinity_group \u2013 Module to manage affinity groups in oVirt/RHV ovirt_affinity_label \u2013 Module to manage affinity labels in oVirt/RHV ovirt_affinity_label_info \u2013 Retrieve information about one or more oVirt/RHV affinity labels ovirt_api_info \u2013 Retrieve information about the oVirt/RHV API ovirt_auth \u2013 Module to manage authentication to oVirt/RHV ovirt_cluster \u2013 Module to manage clusters in oVirt/RHV ovirt_cluster_info \u2013 Retrieve information about one or more oVirt/RHV clusters ovirt_datacenter \u2013 Module to manage data centers in oVirt/RHV ovirt_datacenter_info \u2013 Retrieve information about one or more oVirt/RHV datacenters ovirt_disk \u2013 Module to manage Virtual Machine and floating disks in oVirt/RHV ovirt_disk_info \u2013 Retrieve information about one or more oVirt/RHV disks ovirt_event \u2013 Create or delete an event in oVirt/RHV ovirt_event_info \u2013 This module can be used to retrieve information about one or more oVirt/RHV events ovirt_external_provider \u2013 Module to manage external providers in oVirt/RHV ovirt_external_provider_info \u2013 Retrieve information about one or more oVirt/RHV external providers ovirt_group \u2013 Module to manage groups in oVirt/RHV ovirt_group_info \u2013 Retrieve information about one or more oVirt/RHV groups ovirt_host \u2013 Module to manage hosts in oVirt/RHV ovirt_host_info \u2013 Retrieve information about one or more oVirt/RHV hosts ovirt_host_network \u2013 Module to manage host networks in oVirt/RHV ovirt_host_pm \u2013 Module to manage power management of hosts in oVirt/RHV ovirt_host_storage_info \u2013 Retrieve information about one or more oVirt/RHV HostStorages (applicable only for block storage) ovirt_instance_type \u2013 Module to manage Instance Types in oVirt/RHV ovirt_job \u2013 Module to manage jobs in oVirt/RHV ovirt_mac_pool \u2013 Module to manage MAC pools in oVirt/RHV ovirt_network \u2013 Module to manage logical networks in oVirt/RHV ovirt_network_info \u2013 Retrieve information about one or more oVirt/RHV networks ovirt_nic \u2013 Module to manage network interfaces of Virtual Machines in oVirt/RHV ovirt_nic_info \u2013 Retrieve information about one or more oVirt/RHV virtual machine network interfaces ovirt_permission \u2013 Module to manage permissions of users/groups in oVirt/RHV ovirt_permission_info \u2013 Retrieve information about one or more oVirt/RHV permissions ovirt_quota \u2013 Module to manage datacenter quotas in oVirt/RHV ovirt_quota_info \u2013 Retrieve information about one or more oVirt/RHV quotas ovirt_role \u2013 Module to manage roles in oVirt/RHV ovirt_scheduling_policy_info \u2013 Retrieve information about one or more oVirt scheduling policies ovirt_snapshot \u2013 Module to manage Virtual Machine Snapshots in oVirt/RHV ovirt_snapshot_info \u2013 Retrieve information about one or more oVirt/RHV virtual machine snapshots ovirt_storage_connection \u2013 Module to manage storage connections in oVirt ovirt_storage_domain \u2013 Module to manage storage domains in oVirt/RHV ovirt_storage_domain_info \u2013 Retrieve information about one or more oVirt/RHV storage domains ovirt_storage_template_info \u2013 Retrieve information about one or more oVirt/RHV templates relate to a storage domain ovirt_storage_vm_info \u2013 Retrieve information about one or more oVirt/RHV virtual machines relate to a storage domain ovirt_tag \u2013 Module to manage tags in oVirt/RHV ovirt_tag_info \u2013 Retrieve information about one or more oVirt/RHV tags ovirt_template \u2013 Module to manage virtual machine templates in oVirt/RHV ovirt_template_info \u2013 Retrieve information about one or more oVirt/RHV templates ovirt_user \u2013 Module to manage users in oVirt/RHV ovirt_user_info \u2013 Retrieve information about one or more oVirt/RHV users ovirt_vm \u2013 Module to manage Virtual Machines in oVirt/RHV ovirt_vm_info \u2013 Retrieve information about one or more oVirt/RHV virtual machines ovirt_vmpool \u2013 Module to manage VM pools in oVirt/RHV ovirt_vmpool_info \u2013 Retrieve information about one or more oVirt/RHV vmpools ovirt_vnic_profile \u2013 Module to manage vNIC profile of network in oVirt/RHV Packet \u00b6 packet_device \u2013 Manage a bare metal server in the Packet Host packet_sshkey \u2013 Create/delete an SSH key in Packet host Podman \u00b6 podman_image \u2013 Pull images for use by podman podman_image_info \u2013 Gather info about images using podman Profitbricks \u00b6 profitbricks \u2013 Create, destroy, start, stop, and reboot a ProfitBricks virtual machine profitbricks_datacenter \u2013 Create or destroy a ProfitBricks Virtual Datacenter profitbricks_nic \u2013 Create or Remove a NIC profitbricks_volume \u2013 Create or destroy a volume profitbricks_volume_attachments \u2013 Attach or detach a volume Pubnub \u00b6 pubnub_blocks \u2013 PubNub blocks management module Rackspace \u00b6 rax \u2013 create / delete an instance in Rackspace Public Cloud rax_cbs \u2013 Manipulate Rackspace Cloud Block Storage Volumes rax_cbs_attachments \u2013 Manipulate Rackspace Cloud Block Storage Volume Attachments rax_cdb \u2013 create/delete or resize a Rackspace Cloud Databases instance rax_cdb_database \u2013 create / delete a database in the Cloud Databases rax_cdb_user \u2013 create / delete a Rackspace Cloud Database rax_clb \u2013 create / delete a load balancer in Rackspace Public Cloud rax_clb_nodes \u2013 add, modify and remove nodes from a Rackspace Cloud Load Balancer rax_clb_ssl \u2013 Manage SSL termination for a Rackspace Cloud Load Balancer rax_dns \u2013 Manage domains on Rackspace Cloud DNS rax_dns_record \u2013 Manage DNS records on Rackspace Cloud DNS rax_facts \u2013 Gather facts for Rackspace Cloud Servers rax_files \u2013 Manipulate Rackspace Cloud Files Containers rax_files_objects \u2013 Upload, download, and delete objects in Rackspace Cloud Files rax_identity \u2013 Load Rackspace Cloud Identity rax_keypair \u2013 Create a keypair for use with Rackspace Cloud Servers rax_meta \u2013 Manipulate metadata for Rackspace Cloud Servers rax_mon_alarm \u2013 Create or delete a Rackspace Cloud Monitoring alarm rax_mon_check \u2013 Create or delete a Rackspace Cloud Monitoring check for an existing entity rax_mon_entity \u2013 Create or delete a Rackspace Cloud Monitoring entity rax_mon_notification \u2013 Create or delete a Rackspace Cloud Monitoring notification rax_mon_notification_plan \u2013 Create or delete a Rackspace Cloud Monitoring notification plan rax_network \u2013 create / delete an isolated network in Rackspace Public Cloud rax_queue \u2013 create / delete a queue in Rackspace Public Cloud rax_scaling_group \u2013 Manipulate Rackspace Cloud Autoscale Groups rax_scaling_policy \u2013 Manipulate Rackspace Cloud Autoscale Scaling Policy Scaleway \u00b6 scaleway_compute \u2013 Scaleway compute management module scaleway_image_facts \u2013 Gather facts about the Scaleway images available (D) scaleway_image_info \u2013 Gather information about the Scaleway images available scaleway_ip \u2013 Scaleway IP management module scaleway_ip_facts \u2013 Gather facts about the Scaleway ips available (D) scaleway_ip_info \u2013 Gather information about the Scaleway ips available scaleway_lb \u2013 Scaleway load-balancer management module scaleway_organization_facts \u2013 Gather facts about the Scaleway organizations available (D) scaleway_organization_info \u2013 Gather information about the Scaleway organizations available scaleway_security_group \u2013 Scaleway Security Group management module scaleway_security_group_facts \u2013 Gather facts about the Scaleway security groups available (D) scaleway_security_group_info \u2013 Gather information about the Scaleway security groups available scaleway_security_group_rule \u2013 Scaleway Security Group Rule management module scaleway_server_facts \u2013 Gather facts about the Scaleway servers available (D) scaleway_server_info \u2013 Gather information about the Scaleway servers available scaleway_snapshot_facts \u2013 Gather facts about the Scaleway snapshots available (D) scaleway_snapshot_info \u2013 Gather information about the Scaleway snapshots available scaleway_sshkey \u2013 Scaleway SSH keys management module scaleway_user_data \u2013 Scaleway user_data management module scaleway_volume \u2013 Scaleway volumes management module scaleway_volume_facts \u2013 Gather facts about the Scaleway volumes available (D) scaleway_volume_info \u2013 Gather information about the Scaleway volumes available Smartos \u00b6 imgadm \u2013 Manage SmartOS images nictagadm \u2013 Manage nic tags on SmartOS systems smartos_image_info \u2013 Get SmartOS image details vmadm \u2013 Manage SmartOS virtual machines and zones Softlayer \u00b6 sl_vm \u2013 create or cancel a virtual instance in SoftLayer Spotinst \u00b6 spotinst_aws_elastigroup \u2013 Create, update or delete Spotinst AWS Elastigroups Univention \u00b6 udm_dns_record \u2013 Manage dns entries on a univention corporate server udm_dns_zone \u2013 Manage dns zones on a univention corporate server udm_group \u2013 Manage of the posix group udm_share \u2013 Manage samba shares on a univention corporate server udm_user \u2013 Manage posix users on a univention corporate server Vmware \u00b6 vca_fw \u2013 add remove firewall rules in a gateway in a vca vca_nat \u2013 add remove nat rules in a gateway in a vca vca_vapp \u2013 Manages vCloud Air vApp instances vcenter_extension \u2013 Register/deregister vCenter Extensions vcenter_extension_facts \u2013 Gather facts vCenter extensions (D) vcenter_extension_info \u2013 Gather info vCenter extensions vcenter_folder \u2013 Manage folders on given datacenter vcenter_license \u2013 Manage VMware vCenter license keys vmware_about_facts \u2013 Provides information about VMware server to which user is connecting to (D) vmware_about_info \u2013 Provides information about VMware server to which user is connecting to vmware_category \u2013 Manage VMware categories vmware_category_facts \u2013 Gather facts about VMware tag categories (D) vmware_category_info \u2013 Gather info about VMware tag categories vmware_cfg_backup \u2013 Backup / Restore / Reset ESXi host configuration vmware_cluster \u2013 Manage VMware vSphere clusters vmware_cluster_drs \u2013 Manage Distributed Resource Scheduler (DRS) on VMware vSphere clusters vmware_cluster_ha \u2013 Manage High Availability (HA) on VMware vSphere clusters vmware_cluster_info \u2013 Gather info about clusters available in given vCenter vmware_cluster_vsan \u2013 Manages virtual storage area network (vSAN) configuration on VMware vSphere clusters vmware_content_deploy_template \u2013 Deploy Virtual Machine from template stored in content library vmware_content_library_info \u2013 Gather information about VMware Content Library vmware_content_library_manager \u2013 Create, update and delete VMware content library vmware_datacenter \u2013 Manage VMware vSphere Datacenters vmware_datastore_cluster \u2013 Manage VMware vSphere datastore clusters vmware_datastore_info \u2013 Gather info about datastores available in given vCenter vmware_datastore_maintenancemode \u2013 Place a datastore into maintenance mode vmware_deploy_ovf \u2013 Deploys a VMware virtual machine from an OVF or OVA file vmware_dns_config \u2013 Manage VMware ESXi DNS Configuration vmware_drs_group \u2013 Creates vm/host group in a given cluster vmware_drs_group_facts \u2013 Gathers facts about DRS VM/Host groups on the given cluster (D) vmware_drs_group_info \u2013 Gathers info about DRS VM/Host groups on the given cluster vmware_drs_rule_facts \u2013 Gathers facts about DRS rule on the given cluster (D) vmware_drs_rule_info \u2013 Gathers info about DRS rule on the given cluster vmware_dvs_host \u2013 Add or remove a host from distributed virtual switch vmware_dvs_portgroup \u2013 Create or remove a Distributed vSwitch portgroup vmware_dvs_portgroup_facts \u2013 Gathers facts DVS portgroup configurations (D) vmware_dvs_portgroup_find \u2013 Find portgroup(s) in a VMware environment vmware_dvs_portgroup_info \u2013 Gathers info DVS portgroup configurations vmware_dvswitch \u2013 Create or remove a Distributed Switch vmware_dvswitch_lacp \u2013 Manage LACP configuration on a Distributed Switch vmware_dvswitch_nioc \u2013 Manage distributed switch Network IO Control vmware_dvswitch_pvlans \u2013 Manage Private VLAN configuration of a Distributed Switch vmware_dvswitch_uplink_pg \u2013 Manage uplink portproup configuration of a Distributed Switch vmware_evc_mode \u2013 Enable/Disable EVC mode on vCenter vmware_export_ovf \u2013 Exports a VMware virtual machine to an OVF file, device files and a manifest file vmware_folder_info \u2013 Provides information about folders in a datacenter vmware_guest \u2013 Manages virtual machines in vCenter vmware_guest_boot_facts \u2013 Gather facts about boot options for the given virtual machine (D) vmware_guest_boot_info \u2013 Gather info about boot options for the given virtual machine vmware_guest_boot_manager \u2013 Manage boot options for the given virtual machine vmware_guest_custom_attribute_defs \u2013 Manage custom attributes definitions for virtual machine from VMware vmware_guest_custom_attributes \u2013 Manage custom attributes from VMware for the given virtual machine vmware_guest_customization_facts \u2013 Gather facts about VM customization specifications (D) vmware_guest_customization_info \u2013 Gather info about VM customization specifications vmware_guest_disk \u2013 Manage disks related to virtual machine in given vCenter infrastructure vmware_guest_disk_facts \u2013 Gather facts about disks of given virtual machine (D) vmware_guest_disk_info \u2013 Gather info about disks of given virtual machine vmware_guest_file_operation \u2013 Files operation in a VMware guest operating system without network vmware_guest_find \u2013 Find the folder path(s) for a virtual machine by name or UUID vmware_guest_info \u2013 Gather info about a single VM vmware_guest_move \u2013 Moves virtual machines in vCenter vmware_guest_network \u2013 Manage network adapters of specified virtual machine in given vCenter infrastructure vmware_guest_powerstate \u2013 Manages power states of virtual machines in vCenter vmware_guest_screenshot \u2013 Create a screenshot of the Virtual Machine console vmware_guest_sendkey \u2013 Send USB HID codes to the Virtual Machine\u2019s keyboard vmware_guest_snapshot \u2013 Manages virtual machines snapshots in vCenter vmware_guest_snapshot_info \u2013 Gather info about virtual machine\u2019s snapshots in vCenter vmware_guest_tools_upgrade \u2013 Module to upgrade VMTools vmware_guest_tools_wait \u2013 Wait for VMware tools to become available vmware_guest_video \u2013 Modify video card configurations of specified virtual machine in given vCenter infrastructure vmware_guest_vnc \u2013 Manages VNC remote display on virtual machines in vCenter vmware_host \u2013 Add, remove, or move an ESXi host to, from, or within vCenter vmware_host_acceptance \u2013 Manage the host acceptance level of an ESXi host vmware_host_active_directory \u2013 Joins an ESXi host system to an Active Directory domain or leaves it vmware_host_capability_facts \u2013 Gathers facts about an ESXi host\u2019s capability information (D) vmware_host_capability_info \u2013 Gathers info about an ESXi host\u2019s capability information vmware_host_config_facts \u2013 Gathers facts about an ESXi host\u2019s advance configuration information (D) vmware_host_config_info \u2013 Gathers info about an ESXi host\u2019s advance configuration information vmware_host_config_manager \u2013 Manage advanced system settings of an ESXi host vmware_host_datastore \u2013 Manage a datastore on ESXi host vmware_host_dns_facts \u2013 Gathers facts about an ESXi host\u2019s DNS configuration information (D) vmware_host_dns_info \u2013 Gathers info about an ESXi host\u2019s DNS configuration information vmware_host_facts \u2013 Gathers facts about remote ESXi hostsystem vmware_host_feature_facts \u2013 Gathers facts about an ESXi host\u2019s feature capability information (D) vmware_host_feature_info \u2013 Gathers info about an ESXi host\u2019s feature capability information vmware_host_firewall_facts \u2013 Gathers facts about an ESXi host\u2019s firewall configuration information (D) vmware_host_firewall_info \u2013 Gathers info about an ESXi host\u2019s firewall configuration information vmware_host_firewall_manager \u2013 Manage firewall configurations about an ESXi host vmware_host_hyperthreading \u2013 Enables/Disables Hyperthreading optimization for an ESXi host system vmware_host_ipv6 \u2013 Enables/Disables IPv6 support for an ESXi host system vmware_host_kernel_manager \u2013 Manage kernel module options on ESXi hosts vmware_host_lockdown \u2013 Manage administrator permission for the local administrative account for the ESXi host vmware_host_ntp \u2013 Manage NTP server configuration of an ESXi host vmware_host_ntp_facts \u2013 Gathers facts about NTP configuration on an ESXi host (D) vmware_host_ntp_info \u2013 Gathers info about NTP configuration on an ESXi host vmware_host_package_facts \u2013 Gathers facts about available packages on an ESXi host (D) vmware_host_package_info \u2013 Gathers info about available packages on an ESXi host vmware_host_powermgmt_policy \u2013 Manages the Power Management Policy of an ESXI host system vmware_host_powerstate \u2013 Manages power states of host systems in vCenter vmware_host_scanhba \u2013 Rescan host HBA\u2019s and optionally refresh the storage system vmware_host_service_facts \u2013 Gathers facts about an ESXi host\u2019s services (D) vmware_host_service_info \u2013 Gathers info about an ESXi host\u2019s services vmware_host_service_manager \u2013 Manage services on a given ESXi host vmware_host_snmp \u2013 Configures SNMP on an ESXi host system vmware_host_ssl_facts \u2013 Gather facts of ESXi host system about SSL (D) vmware_host_ssl_info \u2013 Gather info of ESXi host system about SSL vmware_host_vmhba_facts \u2013 Gathers facts about vmhbas available on the given ESXi host (D) vmware_host_vmhba_info \u2013 Gathers info about vmhbas available on the given ESXi host vmware_host_vmnic_facts \u2013 Gathers facts about vmnics available on the given ESXi host (D) vmware_host_vmnic_info \u2013 Gathers info about vmnics available on the given ESXi host vmware_local_role_facts \u2013 Gather facts about local roles on an ESXi host (D) vmware_local_role_info \u2013 Gather info about local roles on an ESXi host vmware_local_role_manager \u2013 Manage local roles on an ESXi host vmware_local_user_facts \u2013 Gather facts about users on the given ESXi host (D) vmware_local_user_info \u2013 Gather info about users on the given ESXi host vmware_local_user_manager \u2013 Manage local users on an ESXi host vmware_maintenancemode \u2013 Place a host into maintenance mode vmware_migrate_vmk \u2013 Migrate a VMK interface from VSS to VDS vmware_object_role_permission \u2013 Manage local roles on an ESXi host vmware_portgroup \u2013 Create a VMware portgroup vmware_portgroup_facts \u2013 Gathers facts about an ESXi host\u2019s Port Group configuration (D) vmware_portgroup_info \u2013 Gathers info about an ESXi host\u2019s Port Group configuration vmware_resource_pool \u2013 Add/remove resource pools to/from vCenter vmware_resource_pool_facts \u2013 Gathers facts about resource pool information (D) vmware_resource_pool_info \u2013 Gathers info about resource pool information vmware_tag \u2013 Manage VMware tags vmware_tag_info \u2013 Manage VMware tag info vmware_tag_manager \u2013 Manage association of VMware tags with VMware objects vmware_target_canonical_facts \u2013 Return canonical (NAA) from an ESXi host system (D) vmware_target_canonical_info \u2013 Return canonical (NAA) from an ESXi host system vmware_vcenter_settings \u2013 Configures general settings on a vCenter server vmware_vcenter_statistics \u2013 Configures statistics on a vCenter server vmware_vm_host_drs_rule \u2013 Creates vm/host group in a given cluster vmware_vm_info \u2013 Return basic info pertaining to a VMware machine guest vmware_vm_shell \u2013 Run commands in a VMware guest operating system vmware_vm_storage_policy_info \u2013 Gather information about vSphere storage profile defined storage policy information vmware_vm_vm_drs_rule \u2013 Configure VMware DRS Affinity rule for virtual machine in given cluster vmware_vm_vss_dvs_migrate \u2013 Migrates a virtual machine from a standard vswitch to distributed vmware_vmkernel \u2013 Manages a VMware VMkernel Adapter of an ESXi host vmware_vmkernel_facts \u2013 Gathers VMKernel facts about an ESXi host (D) vmware_vmkernel_info \u2013 Gathers VMKernel info about an ESXi host vmware_vmkernel_ip_config \u2013 Configure the VMkernel IP Address vmware_vmotion \u2013 Move a virtual machine using vMotion, and/or its vmdks using storage vMotion vmware_vsan_cluster \u2013 Configure VSAN clustering on an ESXi host vmware_vspan_session \u2013 Create or remove a Port Mirroring session vmware_vswitch \u2013 Manage a VMware Standard Switch to an ESXi host vmware_vswitch_facts \u2013 Gathers facts about an ESXi host\u2019s vswitch configurations (D) vmware_vswitch_info \u2013 Gathers info about an ESXi host\u2019s vswitch configurations vsphere_copy \u2013 Copy a file to a VMware datastore vsphere_file \u2013 Manage files on a vCenter datastore Vultr \u00b6 vultr_account_facts \u2013 Gather facts about the Vultr account (D) vultr_account_info \u2013 Get information about the Vultr account vultr_block_storage \u2013 Manages block storage volumes on Vultr vultr_block_storage_facts \u2013 Gather facts about the Vultr block storage volumes available (D) vultr_block_storage_info \u2013 Get information about the Vultr block storage volumes available vultr_dns_domain \u2013 Manages DNS domains on Vultr vultr_dns_domain_facts \u2013 Gather facts about the Vultr DNS domains available (D) vultr_dns_domain_info \u2013 Gather information about the Vultr DNS domains available vultr_dns_record \u2013 Manages DNS records on Vultr vultr_firewall_group \u2013 Manages firewall groups on Vultr vultr_firewall_group_facts \u2013 Gather facts about the Vultr firewall groups available (D) vultr_firewall_group_info \u2013 Gather information about the Vultr firewall groups available vultr_firewall_rule \u2013 Manages firewall rules on Vultr vultr_network \u2013 Manages networks on Vultr vultr_network_facts \u2013 Gather facts about the Vultr networks available (D) vultr_network_info \u2013 Gather information about the Vultr networks available vultr_os_facts \u2013 Gather facts about the Vultr OSes available (D) vultr_os_info \u2013 Get information about the Vultr OSes available vultr_plan_facts \u2013 Gather facts about the Vultr plans available (D) vultr_plan_info \u2013 Gather information about the Vultr plans available vultr_region_facts \u2013 Gather facts about the Vultr regions available (D) vultr_region_info \u2013 Gather information about the Vultr regions available vultr_server \u2013 Manages virtual servers on Vultr vultr_server_facts \u2013 Gather facts about the Vultr servers available (D) vultr_server_info \u2013 Gather information about the Vultr servers available vultr_ssh_key \u2013 Manages ssh keys on Vultr vultr_ssh_key_facts \u2013 Gather facts about the Vultr SSH keys available (D) vultr_ssh_key_info \u2013 Get information about the Vultr SSH keys available vultr_startup_script \u2013 Manages startup scripts on Vultr vultr_startup_script_facts \u2013 Gather facts about the Vultr startup scripts available (D) vultr_startup_script_info \u2013 Gather information about the Vultr startup scripts available vultr_user \u2013 Manages users on Vultr vultr_user_facts \u2013 Gather facts about the Vultr user available (D) vultr_user_info \u2013 Get information about the Vultr user available Webfaction \u00b6 webfaction_app \u2013 Add or remove applications on a Webfaction host webfaction_db \u2013 Add or remove a database on Webfaction webfaction_domain \u2013 Add or remove domains and subdomains on Webfaction webfaction_mailbox \u2013 Add or remove mailboxes on Webfaction webfaction_site \u2013 Add or remove a website on a Webfaction host Xenserver \u00b6 xenserver_guest \u2013 Manages virtual machines running on Citrix Hypervisor/XenServer host or pool xenserver_guest_info \u2013 Gathers information for virtual machines running on Citrix Hypervisor/XenServer host or pool xenserver_guest_powerstate \u2013 Manages power states of virtual machines running on Citrix Hypervisor/XenServer host or pool Clustering modules \u00b6 consul \u2013 Add, modify & delete services within a consul cluster consul_acl \u2013 Manipulate Consul ACL keys and rules consul_kv \u2013 Manipulate entries in the key/value store of a consul cluster consul_session \u2013 Manipulate consul sessions etcd3 \u2013 Set or delete key value pairs from an etcd3 cluster pacemaker_cluster \u2013 Manage pacemaker clusters znode \u2013 Create, delete, retrieve, and update znodes using ZooKeeper K8S \u00b6 k8s \u2013 Manage Kubernetes (K8s) objects k8s_auth \u2013 Authenticate to Kubernetes clusters which require an explicit login step k8s_info \u2013 Describe Kubernetes (K8s) objects k8s_scale \u2013 Set a new size for a Deployment, ReplicaSet, Replication Controller, or Job k8s_service \u2013 Manage Services on Kubernetes Commands modules \u00b6 command \u2013 Execute commands on targets expect \u2013 Executes a command and responds to prompts psexec \u2013 Runs commands on a remote Windows host based on the PsExec model raw \u2013 Executes a low-down and dirty command script \u2013 Runs a local script on a remote node after transferring it shell \u2013 Execute shell commands on targets telnet \u2013 Executes a low-down and dirty telnet command Crypto modules \u00b6 certificate_complete_chain \u2013 Complete certificate chain given a set of untrusted and root certificates get_certificate \u2013 Get a certificate from a host:port luks_device \u2013 Manage encrypted (LUKS) devices openssh_cert \u2013 Generate OpenSSH host or user certificates openssh_keypair \u2013 Generate OpenSSH private and public keys openssl_certificate \u2013 Generate and/or check OpenSSL certificates openssl_certificate_info \u2013 Provide information of OpenSSL X.509 certificates openssl_csr \u2013 Generate OpenSSL Certificate Signing Request (CSR) openssl_csr_info \u2013 Provide information of OpenSSL Certificate Signing Requests (CSR) openssl_dhparam \u2013 Generate OpenSSL Diffie-Hellman Parameters openssl_pkcs12 \u2013 Generate OpenSSL PKCS#12 archive openssl_privatekey \u2013 Generate OpenSSL private keys openssl_privatekey_info \u2013 Provide information for OpenSSL private keys openssl_publickey \u2013 Generate an OpenSSL public key from its private key Acme \u00b6 acme_account \u2013 Create, modify or delete ACME accounts acme_account_info \u2013 Retrieves information on ACME accounts acme_certificate \u2013 Create SSL/TLS certificates with the ACME protocol acme_certificate_revoke \u2013 Revoke certificates with the ACME protocol acme_challenge_cert_helper \u2013 Prepare certificates required for ACME challenges such as tls-alpn-01 acme_inspect \u2013 Send direct requests to an ACME server Entrust \u00b6 ecs_certificate \u2013 Request SSL/TLS certificates with the Entrust Certificate Services (ECS) API Database modules \u00b6 Aerospike \u00b6 aerospike_migrations \u2013 Check or wait for migrations between nodes Influxdb \u00b6 influxdb_database \u2013 Manage InfluxDB databases influxdb_query \u2013 Query data points from InfluxDB influxdb_retention_policy \u2013 Manage InfluxDB retention policies influxdb_user \u2013 Manage InfluxDB users influxdb_write \u2013 Write data points into InfluxDB Misc \u00b6 elasticsearch_plugin \u2013 Manage Elasticsearch plugins kibana_plugin \u2013 Manage Kibana plugins redis \u2013 Various redis commands, slave and flush riak \u2013 This module handles some common Riak operations Mongodb \u00b6 mongodb_parameter \u2013 Change an administrative parameter on a MongoDB server mongodb_replicaset \u2013 Initialises a MongoDB replicaset mongodb_shard \u2013 Add and remove shards from a MongoDB Cluster mongodb_user \u2013 Adds or removes a user from a MongoDB database Mssql \u00b6 mssql_db \u2013 Add or remove MSSQL databases from a remote host Mysql \u00b6 mysql_db \u2013 Add or remove MySQL databases from a remote host mysql_info \u2013 Gather information about MySQL servers mysql_replication \u2013 Manage MySQL replication mysql_user \u2013 Adds or removes a user from a MySQL database mysql_variables \u2013 Manage MySQL global variables Postgresql \u00b6 postgresql_copy \u2013 Copy data between a file/program and a PostgreSQL table postgresql_db \u2013 Add or remove PostgreSQL databases from a remote host postgresql_ext \u2013 Add or remove PostgreSQL extensions from a database postgresql_idx \u2013 Create or drop indexes from a PostgreSQL database postgresql_info \u2013 Gather information about PostgreSQL servers postgresql_lang \u2013 Adds, removes or changes procedural languages with a PostgreSQL database postgresql_membership \u2013 Add or remove PostgreSQL roles from groups postgresql_owner \u2013 Change an owner of PostgreSQL database object postgresql_pg_hba \u2013 Add, remove or modify a rule in a pg_hba file postgresql_ping \u2013 Check remote PostgreSQL server availability postgresql_privs \u2013 Grant or revoke privileges on PostgreSQL database objects postgresql_publication \u2013 Add, update, or remove PostgreSQL publication postgresql_query \u2013 Run PostgreSQL queries postgresql_schema \u2013 Add or remove PostgreSQL schema postgresql_sequence \u2013 Create, drop, or alter a PostgreSQL sequence postgresql_set \u2013 Change a PostgreSQL server configuration parameter postgresql_slot \u2013 Add or remove replication slots from a PostgreSQL database postgresql_table \u2013 Create, drop, or modify a PostgreSQL table postgresql_tablespace \u2013 Add or remove PostgreSQL tablespaces from remote hosts postgresql_user \u2013 Add or remove a user (role) from a PostgreSQL server instance Proxysql \u00b6 proxysql_backend_servers \u2013 Adds or removes mysql hosts from proxysql admin interface proxysql_global_variables \u2013 Gets or sets the proxysql global variables proxysql_manage_config \u2013 Writes the proxysql configuration settings between layers proxysql_mysql_users \u2013 Adds or removes mysql users from proxysql admin interface proxysql_query_rules \u2013 Modifies query rules using the proxysql admin interface proxysql_replication_hostgroups \u2013 Manages replication hostgroups using the proxysql admin interface proxysql_scheduler \u2013 Adds or removes schedules from proxysql admin interface Vertica \u00b6 vertica_configuration \u2013 Updates Vertica configuration parameters vertica_info \u2013 Gathers Vertica database facts vertica_role \u2013 Adds or removes Vertica database roles and assigns roles to them vertica_schema \u2013 Adds or removes Vertica database schema and roles vertica_user \u2013 Adds or removes Vertica database users and assigns roles Files modules \u00b6 acl \u2013 Set and retrieve file ACL information archive \u2013 Creates a compressed archive of one or more files or trees assemble \u2013 Assemble configuration files from fragments blockinfile \u2013 Insert/update/remove a text block surrounded by marker lines copy \u2013 Copy files to remote locations fetch \u2013 Fetch files from remote nodes file \u2013 Manage files and file properties find \u2013 Return a list of files based on specific criteria ini_file \u2013 Tweak settings in INI files iso_extract \u2013 Extract files from an ISO image lineinfile \u2013 Manage lines in text files patch \u2013 Apply patch files using the GNU patch tool read_csv \u2013 Read a CSV file replace \u2013 Replace all instances of a particular string in a file using a back-referenced regular expression stat \u2013 Retrieve file or file system status synchronize \u2013 A wrapper around rsync to make common tasks in your playbooks quick and easy tempfile \u2013 Creates temporary files and directories template \u2013 Template a file out to a remote server unarchive \u2013 Unpacks an archive after (optionally) copying it from the local machine xattr \u2013 Manage user defined extended attributes xml \u2013 Manage bits and pieces of XML files or strings Identity modules \u00b6 onepassword_info \u2013 Gather items from 1Password Cyberark \u00b6 cyberark_authentication \u2013 Module for CyberArk Vault Authentication using PAS Web Services SDK cyberark_user \u2013 Module for CyberArk User Management using PAS Web Services SDK Ipa \u00b6 ipa_config \u2013 Manage Global FreeIPA Configuration Settings ipa_dnsrecord \u2013 Manage FreeIPA DNS records ipa_dnszone \u2013 Manage FreeIPA DNS Zones ipa_group \u2013 Manage FreeIPA group ipa_hbacrule \u2013 Manage FreeIPA HBAC rule ipa_host \u2013 Manage FreeIPA host ipa_hostgroup \u2013 Manage FreeIPA host-group ipa_role \u2013 Manage FreeIPA role ipa_service \u2013 Manage FreeIPA service ipa_subca \u2013 Manage FreeIPA Lightweight Sub Certificate Authorities ipa_sudocmd \u2013 Manage FreeIPA sudo command ipa_sudocmdgroup \u2013 Manage FreeIPA sudo command group ipa_sudorule \u2013 Manage FreeIPA sudo rule ipa_user \u2013 Manage FreeIPA users ipa_vault \u2013 Manage FreeIPA vaults Keycloak \u00b6 keycloak_client \u2013 Allows administration of Keycloak clients via Keycloak API keycloak_clienttemplate \u2013 Allows administration of Keycloak client templates via Keycloak API keycloak_group \u2013 Allows administration of Keycloak groups via Keycloak API Opendj \u00b6 opendj_backendprop \u2013 Will update the backend configuration of OpenDJ via the dsconfig set-backend-prop command Inventory modules \u00b6 add_host \u2013 Add a host (and alternatively a group) to the ansible-playbook in-memory inventory group_by \u2013 Create Ansible groups based on facts Messaging modules \u00b6 Rabbitmq \u00b6 rabbitmq_binding \u2013 Manage rabbitMQ bindings rabbitmq_exchange \u2013 Manage rabbitMQ exchanges rabbitmq_global_parameter \u2013 Manage RabbitMQ global parameters rabbitmq_parameter \u2013 Manage RabbitMQ parameters rabbitmq_plugin \u2013 Manage RabbitMQ plugins rabbitmq_policy \u2013 Manage the state of policies in RabbitMQ rabbitmq_queue \u2013 Manage rabbitMQ queues rabbitmq_user \u2013 Manage RabbitMQ users rabbitmq_vhost \u2013 Manage the state of a virtual host in RabbitMQ rabbitmq_vhost_limits \u2013 Manage the state of virtual host limits in RabbitMQ Monitoring modules \u00b6 airbrake_deployment \u2013 Notify airbrake about app deployments bigpanda \u2013 Notify BigPanda about deployments circonus_annotation \u2013 create an annotation in circonus datadog_event \u2013 Posts events to Datadog service datadog_monitor \u2013 Manages Datadog monitors grafana_dashboard \u2013 Manage Grafana dashboards grafana_datasource \u2013 Manage Grafana datasources grafana_plugin \u2013 Manage Grafana plugins via grafana-cli honeybadger_deployment \u2013 Notify Honeybadger.io about app deployments icinga2_feature \u2013 Manage Icinga2 feature icinga2_host \u2013 Manage a host in Icinga2 librato_annotation \u2013 create an annotation in librato logentries \u2013 Module for tracking logs via logentries.com logicmonitor \u2013 Manage your LogicMonitor account through Ansible Playbooks logicmonitor_facts \u2013 Collect facts about LogicMonitor objects logstash_plugin \u2013 Manage Logstash plugins monit \u2013 Manage the state of a program monitored via Monit nagios \u2013 Perform common tasks in Nagios related to downtime and notifications newrelic_deployment \u2013 Notify newrelic about app deployments pagerduty \u2013 Create PagerDuty maintenance windows pagerduty_alert \u2013 Trigger, acknowledge or resolve PagerDuty incidents pingdom \u2013 Pause/unpause Pingdom alerts rollbar_deployment \u2013 Notify Rollbar about app deployments sensu_check \u2013 Manage Sensu checks sensu_client \u2013 Manages Sensu client configuration sensu_handler \u2013 Manages Sensu handler configuration sensu_silence \u2013 Manage Sensu silence entries sensu_subscription \u2013 Manage Sensu subscriptions spectrum_device \u2013 Creates/deletes devices in CA Spectrum stackdriver \u2013 Send code deploy and annotation events to stackdriver statusio_maintenance \u2013 Create maintenance windows for your status.io dashboard uptimerobot \u2013 Pause and start Uptime Robot monitoring Zabbix \u00b6 zabbix_action \u2013 Create/Delete/Update Zabbix actions zabbix_group \u2013 Create/delete Zabbix host groups zabbix_group_info \u2013 Gather information about Zabbix hostgroup zabbix_host \u2013 Create/update/delete Zabbix hosts zabbix_host_info \u2013 Gather information about Zabbix host zabbix_hostmacro \u2013 Create/update/delete Zabbix host macros zabbix_maintenance \u2013 Create Zabbix maintenance windows zabbix_map \u2013 Create/update/delete Zabbix maps zabbix_mediatype \u2013 Create/Update/Delete Zabbix media types zabbix_proxy \u2013 Create/delete/get/update Zabbix proxies zabbix_screen \u2013 Create/update/delete Zabbix screens zabbix_template \u2013 Create/update/delete/dump Zabbix template Net Tools modules \u00b6 cloudflare_dns \u2013 Manage Cloudflare DNS records dnsimple \u2013 Interface with dnsimple.com (a DNS hosting service) dnsmadeeasy \u2013 Interface with dnsmadeeasy.com (a DNS hosting service) haproxy \u2013 Enable, disable, and set weights for HAProxy backend servers using socket commands hetzner_failover_ip \u2013 Manage Hetzner\u2019s failover IPs hetzner_failover_ip_info \u2013 Retrieve information on Hetzner\u2019s failover IPs ip_netns \u2013 Manage network namespaces ipify_facts \u2013 Retrieve the public IP of your internet gateway ipinfoio_facts \u2013 Retrieve IP geolocation facts of a host\u2019s IP address lldp \u2013 get details reported by lldp netcup_dns \u2013 manage Netcup DNS records nmcli \u2013 Manage Networking nsupdate \u2013 Manage DNS records omapi_host \u2013 Setup OMAPI hosts snmp_facts \u2013 Retrieve facts for a device using SNMP Basics \u00b6 get_url \u2013 Downloads files from HTTP, HTTPS, or FTP to node slurp \u2013 Slurps a file from remote nodes uri \u2013 Interacts with webservices Exoscale \u00b6 exo_dns_domain \u2013 Manages domain records on Exoscale DNS API exo_dns_record \u2013 Manages DNS records on Exoscale DNS Infinity \u00b6 infinity \u2013 Manage Infinity IPAM using Rest API Ldap \u00b6 ldap_attr \u2013 Add or remove LDAP attribute values ldap_entry \u2013 Add or remove LDAP entries ldap_passwd \u2013 Set passwords in LDAP Netbox \u00b6 netbox_device \u2013 Create, update or delete devices within Netbox netbox_interface \u2013 Creates or removes interfaces from Netbox netbox_ip_address \u2013 Creates or removes IP addresses from Netbox netbox_prefix \u2013 Creates or removes prefixes from Netbox netbox_site \u2013 Creates or removes sites from Netbox Nios \u00b6 nios_a_record \u2013 Configure Infoblox NIOS A records nios_aaaa_record \u2013 Configure Infoblox NIOS AAAA records nios_cname_record \u2013 Configure Infoblox NIOS CNAME records nios_dns_view \u2013 Configure Infoblox NIOS DNS views nios_fixed_address \u2013 Configure Infoblox NIOS DHCP Fixed Address nios_host_record \u2013 Configure Infoblox NIOS host records nios_member \u2013 Configure Infoblox NIOS members nios_mx_record \u2013 Configure Infoblox NIOS MX records nios_naptr_record \u2013 Configure Infoblox NIOS NAPTR records nios_network \u2013 Configure Infoblox NIOS network object nios_network_view \u2013 Configure Infoblox NIOS network views nios_nsgroup \u2013 Configure InfoBlox DNS Nameserver Groups nios_ptr_record \u2013 Configure Infoblox NIOS PTR records nios_srv_record \u2013 Configure Infoblox NIOS SRV records nios_txt_record \u2013 Configure Infoblox NIOS txt records nios_zone \u2013 Configure Infoblox NIOS DNS zones Network modules \u00b6 A10 \u00b6 a10_server \u2013 Manage A10 Networks AX/SoftAX/Thunder/vThunder devices\u2019 server object a10_server_axapi3 \u2013 Manage A10 Networks AX/SoftAX/Thunder/vThunder devices a10_service_group \u2013 Manage A10 Networks AX/SoftAX/Thunder/vThunder devices\u2019 service groups a10_virtual_server \u2013 Manage A10 Networks AX/SoftAX/Thunder/vThunder devices\u2019 virtual servers Aci \u00b6 aci_aaa_user \u2013 Manage AAA users (aaa:User) aci_aaa_user_certificate \u2013 Manage AAA user certificates (aaa:UserCert) aci_access_port_block_to_access_port \u2013 Manage port blocks of Fabric interface policy leaf profile interface selectors (infra:HPortS, infra:PortBlk) aci_access_port_to_interface_policy_leaf_profile \u2013 Manage Fabric interface policy leaf profile interface selectors (infra:HPortS, infra:RsAccBaseGrp, infra:PortBlk) aci_access_sub_port_block_to_access_port \u2013 Manage sub port blocks of Fabric interface policy leaf profile interface selectors (infra:HPortS, infra:SubPortBlk) aci_aep \u2013 Manage attachable Access Entity Profile (AEP) objects (infra:AttEntityP, infra:ProvAcc) aci_aep_to_domain \u2013 Bind AEPs to Physical or Virtual Domains (infra:RsDomP) aci_ap \u2013 Manage top level Application Profile (AP) objects (fv:Ap) aci_bd \u2013 Manage Bridge Domains (BD) objects (fv:BD) aci_bd_subnet \u2013 Manage Subnets (fv:Subnet) aci_bd_to_l3out \u2013 Bind Bridge Domain to L3 Out (fv:RsBDToOut) aci_config_rollback \u2013 Provides rollback and rollback preview functionality (config:ImportP) aci_config_snapshot \u2013 Manage Config Snapshots (config:Snapshot, config:ExportP) aci_contract \u2013 Manage contract resources (vz:BrCP) aci_contract_subject \u2013 Manage initial Contract Subjects (vz:Subj) aci_contract_subject_to_filter \u2013 Bind Contract Subjects to Filters (vz:RsSubjFiltAtt) aci_domain \u2013 Manage physical, virtual, bridged, routed or FC domain profiles (phys:DomP, vmm:DomP, l2ext:DomP, l3ext:DomP, fc:DomP) aci_domain_to_encap_pool \u2013 Bind Domain to Encap Pools (infra:RsVlanNs) aci_domain_to_vlan_pool \u2013 Bind Domain to VLAN Pools (infra:RsVlanNs) aci_encap_pool \u2013 Manage encap pools (fvns:VlanInstP, fvns:VxlanInstP, fvns:VsanInstP) aci_encap_pool_range \u2013 Manage encap ranges assigned to pools (fvns:EncapBlk, fvns:VsanEncapBlk) aci_epg \u2013 Manage End Point Groups (EPG) objects (fv:AEPg) aci_epg_monitoring_policy \u2013 Manage monitoring policies (mon:EPGPol) aci_epg_to_contract \u2013 Bind EPGs to Contracts (fv:RsCons, fv:RsProv) aci_epg_to_domain \u2013 Bind EPGs to Domains (fv:RsDomAtt) aci_fabric_node \u2013 Manage Fabric Node Members (fabric:NodeIdentP) aci_fabric_scheduler \u2013 This modules creates ACI schedulers aci_filter \u2013 Manages top level filter objects (vz:Filter) aci_filter_entry \u2013 Manage filter entries (vz:Entry) aci_firmware_group \u2013 This module creates a firmware group aci_firmware_group_node \u2013 This modules adds and remove nodes from the firmware group aci_firmware_policy \u2013 This creates a firmware policy aci_firmware_source \u2013 Manage firmware image sources (firmware:OSource) aci_interface_policy_cdp \u2013 Manage CDP interface policies (cdp:IfPol) aci_interface_policy_fc \u2013 Manage Fibre Channel interface policies (fc:IfPol) aci_interface_policy_l2 \u2013 Manage Layer 2 interface policies (l2:IfPol) aci_interface_policy_leaf_policy_group \u2013 Manage fabric interface policy leaf policy groups (infra:AccBndlGrp, infra:AccPortGrp) aci_interface_policy_leaf_profile \u2013 Manage fabric interface policy leaf profiles (infra:AccPortP) aci_interface_policy_lldp \u2013 Manage LLDP interface policies (lldp:IfPol) aci_interface_policy_mcp \u2013 Manage MCP interface policies (mcp:IfPol) aci_interface_policy_ospf \u2013 Manage OSPF interface policies (ospf:IfPol) aci_interface_policy_port_channel \u2013 Manage port channel interface policies (lacp:LagPol) aci_interface_policy_port_security \u2013 Manage port security (l2:PortSecurityPol) aci_interface_selector_to_switch_policy_leaf_profile \u2013 Bind interface selector profiles to switch policy leaf profiles (infra:RsAccPortP) aci_l3out \u2013 Manage Layer 3 Outside (L3Out) objects (l3ext:Out) aci_l3out_extepg \u2013 Manage External Network Instance Profile (ExtEpg) objects (l3extInstP:instP) aci_l3out_extsubnet \u2013 Manage External Subnet objects (l3extSubnet:extsubnet) aci_l3out_route_tag_policy \u2013 Manage route tag policies (l3ext:RouteTagPol) aci_maintenance_group \u2013 This creates an ACI maintenance group aci_maintenance_group_node \u2013 Manage maintenance group nodes aci_maintenance_policy \u2013 Manage firmware maintenance policies aci_rest \u2013 Direct access to the Cisco APIC REST API aci_static_binding_to_epg \u2013 Bind static paths to EPGs (fv:RsPathAtt) aci_switch_leaf_selector \u2013 Bind leaf selectors to switch policy leaf profiles (infra:LeafS, infra:NodeBlk, infra:RsAccNodePGrep) aci_switch_policy_leaf_profile \u2013 Manage switch policy leaf profiles (infra:NodeP) aci_switch_policy_vpc_protection_group \u2013 Manage switch policy explicit vPC protection groups (fabric:ExplicitGEp, fabric:NodePEp) aci_taboo_contract \u2013 Manage taboo contracts (vz:BrCP) aci_tenant \u2013 Manage tenants (fv:Tenant) aci_tenant_action_rule_profile \u2013 Manage action rule profiles (rtctrl:AttrP) aci_tenant_ep_retention_policy \u2013 Manage End Point (EP) retention protocol policies (fv:EpRetPol) aci_tenant_span_dst_group \u2013 Manage SPAN destination groups (span:DestGrp) aci_tenant_span_src_group \u2013 Manage SPAN source groups (span:SrcGrp) aci_tenant_span_src_group_to_dst_group \u2013 Bind SPAN source groups to destination groups (span:SpanLbl) aci_vlan_pool \u2013 Manage VLAN pools (fvns:VlanInstP) aci_vlan_pool_encap_block \u2013 Manage encap blocks assigned to VLAN pools (fvns:EncapBlk) aci_vmm_credential \u2013 Manage virtual domain credential profiles (vmm:UsrAccP) aci_vrf \u2013 Manage contexts or VRFs (fv:Ctx) mso_label \u2013 Manage labels mso_role \u2013 Manage roles mso_schema \u2013 Manage schemas mso_schema_site \u2013 Manage sites in schemas mso_schema_site_anp \u2013 Manage site-local Application Network Profiles (ANPs) in schema template mso_schema_site_anp_epg \u2013 Manage site-local Endpoint Groups (EPGs) in schema template mso_schema_site_anp_epg_domain \u2013 Manage site-local EPG domains in schema template mso_schema_site_anp_epg_staticleaf \u2013 Manage site-local EPG static leafs in schema template mso_schema_site_anp_epg_staticport \u2013 Manage site-local EPG static ports in schema template mso_schema_site_anp_epg_subnet \u2013 Manage site-local EPG subnets in schema template mso_schema_site_bd \u2013 Manage site-local Bridge Domains (BDs) in schema template mso_schema_site_bd_l3out \u2013 Manage site-local BD l3out\u2019s in schema template mso_schema_site_bd_subnet \u2013 Manage site-local BD subnets in schema template mso_schema_site_vrf \u2013 Manage site-local VRFs in schema template mso_schema_site_vrf_region \u2013 Manage site-local VRF regions in schema template mso_schema_site_vrf_region_cidr \u2013 Manage site-local VRF region CIDRs in schema template mso_schema_site_vrf_region_cidr_subnet \u2013 Manage site-local VRF regions in schema template mso_schema_template \u2013 Manage templates in schemas mso_schema_template_anp \u2013 Manage Application Network Profiles (ANPs) in schema templates mso_schema_template_anp_epg \u2013 Manage Endpoint Groups (EPGs) in schema templates mso_schema_template_anp_epg_contract \u2013 Manage EPG contracts in schema templates mso_schema_template_anp_epg_subnet \u2013 Manage EPG subnets in schema templates mso_schema_template_bd \u2013 Manage Bridge Domains (BDs) in schema templates mso_schema_template_bd_subnet \u2013 Manage BD subnets in schema templates mso_schema_template_contract_filter \u2013 Manage contract filters in schema templates mso_schema_template_deploy \u2013 Deploy schema templates to sites mso_schema_template_externalepg \u2013 Manage external EPGs in schema templates mso_schema_template_filter_entry \u2013 Manage filter entries in schema templates mso_schema_template_l3out \u2013 Manage l3outs in schema templates mso_schema_template_vrf \u2013 Manage VRFs in schema templates mso_site \u2013 Manage sites mso_tenant \u2013 Manage tenants mso_user \u2013 Manage users Aireos \u00b6 aireos_command \u2013 Run commands on remote devices running Cisco WLC aireos_config \u2013 Manage Cisco WLC configurations Aruba \u00b6 aruba_command \u2013 Run commands on remote devices running Aruba Mobility Controller aruba_config \u2013 Manage Aruba configuration sections Asa \u00b6 asa_acl \u2013 Manage access-lists on a Cisco ASA asa_command \u2013 Run arbitrary commands on Cisco ASA devices asa_config \u2013 Manage configuration sections on Cisco ASA devices asa_og \u2013 Manage object groups on a Cisco ASA Avi \u00b6 avi_actiongroupconfig \u2013 Module for setup of ActionGroupConfig Avi RESTful Object avi_alertconfig \u2013 Module for setup of AlertConfig Avi RESTful Object avi_alertemailconfig \u2013 Module for setup of AlertEmailConfig Avi RESTful Object avi_alertscriptconfig \u2013 Module for setup of AlertScriptConfig Avi RESTful Object avi_alertsyslogconfig \u2013 Module for setup of AlertSyslogConfig Avi RESTful Object avi_analyticsprofile \u2013 Module for setup of AnalyticsProfile Avi RESTful Object avi_api_session \u2013 Avi API Module avi_api_version \u2013 Avi API Version Module avi_applicationpersistenceprofile \u2013 Module for setup of ApplicationPersistenceProfile Avi RESTful Object avi_applicationprofile \u2013 Module for setup of ApplicationProfile Avi RESTful Object avi_authprofile \u2013 Module for setup of AuthProfile Avi RESTful Object avi_autoscalelaunchconfig \u2013 Module for setup of AutoScaleLaunchConfig Avi RESTful Object avi_backup \u2013 Module for setup of Backup Avi RESTful Object avi_backupconfiguration \u2013 Module for setup of BackupConfiguration Avi RESTful Object avi_certificatemanagementprofile \u2013 Module for setup of CertificateManagementProfile Avi RESTful Object avi_cloud \u2013 Module for setup of Cloud Avi RESTful Object avi_cloudconnectoruser \u2013 Module for setup of CloudConnectorUser Avi RESTful Object avi_cloudproperties \u2013 Module for setup of CloudProperties Avi RESTful Object avi_cluster \u2013 Module for setup of Cluster Avi RESTful Object avi_clusterclouddetails \u2013 Module for setup of ClusterCloudDetails Avi RESTful Object avi_controllerproperties \u2013 Module for setup of ControllerProperties Avi RESTful Object avi_customipamdnsprofile \u2013 Module for setup of CustomIpamDnsProfile Avi RESTful Object avi_dnspolicy \u2013 Module for setup of DnsPolicy Avi RESTful Object avi_errorpagebody \u2013 Module for setup of ErrorPageBody Avi RESTful Object avi_errorpageprofile \u2013 Module for setup of ErrorPageProfile Avi RESTful Object avi_gslb \u2013 Module for setup of Gslb Avi RESTful Object avi_gslbgeodbprofile \u2013 Module for setup of GslbGeoDbProfile Avi RESTful Object avi_gslbservice \u2013 Module for setup of GslbService Avi RESTful Object avi_gslbservice_patch_member \u2013 Avi API Module avi_hardwaresecuritymodulegroup \u2013 Module for setup of HardwareSecurityModuleGroup Avi RESTful Object avi_healthmonitor \u2013 Module for setup of HealthMonitor Avi RESTful Object avi_httppolicyset \u2013 Module for setup of HTTPPolicySet Avi RESTful Object avi_ipaddrgroup \u2013 Module for setup of IpAddrGroup Avi RESTful Object avi_ipamdnsproviderprofile \u2013 Module for setup of IpamDnsProviderProfile Avi RESTful Object avi_l4policyset \u2013 Module for setup of L4PolicySet Avi RESTful Object avi_microservicegroup \u2013 Module for setup of MicroServiceGroup Avi RESTful Object avi_network \u2013 Module for setup of Network Avi RESTful Object avi_networkprofile \u2013 Module for setup of NetworkProfile Avi RESTful Object avi_networksecuritypolicy \u2013 Module for setup of NetworkSecurityPolicy Avi RESTful Object avi_pkiprofile \u2013 Module for setup of PKIProfile Avi RESTful Object avi_pool \u2013 Module for setup of Pool Avi RESTful Object avi_poolgroup \u2013 Module for setup of PoolGroup Avi RESTful Object avi_poolgroupdeploymentpolicy \u2013 Module for setup of PoolGroupDeploymentPolicy Avi RESTful Object avi_prioritylabels \u2013 Module for setup of PriorityLabels Avi RESTful Object avi_role \u2013 Module for setup of Role Avi RESTful Object avi_scheduler \u2013 Module for setup of Scheduler Avi RESTful Object avi_seproperties \u2013 Module for setup of SeProperties Avi RESTful Object avi_serverautoscalepolicy \u2013 Module for setup of ServerAutoScalePolicy Avi RESTful Object avi_serviceengine \u2013 Module for setup of ServiceEngine Avi RESTful Object avi_serviceenginegroup \u2013 Module for setup of ServiceEngineGroup Avi RESTful Object avi_snmptrapprofile \u2013 Module for setup of SnmpTrapProfile Avi RESTful Object avi_sslkeyandcertificate \u2013 Module for setup of SSLKeyAndCertificate Avi RESTful Object avi_sslprofile \u2013 Module for setup of SSLProfile Avi RESTful Object avi_stringgroup \u2013 Module for setup of StringGroup Avi RESTful Object avi_systemconfiguration \u2013 Module for setup of SystemConfiguration Avi RESTful Object avi_tenant \u2013 Module for setup of Tenant Avi RESTful Object avi_trafficcloneprofile \u2013 Module for setup of TrafficCloneProfile Avi RESTful Object avi_user \u2013 Avi User Module avi_useraccount \u2013 Avi UserAccount Module avi_useraccountprofile \u2013 Module for setup of UserAccountProfile Avi RESTful Object avi_virtualservice \u2013 Module for setup of VirtualService Avi RESTful Object avi_vrfcontext \u2013 Module for setup of VrfContext Avi RESTful Object avi_vsdatascriptset \u2013 Module for setup of VSDataScriptSet Avi RESTful Object avi_vsvip \u2013 Module for setup of VsVip Avi RESTful Object avi_webhook \u2013 Module for setup of Webhook Avi RESTful Object Bigswitch \u00b6 bcf_switch \u2013 Create and remove a bcf switch bigmon_chain \u2013 Create and remove a bigmon inline service chain bigmon_policy \u2013 Create and remove a bigmon out-of-band policy Check_Point \u00b6 checkpoint_access_layer_facts \u2013 Get access layer facts on Check Point over Web Services API checkpoint_access_rule \u2013 Manages access rules on Check Point over Web Services API checkpoint_access_rule_facts \u2013 Get access rules objects facts on Check Point over Web Services API checkpoint_host \u2013 Manages host objects on Check Point over Web Services API checkpoint_host_facts \u2013 Get host objects facts on Check Point over Web Services API checkpoint_object_facts \u2013 Get object facts on Check Point over Web Services API checkpoint_run_script \u2013 Run scripts on Check Point devices over Web Services API checkpoint_session \u2013 Manages session objects on Check Point over Web Services API checkpoint_task_facts \u2013 Get task objects facts on Check Point over Web Services API cp_mgmt_access_layer \u2013 Manages access-layer objects on Check Point over Web Services API cp_mgmt_access_layer_facts \u2013 Get access-layer objects facts on Check Point over Web Services API cp_mgmt_access_role \u2013 Manages access-role objects on Check Point over Web Services API cp_mgmt_access_role_facts \u2013 Get access-role objects facts on Check Point over Web Services API cp_mgmt_access_rule \u2013 Manages access-rule objects on Check Point over Web Services API cp_mgmt_access_rule_facts \u2013 Get access-rule objects facts on Check Point over Web Services API cp_mgmt_address_range \u2013 Manages address-range objects on Check Point over Web Services API cp_mgmt_address_range_facts \u2013 Get address-range objects facts on Check Point over Web Services API cp_mgmt_administrator \u2013 Manages administrator objects on Check Point over Web Services API cp_mgmt_administrator_facts \u2013 Get administrator objects facts on Check Point over Web Services API cp_mgmt_application_site \u2013 Manages application-site objects on Check Point over Web Services API cp_mgmt_application_site_category \u2013 Manages application-site-category objects on Check Point over Web Services API cp_mgmt_application_site_category_facts \u2013 Get application-site-category objects facts on Check Point over Web Services API cp_mgmt_application_site_facts \u2013 Get application-site objects facts on Check Point over Web Services API cp_mgmt_application_site_group \u2013 Manages application-site-group objects on Check Point over Web Services API cp_mgmt_application_site_group_facts \u2013 Get application-site-group objects facts on Check Point over Web Services API cp_mgmt_assign_global_assignment \u2013 assign global assignment on Check Point over Web Services API cp_mgmt_discard \u2013 All changes done by user are discarded and removed from database cp_mgmt_dns_domain \u2013 Manages dns-domain objects on Check Point over Web Services API cp_mgmt_dns_domain_facts \u2013 Get dns-domain objects facts on Check Point over Web Services API cp_mgmt_dynamic_object \u2013 Manages dynamic-object objects on Check Point over Web Services API cp_mgmt_dynamic_object_facts \u2013 Get dynamic-object objects facts on Check Point over Web Services API cp_mgmt_exception_group \u2013 Manages exception-group objects on Check Point over Web Services API cp_mgmt_exception_group_facts \u2013 Get exception-group objects facts on Check Point over Web Services API cp_mgmt_global_assignment \u2013 Manages global-assignment objects on Check Point over Web Services API cp_mgmt_global_assignment_facts \u2013 Get global-assignment objects facts on Check Point over Web Services API cp_mgmt_group \u2013 Manages group objects on Check Point over Web Services API cp_mgmt_group_facts \u2013 Get group objects facts on Check Point over Web Services API cp_mgmt_group_with_exclusion \u2013 Manages group-with-exclusion objects on Check Point over Web Services API cp_mgmt_group_with_exclusion_facts \u2013 Get group-with-exclusion objects facts on Check Point over Web Services API cp_mgmt_host \u2013 Manages host objects on Check Point over Web Services API cp_mgmt_host_facts \u2013 Get host objects facts on Check Point over Web Services API cp_mgmt_install_policy \u2013 install policy on Check Point over Web Services API cp_mgmt_mds_facts \u2013 Get Multi-Domain Server (mds) objects facts on Check Point over Web Services API cp_mgmt_multicast_address_range \u2013 Manages multicast-address-range objects on Check Point over Web Services API cp_mgmt_multicast_address_range_facts \u2013 Get multicast-address-range objects facts on Check Point over Web Services API cp_mgmt_network \u2013 Manages network objects on Check Point over Web Services API cp_mgmt_network_facts \u2013 Get network objects facts on Check Point over Web Services API cp_mgmt_package \u2013 Manages package objects on Check Point over Web Services API cp_mgmt_package_facts \u2013 Get package objects facts on Check Point over Web Services API cp_mgmt_publish \u2013 All the changes done by this user will be seen by all users only after publish is called cp_mgmt_put_file \u2013 put file on Check Point over Web Services API cp_mgmt_run_ips_update \u2013 Runs IPS database update. If \u201cpackage-path\u201d is not provided server will try to get the latest package from the User Center cp_mgmt_run_script \u2013 Executes the script on a given list of targets cp_mgmt_security_zone \u2013 Manages security-zone objects on Check Point over Web Services API cp_mgmt_security_zone_facts \u2013 Get security-zone objects facts on Check Point over Web Services API cp_mgmt_service_dce_rpc \u2013 Manages service-dce-rpc objects on Check Point over Web Services API cp_mgmt_service_dce_rpc_facts \u2013 Get service-dce-rpc objects facts on Check Point over Web Services API cp_mgmt_service_group \u2013 Manages service-group objects on Check Point over Web Services API cp_mgmt_service_group_facts \u2013 Get service-group objects facts on Check Point over Web Services API cp_mgmt_service_icmp \u2013 Manages service-icmp objects on Check Point over Web Services API cp_mgmt_service_icmp6 \u2013 Manages service-icmp6 objects on Check Point over Web Services API cp_mgmt_service_icmp6_facts \u2013 Get service-icmp6 objects facts on Check Point over Web Services API cp_mgmt_service_icmp_facts \u2013 Get service-icmp objects facts on Check Point over Web Services API cp_mgmt_service_other \u2013 Manages service-other objects on Check Point over Web Services API cp_mgmt_service_other_facts \u2013 Get service-other objects facts on Check Point over Web Services API cp_mgmt_service_rpc \u2013 Manages service-rpc objects on Check Point over Web Services API cp_mgmt_service_rpc_facts \u2013 Get service-rpc objects facts on Check Point over Web Services API cp_mgmt_service_sctp \u2013 Manages service-sctp objects on Check Point over Web Services API cp_mgmt_service_sctp_facts \u2013 Get service-sctp objects facts on Check Point over Web Services API cp_mgmt_service_tcp \u2013 Manages service-tcp objects on Check Point over Web Services API cp_mgmt_service_tcp_facts \u2013 Get service-tcp objects facts on Check Point over Web Services API cp_mgmt_service_udp \u2013 Manages service-udp objects on Check Point over Web Services API cp_mgmt_service_udp_facts \u2013 Get service-udp objects facts on Check Point over Web Services API cp_mgmt_session_facts \u2013 Get session objects facts on Check Point over Web Services API cp_mgmt_simple_gateway \u2013 Manages simple-gateway objects on Check Point over Web Services API cp_mgmt_simple_gateway_facts \u2013 Get simple-gateway objects facts on Check Point over Web Services API cp_mgmt_tag \u2013 Manages tag objects on Check Point over Web Services API cp_mgmt_tag_facts \u2013 Get tag objects facts on Check Point over Web Services API cp_mgmt_threat_exception \u2013 Manages threat-exception objects on Check Point over Web Services API cp_mgmt_threat_exception_facts \u2013 Get threat-exception objects facts on Check Point over Web Services API cp_mgmt_threat_indicator \u2013 Manages threat-indicator objects on Check Point over Web Services API cp_mgmt_threat_indicator_facts \u2013 Get threat-indicator objects facts on Check Point over Web Services API cp_mgmt_threat_layer \u2013 Manages threat-layer objects on Check Point over Web Services API cp_mgmt_threat_layer_facts \u2013 Get threat-layer objects facts on Check Point over Web Services API cp_mgmt_threat_profile \u2013 Manages threat-profile objects on Check Point over Web Services API cp_mgmt_threat_profile_facts \u2013 Get threat-profile objects facts on Check Point over Web Services API cp_mgmt_threat_protection_override \u2013 Edit existing object using object name or uid cp_mgmt_threat_rule \u2013 Manages threat-rule objects on Check Point over Web Services API cp_mgmt_threat_rule_facts \u2013 Get threat-rule objects facts on Check Point over Web Services API cp_mgmt_time \u2013 Manages time objects on Check Point over Web Services API cp_mgmt_time_facts \u2013 Get time objects facts on Check Point over Web Services API cp_mgmt_verify_policy \u2013 Verifies the policy of the selected package cp_mgmt_vpn_community_meshed \u2013 Manages vpn-community-meshed objects on Check Point over Web Services API cp_mgmt_vpn_community_meshed_facts \u2013 Get vpn-community-meshed objects facts on Check Point over Web Services API cp_mgmt_vpn_community_star \u2013 Manages vpn-community-star objects on Check Point over Web Services API cp_mgmt_vpn_community_star_facts \u2013 Get vpn-community-star objects facts on Check Point over Web Services API cp_mgmt_wildcard \u2013 Manages wildcard objects on Check Point over Web Services API cp_mgmt_wildcard_facts \u2013 Get wildcard objects facts on Check Point over Web Services API cp_publish \u2013 All the changes done by this user will be seen by all users only after publish is called Cli \u00b6 cli_command \u2013 Run a cli command on cli-based network devices cli_config \u2013 Push text based configuration to network devices over network_cli Cloudengine \u00b6 ce_aaa_server \u2013 Manages AAA server global configuration on HUAWEI CloudEngine switches ce_aaa_server_host \u2013 Manages AAA server host configuration on HUAWEI CloudEngine switches ce_acl \u2013 Manages base ACL configuration on HUAWEI CloudEngine switches ce_acl_advance \u2013 Manages advanced ACL configuration on HUAWEI CloudEngine switches ce_acl_interface \u2013 Manages applying ACLs to interfaces on HUAWEI CloudEngine switches ce_bfd_global \u2013 Manages BFD global configuration on HUAWEI CloudEngine devices ce_bfd_session \u2013 Manages BFD session configuration on HUAWEI CloudEngine devices ce_bfd_view \u2013 Manages BFD session view configuration on HUAWEI CloudEngine devices ce_bgp \u2013 Manages BGP configuration on HUAWEI CloudEngine switches ce_bgp_af \u2013 Manages BGP Address-family configuration on HUAWEI CloudEngine switches ce_bgp_neighbor \u2013 Manages BGP peer configuration on HUAWEI CloudEngine switches ce_bgp_neighbor_af \u2013 Manages BGP neighbor Address-family configuration on HUAWEI CloudEngine switches ce_command \u2013 Run arbitrary command on HUAWEI CloudEngine devices ce_config \u2013 Manage Huawei CloudEngine configuration sections ce_dldp \u2013 Manages global DLDP configuration on HUAWEI CloudEngine switches ce_dldp_interface \u2013 Manages interface DLDP configuration on HUAWEI CloudEngine switches ce_eth_trunk \u2013 Manages Eth-Trunk interfaces on HUAWEI CloudEngine switches ce_evpn_bd_vni \u2013 Manages EVPN VXLAN Network Identifier (VNI) on HUAWEI CloudEngine switches ce_evpn_bgp \u2013 Manages BGP EVPN configuration on HUAWEI CloudEngine switches ce_evpn_bgp_rr \u2013 Manages RR for the VXLAN Network on HUAWEI CloudEngine switches ce_evpn_global \u2013 Manages global configuration of EVPN on HUAWEI CloudEngine switches ce_facts \u2013 Gets facts about HUAWEI CloudEngine switches ce_file_copy \u2013 Copy a file to a remote cloudengine device over SCP on HUAWEI CloudEngine switches ce_info_center_debug \u2013 Manages information center debug configuration on HUAWEI CloudEngine switches ce_info_center_global \u2013 Manages outputting logs on HUAWEI CloudEngine switches ce_info_center_log \u2013 Manages information center log configuration on HUAWEI CloudEngine switches ce_info_center_trap \u2013 Manages information center trap configuration on HUAWEI CloudEngine switches ce_interface \u2013 Manages physical attributes of interfaces on HUAWEI CloudEngine switches ce_interface_ospf \u2013 Manages configuration of an OSPF interface instanceon HUAWEI CloudEngine switches ce_ip_interface \u2013 Manages L3 attributes for IPv4 and IPv6 interfaces on HUAWEI CloudEngine switches ce_link_status \u2013 Get interface link status on HUAWEI CloudEngine switches ce_mlag_config \u2013 Manages MLAG configuration on HUAWEI CloudEngine switches ce_mlag_interface \u2013 Manages MLAG interfaces on HUAWEI CloudEngine switches ce_mtu \u2013 Manages MTU settings on HUAWEI CloudEngine switches ce_netconf \u2013 Run an arbitrary netconf command on HUAWEI CloudEngine switches ce_netstream_aging \u2013 Manages timeout mode of NetStream on HUAWEI CloudEngine switches ce_netstream_export \u2013 Manages netstream export on HUAWEI CloudEngine switches ce_netstream_global \u2013 Manages global parameters of NetStream on HUAWEI CloudEngine switches ce_netstream_template \u2013 Manages NetStream template configuration on HUAWEI CloudEngine switches ce_ntp \u2013 Manages core NTP configuration on HUAWEI CloudEngine switches ce_ntp_auth \u2013 Manages NTP authentication configuration on HUAWEI CloudEngine switches ce_ospf \u2013 Manages configuration of an OSPF instance on HUAWEI CloudEngine switches ce_ospf_vrf \u2013 Manages configuration of an OSPF VPN instance on HUAWEI CloudEngine switches ce_reboot \u2013 Reboot a HUAWEI CloudEngine switches ce_rollback \u2013 Set a checkpoint or rollback to a checkpoint on HUAWEI CloudEngine switches ce_sflow \u2013 Manages sFlow configuration on HUAWEI CloudEngine switches ce_snmp_community \u2013 Manages SNMP community configuration on HUAWEI CloudEngine switches ce_snmp_contact \u2013 Manages SNMP contact configuration on HUAWEI CloudEngine switches ce_snmp_location \u2013 Manages SNMP location configuration on HUAWEI CloudEngine switches ce_snmp_target_host \u2013 Manages SNMP target host configuration on HUAWEI CloudEngine switches ce_snmp_traps \u2013 Manages SNMP traps configuration on HUAWEI CloudEngine switches ce_snmp_user \u2013 Manages SNMP user configuration on HUAWEI CloudEngine switches ce_startup \u2013 Manages a system startup information on HUAWEI CloudEngine switches ce_static_route \u2013 Manages static route configuration on HUAWEI CloudEngine switches ce_stp \u2013 Manages STP configuration on HUAWEI CloudEngine switches ce_switchport \u2013 Manages Layer 2 switchport interfaces on HUAWEI CloudEngine switches ce_vlan \u2013 Manages VLAN resources and attributes on Huawei CloudEngine switches ce_vrf \u2013 Manages VPN instance on HUAWEI CloudEngine switches ce_vrf_af \u2013 Manages VPN instance address family on HUAWEI CloudEngine switches ce_vrf_interface \u2013 Manages interface specific VPN configuration on HUAWEI CloudEngine switches ce_vrrp \u2013 Manages VRRP interfaces on HUAWEI CloudEngine devices ce_vxlan_arp \u2013 Manages ARP attributes of VXLAN on HUAWEI CloudEngine devices ce_vxlan_gateway \u2013 Manages gateway for the VXLAN network on HUAWEI CloudEngine devices ce_vxlan_global \u2013 Manages global attributes of VXLAN and bridge domain on HUAWEI CloudEngine devices ce_vxlan_tunnel \u2013 Manages VXLAN tunnel configuration on HUAWEI CloudEngine devices ce_vxlan_vap \u2013 Manages VXLAN virtual access point on HUAWEI CloudEngine Devices Cloudvision \u00b6 cv_server_provision \u2013 Provision server port by applying or removing template configuration to an Arista CloudVision Portal configlet that is applied to a switch Cnos \u00b6 cnos_backup \u2013 Backup the current running or startup configuration to a remote server on devices running Lenovo CNOS cnos_banner \u2013 Manage multiline banners on Lenovo CNOS devices cnos_bgp \u2013 Manage BGP resources and attributes on devices running CNOS cnos_command \u2013 Run arbitrary commands on Lenovo CNOS devices cnos_conditional_command \u2013 Execute a single command based on condition on devices running Lenovo CNOS cnos_conditional_template \u2013 Manage switch configuration using templates based on condition on devices running Lenovo CNOS cnos_config \u2013 Manage Lenovo CNOS configuration sections cnos_factory \u2013 Reset the switch startup configuration to default (factory) on devices running Lenovo CNOS cnos_facts \u2013 Collect facts from remote devices running Lenovo CNOS cnos_image \u2013 Perform firmware upgrade/download from a remote server on devices running Lenovo CNOS cnos_interface \u2013 Manage Interface on Lenovo CNOS network devices cnos_l2_interface \u2013 Manage Layer-2 interface on Lenovo CNOS devices cnos_l3_interface \u2013 Manage Layer-3 interfaces on Lenovo CNOS network devices cnos_linkagg \u2013 Manage link aggregation groups on Lenovo CNOS devices cnos_lldp \u2013 Manage LLDP configuration on Lenovo CNOS network devices cnos_logging \u2013 Manage logging on network devices cnos_reload \u2013 Perform switch restart on devices running Lenovo CNOS cnos_rollback \u2013 Roll back the running or startup configuration from a remote server on devices running Lenovo CNOS cnos_save \u2013 Save the running configuration as the startup configuration on devices running Lenovo CNOS cnos_showrun \u2013 Collect the current running configuration on devices running on CNOS cnos_static_route \u2013 Manage static IP routes on Lenovo CNOS network devices cnos_system \u2013 Manage the system attributes on Lenovo CNOS devices cnos_template \u2013 Manage switch configuration using templates on devices running Lenovo CNOS cnos_user \u2013 Manage the collection of local users on Lenovo CNOS devices cnos_vlag \u2013 Manage VLAG resources and attributes on devices running Lenovo CNOS cnos_vlan \u2013 Manage VLANs on CNOS network devices cnos_vrf \u2013 Manage VRFs on Lenovo CNOS network devices Cumulus \u00b6 nclu \u2013 Configure network interfaces using NCLU Dellos10 \u00b6 dellos10_command \u2013 Run commands on remote devices running Dell OS10 dellos10_config \u2013 Manage Dell EMC Networking OS10 configuration sections dellos10_facts \u2013 Collect facts from remote devices running Dell EMC Networking OS10 Dellos6 \u00b6 dellos6_command \u2013 Run commands on remote devices running Dell OS6 dellos6_config \u2013 Manage Dell EMC Networking OS6 configuration sections dellos6_facts \u2013 Collect facts from remote devices running Dell EMC Networking OS6 Dellos9 \u00b6 dellos9_command \u2013 Run commands on remote devices running Dell OS9 dellos9_config \u2013 Manage Dell EMC Networking OS9 configuration sections dellos9_facts \u2013 Collect facts from remote devices running Dell EMC Networking OS9 Edgeos \u00b6 edgeos_command \u2013 Run one or more commands on EdgeOS devices edgeos_config \u2013 Manage EdgeOS configuration on remote device edgeos_facts \u2013 Collect facts from remote devices running EdgeOS Edgeswitch \u00b6 edgeswitch_facts \u2013 Collect facts from remote devices running Edgeswitch edgeswitch_vlan \u2013 Manage VLANs on Ubiquiti Edgeswitch network devices Enos \u00b6 enos_command \u2013 Run arbitrary commands on Lenovo ENOS devices enos_config \u2013 Manage Lenovo ENOS configuration sections enos_facts \u2013 Collect facts from remote devices running Lenovo ENOS Eos \u00b6 eos_banner \u2013 Manage multiline banners on Arista EOS devices eos_bgp \u2013 Configure global BGP protocol settings on Arista EOS eos_command \u2013 Run arbitrary commands on an Arista EOS device eos_config \u2013 Manage Arista EOS configuration sections eos_eapi \u2013 Manage and configure Arista EOS eAPI eos_facts \u2013 Collect facts from remote devices running Arista EOS eos_interface \u2013 Manage Interface on Arista EOS network devices (D) eos_interfaces \u2013 Manages interface attributes of Arista EOS interfaces eos_l2_interface \u2013 Manage L2 interfaces on Arista EOS network devices (D) eos_l2_interfaces \u2013 Manages Layer-2 interface attributes of Arista EOS devices eos_l3_interface \u2013 Manage L3 interfaces on Arista EOS network devices (D) eos_l3_interfaces \u2013 Manages L3 interface attributes of Arista EOS devices eos_lacp \u2013 Manage Global Link Aggregation Control Protocol (LACP) on Arista EOS devices eos_lacp_interfaces \u2013 Manage Link Aggregation Control Protocol (LACP) attributes of interfaces on Arista EOS devices eos_lag_interfaces \u2013 Manages link aggregation groups on Arista EOS devices eos_linkagg \u2013 Manage link aggregation groups on Arista EOS network devices (D) eos_lldp \u2013 Manage LLDP configuration on Arista EOS network devices eos_lldp_global \u2013 Manage Global Link Layer Discovery Protocol (LLDP) settings on Arista EOS devices eos_lldp_interfaces \u2013 Manage Link Layer Discovery Protocol (LLDP) attributes of interfaces on Arista EOS devices eos_logging \u2013 Manage logging on network devices eos_static_route \u2013 Manage static IP routes on Arista EOS network devices eos_system \u2013 Manage the system attributes on Arista EOS devices eos_user \u2013 Manage the collection of local users on EOS devices eos_vlan \u2013 Manage VLANs on Arista EOS network devices (D) eos_vlans \u2013 Manage VLANs on Arista EOS devices eos_vrf \u2013 Manage VRFs on Arista EOS network devices Eric_Eccli \u00b6 eric_eccli_command \u2013 Run commands on remote devices running ERICSSON ECCLI Exos \u00b6 exos_command \u2013 Run commands on remote devices running Extreme EXOS exos_config \u2013 Manage Extreme Networks EXOS configuration sections exos_facts \u2013 Collect facts from devices running Extreme EXOS exos_lldp_global \u2013 Configure and manage Link Layer Discovery Protocol(LLDP) attributes on EXOS platforms F5 \u00b6 bigip_apm_acl \u2013 Manage user-defined APM ACLs bigip_apm_network_access \u2013 Manage APM Network Access resource bigip_apm_policy_fetch \u2013 Exports the APM policy or APM access profile from remote nodes bigip_apm_policy_import \u2013 Manage BIG-IP APM policy or APM access profile imports bigip_appsvcs_extension \u2013 Manage application service deployments bigip_asm_dos_application \u2013 Manage application settings for DOS profile bigip_asm_policy \u2013 Manage BIG-IP ASM policies (D) bigip_asm_policy_fetch \u2013 Exports the asm policy from remote nodes bigip_asm_policy_import \u2013 Manage BIG-IP ASM policy imports bigip_asm_policy_manage \u2013 Manage BIG-IP ASM policies bigip_asm_policy_server_technology \u2013 Manages Server Technology on ASM policy bigip_asm_policy_signature_set \u2013 Manages Signature Sets on ASM policy bigip_cli_alias \u2013 Manage CLI aliases on a BIG-IP bigip_cli_script \u2013 Manage CLI scripts on a BIG-IP bigip_command \u2013 Run TMSH and BASH commands on F5 devices bigip_config \u2013 Manage BIG-IP configuration sections bigip_configsync_action \u2013 Perform different actions related to config-sync bigip_data_group \u2013 Manage data groups on a BIG-IP bigip_device_auth \u2013 Manage system authentication on a BIG-IP bigip_device_auth_ldap \u2013 Manage LDAP device authentication settings on BIG-IP bigip_device_certificate \u2013 Manage self-signed device certificates bigip_device_connectivity \u2013 Manages device IP configuration settings for HA on a BIG-IP bigip_device_dns \u2013 Manage BIG-IP device DNS settings bigip_device_group \u2013 Manage device groups on a BIG-IP bigip_device_group_member \u2013 Manages members in a device group bigip_device_ha_group \u2013 Manage HA group settings on a BIG-IP system bigip_device_httpd \u2013 Manage HTTPD related settings on BIG-IP bigip_device_info \u2013 Collect information from F5 BIG-IP devices bigip_device_license \u2013 Manage license installation and activation on BIG-IP devices bigip_device_ntp \u2013 Manage NTP servers on a BIG-IP bigip_device_sshd \u2013 Manage the SSHD settings of a BIG-IP bigip_device_syslog \u2013 Manage system-level syslog settings on BIG-IP bigip_device_traffic_group \u2013 Manages traffic groups on BIG-IP bigip_device_trust \u2013 Manage the trust relationships between BIG-IPs bigip_dns_cache_resolver \u2013 Manage DNS resolver cache configurations on BIG-IP bigip_dns_nameserver \u2013 Manage LTM DNS nameservers on a BIG-IP bigip_dns_resolver \u2013 Manage DNS resolvers on a BIG-IP bigip_dns_zone \u2013 Manage DNS zones on BIG-IP bigip_facts \u2013 Collect facts from F5 BIG-IP devices (D) bigip_file_copy \u2013 Manage files in datastores on a BIG-IP bigip_firewall_address_list \u2013 Manage address lists on BIG-IP AFM bigip_firewall_dos_profile \u2013 Manage AFM DoS profiles on a BIG-IP bigip_firewall_dos_vector \u2013 Manage attack vector configuration in an AFM DoS profile bigip_firewall_global_rules \u2013 Manage AFM global rule settings on BIG-IP bigip_firewall_log_profile \u2013 Manages AFM logging profiles configured in the system bigip_firewall_log_profile_network \u2013 Configures Network Firewall related settings of the log profile bigip_firewall_policy \u2013 Manage AFM security firewall policies on a BIG-IP bigip_firewall_port_list \u2013 Manage port lists on BIG-IP AFM bigip_firewall_rule \u2013 Manage AFM Firewall rules bigip_firewall_rule_list \u2013 Manage AFM security firewall policies on a BIG-IP bigip_firewall_schedule \u2013 Manage BIG-IP AFM schedule configurations bigip_gtm_datacenter \u2013 Manage Datacenter configuration in BIG-IP bigip_gtm_facts \u2013 Collect facts from F5 BIG-IP GTM devices (D) bigip_gtm_global \u2013 Manages global GTM settings bigip_gtm_monitor_bigip \u2013 Manages F5 BIG-IP GTM BIG-IP monitors bigip_gtm_monitor_external \u2013 Manages external GTM monitors on a BIG-IP bigip_gtm_monitor_firepass \u2013 Manages F5 BIG-IP GTM FirePass monitors bigip_gtm_monitor_http \u2013 Manages F5 BIG-IP GTM http monitors bigip_gtm_monitor_https \u2013 Manages F5 BIG-IP GTM https monitors bigip_gtm_monitor_tcp \u2013 Manages F5 BIG-IP GTM tcp monitors bigip_gtm_monitor_tcp_half_open \u2013 Manages F5 BIG-IP GTM tcp half-open monitors bigip_gtm_pool \u2013 Manages F5 BIG-IP GTM pools bigip_gtm_pool_member \u2013 Manage GTM pool member settings bigip_gtm_server \u2013 Manages F5 BIG-IP GTM servers bigip_gtm_topology_record \u2013 Manages GTM Topology Records bigip_gtm_topology_region \u2013 Manages GTM Topology Regions bigip_gtm_virtual_server \u2013 Manages F5 BIG-IP GTM virtual servers bigip_gtm_wide_ip \u2013 Manages F5 BIG-IP GTM wide ip bigip_hostname \u2013 Manage the hostname of a BIG-IP bigip_iapp_service \u2013 Manages TCL iApp services on a BIG-IP bigip_iapp_template \u2013 Manages TCL iApp templates on a BIG-IP bigip_ike_peer \u2013 Manage IPSec IKE Peer configuration on BIG-IP bigip_imish_config \u2013 Manage BIG-IP advanced routing configuration sections bigip_ipsec_policy \u2013 Manage IPSec policies on a BIG-IP bigip_irule \u2013 Manage iRules across different modules on a BIG-IP bigip_log_destination \u2013 Manages log destinations on a BIG-IP bigip_log_publisher \u2013 Manages log publishers on a BIG-IP bigip_lx_package \u2013 Manages Javascript LX packages on a BIG-IP bigip_management_route \u2013 Manage system management routes on a BIG-IP bigip_message_routing_peer \u2013 Manage peers for routing generic message protocol messages bigip_message_routing_protocol \u2013 Manage generic message parser profile bigip_message_routing_route \u2013 Manages static routes for routing message protocol messages bigip_message_routing_router \u2013 Manages router profiles for message-routing protocols bigip_message_routing_transport_config \u2013 Manages configuration for an outgoing connection bigip_monitor_dns \u2013 Manage DNS monitors on a BIG-IP bigip_monitor_external \u2013 Manages external LTM monitors on a BIG-IP bigip_monitor_gateway_icmp \u2013 Manages F5 BIG-IP LTM gateway ICMP monitors bigip_monitor_http \u2013 Manages F5 BIG-IP LTM http monitors bigip_monitor_https \u2013 Manages F5 BIG-IP LTM https monitors bigip_monitor_ldap \u2013 Manages BIG-IP LDAP monitors bigip_monitor_snmp_dca \u2013 Manages BIG-IP SNMP data collecting agent (DCA) monitors bigip_monitor_tcp \u2013 Manages F5 BIG-IP LTM tcp monitors bigip_monitor_tcp_echo \u2013 Manages F5 BIG-IP LTM tcp echo monitors bigip_monitor_tcp_half_open \u2013 Manages F5 BIG-IP LTM tcp half-open monitors bigip_monitor_udp \u2013 Manages F5 BIG-IP LTM udp monitors bigip_node \u2013 Manages F5 BIG-IP LTM nodes bigip_partition \u2013 Manage BIG-IP partitions bigip_password_policy \u2013 Manages the authentication password policy on a BIG-IP bigip_policy \u2013 Manage general policy configuration on a BIG-IP bigip_policy_rule \u2013 Manage LTM policy rules on a BIG-IP bigip_pool \u2013 Manages F5 BIG-IP LTM pools bigip_pool_member \u2013 Manages F5 BIG-IP LTM pool members bigip_profile_analytics \u2013 Manage HTTP analytics profiles on a BIG-IP bigip_profile_client_ssl \u2013 Manages client SSL profiles on a BIG-IP bigip_profile_dns \u2013 Manage DNS profiles on a BIG-IP bigip_profile_fastl4 \u2013 Manages Fast L4 profiles bigip_profile_http \u2013 Manage HTTP profiles on a BIG-IP bigip_profile_http2 \u2013 Manage HTTP2 profiles on a BIG-IP bigip_profile_http_compression \u2013 Manage HTTP compression profiles on a BIG-IP bigip_profile_oneconnect \u2013 Manage OneConnect profiles on a BIG-IP bigip_profile_persistence_cookie \u2013 Manage cookie persistence profiles on BIG-IP bigip_profile_persistence_src_addr \u2013 Manage source address persistence profiles bigip_profile_server_ssl \u2013 Manages server SSL profiles on a BIG-IP bigip_profile_tcp \u2013 Manage TCP profiles on a BIG-IP bigip_profile_udp \u2013 Manage UDP profiles on a BIG-IP bigip_provision \u2013 Manage BIG-IP module provisioning bigip_qkview \u2013 Manage qkviews on the device bigip_remote_role \u2013 Manage remote roles on a BIG-IP bigip_remote_syslog \u2013 Manipulate remote syslog settings on a BIG-IP bigip_remote_user \u2013 Manages default settings for remote user accounts on a BIG-IP bigip_routedomain \u2013 Manage route domains on a BIG-IP bigip_selfip \u2013 Manage Self-IPs on a BIG-IP system bigip_service_policy \u2013 Manages service policies on a BIG-IP bigip_smtp \u2013 Manages SMTP settings on the BIG-IP bigip_snat_pool \u2013 Manage SNAT pools on a BIG-IP bigip_snat_translation \u2013 Manage SNAT Translations on a BIG-IP bigip_snmp \u2013 Manipulate general SNMP settings on a BIG-IP bigip_snmp_community \u2013 Manages SNMP communities on a BIG-IP bigip_snmp_trap \u2013 Manipulate SNMP trap information on a BIG-IP bigip_software_image \u2013 Manage software images on a BIG-IP bigip_software_install \u2013 Install software images on a BIG-IP bigip_software_update \u2013 Manage the software update settings of a BIG-IP bigip_ssl_certificate \u2013 Import/Delete certificates from BIG-IP bigip_ssl_key \u2013 Import/Delete SSL keys from BIG-IP bigip_ssl_ocsp \u2013 Manage OCSP configurations on BIG-IP bigip_static_route \u2013 Manipulate static routes on a BIG-IP bigip_sys_daemon_log_tmm \u2013 Manage BIG-IP tmm daemon log settings bigip_sys_db \u2013 Manage BIG-IP system database variables bigip_sys_global \u2013 Manage BIG-IP global settings bigip_timer_policy \u2013 Manage timer policies on a BIG-IP bigip_traffic_selector \u2013 Manage IPSec Traffic Selectors on BIG-IP bigip_trunk \u2013 Manage trunks on a BIG-IP bigip_tunnel \u2013 Manage tunnels on a BIG-IP bigip_ucs \u2013 Manage upload, installation and removal of UCS files bigip_ucs_fetch \u2013 Fetches a UCS file from remote nodes bigip_user \u2013 Manage user accounts and user attributes on a BIG-IP bigip_vcmp_guest \u2013 Manages vCMP guests on a BIG-IP bigip_virtual_address \u2013 Manage LTM virtual addresses on a BIG-IP bigip_virtual_server \u2013 Manage LTM virtual servers on a BIG-IP bigip_vlan \u2013 Manage VLANs on a BIG-IP system bigip_wait \u2013 Wait for a BIG-IP condition before continuing bigiq_application_fasthttp \u2013 Manages BIG-IQ FastHTTP applications bigiq_application_fastl4_tcp \u2013 Manages BIG-IQ FastL4 TCP applications bigiq_application_fastl4_udp \u2013 Manages BIG-IQ FastL4 UDP applications bigiq_application_http \u2013 Manages BIG-IQ HTTP applications bigiq_application_https_offload \u2013 Manages BIG-IQ HTTPS offload applications bigiq_application_https_waf \u2013 Manages BIG-IQ HTTPS WAF applications bigiq_device_discovery \u2013 Manage BIG-IP devices through BIG-IQ bigiq_device_info \u2013 Collect information from F5 BIG-IQ devices bigiq_regkey_license \u2013 Manages licenses in a BIG-IQ registration key pool bigiq_regkey_license_assignment \u2013 Manage regkey license assignment on BIG-IPs from a BIG-IQ bigiq_regkey_pool \u2013 Manages registration key pools on BIG-IQ bigiq_utility_license \u2013 Manage utility licenses on a BIG-IQ bigiq_utility_license_assignment \u2013 Manage utility license assignment on BIG-IPs from a BIG-IQ Files \u00b6 net_get \u2013 Copy a file from a network device to Ansible Controller net_put \u2013 Copy a file from Ansible Controller to a network device Fortianalyzer \u00b6 faz_device \u2013 Add or remove device Fortimanager \u00b6 fmgr_device \u2013 Add or remove device from FortiManager fmgr_device_config \u2013 Edit device configurations fmgr_device_group \u2013 Alter FortiManager device groups fmgr_device_provision_template \u2013 Manages Device Provisioning Templates in FortiManager fmgr_fwobj_address \u2013 Allows the management of firewall objects in FortiManager fmgr_fwobj_ippool \u2013 Allows the editing of IP Pool Objects within FortiManager fmgr_fwobj_ippool6 \u2013 Allows the editing of IP Pool Objects within FortiManager fmgr_fwobj_service \u2013 Manages FortiManager Firewall Service Objects fmgr_fwobj_vip \u2013 Manages Virtual IPs objects in FortiManager fmgr_fwpol_ipv4 \u2013 Allows the add/delete of Firewall Policies on Packages in FortiManager fmgr_fwpol_package \u2013 Manages FortiManager Firewall Policies Packages fmgr_ha \u2013 Manages the High-Availability State of FortiManager Clusters and Nodes fmgr_provisioning \u2013 Provision devices via FortiMananger fmgr_query \u2013 Query FortiManager data objects for use in Ansible workflows fmgr_script \u2013 Add/Edit/Delete and execute scripts fmgr_secprof_appctrl \u2013 Manage application control security profiles fmgr_secprof_av \u2013 Manage security profile fmgr_secprof_dns \u2013 Manage DNS security profiles in FortiManager fmgr_secprof_ips \u2013 Managing IPS security profiles in FortiManager fmgr_secprof_profile_group \u2013 Manage security profiles within FortiManager fmgr_secprof_proxy \u2013 Manage proxy security profiles in FortiManager fmgr_secprof_spam \u2013 spam filter profile for FMG fmgr_secprof_ssl_ssh \u2013 Manage SSL and SSH security profiles in FortiManager fmgr_secprof_voip \u2013 VOIP security profiles in FMG fmgr_secprof_waf \u2013 FortiManager web application firewall security profile fmgr_secprof_wanopt \u2013 WAN optimization fmgr_secprof_web \u2013 Manage web filter security profiles in FortiManager Fortios \u00b6 fortios_address \u2013 Manage fortios firewall address objects fortios_alertemail_setting \u2013 Configure alert email settings in Fortinet\u2019s FortiOS and FortiGate fortios_antivirus_heuristic \u2013 Configure global heuristic options in Fortinet\u2019s FortiOS and FortiGate fortios_antivirus_profile \u2013 Configure AntiVirus profiles in Fortinet\u2019s FortiOS and FortiGate fortios_antivirus_quarantine \u2013 Configure quarantine options in Fortinet\u2019s FortiOS and FortiGate fortios_antivirus_settings \u2013 Configure AntiVirus settings in Fortinet\u2019s FortiOS and FortiGate fortios_application_custom \u2013 Configure custom application signatures in Fortinet\u2019s FortiOS and FortiGate fortios_application_group \u2013 Configure firewall application groups in Fortinet\u2019s FortiOS and FortiGate fortios_application_list \u2013 Configure application control lists in Fortinet\u2019s FortiOS and FortiGate fortios_application_name \u2013 Configure application signatures in Fortinet\u2019s FortiOS and FortiGate fortios_application_rule_settings \u2013 Configure application rule settings in Fortinet\u2019s FortiOS and FortiGate fortios_authentication_rule \u2013 Configure Authentication Rules in Fortinet\u2019s FortiOS and FortiGate fortios_authentication_scheme \u2013 Configure Authentication Schemes in Fortinet\u2019s FortiOS and FortiGate fortios_authentication_setting \u2013 Configure authentication setting in Fortinet\u2019s FortiOS and FortiGate fortios_config \u2013 Manage config on Fortinet FortiOS firewall devices fortios_dlp_filepattern \u2013 Configure file patterns used by DLP blocking in Fortinet\u2019s FortiOS and FortiGate fortios_dlp_fp_doc_source \u2013 Create a DLP fingerprint database by allowing the FortiGate to access a file server containing files from which to create fingerprints in Fortinet\u2019s FortiOS and FortiGate fortios_dlp_fp_sensitivity \u2013 Create self-explanatory DLP sensitivity levels to be used when setting sensitivity under config fp-doc-source in Fortinet\u2019s FortiOS and FortiGate fortios_dlp_sensor \u2013 Configure DLP sensors in Fortinet\u2019s FortiOS and FortiGate fortios_dlp_settings \u2013 Designate logical storage for DLP fingerprint database in Fortinet\u2019s FortiOS and FortiGate fortios_dnsfilter_domain_filter \u2013 Configure DNS domain filters in Fortinet\u2019s FortiOS and FortiGate fortios_dnsfilter_profile \u2013 Configure DNS domain filter profiles in Fortinet\u2019s FortiOS and FortiGate fortios_endpoint_control_client \u2013 Configure endpoint control client lists in Fortinet\u2019s FortiOS and FortiGate fortios_endpoint_control_forticlient_ems \u2013 Configure FortiClient Enterprise Management Server (EMS) entries in Fortinet\u2019s FortiOS and FortiGate fortios_endpoint_control_forticlient_registration_sync \u2013 Configure FortiClient registration synchronization settings in Fortinet\u2019s FortiOS and FortiGate fortios_endpoint_control_profile \u2013 Configure FortiClient endpoint control profiles in Fortinet\u2019s FortiOS and FortiGate fortios_endpoint_control_settings \u2013 Configure endpoint control settings in Fortinet\u2019s FortiOS and FortiGate fortios_extender_controller_extender \u2013 Extender controller configuration in Fortinet\u2019s FortiOS and FortiGate fortios_facts \u2013 Get facts about fortios devices fortios_firewall_address \u2013 Configure IPv4 addresses in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_address6 \u2013 Configure IPv6 firewall addresses in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_address6_template \u2013 Configure IPv6 address templates in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_addrgrp \u2013 Configure IPv4 address groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_addrgrp6 \u2013 Configure IPv6 address groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_auth_portal \u2013 Configure firewall authentication portals in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_central_snat_map \u2013 Configure central SNAT policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_dnstranslation \u2013 Configure DNS translation in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_DoS_policy \u2013 Configure IPv4 DoS policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_DoS_policy6 \u2013 Configure IPv6 DoS policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_identity_based_route \u2013 Configure identity based routing in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_interface_policy \u2013 Configure IPv4 interface policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_interface_policy6 \u2013 Configure IPv6 interface policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_internet_service \u2013 Show Internet Service application in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_internet_service_custom \u2013 Configure custom Internet Services in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_internet_service_group \u2013 Configure group of Internet Service in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ip_translation \u2013 Configure firewall IP-translation in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ipmacbinding_setting \u2013 Configure IP to MAC binding settings in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ipmacbinding_table \u2013 Configure IP to MAC address pairs in the IP/MAC binding table in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ippool \u2013 Configure IPv4 IP pools in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ippool6 \u2013 Configure IPv6 IP pools in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ipv6_eh_filter \u2013 Configure IPv6 extension header filter in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ldb_monitor \u2013 Configure server load balancing health monitors in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_local_in_policy \u2013 Configure user defined IPv4 local-in policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_local_in_policy6 \u2013 Configure user defined IPv6 local-in policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_multicast_address \u2013 Configure multicast addresses in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_multicast_address6 \u2013 Configure IPv6 multicast address in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_multicast_policy \u2013 Configure multicast NAT policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_multicast_policy6 \u2013 Configure IPv6 multicast NAT policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_policy \u2013 Configure IPv4 policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_policy46 \u2013 Configure IPv4 to IPv6 policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_policy6 \u2013 Configure IPv6 policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_policy64 \u2013 Configure IPv6 to IPv4 policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_profile_group \u2013 Configure profile groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_profile_protocol_options \u2013 Configure protocol options in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_proxy_address \u2013 Web proxy address configuration in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_proxy_addrgrp \u2013 Web proxy address group configuration in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_proxy_policy \u2013 Configure proxy policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_schedule_group \u2013 Schedule group configuration in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_schedule_onetime \u2013 Onetime schedule configuration in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_schedule_recurring \u2013 Recurring schedule configuration in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_service_category \u2013 Configure service categories in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_service_custom \u2013 Configure custom services in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_service_group \u2013 Configure service groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_shaper_per_ip_shaper \u2013 Configure per-IP traffic shaper in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_shaper_traffic_shaper \u2013 Configure shared traffic shaper in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_shaping_policy \u2013 Configure shaping policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_shaping_profile \u2013 Configure shaping profiles in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_sniffer \u2013 Configure sniffer in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssh_host_key \u2013 SSH proxy host public keys in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssh_local_ca \u2013 SSH proxy local CA in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssh_local_key \u2013 SSH proxy local keys in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssh_setting \u2013 SSH proxy settings in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssl_server \u2013 Configure SSL servers in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssl_setting \u2013 SSL proxy settings in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssl_ssh_profile \u2013 Configure SSL/SSH protocol options in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ttl_policy \u2013 Configure TTL policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vip \u2013 Configure virtual IP for IPv4 in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vip46 \u2013 Configure IPv4 to IPv6 virtual IPs in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vip6 \u2013 Configure virtual IP for IPv6 in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vip64 \u2013 Configure IPv6 to IPv4 virtual IPs in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vipgrp \u2013 Configure IPv4 virtual IP groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vipgrp46 \u2013 Configure IPv4 to IPv6 virtual IP groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vipgrp6 \u2013 Configure IPv6 virtual IP groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vipgrp64 \u2013 Configure IPv6 to IPv4 virtual IP groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_wildcard_fqdn_custom \u2013 Config global/VDOM Wildcard FQDN address in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_wildcard_fqdn_group \u2013 Config global Wildcard FQDN address groups in Fortinet\u2019s FortiOS and FortiGate fortios_ftp_proxy_explicit \u2013 Configure explicit FTP proxy settings in Fortinet\u2019s FortiOS and FortiGate fortios_icap_profile \u2013 Configure ICAP profiles in Fortinet\u2019s FortiOS and FortiGate fortios_icap_server \u2013 Configure ICAP servers in Fortinet\u2019s FortiOS and FortiGate fortios_ips_custom \u2013 Configure IPS custom signature in Fortinet\u2019s FortiOS and FortiGate fortios_ips_decoder \u2013 Configure IPS decoder in Fortinet\u2019s FortiOS and FortiGate fortios_ips_global \u2013 Configure IPS global parameter in Fortinet\u2019s FortiOS and FortiGate fortios_ips_rule \u2013 Configure IPS rules in Fortinet\u2019s FortiOS and FortiGate fortios_ips_rule_settings \u2013 Configure IPS rule setting in Fortinet\u2019s FortiOS and FortiGate fortios_ips_sensor \u2013 Configure IPS sensor in Fortinet\u2019s FortiOS and FortiGate fortios_ips_settings \u2013 Configure IPS VDOM parameter in Fortinet\u2019s FortiOS and FortiGate fortios_ipv4_policy \u2013 Manage IPv4 policy objects on Fortinet FortiOS firewall devices fortios_log_custom_field \u2013 Configure custom log fields in Fortinet\u2019s FortiOS and FortiGate fortios_log_disk_filter \u2013 Configure filters for local disk logging. Use these filters to determine the log messages to record according to severity and type in Fortinet\u2019s FortiOS and FortiGate fortios_log_disk_setting \u2013 Settings for local disk logging in Fortinet\u2019s FortiOS and FortiGate fortios_log_eventfilter \u2013 Configure log event filters in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer2_filter \u2013 Filters for FortiAnalyzer in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer2_setting \u2013 Global FortiAnalyzer settings in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer3_filter \u2013 Filters for FortiAnalyzer in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer3_setting \u2013 Global FortiAnalyzer settings in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer_filter \u2013 Filters for FortiAnalyzer in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer_override_filter \u2013 Override filters for FortiAnalyzer in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer_override_setting \u2013 Override FortiAnalyzer settings in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer_setting \u2013 Global FortiAnalyzer settings in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortiguard_filter \u2013 Filters for FortiCloud in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortiguard_override_filter \u2013 Override filters for FortiCloud in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortiguard_override_setting \u2013 Override global FortiCloud logging settings for this VDOM in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortiguard_setting \u2013 Configure logging to FortiCloud in Fortinet\u2019s FortiOS and FortiGate fortios_log_gui_display \u2013 Configure how log messages are displayed on the GUI in Fortinet\u2019s FortiOS and FortiGate fortios_log_memory_filter \u2013 Filters for memory buffer in Fortinet\u2019s FortiOS and FortiGate fortios_log_memory_global_setting \u2013 Global settings for memory logging in Fortinet\u2019s FortiOS and FortiGate fortios_log_memory_setting \u2013 Settings for memory buffer in Fortinet\u2019s FortiOS and FortiGate fortios_log_null_device_filter \u2013 Filters for null device logging in Fortinet\u2019s FortiOS and FortiGate fortios_log_null_device_setting \u2013 Settings for null device logging in Fortinet\u2019s FortiOS and FortiGate fortios_log_setting \u2013 Configure general log settings in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd2_filter \u2013 Filters for remote system server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd2_setting \u2013 Global settings for remote syslog server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd3_filter \u2013 Filters for remote system server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd3_setting \u2013 Global settings for remote syslog server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd4_filter \u2013 Filters for remote system server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd4_setting \u2013 Global settings for remote syslog server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd_filter \u2013 Filters for remote system server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd_override_filter \u2013 Override filters for remote system server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd_override_setting \u2013 Override settings for remote syslog server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd_setting \u2013 Global settings for remote syslog server in Fortinet\u2019s FortiOS and FortiGate fortios_log_threat_weight \u2013 Configure threat weight settings in Fortinet\u2019s FortiOS and FortiGate fortios_log_webtrends_filter \u2013 Filters for WebTrends in Fortinet\u2019s FortiOS and FortiGate fortios_log_webtrends_setting \u2013 Settings for WebTrends in Fortinet\u2019s FortiOS and FortiGate fortios_report_chart \u2013 Report chart widget configuration in Fortinet\u2019s FortiOS and FortiGate fortios_report_dataset \u2013 Report dataset configuration in Fortinet\u2019s FortiOS and FortiGate fortios_report_layout \u2013 Report layout configuration in Fortinet\u2019s FortiOS and FortiGate fortios_report_setting \u2013 Report setting configuration in Fortinet\u2019s FortiOS and FortiGate fortios_report_style \u2013 Report style configuration in Fortinet\u2019s FortiOS and FortiGate fortios_report_theme \u2013 Report themes configuration in Fortinet\u2019s FortiOS and FortiGate fortios_router_access_list \u2013 Configure access lists in Fortinet\u2019s FortiOS and FortiGate fortios_router_access_list6 \u2013 Configure IPv6 access lists in Fortinet\u2019s FortiOS and FortiGate fortios_router_aspath_list \u2013 Configure Autonomous System (AS) path lists in Fortinet\u2019s FortiOS and FortiGate fortios_router_auth_path \u2013 Configure authentication based routing in Fortinet\u2019s FortiOS and FortiGate fortios_router_bfd \u2013 Configure BFD in Fortinet\u2019s FortiOS and FortiGate fortios_router_bfd6 \u2013 Configure IPv6 BFD in Fortinet\u2019s FortiOS and FortiGate fortios_router_bgp \u2013 Configure BGP in Fortinet\u2019s FortiOS and FortiGate fortios_router_community_list \u2013 Configure community lists in Fortinet\u2019s FortiOS and FortiGate fortios_router_isis \u2013 Configure IS-IS in Fortinet\u2019s FortiOS and FortiGate fortios_router_key_chain \u2013 Configure key-chain in Fortinet\u2019s FortiOS and FortiGate fortios_router_multicast \u2013 Configure router multicast in Fortinet\u2019s FortiOS and FortiGate fortios_router_multicast6 \u2013 Configure IPv6 multicast in Fortinet\u2019s FortiOS and FortiGate fortios_router_multicast_flow \u2013 Configure multicast-flow in Fortinet\u2019s FortiOS and FortiGate fortios_router_ospf \u2013 Configure OSPF in Fortinet\u2019s FortiOS and FortiGate fortios_router_ospf6 \u2013 Configure IPv6 OSPF in Fortinet\u2019s FortiOS and FortiGate fortios_router_policy \u2013 Configure IPv4 routing policies in Fortinet\u2019s FortiOS and FortiGate fortios_router_policy6 \u2013 Configure IPv6 routing policies in Fortinet\u2019s FortiOS and FortiGate fortios_router_prefix_list \u2013 Configure IPv4 prefix lists in Fortinet\u2019s FortiOS and FortiGate fortios_router_prefix_list6 \u2013 Configure IPv6 prefix lists in Fortinet\u2019s FortiOS and FortiGate fortios_router_rip \u2013 Configure RIP in Fortinet\u2019s FortiOS and FortiGate fortios_router_ripng \u2013 Configure RIPng in Fortinet\u2019s FortiOS and FortiGate fortios_router_route_map \u2013 Configure route maps in Fortinet\u2019s FortiOS and FortiGate fortios_router_setting \u2013 Configure router settings in Fortinet\u2019s FortiOS and FortiGate fortios_router_static \u2013 Configure IPv4 static routing tables in Fortinet\u2019s FortiOS and FortiGate fortios_router_static6 \u2013 Configure IPv6 static routing tables in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_bwl \u2013 Configure anti-spam black/white list in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_bword \u2013 Configure AntiSpam banned word list in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_dnsbl \u2013 Configure AntiSpam DNSBL/ORBL in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_fortishield \u2013 Configure FortiGuard - AntiSpam in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_iptrust \u2013 Configure AntiSpam IP trust in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_mheader \u2013 Configure AntiSpam MIME header in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_options \u2013 Configure AntiSpam options in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_profile \u2013 Configure AntiSpam profiles in Fortinet\u2019s FortiOS and FortiGate fortios_ssh_filter_profile \u2013 SSH filter profile in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_802_1X_settings \u2013 Configure global 802.1X settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_custom_command \u2013 Configure the FortiGate switch controller to send custom commands to managed FortiSwitch devices in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_global \u2013 Configure FortiSwitch global settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_igmp_snooping \u2013 Configure FortiSwitch IGMP snooping global settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_lldp_profile \u2013 Configure FortiSwitch LLDP profiles in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_lldp_settings \u2013 Configure FortiSwitch LLDP settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_mac_sync_settings \u2013 Configure global MAC synchronization settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_managed_switch \u2013 Configure FortiSwitch devices that are managed by this FortiGate in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_network_monitor_settings \u2013 Configure network monitor settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_qos_dot1p_map \u2013 Configure FortiSwitch QoS 802.1p in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_qos_ip_dscp_map \u2013 Configure FortiSwitch QoS IP precedence/DSCP in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_qos_qos_policy \u2013 Configure FortiSwitch QoS policy in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_qos_queue_policy \u2013 Configure FortiSwitch QoS egress queue policy in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_quarantine \u2013 Configure FortiSwitch quarantine support in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_security_policy_802_1X \u2013 Configure 802.1x MAC Authentication Bypass (MAB) policies in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_security_policy_captive_portal \u2013 Names of VLANs that use captive portal authentication in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_sflow \u2013 Configure FortiSwitch sFlow in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_storm_control \u2013 Configure FortiSwitch storm control in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_stp_settings \u2013 Configure FortiSwitch spanning tree protocol (STP) in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_switch_group \u2013 Configure FortiSwitch switch groups in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_switch_interface_tag \u2013 Configure switch object tags in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_switch_log \u2013 Configure FortiSwitch logging (logs are transferred to and inserted into FortiGate event log) in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_switch_profile \u2013 Configure FortiSwitch switch profile in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_system \u2013 Configure system-wide switch controller settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_virtual_port_pool \u2013 Configure virtual pool in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_vlan \u2013 Configure VLANs for switch controller in Fortinet\u2019s FortiOS and FortiGate fortios_system_accprofile \u2013 Configure access profiles for system administrators in Fortinet\u2019s FortiOS and FortiGate fortios_system_admin \u2013 Configure admin users in Fortinet\u2019s FortiOS and FortiGate fortios_system_affinity_interrupt \u2013 Configure interrupt affinity in Fortinet\u2019s FortiOS and FortiGate fortios_system_affinity_packet_redistribution \u2013 Configure packet redistribution in Fortinet\u2019s FortiOS and FortiGate fortios_system_alarm \u2013 Configure alarm in Fortinet\u2019s FortiOS and FortiGate fortios_system_alias \u2013 Configure alias command in Fortinet\u2019s FortiOS and FortiGate fortios_system_api_user \u2013 Configure API users in Fortinet\u2019s FortiOS and FortiGate fortios_system_arp_table \u2013 Configure ARP table in Fortinet\u2019s FortiOS and FortiGate fortios_system_auto_install \u2013 Configure USB auto installation in Fortinet\u2019s FortiOS and FortiGate fortios_system_auto_script \u2013 Configure auto script in Fortinet\u2019s FortiOS and FortiGate fortios_system_automation_action \u2013 Action for automation stitches in Fortinet\u2019s FortiOS and FortiGate fortios_system_automation_destination \u2013 Automation destinations in Fortinet\u2019s FortiOS and FortiGate fortios_system_automation_stitch \u2013 Automation stitches in Fortinet\u2019s FortiOS and FortiGate fortios_system_automation_trigger \u2013 Trigger for automation stitches in Fortinet\u2019s FortiOS and FortiGate fortios_system_autoupdate_push_update \u2013 Configure push updates in Fortinet\u2019s FortiOS and FortiGate fortios_system_autoupdate_schedule \u2013 Configure update schedule in Fortinet\u2019s FortiOS and FortiGate fortios_system_autoupdate_tunneling \u2013 Configure web proxy tunnelling for the FDN in Fortinet\u2019s FortiOS and FortiGate fortios_system_central_management \u2013 Configure central management in Fortinet\u2019s FortiOS and FortiGate fortios_system_cluster_sync \u2013 Configure FortiGate Session Life Support Protocol (FGSP) session synchronization in Fortinet\u2019s FortiOS and FortiGate fortios_system_console \u2013 Configure console in Fortinet\u2019s FortiOS and FortiGate fortios_system_csf \u2013 Add this FortiGate to a Security Fabric or set up a new Security Fabric on this FortiGate in Fortinet\u2019s FortiOS and FortiGate fortios_system_custom_language \u2013 Configure custom languages in Fortinet\u2019s FortiOS and FortiGate fortios_system_ddns \u2013 Configure DDNS in Fortinet\u2019s FortiOS and FortiGate fortios_system_dedicated_mgmt \u2013 Configure dedicated management in Fortinet\u2019s FortiOS and FortiGate fortios_system_dhcp6_server \u2013 Configure DHCPv6 servers in Fortinet\u2019s FortiOS and FortiGate fortios_system_dhcp_server \u2013 Configure DHCP servers in Fortinet\u2019s FortiOS and FortiGate fortios_system_dns \u2013 Configure DNS in Fortinet\u2019s FortiOS and FortiGate fortios_system_dns_database \u2013 Configure DNS databases in Fortinet\u2019s FortiOS and FortiGate fortios_system_dns_server \u2013 Configure DNS servers in Fortinet\u2019s FortiOS and FortiGate fortios_system_dscp_based_priority \u2013 Configure DSCP based priority table in Fortinet\u2019s FortiOS and FortiGate fortios_system_email_server \u2013 Configure the email server used by the FortiGate various things. For example, for sending email messages to users to support user authentication features in Fortinet\u2019s FortiOS and FortiGate fortios_system_external_resource \u2013 Configure external resource in Fortinet\u2019s FortiOS and FortiGate fortios_system_fips_cc \u2013 Configure FIPS-CC mode in Fortinet\u2019s FortiOS and FortiGate fortios_system_firmware_upgrade \u2013 Perform firmware upgrade on FortiGate or FortiOS (FOS) device fortios_system_fm \u2013 Configure FM in Fortinet\u2019s FortiOS and FortiGate fortios_system_fortiguard \u2013 Configure FortiGuard services in Fortinet\u2019s FortiOS and FortiGate fortios_system_fortimanager \u2013 Configure FortiManager in Fortinet\u2019s FortiOS and FortiGate fortios_system_fortisandbox \u2013 Configure FortiSandbox in Fortinet\u2019s FortiOS and FortiGate fortios_system_fsso_polling \u2013 Configure Fortinet Single Sign On (FSSO) server in Fortinet\u2019s FortiOS and FortiGate fortios_system_ftm_push \u2013 Configure FortiToken Mobile push services in Fortinet\u2019s FortiOS and FortiGate fortios_system_geoip_override \u2013 Configure geographical location mapping for IP address(es) to override mappings from FortiGuard in Fortinet\u2019s FortiOS and FortiGate fortios_system_global \u2013 Configure global attributes in Fortinet\u2019s FortiOS and FortiGate fortios_system_gre_tunnel \u2013 Configure GRE tunnel in Fortinet\u2019s FortiOS and FortiGate fortios_system_ha \u2013 Configure HA in Fortinet\u2019s FortiOS and FortiGate fortios_system_ha_monitor \u2013 Configure HA monitor in Fortinet\u2019s FortiOS and FortiGate fortios_system_interface \u2013 Configure interfaces in Fortinet\u2019s FortiOS and FortiGate fortios_system_ipip_tunnel \u2013 Configure IP in IP Tunneling in Fortinet\u2019s FortiOS and FortiGate fortios_system_ips_urlfilter_dns \u2013 Configure IPS URL filter DNS servers in Fortinet\u2019s FortiOS and FortiGate fortios_system_ips_urlfilter_dns6 \u2013 Configure IPS URL filter IPv6 DNS servers in Fortinet\u2019s FortiOS and FortiGate fortios_system_ipv6_neighbor_cache \u2013 Configure IPv6 neighbor cache table in Fortinet\u2019s FortiOS and FortiGate fortios_system_ipv6_tunnel \u2013 Configure IPv6/IPv4 in IPv6 tunnel in Fortinet\u2019s FortiOS and FortiGate fortios_system_link_monitor \u2013 Configure Link Health Monitor in Fortinet\u2019s FortiOS and FortiGate fortios_system_mac_address_table \u2013 Configure MAC address tables in Fortinet\u2019s FortiOS and FortiGate fortios_system_management_tunnel \u2013 Management tunnel configuration in Fortinet\u2019s FortiOS and FortiGate fortios_system_mobile_tunnel \u2013 Configure Mobile tunnels, an implementation of Network Mobility (NEMO) extensions for Mobile IPv4 RFC5177 in Fortinet\u2019s FortiOS and FortiGate fortios_system_nat64 \u2013 Configure NAT64 in Fortinet\u2019s FortiOS and FortiGate fortios_system_nd_proxy \u2013 Configure IPv6 neighbor discovery proxy (RFC4389) in Fortinet\u2019s FortiOS and FortiGate fortios_system_netflow \u2013 Configure NetFlow in Fortinet\u2019s FortiOS and FortiGate fortios_system_network_visibility \u2013 Configure network visibility settings in Fortinet\u2019s FortiOS and FortiGate fortios_system_ntp \u2013 Configure system NTP information in Fortinet\u2019s FortiOS and FortiGate fortios_system_object_tagging \u2013 Configure object tagging in Fortinet\u2019s FortiOS and FortiGate fortios_system_password_policy \u2013 Configure password policy for locally defined administrator passwords and IPsec VPN pre-shared keys in Fortinet\u2019s FortiOS and FortiGate fortios_system_password_policy_guest_admin \u2013 Configure the password policy for guest administrators in Fortinet\u2019s FortiOS and FortiGate fortios_system_pppoe_interface \u2013 Configure the PPPoE interfaces in Fortinet\u2019s FortiOS and FortiGate fortios_system_probe_response \u2013 Configure system probe response in Fortinet\u2019s FortiOS and FortiGate fortios_system_proxy_arp \u2013 Configure proxy-ARP in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_admin \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_alertmail \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_auth \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_device_detection_portal \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_ec \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_fortiguard_wf \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_ftp \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_group \u2013 Configure replacement message groups in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_http \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_icap \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_image \u2013 Configure replacement message images in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_mail \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_nac_quar \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_nntp \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_spam \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_sslvpn \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_traffic_quota \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_utm \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_webproxy \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_resource_limits \u2013 Configure resource limits in Fortinet\u2019s FortiOS and FortiGate fortios_system_sdn_connector \u2013 Configure connection to SDN Connector in Fortinet\u2019s FortiOS and FortiGate fortios_system_session_helper \u2013 Configure session helper in Fortinet\u2019s FortiOS and FortiGate fortios_system_session_ttl \u2013 Configure global session TTL timers for this FortiGate in Fortinet\u2019s FortiOS and FortiGate fortios_system_settings \u2013 Configure VDOM settings in Fortinet\u2019s FortiOS and FortiGate fortios_system_sflow \u2013 Configure sFlow in Fortinet\u2019s FortiOS and FortiGate fortios_system_sit_tunnel \u2013 Configure IPv6 tunnel over IPv4 in Fortinet\u2019s FortiOS and FortiGate fortios_system_sms_server \u2013 Configure SMS server for sending SMS messages to support user authentication in Fortinet\u2019s FortiOS and FortiGate fortios_system_snmp_community \u2013 SNMP community configuration in Fortinet\u2019s FortiOS and FortiGate fortios_system_snmp_sysinfo \u2013 SNMP system info configuration in Fortinet\u2019s FortiOS and FortiGate fortios_system_snmp_user \u2013 SNMP user configuration in Fortinet\u2019s FortiOS and FortiGate fortios_system_storage \u2013 Configure logical storage in Fortinet\u2019s FortiOS and FortiGate fortios_system_switch_interface \u2013 Configure software switch interfaces by grouping physical and WiFi interfaces in Fortinet\u2019s FortiOS and FortiGate fortios_system_tos_based_priority \u2013 Configure Type of Service (ToS) based priority table to set network traffic priorities in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom \u2013 Configure virtual domain in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_dns \u2013 Configure DNS servers for a non-management VDOM in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_exception \u2013 Global configuration objects that can be configured independently for all VDOMs or for the defined VDOM scope in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_link \u2013 Configure VDOM links in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_netflow \u2013 Configure NetFlow per VDOM in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_property \u2013 Configure VDOM property in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_radius_server \u2013 Configure a RADIUS server to use as a RADIUS Single Sign On (RSSO) server for this VDOM in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_sflow \u2013 Configure sFlow per VDOM to add or change the IP address and UDP port that FortiGate sFlow agents in this VDOM use to send sFlow datagrams to an sFlow collector in Fortinet\u2019s FortiOS and FortiGate fortios_system_virtual_wan_link \u2013 Configure redundant internet connections using SD-WAN (formerly virtual WAN link) in Fortinet\u2019s FortiOS and FortiGate fortios_system_virtual_wire_pair \u2013 Configure virtual wire pairs in Fortinet\u2019s FortiOS and FortiGate fortios_system_vxlan \u2013 Configure VXLAN devices in Fortinet\u2019s FortiOS and FortiGate fortios_system_wccp \u2013 Configure WCCP in Fortinet\u2019s FortiOS and FortiGate fortios_system_zone \u2013 Configure zones to group two or more interfaces. When a zone is created you can configure policies for the zone instead of individual interfaces in the zone in Fortinet\u2019s FortiOS and FortiGate fortios_user_adgrp \u2013 Configure FSSO groups in Fortinet\u2019s FortiOS and FortiGate fortios_user_device \u2013 Configure devices in Fortinet\u2019s FortiOS and FortiGate fortios_user_device_access_list \u2013 Configure device access control lists in Fortinet\u2019s FortiOS and FortiGate fortios_user_device_category \u2013 Configure device categories in Fortinet\u2019s FortiOS and FortiGate fortios_user_device_group \u2013 Configure device groups in Fortinet\u2019s FortiOS and FortiGate fortios_user_domain_controller \u2013 Configure domain controller entries in Fortinet\u2019s FortiOS and FortiGate fortios_user_fortitoken \u2013 Configure FortiToken in Fortinet\u2019s FortiOS and FortiGate fortios_user_fsso \u2013 Configure Fortinet Single Sign On (FSSO) agents in Fortinet\u2019s FortiOS and FortiGate fortios_user_fsso_polling \u2013 Configure FSSO active directory servers for polling mode in Fortinet\u2019s FortiOS and FortiGate fortios_user_group \u2013 Configure user groups in Fortinet\u2019s FortiOS and FortiGate fortios_user_krb_keytab \u2013 Configure Kerberos keytab entries in Fortinet\u2019s FortiOS and FortiGate fortios_user_ldap \u2013 Configure LDAP server entries in Fortinet\u2019s FortiOS and FortiGate fortios_user_local \u2013 Configure local users in Fortinet\u2019s FortiOS and FortiGate fortios_user_password_policy \u2013 Configure user password policy in Fortinet\u2019s FortiOS and FortiGate fortios_user_peer \u2013 Configure peer users in Fortinet\u2019s FortiOS and FortiGate fortios_user_peergrp \u2013 Configure peer groups in Fortinet\u2019s FortiOS and FortiGate fortios_user_pop3 \u2013 POP3 server entry configuration in Fortinet\u2019s FortiOS and FortiGate fortios_user_quarantine \u2013 Configure quarantine support in Fortinet\u2019s FortiOS and FortiGate fortios_user_radius \u2013 Configure RADIUS server entries in Fortinet\u2019s FortiOS and FortiGate fortios_user_security_exempt_list \u2013 Configure security exemption list in Fortinet\u2019s FortiOS and FortiGate fortios_user_setting \u2013 Configure user authentication setting in Fortinet\u2019s FortiOS and FortiGate fortios_user_tacacsplus \u2013 Configure TACACS+ server entries in Fortinet\u2019s FortiOS and FortiGate fortios_voip_profile \u2013 Configure VoIP profiles in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_certificate_ca \u2013 CA certificate in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_certificate_crl \u2013 Certificate Revocation List as a PEM file in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_certificate_local \u2013 Local keys and certificates in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_certificate_ocsp_server \u2013 OCSP server configuration in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_certificate_remote \u2013 Remote certificate as a PEM file in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_certificate_setting \u2013 VPN certificate setting in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_concentrator \u2013 Concentrator configuration in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_forticlient \u2013 Configure FortiClient policy realm in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_manualkey \u2013 Configure IPsec manual keys in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_manualkey_interface \u2013 Configure IPsec manual keys in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_phase1 \u2013 Configure VPN remote gateway in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_phase1_interface \u2013 Configure VPN remote gateway in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_phase2 \u2013 Configure VPN autokey tunnel in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_phase2_interface \u2013 Configure VPN autokey tunnel in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_l2tp \u2013 Configure L2TP in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_pptp \u2013 Configure PPTP in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ssl_settings \u2013 Configure SSL VPN in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ssl_web_host_check_software \u2013 SSL-VPN host check software in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ssl_web_portal \u2013 Portal in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ssl_web_realm \u2013 Realm in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ssl_web_user_bookmark \u2013 Configure SSL VPN user bookmark in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ssl_web_user_group_bookmark \u2013 Configure SSL VPN user group bookmark in Fortinet\u2019s FortiOS and FortiGate fortios_waf_main_class \u2013 Hidden table for datasource in Fortinet\u2019s FortiOS and FortiGate fortios_waf_profile \u2013 Web application firewall configuration in Fortinet\u2019s FortiOS and FortiGate fortios_waf_signature \u2013 Hidden table for datasource in Fortinet\u2019s FortiOS and FortiGate fortios_waf_sub_class \u2013 Hidden table for datasource in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_auth_group \u2013 Configure WAN optimization authentication groups in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_cache_service \u2013 Designate cache-service for wan-optimization and webcache in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_content_delivery_network_rule \u2013 Configure WAN optimization content delivery network rules in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_peer \u2013 Configure WAN optimization peers in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_profile \u2013 Configure WAN optimization profiles in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_remote_storage \u2013 Configure a remote cache device as Web cache storage in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_settings \u2013 Configure WAN optimization settings in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_webcache \u2013 Configure global Web cache settings in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_debug_url \u2013 Configure debug URL addresses in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_explicit \u2013 Configure explicit Web proxy settings in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_forward_server \u2013 Configure forward-server addresses in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_forward_server_group \u2013 Configure a forward server group consisting or multiple forward servers. Supports failover and load balancing in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_global \u2013 Configure Web proxy global settings in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_profile \u2013 Configure web proxy profiles in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_url_match \u2013 Exempt URLs from web proxy forwarding and caching in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_wisp \u2013 Configure Wireless Internet service provider (WISP) servers in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter \u2013 Configure webfilter capabilities of FortiGate and FortiOS fortios_webfilter_content \u2013 Configure Web filter banned word table in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_content_header \u2013 Configure content types used by Web filter in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_fortiguard \u2013 Configure FortiGuard Web Filter service in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_ftgd_local_cat \u2013 Configure FortiGuard Web Filter local categories in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_ftgd_local_rating \u2013 Configure local FortiGuard Web Filter local ratings in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_ips_urlfilter_cache_setting \u2013 Configure IPS URL filter cache settings in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_ips_urlfilter_setting \u2013 Configure IPS URL filter settings in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_ips_urlfilter_setting6 \u2013 Configure IPS URL filter settings for IPv6 in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_override \u2013 Configure FortiGuard Web Filter administrative overrides in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_profile \u2013 Configure Web filter profiles in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_search_engine \u2013 Configure web filter search engines in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_urlfilter \u2013 Configure URL filter lists in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_ap_status \u2013 Configure access point status (rogue | accepted | suppressed) in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_ble_profile \u2013 Configure Bluetooth Low Energy profile in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_bonjour_profile \u2013 Configure Bonjour profiles. Bonjour is Apple\u2019s zero configuration networking protocol. Bonjour profiles allow APs and FortiAPs to connect to networks using Bonjour in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_global \u2013 Configure wireless controller global settings in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_anqp_3gpp_cellular \u2013 Configure 3GPP public land mobile network (PLMN) in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_anqp_ip_address_type \u2013 Configure IP address type availability in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_anqp_nai_realm \u2013 Configure network access identifier (NAI) realm in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_anqp_network_auth_type \u2013 Configure network authentication type in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_anqp_roaming_consortium \u2013 Configure roaming consortium in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_anqp_venue_name \u2013 Configure venue name duple in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_h2qp_conn_capability \u2013 Configure connection capability in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_h2qp_operator_name \u2013 Configure operator friendly name in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_h2qp_osu_provider \u2013 Configure online sign up (OSU) provider list in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_h2qp_wan_metric \u2013 Configure WAN metrics in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_hs_profile \u2013 Configure hotspot profile in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_icon \u2013 Configure OSU provider icon in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_qos_map \u2013 Configure QoS map set in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_inter_controller \u2013 Configure inter wireless controller operation in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_qos_profile \u2013 Configure WiFi quality of service (QoS) profiles in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_setting \u2013 VDOM wireless controller configuration in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_timers \u2013 Configure CAPWAP timers in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_utm_profile \u2013 Configure UTM (Unified Threat Management) profile in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_vap \u2013 Configure Virtual Access Points (VAPs) in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_vap_group \u2013 Configure virtual Access Point (VAP) groups in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_wids_profile \u2013 Configure wireless intrusion detection system (WIDS) profiles in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_wtp \u2013 Configure Wireless Termination Points (WTPs), that is, FortiAPs or APs to be managed by FortiGate in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_wtp_group \u2013 Configure WTP groups in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_wtp_profile \u2013 Configure WTP profiles or FortiAP profiles that define radio settings for manageable FortiAP platforms in Fortinet\u2019s FortiOS and FortiGate Frr \u00b6 frr_bgp \u2013 Configure global BGP settings on Free Range Routing(FRR) frr_facts \u2013 Collect facts from remote devices running Free Range Routing (FRR) Ftd \u00b6 ftd_configuration \u2013 Manages configuration on Cisco FTD devices over REST API ftd_file_download \u2013 Downloads files from Cisco FTD devices over HTTP(S) ftd_file_upload \u2013 Uploads files to Cisco FTD devices over HTTP(S) ftd_install \u2013 Installs FTD pkg image on the firewall Icx \u00b6 icx_banner \u2013 Manage multiline banners on Ruckus ICX 7000 series switches icx_command \u2013 Run arbitrary commands on remote Ruckus ICX 7000 series switches icx_config \u2013 Manage configuration sections of Ruckus ICX 7000 series switches icx_copy \u2013 Transfer files from or to remote Ruckus ICX 7000 series switches icx_facts \u2013 Collect facts from remote Ruckus ICX 7000 series switches icx_interface \u2013 Manage Interface on Ruckus ICX 7000 series switches icx_l3_interface \u2013 Manage Layer-3 interfaces on Ruckus ICX 7000 series switches icx_linkagg \u2013 Manage link aggregation groups on Ruckus ICX 7000 series switches icx_lldp \u2013 Manage LLDP configuration on Ruckus ICX 7000 series switches icx_logging \u2013 Manage logging on Ruckus ICX 7000 series switches icx_ping \u2013 Tests reachability using ping from Ruckus ICX 7000 series switches icx_static_route \u2013 Manage static IP routes on Ruckus ICX 7000 series switches icx_system \u2013 Manage the system attributes on Ruckus ICX 7000 series switches icx_user \u2013 Manage the user accounts on Ruckus ICX 7000 series switches icx_vlan \u2013 Manage VLANs on Ruckus ICX 7000 series switches Illumos \u00b6 dladm_etherstub \u2013 Manage etherstubs on Solaris/illumos systems dladm_iptun \u2013 Manage IP tunnel interfaces on Solaris/illumos systems dladm_linkprop \u2013 Manage link properties on Solaris/illumos systems dladm_vlan \u2013 Manage VLAN interfaces on Solaris/illumos systems dladm_vnic \u2013 Manage VNICs on Solaris/illumos systems flowadm \u2013 Manage bandwidth resource control and priority for protocols, services and zones on Solaris/illumos systems ipadm_addr \u2013 Manage IP addresses on an interface on Solaris/illumos systems ipadm_addrprop \u2013 Manage IP address properties on Solaris/illumos systems ipadm_if \u2013 Manage IP interfaces on Solaris/illumos systems ipadm_ifprop \u2013 Manage IP interface properties on Solaris/illumos systems ipadm_prop \u2013 Manage protocol properties on Solaris/illumos systems Ingate \u00b6 ig_config \u2013 Manage the configuration database on an Ingate SBC ig_unit_information \u2013 Get unit information from an Ingate SBC Interface \u00b6 net_interface \u2013 Manage Interface on network devices (D) net_linkagg \u2013 Manage link aggregation groups on network devices (D) net_lldp_interface \u2013 Manage LLDP interfaces configuration on network devices (D) Ios \u00b6 ios_banner \u2013 Manage multiline banners on Cisco IOS devices ios_bgp \u2013 Configure global BGP protocol settings on Cisco IOS ios_command \u2013 Run commands on remote devices running Cisco IOS ios_config \u2013 Manage Cisco IOS configuration sections ios_facts \u2013 Collect facts from remote devices running Cisco IOS ios_interface \u2013 Manage Interface on Cisco IOS network devices (D) ios_interfaces \u2013 Manages interface attributes of Cisco IOS network devices ios_l2_interface \u2013 Manage Layer-2 interface on Cisco IOS devices (D) ios_l2_interfaces \u2013 Manage Layer-2 interface on Cisco IOS devices ios_l3_interface \u2013 Manage Layer-3 interfaces on Cisco IOS network devices (D) ios_l3_interfaces \u2013 Manage Layer-3 interface on Cisco IOS devices ios_lacp \u2013 Manage Global Link Aggregation Control Protocol (LACP) on Cisco IOS devices ios_lacp_interfaces \u2013 Manage Link Aggregation Control Protocol (LACP) on Cisco IOS devices interface ios_lag_interfaces \u2013 Manage Link Aggregation on Cisco IOS devices ios_linkagg \u2013 Manage link aggregation groups on Cisco IOS network devices ios_lldp \u2013 Manage LLDP configuration on Cisco IOS network devices ios_lldp_global \u2013 Configure and manage Link Layer Discovery Protocol(LLDP) attributes on IOS platforms ios_lldp_interfaces \u2013 Manage link layer discovery protocol (LLDP) attributes of interfaces on Cisco IOS devices ios_logging \u2013 Manage logging on network devices ios_ntp \u2013 Manages core NTP configuration ios_ping \u2013 Tests reachability using ping from Cisco IOS network devices ios_static_route \u2013 Manage static IP routes on Cisco IOS network devices ios_system \u2013 Manage the system attributes on Cisco IOS devices ios_user \u2013 Manage the aggregate of local users on Cisco IOS device ios_vlan \u2013 Manage VLANs on IOS network devices (D) ios_vlans \u2013 Manage VLANs on Cisco IOS devices ios_vrf \u2013 Manage the collection of VRF definitions on Cisco IOS devices Iosxr \u00b6 iosxr_banner \u2013 Manage multiline banners on Cisco IOS XR devices iosxr_bgp \u2013 Configure global BGP protocol settings on Cisco IOS-XR iosxr_command \u2013 Run commands on remote devices running Cisco IOS XR iosxr_config \u2013 Manage Cisco IOS XR configuration sections iosxr_facts \u2013 Get facts about iosxr devices iosxr_interface \u2013 Manage Interface on Cisco IOS XR network devices (D) iosxr_interfaces \u2013 Manage interface attributes on Cisco IOS-XR network devices iosxr_l2_interfaces \u2013 Manage Layer-2 interface on Cisco IOS-XR devices iosxr_l3_interfaces \u2013 Manage Layer-3 interface on Cisco IOS-XR devices iosxr_lacp \u2013 Manage Global Link Aggregation Control Protocol (LACP) on IOS-XR devices iosxr_lacp_interfaces \u2013 Manage Link Aggregation Control Protocol (LACP) attributes of interfaces on IOS-XR devices iosxr_lag_interfaces \u2013 Manages attributes of LAG/Ether-Bundle interfaces on IOS-XR devices iosxr_lldp_global \u2013 Manage Global Link Layer Discovery Protocol (LLDP) settings on IOS-XR devices iosxr_lldp_interfaces \u2013 Manage Link Layer Discovery Protocol (LLDP) attributes of interfaces on IOS-XR devices iosxr_logging \u2013 Configuration management of system logging services on network devices iosxr_netconf \u2013 Configures NetConf sub-system service on Cisco IOS-XR devices iosxr_system \u2013 Manage the system attributes on Cisco IOS XR devices iosxr_user \u2013 Manage the aggregate of local users on Cisco IOS XR device Ironware \u00b6 ironware_command \u2013 Run arbitrary commands on Extreme IronWare devices ironware_config \u2013 Manage configuration sections on Extreme Ironware devices ironware_facts \u2013 Collect facts from devices running Extreme Ironware Itential \u00b6 iap_start_workflow \u2013 Start a workflow in the Itential Automation Platform iap_token \u2013 Get token for the Itential Automation Platform Junos \u00b6 junos_banner \u2013 Manage multiline banners on Juniper JUNOS devices junos_command \u2013 Run arbitrary commands on an Juniper JUNOS device junos_config \u2013 Manage configuration on devices running Juniper JUNOS junos_facts \u2013 Collect facts from remote devices running Juniper Junos junos_interface \u2013 Manage Interface on Juniper JUNOS network devices (D) junos_interfaces \u2013 Manages interface attributes of Juniper Junos OS network devices junos_l2_interface \u2013 Manage Layer-2 interface on Juniper JUNOS network devices (D) junos_l2_interfaces \u2013 Manage Layer-2 interface on Juniper JUNOS devices junos_l3_interface \u2013 Manage L3 interfaces on Juniper JUNOS network devices (D) junos_l3_interfaces \u2013 Manage Layer 3 interface on Juniper JUNOS devices junos_lacp \u2013 Manage Global Link Aggregation Control Protocol (LACP) on Juniper Junos devices junos_lacp_interfaces \u2013 Manage Link Aggregation Control Protocol (LACP) attributes of interfaces on Juniper JUNOS devices junos_lag_interfaces \u2013 Manage Link Aggregation on Juniper JUNOS devices junos_linkagg \u2013 Manage link aggregation groups on Juniper JUNOS network devices (D) junos_lldp \u2013 Manage LLDP configuration on Juniper JUNOS network devices (D) junos_lldp_global \u2013 Manage link layer discovery protocol (LLDP) attributes on Juniper JUNOS devices junos_lldp_interface \u2013 Manage LLDP interfaces configuration on Juniper JUNOS network devices (D) junos_lldp_interfaces \u2013 Manage link layer discovery protocol (LLDP) attributes of interfaces on Juniper JUNOS devices junos_logging \u2013 Manage logging on network devices junos_netconf \u2013 Configures the Junos Netconf system service junos_package \u2013 Installs packages on remote devices running Junos junos_ping \u2013 Tests reachability using ping from devices running Juniper JUNOS junos_rpc \u2013 Runs an arbitrary RPC over NetConf on an Juniper JUNOS device junos_scp \u2013 Transfer files from or to remote devices running Junos junos_static_route \u2013 Manage static IP routes on Juniper JUNOS network devices junos_system \u2013 Manage the system attributes on Juniper JUNOS devices junos_user \u2013 Manage local user accounts on Juniper JUNOS devices junos_vlan \u2013 Manage VLANs on Juniper JUNOS network devices (D) junos_vlans \u2013 Create and manage VLAN configurations on Junos OS junos_vrf \u2013 Manage the VRF definitions on Juniper JUNOS devices Layer2 \u00b6 net_l2_interface \u2013 Manage Layer-2 interface on network devices (D) net_vlan \u2013 Manage VLANs on network devices (D) Layer3 \u00b6 net_l3_interface \u2013 Manage L3 interfaces on network devices (D) net_vrf \u2013 Manage VRFs on network devices (D) Meraki \u00b6 meraki_admin \u2013 Manage administrators in the Meraki cloud meraki_config_template \u2013 Manage configuration templates in the Meraki cloud meraki_content_filtering \u2013 Edit Meraki MX content filtering policies meraki_device \u2013 Manage devices in the Meraki cloud meraki_firewalled_services \u2013 Edit firewall policies for administrative network services meraki_malware \u2013 Manage Malware Protection in the Meraki cloud meraki_mr_l3_firewall \u2013 Manage MR access point layer 3 firewalls in the Meraki cloud meraki_mx_l3_firewall \u2013 Manage MX appliance layer 3 firewalls in the Meraki cloud meraki_mx_l7_firewall \u2013 Manage MX appliance layer 7 firewalls in the Meraki cloud meraki_nat \u2013 Manage NAT rules in Meraki cloud meraki_network \u2013 Manage networks in the Meraki cloud meraki_organization \u2013 Manage organizations in the Meraki cloud meraki_snmp \u2013 Manage organizations in the Meraki cloud meraki_ssid \u2013 Manage wireless SSIDs in the Meraki cloud meraki_static_route \u2013 Manage static routes in the Meraki cloud meraki_switchport \u2013 Manage switchports on a switch in the Meraki cloud meraki_syslog \u2013 Manage syslog server settings in the Meraki cloud meraki_vlan \u2013 Manage VLANs in the Meraki cloud meraki_webhook \u2013 Manage webhooks configured in the Meraki cloud Netact \u00b6 netact_cm_command \u2013 Manage network configuration data in Nokia Core and Radio networks Netconf \u00b6 netconf_config \u2013 netconf device configuration netconf_get \u2013 Fetch configuration/state data from NETCONF enabled network devices netconf_rpc \u2013 Execute operations on NETCONF enabled network devices Netscaler \u00b6 netscaler_cs_action \u2013 Manage content switching actions netscaler_cs_policy \u2013 Manage content switching policy netscaler_cs_vserver \u2013 Manage content switching vserver netscaler_gslb_service \u2013 Manage gslb service entities in Netscaler netscaler_gslb_site \u2013 Manage gslb site entities in Netscaler netscaler_gslb_vserver \u2013 Configure gslb vserver entities in Netscaler netscaler_lb_monitor \u2013 Manage load balancing monitors netscaler_lb_vserver \u2013 Manage load balancing vserver configuration netscaler_nitro_request \u2013 Issue Nitro API requests to a Netscaler instance netscaler_save_config \u2013 Save Netscaler configuration netscaler_server \u2013 Manage server configuration netscaler_service \u2013 Manage service configuration in Netscaler netscaler_servicegroup \u2013 Manage service group configuration in Netscaler netscaler_ssl_certkey \u2013 Manage ssl certificate keys Netvisor \u00b6 pn_access_list \u2013 CLI command to create/delete access-list pn_access_list_ip \u2013 CLI command to add/remove access-list-ip pn_admin_service \u2013 CLI command to modify admin-service pn_admin_session_timeout \u2013 CLI command to modify admin-session-timeout pn_admin_syslog \u2013 CLI command to create/modify/delete admin-syslog pn_cluster \u2013 CLI command to create/delete a cluster (D) pn_connection_stats_settings \u2013 CLI command to modify connection-stats-settings pn_cpu_class \u2013 CLI command to create/modify/delete cpu-class pn_cpu_mgmt_class \u2013 CLI command to modify cpu-mgmt-class pn_dhcp_filter \u2013 CLI command to create/modify/delete dhcp-filter pn_dscp_map \u2013 CLI command to create/delete dscp-map pn_dscp_map_pri_map \u2013 CLI command to modify dscp-map-pri-map pn_fabric_local \u2013 CLI command to modify fabric-local pn_igmp_snooping \u2013 CLI command to modify igmp-snooping pn_ipv6security_raguard \u2013 CLI command to create/modify/delete ipv6security-raguard pn_ipv6security_raguard_port \u2013 CLI command to add/remove ipv6security-raguard-port pn_ipv6security_raguard_vlan \u2013 CLI command to add/remove ipv6security-raguard-vlan pn_log_audit_exception \u2013 CLI command to create/delete an audit exception pn_ospf \u2013 CLI command to add/remove ospf protocol to a vRouter (D) pn_ospfarea \u2013 CLI command to add/remove ospf area to/from a vrouter (D) pn_port_config \u2013 CLI command to modify port-config pn_port_cos_bw \u2013 CLI command to modify port-cos-bw pn_port_cos_rate_setting \u2013 CLI command to modify port-cos-rate-setting pn_prefix_list \u2013 CLI command to create/delete prefix-list pn_prefix_list_network \u2013 CLI command to add/remove prefix-list-network pn_role \u2013 CLI command to create/delete/modify role pn_show \u2013 Run show commands on nvOS device (D) pn_snmp_community \u2013 CLI command to create/modify/delete snmp-community pn_snmp_trap_sink \u2013 CLI command to create/delete snmp-trap-sink pn_snmp_vacm \u2013 CLI command to create/modify/delete snmp-vacm pn_stp \u2013 CLI command to modify stp pn_stp_port \u2013 CLI command to modify stp-port pn_switch_setup \u2013 CLI command to modify switch-setup pn_trunk \u2013 CLI command to create/delete/modify a trunk (D) pn_user \u2013 CLI command to create/modify/delete user pn_vflow_table_profile \u2013 CLI command to modify vflow-table-profile pn_vlag \u2013 CLI command to create/delete/modify vlag (D) pn_vlan \u2013 CLI command to create/delete a VLAN (D) pn_vrouter \u2013 CLI command to create/delete/modify a vrouter (D) pn_vrouter_bgp \u2013 CLI command to add/modify/remove vrouter-bgp pn_vrouter_bgp_network \u2013 CLI command to add/remove vrouter-bgp-network pn_vrouter_interface_ip \u2013 CLI command to add/remove vrouter-interface-ip pn_vrouter_loopback_interface \u2013 CLI command to add/remove vrouter-loopback-interface pn_vrouter_ospf \u2013 CLI command to add/remove vrouter-ospf pn_vrouter_ospf6 \u2013 CLI command to add/remove vrouter-ospf6 pn_vrouter_packet_relay \u2013 CLI command to add/remove vrouter-packet-relay pn_vrouter_pim_config \u2013 CLI command to modify vrouter-pim-config pn_vrouterbgp \u2013 CLI command to add/remove/modify vrouter-bgp (D) pn_vrouterif \u2013 CLI command to add/remove/modify vrouter-interface (D) pn_vrouterlbif \u2013 CLI command to add/remove vrouter-loopback-interface (D) pn_vtep \u2013 CLI command to create/delete vtep Nos \u00b6 nos_command \u2013 Run commands on remote devices running Extreme Networks NOS nos_config \u2013 Manage Extreme Networks NOS configuration sections nos_facts \u2013 Collect facts from devices running Extreme NOS Nso \u00b6 nso_action \u2013 Executes Cisco NSO actions and verifies output nso_config \u2013 Manage Cisco NSO configuration and service synchronization nso_query \u2013 Query data from Cisco NSO nso_show \u2013 Displays data from Cisco NSO nso_verify \u2013 Verifies Cisco NSO configuration Nuage \u00b6 nuage_vspk \u2013 Manage Nuage VSP environments Nxos \u00b6 nxos_aaa_server \u2013 Manages AAA server global configuration nxos_aaa_server_host \u2013 Manages AAA server host-specific configuration nxos_acl \u2013 Manages access list entries for ACLs nxos_acl_interface \u2013 Manages applying ACLs to interfaces nxos_banner \u2013 Manage multiline banners on Cisco NXOS devices nxos_bfd_global \u2013 Bidirectional Forwarding Detection (BFD) global-level configuration nxos_bfd_interfaces \u2013 Manages BFD attributes of nxos interfaces nxos_bgp \u2013 Manages BGP configuration nxos_bgp_af \u2013 Manages BGP Address-family configuration nxos_bgp_neighbor \u2013 Manages BGP neighbors configurations nxos_bgp_neighbor_af \u2013 Manages BGP address-family\u2019s neighbors configuration nxos_command \u2013 Run arbitrary command on Cisco NXOS devices nxos_config \u2013 Manage Cisco NXOS configuration sections nxos_evpn_global \u2013 Handles the EVPN control plane for VXLAN nxos_evpn_vni \u2013 Manages Cisco EVPN VXLAN Network Identifier (VNI) nxos_facts \u2013 Gets facts about NX-OS switches nxos_feature \u2013 Manage features in NX-OS switches nxos_file_copy \u2013 Copy a file to a remote NXOS device nxos_gir \u2013 Trigger a graceful removal or insertion (GIR) of the switch nxos_gir_profile_management \u2013 Create a maintenance-mode or normal-mode profile for GIR nxos_hsrp \u2013 Manages HSRP configuration on NX-OS switches nxos_igmp \u2013 Manages IGMP global configuration nxos_igmp_interface \u2013 Manages IGMP interface configuration nxos_igmp_snooping \u2013 Manages IGMP snooping global configuration nxos_install_os \u2013 Set boot options like boot, kickstart image and issu nxos_interface \u2013 Manages physical attributes of interfaces (D) nxos_interface_ospf \u2013 Manages configuration of an OSPF interface instance nxos_interfaces \u2013 Manages interface attributes of NX-OS Interfaces nxos_l2_interface \u2013 Manage Layer-2 interface on Cisco NXOS devices (D) nxos_l2_interfaces \u2013 Manages Layer-2 Interfaces attributes of NX-OS Interfaces nxos_l3_interface \u2013 Manage L3 interfaces on Cisco NXOS network devices (D) nxos_l3_interfaces \u2013 Manages Layer-3 Interfaces attributes of NX-OS Interfaces nxos_lacp \u2013 Manage Global Link Aggregation Control Protocol (LACP) on Cisco NX-OS devices nxos_lacp_interfaces \u2013 Manage Link Aggregation Control Protocol (LACP) attributes of interfaces on Cisco NX-OS devices nxos_lag_interfaces \u2013 Manages link aggregation groups of NX-OS Interfaces nxos_linkagg \u2013 Manage link aggregation groups on Cisco NXOS devices (D) nxos_lldp \u2013 Manage LLDP configuration on Cisco NXOS network devices nxos_lldp_global \u2013 Configure and manage Link Layer Discovery Protocol(LLDP) attributes on NX-OS platforms nxos_logging \u2013 Manage logging on network devices nxos_ntp \u2013 Manages core NTP configuration nxos_ntp_auth \u2013 Manages NTP authentication nxos_ntp_options \u2013 Manages NTP options nxos_nxapi \u2013 Manage NXAPI configuration on an NXOS device nxos_ospf \u2013 Manages configuration of an ospf instance nxos_ospf_vrf \u2013 Manages a VRF for an OSPF router nxos_overlay_global \u2013 Configures anycast gateway MAC of the switch nxos_pim \u2013 Manages configuration of a PIM instance nxos_pim_interface \u2013 Manages PIM interface configuration nxos_pim_rp_address \u2013 Manages configuration of an PIM static RP address instance nxos_ping \u2013 Tests reachability using ping from Nexus switch nxos_reboot \u2013 Reboot a network device nxos_rollback \u2013 Set a checkpoint or rollback to a checkpoint nxos_rpm \u2013 Install patch or feature rpms on Cisco NX-OS devices nxos_smu \u2013 Perform SMUs on Cisco NX-OS devices nxos_snapshot \u2013 Manage snapshots of the running states of selected features nxos_snmp_community \u2013 Manages SNMP community configs nxos_snmp_contact \u2013 Manages SNMP contact info nxos_snmp_host \u2013 Manages SNMP host configuration nxos_snmp_location \u2013 Manages SNMP location information nxos_snmp_traps \u2013 Manages SNMP traps nxos_snmp_user \u2013 Manages SNMP users for monitoring nxos_static_route \u2013 Manages static route configuration nxos_system \u2013 Manage the system attributes on Cisco NXOS devices nxos_telemetry \u2013 Telemetry Monitoring Service (TMS) configuration nxos_udld \u2013 Manages UDLD global configuration params nxos_udld_interface \u2013 Manages UDLD interface configuration params nxos_user \u2013 Manage the collection of local users on Nexus devices nxos_vlan \u2013 Manages VLAN resources and attributes (D) nxos_vlans \u2013 Create VLAN and manage VLAN configurations on NX-OS Interfaces nxos_vpc \u2013 Manages global VPC configuration nxos_vpc_interface \u2013 Manages interface VPC configuration nxos_vrf \u2013 Manages global VRF configuration nxos_vrf_af \u2013 Manages VRF AF nxos_vrf_interface \u2013 Manages interface specific VRF configuration nxos_vrrp \u2013 Manages VRRP configuration on NX-OS switches nxos_vtp_domain \u2013 Manages VTP domain configuration nxos_vtp_password \u2013 Manages VTP password configuration nxos_vtp_version \u2013 Manages VTP version configuration nxos_vxlan_vtep \u2013 Manages VXLAN Network Virtualization Endpoint (NVE) nxos_vxlan_vtep_vni \u2013 Creates a Virtual Network Identifier member (VNI) Onyx \u00b6 onyx_bgp \u2013 Configures BGP on Mellanox ONYX network devices onyx_buffer_pool \u2013 Configures Buffer Pool onyx_command \u2013 Run commands on remote devices running Mellanox ONYX onyx_config \u2013 Manage Mellanox ONYX configuration sections onyx_facts \u2013 Collect facts from Mellanox ONYX network devices onyx_igmp \u2013 Configures IGMP global parameters onyx_igmp_interface \u2013 Configures IGMP interface parameters onyx_igmp_vlan \u2013 Configures IGMP Vlan parameters onyx_interface \u2013 Manage Interfaces on Mellanox ONYX network devices onyx_l2_interface \u2013 Manage Layer-2 interface on Mellanox ONYX network devices onyx_l3_interface \u2013 Manage L3 interfaces on Mellanox ONYX network devices onyx_linkagg \u2013 Manage link aggregation groups on Mellanox ONYX network devices onyx_lldp \u2013 Manage LLDP configuration on Mellanox ONYX network devices onyx_lldp_interface \u2013 Manage LLDP interfaces configuration on Mellanox ONYX network devices onyx_magp \u2013 Manage MAGP protocol on Mellanox ONYX network devices onyx_mlag_ipl \u2013 Manage IPL (inter-peer link) on Mellanox ONYX network devices onyx_mlag_vip \u2013 Configures MLAG VIP on Mellanox ONYX network devices onyx_ospf \u2013 Manage OSPF protocol on Mellanox ONYX network devices onyx_pfc_interface \u2013 Manage priority flow control on ONYX network devices onyx_protocol \u2013 Enables/Disables protocols on Mellanox ONYX network devices onyx_ptp_global \u2013 Configures PTP Global parameters onyx_ptp_interface \u2013 Configures PTP on interface onyx_qos \u2013 Configures QoS onyx_traffic_class \u2013 Configures Traffic Class onyx_vlan \u2013 Manage VLANs on Mellanox ONYX network devices onyx_vxlan \u2013 Configures Vxlan onyx_wjh \u2013 Configure what-just-happend module Opx \u00b6 opx_cps \u2013 CPS operations on networking device running Openswitch (OPX) Ordnance \u00b6 ordnance_config \u2013 Manage Ordnance configuration sections ordnance_facts \u2013 Collect facts from Ordnance Virtual Routers over SSH Ovs \u00b6 openvswitch_bridge \u2013 Manage Open vSwitch bridges openvswitch_db \u2013 Configure open vswitch database openvswitch_port \u2013 Manage Open vSwitch ports Panos \u00b6 panos_admin \u2013 Add or modify PAN-OS user accounts password (D) panos_admpwd \u2013 change admin password of PAN-OS device using SSH with SSH key (D) panos_cert_gen_ssh \u2013 generates a self-signed certificate using SSH protocol with SSH key (D) panos_check \u2013 check if PAN-OS device is ready for configuration (D) panos_commit \u2013 commit firewall\u2019s candidate configuration (D) panos_dag \u2013 create a dynamic address group (D) panos_dag_tags \u2013 Create tags for DAG\u2019s on PAN-OS devices (D) panos_import \u2013 import file on PAN-OS devices (D) panos_interface \u2013 configure data-port network interface for DHCP (D) panos_lic \u2013 apply authcode to a device/instance (D) panos_loadcfg \u2013 load configuration on PAN-OS device (D) panos_match_rule \u2013 Test for match against a security rule on PAN-OS devices or Panorama management console (D) panos_mgtconfig \u2013 configure management settings of device (D) panos_nat_rule \u2013 create a policy NAT rule (D) panos_object \u2013 create/read/update/delete object in PAN-OS or Panorama (D) panos_op \u2013 execute arbitrary OP commands on PANW devices (e.g. show interface all) (D) panos_pg \u2013 create a security profiles group (D) panos_query_rules \u2013 PANOS module that allows search for security rules in PANW NGFW devices (D) panos_restart \u2013 restart a device (D) panos_sag \u2013 Create a static address group (D) panos_security_rule \u2013 Create security rule policy on PAN-OS devices or Panorama management console (D) panos_set \u2013 Execute arbitrary commands on a PAN-OS device using XPath and element (D) Protocol \u00b6 net_lldp \u2013 Manage LLDP service configuration on network devices (D) Radware \u00b6 vdirect_commit \u2013 Commits pending configuration changes on Radware devices vdirect_file \u2013 Uploads a new or updates an existing runnable file into Radware vDirect server vdirect_runnable \u2013 Runs templates and workflow actions in Radware vDirect server Restconf \u00b6 restconf_config \u2013 Handles create, update, read and delete of configuration data on RESTCONF enabled devices restconf_get \u2013 Fetch configuration/state data from RESTCONF enabled devices Routeros \u00b6 routeros_command \u2013 Run commands on remote devices running MikroTik RouterOS routeros_facts \u2013 Collect facts from remote devices running MikroTik RouterOS Routing \u00b6 net_static_route \u2013 Manage static IP routes on network appliances (routers, switches et. al.) (D) Skydive \u00b6 skydive_capture \u2013 Module which manages flow capture on interfaces skydive_edge \u2013 Module to add edges to Skydive topology skydive_node \u2013 Module which add nodes to Skydive topology Slxos \u00b6 slxos_command \u2013 Run commands on remote devices running Extreme Networks SLX-OS slxos_config \u2013 Manage Extreme Networks SLX-OS configuration sections slxos_facts \u2013 Collect facts from devices running Extreme SLX-OS slxos_interface \u2013 Manage Interfaces on Extreme SLX-OS network devices slxos_l2_interface \u2013 Manage Layer-2 interface on Extreme Networks SLX-OS devices slxos_l3_interface \u2013 Manage L3 interfaces on Extreme Networks SLX-OS network devices slxos_linkagg \u2013 Manage link aggregation groups on Extreme Networks SLX-OS network devices slxos_lldp \u2013 Manage LLDP configuration on Extreme Networks SLX-OS network devices slxos_vlan \u2013 Manage VLANs on Extreme Networks SLX-OS network devices Sros \u00b6 sros_command \u2013 Run commands on remote devices running Nokia SR OS sros_config \u2013 Manage Nokia SR OS device configuration sros_rollback \u2013 Configure Nokia SR OS rollback System \u00b6 net_banner \u2013 Manage multiline banners on network devices (D) net_logging \u2013 Manage logging on network devices (D) net_ping \u2013 Tests reachability using ping from a network device net_system \u2013 Manage the system attributes on network devices (D) net_user \u2013 Manage the aggregate of local users on network device (D) Voss \u00b6 voss_command \u2013 Run commands on remote devices running Extreme VOSS voss_config \u2013 Manage Extreme VOSS configuration sections voss_facts \u2013 Collect facts from remote devices running Extreme VOSS Vyos \u00b6 vyos_banner \u2013 Manage multiline banners on VyOS devices vyos_command \u2013 Run one or more commands on VyOS devices vyos_config \u2013 Manage VyOS configuration on remote device vyos_facts \u2013 Get facts about vyos devices vyos_interface \u2013 Manage Interface on VyOS network devices (D) vyos_interfaces \u2013 Manages interface attributes of VyOS network devices vyos_l3_interface \u2013 Manage L3 interfaces on VyOS network devices (D) vyos_l3_interfaces \u2013 Manages L3 interface attributes of VyOS network devices vyos_lag_interfaces \u2013 Manages attributes of link aggregation groups on VyOS network devices vyos_linkagg \u2013 Manage link aggregation groups on VyOS network devices (D) vyos_lldp \u2013 Manage LLDP configuration on VyOS network devices (D) vyos_lldp_global \u2013 Manage link layer discovery protocol (LLDP) attributes on VyOS devices vyos_lldp_interface \u2013 Manage LLDP interfaces configuration on VyOS network devices (D) vyos_lldp_interfaces \u2013 Manages attributes of lldp interfaces on VyOS devices vyos_logging \u2013 Manage logging on network devices vyos_ping \u2013 Tests reachability using ping from VyOS network devices vyos_static_route \u2013 Manage static IP routes on Vyatta VyOS network devices vyos_system \u2013 Run set system commands on VyOS devices vyos_user \u2013 Manage the collection of local users on VyOS device vyos_vlan \u2013 Manage VLANs on VyOS network devices Notification modules \u00b6 bearychat \u2013 Send BearyChat notifications campfire \u2013 Send a message to Campfire catapult \u2013 Send a sms / mms using the catapult bandwidth api cisco_spark \u2013 Send a message to a Cisco Spark Room or Individual flowdock \u2013 Send a message to a flowdock grove \u2013 Sends a notification to a grove.io channel hipchat \u2013 Send a message to Hipchat irc \u2013 Send a message to an IRC channel jabber \u2013 Send a message to jabber user or chat room logentries_msg \u2013 Send a message to logentries mail \u2013 Send an email matrix \u2013 Send notifications to matrix mattermost \u2013 Send Mattermost notifications mqtt \u2013 Publish a message on an MQTT topic for the IoT nexmo \u2013 Send a SMS via nexmo office_365_connector_card \u2013 Use webhooks to create Connector Card messages within an Office 365 group pushbullet \u2013 Sends notifications to Pushbullet pushover \u2013 Send notifications via https://pushover.net rabbitmq_publish \u2013 Publish a message to a RabbitMQ queue rocketchat \u2013 Send notifications to Rocket Chat say \u2013 Makes a computer to speak sendgrid \u2013 Sends an email with the SendGrid API slack \u2013 Send Slack notifications snow_record \u2013 Manage records in ServiceNow snow_record_find \u2013 Search for multiple records from ServiceNow syslogger \u2013 Log messages in the syslog telegram \u2013 module for sending notifications via telegram twilio \u2013 Sends a text message to a mobile phone through Twilio typetalk \u2013 Send a message to typetalk Packaging modules \u00b6 Language \u00b6 bower \u2013 Manage bower packages with bower bundler \u2013 Manage Ruby Gem dependencies with Bundler composer \u2013 Dependency Manager for PHP cpanm \u2013 Manages Perl library dependencies easy_install \u2013 Installs Python libraries gem \u2013 Manage Ruby gems maven_artifact \u2013 Downloads an Artifact from a Maven Repository npm \u2013 Manage node.js packages with npm pear \u2013 Manage pear/pecl packages pip \u2013 Manages Python library dependencies pip_package_info \u2013 pip package information yarn \u2013 Manage node.js packages with Yarn Os \u00b6 apk \u2013 Manages apk packages apt \u2013 Manages apt-packages apt_key \u2013 Add or remove an apt key apt_repo \u2013 Manage APT repositories via apt-repo apt_repository \u2013 Add and remove APT repositories apt_rpm \u2013 apt_rpm package manager dnf \u2013 Manages packages with the dnf package manager dpkg_selections \u2013 Dpkg package selection selections flatpak \u2013 Manage flatpaks flatpak_remote \u2013 Manage flatpak repository remotes homebrew \u2013 Package manager for Homebrew homebrew_cask \u2013 Install/uninstall homebrew casks homebrew_tap \u2013 Tap a Homebrew repository installp \u2013 Manage packages on AIX layman \u2013 Manage Gentoo overlays macports \u2013 Package manager for MacPorts openbsd_pkg \u2013 Manage packages on OpenBSD opkg \u2013 Package manager for OpenWrt package \u2013 Generic OS package manager package_facts \u2013 package information as facts pacman \u2013 Manage packages with pacman pkg5 \u2013 Manages packages with the Solaris 11 Image Packaging System pkg5_publisher \u2013 Manages Solaris 11 Image Packaging System publishers pkgin \u2013 Package manager for SmartOS, NetBSD, et al pkgng \u2013 Package manager for FreeBSD >= 9.0 pkgutil \u2013 Manage CSW-Packages on Solaris portage \u2013 Package manager for Gentoo portinstall \u2013 Installing packages from FreeBSD\u2019s ports system pulp_repo \u2013 Add or remove Pulp repos from a remote host redhat_subscription \u2013 Manage registration and subscriptions to RHSM using the subscription-manager command rhn_channel \u2013 Adds or removes Red Hat software channels rhn_register \u2013 Manage Red Hat Network registration using the rhnreg_ks command rhsm_release \u2013 Set or Unset RHSM Release version rhsm_repository \u2013 Manage RHSM repositories using the subscription-manager command rpm_key \u2013 Adds or removes a gpg key from the rpm db slackpkg \u2013 Package manager for Slackware >= 12.2 snap \u2013 Manages snaps sorcery \u2013 Package manager for Source Mage GNU/Linux svr4pkg \u2013 Manage Solaris SVR4 packages swdepot \u2013 Manage packages with swdepot package manager (HP-UX) swupd \u2013 Manages updates and bundles in ClearLinux systems urpmi \u2013 Urpmi manager xbps \u2013 Manage packages with XBPS yum \u2013 Manages packages with the yum package manager yum_repository \u2013 Add or remove YUM repositories zypper \u2013 Manage packages on SUSE and openSUSE zypper_repository \u2013 Add and remove Zypper repositories Remote Management modules \u00b6 wakeonlan \u2013 Send a magic Wake-on-LAN (WoL) broadcast packet Cobbler \u00b6 cobbler_sync \u2013 Sync Cobbler cobbler_system \u2013 Manage system objects in Cobbler Cpm \u00b6 cpm_plugconfig \u2013 Get and Set Plug Parameters on WTI OOB and PDU power devices cpm_plugcontrol \u2013 Get and Set Plug actions on WTI OOB and PDU power devices cpm_serial_port_config \u2013 Set Serial port parameters in WTI OOB and PDU devices cpm_serial_port_info \u2013 Get Serial port parameters in WTI OOB and PDU devices cpm_user \u2013 Get various status and parameters from WTI OOB and PDU devices Dellemc \u00b6 idrac_firmware \u2013 Firmware update from a repository on a network share (CIFS, NFS) idrac_server_config_profile \u2013 Export or Import iDRAC Server Configuration Profile (SCP) ome_device_info \u2013 Retrieves the information about Device Foreman \u00b6 foreman \u2013 Manage Foreman Resources (D) katello \u2013 Manage Katello Resources (D) Hpilo \u00b6 hpilo_boot \u2013 Boot system using specific media through HP iLO interface hpilo_info \u2013 Gather information through an HP iLO interface hponcfg \u2013 Configure HP iLO interface using hponcfg Imc \u00b6 imc_rest \u2013 Manage Cisco IMC hardware through its REST API Intersight \u00b6 intersight_info \u2013 Gather information about Intersight intersight_rest_api \u2013 REST API configuration for Cisco Intersight Ipmi \u00b6 ipmi_boot \u2013 Management of order of boot devices ipmi_power \u2013 Power management for machine Lxca \u00b6 lxca_cmms \u2013 Custom module for lxca cmms inventory utility lxca_nodes \u2013 Custom module for lxca nodes inventory utility Manageiq \u00b6 manageiq_alert_profiles \u2013 Configuration of alert profiles for ManageIQ manageiq_alerts \u2013 Configuration of alerts in ManageIQ manageiq_group \u2013 Management of groups in ManageIQ manageiq_policies \u2013 Management of resource policy_profiles in ManageIQ manageiq_provider \u2013 Management of provider in ManageIQ manageiq_tags \u2013 Management of resource tags in ManageIQ manageiq_tenant \u2013 Management of tenants in ManageIQ manageiq_user \u2013 Management of users in ManageIQ Oneview \u00b6 oneview_datacenter_info \u2013 Retrieve information about the OneView Data Centers oneview_enclosure_info \u2013 Retrieve information about one or more Enclosures oneview_ethernet_network \u2013 Manage OneView Ethernet Network resources oneview_ethernet_network_info \u2013 Retrieve the information about one or more of the OneView Ethernet Networks oneview_fc_network \u2013 Manage OneView Fibre Channel Network resources oneview_fc_network_info \u2013 Retrieve the information about one or more of the OneView Fibre Channel Networks oneview_fcoe_network \u2013 Manage OneView FCoE Network resources oneview_fcoe_network_info \u2013 Retrieve the information about one or more of the OneView FCoE Networks oneview_logical_interconnect_group \u2013 Manage OneView Logical Interconnect Group resources oneview_logical_interconnect_group_info \u2013 Retrieve information about one or more of the OneView Logical Interconnect Groups oneview_network_set \u2013 Manage HPE OneView Network Set resources oneview_network_set_info \u2013 Retrieve information about the OneView Network Sets oneview_san_manager \u2013 Manage OneView SAN Manager resources oneview_san_manager_info \u2013 Retrieve information about one or more of the OneView SAN Managers Redfish \u00b6 idrac_redfish_command \u2013 Manages Out-Of-Band controllers using iDRAC OEM Redfish APIs idrac_redfish_config \u2013 Manages servers through iDRAC using Dell Redfish APIs idrac_redfish_info \u2013 Manages servers through iDRAC using Dell Redfish APIs redfish_command \u2013 Manages Out-Of-Band controllers using Redfish APIs redfish_config \u2013 Manages Out-Of-Band controllers using Redfish APIs redfish_info \u2013 Manages Out-Of-Band controllers using Redfish APIs Stacki \u00b6 stacki_host \u2013 Add or remove host to stacki front-end Ucs \u00b6 ucs_disk_group_policy \u2013 Configures disk group policies on Cisco UCS Manager ucs_dns_server \u2013 Configure DNS servers on Cisco UCS Manager ucs_ip_pool \u2013 Configures IP address pools on Cisco UCS Manager ucs_lan_connectivity \u2013 Configures LAN Connectivity Policies on Cisco UCS Manager ucs_mac_pool \u2013 Configures MAC address pools on Cisco UCS Manager ucs_managed_objects \u2013 Configures Managed Objects on Cisco UCS Manager ucs_ntp_server \u2013 Configures NTP server on Cisco UCS Manager ucs_org \u2013 Manages UCS Organizations for UCS Manager ucs_san_connectivity \u2013 Configures SAN Connectivity Policies on Cisco UCS Manager ucs_service_profile_template \u2013 Configures Service Profile Templates on Cisco UCS Manager ucs_storage_profile \u2013 Configures storage profiles on Cisco UCS Manager ucs_timezone \u2013 Configures timezone on Cisco UCS Manager ucs_uuid_pool \u2013 Configures server UUID pools on Cisco UCS Manager ucs_vhba_template \u2013 Configures vHBA templates on Cisco UCS Manager ucs_vlan_find \u2013 Find VLANs on Cisco UCS Manager ucs_vlans \u2013 Configures VLANs on Cisco UCS Manager ucs_vnic_template \u2013 Configures vNIC templates on Cisco UCS Manager ucs_vsans \u2013 Configures VSANs on Cisco UCS Manager ucs_wwn_pool \u2013 Configures WWNN or WWPN pools on Cisco UCS Manager Source Control modules \u00b6 bzr \u2013 Deploy software (or files) from bzr branches git \u2013 Deploy software (or files) from git checkouts git_config \u2013 Read and write git configuration github_deploy_key \u2013 Manages deploy keys for GitHub repositories github_hooks \u2013 Manages GitHub service hooks (D) github_issue \u2013 View GitHub issue github_key \u2013 Manage GitHub access keys github_release \u2013 Interact with GitHub Releases github_webhook \u2013 Manage GitHub webhooks github_webhook_info \u2013 Query information about GitHub webhooks gitlab_deploy_key \u2013 Manages GitLab project deploy keys gitlab_group \u2013 Creates/updates/deletes GitLab Groups gitlab_hook \u2013 Manages GitLab project hooks gitlab_project \u2013 Creates/updates/deletes GitLab Projects gitlab_project_variable \u2013 Creates/updates/deletes GitLab Projects Variables gitlab_runner \u2013 Create, modify and delete GitLab Runners gitlab_user \u2013 Creates/updates/deletes GitLab Users hg \u2013 Manages Mercurial (hg) repositories subversion \u2013 Deploys a subversion repository Bitbucket \u00b6 bitbucket_access_key \u2013 Manages Bitbucket repository access keys bitbucket_pipeline_key_pair \u2013 Manages Bitbucket pipeline SSH key pair bitbucket_pipeline_known_host \u2013 Manages Bitbucket pipeline known hosts bitbucket_pipeline_variable \u2013 Manages Bitbucket pipeline variables Storage modules \u00b6 Emc \u00b6 emc_vnx_sg_member \u2013 Manage storage group member on EMC VNX Glusterfs \u00b6 gluster_heal_info \u2013 Gather information on self-heal or rebalance status gluster_peer \u2013 Attach/Detach peers to/from the cluster gluster_volume \u2013 Manage GlusterFS volumes Hpe3Par \u00b6 ss_3par_cpg \u2013 Manage HPE StoreServ 3PAR CPG Ibm \u00b6 ibm_sa_domain \u2013 Manages domains on IBM Spectrum Accelerate Family storage systems ibm_sa_host \u2013 Adds hosts to or removes them from IBM Spectrum Accelerate Family storage systems ibm_sa_host_ports \u2013 Add host ports on IBM Spectrum Accelerate Family storage systems ibm_sa_pool \u2013 Handles pools on IBM Spectrum Accelerate Family storage systems ibm_sa_vol \u2013 Handle volumes on IBM Spectrum Accelerate Family storage systems ibm_sa_vol_map \u2013 Handles volume mapping on IBM Spectrum Accelerate Family storage systems Infinidat \u00b6 infini_export \u2013 Create, Delete or Modify NFS Exports on Infinibox infini_export_client \u2013 Create, Delete or Modify NFS Client(s) for existing exports on Infinibox infini_fs \u2013 Create, Delete or Modify filesystems on Infinibox infini_host \u2013 Create, Delete and Modify Hosts on Infinibox infini_pool \u2013 Create, Delete and Modify Pools on Infinibox infini_vol \u2013 Create, Delete or Modify volumes on Infinibox Netapp \u00b6 na_cdot_aggregate \u2013 Manage NetApp cDOT aggregates (D) na_cdot_license \u2013 Manage NetApp cDOT protocol and feature licenses (D) na_cdot_lun \u2013 Manage NetApp cDOT luns (D) na_cdot_qtree \u2013 Manage qtrees (D) na_cdot_svm \u2013 Manage NetApp cDOT svm (D) na_cdot_user \u2013 useradmin configuration and management (D) na_cdot_user_role \u2013 useradmin configuration and management (D) na_cdot_volume \u2013 Manage NetApp cDOT volumes (D) na_elementsw_access_group \u2013 NetApp Element Software Manage Access Groups na_elementsw_account \u2013 NetApp Element Software Manage Accounts na_elementsw_admin_users \u2013 NetApp Element Software Manage Admin Users na_elementsw_backup \u2013 NetApp Element Software Create Backups na_elementsw_check_connections \u2013 NetApp Element Software Check connectivity to MVIP and SVIP na_elementsw_cluster \u2013 NetApp Element Software Create Cluster na_elementsw_cluster_config \u2013 Configure Element SW Cluster na_elementsw_cluster_pair \u2013 NetApp Element Software Manage Cluster Pair na_elementsw_cluster_snmp \u2013 Configure Element SW Cluster SNMP na_elementsw_drive \u2013 NetApp Element Software Manage Node Drives na_elementsw_initiators \u2013 Manage Element SW initiators na_elementsw_ldap \u2013 NetApp Element Software Manage ldap admin users na_elementsw_network_interfaces \u2013 NetApp Element Software Configure Node Network Interfaces na_elementsw_node \u2013 NetApp Element Software Node Operation na_elementsw_snapshot \u2013 NetApp Element Software Manage Snapshots na_elementsw_snapshot_restore \u2013 NetApp Element Software Restore Snapshot na_elementsw_snapshot_schedule \u2013 NetApp Element Software Snapshot Schedules na_elementsw_vlan \u2013 NetApp Element Software Manage VLAN na_elementsw_volume \u2013 NetApp Element Software Manage Volumes na_elementsw_volume_clone \u2013 NetApp Element Software Create Volume Clone na_elementsw_volume_pair \u2013 NetApp Element Software Volume Pair na_ontap_aggregate \u2013 NetApp ONTAP manage aggregates na_ontap_autosupport \u2013 NetApp ONTAP Autosupport na_ontap_broadcast_domain \u2013 NetApp ONTAP manage broadcast domains na_ontap_broadcast_domain_ports \u2013 NetApp ONTAP manage broadcast domain ports na_ontap_cg_snapshot \u2013 NetApp ONTAP manage consistency group snapshot na_ontap_cifs \u2013 NetApp ONTAP Manage cifs-share na_ontap_cifs_acl \u2013 NetApp ONTAP manage cifs-share-access-control na_ontap_cifs_server \u2013 NetApp ONTAP CIFS server configuration na_ontap_cluster \u2013 NetApp ONTAP cluster - create, join, add license na_ontap_cluster_ha \u2013 NetApp ONTAP Manage HA status for cluster na_ontap_cluster_peer \u2013 NetApp ONTAP Manage Cluster peering na_ontap_command \u2013 NetApp ONTAP Run any cli command, the username provided needs to have console login permission na_ontap_disks \u2013 NetApp ONTAP Assign disks to nodes na_ontap_dns \u2013 NetApp ONTAP Create, delete, modify DNS servers na_ontap_export_policy \u2013 NetApp ONTAP manage export-policy na_ontap_export_policy_rule \u2013 NetApp ONTAP manage export policy rules na_ontap_fcp \u2013 NetApp ONTAP Start, Stop and Enable FCP services na_ontap_firewall_policy \u2013 NetApp ONTAP Manage a firewall policy na_ontap_firmware_upgrade \u2013 NetApp ONTAP firmware upgrade for SP, shelf, ACP, and disk na_ontap_flexcache \u2013 NetApp ONTAP FlexCache - create/delete relationship na_ontap_gather_facts \u2013 NetApp information gatherer (D) na_ontap_igroup \u2013 NetApp ONTAP iSCSI or FC igroup configuration na_ontap_igroup_initiator \u2013 NetApp ONTAP igroup initiator configuration na_ontap_info \u2013 NetApp information gatherer na_ontap_interface \u2013 NetApp ONTAP LIF configuration na_ontap_ipspace \u2013 NetApp ONTAP Manage an ipspace na_ontap_iscsi \u2013 NetApp ONTAP manage iSCSI service na_ontap_job_schedule \u2013 NetApp ONTAP Job Schedule na_ontap_kerberos_realm \u2013 NetApp ONTAP vserver nfs kerberos realm na_ontap_ldap \u2013 NetApp ONTAP LDAP na_ontap_ldap_client \u2013 NetApp ONTAP LDAP client na_ontap_license \u2013 NetApp ONTAP protocol and feature licenses na_ontap_lun \u2013 NetApp ONTAP manage LUNs na_ontap_lun_copy \u2013 NetApp ONTAP copy LUNs na_ontap_lun_map \u2013 NetApp ONTAP LUN maps na_ontap_motd \u2013 Setup motd na_ontap_ndmp \u2013 NetApp ONTAP NDMP services configuration na_ontap_net_ifgrp \u2013 NetApp Ontap modify network interface group na_ontap_net_port \u2013 NetApp ONTAP network ports na_ontap_net_routes \u2013 NetApp ONTAP network routes na_ontap_net_subnet \u2013 NetApp ONTAP Create, delete, modify network subnets na_ontap_net_vlan \u2013 NetApp ONTAP network VLAN na_ontap_nfs \u2013 NetApp ONTAP NFS status na_ontap_node \u2013 NetApp ONTAP Rename a node na_ontap_ntp \u2013 NetApp ONTAP NTP server na_ontap_nvme \u2013 NetApp ONTAP Manage NVMe Service na_ontap_nvme_namespace \u2013 NetApp ONTAP Manage NVME Namespace na_ontap_nvme_subsystem \u2013 NetApp ONTAP Manage NVME Subsystem na_ontap_object_store \u2013 NetApp ONTAP manage object store config na_ontap_ports \u2013 NetApp ONTAP add/remove ports na_ontap_portset \u2013 NetApp ONTAP Create/Delete portset na_ontap_qos_adaptive_policy_group \u2013 NetApp ONTAP Adaptive Quality of Service policy group na_ontap_qos_policy_group \u2013 NetApp ONTAP manage policy group in Quality of Service na_ontap_qtree \u2013 NetApp ONTAP manage qtrees na_ontap_quotas \u2013 NetApp ONTAP Quotas na_ontap_security_key_manager \u2013 NetApp ONTAP security key manager na_ontap_service_processor_network \u2013 NetApp ONTAP service processor network na_ontap_snapmirror \u2013 NetApp ONTAP or ElementSW Manage SnapMirror na_ontap_snapshot \u2013 NetApp ONTAP manage Snapshots na_ontap_snapshot_policy \u2013 NetApp ONTAP manage Snapshot Policy na_ontap_snmp \u2013 NetApp ONTAP SNMP community na_ontap_software_update \u2013 NetApp ONTAP Update Software na_ontap_svm \u2013 NetApp ONTAP SVM na_ontap_svm_options \u2013 NetApp ONTAP Modify SVM Options na_ontap_ucadapter \u2013 NetApp ONTAP UC adapter configuration na_ontap_unix_group \u2013 NetApp ONTAP UNIX Group na_ontap_unix_user \u2013 NetApp ONTAP UNIX users na_ontap_user \u2013 NetApp ONTAP user configuration and management na_ontap_user_role \u2013 NetApp ONTAP user role configuration and management na_ontap_volume \u2013 NetApp ONTAP manage volumes na_ontap_volume_autosize \u2013 NetApp ONTAP manage volume autosize na_ontap_volume_clone \u2013 NetApp ONTAP manage volume clones na_ontap_vscan \u2013 NetApp ONTAP Vscan enable/disable na_ontap_vscan_on_access_policy \u2013 NetApp ONTAP Vscan on access policy configuration na_ontap_vscan_on_demand_task \u2013 NetApp ONTAP Vscan on demand task configuration na_ontap_vscan_scanner_pool \u2013 NetApp ONTAP Vscan Scanner Pools Configuration na_ontap_vserver_cifs_security \u2013 NetApp ONTAP vserver CIFS security modification na_ontap_vserver_peer \u2013 NetApp ONTAP Vserver peering netapp_e_alerts \u2013 NetApp E-Series manage email notification settings netapp_e_amg \u2013 NetApp E-Series create, remove, and update asynchronous mirror groups netapp_e_amg_role \u2013 NetApp E-Series update the role of a storage array within an Asynchronous Mirror Group (AMG) netapp_e_amg_sync \u2013 NetApp E-Series conduct synchronization actions on asynchronous mirror groups netapp_e_asup \u2013 NetApp E-Series manage auto-support settings netapp_e_auditlog \u2013 NetApp E-Series manage audit-log configuration netapp_e_auth \u2013 NetApp E-Series set or update the password for a storage array netapp_e_drive_firmware \u2013 NetApp E-Series manage drive firmware netapp_e_facts \u2013 NetApp E-Series retrieve facts about NetApp E-Series storage arrays netapp_e_firmware \u2013 NetApp E-Series manage firmware netapp_e_flashcache \u2013 NetApp E-Series manage SSD caches netapp_e_global \u2013 NetApp E-Series manage global settings configuration netapp_e_host \u2013 NetApp E-Series manage eseries hosts netapp_e_hostgroup \u2013 NetApp E-Series manage array host groups netapp_e_iscsi_interface \u2013 NetApp E-Series manage iSCSI interface configuration netapp_e_iscsi_target \u2013 NetApp E-Series manage iSCSI target configuration netapp_e_ldap \u2013 NetApp E-Series manage LDAP integration to use for authentication netapp_e_lun_mapping \u2013 NetApp E-Series create, delete, or modify lun mappings netapp_e_mgmt_interface \u2013 NetApp E-Series management interface configuration netapp_e_snapshot_group \u2013 NetApp E-Series manage snapshot groups netapp_e_snapshot_images \u2013 NetApp E-Series create and delete snapshot images netapp_e_snapshot_volume \u2013 NetApp E-Series manage snapshot volumes netapp_e_storage_system \u2013 NetApp E-Series Web Services Proxy manage storage arrays netapp_e_storagepool \u2013 NetApp E-Series manage volume groups and disk pools netapp_e_syslog \u2013 NetApp E-Series manage syslog settings netapp_e_volume \u2013 NetApp E-Series manage storage volumes (standard and thin) netapp_e_volume_copy \u2013 NetApp E-Series create volume copy pairs sf_account_manager \u2013 Manage SolidFire accounts (D) sf_check_connections \u2013 Check connectivity to MVIP and SVIP (D) sf_snapshot_schedule_manager \u2013 Manage SolidFire snapshot schedules (D) sf_volume_access_group_manager \u2013 Manage SolidFire Volume Access Groups (D) sf_volume_manager \u2013 Manage SolidFire volumes (D) Purestorage \u00b6 purefa_alert \u2013 Configure Pure Storage FlashArray alert email settings purefa_arrayname \u2013 Configure Pure Storage FlashArray array name purefa_banner \u2013 Configure Pure Storage FlashArray GUI and SSH MOTD message purefa_connect \u2013 Manage replication connections between two FlashArrays purefa_dns \u2013 Configure FlashArray DNS settings purefa_ds \u2013 Configure FlashArray Directory Service purefa_dsrole \u2013 Configure FlashArray Directory Service Roles purefa_facts \u2013 Collect facts from Pure Storage FlashArray (D) purefa_hg \u2013 Manage hostgroups on Pure Storage FlashArrays purefa_host \u2013 Manage hosts on Pure Storage FlashArrays purefa_info \u2013 Collect information from Pure Storage FlashArray purefa_ntp \u2013 Configure Pure Storage FlashArray NTP settings purefa_offload \u2013 Create, modify and delete NFS or S3 offload targets purefa_pg \u2013 Manage protection groups on Pure Storage FlashArrays purefa_pgsnap \u2013 Manage protection group snapshots on Pure Storage FlashArrays purefa_phonehome \u2013 Enable or Disable Pure Storage FlashArray Phonehome purefa_ra \u2013 Enable or Disable Pure Storage FlashArray Remote Assist purefa_smtp \u2013 Configure FlashArray SMTP settings purefa_snap \u2013 Manage volume snapshots on Pure Storage FlashArrays purefa_snmp \u2013 Configure FlashArray SNMP Managers purefa_syslog \u2013 Configure Pure Storage FlashArray syslog settings purefa_user \u2013 Create, modify or delete FlashArray local user account purefa_vg \u2013 Manage volume groups on Pure Storage FlashArrays purefa_volume \u2013 Manage volumes on Pure Storage FlashArrays purefb_bucket \u2013 Manage Object Store Buckets on a Pure Storage FlashBlade purefb_ds \u2013 Configure FlashBlade Directory Service purefb_dsrole \u2013 Configure FlashBlade Management Directory Service Roles purefb_facts \u2013 Collect facts from Pure Storage FlashBlade (D) purefb_fs \u2013 Manage filesystemon Pure Storage FlashBlade` purefb_info \u2013 Collect information from Pure Storage FlashBlade purefb_network \u2013 Manage network interfaces in a Pure Storage FlashBlade purefb_ra \u2013 Enable or Disable Pure Storage FlashBlade Remote Assist purefb_s3acc \u2013 Create or delete FlashBlade Object Store accounts purefb_s3user \u2013 Create or delete FlashBlade Object Store account users purefb_smtp \u2013 Configure SMTP for Pure Storage FlashBlade purefb_snap \u2013 Manage filesystem snapshots on Pure Storage FlashBlades purefb_subnet \u2013 Manage network subnets in a Pure Storage FlashBlade Vexata \u00b6 vexata_eg \u2013 Manage export groups on Vexata VX100 storage arrays vexata_volume \u2013 Manage volumes on Vexata VX100 storage arrays Zfs \u00b6 zfs \u2013 Manage zfs zfs_delegate_admin \u2013 Manage ZFS delegated administration (user admin privileges) zfs_facts \u2013 Gather facts about ZFS datasets zpool_facts \u2013 Gather facts about ZFS pools System modules \u00b6 aix_devices \u2013 Manages AIX devices aix_filesystem \u2013 Configure LVM and NFS file systems for AIX aix_inittab \u2013 Manages the inittab on AIX aix_lvg \u2013 Manage LVM volume groups on AIX aix_lvol \u2013 Configure AIX LVM logical volumes alternatives \u2013 Manages alternative programs for common commands at \u2013 Schedule the execution of a command or script file via the at command authorized_key \u2013 Adds or removes an SSH authorized key awall \u2013 Manage awall policies beadm \u2013 Manage ZFS boot environments on FreeBSD/Solaris/illumos systems capabilities \u2013 Manage Linux capabilities cron \u2013 Manage cron.d and crontab entries cronvar \u2013 Manage variables in crontabs crypttab \u2013 Encrypted Linux block devices dconf \u2013 Modify and read dconf database debconf \u2013 Configure a .deb package facter \u2013 Runs the discovery program facter on the remote system filesystem \u2013 Makes a filesystem firewalld \u2013 Manage arbitrary ports/services with firewalld gather_facts \u2013 Gathers facts about remote hosts gconftool2 \u2013 Edit GNOME Configurations getent \u2013 A wrapper to the unix getent utility group \u2013 Add or remove groups hostname \u2013 Manage hostname interfaces_file \u2013 Tweak settings in /etc/network/interfaces files iptables \u2013 Modify iptables rules java_cert \u2013 Uses keytool to import/remove key from java keystore (cacerts) java_keystore \u2013 Create or delete a Java keystore in JKS format kernel_blacklist \u2013 Blacklist kernel modules known_hosts \u2013 Add or remove a host from the known_hosts file listen_ports_facts \u2013 Gather facts on processes listening on TCP and UDP ports locale_gen \u2013 Creates or removes locales lvg \u2013 Configure LVM volume groups lvol \u2013 Configure LVM logical volumes make \u2013 Run targets in a Makefile mksysb \u2013 Generates AIX mksysb rootvg backups modprobe \u2013 Load or unload kernel modules mount \u2013 Control active and configured mount points nosh \u2013 Manage services with nosh ohai \u2013 Returns inventory data from Ohai open_iscsi \u2013 Manage iSCSI targets with Open-iSCSI openwrt_init \u2013 Manage services on OpenWrt osx_defaults \u2013 Manage macOS user defaults pam_limits \u2013 Modify Linux PAM limits pamd \u2013 Manage PAM Modules parted \u2013 Configure block device partitions pids \u2013 Retrieves process IDs list if the process is running otherwise return empty list ping \u2013 Try to connect to host, verify a usable python and return pong on success puppet \u2013 Runs puppet python_requirements_info \u2013 Show python path and assert dependency versions reboot \u2013 Reboot a machine runit \u2013 Manage runit services seboolean \u2013 Toggles SELinux booleans sefcontext \u2013 Manages SELinux file context mapping definitions selinux \u2013 Change policy and state of SELinux selinux_permissive \u2013 Change permissive domain in SELinux policy selogin \u2013 Manages linux user to SELinux user mapping seport \u2013 Manages SELinux network port type definitions service \u2013 Manage services service_facts \u2013 Return service state information as fact data setup \u2013 Gathers facts about remote hosts solaris_zone \u2013 Manage Solaris zones svc \u2013 Manage daemontools services sysctl \u2013 Manage entries in sysctl.conf syspatch \u2013 Manage OpenBSD system patches systemd \u2013 Manage services sysvinit \u2013 Manage SysV services timezone \u2013 Configure timezone setting ufw \u2013 Manage firewall with UFW user \u2013 Manage user accounts vdo \u2013 Module to control VDO xfconf \u2013 Edit XFCE4 Configurations xfs_quota \u2013 Manage quotas on XFS filesystems Utilities modules \u00b6 Helper \u00b6 meta \u2013 Execute Ansible \u2018actions\u2019 Logic \u00b6 assert \u2013 Asserts given expressions are true async_status \u2013 Obtain status of asynchronous task debug \u2013 Print statements during execution fail \u2013 Fail with custom message import_playbook \u2013 Import a playbook import_role \u2013 Import a role into a play import_tasks \u2013 Import a task list include \u2013 Include a play or task list include_role \u2013 Load and execute a role include_tasks \u2013 Dynamically include a task list include_vars \u2013 Load variables from files, dynamically within a task pause \u2013 Pause playbook execution set_fact \u2013 Set host facts from a task set_stats \u2013 Set stats for the current ansible run wait_for \u2013 Waits for a condition before continuing wait_for_connection \u2013 Waits until remote system is reachable/usable Web Infrastructure modules \u00b6 apache2_mod_proxy \u2013 Set and/or get members\u2019 attributes of an Apache httpd 2.4 mod_proxy balancer pool apache2_module \u2013 Enables/disables a module of the Apache2 webserver deploy_helper \u2013 Manages some of the steps common in deploying projects django_manage \u2013 Manages a Django application ejabberd_user \u2013 Manages users for ejabberd servers gunicorn \u2013 Run gunicorn with various settings htpasswd \u2013 manage user files for basic authentication jboss \u2013 Deploy applications to JBoss jenkins_job \u2013 Manage jenkins jobs jenkins_job_info \u2013 Get information about Jenkins jobs jenkins_plugin \u2013 Add or remove Jenkins plugin jenkins_script \u2013 Executes a groovy script in the jenkins instance jira \u2013 create and modify issues in a JIRA instance nginx_status_facts \u2013 Retrieve nginx status facts (D) nginx_status_info \u2013 Retrieve information on nginx status rundeck_acl_policy \u2013 Manage Rundeck ACL policies rundeck_project \u2013 Manage Rundeck projects supervisorctl \u2013 Manage the state of a program or group of programs running via supervisord taiga_issue \u2013 Creates/deletes an issue in a Taiga Project Management Platform Ansible_Tower \u00b6 tower_credential \u2013 create, update, or destroy Ansible Tower credential tower_credential_type \u2013 Create, update, or destroy custom Ansible Tower credential type tower_group \u2013 create, update, or destroy Ansible Tower group tower_host \u2013 create, update, or destroy Ansible Tower host tower_inventory \u2013 create, update, or destroy Ansible Tower inventory tower_inventory_source \u2013 create, update, or destroy Ansible Tower inventory source tower_job_cancel \u2013 Cancel an Ansible Tower Job tower_job_launch \u2013 Launch an Ansible Job tower_job_list \u2013 List Ansible Tower jobs tower_job_template \u2013 create, update, or destroy Ansible Tower job template tower_job_wait \u2013 Wait for Ansible Tower job to finish tower_label \u2013 create, update, or destroy Ansible Tower label tower_notification \u2013 create, update, or destroy Ansible Tower notification tower_organization \u2013 create, update, or destroy Ansible Tower organizations tower_project \u2013 create, update, or destroy Ansible Tower projects tower_receive \u2013 Receive assets from Ansible Tower tower_role \u2013 create, update, or destroy Ansible Tower role tower_send \u2013 Send assets to Ansible Tower tower_settings \u2013 Modify Ansible Tower settings tower_team \u2013 create, update, or destroy Ansible Tower team tower_user \u2013 create, update, or destroy Ansible Tower user tower_workflow_launch \u2013 Run a workflow in Ansible Tower tower_workflow_template \u2013 create, update, or destroy Ansible Tower workflow template Sophos_Utm \u00b6 utm_aaa_group \u2013 Create, update or destroy an aaa group object in Sophos UTM utm_aaa_group_info \u2013 get info for reverse_proxy frontend entry in Sophos UTM utm_ca_host_key_cert \u2013 create, update or destroy ca host_key_cert entry in Sophos UTM utm_ca_host_key_cert_info \u2013 Get info for a ca host_key_cert entry in Sophos UTM utm_dns_host \u2013 create, update or destroy dns entry in Sophos UTM utm_network_interface_address \u2013 Create, update or destroy network/interface_address object utm_network_interface_address_info \u2013 Get info for a network/interface_address object utm_proxy_auth_profile \u2013 create, update or destroy reverse_proxy auth_profile entry in Sophos UTM utm_proxy_exception \u2013 Create, update or destroy reverse_proxy exception entry in Sophos UTM utm_proxy_frontend \u2013 create, update or destroy reverse_proxy frontend entry in Sophos UTM utm_proxy_frontend_info \u2013 create, update or destroy reverse_proxy frontend entry in Sophos UTM utm_proxy_location \u2013 create, update or destroy reverse_proxy location entry in Sophos UTM utm_proxy_location_info \u2013 create, update or destroy reverse_proxy location entry in Sophos UTM Windows modules \u00b6 win_acl \u2013 Set file/directory/registry permissions for a system user or group win_acl_inheritance \u2013 Change ACL inheritance win_audit_policy_system \u2013 Used to make changes to the system wide Audit Policy win_audit_rule \u2013 Adds an audit rule to files, folders, or registry keys win_certificate_store \u2013 Manages the certificate store win_chocolatey \u2013 Manage packages using chocolatey win_chocolatey_config \u2013 Manages Chocolatey config settings win_chocolatey_facts \u2013 Create a facts collection for Chocolatey win_chocolatey_feature \u2013 Manages Chocolatey features win_chocolatey_source \u2013 Manages Chocolatey sources win_command \u2013 Executes a command on a remote Windows node win_copy \u2013 Copies files to remote locations on windows hosts win_credential \u2013 Manages Windows Credentials in the Credential Manager win_defrag \u2013 Consolidate fragmented files on local volumes win_disk_facts \u2013 Show the attached disks and disk information of the target host win_disk_image \u2013 Manage ISO/VHD/VHDX mounts on Windows hosts win_dns_client \u2013 Configures DNS lookup on Windows hosts win_dns_record \u2013 Manage Windows Server DNS records win_domain \u2013 Ensures the existence of a Windows domain win_domain_computer \u2013 Manage computers in Active Directory win_domain_controller \u2013 Manage domain controller/member server state for a Windows host win_domain_group \u2013 Creates, modifies or removes domain groups win_domain_group_membership \u2013 Manage Windows domain group membership win_domain_membership \u2013 Manage domain/workgroup membership for a Windows host win_domain_user \u2013 Manages Windows Active Directory user accounts win_dotnet_ngen \u2013 Runs ngen to recompile DLLs after .NET updates win_dsc \u2013 Invokes a PowerShell DSC configuration win_environment \u2013 Modify environment variables on windows hosts win_eventlog \u2013 Manage Windows event logs win_eventlog_entry \u2013 Write entries to Windows event logs win_feature \u2013 Installs and uninstalls Windows Features on Windows Server win_file \u2013 Creates, touches or removes files or directories win_file_version \u2013 Get DLL or EXE file build version win_find \u2013 Return a list of files based on specific criteria win_firewall \u2013 Enable or disable the Windows Firewall win_firewall_rule \u2013 Windows firewall automation win_format \u2013 Formats an existing volume or a new volume on an existing partition on Windows win_get_url \u2013 Downloads file from HTTP, HTTPS, or FTP to node win_group \u2013 Add and remove local groups win_group_membership \u2013 Manage Windows local group membership win_hostname \u2013 Manages local Windows computer name win_hosts \u2013 Manages hosts file entries on Windows win_hotfix \u2013 Install and uninstalls Windows hotfixes win_http_proxy \u2013 Manages proxy settings for WinHTTP win_iis_virtualdirectory \u2013 Configures a virtual directory in IIS win_iis_webapplication \u2013 Configures IIS web applications win_iis_webapppool \u2013 Configure IIS Web Application Pools win_iis_webbinding \u2013 Configures a IIS Web site binding win_iis_website \u2013 Configures a IIS Web site win_inet_proxy \u2013 Manages proxy settings for WinINet and Internet Explorer win_lineinfile \u2013 Ensure a particular line is in a file, or replace an existing line using a back-referenced regular expression win_mapped_drive \u2013 Map network drives for users win_msg \u2013 Sends a message to logged in users on Windows hosts win_netbios \u2013 Manage NetBIOS over TCP/IP settings on Windows win_nssm \u2013 Install a service using NSSM win_optional_feature \u2013 Manage optional Windows features win_owner \u2013 Set owner win_package \u2013 Installs/uninstalls an installable package win_pagefile \u2013 Query or change pagefile configuration win_partition \u2013 Creates, changes and removes partitions on Windows Server win_path \u2013 Manage Windows path environment variables win_pester \u2013 Run Pester tests on Windows hosts win_ping \u2013 A windows version of the classic ping module win_power_plan \u2013 Changes the power plan of a Windows system win_product_facts \u2013 Provides Windows product and license information win_psexec \u2013 Runs commands (remotely) as another (privileged) user win_psmodule \u2013 Adds or removes a Windows PowerShell module win_psrepository \u2013 Adds, removes or updates a Windows PowerShell repository win_rabbitmq_plugin \u2013 Manage RabbitMQ plugins win_rds_cap \u2013 Manage Connection Authorization Policies (CAP) on a Remote Desktop Gateway server win_rds_rap \u2013 Manage Resource Authorization Policies (RAP) on a Remote Desktop Gateway server win_rds_settings \u2013 Manage main settings of a Remote Desktop Gateway server win_reboot \u2013 Reboot a windows machine win_reg_stat \u2013 Get information about Windows registry keys win_regedit \u2013 Add, change, or remove registry keys and values win_region \u2013 Set the region and format settings win_regmerge \u2013 Merges the contents of a registry file into the Windows registry win_robocopy \u2013 Synchronizes the contents of two directories using Robocopy win_route \u2013 Add or remove a static route win_say \u2013 Text to speech module for Windows to speak messages and optionally play sounds win_scheduled_task \u2013 Manage scheduled tasks win_scheduled_task_stat \u2013 Get information about Windows Scheduled Tasks win_security_policy \u2013 Change local security policy settings win_service \u2013 Manage and query Windows services win_share \u2013 Manage Windows shares win_shell \u2013 Execute shell commands on target hosts win_shortcut \u2013 Manage shortcuts on Windows win_snmp \u2013 Configures the Windows SNMP service win_stat \u2013 Get information about Windows files win_tempfile \u2013 Creates temporary files and directories win_template \u2013 Template a file out to a remote server win_timezone \u2013 Sets Windows machine timezone win_toast \u2013 Sends Toast windows notification to logged in users on Windows 10 or later hosts win_unzip \u2013 Unzips compressed files and archives on the Windows node win_updates \u2013 Download and install Windows updates win_uri \u2013 Interacts with webservices win_user \u2013 Manages local Windows user accounts win_user_profile \u2013 Manages the Windows user profiles win_user_right \u2013 Manage Windows User Rights win_wait_for \u2013 Waits for a condition before continuing win_wait_for_process \u2013 Waits for a process to exist or not exist before continuing win_wakeonlan \u2013 Send a magic Wake-on-LAN (WoL) broadcast packet win_webpicmd \u2013 Installs packages using Web Platform Installer command-line win_whoami \u2013 Get information about the current user and process win_xml \u2013 Manages XML file content on Windows hosts","title":"4. \u6a21\u5757\u7d22\u5f15"},{"location":"basic/Reference/Module/#ansible-modules","text":"Note (D): \u6709\u8fd9\u4e2a\u6807\u8bc6\u7684\uff0c\u5c31\u8868\u793a\u88ab\u5f03\u7528\u7684\u3002 \u66f4\u65b0\u4e8e 2020-04\uff0c\u6700\u65b0\u5217\u8868\u89c1 \u5b98\u7f51","title":"Ansible Modules"},{"location":"basic/Reference/Module/#cloud-modules","text":"","title":"Cloud modules"},{"location":"basic/Reference/Module/#alicloud","text":"ali_instance \u2013 Create, Start, Stop, Restart or Terminate an Instance in ECS. Add or Remove Instance to/from a Security Group ali_instance_info \u2013 Gather information on instances of Alibaba Cloud ECS","title":"Alicloud"},{"location":"basic/Reference/Module/#amazon","text":"aws_acm_info \u2013 Retrieve certificate information from AWS Certificate Manager service aws_api_gateway \u2013 Manage AWS API Gateway APIs aws_application_scaling_policy \u2013 Manage Application Auto Scaling Scaling Policies aws_az_info \u2013 Gather information about availability zones in AWS aws_batch_compute_environment \u2013 Manage AWS Batch Compute Environments aws_batch_job_definition \u2013 Manage AWS Batch Job Definitions aws_batch_job_queue \u2013 Manage AWS Batch Job Queues aws_caller_info \u2013 Get information about the user and account being used to make AWS calls aws_codebuild \u2013 Create or delete an AWS CodeBuild project aws_codecommit \u2013 Manage repositories in AWS CodeCommit aws_codepipeline \u2013 Create or delete AWS CodePipelines aws_config_aggregation_authorization \u2013 Manage cross-account AWS Config authorizations aws_config_aggregator \u2013 Manage AWS Config aggregations across multiple accounts aws_config_delivery_channel \u2013 Manage AWS Config delivery channels aws_config_recorder \u2013 Manage AWS Config Recorders aws_config_rule \u2013 Manage AWS Config resources aws_direct_connect_connection \u2013 Creates, deletes, modifies a DirectConnect connection aws_direct_connect_gateway \u2013 Manage AWS Direct Connect Gateway aws_direct_connect_link_aggregation_group \u2013 Manage Direct Connect LAG bundles aws_direct_connect_virtual_interface \u2013 Manage Direct Connect virtual interfaces aws_eks_cluster \u2013 Manage Elastic Kubernetes Service Clusters aws_elasticbeanstalk_app \u2013 create, update, and delete an elastic beanstalk application aws_glue_connection \u2013 Manage an AWS Glue connection aws_glue_job \u2013 Manage an AWS Glue job aws_inspector_target \u2013 Create, Update and Delete Amazon Inspector Assessment Targets aws_kms \u2013 Perform various KMS management tasks aws_kms_info \u2013 Gather information about AWS KMS keys aws_netapp_cvs_active_directory \u2013 NetApp AWS CloudVolumes Service Manage Active Directory aws_netapp_cvs_FileSystems \u2013 NetApp AWS Cloud Volumes Service Manage FileSystem aws_netapp_cvs_pool \u2013 NetApp AWS Cloud Volumes Service Manage Pools aws_netapp_cvs_snapshots \u2013 NetApp AWS Cloud Volumes Service Manage Snapshots aws_region_info \u2013 Gather information about AWS regions aws_s3 \u2013 manage objects in S3 aws_s3_bucket_info \u2013 Lists S3 buckets in AWS aws_s3_cors \u2013 Manage CORS for S3 buckets in AWS aws_secret \u2013 Manage secrets stored in AWS Secrets Manager aws_ses_identity \u2013 Manages SES email and domain identity aws_ses_identity_policy \u2013 Manages SES sending authorization policies aws_ses_rule_set \u2013 Manages SES inbound receipt rule sets aws_sgw_info \u2013 Fetch AWS Storage Gateway information aws_ssm_parameter_store \u2013 Manage key-value pairs in aws parameter store aws_waf_condition \u2013 create and delete WAF Conditions aws_waf_info \u2013 Retrieve information for WAF ACLs, Rule , Conditions and Filters aws_waf_rule \u2013 create and delete WAF Rules aws_waf_web_acl \u2013 create and delete WAF Web ACLs cloudformation \u2013 Create or delete an AWS CloudFormation stack cloudformation_info \u2013 Obtain information about an AWS CloudFormation stack cloudformation_stack_set \u2013 Manage groups of CloudFormation stacks cloudfront_distribution \u2013 create, update and delete aws cloudfront distributions cloudfront_info \u2013 Obtain facts about an AWS CloudFront distribution cloudfront_invalidation \u2013 create invalidations for aws cloudfront distributions cloudfront_origin_access_identity \u2013 create, update and delete origin access identities for a cloudfront distribution cloudtrail \u2013 manage CloudTrail create, delete, update cloudwatchevent_rule \u2013 Manage CloudWatch Event rules and targets cloudwatchlogs_log_group \u2013 create or delete log_group in CloudWatchLogs cloudwatchlogs_log_group_info \u2013 get information about log_group in CloudWatchLogs data_pipeline \u2013 Create and manage AWS Datapipelines dms_endpoint \u2013 creates or destroys a data migration services endpoint dms_replication_subnet_group \u2013 creates or destroys a data migration services subnet group dynamodb_table \u2013 Create, update or delete AWS Dynamo DB tables dynamodb_ttl \u2013 set TTL for a given DynamoDB table ec2 \u2013 create, terminate, start or stop an instance in ec2 ec2_ami \u2013 create or destroy an image in ec2 ec2_ami_copy \u2013 copies AMI between AWS regions, return new image id ec2_ami_info \u2013 Gather information about ec2 AMIs ec2_asg \u2013 Create or delete AWS Autoscaling Groups ec2_asg_info \u2013 Gather information about ec2 Auto Scaling Groups (ASGs) in AWS ec2_asg_lifecycle_hook \u2013 Create, delete or update AWS ASG Lifecycle Hooks ec2_customer_gateway \u2013 Manage an AWS customer gateway ec2_customer_gateway_info \u2013 Gather information about customer gateways in AWS ec2_eip \u2013 manages EC2 elastic IP (EIP) addresses ec2_eip_info \u2013 List EC2 EIP details ec2_elb \u2013 De-registers or registers instances from EC2 ELBs ec2_elb_info \u2013 Gather information about EC2 Elastic Load Balancers in AWS ec2_elb_lb \u2013 Creates, updates or destroys an Amazon ELB ec2_eni \u2013 Create and optionally attach an Elastic Network Interface (ENI) to an instance ec2_eni_info \u2013 Gather information about ec2 ENI interfaces in AWS ec2_group \u2013 maintain an ec2 VPC security group ec2_group_info \u2013 Gather information about ec2 security groups in AWS ec2_instance \u2013 Create & manage EC2 instances ec2_instance_info \u2013 Gather information about ec2 instances in AWS ec2_key \u2013 create or delete an ec2 key pair ec2_launch_template \u2013 Manage EC2 launch templates ec2_lc \u2013 Create or delete AWS Autoscaling Launch Configurations ec2_lc_find \u2013 Find AWS Autoscaling Launch Configurations ec2_lc_info \u2013 Gather information about AWS Autoscaling Launch Configurations ec2_metadata_facts \u2013 Gathers facts (instance metadata) about remote hosts within ec2 ec2_metric_alarm \u2013 Create/update or delete AWS Cloudwatch \u2018metric alarms\u2019 ec2_placement_group \u2013 Create or delete an EC2 Placement Group ec2_placement_group_info \u2013 List EC2 Placement Group(s) details ec2_scaling_policy \u2013 Create or delete AWS scaling policies for Autoscaling groups ec2_snapshot \u2013 creates a snapshot from an existing volume ec2_snapshot_copy \u2013 copies an EC2 snapshot and returns the new Snapshot ID ec2_snapshot_info \u2013 Gather information about ec2 volume snapshots in AWS ec2_tag \u2013 create and remove tags on ec2 resources ec2_transit_gateway \u2013 Create and delete AWS Transit Gateways ec2_transit_gateway_info \u2013 Gather information about ec2 transit gateways in AWS ec2_vol \u2013 create and attach a volume, return volume id and device map ec2_vol_info \u2013 Gather information about ec2 volumes in AWS ec2_vpc_dhcp_option \u2013 Manages DHCP Options, and can ensure the DHCP options for the given VPC match what\u2019s requested ec2_vpc_dhcp_option_info \u2013 Gather information about dhcp options sets in AWS ec2_vpc_egress_igw \u2013 Manage an AWS VPC Egress Only Internet gateway ec2_vpc_endpoint \u2013 Create and delete AWS VPC Endpoints ec2_vpc_endpoint_info \u2013 Retrieves AWS VPC endpoints details using AWS methods ec2_vpc_igw \u2013 Manage an AWS VPC Internet gateway ec2_vpc_igw_info \u2013 Gather information about internet gateways in AWS ec2_vpc_nacl \u2013 create and delete Network ACLs ec2_vpc_nacl_info \u2013 Gather information about Network ACLs in an AWS VPC ec2_vpc_nat_gateway \u2013 Manage AWS VPC NAT Gateways ec2_vpc_nat_gateway_info \u2013 Retrieves AWS VPC Managed Nat Gateway details using AWS methods ec2_vpc_net \u2013 Configure AWS virtual private clouds ec2_vpc_net_info \u2013 Gather information about ec2 VPCs in AWS ec2_vpc_peer \u2013 create, delete, accept, and reject VPC peering connections between two VPCs ec2_vpc_peering_info \u2013 Retrieves AWS VPC Peering details using AWS methods ec2_vpc_route_table \u2013 Manage route tables for AWS virtual private clouds ec2_vpc_route_table_info \u2013 Gather information about ec2 VPC route tables in AWS ec2_vpc_subnet \u2013 Manage subnets in AWS virtual private clouds ec2_vpc_subnet_info \u2013 Gather information about ec2 VPC subnets in AWS ec2_vpc_vgw \u2013 Create and delete AWS VPN Virtual Gateways ec2_vpc_vgw_info \u2013 Gather information about virtual gateways in AWS ec2_vpc_vpn \u2013 Create, modify, and delete EC2 VPN connections ec2_vpc_vpn_info \u2013 Gather information about VPN Connections in AWS ec2_win_password \u2013 gets the default administrator password for ec2 windows instances ecs_attribute \u2013 manage ecs attributes ecs_cluster \u2013 create or terminate ecs clusters ecs_ecr \u2013 Manage Elastic Container Registry repositories ecs_service \u2013 create, terminate, start or stop a service in ecs ecs_service_info \u2013 list or describe services in ecs ecs_task \u2013 run, start or stop a task in ecs ecs_taskdefinition \u2013 register a task definition in ecs ecs_taskdefinition_info \u2013 describe a task definition in ecs efs \u2013 create and maintain EFS file systems efs_info \u2013 Get information about Amazon EFS file systems elasticache \u2013 Manage cache clusters in Amazon Elasticache elasticache_info \u2013 Retrieve information for AWS Elasticache clusters elasticache_parameter_group \u2013 Manage cache security groups in Amazon Elasticache elasticache_snapshot \u2013 Manage cache snapshots in Amazon Elasticache elasticache_subnet_group \u2013 manage Elasticache subnet groups elb_application_lb \u2013 Manage an Application load balancer elb_application_lb_info \u2013 Gather information about application ELBs in AWS elb_classic_lb \u2013 Creates or destroys Amazon ELB elb_classic_lb_info \u2013 Gather information about EC2 Elastic Load Balancers in AWS elb_instance \u2013 De-registers or registers instances from EC2 ELBs elb_network_lb \u2013 Manage a Network Load Balancer elb_target \u2013 Manage a target in a target group elb_target_group \u2013 Manage a target group for an Application or Network load balancer elb_target_group_info \u2013 Gather information about ELB target groups in AWS elb_target_info \u2013 Gathers which target groups a target is associated with execute_lambda \u2013 Execute an AWS Lambda function iam \u2013 Manage IAM users, groups, roles and keys iam_cert \u2013 Manage server certificates for use on ELBs and CloudFront iam_group \u2013 Manage AWS IAM groups iam_managed_policy \u2013 Manage User Managed IAM policies iam_mfa_device_info \u2013 List the MFA (Multi-Factor Authentication) devices registered for a user iam_password_policy \u2013 Update an IAM Password Policy iam_policy \u2013 Manage IAM policies for users, groups, and roles iam_role \u2013 Manage AWS IAM roles iam_role_info \u2013 Gather information on IAM roles iam_server_certificate_info \u2013 Retrieve the information of a server certificate iam_user \u2013 Manage AWS IAM users kinesis_stream \u2013 Manage a Kinesis Stream lambda \u2013 Manage AWS Lambda functions lambda_alias \u2013 Creates, updates or deletes AWS Lambda function aliases lambda_event \u2013 Creates, updates or deletes AWS Lambda function event mappings lambda_facts \u2013 Gathers AWS Lambda function details as Ansible facts (D) lambda_info \u2013 Gathers AWS Lambda function details lambda_policy \u2013 Creates, updates or deletes AWS Lambda policy statements lightsail \u2013 Create or delete a virtual machine instance in AWS Lightsail rds \u2013 create, delete, or modify Amazon rds instances, rds snapshots, and related facts rds_instance \u2013 Manage RDS instances rds_instance_info \u2013 obtain information about one or more RDS instances rds_param_group \u2013 manage RDS parameter groups rds_snapshot \u2013 manage Amazon RDS snapshots rds_snapshot_info \u2013 obtain information about one or more RDS snapshots rds_subnet_group \u2013 manage RDS database subnet groups redshift \u2013 create, delete, or modify an Amazon Redshift instance redshift_cross_region_snapshots \u2013 Manage Redshift Cross Region Snapshots redshift_info \u2013 Gather information about Redshift cluster(s) redshift_subnet_group \u2013 manage Redshift cluster subnet groups route53 \u2013 add or delete entries in Amazons Route53 DNS service route53_health_check \u2013 add or delete health-checks in Amazons Route53 DNS service route53_info \u2013 Retrieves route53 details using AWS methods route53_zone \u2013 add or delete Route53 zones s3_bucket \u2013 Manage S3 buckets in AWS, DigitalOcean, Ceph, Walrus and FakeS3 s3_bucket_notification \u2013 Creates, updates or deletes S3 Bucket notification for lambda s3_lifecycle \u2013 Manage s3 bucket lifecycle rules in AWS s3_logging \u2013 Manage logging facility of an s3 bucket in AWS s3_sync \u2013 Efficiently upload multiple files to S3 s3_website \u2013 Configure an s3 bucket as a website sns \u2013 Send Amazon Simple Notification Service messages sns_topic \u2013 Manages AWS SNS topics and subscriptions sqs_queue \u2013 Creates or deletes AWS SQS queues sts_assume_role \u2013 Assume a role using AWS Security Token Service and obtain temporary credentials sts_session_token \u2013 Obtain a session token from the AWS Security Token Service","title":"Amazon"},{"location":"basic/Reference/Module/#atomic","text":"atomic_container \u2013 Manage the containers on the atomic host platform atomic_host \u2013 Manage the atomic host platform atomic_image \u2013 Manage the container images on the atomic host platform","title":"Atomic"},{"location":"basic/Reference/Module/#azure","text":"azure_rm_acs \u2013 Manage an Azure Container Service(ACS) instance azure_rm_aks \u2013 Manage a managed Azure Container Service (AKS) instance azure_rm_aks_info \u2013 Get Azure Kubernetes Service facts azure_rm_aksversion_info \u2013 Get available kubernetes versions supported by Azure Kubernetes Service azure_rm_appgateway \u2013 Manage Application Gateway instance azure_rm_applicationsecuritygroup \u2013 Manage Azure Application Security Group azure_rm_applicationsecuritygroup_info \u2013 Get Azure Application Security Group facts azure_rm_appserviceplan \u2013 Manage App Service Plan azure_rm_appserviceplan_info \u2013 Get azure app service plan facts azure_rm_automationaccount \u2013 Manage Azure Automation account azure_rm_automationaccount_info \u2013 Get Azure automation account facts azure_rm_autoscale \u2013 Manage Azure autoscale setting azure_rm_autoscale_info \u2013 Get Azure Auto Scale Setting facts azure_rm_availabilityset \u2013 Manage Azure Availability Set azure_rm_availabilityset_info \u2013 Get Azure Availability Set facts azure_rm_azurefirewall \u2013 Manage Azure Firewall instance azure_rm_azurefirewall_info \u2013 Get AzureFirewall info azure_rm_batchaccount \u2013 Manages a Batch Account on Azure azure_rm_cdnendpoint \u2013 Manage a Azure CDN endpoint azure_rm_cdnendpoint_info \u2013 Get Azure CDN endpoint facts azure_rm_cdnprofile \u2013 Manage a Azure CDN profile azure_rm_cdnprofile_info \u2013 Get Azure CDN profile facts azure_rm_containerinstance \u2013 Manage an Azure Container Instance azure_rm_containerinstance_info \u2013 Get Azure Container Instance facts azure_rm_containerregistry \u2013 Manage an Azure Container Registry azure_rm_containerregistry_info \u2013 Get Azure Container Registry facts azure_rm_cosmosdbaccount \u2013 Manage Azure Database Account instance azure_rm_cosmosdbaccount_info \u2013 Get Azure Cosmos DB Account facts azure_rm_deployment \u2013 Create or destroy Azure Resource Manager template deployments azure_rm_deployment_info \u2013 Get Azure Deployment facts azure_rm_devtestlab \u2013 Manage Azure DevTest Lab instance azure_rm_devtestlab_info \u2013 Get Azure DevTest Lab facts azure_rm_devtestlabarmtemplate_info \u2013 Get Azure DevTest Lab ARM Template facts azure_rm_devtestlabartifact_info \u2013 Get Azure DevTest Lab Artifact facts azure_rm_devtestlabartifactsource \u2013 Manage Azure DevTest Labs Artifacts Source instance azure_rm_devtestlabartifactsource_info \u2013 Get Azure DevTest Lab Artifact Source facts azure_rm_devtestlabcustomimage \u2013 Manage Azure DevTest Lab Custom Image instance azure_rm_devtestlabcustomimage_info \u2013 Get Azure DevTest Lab Custom Image facts azure_rm_devtestlabenvironment \u2013 Manage Azure DevTest Lab Environment instance azure_rm_devtestlabenvironment_info \u2013 Get Azure Environment facts azure_rm_devtestlabpolicy \u2013 Manage Azure Policy instance azure_rm_devtestlabpolicy_info \u2013 Get Azure DTL Policy facts azure_rm_devtestlabschedule \u2013 Manage Azure DevTest Lab Schedule instance azure_rm_devtestlabschedule_info \u2013 Get Azure Schedule facts azure_rm_devtestlabvirtualmachine \u2013 Manage Azure DevTest Lab Virtual Machine instance azure_rm_devtestlabvirtualmachine_info \u2013 Get Azure DevTest Lab Virtual Machine facts azure_rm_devtestlabvirtualnetwork \u2013 Manage Azure DevTest Lab Virtual Network instance azure_rm_devtestlabvirtualnetwork_info \u2013 Get Azure DevTest Lab Virtual Network facts azure_rm_dnsrecordset \u2013 Create, delete and update DNS record sets and records azure_rm_dnsrecordset_info \u2013 Get DNS Record Set facts azure_rm_dnszone \u2013 Manage Azure DNS zones azure_rm_dnszone_info \u2013 Get DNS zone facts azure_rm_functionapp \u2013 Manage Azure Function Apps azure_rm_functionapp_info \u2013 Get Azure Function App facts azure_rm_gallery \u2013 Manage Azure Shared Image Gallery instance azure_rm_gallery_info \u2013 Get Azure Shared Image Gallery info azure_rm_galleryimage \u2013 Manage Azure SIG Image instance azure_rm_galleryimage_info \u2013 Get Azure SIG Image info azure_rm_galleryimageversion \u2013 Manage Azure SIG Image Version instance azure_rm_galleryimageversion_info \u2013 Get Azure SIG Image Version info azure_rm_hdinsightcluster \u2013 Manage Azure HDInsight Cluster instance azure_rm_hdinsightcluster_info \u2013 Get Azure HDInsight Cluster facts azure_rm_image \u2013 Manage Azure image azure_rm_image_info \u2013 Get facts about azure custom images azure_rm_iotdevice \u2013 Manage Azure IoT hub device azure_rm_iotdevice_info \u2013 Facts of Azure IoT hub device azure_rm_iotdevicemodule \u2013 Manage Azure IoT hub device module azure_rm_iothub \u2013 Manage Azure IoT hub azure_rm_iothub_info \u2013 Get IoT Hub facts azure_rm_iothubconsumergroup \u2013 Manage Azure IoT hub azure_rm_keyvault \u2013 Manage Key Vault instance azure_rm_keyvault_info \u2013 Get Azure Key Vault facts azure_rm_keyvaultkey \u2013 Use Azure KeyVault keys azure_rm_keyvaultkey_info \u2013 Get Azure Key Vault key facts azure_rm_keyvaultsecret \u2013 Use Azure KeyVault Secrets azure_rm_loadbalancer \u2013 Manage Azure load balancers azure_rm_loadbalancer_info \u2013 Get load balancer facts azure_rm_lock \u2013 Manage Azure locks azure_rm_lock_info \u2013 Manage Azure locks azure_rm_loganalyticsworkspace \u2013 Manage Azure Log Analytics workspaces azure_rm_loganalyticsworkspace_info \u2013 Get facts of Azure Log Analytics workspaces azure_rm_manageddisk \u2013 Manage Azure Manage Disks azure_rm_manageddisk_info \u2013 Get managed disk facts azure_rm_mariadbconfiguration \u2013 Manage Configuration instance azure_rm_mariadbconfiguration_info \u2013 Get Azure MariaDB Configuration facts azure_rm_mariadbdatabase \u2013 Manage MariaDB Database instance azure_rm_mariadbdatabase_info \u2013 Get Azure MariaDB Database facts azure_rm_mariadbfirewallrule \u2013 Manage MariaDB firewall rule instance azure_rm_mariadbfirewallrule_info \u2013 Get Azure MariaDB Firewall Rule facts azure_rm_mariadbserver \u2013 Manage MariaDB Server instance azure_rm_mariadbserver_info \u2013 Get Azure MariaDB Server facts azure_rm_monitorlogprofile \u2013 Manage Azure Monitor log profile azure_rm_mysqlconfiguration \u2013 Manage Configuration instance azure_rm_mysqlconfiguration_info \u2013 Get Azure MySQL Configuration facts azure_rm_mysqldatabase \u2013 Manage MySQL Database instance azure_rm_mysqldatabase_info \u2013 Get Azure MySQL Database facts azure_rm_mysqlfirewallrule \u2013 Manage MySQL firewall rule instance azure_rm_mysqlfirewallrule_info \u2013 Get Azure MySQL Firewall Rule facts azure_rm_mysqlserver \u2013 Manage MySQL Server instance azure_rm_mysqlserver_info \u2013 Get Azure MySQL Server facts azure_rm_networkinterface \u2013 Manage Azure network interfaces azure_rm_networkinterface_info \u2013 Get network interface facts azure_rm_postgresqlconfiguration \u2013 Manage Azure PostgreSQL Configuration azure_rm_postgresqlconfiguration_info \u2013 Get Azure PostgreSQL Configuration facts azure_rm_postgresqldatabase \u2013 Manage PostgreSQL Database instance azure_rm_postgresqldatabase_info \u2013 Get Azure PostgreSQL Database facts azure_rm_postgresqlfirewallrule \u2013 Manage PostgreSQL firewall rule instance azure_rm_postgresqlfirewallrule_info \u2013 Get Azure PostgreSQL Firewall Rule facts azure_rm_postgresqlserver \u2013 Manage PostgreSQL Server instance azure_rm_postgresqlserver_info \u2013 Get Azure PostgreSQL Server facts azure_rm_publicipaddress \u2013 Manage Azure Public IP Addresses azure_rm_publicipaddress_info \u2013 Get public IP facts azure_rm_rediscache \u2013 Manage Azure Cache for Redis instance azure_rm_rediscache_info \u2013 Get Azure Cache for Redis instance facts azure_rm_rediscachefirewallrule \u2013 Manage Azure Cache for Redis Firewall rules azure_rm_resource \u2013 Create any Azure resource azure_rm_resource_info \u2013 Generic facts of Azure resources azure_rm_resourcegroup \u2013 Manage Azure resource groups azure_rm_resourcegroup_info \u2013 Get resource group facts azure_rm_roleassignment \u2013 Manage Azure Role Assignment azure_rm_roleassignment_info \u2013 Gets Azure Role Assignment facts azure_rm_roledefinition \u2013 Manage Azure Role Definition azure_rm_roledefinition_info \u2013 Get Azure Role Definition facts azure_rm_route \u2013 Manage Azure route resource azure_rm_routetable \u2013 Manage Azure route table resource azure_rm_routetable_info \u2013 Get route table facts azure_rm_securitygroup \u2013 Manage Azure network security groups azure_rm_securitygroup_info \u2013 Get security group facts azure_rm_servicebus \u2013 Manage Azure Service Bus azure_rm_servicebus_info \u2013 Get servicebus facts azure_rm_servicebusqueue \u2013 Manage Azure Service Bus queue azure_rm_servicebussaspolicy \u2013 Manage Azure Service Bus SAS policy azure_rm_servicebustopic \u2013 Manage Azure Service Bus azure_rm_servicebustopicsubscription \u2013 Manage Azure Service Bus subscription azure_rm_snapshot \u2013 Manage Azure Snapshot instance azure_rm_sqldatabase \u2013 Manage SQL Database instance azure_rm_sqldatabase_info \u2013 Get Azure SQL Database facts azure_rm_sqlfirewallrule \u2013 Manage Firewall Rule instance azure_rm_sqlfirewallrule_info \u2013 Get Azure SQL Firewall Rule facts azure_rm_sqlserver \u2013 Manage SQL Server instance azure_rm_sqlserver_info \u2013 Get SQL Server facts azure_rm_storageaccount \u2013 Manage Azure storage accounts azure_rm_storageaccount_info \u2013 Get storage account facts azure_rm_storageblob \u2013 Manage blob containers and blob objects azure_rm_subnet \u2013 Manage Azure subnets azure_rm_subnet_info \u2013 Get Azure Subnet facts azure_rm_trafficmanagerendpoint \u2013 Manage Azure Traffic Manager endpoint azure_rm_trafficmanagerendpoint_info \u2013 Get Azure Traffic Manager endpoint facts azure_rm_trafficmanagerprofile \u2013 Manage Azure Traffic Manager profile azure_rm_trafficmanagerprofile_info \u2013 Get Azure Traffic Manager profile facts azure_rm_virtualmachine \u2013 Manage Azure virtual machines azure_rm_virtualmachine_info \u2013 Get virtual machine facts azure_rm_virtualmachineextension \u2013 Managed Azure Virtual Machine extension azure_rm_virtualmachineextension_info \u2013 Get Azure Virtual Machine Extension facts azure_rm_virtualmachineimage_info \u2013 Get virtual machine image facts azure_rm_virtualmachinescaleset \u2013 Manage Azure virtual machine scale sets azure_rm_virtualmachinescaleset_info \u2013 Get Virtual Machine Scale Set facts azure_rm_virtualmachinescalesetextension \u2013 Manage Azure Virtual Machine Scale Set (VMSS) extensions azure_rm_virtualmachinescalesetextension_info \u2013 Get Azure Virtual Machine Scale Set Extension facts azure_rm_virtualmachinescalesetinstance \u2013 Get Azure Virtual Machine Scale Set Instance facts azure_rm_virtualmachinescalesetinstance_info \u2013 Get Azure Virtual Machine Scale Set Instance facts azure_rm_virtualnetwork \u2013 Manage Azure virtual networks azure_rm_virtualnetwork_info \u2013 Get virtual network facts azure_rm_virtualnetworkgateway \u2013 Manage Azure virtual network gateways azure_rm_virtualnetworkpeering \u2013 Manage Azure Virtual Network Peering azure_rm_virtualnetworkpeering_info \u2013 Get facts of Azure Virtual Network Peering azure_rm_webapp \u2013 Manage Web App instances azure_rm_webapp_info \u2013 Get Azure web app facts azure_rm_webappslot \u2013 Manage Azure Web App slot","title":"Azure"},{"location":"basic/Reference/Module/#centurylink","text":"clc_aa_policy \u2013 Create or Delete Anti Affinity Policies at CenturyLink Cloud clc_alert_policy \u2013 Create or Delete Alert Policies at CenturyLink Cloud clc_blueprint_package \u2013 deploys a blue print package on a set of servers in CenturyLink Cloud clc_firewall_policy \u2013 Create/delete/update firewall policies clc_group \u2013 Create/delete Server Groups at Centurylink Cloud clc_loadbalancer \u2013 Create, Delete shared loadbalancers in CenturyLink Cloud clc_modify_server \u2013 modify servers in CenturyLink Cloud clc_publicip \u2013 Add and Delete public ips on servers in CenturyLink Cloud clc_server \u2013 Create, Delete, Start and Stop servers in CenturyLink Cloud clc_server_snapshot \u2013 Create, Delete and Restore server snapshots in CenturyLink Cloud","title":"Centurylink"},{"location":"basic/Reference/Module/#cloudscale","text":"cloudscale_floating_ip \u2013 Manages floating IPs on the cloudscale.ch IaaS service cloudscale_server \u2013 Manages servers on the cloudscale.ch IaaS service cloudscale_server_group \u2013 Manages server groups on the cloudscale.ch IaaS service cloudscale_volume \u2013 Manages volumes on the cloudscale.ch IaaS service","title":"Cloudscale"},{"location":"basic/Reference/Module/#cloudstack","text":"cs_account \u2013 Manages accounts on Apache CloudStack based clouds cs_affinitygroup \u2013 Manages affinity groups on Apache CloudStack based clouds cs_cluster \u2013 Manages host clusters on Apache CloudStack based clouds cs_configuration \u2013 Manages configuration on Apache CloudStack based clouds cs_disk_offering \u2013 Manages disk offerings on Apache CloudStack based clouds cs_domain \u2013 Manages domains on Apache CloudStack based clouds cs_facts \u2013 Gather facts on instances of Apache CloudStack based clouds cs_firewall \u2013 Manages firewall rules on Apache CloudStack based clouds cs_host \u2013 Manages hosts on Apache CloudStack based clouds cs_image_store \u2013 Manages CloudStack Image Stores cs_instance \u2013 Manages instances and virtual machines on Apache CloudStack based clouds cs_instance_facts \u2013 Gathering facts from the API of instances from Apache CloudStack based clouds (D) cs_instance_info \u2013 Gathering information from the API of instances from Apache CloudStack based clouds cs_instance_nic \u2013 Manages NICs of an instance on Apache CloudStack based clouds cs_instance_nic_secondaryip \u2013 Manages secondary IPs of an instance on Apache CloudStack based clouds cs_instance_password_reset \u2013 Allows resetting VM the default passwords on Apache CloudStack based clouds cs_instancegroup \u2013 Manages instance groups on Apache CloudStack based clouds cs_ip_address \u2013 Manages public IP address associations on Apache CloudStack based clouds cs_iso \u2013 Manages ISO images on Apache CloudStack based clouds cs_loadbalancer_rule \u2013 Manages load balancer rules on Apache CloudStack based clouds cs_loadbalancer_rule_member \u2013 Manages load balancer rule members on Apache CloudStack based clouds cs_network \u2013 Manages networks on Apache CloudStack based clouds cs_network_acl \u2013 Manages network access control lists (ACL) on Apache CloudStack based clouds cs_network_acl_rule \u2013 Manages network access control list (ACL) rules on Apache CloudStack based clouds cs_network_offering \u2013 Manages network offerings on Apache CloudStack based clouds cs_physical_network \u2013 Manages physical networks on Apache CloudStack based clouds cs_pod \u2013 Manages pods on Apache CloudStack based clouds cs_portforward \u2013 Manages port forwarding rules on Apache CloudStack based clouds cs_project \u2013 Manages projects on Apache CloudStack based clouds cs_region \u2013 Manages regions on Apache CloudStack based clouds cs_resourcelimit \u2013 Manages resource limits on Apache CloudStack based clouds cs_role \u2013 Manages user roles on Apache CloudStack based clouds cs_role_permission \u2013 Manages role permissions on Apache CloudStack based clouds cs_router \u2013 Manages routers on Apache CloudStack based clouds cs_securitygroup \u2013 Manages security groups on Apache CloudStack based clouds cs_securitygroup_rule \u2013 Manages security group rules on Apache CloudStack based clouds cs_service_offering \u2013 Manages service offerings on Apache CloudStack based clouds cs_snapshot_policy \u2013 Manages volume snapshot policies on Apache CloudStack based clouds cs_sshkeypair \u2013 Manages SSH keys on Apache CloudStack based clouds cs_staticnat \u2013 Manages static NATs on Apache CloudStack based clouds cs_storage_pool \u2013 Manages Primary Storage Pools on Apache CloudStack based clouds cs_template \u2013 Manages templates on Apache CloudStack based clouds cs_traffic_type \u2013 Manages traffic types on CloudStack Physical Networks cs_user \u2013 Manages users on Apache CloudStack based clouds cs_vlan_ip_range \u2013 Manages VLAN IP ranges on Apache CloudStack based clouds cs_vmsnapshot \u2013 Manages VM snapshots on Apache CloudStack based clouds cs_volume \u2013 Manages volumes on Apache CloudStack based clouds cs_vpc \u2013 Manages VPCs on Apache CloudStack based clouds cs_vpc_offering \u2013 Manages vpc offerings on Apache CloudStack based clouds cs_vpn_connection \u2013 Manages site-to-site VPN connections on Apache CloudStack based clouds cs_vpn_customer_gateway \u2013 Manages site-to-site VPN customer gateway configurations on Apache CloudStack based clouds cs_vpn_gateway \u2013 Manages site-to-site VPN gateways on Apache CloudStack based clouds cs_zone \u2013 Manages zones on Apache CloudStack based clouds cs_zone_facts \u2013 Gathering facts of zones from Apache CloudStack based clouds (D) cs_zone_info \u2013 Gathering information about zones from Apache CloudStack based clouds","title":"Cloudstack"},{"location":"basic/Reference/Module/#digital_ocean","text":"digital_ocean \u2013 Create/delete a droplet/SSH_key in DigitalOcean (D) digital_ocean_account_info \u2013 Gather information about DigitalOcean User account digital_ocean_block_storage \u2013 Create/destroy or attach/detach Block Storage volumes in DigitalOcean digital_ocean_certificate \u2013 Manage certificates in DigitalOcean digital_ocean_certificate_info \u2013 Gather information about DigitalOcean certificates digital_ocean_domain \u2013 Create/delete a DNS domain in DigitalOcean digital_ocean_domain_info \u2013 Gather information about DigitalOcean Domains digital_ocean_droplet \u2013 Create and delete a DigitalOcean droplet digital_ocean_firewall_info \u2013 Gather information about DigitalOcean firewalls digital_ocean_floating_ip \u2013 Manage DigitalOcean Floating IPs digital_ocean_floating_ip_info \u2013 DigitalOcean Floating IPs information digital_ocean_image_info \u2013 Gather information about DigitalOcean images digital_ocean_load_balancer_info \u2013 Gather information about DigitalOcean load balancers digital_ocean_region_info \u2013 Gather information about DigitalOcean regions digital_ocean_size_info \u2013 Gather information about DigitalOcean Droplet sizes digital_ocean_snapshot_info \u2013 Gather information about DigitalOcean Snapshot digital_ocean_sshkey \u2013 Manage DigitalOcean SSH keys digital_ocean_sshkey_facts \u2013 DigitalOcean SSH keys facts (D) digital_ocean_sshkey_info \u2013 Gather information about DigitalOcean SSH keys digital_ocean_tag \u2013 Create and remove tag(s) to DigitalOcean resource digital_ocean_tag_info \u2013 Gather information about DigitalOcean tags digital_ocean_volume_info \u2013 Gather information about DigitalOcean volumes","title":"Digital_Ocean"},{"location":"basic/Reference/Module/#dimensiondata","text":"dimensiondata_network \u2013 Create, update, and delete MCP 1.0 & 2.0 networks dimensiondata_vlan \u2013 Manage a VLAN in a Cloud Control network domain","title":"Dimensiondata"},{"location":"basic/Reference/Module/#docker","text":"docker_compose \u2013 Manage multi-container Docker applications with Docker Compose docker_config \u2013 Manage docker configs docker_container \u2013 manage docker containers docker_container_info \u2013 Retrieves facts about docker container docker_host_info \u2013 Retrieves facts about docker host and lists of objects of the services docker_image \u2013 Manage docker images docker_image_info \u2013 Inspect docker images docker_login \u2013 Log into a Docker registry docker_network \u2013 Manage Docker networks docker_network_info \u2013 Retrieves facts about docker network docker_node \u2013 Manage Docker Swarm node docker_node_info \u2013 Retrieves facts about docker swarm node from Swarm Manager docker_prune \u2013 Allows to prune various docker objects docker_secret \u2013 Manage docker secrets docker_stack \u2013 docker stack module docker_swarm \u2013 Manage Swarm cluster docker_swarm_info \u2013 Retrieves facts about Docker Swarm cluster docker_swarm_service \u2013 docker swarm service docker_swarm_service_info \u2013 Retrieves information about docker services from a Swarm Manager docker_volume \u2013 Manage Docker volumes docker_volume_info \u2013 Retrieve facts about Docker volumes","title":"Docker"},{"location":"basic/Reference/Module/#google","text":"gc_storage \u2013 This module manages objects/buckets in Google Cloud Storage gcdns_record \u2013 Creates or removes resource records in Google Cloud DNS (D) gcdns_zone \u2013 Creates or removes zones in Google Cloud DNS (D) gce \u2013 create or terminate GCE instances (D) gce_eip \u2013 Create or Destroy Global or Regional External IP addresses gce_img \u2013 utilize GCE image resources gce_instance_template \u2013 create or destroy instance templates of Compute Engine of GCP gce_labels \u2013 Create, Update or Destroy GCE Labels gce_lb \u2013 create/destroy GCE load-balancer resources gce_mig \u2013 Create, Update or Destroy a Managed Instance Group (MIG) gce_net \u2013 create/destroy GCE networks and firewall rules gce_pd \u2013 utilize GCE persistent disk resources gce_snapshot \u2013 Create or destroy snapshots for GCE storage volumes gce_tag \u2013 add or remove tag(s) to/from GCE instances gcp_appengine_firewall_rule \u2013 Creates a GCP FirewallRule gcp_appengine_firewall_rule_info \u2013 Gather info for GCP FirewallRule gcp_backend_service \u2013 Create or Destroy a Backend Service (D) gcp_bigquery_dataset \u2013 Creates a GCP Dataset gcp_bigquery_dataset_info \u2013 Gather info for GCP Dataset gcp_bigquery_table \u2013 Creates a GCP Table gcp_bigquery_table_info \u2013 Gather info for GCP Table gcp_cloudbuild_trigger \u2013 Creates a GCP Trigger gcp_cloudbuild_trigger_info \u2013 Gather info for GCP Trigger gcp_cloudfunctions_cloud_function \u2013 Creates a GCP CloudFunction gcp_cloudfunctions_cloud_function_info \u2013 Gather info for GCP CloudFunction gcp_cloudscheduler_job \u2013 Creates a GCP Job gcp_cloudscheduler_job_info \u2013 Gather info for GCP Job gcp_cloudtasks_queue \u2013 Creates a GCP Queue gcp_cloudtasks_queue_info \u2013 Gather info for GCP Queue gcp_compute_address \u2013 Creates a GCP Address gcp_compute_address_info \u2013 Gather info for GCP Address gcp_compute_autoscaler \u2013 Creates a GCP Autoscaler gcp_compute_autoscaler_info \u2013 Gather info for GCP Autoscaler gcp_compute_backend_bucket \u2013 Creates a GCP BackendBucket gcp_compute_backend_bucket_info \u2013 Gather info for GCP BackendBucket gcp_compute_backend_service \u2013 Creates a GCP BackendService gcp_compute_backend_service_info \u2013 Gather info for GCP BackendService gcp_compute_disk \u2013 Creates a GCP Disk gcp_compute_disk_info \u2013 Gather info for GCP Disk gcp_compute_firewall \u2013 Creates a GCP Firewall gcp_compute_firewall_info \u2013 Gather info for GCP Firewall gcp_compute_forwarding_rule \u2013 Creates a GCP ForwardingRule gcp_compute_forwarding_rule_info \u2013 Gather info for GCP ForwardingRule gcp_compute_global_address \u2013 Creates a GCP GlobalAddress gcp_compute_global_address_info \u2013 Gather info for GCP GlobalAddress gcp_compute_global_forwarding_rule \u2013 Creates a GCP GlobalForwardingRule gcp_compute_global_forwarding_rule_info \u2013 Gather info for GCP GlobalForwardingRule gcp_compute_health_check \u2013 Creates a GCP HealthCheck gcp_compute_health_check_info \u2013 Gather info for GCP HealthCheck gcp_compute_http_health_check \u2013 Creates a GCP HttpHealthCheck gcp_compute_http_health_check_info \u2013 Gather info for GCP HttpHealthCheck gcp_compute_https_health_check \u2013 Creates a GCP HttpsHealthCheck gcp_compute_https_health_check_info \u2013 Gather info for GCP HttpsHealthCheck gcp_compute_image \u2013 Creates a GCP Image gcp_compute_image_info \u2013 Gather info for GCP Image gcp_compute_instance \u2013 Creates a GCP Instance gcp_compute_instance_group \u2013 Creates a GCP InstanceGroup gcp_compute_instance_group_info \u2013 Gather info for GCP InstanceGroup gcp_compute_instance_group_manager \u2013 Creates a GCP InstanceGroupManager gcp_compute_instance_group_manager_info \u2013 Gather info for GCP InstanceGroupManager gcp_compute_instance_info \u2013 Gather info for GCP Instance gcp_compute_instance_template \u2013 Creates a GCP InstanceTemplate gcp_compute_instance_template_info \u2013 Gather info for GCP InstanceTemplate gcp_compute_interconnect_attachment \u2013 Creates a GCP InterconnectAttachment gcp_compute_interconnect_attachment_info \u2013 Gather info for GCP InterconnectAttachment gcp_compute_network \u2013 Creates a GCP Network gcp_compute_network_info \u2013 Gather info for GCP Network gcp_compute_region_disk \u2013 Creates a GCP RegionDisk gcp_compute_region_disk_info \u2013 Gather info for GCP RegionDisk gcp_compute_route \u2013 Creates a GCP Route gcp_compute_route_info \u2013 Gather info for GCP Route gcp_compute_router \u2013 Creates a GCP Router gcp_compute_router_info \u2013 Gather info for GCP Router gcp_compute_snapshot \u2013 Creates a GCP Snapshot gcp_compute_snapshot_info \u2013 Gather info for GCP Snapshot gcp_compute_ssl_certificate \u2013 Creates a GCP SslCertificate gcp_compute_ssl_certificate_info \u2013 Gather info for GCP SslCertificate gcp_compute_ssl_policy \u2013 Creates a GCP SslPolicy gcp_compute_ssl_policy_info \u2013 Gather info for GCP SslPolicy gcp_compute_subnetwork \u2013 Creates a GCP Subnetwork gcp_compute_subnetwork_info \u2013 Gather info for GCP Subnetwork gcp_compute_target_http_proxy \u2013 Creates a GCP TargetHttpProxy gcp_compute_target_http_proxy_info \u2013 Gather info for GCP TargetHttpProxy gcp_compute_target_https_proxy \u2013 Creates a GCP TargetHttpsProxy gcp_compute_target_https_proxy_info \u2013 Gather info for GCP TargetHttpsProxy gcp_compute_target_pool \u2013 Creates a GCP TargetPool gcp_compute_target_pool_info \u2013 Gather info for GCP TargetPool gcp_compute_target_ssl_proxy \u2013 Creates a GCP TargetSslProxy gcp_compute_target_ssl_proxy_info \u2013 Gather info for GCP TargetSslProxy gcp_compute_target_tcp_proxy \u2013 Creates a GCP TargetTcpProxy gcp_compute_target_tcp_proxy_info \u2013 Gather info for GCP TargetTcpProxy gcp_compute_target_vpn_gateway \u2013 Creates a GCP TargetVpnGateway gcp_compute_target_vpn_gateway_info \u2013 Gather info for GCP TargetVpnGateway gcp_compute_url_map \u2013 Creates a GCP UrlMap gcp_compute_url_map_info \u2013 Gather info for GCP UrlMap gcp_compute_vpn_tunnel \u2013 Creates a GCP VpnTunnel gcp_compute_vpn_tunnel_info \u2013 Gather info for GCP VpnTunnel gcp_container_cluster \u2013 Creates a GCP Cluster gcp_container_cluster_info \u2013 Gather info for GCP Cluster gcp_container_node_pool \u2013 Creates a GCP NodePool gcp_container_node_pool_info \u2013 Gather info for GCP NodePool gcp_dns_managed_zone \u2013 Creates a GCP ManagedZone gcp_dns_managed_zone_info \u2013 Gather info for GCP ManagedZone gcp_dns_resource_record_set \u2013 Creates a GCP ResourceRecordSet gcp_dns_resource_record_set_info \u2013 Gather info for GCP ResourceRecordSet gcp_filestore_instance \u2013 Creates a GCP Instance gcp_filestore_instance_info \u2013 Gather info for GCP Instance gcp_forwarding_rule \u2013 Create, Update or Destroy a Forwarding_Rule (D) gcp_healthcheck \u2013 Create, Update or Destroy a Healthcheck (D) gcp_iam_role \u2013 Creates a GCP Role gcp_iam_role_info \u2013 Gather info for GCP Role gcp_iam_service_account \u2013 Creates a GCP ServiceAccount gcp_iam_service_account_info \u2013 Gather info for GCP ServiceAccount gcp_iam_service_account_key \u2013 Creates a GCP ServiceAccountKey gcp_kms_crypto_key \u2013 Creates a GCP CryptoKey gcp_kms_crypto_key_info \u2013 Gather info for GCP CryptoKey gcp_kms_key_ring \u2013 Creates a GCP KeyRing gcp_kms_key_ring_info \u2013 Gather info for GCP KeyRing gcp_mlengine_model \u2013 Creates a GCP Model gcp_mlengine_model_info \u2013 Gather info for GCP Model gcp_mlengine_version \u2013 Creates a GCP Version gcp_mlengine_version_info \u2013 Gather info for GCP Version gcp_pubsub_subscription \u2013 Creates a GCP Subscription gcp_pubsub_subscription_info \u2013 Gather info for GCP Subscription gcp_pubsub_topic \u2013 Creates a GCP Topic gcp_pubsub_topic_info \u2013 Gather info for GCP Topic gcp_redis_instance \u2013 Creates a GCP Instance gcp_redis_instance_info \u2013 Gather info for GCP Instance gcp_resourcemanager_project \u2013 Creates a GCP Project gcp_resourcemanager_project_info \u2013 Gather info for GCP Project gcp_sourcerepo_repository \u2013 Creates a GCP Repository gcp_sourcerepo_repository_info \u2013 Gather info for GCP Repository gcp_spanner_database \u2013 Creates a GCP Database gcp_spanner_database_info \u2013 Gather info for GCP Database gcp_spanner_instance \u2013 Creates a GCP Instance gcp_spanner_instance_info \u2013 Gather info for GCP Instance gcp_sql_database \u2013 Creates a GCP Database gcp_sql_database_info \u2013 Gather info for GCP Database gcp_sql_instance \u2013 Creates a GCP Instance gcp_sql_instance_info \u2013 Gather info for GCP Instance gcp_sql_user \u2013 Creates a GCP User gcp_sql_user_info \u2013 Gather info for GCP User gcp_storage_bucket \u2013 Creates a GCP Bucket gcp_storage_bucket_access_control \u2013 Creates a GCP BucketAccessControl gcp_storage_object \u2013 Creates a GCP Object gcp_target_proxy \u2013 Create, Update or Destroy a Target_Proxy (D) gcp_tpu_node \u2013 Creates a GCP Node gcp_tpu_node_info \u2013 Gather info for GCP Node gcp_url_map \u2013 Create, Update or Destroy a Url_Map (D) gcpubsub \u2013 Create and Delete Topics/Subscriptions, Publish and pull messages on PubSub gcpubsub_info \u2013 List Topics/Subscriptions and Messages from Google PubSub gcspanner \u2013 Create and Delete Instances/Databases on Spanner (D)","title":"Google"},{"location":"basic/Reference/Module/#hcloud","text":"hcloud_datacenter_info \u2013 Gather info about the Hetzner Cloud datacenters hcloud_floating_ip_info \u2013 Gather infos about the Hetzner Cloud Floating IPs hcloud_image_info \u2013 Gather infos about your Hetzner Cloud images hcloud_location_info \u2013 Gather infos about your Hetzner Cloud locations hcloud_network \u2013 Create and manage cloud Networks on the Hetzner Cloud hcloud_network_info \u2013 Gather info about your Hetzner Cloud networks hcloud_rdns \u2013 Create and manage reverse DNS entries on the Hetzner Cloud hcloud_route \u2013 Create and delete cloud routes on the Hetzner Cloud hcloud_server \u2013 Create and manage cloud servers on the Hetzner Cloud hcloud_server_info \u2013 Gather infos about your Hetzner Cloud servers hcloud_server_network \u2013 Manage the relationship between Hetzner Cloud Networks and servers hcloud_server_type_info \u2013 Gather infos about the Hetzner Cloud server types hcloud_ssh_key \u2013 Create and manage ssh keys on the Hetzner Cloud hcloud_ssh_key_info \u2013 Gather infos about your Hetzner Cloud ssh_keys hcloud_subnetwork \u2013 Manage cloud subnetworks on the Hetzner Cloud hcloud_volume \u2013 Create and manage block volumes on the Hetzner Cloud hcloud_volume_info \u2013 Gather infos about your Hetzner Cloud volumes","title":"Hcloud"},{"location":"basic/Reference/Module/#heroku","text":"heroku_collaborator \u2013 Add or delete app collaborators on Heroku","title":"Heroku"},{"location":"basic/Reference/Module/#huawei","text":"hwc_network_vpc \u2013 Creates a Huawei Cloud VPC hwc_smn_topic \u2013 Creates a resource of SMNTopic in Huaweicloud Cloud","title":"Huawei"},{"location":"basic/Reference/Module/#kubevirt","text":"kubevirt_cdi_upload \u2013 Upload local VM images to CDI Upload Proxy kubevirt_preset \u2013 Manage KubeVirt virtual machine presets kubevirt_pvc \u2013 Manage PVCs on Kubernetes kubevirt_rs \u2013 Manage KubeVirt virtual machine replica sets kubevirt_template \u2013 Manage KubeVirt templates kubevirt_vm \u2013 Manage KubeVirt virtual machine","title":"Kubevirt"},{"location":"basic/Reference/Module/#linode","text":"linode \u2013 Manage instances on the Linode Public Cloud linode_v4 \u2013 Manage instances on the Linode cloud","title":"Linode"},{"location":"basic/Reference/Module/#lxc","text":"lxc_container \u2013 Manage LXC Containers","title":"Lxc"},{"location":"basic/Reference/Module/#lxd","text":"lxd_container \u2013 Manage LXD Containers lxd_profile \u2013 Manage LXD profiles","title":"Lxd"},{"location":"basic/Reference/Module/#memset","text":"memset_dns_reload \u2013 Request reload of Memset\u2019s DNS infrastructure, memset_memstore_info \u2013 Retrieve Memstore product usage information memset_server_info \u2013 Retrieve server information memset_zone \u2013 Creates and deletes Memset DNS zones memset_zone_domain \u2013 Create and delete domains in Memset DNS zones memset_zone_record \u2013 Create and delete records in Memset DNS zones","title":"Memset"},{"location":"basic/Reference/Module/#misc","text":"cloud_init_data_facts \u2013 Retrieve facts of cloud-init helm \u2013 Manages Kubernetes packages with the Helm package manager ovirt \u2013 oVirt/RHEV platform management proxmox \u2013 management of instances in Proxmox VE cluster proxmox_kvm \u2013 Management of Qemu(KVM) Virtual Machines in Proxmox VE cluster proxmox_template \u2013 management of OS templates in Proxmox VE cluster rhevm \u2013 RHEV/oVirt automation serverless \u2013 Manages a Serverless Framework project terraform \u2013 Manages a Terraform deployment (and plans) virt \u2013 Manages virtual machines supported by libvirt virt_net \u2013 Manage libvirt network configuration virt_pool \u2013 Manage libvirt storage pools xenserver_facts \u2013 get facts reported on xenserver","title":"Misc"},{"location":"basic/Reference/Module/#oneandone","text":"oneandone_firewall_policy \u2013 Configure 1&1 firewall policy oneandone_load_balancer \u2013 Configure 1&1 load balancer oneandone_monitoring_policy \u2013 Configure 1&1 monitoring policy oneandone_private_network \u2013 Configure 1&1 private networking oneandone_public_ip \u2013 Configure 1&1 public IPs oneandone_server \u2013 Create, destroy, start, stop, and reboot a 1&1 Host server","title":"Oneandone"},{"location":"basic/Reference/Module/#online","text":"online_server_facts \u2013 Gather facts about Online servers (D) online_server_info \u2013 Gather information about Online servers online_user_facts \u2013 Gather facts about Online user (D) online_user_info \u2013 Gather information about Online user","title":"Online"},{"location":"basic/Reference/Module/#opennebula","text":"one_host \u2013 Manages OpenNebula Hosts one_image \u2013 Manages OpenNebula images one_image_info \u2013 Gather information on OpenNebula images one_service \u2013 Deploy and manage OpenNebula services one_vm \u2013 Creates or terminates OpenNebula instances","title":"Opennebula"},{"location":"basic/Reference/Module/#openstack","text":"os_auth \u2013 Retrieve an auth token os_client_config \u2013 Get OpenStack Client config os_coe_cluster \u2013 Add/Remove COE cluster from OpenStack Cloud os_coe_cluster_template \u2013 Add/Remove COE cluster template from OpenStack Cloud os_flavor_info \u2013 Retrieve information about one or more flavors os_floating_ip \u2013 Add/Remove floating IP from an instance os_group \u2013 Manage OpenStack Identity Groups os_group_info \u2013 Retrieve info about one or more OpenStack groups os_image \u2013 Add/Delete images from OpenStack Cloud os_image_info \u2013 Retrieve information about an image within OpenStack os_ironic \u2013 Create/Delete Bare Metal Resources from OpenStack os_ironic_inspect \u2013 Explicitly triggers baremetal node introspection in ironic os_ironic_node \u2013 Activate/Deactivate Bare Metal Resources from OpenStack os_keypair \u2013 Add/Delete a keypair from OpenStack os_keystone_domain \u2013 Manage OpenStack Identity Domains os_keystone_domain_info \u2013 Retrieve information about one or more OpenStack domains os_keystone_endpoint \u2013 Manage OpenStack Identity service endpoints os_keystone_role \u2013 Manage OpenStack Identity Roles os_keystone_service \u2013 Manage OpenStack Identity services os_listener \u2013 Add/Delete a listener for a load balancer from OpenStack Cloud os_loadbalancer \u2013 Add/Delete load balancer from OpenStack Cloud os_member \u2013 Add/Delete a member for a pool in load balancer from OpenStack Cloud os_network \u2013 Creates/removes networks from OpenStack os_networks_info \u2013 Retrieve information about one or more OpenStack networks os_nova_flavor \u2013 Manage OpenStack compute flavors os_nova_host_aggregate \u2013 Manage OpenStack host aggregates os_object \u2013 Create or Delete objects and containers from OpenStack os_pool \u2013 Add/Delete a pool in the load balancing service from OpenStack Cloud os_port \u2013 Add/Update/Delete ports from an OpenStack cloud os_port_info \u2013 Retrieve information about ports within OpenStack os_project \u2013 Manage OpenStack Projects os_project_access \u2013 Manage OpenStack compute flavors access os_project_info \u2013 Retrieve information about one or more OpenStack projects os_quota \u2013 Manage OpenStack Quotas os_recordset \u2013 Manage OpenStack DNS recordsets os_router \u2013 Create or delete routers from OpenStack os_security_group \u2013 Add/Delete security groups from an OpenStack cloud os_security_group_rule \u2013 Add/Delete rule from an existing security group os_server \u2013 Create/Delete Compute Instances from OpenStack os_server_action \u2013 Perform actions on Compute Instances from OpenStack os_server_group \u2013 Manage OpenStack server groups os_server_info \u2013 Retrieve information about one or more compute instances os_server_metadata \u2013 Add/Update/Delete Metadata in Compute Instances from OpenStack os_server_volume \u2013 Attach/Detach Volumes from OpenStack VM\u2019s os_stack \u2013 Add/Remove Heat Stack os_subnet \u2013 Add/Remove subnet to an OpenStack network os_subnets_info \u2013 Retrieve information about one or more OpenStack subnets os_user \u2013 Manage OpenStack Identity Users os_user_group \u2013 Associate OpenStack Identity users and groups os_user_info \u2013 Retrieve information about one or more OpenStack users os_user_role \u2013 Associate OpenStack Identity users and roles os_volume \u2013 Create/Delete Cinder Volumes os_volume_snapshot \u2013 Create/Delete Cinder Volume Snapshots os_zone \u2013 Manage OpenStack DNS zones","title":"Openstack"},{"location":"basic/Reference/Module/#oracle","text":"oci_vcn \u2013 Manage Virtual Cloud Networks(VCN) in OCI","title":"Oracle"},{"location":"basic/Reference/Module/#ovh","text":"ovh_ip_failover \u2013 Manage OVH IP failover address ovh_ip_loadbalancing_backend \u2013 Manage OVH IP LoadBalancing backends","title":"Ovh"},{"location":"basic/Reference/Module/#ovirt","text":"ovirt_affinity_group \u2013 Module to manage affinity groups in oVirt/RHV ovirt_affinity_label \u2013 Module to manage affinity labels in oVirt/RHV ovirt_affinity_label_info \u2013 Retrieve information about one or more oVirt/RHV affinity labels ovirt_api_info \u2013 Retrieve information about the oVirt/RHV API ovirt_auth \u2013 Module to manage authentication to oVirt/RHV ovirt_cluster \u2013 Module to manage clusters in oVirt/RHV ovirt_cluster_info \u2013 Retrieve information about one or more oVirt/RHV clusters ovirt_datacenter \u2013 Module to manage data centers in oVirt/RHV ovirt_datacenter_info \u2013 Retrieve information about one or more oVirt/RHV datacenters ovirt_disk \u2013 Module to manage Virtual Machine and floating disks in oVirt/RHV ovirt_disk_info \u2013 Retrieve information about one or more oVirt/RHV disks ovirt_event \u2013 Create or delete an event in oVirt/RHV ovirt_event_info \u2013 This module can be used to retrieve information about one or more oVirt/RHV events ovirt_external_provider \u2013 Module to manage external providers in oVirt/RHV ovirt_external_provider_info \u2013 Retrieve information about one or more oVirt/RHV external providers ovirt_group \u2013 Module to manage groups in oVirt/RHV ovirt_group_info \u2013 Retrieve information about one or more oVirt/RHV groups ovirt_host \u2013 Module to manage hosts in oVirt/RHV ovirt_host_info \u2013 Retrieve information about one or more oVirt/RHV hosts ovirt_host_network \u2013 Module to manage host networks in oVirt/RHV ovirt_host_pm \u2013 Module to manage power management of hosts in oVirt/RHV ovirt_host_storage_info \u2013 Retrieve information about one or more oVirt/RHV HostStorages (applicable only for block storage) ovirt_instance_type \u2013 Module to manage Instance Types in oVirt/RHV ovirt_job \u2013 Module to manage jobs in oVirt/RHV ovirt_mac_pool \u2013 Module to manage MAC pools in oVirt/RHV ovirt_network \u2013 Module to manage logical networks in oVirt/RHV ovirt_network_info \u2013 Retrieve information about one or more oVirt/RHV networks ovirt_nic \u2013 Module to manage network interfaces of Virtual Machines in oVirt/RHV ovirt_nic_info \u2013 Retrieve information about one or more oVirt/RHV virtual machine network interfaces ovirt_permission \u2013 Module to manage permissions of users/groups in oVirt/RHV ovirt_permission_info \u2013 Retrieve information about one or more oVirt/RHV permissions ovirt_quota \u2013 Module to manage datacenter quotas in oVirt/RHV ovirt_quota_info \u2013 Retrieve information about one or more oVirt/RHV quotas ovirt_role \u2013 Module to manage roles in oVirt/RHV ovirt_scheduling_policy_info \u2013 Retrieve information about one or more oVirt scheduling policies ovirt_snapshot \u2013 Module to manage Virtual Machine Snapshots in oVirt/RHV ovirt_snapshot_info \u2013 Retrieve information about one or more oVirt/RHV virtual machine snapshots ovirt_storage_connection \u2013 Module to manage storage connections in oVirt ovirt_storage_domain \u2013 Module to manage storage domains in oVirt/RHV ovirt_storage_domain_info \u2013 Retrieve information about one or more oVirt/RHV storage domains ovirt_storage_template_info \u2013 Retrieve information about one or more oVirt/RHV templates relate to a storage domain ovirt_storage_vm_info \u2013 Retrieve information about one or more oVirt/RHV virtual machines relate to a storage domain ovirt_tag \u2013 Module to manage tags in oVirt/RHV ovirt_tag_info \u2013 Retrieve information about one or more oVirt/RHV tags ovirt_template \u2013 Module to manage virtual machine templates in oVirt/RHV ovirt_template_info \u2013 Retrieve information about one or more oVirt/RHV templates ovirt_user \u2013 Module to manage users in oVirt/RHV ovirt_user_info \u2013 Retrieve information about one or more oVirt/RHV users ovirt_vm \u2013 Module to manage Virtual Machines in oVirt/RHV ovirt_vm_info \u2013 Retrieve information about one or more oVirt/RHV virtual machines ovirt_vmpool \u2013 Module to manage VM pools in oVirt/RHV ovirt_vmpool_info \u2013 Retrieve information about one or more oVirt/RHV vmpools ovirt_vnic_profile \u2013 Module to manage vNIC profile of network in oVirt/RHV","title":"Ovirt"},{"location":"basic/Reference/Module/#packet","text":"packet_device \u2013 Manage a bare metal server in the Packet Host packet_sshkey \u2013 Create/delete an SSH key in Packet host","title":"Packet"},{"location":"basic/Reference/Module/#podman","text":"podman_image \u2013 Pull images for use by podman podman_image_info \u2013 Gather info about images using podman","title":"Podman"},{"location":"basic/Reference/Module/#profitbricks","text":"profitbricks \u2013 Create, destroy, start, stop, and reboot a ProfitBricks virtual machine profitbricks_datacenter \u2013 Create or destroy a ProfitBricks Virtual Datacenter profitbricks_nic \u2013 Create or Remove a NIC profitbricks_volume \u2013 Create or destroy a volume profitbricks_volume_attachments \u2013 Attach or detach a volume","title":"Profitbricks"},{"location":"basic/Reference/Module/#pubnub","text":"pubnub_blocks \u2013 PubNub blocks management module","title":"Pubnub"},{"location":"basic/Reference/Module/#rackspace","text":"rax \u2013 create / delete an instance in Rackspace Public Cloud rax_cbs \u2013 Manipulate Rackspace Cloud Block Storage Volumes rax_cbs_attachments \u2013 Manipulate Rackspace Cloud Block Storage Volume Attachments rax_cdb \u2013 create/delete or resize a Rackspace Cloud Databases instance rax_cdb_database \u2013 create / delete a database in the Cloud Databases rax_cdb_user \u2013 create / delete a Rackspace Cloud Database rax_clb \u2013 create / delete a load balancer in Rackspace Public Cloud rax_clb_nodes \u2013 add, modify and remove nodes from a Rackspace Cloud Load Balancer rax_clb_ssl \u2013 Manage SSL termination for a Rackspace Cloud Load Balancer rax_dns \u2013 Manage domains on Rackspace Cloud DNS rax_dns_record \u2013 Manage DNS records on Rackspace Cloud DNS rax_facts \u2013 Gather facts for Rackspace Cloud Servers rax_files \u2013 Manipulate Rackspace Cloud Files Containers rax_files_objects \u2013 Upload, download, and delete objects in Rackspace Cloud Files rax_identity \u2013 Load Rackspace Cloud Identity rax_keypair \u2013 Create a keypair for use with Rackspace Cloud Servers rax_meta \u2013 Manipulate metadata for Rackspace Cloud Servers rax_mon_alarm \u2013 Create or delete a Rackspace Cloud Monitoring alarm rax_mon_check \u2013 Create or delete a Rackspace Cloud Monitoring check for an existing entity rax_mon_entity \u2013 Create or delete a Rackspace Cloud Monitoring entity rax_mon_notification \u2013 Create or delete a Rackspace Cloud Monitoring notification rax_mon_notification_plan \u2013 Create or delete a Rackspace Cloud Monitoring notification plan rax_network \u2013 create / delete an isolated network in Rackspace Public Cloud rax_queue \u2013 create / delete a queue in Rackspace Public Cloud rax_scaling_group \u2013 Manipulate Rackspace Cloud Autoscale Groups rax_scaling_policy \u2013 Manipulate Rackspace Cloud Autoscale Scaling Policy","title":"Rackspace"},{"location":"basic/Reference/Module/#scaleway","text":"scaleway_compute \u2013 Scaleway compute management module scaleway_image_facts \u2013 Gather facts about the Scaleway images available (D) scaleway_image_info \u2013 Gather information about the Scaleway images available scaleway_ip \u2013 Scaleway IP management module scaleway_ip_facts \u2013 Gather facts about the Scaleway ips available (D) scaleway_ip_info \u2013 Gather information about the Scaleway ips available scaleway_lb \u2013 Scaleway load-balancer management module scaleway_organization_facts \u2013 Gather facts about the Scaleway organizations available (D) scaleway_organization_info \u2013 Gather information about the Scaleway organizations available scaleway_security_group \u2013 Scaleway Security Group management module scaleway_security_group_facts \u2013 Gather facts about the Scaleway security groups available (D) scaleway_security_group_info \u2013 Gather information about the Scaleway security groups available scaleway_security_group_rule \u2013 Scaleway Security Group Rule management module scaleway_server_facts \u2013 Gather facts about the Scaleway servers available (D) scaleway_server_info \u2013 Gather information about the Scaleway servers available scaleway_snapshot_facts \u2013 Gather facts about the Scaleway snapshots available (D) scaleway_snapshot_info \u2013 Gather information about the Scaleway snapshots available scaleway_sshkey \u2013 Scaleway SSH keys management module scaleway_user_data \u2013 Scaleway user_data management module scaleway_volume \u2013 Scaleway volumes management module scaleway_volume_facts \u2013 Gather facts about the Scaleway volumes available (D) scaleway_volume_info \u2013 Gather information about the Scaleway volumes available","title":"Scaleway"},{"location":"basic/Reference/Module/#smartos","text":"imgadm \u2013 Manage SmartOS images nictagadm \u2013 Manage nic tags on SmartOS systems smartos_image_info \u2013 Get SmartOS image details vmadm \u2013 Manage SmartOS virtual machines and zones","title":"Smartos"},{"location":"basic/Reference/Module/#softlayer","text":"sl_vm \u2013 create or cancel a virtual instance in SoftLayer","title":"Softlayer"},{"location":"basic/Reference/Module/#spotinst","text":"spotinst_aws_elastigroup \u2013 Create, update or delete Spotinst AWS Elastigroups","title":"Spotinst"},{"location":"basic/Reference/Module/#univention","text":"udm_dns_record \u2013 Manage dns entries on a univention corporate server udm_dns_zone \u2013 Manage dns zones on a univention corporate server udm_group \u2013 Manage of the posix group udm_share \u2013 Manage samba shares on a univention corporate server udm_user \u2013 Manage posix users on a univention corporate server","title":"Univention"},{"location":"basic/Reference/Module/#vmware","text":"vca_fw \u2013 add remove firewall rules in a gateway in a vca vca_nat \u2013 add remove nat rules in a gateway in a vca vca_vapp \u2013 Manages vCloud Air vApp instances vcenter_extension \u2013 Register/deregister vCenter Extensions vcenter_extension_facts \u2013 Gather facts vCenter extensions (D) vcenter_extension_info \u2013 Gather info vCenter extensions vcenter_folder \u2013 Manage folders on given datacenter vcenter_license \u2013 Manage VMware vCenter license keys vmware_about_facts \u2013 Provides information about VMware server to which user is connecting to (D) vmware_about_info \u2013 Provides information about VMware server to which user is connecting to vmware_category \u2013 Manage VMware categories vmware_category_facts \u2013 Gather facts about VMware tag categories (D) vmware_category_info \u2013 Gather info about VMware tag categories vmware_cfg_backup \u2013 Backup / Restore / Reset ESXi host configuration vmware_cluster \u2013 Manage VMware vSphere clusters vmware_cluster_drs \u2013 Manage Distributed Resource Scheduler (DRS) on VMware vSphere clusters vmware_cluster_ha \u2013 Manage High Availability (HA) on VMware vSphere clusters vmware_cluster_info \u2013 Gather info about clusters available in given vCenter vmware_cluster_vsan \u2013 Manages virtual storage area network (vSAN) configuration on VMware vSphere clusters vmware_content_deploy_template \u2013 Deploy Virtual Machine from template stored in content library vmware_content_library_info \u2013 Gather information about VMware Content Library vmware_content_library_manager \u2013 Create, update and delete VMware content library vmware_datacenter \u2013 Manage VMware vSphere Datacenters vmware_datastore_cluster \u2013 Manage VMware vSphere datastore clusters vmware_datastore_info \u2013 Gather info about datastores available in given vCenter vmware_datastore_maintenancemode \u2013 Place a datastore into maintenance mode vmware_deploy_ovf \u2013 Deploys a VMware virtual machine from an OVF or OVA file vmware_dns_config \u2013 Manage VMware ESXi DNS Configuration vmware_drs_group \u2013 Creates vm/host group in a given cluster vmware_drs_group_facts \u2013 Gathers facts about DRS VM/Host groups on the given cluster (D) vmware_drs_group_info \u2013 Gathers info about DRS VM/Host groups on the given cluster vmware_drs_rule_facts \u2013 Gathers facts about DRS rule on the given cluster (D) vmware_drs_rule_info \u2013 Gathers info about DRS rule on the given cluster vmware_dvs_host \u2013 Add or remove a host from distributed virtual switch vmware_dvs_portgroup \u2013 Create or remove a Distributed vSwitch portgroup vmware_dvs_portgroup_facts \u2013 Gathers facts DVS portgroup configurations (D) vmware_dvs_portgroup_find \u2013 Find portgroup(s) in a VMware environment vmware_dvs_portgroup_info \u2013 Gathers info DVS portgroup configurations vmware_dvswitch \u2013 Create or remove a Distributed Switch vmware_dvswitch_lacp \u2013 Manage LACP configuration on a Distributed Switch vmware_dvswitch_nioc \u2013 Manage distributed switch Network IO Control vmware_dvswitch_pvlans \u2013 Manage Private VLAN configuration of a Distributed Switch vmware_dvswitch_uplink_pg \u2013 Manage uplink portproup configuration of a Distributed Switch vmware_evc_mode \u2013 Enable/Disable EVC mode on vCenter vmware_export_ovf \u2013 Exports a VMware virtual machine to an OVF file, device files and a manifest file vmware_folder_info \u2013 Provides information about folders in a datacenter vmware_guest \u2013 Manages virtual machines in vCenter vmware_guest_boot_facts \u2013 Gather facts about boot options for the given virtual machine (D) vmware_guest_boot_info \u2013 Gather info about boot options for the given virtual machine vmware_guest_boot_manager \u2013 Manage boot options for the given virtual machine vmware_guest_custom_attribute_defs \u2013 Manage custom attributes definitions for virtual machine from VMware vmware_guest_custom_attributes \u2013 Manage custom attributes from VMware for the given virtual machine vmware_guest_customization_facts \u2013 Gather facts about VM customization specifications (D) vmware_guest_customization_info \u2013 Gather info about VM customization specifications vmware_guest_disk \u2013 Manage disks related to virtual machine in given vCenter infrastructure vmware_guest_disk_facts \u2013 Gather facts about disks of given virtual machine (D) vmware_guest_disk_info \u2013 Gather info about disks of given virtual machine vmware_guest_file_operation \u2013 Files operation in a VMware guest operating system without network vmware_guest_find \u2013 Find the folder path(s) for a virtual machine by name or UUID vmware_guest_info \u2013 Gather info about a single VM vmware_guest_move \u2013 Moves virtual machines in vCenter vmware_guest_network \u2013 Manage network adapters of specified virtual machine in given vCenter infrastructure vmware_guest_powerstate \u2013 Manages power states of virtual machines in vCenter vmware_guest_screenshot \u2013 Create a screenshot of the Virtual Machine console vmware_guest_sendkey \u2013 Send USB HID codes to the Virtual Machine\u2019s keyboard vmware_guest_snapshot \u2013 Manages virtual machines snapshots in vCenter vmware_guest_snapshot_info \u2013 Gather info about virtual machine\u2019s snapshots in vCenter vmware_guest_tools_upgrade \u2013 Module to upgrade VMTools vmware_guest_tools_wait \u2013 Wait for VMware tools to become available vmware_guest_video \u2013 Modify video card configurations of specified virtual machine in given vCenter infrastructure vmware_guest_vnc \u2013 Manages VNC remote display on virtual machines in vCenter vmware_host \u2013 Add, remove, or move an ESXi host to, from, or within vCenter vmware_host_acceptance \u2013 Manage the host acceptance level of an ESXi host vmware_host_active_directory \u2013 Joins an ESXi host system to an Active Directory domain or leaves it vmware_host_capability_facts \u2013 Gathers facts about an ESXi host\u2019s capability information (D) vmware_host_capability_info \u2013 Gathers info about an ESXi host\u2019s capability information vmware_host_config_facts \u2013 Gathers facts about an ESXi host\u2019s advance configuration information (D) vmware_host_config_info \u2013 Gathers info about an ESXi host\u2019s advance configuration information vmware_host_config_manager \u2013 Manage advanced system settings of an ESXi host vmware_host_datastore \u2013 Manage a datastore on ESXi host vmware_host_dns_facts \u2013 Gathers facts about an ESXi host\u2019s DNS configuration information (D) vmware_host_dns_info \u2013 Gathers info about an ESXi host\u2019s DNS configuration information vmware_host_facts \u2013 Gathers facts about remote ESXi hostsystem vmware_host_feature_facts \u2013 Gathers facts about an ESXi host\u2019s feature capability information (D) vmware_host_feature_info \u2013 Gathers info about an ESXi host\u2019s feature capability information vmware_host_firewall_facts \u2013 Gathers facts about an ESXi host\u2019s firewall configuration information (D) vmware_host_firewall_info \u2013 Gathers info about an ESXi host\u2019s firewall configuration information vmware_host_firewall_manager \u2013 Manage firewall configurations about an ESXi host vmware_host_hyperthreading \u2013 Enables/Disables Hyperthreading optimization for an ESXi host system vmware_host_ipv6 \u2013 Enables/Disables IPv6 support for an ESXi host system vmware_host_kernel_manager \u2013 Manage kernel module options on ESXi hosts vmware_host_lockdown \u2013 Manage administrator permission for the local administrative account for the ESXi host vmware_host_ntp \u2013 Manage NTP server configuration of an ESXi host vmware_host_ntp_facts \u2013 Gathers facts about NTP configuration on an ESXi host (D) vmware_host_ntp_info \u2013 Gathers info about NTP configuration on an ESXi host vmware_host_package_facts \u2013 Gathers facts about available packages on an ESXi host (D) vmware_host_package_info \u2013 Gathers info about available packages on an ESXi host vmware_host_powermgmt_policy \u2013 Manages the Power Management Policy of an ESXI host system vmware_host_powerstate \u2013 Manages power states of host systems in vCenter vmware_host_scanhba \u2013 Rescan host HBA\u2019s and optionally refresh the storage system vmware_host_service_facts \u2013 Gathers facts about an ESXi host\u2019s services (D) vmware_host_service_info \u2013 Gathers info about an ESXi host\u2019s services vmware_host_service_manager \u2013 Manage services on a given ESXi host vmware_host_snmp \u2013 Configures SNMP on an ESXi host system vmware_host_ssl_facts \u2013 Gather facts of ESXi host system about SSL (D) vmware_host_ssl_info \u2013 Gather info of ESXi host system about SSL vmware_host_vmhba_facts \u2013 Gathers facts about vmhbas available on the given ESXi host (D) vmware_host_vmhba_info \u2013 Gathers info about vmhbas available on the given ESXi host vmware_host_vmnic_facts \u2013 Gathers facts about vmnics available on the given ESXi host (D) vmware_host_vmnic_info \u2013 Gathers info about vmnics available on the given ESXi host vmware_local_role_facts \u2013 Gather facts about local roles on an ESXi host (D) vmware_local_role_info \u2013 Gather info about local roles on an ESXi host vmware_local_role_manager \u2013 Manage local roles on an ESXi host vmware_local_user_facts \u2013 Gather facts about users on the given ESXi host (D) vmware_local_user_info \u2013 Gather info about users on the given ESXi host vmware_local_user_manager \u2013 Manage local users on an ESXi host vmware_maintenancemode \u2013 Place a host into maintenance mode vmware_migrate_vmk \u2013 Migrate a VMK interface from VSS to VDS vmware_object_role_permission \u2013 Manage local roles on an ESXi host vmware_portgroup \u2013 Create a VMware portgroup vmware_portgroup_facts \u2013 Gathers facts about an ESXi host\u2019s Port Group configuration (D) vmware_portgroup_info \u2013 Gathers info about an ESXi host\u2019s Port Group configuration vmware_resource_pool \u2013 Add/remove resource pools to/from vCenter vmware_resource_pool_facts \u2013 Gathers facts about resource pool information (D) vmware_resource_pool_info \u2013 Gathers info about resource pool information vmware_tag \u2013 Manage VMware tags vmware_tag_info \u2013 Manage VMware tag info vmware_tag_manager \u2013 Manage association of VMware tags with VMware objects vmware_target_canonical_facts \u2013 Return canonical (NAA) from an ESXi host system (D) vmware_target_canonical_info \u2013 Return canonical (NAA) from an ESXi host system vmware_vcenter_settings \u2013 Configures general settings on a vCenter server vmware_vcenter_statistics \u2013 Configures statistics on a vCenter server vmware_vm_host_drs_rule \u2013 Creates vm/host group in a given cluster vmware_vm_info \u2013 Return basic info pertaining to a VMware machine guest vmware_vm_shell \u2013 Run commands in a VMware guest operating system vmware_vm_storage_policy_info \u2013 Gather information about vSphere storage profile defined storage policy information vmware_vm_vm_drs_rule \u2013 Configure VMware DRS Affinity rule for virtual machine in given cluster vmware_vm_vss_dvs_migrate \u2013 Migrates a virtual machine from a standard vswitch to distributed vmware_vmkernel \u2013 Manages a VMware VMkernel Adapter of an ESXi host vmware_vmkernel_facts \u2013 Gathers VMKernel facts about an ESXi host (D) vmware_vmkernel_info \u2013 Gathers VMKernel info about an ESXi host vmware_vmkernel_ip_config \u2013 Configure the VMkernel IP Address vmware_vmotion \u2013 Move a virtual machine using vMotion, and/or its vmdks using storage vMotion vmware_vsan_cluster \u2013 Configure VSAN clustering on an ESXi host vmware_vspan_session \u2013 Create or remove a Port Mirroring session vmware_vswitch \u2013 Manage a VMware Standard Switch to an ESXi host vmware_vswitch_facts \u2013 Gathers facts about an ESXi host\u2019s vswitch configurations (D) vmware_vswitch_info \u2013 Gathers info about an ESXi host\u2019s vswitch configurations vsphere_copy \u2013 Copy a file to a VMware datastore vsphere_file \u2013 Manage files on a vCenter datastore","title":"Vmware"},{"location":"basic/Reference/Module/#vultr","text":"vultr_account_facts \u2013 Gather facts about the Vultr account (D) vultr_account_info \u2013 Get information about the Vultr account vultr_block_storage \u2013 Manages block storage volumes on Vultr vultr_block_storage_facts \u2013 Gather facts about the Vultr block storage volumes available (D) vultr_block_storage_info \u2013 Get information about the Vultr block storage volumes available vultr_dns_domain \u2013 Manages DNS domains on Vultr vultr_dns_domain_facts \u2013 Gather facts about the Vultr DNS domains available (D) vultr_dns_domain_info \u2013 Gather information about the Vultr DNS domains available vultr_dns_record \u2013 Manages DNS records on Vultr vultr_firewall_group \u2013 Manages firewall groups on Vultr vultr_firewall_group_facts \u2013 Gather facts about the Vultr firewall groups available (D) vultr_firewall_group_info \u2013 Gather information about the Vultr firewall groups available vultr_firewall_rule \u2013 Manages firewall rules on Vultr vultr_network \u2013 Manages networks on Vultr vultr_network_facts \u2013 Gather facts about the Vultr networks available (D) vultr_network_info \u2013 Gather information about the Vultr networks available vultr_os_facts \u2013 Gather facts about the Vultr OSes available (D) vultr_os_info \u2013 Get information about the Vultr OSes available vultr_plan_facts \u2013 Gather facts about the Vultr plans available (D) vultr_plan_info \u2013 Gather information about the Vultr plans available vultr_region_facts \u2013 Gather facts about the Vultr regions available (D) vultr_region_info \u2013 Gather information about the Vultr regions available vultr_server \u2013 Manages virtual servers on Vultr vultr_server_facts \u2013 Gather facts about the Vultr servers available (D) vultr_server_info \u2013 Gather information about the Vultr servers available vultr_ssh_key \u2013 Manages ssh keys on Vultr vultr_ssh_key_facts \u2013 Gather facts about the Vultr SSH keys available (D) vultr_ssh_key_info \u2013 Get information about the Vultr SSH keys available vultr_startup_script \u2013 Manages startup scripts on Vultr vultr_startup_script_facts \u2013 Gather facts about the Vultr startup scripts available (D) vultr_startup_script_info \u2013 Gather information about the Vultr startup scripts available vultr_user \u2013 Manages users on Vultr vultr_user_facts \u2013 Gather facts about the Vultr user available (D) vultr_user_info \u2013 Get information about the Vultr user available","title":"Vultr"},{"location":"basic/Reference/Module/#webfaction","text":"webfaction_app \u2013 Add or remove applications on a Webfaction host webfaction_db \u2013 Add or remove a database on Webfaction webfaction_domain \u2013 Add or remove domains and subdomains on Webfaction webfaction_mailbox \u2013 Add or remove mailboxes on Webfaction webfaction_site \u2013 Add or remove a website on a Webfaction host","title":"Webfaction"},{"location":"basic/Reference/Module/#xenserver","text":"xenserver_guest \u2013 Manages virtual machines running on Citrix Hypervisor/XenServer host or pool xenserver_guest_info \u2013 Gathers information for virtual machines running on Citrix Hypervisor/XenServer host or pool xenserver_guest_powerstate \u2013 Manages power states of virtual machines running on Citrix Hypervisor/XenServer host or pool","title":"Xenserver"},{"location":"basic/Reference/Module/#clustering-modules","text":"consul \u2013 Add, modify & delete services within a consul cluster consul_acl \u2013 Manipulate Consul ACL keys and rules consul_kv \u2013 Manipulate entries in the key/value store of a consul cluster consul_session \u2013 Manipulate consul sessions etcd3 \u2013 Set or delete key value pairs from an etcd3 cluster pacemaker_cluster \u2013 Manage pacemaker clusters znode \u2013 Create, delete, retrieve, and update znodes using ZooKeeper","title":"Clustering modules"},{"location":"basic/Reference/Module/#k8s","text":"k8s \u2013 Manage Kubernetes (K8s) objects k8s_auth \u2013 Authenticate to Kubernetes clusters which require an explicit login step k8s_info \u2013 Describe Kubernetes (K8s) objects k8s_scale \u2013 Set a new size for a Deployment, ReplicaSet, Replication Controller, or Job k8s_service \u2013 Manage Services on Kubernetes","title":"K8S"},{"location":"basic/Reference/Module/#commands-modules","text":"command \u2013 Execute commands on targets expect \u2013 Executes a command and responds to prompts psexec \u2013 Runs commands on a remote Windows host based on the PsExec model raw \u2013 Executes a low-down and dirty command script \u2013 Runs a local script on a remote node after transferring it shell \u2013 Execute shell commands on targets telnet \u2013 Executes a low-down and dirty telnet command","title":"Commands modules"},{"location":"basic/Reference/Module/#crypto-modules","text":"certificate_complete_chain \u2013 Complete certificate chain given a set of untrusted and root certificates get_certificate \u2013 Get a certificate from a host:port luks_device \u2013 Manage encrypted (LUKS) devices openssh_cert \u2013 Generate OpenSSH host or user certificates openssh_keypair \u2013 Generate OpenSSH private and public keys openssl_certificate \u2013 Generate and/or check OpenSSL certificates openssl_certificate_info \u2013 Provide information of OpenSSL X.509 certificates openssl_csr \u2013 Generate OpenSSL Certificate Signing Request (CSR) openssl_csr_info \u2013 Provide information of OpenSSL Certificate Signing Requests (CSR) openssl_dhparam \u2013 Generate OpenSSL Diffie-Hellman Parameters openssl_pkcs12 \u2013 Generate OpenSSL PKCS#12 archive openssl_privatekey \u2013 Generate OpenSSL private keys openssl_privatekey_info \u2013 Provide information for OpenSSL private keys openssl_publickey \u2013 Generate an OpenSSL public key from its private key","title":"Crypto modules"},{"location":"basic/Reference/Module/#acme","text":"acme_account \u2013 Create, modify or delete ACME accounts acme_account_info \u2013 Retrieves information on ACME accounts acme_certificate \u2013 Create SSL/TLS certificates with the ACME protocol acme_certificate_revoke \u2013 Revoke certificates with the ACME protocol acme_challenge_cert_helper \u2013 Prepare certificates required for ACME challenges such as tls-alpn-01 acme_inspect \u2013 Send direct requests to an ACME server","title":"Acme"},{"location":"basic/Reference/Module/#entrust","text":"ecs_certificate \u2013 Request SSL/TLS certificates with the Entrust Certificate Services (ECS) API","title":"Entrust"},{"location":"basic/Reference/Module/#database-modules","text":"","title":"Database modules"},{"location":"basic/Reference/Module/#aerospike","text":"aerospike_migrations \u2013 Check or wait for migrations between nodes","title":"Aerospike"},{"location":"basic/Reference/Module/#influxdb","text":"influxdb_database \u2013 Manage InfluxDB databases influxdb_query \u2013 Query data points from InfluxDB influxdb_retention_policy \u2013 Manage InfluxDB retention policies influxdb_user \u2013 Manage InfluxDB users influxdb_write \u2013 Write data points into InfluxDB","title":"Influxdb"},{"location":"basic/Reference/Module/#misc_1","text":"elasticsearch_plugin \u2013 Manage Elasticsearch plugins kibana_plugin \u2013 Manage Kibana plugins redis \u2013 Various redis commands, slave and flush riak \u2013 This module handles some common Riak operations","title":"Misc"},{"location":"basic/Reference/Module/#mongodb","text":"mongodb_parameter \u2013 Change an administrative parameter on a MongoDB server mongodb_replicaset \u2013 Initialises a MongoDB replicaset mongodb_shard \u2013 Add and remove shards from a MongoDB Cluster mongodb_user \u2013 Adds or removes a user from a MongoDB database","title":"Mongodb"},{"location":"basic/Reference/Module/#mssql","text":"mssql_db \u2013 Add or remove MSSQL databases from a remote host","title":"Mssql"},{"location":"basic/Reference/Module/#mysql","text":"mysql_db \u2013 Add or remove MySQL databases from a remote host mysql_info \u2013 Gather information about MySQL servers mysql_replication \u2013 Manage MySQL replication mysql_user \u2013 Adds or removes a user from a MySQL database mysql_variables \u2013 Manage MySQL global variables","title":"Mysql"},{"location":"basic/Reference/Module/#postgresql","text":"postgresql_copy \u2013 Copy data between a file/program and a PostgreSQL table postgresql_db \u2013 Add or remove PostgreSQL databases from a remote host postgresql_ext \u2013 Add or remove PostgreSQL extensions from a database postgresql_idx \u2013 Create or drop indexes from a PostgreSQL database postgresql_info \u2013 Gather information about PostgreSQL servers postgresql_lang \u2013 Adds, removes or changes procedural languages with a PostgreSQL database postgresql_membership \u2013 Add or remove PostgreSQL roles from groups postgresql_owner \u2013 Change an owner of PostgreSQL database object postgresql_pg_hba \u2013 Add, remove or modify a rule in a pg_hba file postgresql_ping \u2013 Check remote PostgreSQL server availability postgresql_privs \u2013 Grant or revoke privileges on PostgreSQL database objects postgresql_publication \u2013 Add, update, or remove PostgreSQL publication postgresql_query \u2013 Run PostgreSQL queries postgresql_schema \u2013 Add or remove PostgreSQL schema postgresql_sequence \u2013 Create, drop, or alter a PostgreSQL sequence postgresql_set \u2013 Change a PostgreSQL server configuration parameter postgresql_slot \u2013 Add or remove replication slots from a PostgreSQL database postgresql_table \u2013 Create, drop, or modify a PostgreSQL table postgresql_tablespace \u2013 Add or remove PostgreSQL tablespaces from remote hosts postgresql_user \u2013 Add or remove a user (role) from a PostgreSQL server instance","title":"Postgresql"},{"location":"basic/Reference/Module/#proxysql","text":"proxysql_backend_servers \u2013 Adds or removes mysql hosts from proxysql admin interface proxysql_global_variables \u2013 Gets or sets the proxysql global variables proxysql_manage_config \u2013 Writes the proxysql configuration settings between layers proxysql_mysql_users \u2013 Adds or removes mysql users from proxysql admin interface proxysql_query_rules \u2013 Modifies query rules using the proxysql admin interface proxysql_replication_hostgroups \u2013 Manages replication hostgroups using the proxysql admin interface proxysql_scheduler \u2013 Adds or removes schedules from proxysql admin interface","title":"Proxysql"},{"location":"basic/Reference/Module/#vertica","text":"vertica_configuration \u2013 Updates Vertica configuration parameters vertica_info \u2013 Gathers Vertica database facts vertica_role \u2013 Adds or removes Vertica database roles and assigns roles to them vertica_schema \u2013 Adds or removes Vertica database schema and roles vertica_user \u2013 Adds or removes Vertica database users and assigns roles","title":"Vertica"},{"location":"basic/Reference/Module/#files-modules","text":"acl \u2013 Set and retrieve file ACL information archive \u2013 Creates a compressed archive of one or more files or trees assemble \u2013 Assemble configuration files from fragments blockinfile \u2013 Insert/update/remove a text block surrounded by marker lines copy \u2013 Copy files to remote locations fetch \u2013 Fetch files from remote nodes file \u2013 Manage files and file properties find \u2013 Return a list of files based on specific criteria ini_file \u2013 Tweak settings in INI files iso_extract \u2013 Extract files from an ISO image lineinfile \u2013 Manage lines in text files patch \u2013 Apply patch files using the GNU patch tool read_csv \u2013 Read a CSV file replace \u2013 Replace all instances of a particular string in a file using a back-referenced regular expression stat \u2013 Retrieve file or file system status synchronize \u2013 A wrapper around rsync to make common tasks in your playbooks quick and easy tempfile \u2013 Creates temporary files and directories template \u2013 Template a file out to a remote server unarchive \u2013 Unpacks an archive after (optionally) copying it from the local machine xattr \u2013 Manage user defined extended attributes xml \u2013 Manage bits and pieces of XML files or strings","title":"Files modules"},{"location":"basic/Reference/Module/#identity-modules","text":"onepassword_info \u2013 Gather items from 1Password","title":"Identity modules"},{"location":"basic/Reference/Module/#cyberark","text":"cyberark_authentication \u2013 Module for CyberArk Vault Authentication using PAS Web Services SDK cyberark_user \u2013 Module for CyberArk User Management using PAS Web Services SDK","title":"Cyberark"},{"location":"basic/Reference/Module/#ipa","text":"ipa_config \u2013 Manage Global FreeIPA Configuration Settings ipa_dnsrecord \u2013 Manage FreeIPA DNS records ipa_dnszone \u2013 Manage FreeIPA DNS Zones ipa_group \u2013 Manage FreeIPA group ipa_hbacrule \u2013 Manage FreeIPA HBAC rule ipa_host \u2013 Manage FreeIPA host ipa_hostgroup \u2013 Manage FreeIPA host-group ipa_role \u2013 Manage FreeIPA role ipa_service \u2013 Manage FreeIPA service ipa_subca \u2013 Manage FreeIPA Lightweight Sub Certificate Authorities ipa_sudocmd \u2013 Manage FreeIPA sudo command ipa_sudocmdgroup \u2013 Manage FreeIPA sudo command group ipa_sudorule \u2013 Manage FreeIPA sudo rule ipa_user \u2013 Manage FreeIPA users ipa_vault \u2013 Manage FreeIPA vaults","title":"Ipa"},{"location":"basic/Reference/Module/#keycloak","text":"keycloak_client \u2013 Allows administration of Keycloak clients via Keycloak API keycloak_clienttemplate \u2013 Allows administration of Keycloak client templates via Keycloak API keycloak_group \u2013 Allows administration of Keycloak groups via Keycloak API","title":"Keycloak"},{"location":"basic/Reference/Module/#opendj","text":"opendj_backendprop \u2013 Will update the backend configuration of OpenDJ via the dsconfig set-backend-prop command","title":"Opendj"},{"location":"basic/Reference/Module/#inventory-modules","text":"add_host \u2013 Add a host (and alternatively a group) to the ansible-playbook in-memory inventory group_by \u2013 Create Ansible groups based on facts","title":"Inventory modules"},{"location":"basic/Reference/Module/#messaging-modules","text":"","title":"Messaging modules"},{"location":"basic/Reference/Module/#rabbitmq","text":"rabbitmq_binding \u2013 Manage rabbitMQ bindings rabbitmq_exchange \u2013 Manage rabbitMQ exchanges rabbitmq_global_parameter \u2013 Manage RabbitMQ global parameters rabbitmq_parameter \u2013 Manage RabbitMQ parameters rabbitmq_plugin \u2013 Manage RabbitMQ plugins rabbitmq_policy \u2013 Manage the state of policies in RabbitMQ rabbitmq_queue \u2013 Manage rabbitMQ queues rabbitmq_user \u2013 Manage RabbitMQ users rabbitmq_vhost \u2013 Manage the state of a virtual host in RabbitMQ rabbitmq_vhost_limits \u2013 Manage the state of virtual host limits in RabbitMQ","title":"Rabbitmq"},{"location":"basic/Reference/Module/#monitoring-modules","text":"airbrake_deployment \u2013 Notify airbrake about app deployments bigpanda \u2013 Notify BigPanda about deployments circonus_annotation \u2013 create an annotation in circonus datadog_event \u2013 Posts events to Datadog service datadog_monitor \u2013 Manages Datadog monitors grafana_dashboard \u2013 Manage Grafana dashboards grafana_datasource \u2013 Manage Grafana datasources grafana_plugin \u2013 Manage Grafana plugins via grafana-cli honeybadger_deployment \u2013 Notify Honeybadger.io about app deployments icinga2_feature \u2013 Manage Icinga2 feature icinga2_host \u2013 Manage a host in Icinga2 librato_annotation \u2013 create an annotation in librato logentries \u2013 Module for tracking logs via logentries.com logicmonitor \u2013 Manage your LogicMonitor account through Ansible Playbooks logicmonitor_facts \u2013 Collect facts about LogicMonitor objects logstash_plugin \u2013 Manage Logstash plugins monit \u2013 Manage the state of a program monitored via Monit nagios \u2013 Perform common tasks in Nagios related to downtime and notifications newrelic_deployment \u2013 Notify newrelic about app deployments pagerduty \u2013 Create PagerDuty maintenance windows pagerduty_alert \u2013 Trigger, acknowledge or resolve PagerDuty incidents pingdom \u2013 Pause/unpause Pingdom alerts rollbar_deployment \u2013 Notify Rollbar about app deployments sensu_check \u2013 Manage Sensu checks sensu_client \u2013 Manages Sensu client configuration sensu_handler \u2013 Manages Sensu handler configuration sensu_silence \u2013 Manage Sensu silence entries sensu_subscription \u2013 Manage Sensu subscriptions spectrum_device \u2013 Creates/deletes devices in CA Spectrum stackdriver \u2013 Send code deploy and annotation events to stackdriver statusio_maintenance \u2013 Create maintenance windows for your status.io dashboard uptimerobot \u2013 Pause and start Uptime Robot monitoring","title":"Monitoring modules"},{"location":"basic/Reference/Module/#zabbix","text":"zabbix_action \u2013 Create/Delete/Update Zabbix actions zabbix_group \u2013 Create/delete Zabbix host groups zabbix_group_info \u2013 Gather information about Zabbix hostgroup zabbix_host \u2013 Create/update/delete Zabbix hosts zabbix_host_info \u2013 Gather information about Zabbix host zabbix_hostmacro \u2013 Create/update/delete Zabbix host macros zabbix_maintenance \u2013 Create Zabbix maintenance windows zabbix_map \u2013 Create/update/delete Zabbix maps zabbix_mediatype \u2013 Create/Update/Delete Zabbix media types zabbix_proxy \u2013 Create/delete/get/update Zabbix proxies zabbix_screen \u2013 Create/update/delete Zabbix screens zabbix_template \u2013 Create/update/delete/dump Zabbix template","title":"Zabbix"},{"location":"basic/Reference/Module/#net-tools-modules","text":"cloudflare_dns \u2013 Manage Cloudflare DNS records dnsimple \u2013 Interface with dnsimple.com (a DNS hosting service) dnsmadeeasy \u2013 Interface with dnsmadeeasy.com (a DNS hosting service) haproxy \u2013 Enable, disable, and set weights for HAProxy backend servers using socket commands hetzner_failover_ip \u2013 Manage Hetzner\u2019s failover IPs hetzner_failover_ip_info \u2013 Retrieve information on Hetzner\u2019s failover IPs ip_netns \u2013 Manage network namespaces ipify_facts \u2013 Retrieve the public IP of your internet gateway ipinfoio_facts \u2013 Retrieve IP geolocation facts of a host\u2019s IP address lldp \u2013 get details reported by lldp netcup_dns \u2013 manage Netcup DNS records nmcli \u2013 Manage Networking nsupdate \u2013 Manage DNS records omapi_host \u2013 Setup OMAPI hosts snmp_facts \u2013 Retrieve facts for a device using SNMP","title":"Net Tools modules"},{"location":"basic/Reference/Module/#basics","text":"get_url \u2013 Downloads files from HTTP, HTTPS, or FTP to node slurp \u2013 Slurps a file from remote nodes uri \u2013 Interacts with webservices","title":"Basics"},{"location":"basic/Reference/Module/#exoscale","text":"exo_dns_domain \u2013 Manages domain records on Exoscale DNS API exo_dns_record \u2013 Manages DNS records on Exoscale DNS","title":"Exoscale"},{"location":"basic/Reference/Module/#infinity","text":"infinity \u2013 Manage Infinity IPAM using Rest API","title":"Infinity"},{"location":"basic/Reference/Module/#ldap","text":"ldap_attr \u2013 Add or remove LDAP attribute values ldap_entry \u2013 Add or remove LDAP entries ldap_passwd \u2013 Set passwords in LDAP","title":"Ldap"},{"location":"basic/Reference/Module/#netbox","text":"netbox_device \u2013 Create, update or delete devices within Netbox netbox_interface \u2013 Creates or removes interfaces from Netbox netbox_ip_address \u2013 Creates or removes IP addresses from Netbox netbox_prefix \u2013 Creates or removes prefixes from Netbox netbox_site \u2013 Creates or removes sites from Netbox","title":"Netbox"},{"location":"basic/Reference/Module/#nios","text":"nios_a_record \u2013 Configure Infoblox NIOS A records nios_aaaa_record \u2013 Configure Infoblox NIOS AAAA records nios_cname_record \u2013 Configure Infoblox NIOS CNAME records nios_dns_view \u2013 Configure Infoblox NIOS DNS views nios_fixed_address \u2013 Configure Infoblox NIOS DHCP Fixed Address nios_host_record \u2013 Configure Infoblox NIOS host records nios_member \u2013 Configure Infoblox NIOS members nios_mx_record \u2013 Configure Infoblox NIOS MX records nios_naptr_record \u2013 Configure Infoblox NIOS NAPTR records nios_network \u2013 Configure Infoblox NIOS network object nios_network_view \u2013 Configure Infoblox NIOS network views nios_nsgroup \u2013 Configure InfoBlox DNS Nameserver Groups nios_ptr_record \u2013 Configure Infoblox NIOS PTR records nios_srv_record \u2013 Configure Infoblox NIOS SRV records nios_txt_record \u2013 Configure Infoblox NIOS txt records nios_zone \u2013 Configure Infoblox NIOS DNS zones","title":"Nios"},{"location":"basic/Reference/Module/#network-modules","text":"","title":"Network modules"},{"location":"basic/Reference/Module/#a10","text":"a10_server \u2013 Manage A10 Networks AX/SoftAX/Thunder/vThunder devices\u2019 server object a10_server_axapi3 \u2013 Manage A10 Networks AX/SoftAX/Thunder/vThunder devices a10_service_group \u2013 Manage A10 Networks AX/SoftAX/Thunder/vThunder devices\u2019 service groups a10_virtual_server \u2013 Manage A10 Networks AX/SoftAX/Thunder/vThunder devices\u2019 virtual servers","title":"A10"},{"location":"basic/Reference/Module/#aci","text":"aci_aaa_user \u2013 Manage AAA users (aaa:User) aci_aaa_user_certificate \u2013 Manage AAA user certificates (aaa:UserCert) aci_access_port_block_to_access_port \u2013 Manage port blocks of Fabric interface policy leaf profile interface selectors (infra:HPortS, infra:PortBlk) aci_access_port_to_interface_policy_leaf_profile \u2013 Manage Fabric interface policy leaf profile interface selectors (infra:HPortS, infra:RsAccBaseGrp, infra:PortBlk) aci_access_sub_port_block_to_access_port \u2013 Manage sub port blocks of Fabric interface policy leaf profile interface selectors (infra:HPortS, infra:SubPortBlk) aci_aep \u2013 Manage attachable Access Entity Profile (AEP) objects (infra:AttEntityP, infra:ProvAcc) aci_aep_to_domain \u2013 Bind AEPs to Physical or Virtual Domains (infra:RsDomP) aci_ap \u2013 Manage top level Application Profile (AP) objects (fv:Ap) aci_bd \u2013 Manage Bridge Domains (BD) objects (fv:BD) aci_bd_subnet \u2013 Manage Subnets (fv:Subnet) aci_bd_to_l3out \u2013 Bind Bridge Domain to L3 Out (fv:RsBDToOut) aci_config_rollback \u2013 Provides rollback and rollback preview functionality (config:ImportP) aci_config_snapshot \u2013 Manage Config Snapshots (config:Snapshot, config:ExportP) aci_contract \u2013 Manage contract resources (vz:BrCP) aci_contract_subject \u2013 Manage initial Contract Subjects (vz:Subj) aci_contract_subject_to_filter \u2013 Bind Contract Subjects to Filters (vz:RsSubjFiltAtt) aci_domain \u2013 Manage physical, virtual, bridged, routed or FC domain profiles (phys:DomP, vmm:DomP, l2ext:DomP, l3ext:DomP, fc:DomP) aci_domain_to_encap_pool \u2013 Bind Domain to Encap Pools (infra:RsVlanNs) aci_domain_to_vlan_pool \u2013 Bind Domain to VLAN Pools (infra:RsVlanNs) aci_encap_pool \u2013 Manage encap pools (fvns:VlanInstP, fvns:VxlanInstP, fvns:VsanInstP) aci_encap_pool_range \u2013 Manage encap ranges assigned to pools (fvns:EncapBlk, fvns:VsanEncapBlk) aci_epg \u2013 Manage End Point Groups (EPG) objects (fv:AEPg) aci_epg_monitoring_policy \u2013 Manage monitoring policies (mon:EPGPol) aci_epg_to_contract \u2013 Bind EPGs to Contracts (fv:RsCons, fv:RsProv) aci_epg_to_domain \u2013 Bind EPGs to Domains (fv:RsDomAtt) aci_fabric_node \u2013 Manage Fabric Node Members (fabric:NodeIdentP) aci_fabric_scheduler \u2013 This modules creates ACI schedulers aci_filter \u2013 Manages top level filter objects (vz:Filter) aci_filter_entry \u2013 Manage filter entries (vz:Entry) aci_firmware_group \u2013 This module creates a firmware group aci_firmware_group_node \u2013 This modules adds and remove nodes from the firmware group aci_firmware_policy \u2013 This creates a firmware policy aci_firmware_source \u2013 Manage firmware image sources (firmware:OSource) aci_interface_policy_cdp \u2013 Manage CDP interface policies (cdp:IfPol) aci_interface_policy_fc \u2013 Manage Fibre Channel interface policies (fc:IfPol) aci_interface_policy_l2 \u2013 Manage Layer 2 interface policies (l2:IfPol) aci_interface_policy_leaf_policy_group \u2013 Manage fabric interface policy leaf policy groups (infra:AccBndlGrp, infra:AccPortGrp) aci_interface_policy_leaf_profile \u2013 Manage fabric interface policy leaf profiles (infra:AccPortP) aci_interface_policy_lldp \u2013 Manage LLDP interface policies (lldp:IfPol) aci_interface_policy_mcp \u2013 Manage MCP interface policies (mcp:IfPol) aci_interface_policy_ospf \u2013 Manage OSPF interface policies (ospf:IfPol) aci_interface_policy_port_channel \u2013 Manage port channel interface policies (lacp:LagPol) aci_interface_policy_port_security \u2013 Manage port security (l2:PortSecurityPol) aci_interface_selector_to_switch_policy_leaf_profile \u2013 Bind interface selector profiles to switch policy leaf profiles (infra:RsAccPortP) aci_l3out \u2013 Manage Layer 3 Outside (L3Out) objects (l3ext:Out) aci_l3out_extepg \u2013 Manage External Network Instance Profile (ExtEpg) objects (l3extInstP:instP) aci_l3out_extsubnet \u2013 Manage External Subnet objects (l3extSubnet:extsubnet) aci_l3out_route_tag_policy \u2013 Manage route tag policies (l3ext:RouteTagPol) aci_maintenance_group \u2013 This creates an ACI maintenance group aci_maintenance_group_node \u2013 Manage maintenance group nodes aci_maintenance_policy \u2013 Manage firmware maintenance policies aci_rest \u2013 Direct access to the Cisco APIC REST API aci_static_binding_to_epg \u2013 Bind static paths to EPGs (fv:RsPathAtt) aci_switch_leaf_selector \u2013 Bind leaf selectors to switch policy leaf profiles (infra:LeafS, infra:NodeBlk, infra:RsAccNodePGrep) aci_switch_policy_leaf_profile \u2013 Manage switch policy leaf profiles (infra:NodeP) aci_switch_policy_vpc_protection_group \u2013 Manage switch policy explicit vPC protection groups (fabric:ExplicitGEp, fabric:NodePEp) aci_taboo_contract \u2013 Manage taboo contracts (vz:BrCP) aci_tenant \u2013 Manage tenants (fv:Tenant) aci_tenant_action_rule_profile \u2013 Manage action rule profiles (rtctrl:AttrP) aci_tenant_ep_retention_policy \u2013 Manage End Point (EP) retention protocol policies (fv:EpRetPol) aci_tenant_span_dst_group \u2013 Manage SPAN destination groups (span:DestGrp) aci_tenant_span_src_group \u2013 Manage SPAN source groups (span:SrcGrp) aci_tenant_span_src_group_to_dst_group \u2013 Bind SPAN source groups to destination groups (span:SpanLbl) aci_vlan_pool \u2013 Manage VLAN pools (fvns:VlanInstP) aci_vlan_pool_encap_block \u2013 Manage encap blocks assigned to VLAN pools (fvns:EncapBlk) aci_vmm_credential \u2013 Manage virtual domain credential profiles (vmm:UsrAccP) aci_vrf \u2013 Manage contexts or VRFs (fv:Ctx) mso_label \u2013 Manage labels mso_role \u2013 Manage roles mso_schema \u2013 Manage schemas mso_schema_site \u2013 Manage sites in schemas mso_schema_site_anp \u2013 Manage site-local Application Network Profiles (ANPs) in schema template mso_schema_site_anp_epg \u2013 Manage site-local Endpoint Groups (EPGs) in schema template mso_schema_site_anp_epg_domain \u2013 Manage site-local EPG domains in schema template mso_schema_site_anp_epg_staticleaf \u2013 Manage site-local EPG static leafs in schema template mso_schema_site_anp_epg_staticport \u2013 Manage site-local EPG static ports in schema template mso_schema_site_anp_epg_subnet \u2013 Manage site-local EPG subnets in schema template mso_schema_site_bd \u2013 Manage site-local Bridge Domains (BDs) in schema template mso_schema_site_bd_l3out \u2013 Manage site-local BD l3out\u2019s in schema template mso_schema_site_bd_subnet \u2013 Manage site-local BD subnets in schema template mso_schema_site_vrf \u2013 Manage site-local VRFs in schema template mso_schema_site_vrf_region \u2013 Manage site-local VRF regions in schema template mso_schema_site_vrf_region_cidr \u2013 Manage site-local VRF region CIDRs in schema template mso_schema_site_vrf_region_cidr_subnet \u2013 Manage site-local VRF regions in schema template mso_schema_template \u2013 Manage templates in schemas mso_schema_template_anp \u2013 Manage Application Network Profiles (ANPs) in schema templates mso_schema_template_anp_epg \u2013 Manage Endpoint Groups (EPGs) in schema templates mso_schema_template_anp_epg_contract \u2013 Manage EPG contracts in schema templates mso_schema_template_anp_epg_subnet \u2013 Manage EPG subnets in schema templates mso_schema_template_bd \u2013 Manage Bridge Domains (BDs) in schema templates mso_schema_template_bd_subnet \u2013 Manage BD subnets in schema templates mso_schema_template_contract_filter \u2013 Manage contract filters in schema templates mso_schema_template_deploy \u2013 Deploy schema templates to sites mso_schema_template_externalepg \u2013 Manage external EPGs in schema templates mso_schema_template_filter_entry \u2013 Manage filter entries in schema templates mso_schema_template_l3out \u2013 Manage l3outs in schema templates mso_schema_template_vrf \u2013 Manage VRFs in schema templates mso_site \u2013 Manage sites mso_tenant \u2013 Manage tenants mso_user \u2013 Manage users","title":"Aci"},{"location":"basic/Reference/Module/#aireos","text":"aireos_command \u2013 Run commands on remote devices running Cisco WLC aireos_config \u2013 Manage Cisco WLC configurations","title":"Aireos"},{"location":"basic/Reference/Module/#aruba","text":"aruba_command \u2013 Run commands on remote devices running Aruba Mobility Controller aruba_config \u2013 Manage Aruba configuration sections","title":"Aruba"},{"location":"basic/Reference/Module/#asa","text":"asa_acl \u2013 Manage access-lists on a Cisco ASA asa_command \u2013 Run arbitrary commands on Cisco ASA devices asa_config \u2013 Manage configuration sections on Cisco ASA devices asa_og \u2013 Manage object groups on a Cisco ASA","title":"Asa"},{"location":"basic/Reference/Module/#avi","text":"avi_actiongroupconfig \u2013 Module for setup of ActionGroupConfig Avi RESTful Object avi_alertconfig \u2013 Module for setup of AlertConfig Avi RESTful Object avi_alertemailconfig \u2013 Module for setup of AlertEmailConfig Avi RESTful Object avi_alertscriptconfig \u2013 Module for setup of AlertScriptConfig Avi RESTful Object avi_alertsyslogconfig \u2013 Module for setup of AlertSyslogConfig Avi RESTful Object avi_analyticsprofile \u2013 Module for setup of AnalyticsProfile Avi RESTful Object avi_api_session \u2013 Avi API Module avi_api_version \u2013 Avi API Version Module avi_applicationpersistenceprofile \u2013 Module for setup of ApplicationPersistenceProfile Avi RESTful Object avi_applicationprofile \u2013 Module for setup of ApplicationProfile Avi RESTful Object avi_authprofile \u2013 Module for setup of AuthProfile Avi RESTful Object avi_autoscalelaunchconfig \u2013 Module for setup of AutoScaleLaunchConfig Avi RESTful Object avi_backup \u2013 Module for setup of Backup Avi RESTful Object avi_backupconfiguration \u2013 Module for setup of BackupConfiguration Avi RESTful Object avi_certificatemanagementprofile \u2013 Module for setup of CertificateManagementProfile Avi RESTful Object avi_cloud \u2013 Module for setup of Cloud Avi RESTful Object avi_cloudconnectoruser \u2013 Module for setup of CloudConnectorUser Avi RESTful Object avi_cloudproperties \u2013 Module for setup of CloudProperties Avi RESTful Object avi_cluster \u2013 Module for setup of Cluster Avi RESTful Object avi_clusterclouddetails \u2013 Module for setup of ClusterCloudDetails Avi RESTful Object avi_controllerproperties \u2013 Module for setup of ControllerProperties Avi RESTful Object avi_customipamdnsprofile \u2013 Module for setup of CustomIpamDnsProfile Avi RESTful Object avi_dnspolicy \u2013 Module for setup of DnsPolicy Avi RESTful Object avi_errorpagebody \u2013 Module for setup of ErrorPageBody Avi RESTful Object avi_errorpageprofile \u2013 Module for setup of ErrorPageProfile Avi RESTful Object avi_gslb \u2013 Module for setup of Gslb Avi RESTful Object avi_gslbgeodbprofile \u2013 Module for setup of GslbGeoDbProfile Avi RESTful Object avi_gslbservice \u2013 Module for setup of GslbService Avi RESTful Object avi_gslbservice_patch_member \u2013 Avi API Module avi_hardwaresecuritymodulegroup \u2013 Module for setup of HardwareSecurityModuleGroup Avi RESTful Object avi_healthmonitor \u2013 Module for setup of HealthMonitor Avi RESTful Object avi_httppolicyset \u2013 Module for setup of HTTPPolicySet Avi RESTful Object avi_ipaddrgroup \u2013 Module for setup of IpAddrGroup Avi RESTful Object avi_ipamdnsproviderprofile \u2013 Module for setup of IpamDnsProviderProfile Avi RESTful Object avi_l4policyset \u2013 Module for setup of L4PolicySet Avi RESTful Object avi_microservicegroup \u2013 Module for setup of MicroServiceGroup Avi RESTful Object avi_network \u2013 Module for setup of Network Avi RESTful Object avi_networkprofile \u2013 Module for setup of NetworkProfile Avi RESTful Object avi_networksecuritypolicy \u2013 Module for setup of NetworkSecurityPolicy Avi RESTful Object avi_pkiprofile \u2013 Module for setup of PKIProfile Avi RESTful Object avi_pool \u2013 Module for setup of Pool Avi RESTful Object avi_poolgroup \u2013 Module for setup of PoolGroup Avi RESTful Object avi_poolgroupdeploymentpolicy \u2013 Module for setup of PoolGroupDeploymentPolicy Avi RESTful Object avi_prioritylabels \u2013 Module for setup of PriorityLabels Avi RESTful Object avi_role \u2013 Module for setup of Role Avi RESTful Object avi_scheduler \u2013 Module for setup of Scheduler Avi RESTful Object avi_seproperties \u2013 Module for setup of SeProperties Avi RESTful Object avi_serverautoscalepolicy \u2013 Module for setup of ServerAutoScalePolicy Avi RESTful Object avi_serviceengine \u2013 Module for setup of ServiceEngine Avi RESTful Object avi_serviceenginegroup \u2013 Module for setup of ServiceEngineGroup Avi RESTful Object avi_snmptrapprofile \u2013 Module for setup of SnmpTrapProfile Avi RESTful Object avi_sslkeyandcertificate \u2013 Module for setup of SSLKeyAndCertificate Avi RESTful Object avi_sslprofile \u2013 Module for setup of SSLProfile Avi RESTful Object avi_stringgroup \u2013 Module for setup of StringGroup Avi RESTful Object avi_systemconfiguration \u2013 Module for setup of SystemConfiguration Avi RESTful Object avi_tenant \u2013 Module for setup of Tenant Avi RESTful Object avi_trafficcloneprofile \u2013 Module for setup of TrafficCloneProfile Avi RESTful Object avi_user \u2013 Avi User Module avi_useraccount \u2013 Avi UserAccount Module avi_useraccountprofile \u2013 Module for setup of UserAccountProfile Avi RESTful Object avi_virtualservice \u2013 Module for setup of VirtualService Avi RESTful Object avi_vrfcontext \u2013 Module for setup of VrfContext Avi RESTful Object avi_vsdatascriptset \u2013 Module for setup of VSDataScriptSet Avi RESTful Object avi_vsvip \u2013 Module for setup of VsVip Avi RESTful Object avi_webhook \u2013 Module for setup of Webhook Avi RESTful Object","title":"Avi"},{"location":"basic/Reference/Module/#bigswitch","text":"bcf_switch \u2013 Create and remove a bcf switch bigmon_chain \u2013 Create and remove a bigmon inline service chain bigmon_policy \u2013 Create and remove a bigmon out-of-band policy","title":"Bigswitch"},{"location":"basic/Reference/Module/#check_point","text":"checkpoint_access_layer_facts \u2013 Get access layer facts on Check Point over Web Services API checkpoint_access_rule \u2013 Manages access rules on Check Point over Web Services API checkpoint_access_rule_facts \u2013 Get access rules objects facts on Check Point over Web Services API checkpoint_host \u2013 Manages host objects on Check Point over Web Services API checkpoint_host_facts \u2013 Get host objects facts on Check Point over Web Services API checkpoint_object_facts \u2013 Get object facts on Check Point over Web Services API checkpoint_run_script \u2013 Run scripts on Check Point devices over Web Services API checkpoint_session \u2013 Manages session objects on Check Point over Web Services API checkpoint_task_facts \u2013 Get task objects facts on Check Point over Web Services API cp_mgmt_access_layer \u2013 Manages access-layer objects on Check Point over Web Services API cp_mgmt_access_layer_facts \u2013 Get access-layer objects facts on Check Point over Web Services API cp_mgmt_access_role \u2013 Manages access-role objects on Check Point over Web Services API cp_mgmt_access_role_facts \u2013 Get access-role objects facts on Check Point over Web Services API cp_mgmt_access_rule \u2013 Manages access-rule objects on Check Point over Web Services API cp_mgmt_access_rule_facts \u2013 Get access-rule objects facts on Check Point over Web Services API cp_mgmt_address_range \u2013 Manages address-range objects on Check Point over Web Services API cp_mgmt_address_range_facts \u2013 Get address-range objects facts on Check Point over Web Services API cp_mgmt_administrator \u2013 Manages administrator objects on Check Point over Web Services API cp_mgmt_administrator_facts \u2013 Get administrator objects facts on Check Point over Web Services API cp_mgmt_application_site \u2013 Manages application-site objects on Check Point over Web Services API cp_mgmt_application_site_category \u2013 Manages application-site-category objects on Check Point over Web Services API cp_mgmt_application_site_category_facts \u2013 Get application-site-category objects facts on Check Point over Web Services API cp_mgmt_application_site_facts \u2013 Get application-site objects facts on Check Point over Web Services API cp_mgmt_application_site_group \u2013 Manages application-site-group objects on Check Point over Web Services API cp_mgmt_application_site_group_facts \u2013 Get application-site-group objects facts on Check Point over Web Services API cp_mgmt_assign_global_assignment \u2013 assign global assignment on Check Point over Web Services API cp_mgmt_discard \u2013 All changes done by user are discarded and removed from database cp_mgmt_dns_domain \u2013 Manages dns-domain objects on Check Point over Web Services API cp_mgmt_dns_domain_facts \u2013 Get dns-domain objects facts on Check Point over Web Services API cp_mgmt_dynamic_object \u2013 Manages dynamic-object objects on Check Point over Web Services API cp_mgmt_dynamic_object_facts \u2013 Get dynamic-object objects facts on Check Point over Web Services API cp_mgmt_exception_group \u2013 Manages exception-group objects on Check Point over Web Services API cp_mgmt_exception_group_facts \u2013 Get exception-group objects facts on Check Point over Web Services API cp_mgmt_global_assignment \u2013 Manages global-assignment objects on Check Point over Web Services API cp_mgmt_global_assignment_facts \u2013 Get global-assignment objects facts on Check Point over Web Services API cp_mgmt_group \u2013 Manages group objects on Check Point over Web Services API cp_mgmt_group_facts \u2013 Get group objects facts on Check Point over Web Services API cp_mgmt_group_with_exclusion \u2013 Manages group-with-exclusion objects on Check Point over Web Services API cp_mgmt_group_with_exclusion_facts \u2013 Get group-with-exclusion objects facts on Check Point over Web Services API cp_mgmt_host \u2013 Manages host objects on Check Point over Web Services API cp_mgmt_host_facts \u2013 Get host objects facts on Check Point over Web Services API cp_mgmt_install_policy \u2013 install policy on Check Point over Web Services API cp_mgmt_mds_facts \u2013 Get Multi-Domain Server (mds) objects facts on Check Point over Web Services API cp_mgmt_multicast_address_range \u2013 Manages multicast-address-range objects on Check Point over Web Services API cp_mgmt_multicast_address_range_facts \u2013 Get multicast-address-range objects facts on Check Point over Web Services API cp_mgmt_network \u2013 Manages network objects on Check Point over Web Services API cp_mgmt_network_facts \u2013 Get network objects facts on Check Point over Web Services API cp_mgmt_package \u2013 Manages package objects on Check Point over Web Services API cp_mgmt_package_facts \u2013 Get package objects facts on Check Point over Web Services API cp_mgmt_publish \u2013 All the changes done by this user will be seen by all users only after publish is called cp_mgmt_put_file \u2013 put file on Check Point over Web Services API cp_mgmt_run_ips_update \u2013 Runs IPS database update. If \u201cpackage-path\u201d is not provided server will try to get the latest package from the User Center cp_mgmt_run_script \u2013 Executes the script on a given list of targets cp_mgmt_security_zone \u2013 Manages security-zone objects on Check Point over Web Services API cp_mgmt_security_zone_facts \u2013 Get security-zone objects facts on Check Point over Web Services API cp_mgmt_service_dce_rpc \u2013 Manages service-dce-rpc objects on Check Point over Web Services API cp_mgmt_service_dce_rpc_facts \u2013 Get service-dce-rpc objects facts on Check Point over Web Services API cp_mgmt_service_group \u2013 Manages service-group objects on Check Point over Web Services API cp_mgmt_service_group_facts \u2013 Get service-group objects facts on Check Point over Web Services API cp_mgmt_service_icmp \u2013 Manages service-icmp objects on Check Point over Web Services API cp_mgmt_service_icmp6 \u2013 Manages service-icmp6 objects on Check Point over Web Services API cp_mgmt_service_icmp6_facts \u2013 Get service-icmp6 objects facts on Check Point over Web Services API cp_mgmt_service_icmp_facts \u2013 Get service-icmp objects facts on Check Point over Web Services API cp_mgmt_service_other \u2013 Manages service-other objects on Check Point over Web Services API cp_mgmt_service_other_facts \u2013 Get service-other objects facts on Check Point over Web Services API cp_mgmt_service_rpc \u2013 Manages service-rpc objects on Check Point over Web Services API cp_mgmt_service_rpc_facts \u2013 Get service-rpc objects facts on Check Point over Web Services API cp_mgmt_service_sctp \u2013 Manages service-sctp objects on Check Point over Web Services API cp_mgmt_service_sctp_facts \u2013 Get service-sctp objects facts on Check Point over Web Services API cp_mgmt_service_tcp \u2013 Manages service-tcp objects on Check Point over Web Services API cp_mgmt_service_tcp_facts \u2013 Get service-tcp objects facts on Check Point over Web Services API cp_mgmt_service_udp \u2013 Manages service-udp objects on Check Point over Web Services API cp_mgmt_service_udp_facts \u2013 Get service-udp objects facts on Check Point over Web Services API cp_mgmt_session_facts \u2013 Get session objects facts on Check Point over Web Services API cp_mgmt_simple_gateway \u2013 Manages simple-gateway objects on Check Point over Web Services API cp_mgmt_simple_gateway_facts \u2013 Get simple-gateway objects facts on Check Point over Web Services API cp_mgmt_tag \u2013 Manages tag objects on Check Point over Web Services API cp_mgmt_tag_facts \u2013 Get tag objects facts on Check Point over Web Services API cp_mgmt_threat_exception \u2013 Manages threat-exception objects on Check Point over Web Services API cp_mgmt_threat_exception_facts \u2013 Get threat-exception objects facts on Check Point over Web Services API cp_mgmt_threat_indicator \u2013 Manages threat-indicator objects on Check Point over Web Services API cp_mgmt_threat_indicator_facts \u2013 Get threat-indicator objects facts on Check Point over Web Services API cp_mgmt_threat_layer \u2013 Manages threat-layer objects on Check Point over Web Services API cp_mgmt_threat_layer_facts \u2013 Get threat-layer objects facts on Check Point over Web Services API cp_mgmt_threat_profile \u2013 Manages threat-profile objects on Check Point over Web Services API cp_mgmt_threat_profile_facts \u2013 Get threat-profile objects facts on Check Point over Web Services API cp_mgmt_threat_protection_override \u2013 Edit existing object using object name or uid cp_mgmt_threat_rule \u2013 Manages threat-rule objects on Check Point over Web Services API cp_mgmt_threat_rule_facts \u2013 Get threat-rule objects facts on Check Point over Web Services API cp_mgmt_time \u2013 Manages time objects on Check Point over Web Services API cp_mgmt_time_facts \u2013 Get time objects facts on Check Point over Web Services API cp_mgmt_verify_policy \u2013 Verifies the policy of the selected package cp_mgmt_vpn_community_meshed \u2013 Manages vpn-community-meshed objects on Check Point over Web Services API cp_mgmt_vpn_community_meshed_facts \u2013 Get vpn-community-meshed objects facts on Check Point over Web Services API cp_mgmt_vpn_community_star \u2013 Manages vpn-community-star objects on Check Point over Web Services API cp_mgmt_vpn_community_star_facts \u2013 Get vpn-community-star objects facts on Check Point over Web Services API cp_mgmt_wildcard \u2013 Manages wildcard objects on Check Point over Web Services API cp_mgmt_wildcard_facts \u2013 Get wildcard objects facts on Check Point over Web Services API cp_publish \u2013 All the changes done by this user will be seen by all users only after publish is called","title":"Check_Point"},{"location":"basic/Reference/Module/#cli","text":"cli_command \u2013 Run a cli command on cli-based network devices cli_config \u2013 Push text based configuration to network devices over network_cli","title":"Cli"},{"location":"basic/Reference/Module/#cloudengine","text":"ce_aaa_server \u2013 Manages AAA server global configuration on HUAWEI CloudEngine switches ce_aaa_server_host \u2013 Manages AAA server host configuration on HUAWEI CloudEngine switches ce_acl \u2013 Manages base ACL configuration on HUAWEI CloudEngine switches ce_acl_advance \u2013 Manages advanced ACL configuration on HUAWEI CloudEngine switches ce_acl_interface \u2013 Manages applying ACLs to interfaces on HUAWEI CloudEngine switches ce_bfd_global \u2013 Manages BFD global configuration on HUAWEI CloudEngine devices ce_bfd_session \u2013 Manages BFD session configuration on HUAWEI CloudEngine devices ce_bfd_view \u2013 Manages BFD session view configuration on HUAWEI CloudEngine devices ce_bgp \u2013 Manages BGP configuration on HUAWEI CloudEngine switches ce_bgp_af \u2013 Manages BGP Address-family configuration on HUAWEI CloudEngine switches ce_bgp_neighbor \u2013 Manages BGP peer configuration on HUAWEI CloudEngine switches ce_bgp_neighbor_af \u2013 Manages BGP neighbor Address-family configuration on HUAWEI CloudEngine switches ce_command \u2013 Run arbitrary command on HUAWEI CloudEngine devices ce_config \u2013 Manage Huawei CloudEngine configuration sections ce_dldp \u2013 Manages global DLDP configuration on HUAWEI CloudEngine switches ce_dldp_interface \u2013 Manages interface DLDP configuration on HUAWEI CloudEngine switches ce_eth_trunk \u2013 Manages Eth-Trunk interfaces on HUAWEI CloudEngine switches ce_evpn_bd_vni \u2013 Manages EVPN VXLAN Network Identifier (VNI) on HUAWEI CloudEngine switches ce_evpn_bgp \u2013 Manages BGP EVPN configuration on HUAWEI CloudEngine switches ce_evpn_bgp_rr \u2013 Manages RR for the VXLAN Network on HUAWEI CloudEngine switches ce_evpn_global \u2013 Manages global configuration of EVPN on HUAWEI CloudEngine switches ce_facts \u2013 Gets facts about HUAWEI CloudEngine switches ce_file_copy \u2013 Copy a file to a remote cloudengine device over SCP on HUAWEI CloudEngine switches ce_info_center_debug \u2013 Manages information center debug configuration on HUAWEI CloudEngine switches ce_info_center_global \u2013 Manages outputting logs on HUAWEI CloudEngine switches ce_info_center_log \u2013 Manages information center log configuration on HUAWEI CloudEngine switches ce_info_center_trap \u2013 Manages information center trap configuration on HUAWEI CloudEngine switches ce_interface \u2013 Manages physical attributes of interfaces on HUAWEI CloudEngine switches ce_interface_ospf \u2013 Manages configuration of an OSPF interface instanceon HUAWEI CloudEngine switches ce_ip_interface \u2013 Manages L3 attributes for IPv4 and IPv6 interfaces on HUAWEI CloudEngine switches ce_link_status \u2013 Get interface link status on HUAWEI CloudEngine switches ce_mlag_config \u2013 Manages MLAG configuration on HUAWEI CloudEngine switches ce_mlag_interface \u2013 Manages MLAG interfaces on HUAWEI CloudEngine switches ce_mtu \u2013 Manages MTU settings on HUAWEI CloudEngine switches ce_netconf \u2013 Run an arbitrary netconf command on HUAWEI CloudEngine switches ce_netstream_aging \u2013 Manages timeout mode of NetStream on HUAWEI CloudEngine switches ce_netstream_export \u2013 Manages netstream export on HUAWEI CloudEngine switches ce_netstream_global \u2013 Manages global parameters of NetStream on HUAWEI CloudEngine switches ce_netstream_template \u2013 Manages NetStream template configuration on HUAWEI CloudEngine switches ce_ntp \u2013 Manages core NTP configuration on HUAWEI CloudEngine switches ce_ntp_auth \u2013 Manages NTP authentication configuration on HUAWEI CloudEngine switches ce_ospf \u2013 Manages configuration of an OSPF instance on HUAWEI CloudEngine switches ce_ospf_vrf \u2013 Manages configuration of an OSPF VPN instance on HUAWEI CloudEngine switches ce_reboot \u2013 Reboot a HUAWEI CloudEngine switches ce_rollback \u2013 Set a checkpoint or rollback to a checkpoint on HUAWEI CloudEngine switches ce_sflow \u2013 Manages sFlow configuration on HUAWEI CloudEngine switches ce_snmp_community \u2013 Manages SNMP community configuration on HUAWEI CloudEngine switches ce_snmp_contact \u2013 Manages SNMP contact configuration on HUAWEI CloudEngine switches ce_snmp_location \u2013 Manages SNMP location configuration on HUAWEI CloudEngine switches ce_snmp_target_host \u2013 Manages SNMP target host configuration on HUAWEI CloudEngine switches ce_snmp_traps \u2013 Manages SNMP traps configuration on HUAWEI CloudEngine switches ce_snmp_user \u2013 Manages SNMP user configuration on HUAWEI CloudEngine switches ce_startup \u2013 Manages a system startup information on HUAWEI CloudEngine switches ce_static_route \u2013 Manages static route configuration on HUAWEI CloudEngine switches ce_stp \u2013 Manages STP configuration on HUAWEI CloudEngine switches ce_switchport \u2013 Manages Layer 2 switchport interfaces on HUAWEI CloudEngine switches ce_vlan \u2013 Manages VLAN resources and attributes on Huawei CloudEngine switches ce_vrf \u2013 Manages VPN instance on HUAWEI CloudEngine switches ce_vrf_af \u2013 Manages VPN instance address family on HUAWEI CloudEngine switches ce_vrf_interface \u2013 Manages interface specific VPN configuration on HUAWEI CloudEngine switches ce_vrrp \u2013 Manages VRRP interfaces on HUAWEI CloudEngine devices ce_vxlan_arp \u2013 Manages ARP attributes of VXLAN on HUAWEI CloudEngine devices ce_vxlan_gateway \u2013 Manages gateway for the VXLAN network on HUAWEI CloudEngine devices ce_vxlan_global \u2013 Manages global attributes of VXLAN and bridge domain on HUAWEI CloudEngine devices ce_vxlan_tunnel \u2013 Manages VXLAN tunnel configuration on HUAWEI CloudEngine devices ce_vxlan_vap \u2013 Manages VXLAN virtual access point on HUAWEI CloudEngine Devices","title":"Cloudengine"},{"location":"basic/Reference/Module/#cloudvision","text":"cv_server_provision \u2013 Provision server port by applying or removing template configuration to an Arista CloudVision Portal configlet that is applied to a switch","title":"Cloudvision"},{"location":"basic/Reference/Module/#cnos","text":"cnos_backup \u2013 Backup the current running or startup configuration to a remote server on devices running Lenovo CNOS cnos_banner \u2013 Manage multiline banners on Lenovo CNOS devices cnos_bgp \u2013 Manage BGP resources and attributes on devices running CNOS cnos_command \u2013 Run arbitrary commands on Lenovo CNOS devices cnos_conditional_command \u2013 Execute a single command based on condition on devices running Lenovo CNOS cnos_conditional_template \u2013 Manage switch configuration using templates based on condition on devices running Lenovo CNOS cnos_config \u2013 Manage Lenovo CNOS configuration sections cnos_factory \u2013 Reset the switch startup configuration to default (factory) on devices running Lenovo CNOS cnos_facts \u2013 Collect facts from remote devices running Lenovo CNOS cnos_image \u2013 Perform firmware upgrade/download from a remote server on devices running Lenovo CNOS cnos_interface \u2013 Manage Interface on Lenovo CNOS network devices cnos_l2_interface \u2013 Manage Layer-2 interface on Lenovo CNOS devices cnos_l3_interface \u2013 Manage Layer-3 interfaces on Lenovo CNOS network devices cnos_linkagg \u2013 Manage link aggregation groups on Lenovo CNOS devices cnos_lldp \u2013 Manage LLDP configuration on Lenovo CNOS network devices cnos_logging \u2013 Manage logging on network devices cnos_reload \u2013 Perform switch restart on devices running Lenovo CNOS cnos_rollback \u2013 Roll back the running or startup configuration from a remote server on devices running Lenovo CNOS cnos_save \u2013 Save the running configuration as the startup configuration on devices running Lenovo CNOS cnos_showrun \u2013 Collect the current running configuration on devices running on CNOS cnos_static_route \u2013 Manage static IP routes on Lenovo CNOS network devices cnos_system \u2013 Manage the system attributes on Lenovo CNOS devices cnos_template \u2013 Manage switch configuration using templates on devices running Lenovo CNOS cnos_user \u2013 Manage the collection of local users on Lenovo CNOS devices cnos_vlag \u2013 Manage VLAG resources and attributes on devices running Lenovo CNOS cnos_vlan \u2013 Manage VLANs on CNOS network devices cnos_vrf \u2013 Manage VRFs on Lenovo CNOS network devices","title":"Cnos"},{"location":"basic/Reference/Module/#cumulus","text":"nclu \u2013 Configure network interfaces using NCLU","title":"Cumulus"},{"location":"basic/Reference/Module/#dellos10","text":"dellos10_command \u2013 Run commands on remote devices running Dell OS10 dellos10_config \u2013 Manage Dell EMC Networking OS10 configuration sections dellos10_facts \u2013 Collect facts from remote devices running Dell EMC Networking OS10","title":"Dellos10"},{"location":"basic/Reference/Module/#dellos6","text":"dellos6_command \u2013 Run commands on remote devices running Dell OS6 dellos6_config \u2013 Manage Dell EMC Networking OS6 configuration sections dellos6_facts \u2013 Collect facts from remote devices running Dell EMC Networking OS6","title":"Dellos6"},{"location":"basic/Reference/Module/#dellos9","text":"dellos9_command \u2013 Run commands on remote devices running Dell OS9 dellos9_config \u2013 Manage Dell EMC Networking OS9 configuration sections dellos9_facts \u2013 Collect facts from remote devices running Dell EMC Networking OS9","title":"Dellos9"},{"location":"basic/Reference/Module/#edgeos","text":"edgeos_command \u2013 Run one or more commands on EdgeOS devices edgeos_config \u2013 Manage EdgeOS configuration on remote device edgeos_facts \u2013 Collect facts from remote devices running EdgeOS","title":"Edgeos"},{"location":"basic/Reference/Module/#edgeswitch","text":"edgeswitch_facts \u2013 Collect facts from remote devices running Edgeswitch edgeswitch_vlan \u2013 Manage VLANs on Ubiquiti Edgeswitch network devices","title":"Edgeswitch"},{"location":"basic/Reference/Module/#enos","text":"enos_command \u2013 Run arbitrary commands on Lenovo ENOS devices enos_config \u2013 Manage Lenovo ENOS configuration sections enos_facts \u2013 Collect facts from remote devices running Lenovo ENOS","title":"Enos"},{"location":"basic/Reference/Module/#eos","text":"eos_banner \u2013 Manage multiline banners on Arista EOS devices eos_bgp \u2013 Configure global BGP protocol settings on Arista EOS eos_command \u2013 Run arbitrary commands on an Arista EOS device eos_config \u2013 Manage Arista EOS configuration sections eos_eapi \u2013 Manage and configure Arista EOS eAPI eos_facts \u2013 Collect facts from remote devices running Arista EOS eos_interface \u2013 Manage Interface on Arista EOS network devices (D) eos_interfaces \u2013 Manages interface attributes of Arista EOS interfaces eos_l2_interface \u2013 Manage L2 interfaces on Arista EOS network devices (D) eos_l2_interfaces \u2013 Manages Layer-2 interface attributes of Arista EOS devices eos_l3_interface \u2013 Manage L3 interfaces on Arista EOS network devices (D) eos_l3_interfaces \u2013 Manages L3 interface attributes of Arista EOS devices eos_lacp \u2013 Manage Global Link Aggregation Control Protocol (LACP) on Arista EOS devices eos_lacp_interfaces \u2013 Manage Link Aggregation Control Protocol (LACP) attributes of interfaces on Arista EOS devices eos_lag_interfaces \u2013 Manages link aggregation groups on Arista EOS devices eos_linkagg \u2013 Manage link aggregation groups on Arista EOS network devices (D) eos_lldp \u2013 Manage LLDP configuration on Arista EOS network devices eos_lldp_global \u2013 Manage Global Link Layer Discovery Protocol (LLDP) settings on Arista EOS devices eos_lldp_interfaces \u2013 Manage Link Layer Discovery Protocol (LLDP) attributes of interfaces on Arista EOS devices eos_logging \u2013 Manage logging on network devices eos_static_route \u2013 Manage static IP routes on Arista EOS network devices eos_system \u2013 Manage the system attributes on Arista EOS devices eos_user \u2013 Manage the collection of local users on EOS devices eos_vlan \u2013 Manage VLANs on Arista EOS network devices (D) eos_vlans \u2013 Manage VLANs on Arista EOS devices eos_vrf \u2013 Manage VRFs on Arista EOS network devices","title":"Eos"},{"location":"basic/Reference/Module/#eric_eccli","text":"eric_eccli_command \u2013 Run commands on remote devices running ERICSSON ECCLI","title":"Eric_Eccli"},{"location":"basic/Reference/Module/#exos","text":"exos_command \u2013 Run commands on remote devices running Extreme EXOS exos_config \u2013 Manage Extreme Networks EXOS configuration sections exos_facts \u2013 Collect facts from devices running Extreme EXOS exos_lldp_global \u2013 Configure and manage Link Layer Discovery Protocol(LLDP) attributes on EXOS platforms","title":"Exos"},{"location":"basic/Reference/Module/#f5","text":"bigip_apm_acl \u2013 Manage user-defined APM ACLs bigip_apm_network_access \u2013 Manage APM Network Access resource bigip_apm_policy_fetch \u2013 Exports the APM policy or APM access profile from remote nodes bigip_apm_policy_import \u2013 Manage BIG-IP APM policy or APM access profile imports bigip_appsvcs_extension \u2013 Manage application service deployments bigip_asm_dos_application \u2013 Manage application settings for DOS profile bigip_asm_policy \u2013 Manage BIG-IP ASM policies (D) bigip_asm_policy_fetch \u2013 Exports the asm policy from remote nodes bigip_asm_policy_import \u2013 Manage BIG-IP ASM policy imports bigip_asm_policy_manage \u2013 Manage BIG-IP ASM policies bigip_asm_policy_server_technology \u2013 Manages Server Technology on ASM policy bigip_asm_policy_signature_set \u2013 Manages Signature Sets on ASM policy bigip_cli_alias \u2013 Manage CLI aliases on a BIG-IP bigip_cli_script \u2013 Manage CLI scripts on a BIG-IP bigip_command \u2013 Run TMSH and BASH commands on F5 devices bigip_config \u2013 Manage BIG-IP configuration sections bigip_configsync_action \u2013 Perform different actions related to config-sync bigip_data_group \u2013 Manage data groups on a BIG-IP bigip_device_auth \u2013 Manage system authentication on a BIG-IP bigip_device_auth_ldap \u2013 Manage LDAP device authentication settings on BIG-IP bigip_device_certificate \u2013 Manage self-signed device certificates bigip_device_connectivity \u2013 Manages device IP configuration settings for HA on a BIG-IP bigip_device_dns \u2013 Manage BIG-IP device DNS settings bigip_device_group \u2013 Manage device groups on a BIG-IP bigip_device_group_member \u2013 Manages members in a device group bigip_device_ha_group \u2013 Manage HA group settings on a BIG-IP system bigip_device_httpd \u2013 Manage HTTPD related settings on BIG-IP bigip_device_info \u2013 Collect information from F5 BIG-IP devices bigip_device_license \u2013 Manage license installation and activation on BIG-IP devices bigip_device_ntp \u2013 Manage NTP servers on a BIG-IP bigip_device_sshd \u2013 Manage the SSHD settings of a BIG-IP bigip_device_syslog \u2013 Manage system-level syslog settings on BIG-IP bigip_device_traffic_group \u2013 Manages traffic groups on BIG-IP bigip_device_trust \u2013 Manage the trust relationships between BIG-IPs bigip_dns_cache_resolver \u2013 Manage DNS resolver cache configurations on BIG-IP bigip_dns_nameserver \u2013 Manage LTM DNS nameservers on a BIG-IP bigip_dns_resolver \u2013 Manage DNS resolvers on a BIG-IP bigip_dns_zone \u2013 Manage DNS zones on BIG-IP bigip_facts \u2013 Collect facts from F5 BIG-IP devices (D) bigip_file_copy \u2013 Manage files in datastores on a BIG-IP bigip_firewall_address_list \u2013 Manage address lists on BIG-IP AFM bigip_firewall_dos_profile \u2013 Manage AFM DoS profiles on a BIG-IP bigip_firewall_dos_vector \u2013 Manage attack vector configuration in an AFM DoS profile bigip_firewall_global_rules \u2013 Manage AFM global rule settings on BIG-IP bigip_firewall_log_profile \u2013 Manages AFM logging profiles configured in the system bigip_firewall_log_profile_network \u2013 Configures Network Firewall related settings of the log profile bigip_firewall_policy \u2013 Manage AFM security firewall policies on a BIG-IP bigip_firewall_port_list \u2013 Manage port lists on BIG-IP AFM bigip_firewall_rule \u2013 Manage AFM Firewall rules bigip_firewall_rule_list \u2013 Manage AFM security firewall policies on a BIG-IP bigip_firewall_schedule \u2013 Manage BIG-IP AFM schedule configurations bigip_gtm_datacenter \u2013 Manage Datacenter configuration in BIG-IP bigip_gtm_facts \u2013 Collect facts from F5 BIG-IP GTM devices (D) bigip_gtm_global \u2013 Manages global GTM settings bigip_gtm_monitor_bigip \u2013 Manages F5 BIG-IP GTM BIG-IP monitors bigip_gtm_monitor_external \u2013 Manages external GTM monitors on a BIG-IP bigip_gtm_monitor_firepass \u2013 Manages F5 BIG-IP GTM FirePass monitors bigip_gtm_monitor_http \u2013 Manages F5 BIG-IP GTM http monitors bigip_gtm_monitor_https \u2013 Manages F5 BIG-IP GTM https monitors bigip_gtm_monitor_tcp \u2013 Manages F5 BIG-IP GTM tcp monitors bigip_gtm_monitor_tcp_half_open \u2013 Manages F5 BIG-IP GTM tcp half-open monitors bigip_gtm_pool \u2013 Manages F5 BIG-IP GTM pools bigip_gtm_pool_member \u2013 Manage GTM pool member settings bigip_gtm_server \u2013 Manages F5 BIG-IP GTM servers bigip_gtm_topology_record \u2013 Manages GTM Topology Records bigip_gtm_topology_region \u2013 Manages GTM Topology Regions bigip_gtm_virtual_server \u2013 Manages F5 BIG-IP GTM virtual servers bigip_gtm_wide_ip \u2013 Manages F5 BIG-IP GTM wide ip bigip_hostname \u2013 Manage the hostname of a BIG-IP bigip_iapp_service \u2013 Manages TCL iApp services on a BIG-IP bigip_iapp_template \u2013 Manages TCL iApp templates on a BIG-IP bigip_ike_peer \u2013 Manage IPSec IKE Peer configuration on BIG-IP bigip_imish_config \u2013 Manage BIG-IP advanced routing configuration sections bigip_ipsec_policy \u2013 Manage IPSec policies on a BIG-IP bigip_irule \u2013 Manage iRules across different modules on a BIG-IP bigip_log_destination \u2013 Manages log destinations on a BIG-IP bigip_log_publisher \u2013 Manages log publishers on a BIG-IP bigip_lx_package \u2013 Manages Javascript LX packages on a BIG-IP bigip_management_route \u2013 Manage system management routes on a BIG-IP bigip_message_routing_peer \u2013 Manage peers for routing generic message protocol messages bigip_message_routing_protocol \u2013 Manage generic message parser profile bigip_message_routing_route \u2013 Manages static routes for routing message protocol messages bigip_message_routing_router \u2013 Manages router profiles for message-routing protocols bigip_message_routing_transport_config \u2013 Manages configuration for an outgoing connection bigip_monitor_dns \u2013 Manage DNS monitors on a BIG-IP bigip_monitor_external \u2013 Manages external LTM monitors on a BIG-IP bigip_monitor_gateway_icmp \u2013 Manages F5 BIG-IP LTM gateway ICMP monitors bigip_monitor_http \u2013 Manages F5 BIG-IP LTM http monitors bigip_monitor_https \u2013 Manages F5 BIG-IP LTM https monitors bigip_monitor_ldap \u2013 Manages BIG-IP LDAP monitors bigip_monitor_snmp_dca \u2013 Manages BIG-IP SNMP data collecting agent (DCA) monitors bigip_monitor_tcp \u2013 Manages F5 BIG-IP LTM tcp monitors bigip_monitor_tcp_echo \u2013 Manages F5 BIG-IP LTM tcp echo monitors bigip_monitor_tcp_half_open \u2013 Manages F5 BIG-IP LTM tcp half-open monitors bigip_monitor_udp \u2013 Manages F5 BIG-IP LTM udp monitors bigip_node \u2013 Manages F5 BIG-IP LTM nodes bigip_partition \u2013 Manage BIG-IP partitions bigip_password_policy \u2013 Manages the authentication password policy on a BIG-IP bigip_policy \u2013 Manage general policy configuration on a BIG-IP bigip_policy_rule \u2013 Manage LTM policy rules on a BIG-IP bigip_pool \u2013 Manages F5 BIG-IP LTM pools bigip_pool_member \u2013 Manages F5 BIG-IP LTM pool members bigip_profile_analytics \u2013 Manage HTTP analytics profiles on a BIG-IP bigip_profile_client_ssl \u2013 Manages client SSL profiles on a BIG-IP bigip_profile_dns \u2013 Manage DNS profiles on a BIG-IP bigip_profile_fastl4 \u2013 Manages Fast L4 profiles bigip_profile_http \u2013 Manage HTTP profiles on a BIG-IP bigip_profile_http2 \u2013 Manage HTTP2 profiles on a BIG-IP bigip_profile_http_compression \u2013 Manage HTTP compression profiles on a BIG-IP bigip_profile_oneconnect \u2013 Manage OneConnect profiles on a BIG-IP bigip_profile_persistence_cookie \u2013 Manage cookie persistence profiles on BIG-IP bigip_profile_persistence_src_addr \u2013 Manage source address persistence profiles bigip_profile_server_ssl \u2013 Manages server SSL profiles on a BIG-IP bigip_profile_tcp \u2013 Manage TCP profiles on a BIG-IP bigip_profile_udp \u2013 Manage UDP profiles on a BIG-IP bigip_provision \u2013 Manage BIG-IP module provisioning bigip_qkview \u2013 Manage qkviews on the device bigip_remote_role \u2013 Manage remote roles on a BIG-IP bigip_remote_syslog \u2013 Manipulate remote syslog settings on a BIG-IP bigip_remote_user \u2013 Manages default settings for remote user accounts on a BIG-IP bigip_routedomain \u2013 Manage route domains on a BIG-IP bigip_selfip \u2013 Manage Self-IPs on a BIG-IP system bigip_service_policy \u2013 Manages service policies on a BIG-IP bigip_smtp \u2013 Manages SMTP settings on the BIG-IP bigip_snat_pool \u2013 Manage SNAT pools on a BIG-IP bigip_snat_translation \u2013 Manage SNAT Translations on a BIG-IP bigip_snmp \u2013 Manipulate general SNMP settings on a BIG-IP bigip_snmp_community \u2013 Manages SNMP communities on a BIG-IP bigip_snmp_trap \u2013 Manipulate SNMP trap information on a BIG-IP bigip_software_image \u2013 Manage software images on a BIG-IP bigip_software_install \u2013 Install software images on a BIG-IP bigip_software_update \u2013 Manage the software update settings of a BIG-IP bigip_ssl_certificate \u2013 Import/Delete certificates from BIG-IP bigip_ssl_key \u2013 Import/Delete SSL keys from BIG-IP bigip_ssl_ocsp \u2013 Manage OCSP configurations on BIG-IP bigip_static_route \u2013 Manipulate static routes on a BIG-IP bigip_sys_daemon_log_tmm \u2013 Manage BIG-IP tmm daemon log settings bigip_sys_db \u2013 Manage BIG-IP system database variables bigip_sys_global \u2013 Manage BIG-IP global settings bigip_timer_policy \u2013 Manage timer policies on a BIG-IP bigip_traffic_selector \u2013 Manage IPSec Traffic Selectors on BIG-IP bigip_trunk \u2013 Manage trunks on a BIG-IP bigip_tunnel \u2013 Manage tunnels on a BIG-IP bigip_ucs \u2013 Manage upload, installation and removal of UCS files bigip_ucs_fetch \u2013 Fetches a UCS file from remote nodes bigip_user \u2013 Manage user accounts and user attributes on a BIG-IP bigip_vcmp_guest \u2013 Manages vCMP guests on a BIG-IP bigip_virtual_address \u2013 Manage LTM virtual addresses on a BIG-IP bigip_virtual_server \u2013 Manage LTM virtual servers on a BIG-IP bigip_vlan \u2013 Manage VLANs on a BIG-IP system bigip_wait \u2013 Wait for a BIG-IP condition before continuing bigiq_application_fasthttp \u2013 Manages BIG-IQ FastHTTP applications bigiq_application_fastl4_tcp \u2013 Manages BIG-IQ FastL4 TCP applications bigiq_application_fastl4_udp \u2013 Manages BIG-IQ FastL4 UDP applications bigiq_application_http \u2013 Manages BIG-IQ HTTP applications bigiq_application_https_offload \u2013 Manages BIG-IQ HTTPS offload applications bigiq_application_https_waf \u2013 Manages BIG-IQ HTTPS WAF applications bigiq_device_discovery \u2013 Manage BIG-IP devices through BIG-IQ bigiq_device_info \u2013 Collect information from F5 BIG-IQ devices bigiq_regkey_license \u2013 Manages licenses in a BIG-IQ registration key pool bigiq_regkey_license_assignment \u2013 Manage regkey license assignment on BIG-IPs from a BIG-IQ bigiq_regkey_pool \u2013 Manages registration key pools on BIG-IQ bigiq_utility_license \u2013 Manage utility licenses on a BIG-IQ bigiq_utility_license_assignment \u2013 Manage utility license assignment on BIG-IPs from a BIG-IQ","title":"F5"},{"location":"basic/Reference/Module/#files","text":"net_get \u2013 Copy a file from a network device to Ansible Controller net_put \u2013 Copy a file from Ansible Controller to a network device","title":"Files"},{"location":"basic/Reference/Module/#fortianalyzer","text":"faz_device \u2013 Add or remove device","title":"Fortianalyzer"},{"location":"basic/Reference/Module/#fortimanager","text":"fmgr_device \u2013 Add or remove device from FortiManager fmgr_device_config \u2013 Edit device configurations fmgr_device_group \u2013 Alter FortiManager device groups fmgr_device_provision_template \u2013 Manages Device Provisioning Templates in FortiManager fmgr_fwobj_address \u2013 Allows the management of firewall objects in FortiManager fmgr_fwobj_ippool \u2013 Allows the editing of IP Pool Objects within FortiManager fmgr_fwobj_ippool6 \u2013 Allows the editing of IP Pool Objects within FortiManager fmgr_fwobj_service \u2013 Manages FortiManager Firewall Service Objects fmgr_fwobj_vip \u2013 Manages Virtual IPs objects in FortiManager fmgr_fwpol_ipv4 \u2013 Allows the add/delete of Firewall Policies on Packages in FortiManager fmgr_fwpol_package \u2013 Manages FortiManager Firewall Policies Packages fmgr_ha \u2013 Manages the High-Availability State of FortiManager Clusters and Nodes fmgr_provisioning \u2013 Provision devices via FortiMananger fmgr_query \u2013 Query FortiManager data objects for use in Ansible workflows fmgr_script \u2013 Add/Edit/Delete and execute scripts fmgr_secprof_appctrl \u2013 Manage application control security profiles fmgr_secprof_av \u2013 Manage security profile fmgr_secprof_dns \u2013 Manage DNS security profiles in FortiManager fmgr_secprof_ips \u2013 Managing IPS security profiles in FortiManager fmgr_secprof_profile_group \u2013 Manage security profiles within FortiManager fmgr_secprof_proxy \u2013 Manage proxy security profiles in FortiManager fmgr_secprof_spam \u2013 spam filter profile for FMG fmgr_secprof_ssl_ssh \u2013 Manage SSL and SSH security profiles in FortiManager fmgr_secprof_voip \u2013 VOIP security profiles in FMG fmgr_secprof_waf \u2013 FortiManager web application firewall security profile fmgr_secprof_wanopt \u2013 WAN optimization fmgr_secprof_web \u2013 Manage web filter security profiles in FortiManager","title":"Fortimanager"},{"location":"basic/Reference/Module/#fortios","text":"fortios_address \u2013 Manage fortios firewall address objects fortios_alertemail_setting \u2013 Configure alert email settings in Fortinet\u2019s FortiOS and FortiGate fortios_antivirus_heuristic \u2013 Configure global heuristic options in Fortinet\u2019s FortiOS and FortiGate fortios_antivirus_profile \u2013 Configure AntiVirus profiles in Fortinet\u2019s FortiOS and FortiGate fortios_antivirus_quarantine \u2013 Configure quarantine options in Fortinet\u2019s FortiOS and FortiGate fortios_antivirus_settings \u2013 Configure AntiVirus settings in Fortinet\u2019s FortiOS and FortiGate fortios_application_custom \u2013 Configure custom application signatures in Fortinet\u2019s FortiOS and FortiGate fortios_application_group \u2013 Configure firewall application groups in Fortinet\u2019s FortiOS and FortiGate fortios_application_list \u2013 Configure application control lists in Fortinet\u2019s FortiOS and FortiGate fortios_application_name \u2013 Configure application signatures in Fortinet\u2019s FortiOS and FortiGate fortios_application_rule_settings \u2013 Configure application rule settings in Fortinet\u2019s FortiOS and FortiGate fortios_authentication_rule \u2013 Configure Authentication Rules in Fortinet\u2019s FortiOS and FortiGate fortios_authentication_scheme \u2013 Configure Authentication Schemes in Fortinet\u2019s FortiOS and FortiGate fortios_authentication_setting \u2013 Configure authentication setting in Fortinet\u2019s FortiOS and FortiGate fortios_config \u2013 Manage config on Fortinet FortiOS firewall devices fortios_dlp_filepattern \u2013 Configure file patterns used by DLP blocking in Fortinet\u2019s FortiOS and FortiGate fortios_dlp_fp_doc_source \u2013 Create a DLP fingerprint database by allowing the FortiGate to access a file server containing files from which to create fingerprints in Fortinet\u2019s FortiOS and FortiGate fortios_dlp_fp_sensitivity \u2013 Create self-explanatory DLP sensitivity levels to be used when setting sensitivity under config fp-doc-source in Fortinet\u2019s FortiOS and FortiGate fortios_dlp_sensor \u2013 Configure DLP sensors in Fortinet\u2019s FortiOS and FortiGate fortios_dlp_settings \u2013 Designate logical storage for DLP fingerprint database in Fortinet\u2019s FortiOS and FortiGate fortios_dnsfilter_domain_filter \u2013 Configure DNS domain filters in Fortinet\u2019s FortiOS and FortiGate fortios_dnsfilter_profile \u2013 Configure DNS domain filter profiles in Fortinet\u2019s FortiOS and FortiGate fortios_endpoint_control_client \u2013 Configure endpoint control client lists in Fortinet\u2019s FortiOS and FortiGate fortios_endpoint_control_forticlient_ems \u2013 Configure FortiClient Enterprise Management Server (EMS) entries in Fortinet\u2019s FortiOS and FortiGate fortios_endpoint_control_forticlient_registration_sync \u2013 Configure FortiClient registration synchronization settings in Fortinet\u2019s FortiOS and FortiGate fortios_endpoint_control_profile \u2013 Configure FortiClient endpoint control profiles in Fortinet\u2019s FortiOS and FortiGate fortios_endpoint_control_settings \u2013 Configure endpoint control settings in Fortinet\u2019s FortiOS and FortiGate fortios_extender_controller_extender \u2013 Extender controller configuration in Fortinet\u2019s FortiOS and FortiGate fortios_facts \u2013 Get facts about fortios devices fortios_firewall_address \u2013 Configure IPv4 addresses in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_address6 \u2013 Configure IPv6 firewall addresses in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_address6_template \u2013 Configure IPv6 address templates in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_addrgrp \u2013 Configure IPv4 address groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_addrgrp6 \u2013 Configure IPv6 address groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_auth_portal \u2013 Configure firewall authentication portals in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_central_snat_map \u2013 Configure central SNAT policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_dnstranslation \u2013 Configure DNS translation in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_DoS_policy \u2013 Configure IPv4 DoS policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_DoS_policy6 \u2013 Configure IPv6 DoS policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_identity_based_route \u2013 Configure identity based routing in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_interface_policy \u2013 Configure IPv4 interface policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_interface_policy6 \u2013 Configure IPv6 interface policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_internet_service \u2013 Show Internet Service application in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_internet_service_custom \u2013 Configure custom Internet Services in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_internet_service_group \u2013 Configure group of Internet Service in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ip_translation \u2013 Configure firewall IP-translation in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ipmacbinding_setting \u2013 Configure IP to MAC binding settings in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ipmacbinding_table \u2013 Configure IP to MAC address pairs in the IP/MAC binding table in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ippool \u2013 Configure IPv4 IP pools in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ippool6 \u2013 Configure IPv6 IP pools in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ipv6_eh_filter \u2013 Configure IPv6 extension header filter in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ldb_monitor \u2013 Configure server load balancing health monitors in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_local_in_policy \u2013 Configure user defined IPv4 local-in policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_local_in_policy6 \u2013 Configure user defined IPv6 local-in policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_multicast_address \u2013 Configure multicast addresses in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_multicast_address6 \u2013 Configure IPv6 multicast address in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_multicast_policy \u2013 Configure multicast NAT policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_multicast_policy6 \u2013 Configure IPv6 multicast NAT policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_policy \u2013 Configure IPv4 policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_policy46 \u2013 Configure IPv4 to IPv6 policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_policy6 \u2013 Configure IPv6 policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_policy64 \u2013 Configure IPv6 to IPv4 policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_profile_group \u2013 Configure profile groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_profile_protocol_options \u2013 Configure protocol options in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_proxy_address \u2013 Web proxy address configuration in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_proxy_addrgrp \u2013 Web proxy address group configuration in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_proxy_policy \u2013 Configure proxy policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_schedule_group \u2013 Schedule group configuration in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_schedule_onetime \u2013 Onetime schedule configuration in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_schedule_recurring \u2013 Recurring schedule configuration in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_service_category \u2013 Configure service categories in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_service_custom \u2013 Configure custom services in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_service_group \u2013 Configure service groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_shaper_per_ip_shaper \u2013 Configure per-IP traffic shaper in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_shaper_traffic_shaper \u2013 Configure shared traffic shaper in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_shaping_policy \u2013 Configure shaping policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_shaping_profile \u2013 Configure shaping profiles in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_sniffer \u2013 Configure sniffer in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssh_host_key \u2013 SSH proxy host public keys in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssh_local_ca \u2013 SSH proxy local CA in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssh_local_key \u2013 SSH proxy local keys in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssh_setting \u2013 SSH proxy settings in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssl_server \u2013 Configure SSL servers in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssl_setting \u2013 SSL proxy settings in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ssl_ssh_profile \u2013 Configure SSL/SSH protocol options in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_ttl_policy \u2013 Configure TTL policies in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vip \u2013 Configure virtual IP for IPv4 in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vip46 \u2013 Configure IPv4 to IPv6 virtual IPs in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vip6 \u2013 Configure virtual IP for IPv6 in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vip64 \u2013 Configure IPv6 to IPv4 virtual IPs in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vipgrp \u2013 Configure IPv4 virtual IP groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vipgrp46 \u2013 Configure IPv4 to IPv6 virtual IP groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vipgrp6 \u2013 Configure IPv6 virtual IP groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_vipgrp64 \u2013 Configure IPv6 to IPv4 virtual IP groups in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_wildcard_fqdn_custom \u2013 Config global/VDOM Wildcard FQDN address in Fortinet\u2019s FortiOS and FortiGate fortios_firewall_wildcard_fqdn_group \u2013 Config global Wildcard FQDN address groups in Fortinet\u2019s FortiOS and FortiGate fortios_ftp_proxy_explicit \u2013 Configure explicit FTP proxy settings in Fortinet\u2019s FortiOS and FortiGate fortios_icap_profile \u2013 Configure ICAP profiles in Fortinet\u2019s FortiOS and FortiGate fortios_icap_server \u2013 Configure ICAP servers in Fortinet\u2019s FortiOS and FortiGate fortios_ips_custom \u2013 Configure IPS custom signature in Fortinet\u2019s FortiOS and FortiGate fortios_ips_decoder \u2013 Configure IPS decoder in Fortinet\u2019s FortiOS and FortiGate fortios_ips_global \u2013 Configure IPS global parameter in Fortinet\u2019s FortiOS and FortiGate fortios_ips_rule \u2013 Configure IPS rules in Fortinet\u2019s FortiOS and FortiGate fortios_ips_rule_settings \u2013 Configure IPS rule setting in Fortinet\u2019s FortiOS and FortiGate fortios_ips_sensor \u2013 Configure IPS sensor in Fortinet\u2019s FortiOS and FortiGate fortios_ips_settings \u2013 Configure IPS VDOM parameter in Fortinet\u2019s FortiOS and FortiGate fortios_ipv4_policy \u2013 Manage IPv4 policy objects on Fortinet FortiOS firewall devices fortios_log_custom_field \u2013 Configure custom log fields in Fortinet\u2019s FortiOS and FortiGate fortios_log_disk_filter \u2013 Configure filters for local disk logging. Use these filters to determine the log messages to record according to severity and type in Fortinet\u2019s FortiOS and FortiGate fortios_log_disk_setting \u2013 Settings for local disk logging in Fortinet\u2019s FortiOS and FortiGate fortios_log_eventfilter \u2013 Configure log event filters in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer2_filter \u2013 Filters for FortiAnalyzer in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer2_setting \u2013 Global FortiAnalyzer settings in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer3_filter \u2013 Filters for FortiAnalyzer in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer3_setting \u2013 Global FortiAnalyzer settings in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer_filter \u2013 Filters for FortiAnalyzer in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer_override_filter \u2013 Override filters for FortiAnalyzer in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer_override_setting \u2013 Override FortiAnalyzer settings in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortianalyzer_setting \u2013 Global FortiAnalyzer settings in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortiguard_filter \u2013 Filters for FortiCloud in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortiguard_override_filter \u2013 Override filters for FortiCloud in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortiguard_override_setting \u2013 Override global FortiCloud logging settings for this VDOM in Fortinet\u2019s FortiOS and FortiGate fortios_log_fortiguard_setting \u2013 Configure logging to FortiCloud in Fortinet\u2019s FortiOS and FortiGate fortios_log_gui_display \u2013 Configure how log messages are displayed on the GUI in Fortinet\u2019s FortiOS and FortiGate fortios_log_memory_filter \u2013 Filters for memory buffer in Fortinet\u2019s FortiOS and FortiGate fortios_log_memory_global_setting \u2013 Global settings for memory logging in Fortinet\u2019s FortiOS and FortiGate fortios_log_memory_setting \u2013 Settings for memory buffer in Fortinet\u2019s FortiOS and FortiGate fortios_log_null_device_filter \u2013 Filters for null device logging in Fortinet\u2019s FortiOS and FortiGate fortios_log_null_device_setting \u2013 Settings for null device logging in Fortinet\u2019s FortiOS and FortiGate fortios_log_setting \u2013 Configure general log settings in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd2_filter \u2013 Filters for remote system server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd2_setting \u2013 Global settings for remote syslog server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd3_filter \u2013 Filters for remote system server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd3_setting \u2013 Global settings for remote syslog server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd4_filter \u2013 Filters for remote system server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd4_setting \u2013 Global settings for remote syslog server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd_filter \u2013 Filters for remote system server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd_override_filter \u2013 Override filters for remote system server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd_override_setting \u2013 Override settings for remote syslog server in Fortinet\u2019s FortiOS and FortiGate fortios_log_syslogd_setting \u2013 Global settings for remote syslog server in Fortinet\u2019s FortiOS and FortiGate fortios_log_threat_weight \u2013 Configure threat weight settings in Fortinet\u2019s FortiOS and FortiGate fortios_log_webtrends_filter \u2013 Filters for WebTrends in Fortinet\u2019s FortiOS and FortiGate fortios_log_webtrends_setting \u2013 Settings for WebTrends in Fortinet\u2019s FortiOS and FortiGate fortios_report_chart \u2013 Report chart widget configuration in Fortinet\u2019s FortiOS and FortiGate fortios_report_dataset \u2013 Report dataset configuration in Fortinet\u2019s FortiOS and FortiGate fortios_report_layout \u2013 Report layout configuration in Fortinet\u2019s FortiOS and FortiGate fortios_report_setting \u2013 Report setting configuration in Fortinet\u2019s FortiOS and FortiGate fortios_report_style \u2013 Report style configuration in Fortinet\u2019s FortiOS and FortiGate fortios_report_theme \u2013 Report themes configuration in Fortinet\u2019s FortiOS and FortiGate fortios_router_access_list \u2013 Configure access lists in Fortinet\u2019s FortiOS and FortiGate fortios_router_access_list6 \u2013 Configure IPv6 access lists in Fortinet\u2019s FortiOS and FortiGate fortios_router_aspath_list \u2013 Configure Autonomous System (AS) path lists in Fortinet\u2019s FortiOS and FortiGate fortios_router_auth_path \u2013 Configure authentication based routing in Fortinet\u2019s FortiOS and FortiGate fortios_router_bfd \u2013 Configure BFD in Fortinet\u2019s FortiOS and FortiGate fortios_router_bfd6 \u2013 Configure IPv6 BFD in Fortinet\u2019s FortiOS and FortiGate fortios_router_bgp \u2013 Configure BGP in Fortinet\u2019s FortiOS and FortiGate fortios_router_community_list \u2013 Configure community lists in Fortinet\u2019s FortiOS and FortiGate fortios_router_isis \u2013 Configure IS-IS in Fortinet\u2019s FortiOS and FortiGate fortios_router_key_chain \u2013 Configure key-chain in Fortinet\u2019s FortiOS and FortiGate fortios_router_multicast \u2013 Configure router multicast in Fortinet\u2019s FortiOS and FortiGate fortios_router_multicast6 \u2013 Configure IPv6 multicast in Fortinet\u2019s FortiOS and FortiGate fortios_router_multicast_flow \u2013 Configure multicast-flow in Fortinet\u2019s FortiOS and FortiGate fortios_router_ospf \u2013 Configure OSPF in Fortinet\u2019s FortiOS and FortiGate fortios_router_ospf6 \u2013 Configure IPv6 OSPF in Fortinet\u2019s FortiOS and FortiGate fortios_router_policy \u2013 Configure IPv4 routing policies in Fortinet\u2019s FortiOS and FortiGate fortios_router_policy6 \u2013 Configure IPv6 routing policies in Fortinet\u2019s FortiOS and FortiGate fortios_router_prefix_list \u2013 Configure IPv4 prefix lists in Fortinet\u2019s FortiOS and FortiGate fortios_router_prefix_list6 \u2013 Configure IPv6 prefix lists in Fortinet\u2019s FortiOS and FortiGate fortios_router_rip \u2013 Configure RIP in Fortinet\u2019s FortiOS and FortiGate fortios_router_ripng \u2013 Configure RIPng in Fortinet\u2019s FortiOS and FortiGate fortios_router_route_map \u2013 Configure route maps in Fortinet\u2019s FortiOS and FortiGate fortios_router_setting \u2013 Configure router settings in Fortinet\u2019s FortiOS and FortiGate fortios_router_static \u2013 Configure IPv4 static routing tables in Fortinet\u2019s FortiOS and FortiGate fortios_router_static6 \u2013 Configure IPv6 static routing tables in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_bwl \u2013 Configure anti-spam black/white list in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_bword \u2013 Configure AntiSpam banned word list in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_dnsbl \u2013 Configure AntiSpam DNSBL/ORBL in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_fortishield \u2013 Configure FortiGuard - AntiSpam in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_iptrust \u2013 Configure AntiSpam IP trust in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_mheader \u2013 Configure AntiSpam MIME header in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_options \u2013 Configure AntiSpam options in Fortinet\u2019s FortiOS and FortiGate fortios_spamfilter_profile \u2013 Configure AntiSpam profiles in Fortinet\u2019s FortiOS and FortiGate fortios_ssh_filter_profile \u2013 SSH filter profile in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_802_1X_settings \u2013 Configure global 802.1X settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_custom_command \u2013 Configure the FortiGate switch controller to send custom commands to managed FortiSwitch devices in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_global \u2013 Configure FortiSwitch global settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_igmp_snooping \u2013 Configure FortiSwitch IGMP snooping global settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_lldp_profile \u2013 Configure FortiSwitch LLDP profiles in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_lldp_settings \u2013 Configure FortiSwitch LLDP settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_mac_sync_settings \u2013 Configure global MAC synchronization settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_managed_switch \u2013 Configure FortiSwitch devices that are managed by this FortiGate in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_network_monitor_settings \u2013 Configure network monitor settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_qos_dot1p_map \u2013 Configure FortiSwitch QoS 802.1p in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_qos_ip_dscp_map \u2013 Configure FortiSwitch QoS IP precedence/DSCP in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_qos_qos_policy \u2013 Configure FortiSwitch QoS policy in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_qos_queue_policy \u2013 Configure FortiSwitch QoS egress queue policy in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_quarantine \u2013 Configure FortiSwitch quarantine support in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_security_policy_802_1X \u2013 Configure 802.1x MAC Authentication Bypass (MAB) policies in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_security_policy_captive_portal \u2013 Names of VLANs that use captive portal authentication in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_sflow \u2013 Configure FortiSwitch sFlow in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_storm_control \u2013 Configure FortiSwitch storm control in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_stp_settings \u2013 Configure FortiSwitch spanning tree protocol (STP) in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_switch_group \u2013 Configure FortiSwitch switch groups in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_switch_interface_tag \u2013 Configure switch object tags in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_switch_log \u2013 Configure FortiSwitch logging (logs are transferred to and inserted into FortiGate event log) in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_switch_profile \u2013 Configure FortiSwitch switch profile in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_system \u2013 Configure system-wide switch controller settings in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_virtual_port_pool \u2013 Configure virtual pool in Fortinet\u2019s FortiOS and FortiGate fortios_switch_controller_vlan \u2013 Configure VLANs for switch controller in Fortinet\u2019s FortiOS and FortiGate fortios_system_accprofile \u2013 Configure access profiles for system administrators in Fortinet\u2019s FortiOS and FortiGate fortios_system_admin \u2013 Configure admin users in Fortinet\u2019s FortiOS and FortiGate fortios_system_affinity_interrupt \u2013 Configure interrupt affinity in Fortinet\u2019s FortiOS and FortiGate fortios_system_affinity_packet_redistribution \u2013 Configure packet redistribution in Fortinet\u2019s FortiOS and FortiGate fortios_system_alarm \u2013 Configure alarm in Fortinet\u2019s FortiOS and FortiGate fortios_system_alias \u2013 Configure alias command in Fortinet\u2019s FortiOS and FortiGate fortios_system_api_user \u2013 Configure API users in Fortinet\u2019s FortiOS and FortiGate fortios_system_arp_table \u2013 Configure ARP table in Fortinet\u2019s FortiOS and FortiGate fortios_system_auto_install \u2013 Configure USB auto installation in Fortinet\u2019s FortiOS and FortiGate fortios_system_auto_script \u2013 Configure auto script in Fortinet\u2019s FortiOS and FortiGate fortios_system_automation_action \u2013 Action for automation stitches in Fortinet\u2019s FortiOS and FortiGate fortios_system_automation_destination \u2013 Automation destinations in Fortinet\u2019s FortiOS and FortiGate fortios_system_automation_stitch \u2013 Automation stitches in Fortinet\u2019s FortiOS and FortiGate fortios_system_automation_trigger \u2013 Trigger for automation stitches in Fortinet\u2019s FortiOS and FortiGate fortios_system_autoupdate_push_update \u2013 Configure push updates in Fortinet\u2019s FortiOS and FortiGate fortios_system_autoupdate_schedule \u2013 Configure update schedule in Fortinet\u2019s FortiOS and FortiGate fortios_system_autoupdate_tunneling \u2013 Configure web proxy tunnelling for the FDN in Fortinet\u2019s FortiOS and FortiGate fortios_system_central_management \u2013 Configure central management in Fortinet\u2019s FortiOS and FortiGate fortios_system_cluster_sync \u2013 Configure FortiGate Session Life Support Protocol (FGSP) session synchronization in Fortinet\u2019s FortiOS and FortiGate fortios_system_console \u2013 Configure console in Fortinet\u2019s FortiOS and FortiGate fortios_system_csf \u2013 Add this FortiGate to a Security Fabric or set up a new Security Fabric on this FortiGate in Fortinet\u2019s FortiOS and FortiGate fortios_system_custom_language \u2013 Configure custom languages in Fortinet\u2019s FortiOS and FortiGate fortios_system_ddns \u2013 Configure DDNS in Fortinet\u2019s FortiOS and FortiGate fortios_system_dedicated_mgmt \u2013 Configure dedicated management in Fortinet\u2019s FortiOS and FortiGate fortios_system_dhcp6_server \u2013 Configure DHCPv6 servers in Fortinet\u2019s FortiOS and FortiGate fortios_system_dhcp_server \u2013 Configure DHCP servers in Fortinet\u2019s FortiOS and FortiGate fortios_system_dns \u2013 Configure DNS in Fortinet\u2019s FortiOS and FortiGate fortios_system_dns_database \u2013 Configure DNS databases in Fortinet\u2019s FortiOS and FortiGate fortios_system_dns_server \u2013 Configure DNS servers in Fortinet\u2019s FortiOS and FortiGate fortios_system_dscp_based_priority \u2013 Configure DSCP based priority table in Fortinet\u2019s FortiOS and FortiGate fortios_system_email_server \u2013 Configure the email server used by the FortiGate various things. For example, for sending email messages to users to support user authentication features in Fortinet\u2019s FortiOS and FortiGate fortios_system_external_resource \u2013 Configure external resource in Fortinet\u2019s FortiOS and FortiGate fortios_system_fips_cc \u2013 Configure FIPS-CC mode in Fortinet\u2019s FortiOS and FortiGate fortios_system_firmware_upgrade \u2013 Perform firmware upgrade on FortiGate or FortiOS (FOS) device fortios_system_fm \u2013 Configure FM in Fortinet\u2019s FortiOS and FortiGate fortios_system_fortiguard \u2013 Configure FortiGuard services in Fortinet\u2019s FortiOS and FortiGate fortios_system_fortimanager \u2013 Configure FortiManager in Fortinet\u2019s FortiOS and FortiGate fortios_system_fortisandbox \u2013 Configure FortiSandbox in Fortinet\u2019s FortiOS and FortiGate fortios_system_fsso_polling \u2013 Configure Fortinet Single Sign On (FSSO) server in Fortinet\u2019s FortiOS and FortiGate fortios_system_ftm_push \u2013 Configure FortiToken Mobile push services in Fortinet\u2019s FortiOS and FortiGate fortios_system_geoip_override \u2013 Configure geographical location mapping for IP address(es) to override mappings from FortiGuard in Fortinet\u2019s FortiOS and FortiGate fortios_system_global \u2013 Configure global attributes in Fortinet\u2019s FortiOS and FortiGate fortios_system_gre_tunnel \u2013 Configure GRE tunnel in Fortinet\u2019s FortiOS and FortiGate fortios_system_ha \u2013 Configure HA in Fortinet\u2019s FortiOS and FortiGate fortios_system_ha_monitor \u2013 Configure HA monitor in Fortinet\u2019s FortiOS and FortiGate fortios_system_interface \u2013 Configure interfaces in Fortinet\u2019s FortiOS and FortiGate fortios_system_ipip_tunnel \u2013 Configure IP in IP Tunneling in Fortinet\u2019s FortiOS and FortiGate fortios_system_ips_urlfilter_dns \u2013 Configure IPS URL filter DNS servers in Fortinet\u2019s FortiOS and FortiGate fortios_system_ips_urlfilter_dns6 \u2013 Configure IPS URL filter IPv6 DNS servers in Fortinet\u2019s FortiOS and FortiGate fortios_system_ipv6_neighbor_cache \u2013 Configure IPv6 neighbor cache table in Fortinet\u2019s FortiOS and FortiGate fortios_system_ipv6_tunnel \u2013 Configure IPv6/IPv4 in IPv6 tunnel in Fortinet\u2019s FortiOS and FortiGate fortios_system_link_monitor \u2013 Configure Link Health Monitor in Fortinet\u2019s FortiOS and FortiGate fortios_system_mac_address_table \u2013 Configure MAC address tables in Fortinet\u2019s FortiOS and FortiGate fortios_system_management_tunnel \u2013 Management tunnel configuration in Fortinet\u2019s FortiOS and FortiGate fortios_system_mobile_tunnel \u2013 Configure Mobile tunnels, an implementation of Network Mobility (NEMO) extensions for Mobile IPv4 RFC5177 in Fortinet\u2019s FortiOS and FortiGate fortios_system_nat64 \u2013 Configure NAT64 in Fortinet\u2019s FortiOS and FortiGate fortios_system_nd_proxy \u2013 Configure IPv6 neighbor discovery proxy (RFC4389) in Fortinet\u2019s FortiOS and FortiGate fortios_system_netflow \u2013 Configure NetFlow in Fortinet\u2019s FortiOS and FortiGate fortios_system_network_visibility \u2013 Configure network visibility settings in Fortinet\u2019s FortiOS and FortiGate fortios_system_ntp \u2013 Configure system NTP information in Fortinet\u2019s FortiOS and FortiGate fortios_system_object_tagging \u2013 Configure object tagging in Fortinet\u2019s FortiOS and FortiGate fortios_system_password_policy \u2013 Configure password policy for locally defined administrator passwords and IPsec VPN pre-shared keys in Fortinet\u2019s FortiOS and FortiGate fortios_system_password_policy_guest_admin \u2013 Configure the password policy for guest administrators in Fortinet\u2019s FortiOS and FortiGate fortios_system_pppoe_interface \u2013 Configure the PPPoE interfaces in Fortinet\u2019s FortiOS and FortiGate fortios_system_probe_response \u2013 Configure system probe response in Fortinet\u2019s FortiOS and FortiGate fortios_system_proxy_arp \u2013 Configure proxy-ARP in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_admin \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_alertmail \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_auth \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_device_detection_portal \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_ec \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_fortiguard_wf \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_ftp \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_group \u2013 Configure replacement message groups in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_http \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_icap \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_image \u2013 Configure replacement message images in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_mail \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_nac_quar \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_nntp \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_spam \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_sslvpn \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_traffic_quota \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_utm \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_replacemsg_webproxy \u2013 Replacement messages in Fortinet\u2019s FortiOS and FortiGate fortios_system_resource_limits \u2013 Configure resource limits in Fortinet\u2019s FortiOS and FortiGate fortios_system_sdn_connector \u2013 Configure connection to SDN Connector in Fortinet\u2019s FortiOS and FortiGate fortios_system_session_helper \u2013 Configure session helper in Fortinet\u2019s FortiOS and FortiGate fortios_system_session_ttl \u2013 Configure global session TTL timers for this FortiGate in Fortinet\u2019s FortiOS and FortiGate fortios_system_settings \u2013 Configure VDOM settings in Fortinet\u2019s FortiOS and FortiGate fortios_system_sflow \u2013 Configure sFlow in Fortinet\u2019s FortiOS and FortiGate fortios_system_sit_tunnel \u2013 Configure IPv6 tunnel over IPv4 in Fortinet\u2019s FortiOS and FortiGate fortios_system_sms_server \u2013 Configure SMS server for sending SMS messages to support user authentication in Fortinet\u2019s FortiOS and FortiGate fortios_system_snmp_community \u2013 SNMP community configuration in Fortinet\u2019s FortiOS and FortiGate fortios_system_snmp_sysinfo \u2013 SNMP system info configuration in Fortinet\u2019s FortiOS and FortiGate fortios_system_snmp_user \u2013 SNMP user configuration in Fortinet\u2019s FortiOS and FortiGate fortios_system_storage \u2013 Configure logical storage in Fortinet\u2019s FortiOS and FortiGate fortios_system_switch_interface \u2013 Configure software switch interfaces by grouping physical and WiFi interfaces in Fortinet\u2019s FortiOS and FortiGate fortios_system_tos_based_priority \u2013 Configure Type of Service (ToS) based priority table to set network traffic priorities in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom \u2013 Configure virtual domain in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_dns \u2013 Configure DNS servers for a non-management VDOM in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_exception \u2013 Global configuration objects that can be configured independently for all VDOMs or for the defined VDOM scope in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_link \u2013 Configure VDOM links in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_netflow \u2013 Configure NetFlow per VDOM in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_property \u2013 Configure VDOM property in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_radius_server \u2013 Configure a RADIUS server to use as a RADIUS Single Sign On (RSSO) server for this VDOM in Fortinet\u2019s FortiOS and FortiGate fortios_system_vdom_sflow \u2013 Configure sFlow per VDOM to add or change the IP address and UDP port that FortiGate sFlow agents in this VDOM use to send sFlow datagrams to an sFlow collector in Fortinet\u2019s FortiOS and FortiGate fortios_system_virtual_wan_link \u2013 Configure redundant internet connections using SD-WAN (formerly virtual WAN link) in Fortinet\u2019s FortiOS and FortiGate fortios_system_virtual_wire_pair \u2013 Configure virtual wire pairs in Fortinet\u2019s FortiOS and FortiGate fortios_system_vxlan \u2013 Configure VXLAN devices in Fortinet\u2019s FortiOS and FortiGate fortios_system_wccp \u2013 Configure WCCP in Fortinet\u2019s FortiOS and FortiGate fortios_system_zone \u2013 Configure zones to group two or more interfaces. When a zone is created you can configure policies for the zone instead of individual interfaces in the zone in Fortinet\u2019s FortiOS and FortiGate fortios_user_adgrp \u2013 Configure FSSO groups in Fortinet\u2019s FortiOS and FortiGate fortios_user_device \u2013 Configure devices in Fortinet\u2019s FortiOS and FortiGate fortios_user_device_access_list \u2013 Configure device access control lists in Fortinet\u2019s FortiOS and FortiGate fortios_user_device_category \u2013 Configure device categories in Fortinet\u2019s FortiOS and FortiGate fortios_user_device_group \u2013 Configure device groups in Fortinet\u2019s FortiOS and FortiGate fortios_user_domain_controller \u2013 Configure domain controller entries in Fortinet\u2019s FortiOS and FortiGate fortios_user_fortitoken \u2013 Configure FortiToken in Fortinet\u2019s FortiOS and FortiGate fortios_user_fsso \u2013 Configure Fortinet Single Sign On (FSSO) agents in Fortinet\u2019s FortiOS and FortiGate fortios_user_fsso_polling \u2013 Configure FSSO active directory servers for polling mode in Fortinet\u2019s FortiOS and FortiGate fortios_user_group \u2013 Configure user groups in Fortinet\u2019s FortiOS and FortiGate fortios_user_krb_keytab \u2013 Configure Kerberos keytab entries in Fortinet\u2019s FortiOS and FortiGate fortios_user_ldap \u2013 Configure LDAP server entries in Fortinet\u2019s FortiOS and FortiGate fortios_user_local \u2013 Configure local users in Fortinet\u2019s FortiOS and FortiGate fortios_user_password_policy \u2013 Configure user password policy in Fortinet\u2019s FortiOS and FortiGate fortios_user_peer \u2013 Configure peer users in Fortinet\u2019s FortiOS and FortiGate fortios_user_peergrp \u2013 Configure peer groups in Fortinet\u2019s FortiOS and FortiGate fortios_user_pop3 \u2013 POP3 server entry configuration in Fortinet\u2019s FortiOS and FortiGate fortios_user_quarantine \u2013 Configure quarantine support in Fortinet\u2019s FortiOS and FortiGate fortios_user_radius \u2013 Configure RADIUS server entries in Fortinet\u2019s FortiOS and FortiGate fortios_user_security_exempt_list \u2013 Configure security exemption list in Fortinet\u2019s FortiOS and FortiGate fortios_user_setting \u2013 Configure user authentication setting in Fortinet\u2019s FortiOS and FortiGate fortios_user_tacacsplus \u2013 Configure TACACS+ server entries in Fortinet\u2019s FortiOS and FortiGate fortios_voip_profile \u2013 Configure VoIP profiles in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_certificate_ca \u2013 CA certificate in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_certificate_crl \u2013 Certificate Revocation List as a PEM file in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_certificate_local \u2013 Local keys and certificates in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_certificate_ocsp_server \u2013 OCSP server configuration in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_certificate_remote \u2013 Remote certificate as a PEM file in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_certificate_setting \u2013 VPN certificate setting in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_concentrator \u2013 Concentrator configuration in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_forticlient \u2013 Configure FortiClient policy realm in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_manualkey \u2013 Configure IPsec manual keys in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_manualkey_interface \u2013 Configure IPsec manual keys in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_phase1 \u2013 Configure VPN remote gateway in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_phase1_interface \u2013 Configure VPN remote gateway in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_phase2 \u2013 Configure VPN autokey tunnel in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ipsec_phase2_interface \u2013 Configure VPN autokey tunnel in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_l2tp \u2013 Configure L2TP in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_pptp \u2013 Configure PPTP in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ssl_settings \u2013 Configure SSL VPN in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ssl_web_host_check_software \u2013 SSL-VPN host check software in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ssl_web_portal \u2013 Portal in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ssl_web_realm \u2013 Realm in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ssl_web_user_bookmark \u2013 Configure SSL VPN user bookmark in Fortinet\u2019s FortiOS and FortiGate fortios_vpn_ssl_web_user_group_bookmark \u2013 Configure SSL VPN user group bookmark in Fortinet\u2019s FortiOS and FortiGate fortios_waf_main_class \u2013 Hidden table for datasource in Fortinet\u2019s FortiOS and FortiGate fortios_waf_profile \u2013 Web application firewall configuration in Fortinet\u2019s FortiOS and FortiGate fortios_waf_signature \u2013 Hidden table for datasource in Fortinet\u2019s FortiOS and FortiGate fortios_waf_sub_class \u2013 Hidden table for datasource in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_auth_group \u2013 Configure WAN optimization authentication groups in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_cache_service \u2013 Designate cache-service for wan-optimization and webcache in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_content_delivery_network_rule \u2013 Configure WAN optimization content delivery network rules in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_peer \u2013 Configure WAN optimization peers in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_profile \u2013 Configure WAN optimization profiles in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_remote_storage \u2013 Configure a remote cache device as Web cache storage in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_settings \u2013 Configure WAN optimization settings in Fortinet\u2019s FortiOS and FortiGate fortios_wanopt_webcache \u2013 Configure global Web cache settings in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_debug_url \u2013 Configure debug URL addresses in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_explicit \u2013 Configure explicit Web proxy settings in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_forward_server \u2013 Configure forward-server addresses in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_forward_server_group \u2013 Configure a forward server group consisting or multiple forward servers. Supports failover and load balancing in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_global \u2013 Configure Web proxy global settings in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_profile \u2013 Configure web proxy profiles in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_url_match \u2013 Exempt URLs from web proxy forwarding and caching in Fortinet\u2019s FortiOS and FortiGate fortios_web_proxy_wisp \u2013 Configure Wireless Internet service provider (WISP) servers in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter \u2013 Configure webfilter capabilities of FortiGate and FortiOS fortios_webfilter_content \u2013 Configure Web filter banned word table in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_content_header \u2013 Configure content types used by Web filter in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_fortiguard \u2013 Configure FortiGuard Web Filter service in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_ftgd_local_cat \u2013 Configure FortiGuard Web Filter local categories in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_ftgd_local_rating \u2013 Configure local FortiGuard Web Filter local ratings in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_ips_urlfilter_cache_setting \u2013 Configure IPS URL filter cache settings in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_ips_urlfilter_setting \u2013 Configure IPS URL filter settings in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_ips_urlfilter_setting6 \u2013 Configure IPS URL filter settings for IPv6 in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_override \u2013 Configure FortiGuard Web Filter administrative overrides in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_profile \u2013 Configure Web filter profiles in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_search_engine \u2013 Configure web filter search engines in Fortinet\u2019s FortiOS and FortiGate fortios_webfilter_urlfilter \u2013 Configure URL filter lists in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_ap_status \u2013 Configure access point status (rogue | accepted | suppressed) in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_ble_profile \u2013 Configure Bluetooth Low Energy profile in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_bonjour_profile \u2013 Configure Bonjour profiles. Bonjour is Apple\u2019s zero configuration networking protocol. Bonjour profiles allow APs and FortiAPs to connect to networks using Bonjour in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_global \u2013 Configure wireless controller global settings in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_anqp_3gpp_cellular \u2013 Configure 3GPP public land mobile network (PLMN) in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_anqp_ip_address_type \u2013 Configure IP address type availability in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_anqp_nai_realm \u2013 Configure network access identifier (NAI) realm in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_anqp_network_auth_type \u2013 Configure network authentication type in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_anqp_roaming_consortium \u2013 Configure roaming consortium in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_anqp_venue_name \u2013 Configure venue name duple in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_h2qp_conn_capability \u2013 Configure connection capability in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_h2qp_operator_name \u2013 Configure operator friendly name in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_h2qp_osu_provider \u2013 Configure online sign up (OSU) provider list in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_h2qp_wan_metric \u2013 Configure WAN metrics in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_hs_profile \u2013 Configure hotspot profile in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_icon \u2013 Configure OSU provider icon in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_hotspot20_qos_map \u2013 Configure QoS map set in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_inter_controller \u2013 Configure inter wireless controller operation in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_qos_profile \u2013 Configure WiFi quality of service (QoS) profiles in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_setting \u2013 VDOM wireless controller configuration in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_timers \u2013 Configure CAPWAP timers in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_utm_profile \u2013 Configure UTM (Unified Threat Management) profile in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_vap \u2013 Configure Virtual Access Points (VAPs) in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_vap_group \u2013 Configure virtual Access Point (VAP) groups in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_wids_profile \u2013 Configure wireless intrusion detection system (WIDS) profiles in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_wtp \u2013 Configure Wireless Termination Points (WTPs), that is, FortiAPs or APs to be managed by FortiGate in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_wtp_group \u2013 Configure WTP groups in Fortinet\u2019s FortiOS and FortiGate fortios_wireless_controller_wtp_profile \u2013 Configure WTP profiles or FortiAP profiles that define radio settings for manageable FortiAP platforms in Fortinet\u2019s FortiOS and FortiGate","title":"Fortios"},{"location":"basic/Reference/Module/#frr","text":"frr_bgp \u2013 Configure global BGP settings on Free Range Routing(FRR) frr_facts \u2013 Collect facts from remote devices running Free Range Routing (FRR)","title":"Frr"},{"location":"basic/Reference/Module/#ftd","text":"ftd_configuration \u2013 Manages configuration on Cisco FTD devices over REST API ftd_file_download \u2013 Downloads files from Cisco FTD devices over HTTP(S) ftd_file_upload \u2013 Uploads files to Cisco FTD devices over HTTP(S) ftd_install \u2013 Installs FTD pkg image on the firewall","title":"Ftd"},{"location":"basic/Reference/Module/#icx","text":"icx_banner \u2013 Manage multiline banners on Ruckus ICX 7000 series switches icx_command \u2013 Run arbitrary commands on remote Ruckus ICX 7000 series switches icx_config \u2013 Manage configuration sections of Ruckus ICX 7000 series switches icx_copy \u2013 Transfer files from or to remote Ruckus ICX 7000 series switches icx_facts \u2013 Collect facts from remote Ruckus ICX 7000 series switches icx_interface \u2013 Manage Interface on Ruckus ICX 7000 series switches icx_l3_interface \u2013 Manage Layer-3 interfaces on Ruckus ICX 7000 series switches icx_linkagg \u2013 Manage link aggregation groups on Ruckus ICX 7000 series switches icx_lldp \u2013 Manage LLDP configuration on Ruckus ICX 7000 series switches icx_logging \u2013 Manage logging on Ruckus ICX 7000 series switches icx_ping \u2013 Tests reachability using ping from Ruckus ICX 7000 series switches icx_static_route \u2013 Manage static IP routes on Ruckus ICX 7000 series switches icx_system \u2013 Manage the system attributes on Ruckus ICX 7000 series switches icx_user \u2013 Manage the user accounts on Ruckus ICX 7000 series switches icx_vlan \u2013 Manage VLANs on Ruckus ICX 7000 series switches","title":"Icx"},{"location":"basic/Reference/Module/#illumos","text":"dladm_etherstub \u2013 Manage etherstubs on Solaris/illumos systems dladm_iptun \u2013 Manage IP tunnel interfaces on Solaris/illumos systems dladm_linkprop \u2013 Manage link properties on Solaris/illumos systems dladm_vlan \u2013 Manage VLAN interfaces on Solaris/illumos systems dladm_vnic \u2013 Manage VNICs on Solaris/illumos systems flowadm \u2013 Manage bandwidth resource control and priority for protocols, services and zones on Solaris/illumos systems ipadm_addr \u2013 Manage IP addresses on an interface on Solaris/illumos systems ipadm_addrprop \u2013 Manage IP address properties on Solaris/illumos systems ipadm_if \u2013 Manage IP interfaces on Solaris/illumos systems ipadm_ifprop \u2013 Manage IP interface properties on Solaris/illumos systems ipadm_prop \u2013 Manage protocol properties on Solaris/illumos systems","title":"Illumos"},{"location":"basic/Reference/Module/#ingate","text":"ig_config \u2013 Manage the configuration database on an Ingate SBC ig_unit_information \u2013 Get unit information from an Ingate SBC","title":"Ingate"},{"location":"basic/Reference/Module/#interface","text":"net_interface \u2013 Manage Interface on network devices (D) net_linkagg \u2013 Manage link aggregation groups on network devices (D) net_lldp_interface \u2013 Manage LLDP interfaces configuration on network devices (D)","title":"Interface"},{"location":"basic/Reference/Module/#ios","text":"ios_banner \u2013 Manage multiline banners on Cisco IOS devices ios_bgp \u2013 Configure global BGP protocol settings on Cisco IOS ios_command \u2013 Run commands on remote devices running Cisco IOS ios_config \u2013 Manage Cisco IOS configuration sections ios_facts \u2013 Collect facts from remote devices running Cisco IOS ios_interface \u2013 Manage Interface on Cisco IOS network devices (D) ios_interfaces \u2013 Manages interface attributes of Cisco IOS network devices ios_l2_interface \u2013 Manage Layer-2 interface on Cisco IOS devices (D) ios_l2_interfaces \u2013 Manage Layer-2 interface on Cisco IOS devices ios_l3_interface \u2013 Manage Layer-3 interfaces on Cisco IOS network devices (D) ios_l3_interfaces \u2013 Manage Layer-3 interface on Cisco IOS devices ios_lacp \u2013 Manage Global Link Aggregation Control Protocol (LACP) on Cisco IOS devices ios_lacp_interfaces \u2013 Manage Link Aggregation Control Protocol (LACP) on Cisco IOS devices interface ios_lag_interfaces \u2013 Manage Link Aggregation on Cisco IOS devices ios_linkagg \u2013 Manage link aggregation groups on Cisco IOS network devices ios_lldp \u2013 Manage LLDP configuration on Cisco IOS network devices ios_lldp_global \u2013 Configure and manage Link Layer Discovery Protocol(LLDP) attributes on IOS platforms ios_lldp_interfaces \u2013 Manage link layer discovery protocol (LLDP) attributes of interfaces on Cisco IOS devices ios_logging \u2013 Manage logging on network devices ios_ntp \u2013 Manages core NTP configuration ios_ping \u2013 Tests reachability using ping from Cisco IOS network devices ios_static_route \u2013 Manage static IP routes on Cisco IOS network devices ios_system \u2013 Manage the system attributes on Cisco IOS devices ios_user \u2013 Manage the aggregate of local users on Cisco IOS device ios_vlan \u2013 Manage VLANs on IOS network devices (D) ios_vlans \u2013 Manage VLANs on Cisco IOS devices ios_vrf \u2013 Manage the collection of VRF definitions on Cisco IOS devices","title":"Ios"},{"location":"basic/Reference/Module/#iosxr","text":"iosxr_banner \u2013 Manage multiline banners on Cisco IOS XR devices iosxr_bgp \u2013 Configure global BGP protocol settings on Cisco IOS-XR iosxr_command \u2013 Run commands on remote devices running Cisco IOS XR iosxr_config \u2013 Manage Cisco IOS XR configuration sections iosxr_facts \u2013 Get facts about iosxr devices iosxr_interface \u2013 Manage Interface on Cisco IOS XR network devices (D) iosxr_interfaces \u2013 Manage interface attributes on Cisco IOS-XR network devices iosxr_l2_interfaces \u2013 Manage Layer-2 interface on Cisco IOS-XR devices iosxr_l3_interfaces \u2013 Manage Layer-3 interface on Cisco IOS-XR devices iosxr_lacp \u2013 Manage Global Link Aggregation Control Protocol (LACP) on IOS-XR devices iosxr_lacp_interfaces \u2013 Manage Link Aggregation Control Protocol (LACP) attributes of interfaces on IOS-XR devices iosxr_lag_interfaces \u2013 Manages attributes of LAG/Ether-Bundle interfaces on IOS-XR devices iosxr_lldp_global \u2013 Manage Global Link Layer Discovery Protocol (LLDP) settings on IOS-XR devices iosxr_lldp_interfaces \u2013 Manage Link Layer Discovery Protocol (LLDP) attributes of interfaces on IOS-XR devices iosxr_logging \u2013 Configuration management of system logging services on network devices iosxr_netconf \u2013 Configures NetConf sub-system service on Cisco IOS-XR devices iosxr_system \u2013 Manage the system attributes on Cisco IOS XR devices iosxr_user \u2013 Manage the aggregate of local users on Cisco IOS XR device","title":"Iosxr"},{"location":"basic/Reference/Module/#ironware","text":"ironware_command \u2013 Run arbitrary commands on Extreme IronWare devices ironware_config \u2013 Manage configuration sections on Extreme Ironware devices ironware_facts \u2013 Collect facts from devices running Extreme Ironware","title":"Ironware"},{"location":"basic/Reference/Module/#itential","text":"iap_start_workflow \u2013 Start a workflow in the Itential Automation Platform iap_token \u2013 Get token for the Itential Automation Platform","title":"Itential"},{"location":"basic/Reference/Module/#junos","text":"junos_banner \u2013 Manage multiline banners on Juniper JUNOS devices junos_command \u2013 Run arbitrary commands on an Juniper JUNOS device junos_config \u2013 Manage configuration on devices running Juniper JUNOS junos_facts \u2013 Collect facts from remote devices running Juniper Junos junos_interface \u2013 Manage Interface on Juniper JUNOS network devices (D) junos_interfaces \u2013 Manages interface attributes of Juniper Junos OS network devices junos_l2_interface \u2013 Manage Layer-2 interface on Juniper JUNOS network devices (D) junos_l2_interfaces \u2013 Manage Layer-2 interface on Juniper JUNOS devices junos_l3_interface \u2013 Manage L3 interfaces on Juniper JUNOS network devices (D) junos_l3_interfaces \u2013 Manage Layer 3 interface on Juniper JUNOS devices junos_lacp \u2013 Manage Global Link Aggregation Control Protocol (LACP) on Juniper Junos devices junos_lacp_interfaces \u2013 Manage Link Aggregation Control Protocol (LACP) attributes of interfaces on Juniper JUNOS devices junos_lag_interfaces \u2013 Manage Link Aggregation on Juniper JUNOS devices junos_linkagg \u2013 Manage link aggregation groups on Juniper JUNOS network devices (D) junos_lldp \u2013 Manage LLDP configuration on Juniper JUNOS network devices (D) junos_lldp_global \u2013 Manage link layer discovery protocol (LLDP) attributes on Juniper JUNOS devices junos_lldp_interface \u2013 Manage LLDP interfaces configuration on Juniper JUNOS network devices (D) junos_lldp_interfaces \u2013 Manage link layer discovery protocol (LLDP) attributes of interfaces on Juniper JUNOS devices junos_logging \u2013 Manage logging on network devices junos_netconf \u2013 Configures the Junos Netconf system service junos_package \u2013 Installs packages on remote devices running Junos junos_ping \u2013 Tests reachability using ping from devices running Juniper JUNOS junos_rpc \u2013 Runs an arbitrary RPC over NetConf on an Juniper JUNOS device junos_scp \u2013 Transfer files from or to remote devices running Junos junos_static_route \u2013 Manage static IP routes on Juniper JUNOS network devices junos_system \u2013 Manage the system attributes on Juniper JUNOS devices junos_user \u2013 Manage local user accounts on Juniper JUNOS devices junos_vlan \u2013 Manage VLANs on Juniper JUNOS network devices (D) junos_vlans \u2013 Create and manage VLAN configurations on Junos OS junos_vrf \u2013 Manage the VRF definitions on Juniper JUNOS devices","title":"Junos"},{"location":"basic/Reference/Module/#layer2","text":"net_l2_interface \u2013 Manage Layer-2 interface on network devices (D) net_vlan \u2013 Manage VLANs on network devices (D)","title":"Layer2"},{"location":"basic/Reference/Module/#layer3","text":"net_l3_interface \u2013 Manage L3 interfaces on network devices (D) net_vrf \u2013 Manage VRFs on network devices (D)","title":"Layer3"},{"location":"basic/Reference/Module/#meraki","text":"meraki_admin \u2013 Manage administrators in the Meraki cloud meraki_config_template \u2013 Manage configuration templates in the Meraki cloud meraki_content_filtering \u2013 Edit Meraki MX content filtering policies meraki_device \u2013 Manage devices in the Meraki cloud meraki_firewalled_services \u2013 Edit firewall policies for administrative network services meraki_malware \u2013 Manage Malware Protection in the Meraki cloud meraki_mr_l3_firewall \u2013 Manage MR access point layer 3 firewalls in the Meraki cloud meraki_mx_l3_firewall \u2013 Manage MX appliance layer 3 firewalls in the Meraki cloud meraki_mx_l7_firewall \u2013 Manage MX appliance layer 7 firewalls in the Meraki cloud meraki_nat \u2013 Manage NAT rules in Meraki cloud meraki_network \u2013 Manage networks in the Meraki cloud meraki_organization \u2013 Manage organizations in the Meraki cloud meraki_snmp \u2013 Manage organizations in the Meraki cloud meraki_ssid \u2013 Manage wireless SSIDs in the Meraki cloud meraki_static_route \u2013 Manage static routes in the Meraki cloud meraki_switchport \u2013 Manage switchports on a switch in the Meraki cloud meraki_syslog \u2013 Manage syslog server settings in the Meraki cloud meraki_vlan \u2013 Manage VLANs in the Meraki cloud meraki_webhook \u2013 Manage webhooks configured in the Meraki cloud","title":"Meraki"},{"location":"basic/Reference/Module/#netact","text":"netact_cm_command \u2013 Manage network configuration data in Nokia Core and Radio networks","title":"Netact"},{"location":"basic/Reference/Module/#netconf","text":"netconf_config \u2013 netconf device configuration netconf_get \u2013 Fetch configuration/state data from NETCONF enabled network devices netconf_rpc \u2013 Execute operations on NETCONF enabled network devices","title":"Netconf"},{"location":"basic/Reference/Module/#netscaler","text":"netscaler_cs_action \u2013 Manage content switching actions netscaler_cs_policy \u2013 Manage content switching policy netscaler_cs_vserver \u2013 Manage content switching vserver netscaler_gslb_service \u2013 Manage gslb service entities in Netscaler netscaler_gslb_site \u2013 Manage gslb site entities in Netscaler netscaler_gslb_vserver \u2013 Configure gslb vserver entities in Netscaler netscaler_lb_monitor \u2013 Manage load balancing monitors netscaler_lb_vserver \u2013 Manage load balancing vserver configuration netscaler_nitro_request \u2013 Issue Nitro API requests to a Netscaler instance netscaler_save_config \u2013 Save Netscaler configuration netscaler_server \u2013 Manage server configuration netscaler_service \u2013 Manage service configuration in Netscaler netscaler_servicegroup \u2013 Manage service group configuration in Netscaler netscaler_ssl_certkey \u2013 Manage ssl certificate keys","title":"Netscaler"},{"location":"basic/Reference/Module/#netvisor","text":"pn_access_list \u2013 CLI command to create/delete access-list pn_access_list_ip \u2013 CLI command to add/remove access-list-ip pn_admin_service \u2013 CLI command to modify admin-service pn_admin_session_timeout \u2013 CLI command to modify admin-session-timeout pn_admin_syslog \u2013 CLI command to create/modify/delete admin-syslog pn_cluster \u2013 CLI command to create/delete a cluster (D) pn_connection_stats_settings \u2013 CLI command to modify connection-stats-settings pn_cpu_class \u2013 CLI command to create/modify/delete cpu-class pn_cpu_mgmt_class \u2013 CLI command to modify cpu-mgmt-class pn_dhcp_filter \u2013 CLI command to create/modify/delete dhcp-filter pn_dscp_map \u2013 CLI command to create/delete dscp-map pn_dscp_map_pri_map \u2013 CLI command to modify dscp-map-pri-map pn_fabric_local \u2013 CLI command to modify fabric-local pn_igmp_snooping \u2013 CLI command to modify igmp-snooping pn_ipv6security_raguard \u2013 CLI command to create/modify/delete ipv6security-raguard pn_ipv6security_raguard_port \u2013 CLI command to add/remove ipv6security-raguard-port pn_ipv6security_raguard_vlan \u2013 CLI command to add/remove ipv6security-raguard-vlan pn_log_audit_exception \u2013 CLI command to create/delete an audit exception pn_ospf \u2013 CLI command to add/remove ospf protocol to a vRouter (D) pn_ospfarea \u2013 CLI command to add/remove ospf area to/from a vrouter (D) pn_port_config \u2013 CLI command to modify port-config pn_port_cos_bw \u2013 CLI command to modify port-cos-bw pn_port_cos_rate_setting \u2013 CLI command to modify port-cos-rate-setting pn_prefix_list \u2013 CLI command to create/delete prefix-list pn_prefix_list_network \u2013 CLI command to add/remove prefix-list-network pn_role \u2013 CLI command to create/delete/modify role pn_show \u2013 Run show commands on nvOS device (D) pn_snmp_community \u2013 CLI command to create/modify/delete snmp-community pn_snmp_trap_sink \u2013 CLI command to create/delete snmp-trap-sink pn_snmp_vacm \u2013 CLI command to create/modify/delete snmp-vacm pn_stp \u2013 CLI command to modify stp pn_stp_port \u2013 CLI command to modify stp-port pn_switch_setup \u2013 CLI command to modify switch-setup pn_trunk \u2013 CLI command to create/delete/modify a trunk (D) pn_user \u2013 CLI command to create/modify/delete user pn_vflow_table_profile \u2013 CLI command to modify vflow-table-profile pn_vlag \u2013 CLI command to create/delete/modify vlag (D) pn_vlan \u2013 CLI command to create/delete a VLAN (D) pn_vrouter \u2013 CLI command to create/delete/modify a vrouter (D) pn_vrouter_bgp \u2013 CLI command to add/modify/remove vrouter-bgp pn_vrouter_bgp_network \u2013 CLI command to add/remove vrouter-bgp-network pn_vrouter_interface_ip \u2013 CLI command to add/remove vrouter-interface-ip pn_vrouter_loopback_interface \u2013 CLI command to add/remove vrouter-loopback-interface pn_vrouter_ospf \u2013 CLI command to add/remove vrouter-ospf pn_vrouter_ospf6 \u2013 CLI command to add/remove vrouter-ospf6 pn_vrouter_packet_relay \u2013 CLI command to add/remove vrouter-packet-relay pn_vrouter_pim_config \u2013 CLI command to modify vrouter-pim-config pn_vrouterbgp \u2013 CLI command to add/remove/modify vrouter-bgp (D) pn_vrouterif \u2013 CLI command to add/remove/modify vrouter-interface (D) pn_vrouterlbif \u2013 CLI command to add/remove vrouter-loopback-interface (D) pn_vtep \u2013 CLI command to create/delete vtep","title":"Netvisor"},{"location":"basic/Reference/Module/#nos","text":"nos_command \u2013 Run commands on remote devices running Extreme Networks NOS nos_config \u2013 Manage Extreme Networks NOS configuration sections nos_facts \u2013 Collect facts from devices running Extreme NOS","title":"Nos"},{"location":"basic/Reference/Module/#nso","text":"nso_action \u2013 Executes Cisco NSO actions and verifies output nso_config \u2013 Manage Cisco NSO configuration and service synchronization nso_query \u2013 Query data from Cisco NSO nso_show \u2013 Displays data from Cisco NSO nso_verify \u2013 Verifies Cisco NSO configuration","title":"Nso"},{"location":"basic/Reference/Module/#nuage","text":"nuage_vspk \u2013 Manage Nuage VSP environments","title":"Nuage"},{"location":"basic/Reference/Module/#nxos","text":"nxos_aaa_server \u2013 Manages AAA server global configuration nxos_aaa_server_host \u2013 Manages AAA server host-specific configuration nxos_acl \u2013 Manages access list entries for ACLs nxos_acl_interface \u2013 Manages applying ACLs to interfaces nxos_banner \u2013 Manage multiline banners on Cisco NXOS devices nxos_bfd_global \u2013 Bidirectional Forwarding Detection (BFD) global-level configuration nxos_bfd_interfaces \u2013 Manages BFD attributes of nxos interfaces nxos_bgp \u2013 Manages BGP configuration nxos_bgp_af \u2013 Manages BGP Address-family configuration nxos_bgp_neighbor \u2013 Manages BGP neighbors configurations nxos_bgp_neighbor_af \u2013 Manages BGP address-family\u2019s neighbors configuration nxos_command \u2013 Run arbitrary command on Cisco NXOS devices nxos_config \u2013 Manage Cisco NXOS configuration sections nxos_evpn_global \u2013 Handles the EVPN control plane for VXLAN nxos_evpn_vni \u2013 Manages Cisco EVPN VXLAN Network Identifier (VNI) nxos_facts \u2013 Gets facts about NX-OS switches nxos_feature \u2013 Manage features in NX-OS switches nxos_file_copy \u2013 Copy a file to a remote NXOS device nxos_gir \u2013 Trigger a graceful removal or insertion (GIR) of the switch nxos_gir_profile_management \u2013 Create a maintenance-mode or normal-mode profile for GIR nxos_hsrp \u2013 Manages HSRP configuration on NX-OS switches nxos_igmp \u2013 Manages IGMP global configuration nxos_igmp_interface \u2013 Manages IGMP interface configuration nxos_igmp_snooping \u2013 Manages IGMP snooping global configuration nxos_install_os \u2013 Set boot options like boot, kickstart image and issu nxos_interface \u2013 Manages physical attributes of interfaces (D) nxos_interface_ospf \u2013 Manages configuration of an OSPF interface instance nxos_interfaces \u2013 Manages interface attributes of NX-OS Interfaces nxos_l2_interface \u2013 Manage Layer-2 interface on Cisco NXOS devices (D) nxos_l2_interfaces \u2013 Manages Layer-2 Interfaces attributes of NX-OS Interfaces nxos_l3_interface \u2013 Manage L3 interfaces on Cisco NXOS network devices (D) nxos_l3_interfaces \u2013 Manages Layer-3 Interfaces attributes of NX-OS Interfaces nxos_lacp \u2013 Manage Global Link Aggregation Control Protocol (LACP) on Cisco NX-OS devices nxos_lacp_interfaces \u2013 Manage Link Aggregation Control Protocol (LACP) attributes of interfaces on Cisco NX-OS devices nxos_lag_interfaces \u2013 Manages link aggregation groups of NX-OS Interfaces nxos_linkagg \u2013 Manage link aggregation groups on Cisco NXOS devices (D) nxos_lldp \u2013 Manage LLDP configuration on Cisco NXOS network devices nxos_lldp_global \u2013 Configure and manage Link Layer Discovery Protocol(LLDP) attributes on NX-OS platforms nxos_logging \u2013 Manage logging on network devices nxos_ntp \u2013 Manages core NTP configuration nxos_ntp_auth \u2013 Manages NTP authentication nxos_ntp_options \u2013 Manages NTP options nxos_nxapi \u2013 Manage NXAPI configuration on an NXOS device nxos_ospf \u2013 Manages configuration of an ospf instance nxos_ospf_vrf \u2013 Manages a VRF for an OSPF router nxos_overlay_global \u2013 Configures anycast gateway MAC of the switch nxos_pim \u2013 Manages configuration of a PIM instance nxos_pim_interface \u2013 Manages PIM interface configuration nxos_pim_rp_address \u2013 Manages configuration of an PIM static RP address instance nxos_ping \u2013 Tests reachability using ping from Nexus switch nxos_reboot \u2013 Reboot a network device nxos_rollback \u2013 Set a checkpoint or rollback to a checkpoint nxos_rpm \u2013 Install patch or feature rpms on Cisco NX-OS devices nxos_smu \u2013 Perform SMUs on Cisco NX-OS devices nxos_snapshot \u2013 Manage snapshots of the running states of selected features nxos_snmp_community \u2013 Manages SNMP community configs nxos_snmp_contact \u2013 Manages SNMP contact info nxos_snmp_host \u2013 Manages SNMP host configuration nxos_snmp_location \u2013 Manages SNMP location information nxos_snmp_traps \u2013 Manages SNMP traps nxos_snmp_user \u2013 Manages SNMP users for monitoring nxos_static_route \u2013 Manages static route configuration nxos_system \u2013 Manage the system attributes on Cisco NXOS devices nxos_telemetry \u2013 Telemetry Monitoring Service (TMS) configuration nxos_udld \u2013 Manages UDLD global configuration params nxos_udld_interface \u2013 Manages UDLD interface configuration params nxos_user \u2013 Manage the collection of local users on Nexus devices nxos_vlan \u2013 Manages VLAN resources and attributes (D) nxos_vlans \u2013 Create VLAN and manage VLAN configurations on NX-OS Interfaces nxos_vpc \u2013 Manages global VPC configuration nxos_vpc_interface \u2013 Manages interface VPC configuration nxos_vrf \u2013 Manages global VRF configuration nxos_vrf_af \u2013 Manages VRF AF nxos_vrf_interface \u2013 Manages interface specific VRF configuration nxos_vrrp \u2013 Manages VRRP configuration on NX-OS switches nxos_vtp_domain \u2013 Manages VTP domain configuration nxos_vtp_password \u2013 Manages VTP password configuration nxos_vtp_version \u2013 Manages VTP version configuration nxos_vxlan_vtep \u2013 Manages VXLAN Network Virtualization Endpoint (NVE) nxos_vxlan_vtep_vni \u2013 Creates a Virtual Network Identifier member (VNI)","title":"Nxos"},{"location":"basic/Reference/Module/#onyx","text":"onyx_bgp \u2013 Configures BGP on Mellanox ONYX network devices onyx_buffer_pool \u2013 Configures Buffer Pool onyx_command \u2013 Run commands on remote devices running Mellanox ONYX onyx_config \u2013 Manage Mellanox ONYX configuration sections onyx_facts \u2013 Collect facts from Mellanox ONYX network devices onyx_igmp \u2013 Configures IGMP global parameters onyx_igmp_interface \u2013 Configures IGMP interface parameters onyx_igmp_vlan \u2013 Configures IGMP Vlan parameters onyx_interface \u2013 Manage Interfaces on Mellanox ONYX network devices onyx_l2_interface \u2013 Manage Layer-2 interface on Mellanox ONYX network devices onyx_l3_interface \u2013 Manage L3 interfaces on Mellanox ONYX network devices onyx_linkagg \u2013 Manage link aggregation groups on Mellanox ONYX network devices onyx_lldp \u2013 Manage LLDP configuration on Mellanox ONYX network devices onyx_lldp_interface \u2013 Manage LLDP interfaces configuration on Mellanox ONYX network devices onyx_magp \u2013 Manage MAGP protocol on Mellanox ONYX network devices onyx_mlag_ipl \u2013 Manage IPL (inter-peer link) on Mellanox ONYX network devices onyx_mlag_vip \u2013 Configures MLAG VIP on Mellanox ONYX network devices onyx_ospf \u2013 Manage OSPF protocol on Mellanox ONYX network devices onyx_pfc_interface \u2013 Manage priority flow control on ONYX network devices onyx_protocol \u2013 Enables/Disables protocols on Mellanox ONYX network devices onyx_ptp_global \u2013 Configures PTP Global parameters onyx_ptp_interface \u2013 Configures PTP on interface onyx_qos \u2013 Configures QoS onyx_traffic_class \u2013 Configures Traffic Class onyx_vlan \u2013 Manage VLANs on Mellanox ONYX network devices onyx_vxlan \u2013 Configures Vxlan onyx_wjh \u2013 Configure what-just-happend module","title":"Onyx"},{"location":"basic/Reference/Module/#opx","text":"opx_cps \u2013 CPS operations on networking device running Openswitch (OPX)","title":"Opx"},{"location":"basic/Reference/Module/#ordnance","text":"ordnance_config \u2013 Manage Ordnance configuration sections ordnance_facts \u2013 Collect facts from Ordnance Virtual Routers over SSH","title":"Ordnance"},{"location":"basic/Reference/Module/#ovs","text":"openvswitch_bridge \u2013 Manage Open vSwitch bridges openvswitch_db \u2013 Configure open vswitch database openvswitch_port \u2013 Manage Open vSwitch ports","title":"Ovs"},{"location":"basic/Reference/Module/#panos","text":"panos_admin \u2013 Add or modify PAN-OS user accounts password (D) panos_admpwd \u2013 change admin password of PAN-OS device using SSH with SSH key (D) panos_cert_gen_ssh \u2013 generates a self-signed certificate using SSH protocol with SSH key (D) panos_check \u2013 check if PAN-OS device is ready for configuration (D) panos_commit \u2013 commit firewall\u2019s candidate configuration (D) panos_dag \u2013 create a dynamic address group (D) panos_dag_tags \u2013 Create tags for DAG\u2019s on PAN-OS devices (D) panos_import \u2013 import file on PAN-OS devices (D) panos_interface \u2013 configure data-port network interface for DHCP (D) panos_lic \u2013 apply authcode to a device/instance (D) panos_loadcfg \u2013 load configuration on PAN-OS device (D) panos_match_rule \u2013 Test for match against a security rule on PAN-OS devices or Panorama management console (D) panos_mgtconfig \u2013 configure management settings of device (D) panos_nat_rule \u2013 create a policy NAT rule (D) panos_object \u2013 create/read/update/delete object in PAN-OS or Panorama (D) panos_op \u2013 execute arbitrary OP commands on PANW devices (e.g. show interface all) (D) panos_pg \u2013 create a security profiles group (D) panos_query_rules \u2013 PANOS module that allows search for security rules in PANW NGFW devices (D) panos_restart \u2013 restart a device (D) panos_sag \u2013 Create a static address group (D) panos_security_rule \u2013 Create security rule policy on PAN-OS devices or Panorama management console (D) panos_set \u2013 Execute arbitrary commands on a PAN-OS device using XPath and element (D)","title":"Panos"},{"location":"basic/Reference/Module/#protocol","text":"net_lldp \u2013 Manage LLDP service configuration on network devices (D)","title":"Protocol"},{"location":"basic/Reference/Module/#radware","text":"vdirect_commit \u2013 Commits pending configuration changes on Radware devices vdirect_file \u2013 Uploads a new or updates an existing runnable file into Radware vDirect server vdirect_runnable \u2013 Runs templates and workflow actions in Radware vDirect server","title":"Radware"},{"location":"basic/Reference/Module/#restconf","text":"restconf_config \u2013 Handles create, update, read and delete of configuration data on RESTCONF enabled devices restconf_get \u2013 Fetch configuration/state data from RESTCONF enabled devices","title":"Restconf"},{"location":"basic/Reference/Module/#routeros","text":"routeros_command \u2013 Run commands on remote devices running MikroTik RouterOS routeros_facts \u2013 Collect facts from remote devices running MikroTik RouterOS","title":"Routeros"},{"location":"basic/Reference/Module/#routing","text":"net_static_route \u2013 Manage static IP routes on network appliances (routers, switches et. al.) (D)","title":"Routing"},{"location":"basic/Reference/Module/#skydive","text":"skydive_capture \u2013 Module which manages flow capture on interfaces skydive_edge \u2013 Module to add edges to Skydive topology skydive_node \u2013 Module which add nodes to Skydive topology","title":"Skydive"},{"location":"basic/Reference/Module/#slxos","text":"slxos_command \u2013 Run commands on remote devices running Extreme Networks SLX-OS slxos_config \u2013 Manage Extreme Networks SLX-OS configuration sections slxos_facts \u2013 Collect facts from devices running Extreme SLX-OS slxos_interface \u2013 Manage Interfaces on Extreme SLX-OS network devices slxos_l2_interface \u2013 Manage Layer-2 interface on Extreme Networks SLX-OS devices slxos_l3_interface \u2013 Manage L3 interfaces on Extreme Networks SLX-OS network devices slxos_linkagg \u2013 Manage link aggregation groups on Extreme Networks SLX-OS network devices slxos_lldp \u2013 Manage LLDP configuration on Extreme Networks SLX-OS network devices slxos_vlan \u2013 Manage VLANs on Extreme Networks SLX-OS network devices","title":"Slxos"},{"location":"basic/Reference/Module/#sros","text":"sros_command \u2013 Run commands on remote devices running Nokia SR OS sros_config \u2013 Manage Nokia SR OS device configuration sros_rollback \u2013 Configure Nokia SR OS rollback","title":"Sros"},{"location":"basic/Reference/Module/#system","text":"net_banner \u2013 Manage multiline banners on network devices (D) net_logging \u2013 Manage logging on network devices (D) net_ping \u2013 Tests reachability using ping from a network device net_system \u2013 Manage the system attributes on network devices (D) net_user \u2013 Manage the aggregate of local users on network device (D)","title":"System"},{"location":"basic/Reference/Module/#voss","text":"voss_command \u2013 Run commands on remote devices running Extreme VOSS voss_config \u2013 Manage Extreme VOSS configuration sections voss_facts \u2013 Collect facts from remote devices running Extreme VOSS","title":"Voss"},{"location":"basic/Reference/Module/#vyos","text":"vyos_banner \u2013 Manage multiline banners on VyOS devices vyos_command \u2013 Run one or more commands on VyOS devices vyos_config \u2013 Manage VyOS configuration on remote device vyos_facts \u2013 Get facts about vyos devices vyos_interface \u2013 Manage Interface on VyOS network devices (D) vyos_interfaces \u2013 Manages interface attributes of VyOS network devices vyos_l3_interface \u2013 Manage L3 interfaces on VyOS network devices (D) vyos_l3_interfaces \u2013 Manages L3 interface attributes of VyOS network devices vyos_lag_interfaces \u2013 Manages attributes of link aggregation groups on VyOS network devices vyos_linkagg \u2013 Manage link aggregation groups on VyOS network devices (D) vyos_lldp \u2013 Manage LLDP configuration on VyOS network devices (D) vyos_lldp_global \u2013 Manage link layer discovery protocol (LLDP) attributes on VyOS devices vyos_lldp_interface \u2013 Manage LLDP interfaces configuration on VyOS network devices (D) vyos_lldp_interfaces \u2013 Manages attributes of lldp interfaces on VyOS devices vyos_logging \u2013 Manage logging on network devices vyos_ping \u2013 Tests reachability using ping from VyOS network devices vyos_static_route \u2013 Manage static IP routes on Vyatta VyOS network devices vyos_system \u2013 Run set system commands on VyOS devices vyos_user \u2013 Manage the collection of local users on VyOS device vyos_vlan \u2013 Manage VLANs on VyOS network devices","title":"Vyos"},{"location":"basic/Reference/Module/#notification-modules","text":"bearychat \u2013 Send BearyChat notifications campfire \u2013 Send a message to Campfire catapult \u2013 Send a sms / mms using the catapult bandwidth api cisco_spark \u2013 Send a message to a Cisco Spark Room or Individual flowdock \u2013 Send a message to a flowdock grove \u2013 Sends a notification to a grove.io channel hipchat \u2013 Send a message to Hipchat irc \u2013 Send a message to an IRC channel jabber \u2013 Send a message to jabber user or chat room logentries_msg \u2013 Send a message to logentries mail \u2013 Send an email matrix \u2013 Send notifications to matrix mattermost \u2013 Send Mattermost notifications mqtt \u2013 Publish a message on an MQTT topic for the IoT nexmo \u2013 Send a SMS via nexmo office_365_connector_card \u2013 Use webhooks to create Connector Card messages within an Office 365 group pushbullet \u2013 Sends notifications to Pushbullet pushover \u2013 Send notifications via https://pushover.net rabbitmq_publish \u2013 Publish a message to a RabbitMQ queue rocketchat \u2013 Send notifications to Rocket Chat say \u2013 Makes a computer to speak sendgrid \u2013 Sends an email with the SendGrid API slack \u2013 Send Slack notifications snow_record \u2013 Manage records in ServiceNow snow_record_find \u2013 Search for multiple records from ServiceNow syslogger \u2013 Log messages in the syslog telegram \u2013 module for sending notifications via telegram twilio \u2013 Sends a text message to a mobile phone through Twilio typetalk \u2013 Send a message to typetalk","title":"Notification modules"},{"location":"basic/Reference/Module/#packaging-modules","text":"","title":"Packaging modules"},{"location":"basic/Reference/Module/#language","text":"bower \u2013 Manage bower packages with bower bundler \u2013 Manage Ruby Gem dependencies with Bundler composer \u2013 Dependency Manager for PHP cpanm \u2013 Manages Perl library dependencies easy_install \u2013 Installs Python libraries gem \u2013 Manage Ruby gems maven_artifact \u2013 Downloads an Artifact from a Maven Repository npm \u2013 Manage node.js packages with npm pear \u2013 Manage pear/pecl packages pip \u2013 Manages Python library dependencies pip_package_info \u2013 pip package information yarn \u2013 Manage node.js packages with Yarn","title":"Language"},{"location":"basic/Reference/Module/#os","text":"apk \u2013 Manages apk packages apt \u2013 Manages apt-packages apt_key \u2013 Add or remove an apt key apt_repo \u2013 Manage APT repositories via apt-repo apt_repository \u2013 Add and remove APT repositories apt_rpm \u2013 apt_rpm package manager dnf \u2013 Manages packages with the dnf package manager dpkg_selections \u2013 Dpkg package selection selections flatpak \u2013 Manage flatpaks flatpak_remote \u2013 Manage flatpak repository remotes homebrew \u2013 Package manager for Homebrew homebrew_cask \u2013 Install/uninstall homebrew casks homebrew_tap \u2013 Tap a Homebrew repository installp \u2013 Manage packages on AIX layman \u2013 Manage Gentoo overlays macports \u2013 Package manager for MacPorts openbsd_pkg \u2013 Manage packages on OpenBSD opkg \u2013 Package manager for OpenWrt package \u2013 Generic OS package manager package_facts \u2013 package information as facts pacman \u2013 Manage packages with pacman pkg5 \u2013 Manages packages with the Solaris 11 Image Packaging System pkg5_publisher \u2013 Manages Solaris 11 Image Packaging System publishers pkgin \u2013 Package manager for SmartOS, NetBSD, et al pkgng \u2013 Package manager for FreeBSD >= 9.0 pkgutil \u2013 Manage CSW-Packages on Solaris portage \u2013 Package manager for Gentoo portinstall \u2013 Installing packages from FreeBSD\u2019s ports system pulp_repo \u2013 Add or remove Pulp repos from a remote host redhat_subscription \u2013 Manage registration and subscriptions to RHSM using the subscription-manager command rhn_channel \u2013 Adds or removes Red Hat software channels rhn_register \u2013 Manage Red Hat Network registration using the rhnreg_ks command rhsm_release \u2013 Set or Unset RHSM Release version rhsm_repository \u2013 Manage RHSM repositories using the subscription-manager command rpm_key \u2013 Adds or removes a gpg key from the rpm db slackpkg \u2013 Package manager for Slackware >= 12.2 snap \u2013 Manages snaps sorcery \u2013 Package manager for Source Mage GNU/Linux svr4pkg \u2013 Manage Solaris SVR4 packages swdepot \u2013 Manage packages with swdepot package manager (HP-UX) swupd \u2013 Manages updates and bundles in ClearLinux systems urpmi \u2013 Urpmi manager xbps \u2013 Manage packages with XBPS yum \u2013 Manages packages with the yum package manager yum_repository \u2013 Add or remove YUM repositories zypper \u2013 Manage packages on SUSE and openSUSE zypper_repository \u2013 Add and remove Zypper repositories","title":"Os"},{"location":"basic/Reference/Module/#remote-management-modules","text":"wakeonlan \u2013 Send a magic Wake-on-LAN (WoL) broadcast packet","title":"Remote Management modules"},{"location":"basic/Reference/Module/#cobbler","text":"cobbler_sync \u2013 Sync Cobbler cobbler_system \u2013 Manage system objects in Cobbler","title":"Cobbler"},{"location":"basic/Reference/Module/#cpm","text":"cpm_plugconfig \u2013 Get and Set Plug Parameters on WTI OOB and PDU power devices cpm_plugcontrol \u2013 Get and Set Plug actions on WTI OOB and PDU power devices cpm_serial_port_config \u2013 Set Serial port parameters in WTI OOB and PDU devices cpm_serial_port_info \u2013 Get Serial port parameters in WTI OOB and PDU devices cpm_user \u2013 Get various status and parameters from WTI OOB and PDU devices","title":"Cpm"},{"location":"basic/Reference/Module/#dellemc","text":"idrac_firmware \u2013 Firmware update from a repository on a network share (CIFS, NFS) idrac_server_config_profile \u2013 Export or Import iDRAC Server Configuration Profile (SCP) ome_device_info \u2013 Retrieves the information about Device","title":"Dellemc"},{"location":"basic/Reference/Module/#foreman","text":"foreman \u2013 Manage Foreman Resources (D) katello \u2013 Manage Katello Resources (D)","title":"Foreman"},{"location":"basic/Reference/Module/#hpilo","text":"hpilo_boot \u2013 Boot system using specific media through HP iLO interface hpilo_info \u2013 Gather information through an HP iLO interface hponcfg \u2013 Configure HP iLO interface using hponcfg","title":"Hpilo"},{"location":"basic/Reference/Module/#imc","text":"imc_rest \u2013 Manage Cisco IMC hardware through its REST API","title":"Imc"},{"location":"basic/Reference/Module/#intersight","text":"intersight_info \u2013 Gather information about Intersight intersight_rest_api \u2013 REST API configuration for Cisco Intersight","title":"Intersight"},{"location":"basic/Reference/Module/#ipmi","text":"ipmi_boot \u2013 Management of order of boot devices ipmi_power \u2013 Power management for machine","title":"Ipmi"},{"location":"basic/Reference/Module/#lxca","text":"lxca_cmms \u2013 Custom module for lxca cmms inventory utility lxca_nodes \u2013 Custom module for lxca nodes inventory utility","title":"Lxca"},{"location":"basic/Reference/Module/#manageiq","text":"manageiq_alert_profiles \u2013 Configuration of alert profiles for ManageIQ manageiq_alerts \u2013 Configuration of alerts in ManageIQ manageiq_group \u2013 Management of groups in ManageIQ manageiq_policies \u2013 Management of resource policy_profiles in ManageIQ manageiq_provider \u2013 Management of provider in ManageIQ manageiq_tags \u2013 Management of resource tags in ManageIQ manageiq_tenant \u2013 Management of tenants in ManageIQ manageiq_user \u2013 Management of users in ManageIQ","title":"Manageiq"},{"location":"basic/Reference/Module/#oneview","text":"oneview_datacenter_info \u2013 Retrieve information about the OneView Data Centers oneview_enclosure_info \u2013 Retrieve information about one or more Enclosures oneview_ethernet_network \u2013 Manage OneView Ethernet Network resources oneview_ethernet_network_info \u2013 Retrieve the information about one or more of the OneView Ethernet Networks oneview_fc_network \u2013 Manage OneView Fibre Channel Network resources oneview_fc_network_info \u2013 Retrieve the information about one or more of the OneView Fibre Channel Networks oneview_fcoe_network \u2013 Manage OneView FCoE Network resources oneview_fcoe_network_info \u2013 Retrieve the information about one or more of the OneView FCoE Networks oneview_logical_interconnect_group \u2013 Manage OneView Logical Interconnect Group resources oneview_logical_interconnect_group_info \u2013 Retrieve information about one or more of the OneView Logical Interconnect Groups oneview_network_set \u2013 Manage HPE OneView Network Set resources oneview_network_set_info \u2013 Retrieve information about the OneView Network Sets oneview_san_manager \u2013 Manage OneView SAN Manager resources oneview_san_manager_info \u2013 Retrieve information about one or more of the OneView SAN Managers","title":"Oneview"},{"location":"basic/Reference/Module/#redfish","text":"idrac_redfish_command \u2013 Manages Out-Of-Band controllers using iDRAC OEM Redfish APIs idrac_redfish_config \u2013 Manages servers through iDRAC using Dell Redfish APIs idrac_redfish_info \u2013 Manages servers through iDRAC using Dell Redfish APIs redfish_command \u2013 Manages Out-Of-Band controllers using Redfish APIs redfish_config \u2013 Manages Out-Of-Band controllers using Redfish APIs redfish_info \u2013 Manages Out-Of-Band controllers using Redfish APIs","title":"Redfish"},{"location":"basic/Reference/Module/#stacki","text":"stacki_host \u2013 Add or remove host to stacki front-end","title":"Stacki"},{"location":"basic/Reference/Module/#ucs","text":"ucs_disk_group_policy \u2013 Configures disk group policies on Cisco UCS Manager ucs_dns_server \u2013 Configure DNS servers on Cisco UCS Manager ucs_ip_pool \u2013 Configures IP address pools on Cisco UCS Manager ucs_lan_connectivity \u2013 Configures LAN Connectivity Policies on Cisco UCS Manager ucs_mac_pool \u2013 Configures MAC address pools on Cisco UCS Manager ucs_managed_objects \u2013 Configures Managed Objects on Cisco UCS Manager ucs_ntp_server \u2013 Configures NTP server on Cisco UCS Manager ucs_org \u2013 Manages UCS Organizations for UCS Manager ucs_san_connectivity \u2013 Configures SAN Connectivity Policies on Cisco UCS Manager ucs_service_profile_template \u2013 Configures Service Profile Templates on Cisco UCS Manager ucs_storage_profile \u2013 Configures storage profiles on Cisco UCS Manager ucs_timezone \u2013 Configures timezone on Cisco UCS Manager ucs_uuid_pool \u2013 Configures server UUID pools on Cisco UCS Manager ucs_vhba_template \u2013 Configures vHBA templates on Cisco UCS Manager ucs_vlan_find \u2013 Find VLANs on Cisco UCS Manager ucs_vlans \u2013 Configures VLANs on Cisco UCS Manager ucs_vnic_template \u2013 Configures vNIC templates on Cisco UCS Manager ucs_vsans \u2013 Configures VSANs on Cisco UCS Manager ucs_wwn_pool \u2013 Configures WWNN or WWPN pools on Cisco UCS Manager","title":"Ucs"},{"location":"basic/Reference/Module/#source-control-modules","text":"bzr \u2013 Deploy software (or files) from bzr branches git \u2013 Deploy software (or files) from git checkouts git_config \u2013 Read and write git configuration github_deploy_key \u2013 Manages deploy keys for GitHub repositories github_hooks \u2013 Manages GitHub service hooks (D) github_issue \u2013 View GitHub issue github_key \u2013 Manage GitHub access keys github_release \u2013 Interact with GitHub Releases github_webhook \u2013 Manage GitHub webhooks github_webhook_info \u2013 Query information about GitHub webhooks gitlab_deploy_key \u2013 Manages GitLab project deploy keys gitlab_group \u2013 Creates/updates/deletes GitLab Groups gitlab_hook \u2013 Manages GitLab project hooks gitlab_project \u2013 Creates/updates/deletes GitLab Projects gitlab_project_variable \u2013 Creates/updates/deletes GitLab Projects Variables gitlab_runner \u2013 Create, modify and delete GitLab Runners gitlab_user \u2013 Creates/updates/deletes GitLab Users hg \u2013 Manages Mercurial (hg) repositories subversion \u2013 Deploys a subversion repository","title":"Source Control modules"},{"location":"basic/Reference/Module/#bitbucket","text":"bitbucket_access_key \u2013 Manages Bitbucket repository access keys bitbucket_pipeline_key_pair \u2013 Manages Bitbucket pipeline SSH key pair bitbucket_pipeline_known_host \u2013 Manages Bitbucket pipeline known hosts bitbucket_pipeline_variable \u2013 Manages Bitbucket pipeline variables","title":"Bitbucket"},{"location":"basic/Reference/Module/#storage-modules","text":"","title":"Storage modules"},{"location":"basic/Reference/Module/#emc","text":"emc_vnx_sg_member \u2013 Manage storage group member on EMC VNX","title":"Emc"},{"location":"basic/Reference/Module/#glusterfs","text":"gluster_heal_info \u2013 Gather information on self-heal or rebalance status gluster_peer \u2013 Attach/Detach peers to/from the cluster gluster_volume \u2013 Manage GlusterFS volumes","title":"Glusterfs"},{"location":"basic/Reference/Module/#hpe3par","text":"ss_3par_cpg \u2013 Manage HPE StoreServ 3PAR CPG","title":"Hpe3Par"},{"location":"basic/Reference/Module/#ibm","text":"ibm_sa_domain \u2013 Manages domains on IBM Spectrum Accelerate Family storage systems ibm_sa_host \u2013 Adds hosts to or removes them from IBM Spectrum Accelerate Family storage systems ibm_sa_host_ports \u2013 Add host ports on IBM Spectrum Accelerate Family storage systems ibm_sa_pool \u2013 Handles pools on IBM Spectrum Accelerate Family storage systems ibm_sa_vol \u2013 Handle volumes on IBM Spectrum Accelerate Family storage systems ibm_sa_vol_map \u2013 Handles volume mapping on IBM Spectrum Accelerate Family storage systems","title":"Ibm"},{"location":"basic/Reference/Module/#infinidat","text":"infini_export \u2013 Create, Delete or Modify NFS Exports on Infinibox infini_export_client \u2013 Create, Delete or Modify NFS Client(s) for existing exports on Infinibox infini_fs \u2013 Create, Delete or Modify filesystems on Infinibox infini_host \u2013 Create, Delete and Modify Hosts on Infinibox infini_pool \u2013 Create, Delete and Modify Pools on Infinibox infini_vol \u2013 Create, Delete or Modify volumes on Infinibox","title":"Infinidat"},{"location":"basic/Reference/Module/#netapp","text":"na_cdot_aggregate \u2013 Manage NetApp cDOT aggregates (D) na_cdot_license \u2013 Manage NetApp cDOT protocol and feature licenses (D) na_cdot_lun \u2013 Manage NetApp cDOT luns (D) na_cdot_qtree \u2013 Manage qtrees (D) na_cdot_svm \u2013 Manage NetApp cDOT svm (D) na_cdot_user \u2013 useradmin configuration and management (D) na_cdot_user_role \u2013 useradmin configuration and management (D) na_cdot_volume \u2013 Manage NetApp cDOT volumes (D) na_elementsw_access_group \u2013 NetApp Element Software Manage Access Groups na_elementsw_account \u2013 NetApp Element Software Manage Accounts na_elementsw_admin_users \u2013 NetApp Element Software Manage Admin Users na_elementsw_backup \u2013 NetApp Element Software Create Backups na_elementsw_check_connections \u2013 NetApp Element Software Check connectivity to MVIP and SVIP na_elementsw_cluster \u2013 NetApp Element Software Create Cluster na_elementsw_cluster_config \u2013 Configure Element SW Cluster na_elementsw_cluster_pair \u2013 NetApp Element Software Manage Cluster Pair na_elementsw_cluster_snmp \u2013 Configure Element SW Cluster SNMP na_elementsw_drive \u2013 NetApp Element Software Manage Node Drives na_elementsw_initiators \u2013 Manage Element SW initiators na_elementsw_ldap \u2013 NetApp Element Software Manage ldap admin users na_elementsw_network_interfaces \u2013 NetApp Element Software Configure Node Network Interfaces na_elementsw_node \u2013 NetApp Element Software Node Operation na_elementsw_snapshot \u2013 NetApp Element Software Manage Snapshots na_elementsw_snapshot_restore \u2013 NetApp Element Software Restore Snapshot na_elementsw_snapshot_schedule \u2013 NetApp Element Software Snapshot Schedules na_elementsw_vlan \u2013 NetApp Element Software Manage VLAN na_elementsw_volume \u2013 NetApp Element Software Manage Volumes na_elementsw_volume_clone \u2013 NetApp Element Software Create Volume Clone na_elementsw_volume_pair \u2013 NetApp Element Software Volume Pair na_ontap_aggregate \u2013 NetApp ONTAP manage aggregates na_ontap_autosupport \u2013 NetApp ONTAP Autosupport na_ontap_broadcast_domain \u2013 NetApp ONTAP manage broadcast domains na_ontap_broadcast_domain_ports \u2013 NetApp ONTAP manage broadcast domain ports na_ontap_cg_snapshot \u2013 NetApp ONTAP manage consistency group snapshot na_ontap_cifs \u2013 NetApp ONTAP Manage cifs-share na_ontap_cifs_acl \u2013 NetApp ONTAP manage cifs-share-access-control na_ontap_cifs_server \u2013 NetApp ONTAP CIFS server configuration na_ontap_cluster \u2013 NetApp ONTAP cluster - create, join, add license na_ontap_cluster_ha \u2013 NetApp ONTAP Manage HA status for cluster na_ontap_cluster_peer \u2013 NetApp ONTAP Manage Cluster peering na_ontap_command \u2013 NetApp ONTAP Run any cli command, the username provided needs to have console login permission na_ontap_disks \u2013 NetApp ONTAP Assign disks to nodes na_ontap_dns \u2013 NetApp ONTAP Create, delete, modify DNS servers na_ontap_export_policy \u2013 NetApp ONTAP manage export-policy na_ontap_export_policy_rule \u2013 NetApp ONTAP manage export policy rules na_ontap_fcp \u2013 NetApp ONTAP Start, Stop and Enable FCP services na_ontap_firewall_policy \u2013 NetApp ONTAP Manage a firewall policy na_ontap_firmware_upgrade \u2013 NetApp ONTAP firmware upgrade for SP, shelf, ACP, and disk na_ontap_flexcache \u2013 NetApp ONTAP FlexCache - create/delete relationship na_ontap_gather_facts \u2013 NetApp information gatherer (D) na_ontap_igroup \u2013 NetApp ONTAP iSCSI or FC igroup configuration na_ontap_igroup_initiator \u2013 NetApp ONTAP igroup initiator configuration na_ontap_info \u2013 NetApp information gatherer na_ontap_interface \u2013 NetApp ONTAP LIF configuration na_ontap_ipspace \u2013 NetApp ONTAP Manage an ipspace na_ontap_iscsi \u2013 NetApp ONTAP manage iSCSI service na_ontap_job_schedule \u2013 NetApp ONTAP Job Schedule na_ontap_kerberos_realm \u2013 NetApp ONTAP vserver nfs kerberos realm na_ontap_ldap \u2013 NetApp ONTAP LDAP na_ontap_ldap_client \u2013 NetApp ONTAP LDAP client na_ontap_license \u2013 NetApp ONTAP protocol and feature licenses na_ontap_lun \u2013 NetApp ONTAP manage LUNs na_ontap_lun_copy \u2013 NetApp ONTAP copy LUNs na_ontap_lun_map \u2013 NetApp ONTAP LUN maps na_ontap_motd \u2013 Setup motd na_ontap_ndmp \u2013 NetApp ONTAP NDMP services configuration na_ontap_net_ifgrp \u2013 NetApp Ontap modify network interface group na_ontap_net_port \u2013 NetApp ONTAP network ports na_ontap_net_routes \u2013 NetApp ONTAP network routes na_ontap_net_subnet \u2013 NetApp ONTAP Create, delete, modify network subnets na_ontap_net_vlan \u2013 NetApp ONTAP network VLAN na_ontap_nfs \u2013 NetApp ONTAP NFS status na_ontap_node \u2013 NetApp ONTAP Rename a node na_ontap_ntp \u2013 NetApp ONTAP NTP server na_ontap_nvme \u2013 NetApp ONTAP Manage NVMe Service na_ontap_nvme_namespace \u2013 NetApp ONTAP Manage NVME Namespace na_ontap_nvme_subsystem \u2013 NetApp ONTAP Manage NVME Subsystem na_ontap_object_store \u2013 NetApp ONTAP manage object store config na_ontap_ports \u2013 NetApp ONTAP add/remove ports na_ontap_portset \u2013 NetApp ONTAP Create/Delete portset na_ontap_qos_adaptive_policy_group \u2013 NetApp ONTAP Adaptive Quality of Service policy group na_ontap_qos_policy_group \u2013 NetApp ONTAP manage policy group in Quality of Service na_ontap_qtree \u2013 NetApp ONTAP manage qtrees na_ontap_quotas \u2013 NetApp ONTAP Quotas na_ontap_security_key_manager \u2013 NetApp ONTAP security key manager na_ontap_service_processor_network \u2013 NetApp ONTAP service processor network na_ontap_snapmirror \u2013 NetApp ONTAP or ElementSW Manage SnapMirror na_ontap_snapshot \u2013 NetApp ONTAP manage Snapshots na_ontap_snapshot_policy \u2013 NetApp ONTAP manage Snapshot Policy na_ontap_snmp \u2013 NetApp ONTAP SNMP community na_ontap_software_update \u2013 NetApp ONTAP Update Software na_ontap_svm \u2013 NetApp ONTAP SVM na_ontap_svm_options \u2013 NetApp ONTAP Modify SVM Options na_ontap_ucadapter \u2013 NetApp ONTAP UC adapter configuration na_ontap_unix_group \u2013 NetApp ONTAP UNIX Group na_ontap_unix_user \u2013 NetApp ONTAP UNIX users na_ontap_user \u2013 NetApp ONTAP user configuration and management na_ontap_user_role \u2013 NetApp ONTAP user role configuration and management na_ontap_volume \u2013 NetApp ONTAP manage volumes na_ontap_volume_autosize \u2013 NetApp ONTAP manage volume autosize na_ontap_volume_clone \u2013 NetApp ONTAP manage volume clones na_ontap_vscan \u2013 NetApp ONTAP Vscan enable/disable na_ontap_vscan_on_access_policy \u2013 NetApp ONTAP Vscan on access policy configuration na_ontap_vscan_on_demand_task \u2013 NetApp ONTAP Vscan on demand task configuration na_ontap_vscan_scanner_pool \u2013 NetApp ONTAP Vscan Scanner Pools Configuration na_ontap_vserver_cifs_security \u2013 NetApp ONTAP vserver CIFS security modification na_ontap_vserver_peer \u2013 NetApp ONTAP Vserver peering netapp_e_alerts \u2013 NetApp E-Series manage email notification settings netapp_e_amg \u2013 NetApp E-Series create, remove, and update asynchronous mirror groups netapp_e_amg_role \u2013 NetApp E-Series update the role of a storage array within an Asynchronous Mirror Group (AMG) netapp_e_amg_sync \u2013 NetApp E-Series conduct synchronization actions on asynchronous mirror groups netapp_e_asup \u2013 NetApp E-Series manage auto-support settings netapp_e_auditlog \u2013 NetApp E-Series manage audit-log configuration netapp_e_auth \u2013 NetApp E-Series set or update the password for a storage array netapp_e_drive_firmware \u2013 NetApp E-Series manage drive firmware netapp_e_facts \u2013 NetApp E-Series retrieve facts about NetApp E-Series storage arrays netapp_e_firmware \u2013 NetApp E-Series manage firmware netapp_e_flashcache \u2013 NetApp E-Series manage SSD caches netapp_e_global \u2013 NetApp E-Series manage global settings configuration netapp_e_host \u2013 NetApp E-Series manage eseries hosts netapp_e_hostgroup \u2013 NetApp E-Series manage array host groups netapp_e_iscsi_interface \u2013 NetApp E-Series manage iSCSI interface configuration netapp_e_iscsi_target \u2013 NetApp E-Series manage iSCSI target configuration netapp_e_ldap \u2013 NetApp E-Series manage LDAP integration to use for authentication netapp_e_lun_mapping \u2013 NetApp E-Series create, delete, or modify lun mappings netapp_e_mgmt_interface \u2013 NetApp E-Series management interface configuration netapp_e_snapshot_group \u2013 NetApp E-Series manage snapshot groups netapp_e_snapshot_images \u2013 NetApp E-Series create and delete snapshot images netapp_e_snapshot_volume \u2013 NetApp E-Series manage snapshot volumes netapp_e_storage_system \u2013 NetApp E-Series Web Services Proxy manage storage arrays netapp_e_storagepool \u2013 NetApp E-Series manage volume groups and disk pools netapp_e_syslog \u2013 NetApp E-Series manage syslog settings netapp_e_volume \u2013 NetApp E-Series manage storage volumes (standard and thin) netapp_e_volume_copy \u2013 NetApp E-Series create volume copy pairs sf_account_manager \u2013 Manage SolidFire accounts (D) sf_check_connections \u2013 Check connectivity to MVIP and SVIP (D) sf_snapshot_schedule_manager \u2013 Manage SolidFire snapshot schedules (D) sf_volume_access_group_manager \u2013 Manage SolidFire Volume Access Groups (D) sf_volume_manager \u2013 Manage SolidFire volumes (D)","title":"Netapp"},{"location":"basic/Reference/Module/#purestorage","text":"purefa_alert \u2013 Configure Pure Storage FlashArray alert email settings purefa_arrayname \u2013 Configure Pure Storage FlashArray array name purefa_banner \u2013 Configure Pure Storage FlashArray GUI and SSH MOTD message purefa_connect \u2013 Manage replication connections between two FlashArrays purefa_dns \u2013 Configure FlashArray DNS settings purefa_ds \u2013 Configure FlashArray Directory Service purefa_dsrole \u2013 Configure FlashArray Directory Service Roles purefa_facts \u2013 Collect facts from Pure Storage FlashArray (D) purefa_hg \u2013 Manage hostgroups on Pure Storage FlashArrays purefa_host \u2013 Manage hosts on Pure Storage FlashArrays purefa_info \u2013 Collect information from Pure Storage FlashArray purefa_ntp \u2013 Configure Pure Storage FlashArray NTP settings purefa_offload \u2013 Create, modify and delete NFS or S3 offload targets purefa_pg \u2013 Manage protection groups on Pure Storage FlashArrays purefa_pgsnap \u2013 Manage protection group snapshots on Pure Storage FlashArrays purefa_phonehome \u2013 Enable or Disable Pure Storage FlashArray Phonehome purefa_ra \u2013 Enable or Disable Pure Storage FlashArray Remote Assist purefa_smtp \u2013 Configure FlashArray SMTP settings purefa_snap \u2013 Manage volume snapshots on Pure Storage FlashArrays purefa_snmp \u2013 Configure FlashArray SNMP Managers purefa_syslog \u2013 Configure Pure Storage FlashArray syslog settings purefa_user \u2013 Create, modify or delete FlashArray local user account purefa_vg \u2013 Manage volume groups on Pure Storage FlashArrays purefa_volume \u2013 Manage volumes on Pure Storage FlashArrays purefb_bucket \u2013 Manage Object Store Buckets on a Pure Storage FlashBlade purefb_ds \u2013 Configure FlashBlade Directory Service purefb_dsrole \u2013 Configure FlashBlade Management Directory Service Roles purefb_facts \u2013 Collect facts from Pure Storage FlashBlade (D) purefb_fs \u2013 Manage filesystemon Pure Storage FlashBlade` purefb_info \u2013 Collect information from Pure Storage FlashBlade purefb_network \u2013 Manage network interfaces in a Pure Storage FlashBlade purefb_ra \u2013 Enable or Disable Pure Storage FlashBlade Remote Assist purefb_s3acc \u2013 Create or delete FlashBlade Object Store accounts purefb_s3user \u2013 Create or delete FlashBlade Object Store account users purefb_smtp \u2013 Configure SMTP for Pure Storage FlashBlade purefb_snap \u2013 Manage filesystem snapshots on Pure Storage FlashBlades purefb_subnet \u2013 Manage network subnets in a Pure Storage FlashBlade","title":"Purestorage"},{"location":"basic/Reference/Module/#vexata","text":"vexata_eg \u2013 Manage export groups on Vexata VX100 storage arrays vexata_volume \u2013 Manage volumes on Vexata VX100 storage arrays","title":"Vexata"},{"location":"basic/Reference/Module/#zfs","text":"zfs \u2013 Manage zfs zfs_delegate_admin \u2013 Manage ZFS delegated administration (user admin privileges) zfs_facts \u2013 Gather facts about ZFS datasets zpool_facts \u2013 Gather facts about ZFS pools","title":"Zfs"},{"location":"basic/Reference/Module/#system-modules","text":"aix_devices \u2013 Manages AIX devices aix_filesystem \u2013 Configure LVM and NFS file systems for AIX aix_inittab \u2013 Manages the inittab on AIX aix_lvg \u2013 Manage LVM volume groups on AIX aix_lvol \u2013 Configure AIX LVM logical volumes alternatives \u2013 Manages alternative programs for common commands at \u2013 Schedule the execution of a command or script file via the at command authorized_key \u2013 Adds or removes an SSH authorized key awall \u2013 Manage awall policies beadm \u2013 Manage ZFS boot environments on FreeBSD/Solaris/illumos systems capabilities \u2013 Manage Linux capabilities cron \u2013 Manage cron.d and crontab entries cronvar \u2013 Manage variables in crontabs crypttab \u2013 Encrypted Linux block devices dconf \u2013 Modify and read dconf database debconf \u2013 Configure a .deb package facter \u2013 Runs the discovery program facter on the remote system filesystem \u2013 Makes a filesystem firewalld \u2013 Manage arbitrary ports/services with firewalld gather_facts \u2013 Gathers facts about remote hosts gconftool2 \u2013 Edit GNOME Configurations getent \u2013 A wrapper to the unix getent utility group \u2013 Add or remove groups hostname \u2013 Manage hostname interfaces_file \u2013 Tweak settings in /etc/network/interfaces files iptables \u2013 Modify iptables rules java_cert \u2013 Uses keytool to import/remove key from java keystore (cacerts) java_keystore \u2013 Create or delete a Java keystore in JKS format kernel_blacklist \u2013 Blacklist kernel modules known_hosts \u2013 Add or remove a host from the known_hosts file listen_ports_facts \u2013 Gather facts on processes listening on TCP and UDP ports locale_gen \u2013 Creates or removes locales lvg \u2013 Configure LVM volume groups lvol \u2013 Configure LVM logical volumes make \u2013 Run targets in a Makefile mksysb \u2013 Generates AIX mksysb rootvg backups modprobe \u2013 Load or unload kernel modules mount \u2013 Control active and configured mount points nosh \u2013 Manage services with nosh ohai \u2013 Returns inventory data from Ohai open_iscsi \u2013 Manage iSCSI targets with Open-iSCSI openwrt_init \u2013 Manage services on OpenWrt osx_defaults \u2013 Manage macOS user defaults pam_limits \u2013 Modify Linux PAM limits pamd \u2013 Manage PAM Modules parted \u2013 Configure block device partitions pids \u2013 Retrieves process IDs list if the process is running otherwise return empty list ping \u2013 Try to connect to host, verify a usable python and return pong on success puppet \u2013 Runs puppet python_requirements_info \u2013 Show python path and assert dependency versions reboot \u2013 Reboot a machine runit \u2013 Manage runit services seboolean \u2013 Toggles SELinux booleans sefcontext \u2013 Manages SELinux file context mapping definitions selinux \u2013 Change policy and state of SELinux selinux_permissive \u2013 Change permissive domain in SELinux policy selogin \u2013 Manages linux user to SELinux user mapping seport \u2013 Manages SELinux network port type definitions service \u2013 Manage services service_facts \u2013 Return service state information as fact data setup \u2013 Gathers facts about remote hosts solaris_zone \u2013 Manage Solaris zones svc \u2013 Manage daemontools services sysctl \u2013 Manage entries in sysctl.conf syspatch \u2013 Manage OpenBSD system patches systemd \u2013 Manage services sysvinit \u2013 Manage SysV services timezone \u2013 Configure timezone setting ufw \u2013 Manage firewall with UFW user \u2013 Manage user accounts vdo \u2013 Module to control VDO xfconf \u2013 Edit XFCE4 Configurations xfs_quota \u2013 Manage quotas on XFS filesystems","title":"System modules"},{"location":"basic/Reference/Module/#utilities-modules","text":"","title":"Utilities modules"},{"location":"basic/Reference/Module/#helper","text":"meta \u2013 Execute Ansible \u2018actions\u2019","title":"Helper"},{"location":"basic/Reference/Module/#logic","text":"assert \u2013 Asserts given expressions are true async_status \u2013 Obtain status of asynchronous task debug \u2013 Print statements during execution fail \u2013 Fail with custom message import_playbook \u2013 Import a playbook import_role \u2013 Import a role into a play import_tasks \u2013 Import a task list include \u2013 Include a play or task list include_role \u2013 Load and execute a role include_tasks \u2013 Dynamically include a task list include_vars \u2013 Load variables from files, dynamically within a task pause \u2013 Pause playbook execution set_fact \u2013 Set host facts from a task set_stats \u2013 Set stats for the current ansible run wait_for \u2013 Waits for a condition before continuing wait_for_connection \u2013 Waits until remote system is reachable/usable","title":"Logic"},{"location":"basic/Reference/Module/#web-infrastructure-modules","text":"apache2_mod_proxy \u2013 Set and/or get members\u2019 attributes of an Apache httpd 2.4 mod_proxy balancer pool apache2_module \u2013 Enables/disables a module of the Apache2 webserver deploy_helper \u2013 Manages some of the steps common in deploying projects django_manage \u2013 Manages a Django application ejabberd_user \u2013 Manages users for ejabberd servers gunicorn \u2013 Run gunicorn with various settings htpasswd \u2013 manage user files for basic authentication jboss \u2013 Deploy applications to JBoss jenkins_job \u2013 Manage jenkins jobs jenkins_job_info \u2013 Get information about Jenkins jobs jenkins_plugin \u2013 Add or remove Jenkins plugin jenkins_script \u2013 Executes a groovy script in the jenkins instance jira \u2013 create and modify issues in a JIRA instance nginx_status_facts \u2013 Retrieve nginx status facts (D) nginx_status_info \u2013 Retrieve information on nginx status rundeck_acl_policy \u2013 Manage Rundeck ACL policies rundeck_project \u2013 Manage Rundeck projects supervisorctl \u2013 Manage the state of a program or group of programs running via supervisord taiga_issue \u2013 Creates/deletes an issue in a Taiga Project Management Platform","title":"Web Infrastructure modules"},{"location":"basic/Reference/Module/#ansible_tower","text":"tower_credential \u2013 create, update, or destroy Ansible Tower credential tower_credential_type \u2013 Create, update, or destroy custom Ansible Tower credential type tower_group \u2013 create, update, or destroy Ansible Tower group tower_host \u2013 create, update, or destroy Ansible Tower host tower_inventory \u2013 create, update, or destroy Ansible Tower inventory tower_inventory_source \u2013 create, update, or destroy Ansible Tower inventory source tower_job_cancel \u2013 Cancel an Ansible Tower Job tower_job_launch \u2013 Launch an Ansible Job tower_job_list \u2013 List Ansible Tower jobs tower_job_template \u2013 create, update, or destroy Ansible Tower job template tower_job_wait \u2013 Wait for Ansible Tower job to finish tower_label \u2013 create, update, or destroy Ansible Tower label tower_notification \u2013 create, update, or destroy Ansible Tower notification tower_organization \u2013 create, update, or destroy Ansible Tower organizations tower_project \u2013 create, update, or destroy Ansible Tower projects tower_receive \u2013 Receive assets from Ansible Tower tower_role \u2013 create, update, or destroy Ansible Tower role tower_send \u2013 Send assets to Ansible Tower tower_settings \u2013 Modify Ansible Tower settings tower_team \u2013 create, update, or destroy Ansible Tower team tower_user \u2013 create, update, or destroy Ansible Tower user tower_workflow_launch \u2013 Run a workflow in Ansible Tower tower_workflow_template \u2013 create, update, or destroy Ansible Tower workflow template","title":"Ansible_Tower"},{"location":"basic/Reference/Module/#sophos_utm","text":"utm_aaa_group \u2013 Create, update or destroy an aaa group object in Sophos UTM utm_aaa_group_info \u2013 get info for reverse_proxy frontend entry in Sophos UTM utm_ca_host_key_cert \u2013 create, update or destroy ca host_key_cert entry in Sophos UTM utm_ca_host_key_cert_info \u2013 Get info for a ca host_key_cert entry in Sophos UTM utm_dns_host \u2013 create, update or destroy dns entry in Sophos UTM utm_network_interface_address \u2013 Create, update or destroy network/interface_address object utm_network_interface_address_info \u2013 Get info for a network/interface_address object utm_proxy_auth_profile \u2013 create, update or destroy reverse_proxy auth_profile entry in Sophos UTM utm_proxy_exception \u2013 Create, update or destroy reverse_proxy exception entry in Sophos UTM utm_proxy_frontend \u2013 create, update or destroy reverse_proxy frontend entry in Sophos UTM utm_proxy_frontend_info \u2013 create, update or destroy reverse_proxy frontend entry in Sophos UTM utm_proxy_location \u2013 create, update or destroy reverse_proxy location entry in Sophos UTM utm_proxy_location_info \u2013 create, update or destroy reverse_proxy location entry in Sophos UTM","title":"Sophos_Utm"},{"location":"basic/Reference/Module/#windows-modules","text":"win_acl \u2013 Set file/directory/registry permissions for a system user or group win_acl_inheritance \u2013 Change ACL inheritance win_audit_policy_system \u2013 Used to make changes to the system wide Audit Policy win_audit_rule \u2013 Adds an audit rule to files, folders, or registry keys win_certificate_store \u2013 Manages the certificate store win_chocolatey \u2013 Manage packages using chocolatey win_chocolatey_config \u2013 Manages Chocolatey config settings win_chocolatey_facts \u2013 Create a facts collection for Chocolatey win_chocolatey_feature \u2013 Manages Chocolatey features win_chocolatey_source \u2013 Manages Chocolatey sources win_command \u2013 Executes a command on a remote Windows node win_copy \u2013 Copies files to remote locations on windows hosts win_credential \u2013 Manages Windows Credentials in the Credential Manager win_defrag \u2013 Consolidate fragmented files on local volumes win_disk_facts \u2013 Show the attached disks and disk information of the target host win_disk_image \u2013 Manage ISO/VHD/VHDX mounts on Windows hosts win_dns_client \u2013 Configures DNS lookup on Windows hosts win_dns_record \u2013 Manage Windows Server DNS records win_domain \u2013 Ensures the existence of a Windows domain win_domain_computer \u2013 Manage computers in Active Directory win_domain_controller \u2013 Manage domain controller/member server state for a Windows host win_domain_group \u2013 Creates, modifies or removes domain groups win_domain_group_membership \u2013 Manage Windows domain group membership win_domain_membership \u2013 Manage domain/workgroup membership for a Windows host win_domain_user \u2013 Manages Windows Active Directory user accounts win_dotnet_ngen \u2013 Runs ngen to recompile DLLs after .NET updates win_dsc \u2013 Invokes a PowerShell DSC configuration win_environment \u2013 Modify environment variables on windows hosts win_eventlog \u2013 Manage Windows event logs win_eventlog_entry \u2013 Write entries to Windows event logs win_feature \u2013 Installs and uninstalls Windows Features on Windows Server win_file \u2013 Creates, touches or removes files or directories win_file_version \u2013 Get DLL or EXE file build version win_find \u2013 Return a list of files based on specific criteria win_firewall \u2013 Enable or disable the Windows Firewall win_firewall_rule \u2013 Windows firewall automation win_format \u2013 Formats an existing volume or a new volume on an existing partition on Windows win_get_url \u2013 Downloads file from HTTP, HTTPS, or FTP to node win_group \u2013 Add and remove local groups win_group_membership \u2013 Manage Windows local group membership win_hostname \u2013 Manages local Windows computer name win_hosts \u2013 Manages hosts file entries on Windows win_hotfix \u2013 Install and uninstalls Windows hotfixes win_http_proxy \u2013 Manages proxy settings for WinHTTP win_iis_virtualdirectory \u2013 Configures a virtual directory in IIS win_iis_webapplication \u2013 Configures IIS web applications win_iis_webapppool \u2013 Configure IIS Web Application Pools win_iis_webbinding \u2013 Configures a IIS Web site binding win_iis_website \u2013 Configures a IIS Web site win_inet_proxy \u2013 Manages proxy settings for WinINet and Internet Explorer win_lineinfile \u2013 Ensure a particular line is in a file, or replace an existing line using a back-referenced regular expression win_mapped_drive \u2013 Map network drives for users win_msg \u2013 Sends a message to logged in users on Windows hosts win_netbios \u2013 Manage NetBIOS over TCP/IP settings on Windows win_nssm \u2013 Install a service using NSSM win_optional_feature \u2013 Manage optional Windows features win_owner \u2013 Set owner win_package \u2013 Installs/uninstalls an installable package win_pagefile \u2013 Query or change pagefile configuration win_partition \u2013 Creates, changes and removes partitions on Windows Server win_path \u2013 Manage Windows path environment variables win_pester \u2013 Run Pester tests on Windows hosts win_ping \u2013 A windows version of the classic ping module win_power_plan \u2013 Changes the power plan of a Windows system win_product_facts \u2013 Provides Windows product and license information win_psexec \u2013 Runs commands (remotely) as another (privileged) user win_psmodule \u2013 Adds or removes a Windows PowerShell module win_psrepository \u2013 Adds, removes or updates a Windows PowerShell repository win_rabbitmq_plugin \u2013 Manage RabbitMQ plugins win_rds_cap \u2013 Manage Connection Authorization Policies (CAP) on a Remote Desktop Gateway server win_rds_rap \u2013 Manage Resource Authorization Policies (RAP) on a Remote Desktop Gateway server win_rds_settings \u2013 Manage main settings of a Remote Desktop Gateway server win_reboot \u2013 Reboot a windows machine win_reg_stat \u2013 Get information about Windows registry keys win_regedit \u2013 Add, change, or remove registry keys and values win_region \u2013 Set the region and format settings win_regmerge \u2013 Merges the contents of a registry file into the Windows registry win_robocopy \u2013 Synchronizes the contents of two directories using Robocopy win_route \u2013 Add or remove a static route win_say \u2013 Text to speech module for Windows to speak messages and optionally play sounds win_scheduled_task \u2013 Manage scheduled tasks win_scheduled_task_stat \u2013 Get information about Windows Scheduled Tasks win_security_policy \u2013 Change local security policy settings win_service \u2013 Manage and query Windows services win_share \u2013 Manage Windows shares win_shell \u2013 Execute shell commands on target hosts win_shortcut \u2013 Manage shortcuts on Windows win_snmp \u2013 Configures the Windows SNMP service win_stat \u2013 Get information about Windows files win_tempfile \u2013 Creates temporary files and directories win_template \u2013 Template a file out to a remote server win_timezone \u2013 Sets Windows machine timezone win_toast \u2013 Sends Toast windows notification to logged in users on Windows 10 or later hosts win_unzip \u2013 Unzips compressed files and archives on the Windows node win_updates \u2013 Download and install Windows updates win_uri \u2013 Interacts with webservices win_user \u2013 Manages local Windows user accounts win_user_profile \u2013 Manages the Windows user profiles win_user_right \u2013 Manage Windows User Rights win_wait_for \u2013 Waits for a condition before continuing win_wait_for_process \u2013 Waits for a process to exist or not exist before continuing win_wakeonlan \u2013 Send a magic Wake-on-LAN (WoL) broadcast packet win_webpicmd \u2013 Installs packages using Web Platform Installer command-line win_whoami \u2013 Get information about the current user and process win_xml \u2013 Manages XML file content on Windows hosts","title":"Windows modules"},{"location":"basic/Reference/Vaults/","text":"Ansible Vault \u00b6 Ansible Vault\u662fAnsible\u7684\u4e00\u9879\u529f\u80fd\uff0c\u5b83\u5141\u8bb8\u4f60\u5c06\u5bc6\u7801\u6216\u5bc6\u94a5\u7b49\u654f\u611f\u6570\u636e\u4fdd\u5b58\u5728\u52a0\u5bc6\u7684\u6587\u4ef6\u4e2d\uff0c\u800c\u4e0d\u662f\u660e\u6587\u4fdd\u5b58\u5728\u5267\u672c\u6216\u89d2\u8272\u4e2d\u3002\u7136\u540e\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u5e93\u6587\u4ef6\u5206\u53d1\u6216\u653e\u7f6e\u5728\u6e90\u4ee3\u7801\u63a7\u5236\u4e2d\u3002 \u521b\u5efa\u52a0\u5bc6\u6587\u4ef6 \u00b6 \u521b\u5efa\u65b0\u7684\u52a0\u5bc6\u6587\u4ef6\uff0c\u53ef\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4 # ansible-vault create foo.yml New Vault password: Confirm New Vault password: \u5728\u8f93\u5165\u52a0\u5bc6\u5bc6\u7801\u540e\uff0c\u5728\u7f16\u8f91\u754c\u9762\u8f93\u5165\u52a0\u5bc6\u5185\u5bb9\u4fdd\u5b58\u5373\u53ef\u52a0\u5bc6 \u67e5\u770b\u52a0\u5bc6\u540e\u7684\u6587\u4ef6 # cat foo.yml $ANSIBLE_VAULT ; 1 .1 ; AES256 66623733393134373761386161313462613530313331393464363366623063653261306631616333 3635363533623230633432343131633430663039363536340a383535623264363334656161333632 37346635636331613732313132653830636234643230616661383630373863643233626265373034 6665623561643337370a623336636362316330663862373833363263386563636261613765386635 3434 \u9ed8\u8ba4\u7684\u52a0\u5bc6\u65b9\u5f0f\u662f AES \u521b\u5efa\u62e5\u6709id\u7684\u52a0\u5bc6\u6587\u4ef6 ansible-vault create --vault-id password1@prompt foo.yml --vault-id label@source label\u4e3a\u6807\u7b7e\uff0c source\u4e3a\u5bc6\u7801\u7684\u83b7\u53d6\u65b9\u5f0f \u7f16\u8f91\u52a0\u5bc6\u6587\u4ef6 \u00b6 ansible-vault edit foo.yml \u6b64\u547d\u4ee4\u5c06\u6587\u4ef6\u89e3\u5bc6\u4e3a\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\uff0c\u5e76\u5141\u8bb8\u60a8\u7f16\u8f91\u8be5\u6587\u4ef6\uff0c\u5b8c\u6210\u540e\u5c06\u5176\u4fdd\u5b58\u5e76\u5220\u9664\u4e34\u65f6\u6587\u4ef6 \u7f16\u8f91\u62e5\u6709id\u7684\u52a0\u5bc6\u6587\u4ef6 ansible-vault edit --vault-id pass2@vault2 foo.yml \u91cd\u65b0\u52a0\u5bc6\u6587\u4ef6 \u00b6 ansible-vault rekey foo.yml bar.yml baz.yml \u8be5\u547d\u4ee4\u53ef\u4ee5\u540c\u65f6\u5bf9\u591a\u4e2a\u6570\u636e\u6587\u4ef6\u8fdb\u884c\u5bc6\u94a5\u91cd\u8bbe\uff0c\u5e76\u8981\u6c42\u8f93\u5165\u539f\u59cb\u5bc6\u7801\u548c\u65b0\u5bc6\u7801\u3002 \u91cd\u65b0\u52a0\u5bc6\u62e5\u6709id\u7684\u52a0\u5bc6\u6587\u4ef6 ansible-vault rekey --vault-id preprod2@ppold --new-vault-id preprod2@prompt foo.yml bar.yml baz.yml \u6587\u4ef6\u52a0\u5bc6 \u00b6 \u5bf9hosts\u6587\u4ef6\u8fdb\u884c\u52a0\u5bc6 # ansible-vault encrypt /etc/ansible/hosts New Vault password: Confirm New Vault password: Encryption successful \u4f7f\u7528id\u52a0\u5bc6\u6587\u4ef6 ansible-vault encrypt --vault-id project@prompt foo.yml bar.yml baz.yml \u6587\u4ef6\u89e3\u5bc6 \u00b6 ansible-vault decrypt foo.yml bar.yml baz.yml \u4f7f\u7528 encrypt_string \u5728 yaml \u4e2d\u521b\u5efa\u52a0\u5bc6\u53d8\u91cf \u00b6 # echo 123 > a_password_file # ansible-vault encrypt_string --vault-password-file a_password_file 'foobar' --name 'the_secret' the_secret: !vault | $ANSIBLE_VAULT ; 1 .1 ; AES256 33366336396662373333323664653438366364316136333234346533326665326130316261363564 6462616561333938393133303461376265336538313637380a326331373537363566656230313237 66306131616133316339666337653131306564393633643037653461363133373234376264373738 3437303466366436300a336136383033323230303764633862383731326464633536343164353034 3532 Encryption successful \u8f93\u51fa\u7684\u5b57\u7b26\u4e32\u53ef\u4f7f\u7528\u5728playbook\u4e2d \u4f7f\u7528 vault-id # ansible-vault encrypt_string --vault-id dev@a_password_file 'foooodev' --name 'the_dev_secret' the_dev_secret: !vault | $ANSIBLE_VAULT ; 1 .2 ; AES256 ; dev 35313739373461366564323863386435363738616130313833653432363337326339343834303638 6531303333373330316666653536373733303334333332330a393938643935643134623064343133 35396538326465323431656430633835613066343561386663613034366134393739643934663865 6133326634643164660a346634366433613662336566376134346361373166356563663536313935 6361 Encryption successful \u4ecestdin\u8bfb\u53d6\u5b57\u7b26\u4e32\u5e76\u5c06\u5176\u547d\u540d\u4e3a db_password echo -n 'letmein' | ansible-vault encrypt_string --vault-id dev@a_password_file --stdin-name 'db_password' Reading plaintext input from stdin. ( ctrl-d to end input ) db_password: !vault | $ANSIBLE_VAULT ; 1 .2 ; AES256 ; dev 65656661383162623438313763613462616361626237623630323839366130613530323437313036 3635636261303662363832376635663466623662356666640a653432336437633436376236323634 33373632666533653062323431396164396263623565616131333766343561353561636430373338 3637393832656164640a643463366165376461663032373439663536363538386232643230393638 6365 Encryption successful \u5728yaml\u4e2d\u4f7f\u7528 notsecret : myvalue db_password : !vault | $ANSIBLE_VAULT;1.2;AES256;dev 65656661383162623438313763613462616361626237623630323839366130613530323437313036 3635636261303662363832376635663466623662356666640a653432336437633436376236323634 33373632666533653062323431396164396263623565616131333766343561353561636430373338 3637393832656164640a643463366165376461663032373439663536363538386232643230393638 6365 \u63d0\u4f9b Vault \u5bc6\u7801 \u00b6 \u5f53\u4f7f\u7528\u52a0\u5bc6\u6570\u636e\u65f6\uff0c\u5e94\u8be5\u4f7f\u7528 --ask-vault-pass \u6216 --vault-password \u9009\u9879\u3002 # \u5b9a\u4e49\u5bc6\u7801\u6587\u4ef6 echo 123456 > /path/to/my/vault-password-file site.yml # \u6307\u5b9a\u5bc6\u7801 ansible-playbook --vault-password-file /path/to/my/vault-password-file site.yml \u4ea4\u4e92\u5f0f\u8f93\u5165\u5bc6\u7801 ansible-playbook --ask-vault-pass site.yml \u6267\u884c\u811a\u672c\u83b7\u53d6\u5bc6\u7801 ansible-playbook --vault-password-file my-vault-password.py \u4e5f\u53ef\u4ee5\u6307\u5b9a\u73af\u5883\u53d8\u91cf DEFAULT_VAULT_PASSWORD_FILE = /path/to/my/vault-password-file ansible-playbook --ask-vault-pass site.yml Vaults \u6807\u7b7e \u00b6 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c vault-id \u6807\u7b7e\u53ea\u662f\u4e00\u4e2a\u63d0\u793a\uff0c\u4efb\u4f55\u7528\u5bc6\u7801\u52a0\u5bc6\u7684\u503c\u90fd\u4f1a\u88ab\u89e3\u5bc6\u3002\u914d\u7f6e\u9009\u9879\u7684\u9ed8\u8ba4\u4fdd\u9669\u5e93ID\u5339\u914d\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u8981\u6c42\u4fdd\u9669\u5e93ID\u4e0e\u52a0\u5bc6\u503c\u65f6\u4f7f\u7528\u7684\u4fdd\u9669\u5e93ID\u5339\u914d\u3002\u8fd9\u53ef\u4ee5\u51cf\u5c11\u4f7f\u7528\u4e0d\u540c\u5bc6\u7801\u52a0\u5bc6\u4e0d\u540c\u503c\u65f6\u7684\u9519\u8bef\u3002 DEFAULT_VAULT_ID_MATCH \u73af\u5883\u53d8\u91cf\u53ef\u4ee5\u8bbe\u7f6e\u9700\u8981\u6307\u5b9a\u7684 vault-id \u6807\u7b7e \u4e3a vault-id \u6807\u7b7e dev \u4f7f\u7528\u5bc6\u7801\u6587\u4ef6 ansible-playbook --vault-id dev-password site.yml \u4e3a vault-id \u6807\u7b7e dev \u4f7f\u7528\u4ea4\u4e92\u8f93\u5165\u5bc6\u7801 ansible-playbook --vault-id dev@prompt site.yml \u4e3a vault-id \u6807\u7b7e dev \u4f7f\u7528\u811a\u672c\u8f93\u5165\u5bc6\u7801 ansible-playbook --vault-id dev@my-vault-password.py DEFAULT_VAULT_IDENTITY_LIST \u73af\u5883\u53d8\u91cf\u53ef\u4ee5\u8bbe\u7f6e\u9700\u8981\u6307\u5b9a\u7684 vault-id \u548c\u5bc6\u7801\u6e90\uff0c\u800c\u4e0d\u5fc5\u6307\u5b9a --vault-id \u9009\u9879 ansible-playbook --vault-id dev-password site.yml ansible-playbook --vault-id @prompt site.yml ansible-playbook --vault-id my-vault-password.py \u591a\u4e2a Vault \u5bc6\u7801 \u00b6 Ansible 2.4 \u4e4b\u540e\u7684\u989d\u7248\u672c\uff0c\u53ef\u4ee5\u591a\u6b21\u6307\u5b9a vault-id \u9009\u9879\u6765\u8bbe\u7f6e\u591a\u4e2a\u5bc6\u7801 ansible-playbook --vault-id dev@dev-password --vault-id prod@prompt site.yml \u5728\u4e0a\u8ff0\u60c5\u51b5\u4e0b\uff0c\u9996\u5148\u5c1d\u8bd5 dev \u5bc6\u7801\uff0c\u7136\u540e\u662fprod\u5bc6\u7801\uff0c Ansible\u4e0d\u77e5\u9053\u54ea\u4e2a\u91d1\u5e93ID\u662f\u7528\u6765\u52a0\u5bc6\u7684\u4e1c\u897f\u3002 \u4f7f\u7528\u5ba2\u6237\u7aef\u811a\u672c\u8bbe\u7f6e Vault \u5bc6\u7801 \u00b6 \u5ba2\u6237\u7aef\u811a\u672c\u662f\u4e00\u4e2a\u4ee5 --client \u7ed3\u5c3e\u7684\u53ef\u6267\u884c\u811a\u672c\u3002 ansible-playbook --vault-id dev@contrib/vault/vault-keyring-client.py \u811a\u672c\u5185\u5bb9 ANSIBLE_METADATA = { 'status' : [ 'preview' ], 'supported_by' : 'community' , 'version' : '1.0' } import argparse import sys import getpass import keyring from ansible.config.manager import ConfigManager KEYNAME_UNKNOWN_RC = 2 def build_arg_parser (): parser = argparse . ArgumentParser ( description = 'Get a vault password from user keyring' ) parser . add_argument ( '--vault-id' , action = 'store' , default = None , dest = 'vault_id' , help = 'name of the vault secret to get from keyring' ) parser . add_argument ( '--username' , action = 'store' , default = None , help = 'the username whose keyring is queried' ) parser . add_argument ( '--set' , action = 'store_true' , default = False , dest = 'set_password' , help = 'set the password instead of getting it' ) return parser def main (): config_manager = ConfigManager () username = config_manager . data . get_setting ( 'vault.username' ) if not username : username = getpass . getuser () keyname = config_manager . data . get_setting ( 'vault.keyname' ) if not keyname : keyname = 'ansible' arg_parser = build_arg_parser () args = arg_parser . parse_args () username = args . username or username keyname = args . vault_id or keyname # print('username: %s keyname: %s' % (username, keyname)) if args . set_password : intro = 'Storing password in \" {} \" user keyring using key name: {} \\n ' sys . stdout . write ( intro . format ( username , keyname )) password = getpass . getpass () confirm = getpass . getpass ( 'Confirm password: ' ) if password == confirm : keyring . set_password ( keyname , username , password ) else : sys . stderr . write ( 'Passwords do not match \\n ' ) sys . exit ( 1 ) else : secret = keyring . get_password ( keyname , username ) if secret is None : sys . stderr . write ( 'vault-keyring-client could not find key=\" %s \" for user=\" %s \" via backend=\" %s \" \\n ' % ( keyname , username , keyring . get_keyring () . name )) sys . exit ( KEYNAME_UNKNOWN_RC ) # print('secret: %s' % secret) sys . stdout . write ( ' %s \\n ' % secret ) sys . exit ( 0 ) if __name__ == '__main__' : main () \u52a0\u901f\u52a0\u5bc6\u901f\u5ea6 \u00b6 \u5982\u679c\u4f60\u6709\u8bb8\u591a\u6587\u4ef6\u9700\u8981\u52a0\u5bc6\uff0c\u53ef\u4ee5\u4f7f\u7528 cryptography \u6765\u8fdb\u884c\u52a0\u5feb\u52a0\u5bc6\u901f\u5ea6 pip install cryptography Vault \u6587\u4ef6 \u00b6 Vault \u52a0\u5bc6\u6587\u4ef6\u662fUTF-8\u7f16\u7801\u7684txt\u6587\u4ef6\u3002 \u6587\u4ef6\u683c\u5f0f\u5305\u62ec\u4e00\u4e2a\u6362\u884c\u7ed3\u675f\u7684\u5934\u6587\u4ef6\u3002 $ANSIBLE_VAULT ; 1 .1 ; AES256 # or $ANSIBLE_VAULT ; 1 .2 ; AES256 ; vault-id-label \u6807\u9898\u5305\u542b vault_id \u3001vault\u7248\u672c\u3001vault\u52a0\u5bc6\u65b9\u5f0f\u548cvault-id\u6807\u7b7e\uff0c\u7528\u5206\u53f7\u5206\u9694","title":"2. Vaults \u52a0\u5bc6\u6570\u636e"},{"location":"basic/Reference/Vaults/#ansible-vault","text":"Ansible Vault\u662fAnsible\u7684\u4e00\u9879\u529f\u80fd\uff0c\u5b83\u5141\u8bb8\u4f60\u5c06\u5bc6\u7801\u6216\u5bc6\u94a5\u7b49\u654f\u611f\u6570\u636e\u4fdd\u5b58\u5728\u52a0\u5bc6\u7684\u6587\u4ef6\u4e2d\uff0c\u800c\u4e0d\u662f\u660e\u6587\u4fdd\u5b58\u5728\u5267\u672c\u6216\u89d2\u8272\u4e2d\u3002\u7136\u540e\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u5e93\u6587\u4ef6\u5206\u53d1\u6216\u653e\u7f6e\u5728\u6e90\u4ee3\u7801\u63a7\u5236\u4e2d\u3002","title":"Ansible Vault"},{"location":"basic/Reference/Vaults/#_1","text":"\u521b\u5efa\u65b0\u7684\u52a0\u5bc6\u6587\u4ef6\uff0c\u53ef\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4 # ansible-vault create foo.yml New Vault password: Confirm New Vault password: \u5728\u8f93\u5165\u52a0\u5bc6\u5bc6\u7801\u540e\uff0c\u5728\u7f16\u8f91\u754c\u9762\u8f93\u5165\u52a0\u5bc6\u5185\u5bb9\u4fdd\u5b58\u5373\u53ef\u52a0\u5bc6 \u67e5\u770b\u52a0\u5bc6\u540e\u7684\u6587\u4ef6 # cat foo.yml $ANSIBLE_VAULT ; 1 .1 ; AES256 66623733393134373761386161313462613530313331393464363366623063653261306631616333 3635363533623230633432343131633430663039363536340a383535623264363334656161333632 37346635636331613732313132653830636234643230616661383630373863643233626265373034 6665623561643337370a623336636362316330663862373833363263386563636261613765386635 3434 \u9ed8\u8ba4\u7684\u52a0\u5bc6\u65b9\u5f0f\u662f AES \u521b\u5efa\u62e5\u6709id\u7684\u52a0\u5bc6\u6587\u4ef6 ansible-vault create --vault-id password1@prompt foo.yml --vault-id label@source label\u4e3a\u6807\u7b7e\uff0c source\u4e3a\u5bc6\u7801\u7684\u83b7\u53d6\u65b9\u5f0f","title":"\u521b\u5efa\u52a0\u5bc6\u6587\u4ef6"},{"location":"basic/Reference/Vaults/#_2","text":"ansible-vault edit foo.yml \u6b64\u547d\u4ee4\u5c06\u6587\u4ef6\u89e3\u5bc6\u4e3a\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\uff0c\u5e76\u5141\u8bb8\u60a8\u7f16\u8f91\u8be5\u6587\u4ef6\uff0c\u5b8c\u6210\u540e\u5c06\u5176\u4fdd\u5b58\u5e76\u5220\u9664\u4e34\u65f6\u6587\u4ef6 \u7f16\u8f91\u62e5\u6709id\u7684\u52a0\u5bc6\u6587\u4ef6 ansible-vault edit --vault-id pass2@vault2 foo.yml","title":"\u7f16\u8f91\u52a0\u5bc6\u6587\u4ef6"},{"location":"basic/Reference/Vaults/#_3","text":"ansible-vault rekey foo.yml bar.yml baz.yml \u8be5\u547d\u4ee4\u53ef\u4ee5\u540c\u65f6\u5bf9\u591a\u4e2a\u6570\u636e\u6587\u4ef6\u8fdb\u884c\u5bc6\u94a5\u91cd\u8bbe\uff0c\u5e76\u8981\u6c42\u8f93\u5165\u539f\u59cb\u5bc6\u7801\u548c\u65b0\u5bc6\u7801\u3002 \u91cd\u65b0\u52a0\u5bc6\u62e5\u6709id\u7684\u52a0\u5bc6\u6587\u4ef6 ansible-vault rekey --vault-id preprod2@ppold --new-vault-id preprod2@prompt foo.yml bar.yml baz.yml","title":"\u91cd\u65b0\u52a0\u5bc6\u6587\u4ef6"},{"location":"basic/Reference/Vaults/#_4","text":"\u5bf9hosts\u6587\u4ef6\u8fdb\u884c\u52a0\u5bc6 # ansible-vault encrypt /etc/ansible/hosts New Vault password: Confirm New Vault password: Encryption successful \u4f7f\u7528id\u52a0\u5bc6\u6587\u4ef6 ansible-vault encrypt --vault-id project@prompt foo.yml bar.yml baz.yml","title":"\u6587\u4ef6\u52a0\u5bc6"},{"location":"basic/Reference/Vaults/#_5","text":"ansible-vault decrypt foo.yml bar.yml baz.yml","title":"\u6587\u4ef6\u89e3\u5bc6"},{"location":"basic/Reference/Vaults/#encrypt_string-yaml","text":"# echo 123 > a_password_file # ansible-vault encrypt_string --vault-password-file a_password_file 'foobar' --name 'the_secret' the_secret: !vault | $ANSIBLE_VAULT ; 1 .1 ; AES256 33366336396662373333323664653438366364316136333234346533326665326130316261363564 6462616561333938393133303461376265336538313637380a326331373537363566656230313237 66306131616133316339666337653131306564393633643037653461363133373234376264373738 3437303466366436300a336136383033323230303764633862383731326464633536343164353034 3532 Encryption successful \u8f93\u51fa\u7684\u5b57\u7b26\u4e32\u53ef\u4f7f\u7528\u5728playbook\u4e2d \u4f7f\u7528 vault-id # ansible-vault encrypt_string --vault-id dev@a_password_file 'foooodev' --name 'the_dev_secret' the_dev_secret: !vault | $ANSIBLE_VAULT ; 1 .2 ; AES256 ; dev 35313739373461366564323863386435363738616130313833653432363337326339343834303638 6531303333373330316666653536373733303334333332330a393938643935643134623064343133 35396538326465323431656430633835613066343561386663613034366134393739643934663865 6133326634643164660a346634366433613662336566376134346361373166356563663536313935 6361 Encryption successful \u4ecestdin\u8bfb\u53d6\u5b57\u7b26\u4e32\u5e76\u5c06\u5176\u547d\u540d\u4e3a db_password echo -n 'letmein' | ansible-vault encrypt_string --vault-id dev@a_password_file --stdin-name 'db_password' Reading plaintext input from stdin. ( ctrl-d to end input ) db_password: !vault | $ANSIBLE_VAULT ; 1 .2 ; AES256 ; dev 65656661383162623438313763613462616361626237623630323839366130613530323437313036 3635636261303662363832376635663466623662356666640a653432336437633436376236323634 33373632666533653062323431396164396263623565616131333766343561353561636430373338 3637393832656164640a643463366165376461663032373439663536363538386232643230393638 6365 Encryption successful \u5728yaml\u4e2d\u4f7f\u7528 notsecret : myvalue db_password : !vault | $ANSIBLE_VAULT;1.2;AES256;dev 65656661383162623438313763613462616361626237623630323839366130613530323437313036 3635636261303662363832376635663466623662356666640a653432336437633436376236323634 33373632666533653062323431396164396263623565616131333766343561353561636430373338 3637393832656164640a643463366165376461663032373439663536363538386232643230393638 6365","title":"\u4f7f\u7528 encrypt_string \u5728yaml \u4e2d\u521b\u5efa\u52a0\u5bc6\u53d8\u91cf"},{"location":"basic/Reference/Vaults/#vault","text":"\u5f53\u4f7f\u7528\u52a0\u5bc6\u6570\u636e\u65f6\uff0c\u5e94\u8be5\u4f7f\u7528 --ask-vault-pass \u6216 --vault-password \u9009\u9879\u3002 # \u5b9a\u4e49\u5bc6\u7801\u6587\u4ef6 echo 123456 > /path/to/my/vault-password-file site.yml # \u6307\u5b9a\u5bc6\u7801 ansible-playbook --vault-password-file /path/to/my/vault-password-file site.yml \u4ea4\u4e92\u5f0f\u8f93\u5165\u5bc6\u7801 ansible-playbook --ask-vault-pass site.yml \u6267\u884c\u811a\u672c\u83b7\u53d6\u5bc6\u7801 ansible-playbook --vault-password-file my-vault-password.py \u4e5f\u53ef\u4ee5\u6307\u5b9a\u73af\u5883\u53d8\u91cf DEFAULT_VAULT_PASSWORD_FILE = /path/to/my/vault-password-file ansible-playbook --ask-vault-pass site.yml","title":"\u63d0\u4f9b Vault \u5bc6\u7801"},{"location":"basic/Reference/Vaults/#vaults","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c vault-id \u6807\u7b7e\u53ea\u662f\u4e00\u4e2a\u63d0\u793a\uff0c\u4efb\u4f55\u7528\u5bc6\u7801\u52a0\u5bc6\u7684\u503c\u90fd\u4f1a\u88ab\u89e3\u5bc6\u3002\u914d\u7f6e\u9009\u9879\u7684\u9ed8\u8ba4\u4fdd\u9669\u5e93ID\u5339\u914d\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u8981\u6c42\u4fdd\u9669\u5e93ID\u4e0e\u52a0\u5bc6\u503c\u65f6\u4f7f\u7528\u7684\u4fdd\u9669\u5e93ID\u5339\u914d\u3002\u8fd9\u53ef\u4ee5\u51cf\u5c11\u4f7f\u7528\u4e0d\u540c\u5bc6\u7801\u52a0\u5bc6\u4e0d\u540c\u503c\u65f6\u7684\u9519\u8bef\u3002 DEFAULT_VAULT_ID_MATCH \u73af\u5883\u53d8\u91cf\u53ef\u4ee5\u8bbe\u7f6e\u9700\u8981\u6307\u5b9a\u7684 vault-id \u6807\u7b7e \u4e3a vault-id \u6807\u7b7e dev \u4f7f\u7528\u5bc6\u7801\u6587\u4ef6 ansible-playbook --vault-id dev-password site.yml \u4e3a vault-id \u6807\u7b7e dev \u4f7f\u7528\u4ea4\u4e92\u8f93\u5165\u5bc6\u7801 ansible-playbook --vault-id dev@prompt site.yml \u4e3a vault-id \u6807\u7b7e dev \u4f7f\u7528\u811a\u672c\u8f93\u5165\u5bc6\u7801 ansible-playbook --vault-id dev@my-vault-password.py DEFAULT_VAULT_IDENTITY_LIST \u73af\u5883\u53d8\u91cf\u53ef\u4ee5\u8bbe\u7f6e\u9700\u8981\u6307\u5b9a\u7684 vault-id \u548c\u5bc6\u7801\u6e90\uff0c\u800c\u4e0d\u5fc5\u6307\u5b9a --vault-id \u9009\u9879 ansible-playbook --vault-id dev-password site.yml ansible-playbook --vault-id @prompt site.yml ansible-playbook --vault-id my-vault-password.py","title":"Vaults \u6807\u7b7e"},{"location":"basic/Reference/Vaults/#vault_1","text":"Ansible 2.4 \u4e4b\u540e\u7684\u989d\u7248\u672c\uff0c\u53ef\u4ee5\u591a\u6b21\u6307\u5b9a vault-id \u9009\u9879\u6765\u8bbe\u7f6e\u591a\u4e2a\u5bc6\u7801 ansible-playbook --vault-id dev@dev-password --vault-id prod@prompt site.yml \u5728\u4e0a\u8ff0\u60c5\u51b5\u4e0b\uff0c\u9996\u5148\u5c1d\u8bd5 dev \u5bc6\u7801\uff0c\u7136\u540e\u662fprod\u5bc6\u7801\uff0c Ansible\u4e0d\u77e5\u9053\u54ea\u4e2a\u91d1\u5e93ID\u662f\u7528\u6765\u52a0\u5bc6\u7684\u4e1c\u897f\u3002","title":"\u591a\u4e2a Vault \u5bc6\u7801"},{"location":"basic/Reference/Vaults/#vault_2","text":"\u5ba2\u6237\u7aef\u811a\u672c\u662f\u4e00\u4e2a\u4ee5 --client \u7ed3\u5c3e\u7684\u53ef\u6267\u884c\u811a\u672c\u3002 ansible-playbook --vault-id dev@contrib/vault/vault-keyring-client.py \u811a\u672c\u5185\u5bb9 ANSIBLE_METADATA = { 'status' : [ 'preview' ], 'supported_by' : 'community' , 'version' : '1.0' } import argparse import sys import getpass import keyring from ansible.config.manager import ConfigManager KEYNAME_UNKNOWN_RC = 2 def build_arg_parser (): parser = argparse . ArgumentParser ( description = 'Get a vault password from user keyring' ) parser . add_argument ( '--vault-id' , action = 'store' , default = None , dest = 'vault_id' , help = 'name of the vault secret to get from keyring' ) parser . add_argument ( '--username' , action = 'store' , default = None , help = 'the username whose keyring is queried' ) parser . add_argument ( '--set' , action = 'store_true' , default = False , dest = 'set_password' , help = 'set the password instead of getting it' ) return parser def main (): config_manager = ConfigManager () username = config_manager . data . get_setting ( 'vault.username' ) if not username : username = getpass . getuser () keyname = config_manager . data . get_setting ( 'vault.keyname' ) if not keyname : keyname = 'ansible' arg_parser = build_arg_parser () args = arg_parser . parse_args () username = args . username or username keyname = args . vault_id or keyname # print('username: %s keyname: %s' % (username, keyname)) if args . set_password : intro = 'Storing password in \" {} \" user keyring using key name: {} \\n ' sys . stdout . write ( intro . format ( username , keyname )) password = getpass . getpass () confirm = getpass . getpass ( 'Confirm password: ' ) if password == confirm : keyring . set_password ( keyname , username , password ) else : sys . stderr . write ( 'Passwords do not match \\n ' ) sys . exit ( 1 ) else : secret = keyring . get_password ( keyname , username ) if secret is None : sys . stderr . write ( 'vault-keyring-client could not find key=\" %s \" for user=\" %s \" via backend=\" %s \" \\n ' % ( keyname , username , keyring . get_keyring () . name )) sys . exit ( KEYNAME_UNKNOWN_RC ) # print('secret: %s' % secret) sys . stdout . write ( ' %s \\n ' % secret ) sys . exit ( 0 ) if __name__ == '__main__' : main ()","title":"\u4f7f\u7528\u5ba2\u6237\u7aef\u811a\u672c\u8bbe\u7f6e Vault \u5bc6\u7801"},{"location":"basic/Reference/Vaults/#_6","text":"\u5982\u679c\u4f60\u6709\u8bb8\u591a\u6587\u4ef6\u9700\u8981\u52a0\u5bc6\uff0c\u53ef\u4ee5\u4f7f\u7528 cryptography \u6765\u8fdb\u884c\u52a0\u5feb\u52a0\u5bc6\u901f\u5ea6 pip install cryptography","title":"\u52a0\u901f\u52a0\u5bc6\u901f\u5ea6"},{"location":"basic/Reference/Vaults/#vault_3","text":"Vault \u52a0\u5bc6\u6587\u4ef6\u662fUTF-8\u7f16\u7801\u7684txt\u6587\u4ef6\u3002 \u6587\u4ef6\u683c\u5f0f\u5305\u62ec\u4e00\u4e2a\u6362\u884c\u7ed3\u675f\u7684\u5934\u6587\u4ef6\u3002 $ANSIBLE_VAULT ; 1 .1 ; AES256 # or $ANSIBLE_VAULT ; 1 .2 ; AES256 ; vault-id-label \u6807\u9898\u5305\u542b vault_id \u3001vault\u7248\u672c\u3001vault\u52a0\u5bc6\u65b9\u5f0f\u548cvault-id\u6807\u7b7e\uff0c\u7528\u5206\u53f7\u5206\u9694","title":"Vault \u6587\u4ef6"},{"location":"basic/Reference/Yaml/","text":"YAML \u8bed\u6cd5 \u00b6 YAML \u8bed\u8a00\uff08\u53d1\u97f3 /\u02c8j\u00e6m\u0259l/ \uff09\u7684\u8bbe\u8ba1\u76ee\u6807\uff0c\u5c31\u662f\u65b9\u4fbf\u4eba\u7c7b\u8bfb\u5199\u3002\u5b83\u5b9e\u8d28\u4e0a\u662f\u4e00\u79cd\u901a\u7528\u7684\u6570\u636e\u4e32\u884c\u5316\u683c\u5f0f\u3002 \u5b83\u7684\u57fa\u672c\u8bed\u6cd5\u89c4\u5219\u5982\u4e0b\u3002 \u5927\u5c0f\u5199\u654f\u611f \u4f7f\u7528\u7f29\u8fdb\u8868\u793a\u5c42\u7ea7\u5173\u7cfb \u7f29\u8fdb\u65f6\u4e0d\u5141\u8bb8\u4f7f\u7528Tab\u952e\uff0c\u53ea\u5141\u8bb8\u4f7f\u7528\u7a7a\u683c\u3002 \u7f29\u8fdb\u7684\u7a7a\u683c\u6570\u76ee\u4e0d\u91cd\u8981\uff0c\u53ea\u8981\u76f8\u540c\u5c42\u7ea7\u7684\u5143\u7d20\u5de6\u4fa7\u5bf9\u9f50\u5373\u53ef yaml\u6587\u4ef6\u4ee5\"---\"\u4f5c\u4e3a\u6587\u6863\u7684\u5f00\u59cb\uff0c\"...\"\u4f5c\u4e3a\u6587\u6863\u7684\u7ed3\u675f # \u8868\u793a\u6ce8\u91ca\uff0c\u4ece\u8fd9\u4e2a\u5b57\u7b26\u4e00\u76f4\u5230\u884c\u5c3e\uff0c\u90fd\u4f1a\u88ab\u89e3\u6790\u5668\u5ffd\u7565\u3002 \u76f8\u540c\u7f29\u8fdb\u7ea7\u522b\u7684\u884c\u4ee5\u201c- \u201d\uff08\u7834\u6298\u53f7\u548c\u7a7a\u683c\uff09\u5f00\u5934\u7684\u7ec4\u6210\u4e00\u4e2a\u5217\u8868\u3002 --- # A list of tasty fruits - Apple - Orange - Strawberry - Mango ... YAML \u652f\u6301\u7684\u6570\u636e\u7ed3\u6784\u6709\u4e09\u79cd\u3002 \u6570\u7ec4\uff1a\u4e00\u7ec4\u6309\u6b21\u5e8f\u6392\u5217\u7684\u503c\uff0c\u53c8\u79f0\u4e3a\u5e8f\u5217\uff08sequence\uff09 / \u5217\u8868\uff08list\uff09 \u5bf9\u8c61\uff1a\u952e\u503c\u5bf9\u7684\u96c6\u5408\uff0c\u53c8\u79f0\u4e3a\u6620\u5c04\uff08mapping\uff09/ \u54c8\u5e0c\uff08hashes\uff09 / \u5b57\u5178\uff08dictionary\uff09 \u7eaf\u91cf\uff08scalars\uff09\uff1a\u5355\u4e2a\u7684\u3001\u4e0d\u53ef\u518d\u5206\u7684\u503c \u6570\u7ec4 \u00b6 \u76f8\u540c\u7f29\u8fdb\u7ea7\u522b\u7684\u884c\u4ee5\u201c- \u201d\uff08\u7834\u6298\u53f7\u548c\u7a7a\u683c\uff09\u5f00\u5934\u7684\u7ec4\u6210\u4e00\u4e2a\u5217\u8868\u3002 --- fruits : - Apple - Orange - Strawberry - Mango \u5bf9\u8c61 \u00b6 \u5bf9\u8c61\u7684\u4e00\u7ec4\u952e\u503c\u5bf9\uff0c\u4f7f\u7528\u5192\u53f7\u7ed3\u6784\u8868\u793a(\u5192\u53f7\u540e\u9762\u8981\u6709\u4e2a\u7a7a\u683c)\u3002 job : Developer # An employee record martin : name : Martin D'vloper job : Developer skill : Elite \u66f4\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784 # Employee records - martin : name : Martin D'vloper job : Developer skills : - python - perl - pascal - tabitha : name : Tabitha Bitumen job : Developer skills : - lisp - fortran - erlang \u5b57\u5178\u548c\u5217\u8868\u4e5f\u53ef\u4ee5\u4f7f\u7528\u7f29\u5199\u7684\u5f62\u5f0f,\u5373\u884c\u5185\u8868\u793a\u6cd5 --- martin : { name : Martin D'vloper , job : Developer , skill : Elite } fruits : [ 'Apple' , 'Orange' , 'Strawberry' , 'Mango' ] \u7eaf\u91cf \u00b6 \u6570\u503c \u00b6 number : 12 float:12.30 \u5e03\u5c14\u503c \u00b6 \u8868\u793atrue\u7684\u503c true, True, TRUE, yes, Yes, YES, on, On, ON, y, Y \u8868\u793afalse\u7684\u503c false, False, FALSE, no, No, NO, off, Off, OFF, n, N create_key : yes needs_agent : no knows_oop : True likes_emacs : TRUE uses_cvs : false \u5f3a\u5236\u7c7b\u578b\u8f6c\u6362 \u00b6 YAML \u5141\u8bb8\u4f7f\u7528\u4e24\u4e2a\u611f\u53f9\u53f7\uff0c\u5f3a\u5236\u8f6c\u6362\u6570\u636e\u7c7b\u578b\u3002 e : !!str 123 f : !!str true \u5b57\u7b26\u4e32 \u00b6 \u5b57\u7b26\u4e32\u9ed8\u8ba4\u4e0d\u4f7f\u7528\u5f15\u53f7\u8868\u793a\u3002 str : \u8fd9\u662f\u4e00\u884c\u5b57\u7b26\u4e32 \u5982\u679c\u5b57\u7b26\u4e32\u4e4b\u4e2d\u5305\u542b\u7a7a\u683c\u6216\u7279\u6b8a\u5b57\u7b26\uff0c\u9700\u8981\u653e\u5728\u5f15\u53f7\u4e4b\u4e2d\u3002 s1 : '\u5185\u5bb9\\n\u5b57\u7b26\u4e32' s2 : \"\u5185\u5bb9\\n\u5b57\u7b26\u4e32\" \u5355\u5f15\u53f7\u548c\u53cc\u5f15\u53f7\u90fd\u53ef\u4ee5\u4f7f\u7528\uff0c\u53cc\u5f15\u53f7\u4e0d\u4f1a\u5bf9\u7279\u6b8a\u5b57\u7b26\u8f6c\u4e49\u3002 Ansible\u5bf9\u53d8\u91cf\u4f7f\u7528 {{var}} ,\u9700\u8981\u4f7f\u7528\u53cc\u5f15\u53f7\u5305\u88f9 foo : \"{{ variable }}\" foo : \"{{ variable }}/additional/string/literal\" \u5355\u5f15\u53f7\u4e4b\u4e2d\u5982\u679c\u8fd8\u6709\u5355\u5f15\u53f7\uff0c\u5fc5\u987b\u8fde\u7eed\u4f7f\u7528\u4e24\u4e2a\u5355\u5f15\u53f7\u8f6c\u4e49\u3002 str : 'labor '' s day' \u5b57\u7b26\u4e32\u53ef\u4ee5\u5199\u6210\u591a\u884c\uff0c\u4ece\u7b2c\u4e8c\u884c\u5f00\u59cb\uff0c\u5fc5\u987b\u6709\u4e00\u4e2a\u5355\u7a7a\u683c\u7f29\u8fdb\u3002\u6362\u884c\u7b26\u4f1a\u88ab\u8f6c\u4e3a\u7a7a\u683c\u3002 str : \u8fd9\u662f\u4e00\u6bb5 \u591a\u884c \u5b57\u7b26\u4e32 \u591a\u884c\u5b57\u7b26\u4e32\u53ef\u4ee5\u4f7f\u7528 | \u4fdd\u7559\u6362\u884c\u7b26\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 > \u6298\u53e0\u6362\u884c\u3002 this : | Foo Bar that : > Foo Bar + \u8868\u793a\u4fdd\u7559\u6587\u5b57\u5757\u672b\u5c3e\u7684\u6362\u884c\uff0c - \u8868\u793a\u5220\u9664\u5b57\u7b26\u4e32\u672b\u5c3e\u7684\u6362\u884c\u3002 s1 : | Foo s2 : |+ Foo s3 : |- Foo \u5b57\u7b26\u4e32\u4e4b\u4e2d\u53ef\u4ee5\u63d2\u5165 HTML \u6807\u8bb0\u3002 message : | <p style=\"color: red\"> \u6bb5\u843d </p> ## \u5f15\u7528 \u951a\u70b9 & \u548c\u522b\u540d * \uff0c\u53ef\u4ee5\u7528\u6765\u5f15\u7528\uff0c\u4ee5\u4fbf\u4e8e\u6570\u636e\u53ef\u4ee5\u91cd\u590d\u5229\u7528\uff0c\u4ece\u800c\u7cbe\u7b80\u58f0\u660e defaults : &defaults # \u951a\u70b9 adapter : postgres host : localhost development : database : myapp_development << : *defaults # \u5f15\u7528 test : database : myapp_test << : *defaults &\u7528\u6765\u5efa\u7acb\u951a\u70b9\uff08defaults\uff09\uff0c<<\u8868\u793a\u5408\u5e76\u5230\u5f53\u524d\u6570\u636e\uff0c*\u7528\u6765\u5f15\u7528\u951a\u70b9\u3002 \u7b49\u540c\u4e8e\u4e0b\u9762\u7684\u4ee3\u7801\u3002 defaults : adapter : postgres host : localhost development : database : myapp_development adapter : postgres host : localhost test : database : myapp_test adapter : postgres host : localhost \u4e0b\u9762\u662f\u53e6\u4e00\u4e2a\u4f8b\u5b50\u3002 - &showell Steve - Clark - Brian - Oren - *showell \u7b49\u540c\u4e8e - Steve - Clark - Brian - Oren - Steve \u53c2\u8003 \u00b6 Playbooks \u91c7\u7528YMAL \u8bed\u6cd5\u7ed3\u6784\uff0c\u57fa\u672c\u7684YMAL \u8bed\u6cd5\u8bf7\u53c2\u8003 http://docs.ansible.com/YAMLSyntax.html python\u5229\u7528pyyaml\u6a21\u5757\u8fdb\u884c\u89e3\u6790yaml\u8bed\u8a00 http://pyyaml.org/wiki/PyYAMLDocumentation yaml\u683c\u5f0f\u5728\u7ebf\u68c0\u67e5 http://yaml-online-parser.appspot.com/","title":"1. YAML \u8bed\u6cd5"},{"location":"basic/Reference/Yaml/#yaml","text":"YAML \u8bed\u8a00\uff08\u53d1\u97f3 /\u02c8j\u00e6m\u0259l/ \uff09\u7684\u8bbe\u8ba1\u76ee\u6807\uff0c\u5c31\u662f\u65b9\u4fbf\u4eba\u7c7b\u8bfb\u5199\u3002\u5b83\u5b9e\u8d28\u4e0a\u662f\u4e00\u79cd\u901a\u7528\u7684\u6570\u636e\u4e32\u884c\u5316\u683c\u5f0f\u3002 \u5b83\u7684\u57fa\u672c\u8bed\u6cd5\u89c4\u5219\u5982\u4e0b\u3002 \u5927\u5c0f\u5199\u654f\u611f \u4f7f\u7528\u7f29\u8fdb\u8868\u793a\u5c42\u7ea7\u5173\u7cfb \u7f29\u8fdb\u65f6\u4e0d\u5141\u8bb8\u4f7f\u7528Tab\u952e\uff0c\u53ea\u5141\u8bb8\u4f7f\u7528\u7a7a\u683c\u3002 \u7f29\u8fdb\u7684\u7a7a\u683c\u6570\u76ee\u4e0d\u91cd\u8981\uff0c\u53ea\u8981\u76f8\u540c\u5c42\u7ea7\u7684\u5143\u7d20\u5de6\u4fa7\u5bf9\u9f50\u5373\u53ef yaml\u6587\u4ef6\u4ee5\"---\"\u4f5c\u4e3a\u6587\u6863\u7684\u5f00\u59cb\uff0c\"...\"\u4f5c\u4e3a\u6587\u6863\u7684\u7ed3\u675f # \u8868\u793a\u6ce8\u91ca\uff0c\u4ece\u8fd9\u4e2a\u5b57\u7b26\u4e00\u76f4\u5230\u884c\u5c3e\uff0c\u90fd\u4f1a\u88ab\u89e3\u6790\u5668\u5ffd\u7565\u3002 \u76f8\u540c\u7f29\u8fdb\u7ea7\u522b\u7684\u884c\u4ee5\u201c- \u201d\uff08\u7834\u6298\u53f7\u548c\u7a7a\u683c\uff09\u5f00\u5934\u7684\u7ec4\u6210\u4e00\u4e2a\u5217\u8868\u3002 --- # A list of tasty fruits - Apple - Orange - Strawberry - Mango ... YAML \u652f\u6301\u7684\u6570\u636e\u7ed3\u6784\u6709\u4e09\u79cd\u3002 \u6570\u7ec4\uff1a\u4e00\u7ec4\u6309\u6b21\u5e8f\u6392\u5217\u7684\u503c\uff0c\u53c8\u79f0\u4e3a\u5e8f\u5217\uff08sequence\uff09 / \u5217\u8868\uff08list\uff09 \u5bf9\u8c61\uff1a\u952e\u503c\u5bf9\u7684\u96c6\u5408\uff0c\u53c8\u79f0\u4e3a\u6620\u5c04\uff08mapping\uff09/ \u54c8\u5e0c\uff08hashes\uff09 / \u5b57\u5178\uff08dictionary\uff09 \u7eaf\u91cf\uff08scalars\uff09\uff1a\u5355\u4e2a\u7684\u3001\u4e0d\u53ef\u518d\u5206\u7684\u503c","title":"YAML \u8bed\u6cd5"},{"location":"basic/Reference/Yaml/#_1","text":"\u76f8\u540c\u7f29\u8fdb\u7ea7\u522b\u7684\u884c\u4ee5\u201c- \u201d\uff08\u7834\u6298\u53f7\u548c\u7a7a\u683c\uff09\u5f00\u5934\u7684\u7ec4\u6210\u4e00\u4e2a\u5217\u8868\u3002 --- fruits : - Apple - Orange - Strawberry - Mango","title":"\u6570\u7ec4"},{"location":"basic/Reference/Yaml/#_2","text":"\u5bf9\u8c61\u7684\u4e00\u7ec4\u952e\u503c\u5bf9\uff0c\u4f7f\u7528\u5192\u53f7\u7ed3\u6784\u8868\u793a(\u5192\u53f7\u540e\u9762\u8981\u6709\u4e2a\u7a7a\u683c)\u3002 job : Developer # An employee record martin : name : Martin D'vloper job : Developer skill : Elite \u66f4\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784 # Employee records - martin : name : Martin D'vloper job : Developer skills : - python - perl - pascal - tabitha : name : Tabitha Bitumen job : Developer skills : - lisp - fortran - erlang \u5b57\u5178\u548c\u5217\u8868\u4e5f\u53ef\u4ee5\u4f7f\u7528\u7f29\u5199\u7684\u5f62\u5f0f,\u5373\u884c\u5185\u8868\u793a\u6cd5 --- martin : { name : Martin D'vloper , job : Developer , skill : Elite } fruits : [ 'Apple' , 'Orange' , 'Strawberry' , 'Mango' ]","title":"\u5bf9\u8c61"},{"location":"basic/Reference/Yaml/#_3","text":"","title":"\u7eaf\u91cf"},{"location":"basic/Reference/Yaml/#_4","text":"number : 12 float:12.30","title":"\u6570\u503c"},{"location":"basic/Reference/Yaml/#_5","text":"\u8868\u793atrue\u7684\u503c true, True, TRUE, yes, Yes, YES, on, On, ON, y, Y \u8868\u793afalse\u7684\u503c false, False, FALSE, no, No, NO, off, Off, OFF, n, N create_key : yes needs_agent : no knows_oop : True likes_emacs : TRUE uses_cvs : false","title":"\u5e03\u5c14\u503c"},{"location":"basic/Reference/Yaml/#_6","text":"YAML \u5141\u8bb8\u4f7f\u7528\u4e24\u4e2a\u611f\u53f9\u53f7\uff0c\u5f3a\u5236\u8f6c\u6362\u6570\u636e\u7c7b\u578b\u3002 e : !!str 123 f : !!str true","title":"\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362"},{"location":"basic/Reference/Yaml/#_7","text":"\u5b57\u7b26\u4e32\u9ed8\u8ba4\u4e0d\u4f7f\u7528\u5f15\u53f7\u8868\u793a\u3002 str : \u8fd9\u662f\u4e00\u884c\u5b57\u7b26\u4e32 \u5982\u679c\u5b57\u7b26\u4e32\u4e4b\u4e2d\u5305\u542b\u7a7a\u683c\u6216\u7279\u6b8a\u5b57\u7b26\uff0c\u9700\u8981\u653e\u5728\u5f15\u53f7\u4e4b\u4e2d\u3002 s1 : '\u5185\u5bb9\\n\u5b57\u7b26\u4e32' s2 : \"\u5185\u5bb9\\n\u5b57\u7b26\u4e32\" \u5355\u5f15\u53f7\u548c\u53cc\u5f15\u53f7\u90fd\u53ef\u4ee5\u4f7f\u7528\uff0c\u53cc\u5f15\u53f7\u4e0d\u4f1a\u5bf9\u7279\u6b8a\u5b57\u7b26\u8f6c\u4e49\u3002 Ansible\u5bf9\u53d8\u91cf\u4f7f\u7528 {{var}} ,\u9700\u8981\u4f7f\u7528\u53cc\u5f15\u53f7\u5305\u88f9 foo : \"{{ variable }}\" foo : \"{{ variable }}/additional/string/literal\" \u5355\u5f15\u53f7\u4e4b\u4e2d\u5982\u679c\u8fd8\u6709\u5355\u5f15\u53f7\uff0c\u5fc5\u987b\u8fde\u7eed\u4f7f\u7528\u4e24\u4e2a\u5355\u5f15\u53f7\u8f6c\u4e49\u3002 str : 'labor '' s day' \u5b57\u7b26\u4e32\u53ef\u4ee5\u5199\u6210\u591a\u884c\uff0c\u4ece\u7b2c\u4e8c\u884c\u5f00\u59cb\uff0c\u5fc5\u987b\u6709\u4e00\u4e2a\u5355\u7a7a\u683c\u7f29\u8fdb\u3002\u6362\u884c\u7b26\u4f1a\u88ab\u8f6c\u4e3a\u7a7a\u683c\u3002 str : \u8fd9\u662f\u4e00\u6bb5 \u591a\u884c \u5b57\u7b26\u4e32 \u591a\u884c\u5b57\u7b26\u4e32\u53ef\u4ee5\u4f7f\u7528 | \u4fdd\u7559\u6362\u884c\u7b26\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 > \u6298\u53e0\u6362\u884c\u3002 this : | Foo Bar that : > Foo Bar + \u8868\u793a\u4fdd\u7559\u6587\u5b57\u5757\u672b\u5c3e\u7684\u6362\u884c\uff0c - \u8868\u793a\u5220\u9664\u5b57\u7b26\u4e32\u672b\u5c3e\u7684\u6362\u884c\u3002 s1 : | Foo s2 : |+ Foo s3 : |- Foo \u5b57\u7b26\u4e32\u4e4b\u4e2d\u53ef\u4ee5\u63d2\u5165 HTML \u6807\u8bb0\u3002 message : | <p style=\"color: red\"> \u6bb5\u843d </p> ## \u5f15\u7528 \u951a\u70b9 & \u548c\u522b\u540d * \uff0c\u53ef\u4ee5\u7528\u6765\u5f15\u7528\uff0c\u4ee5\u4fbf\u4e8e\u6570\u636e\u53ef\u4ee5\u91cd\u590d\u5229\u7528\uff0c\u4ece\u800c\u7cbe\u7b80\u58f0\u660e defaults : &defaults # \u951a\u70b9 adapter : postgres host : localhost development : database : myapp_development << : *defaults # \u5f15\u7528 test : database : myapp_test << : *defaults &\u7528\u6765\u5efa\u7acb\u951a\u70b9\uff08defaults\uff09\uff0c<<\u8868\u793a\u5408\u5e76\u5230\u5f53\u524d\u6570\u636e\uff0c*\u7528\u6765\u5f15\u7528\u951a\u70b9\u3002 \u7b49\u540c\u4e8e\u4e0b\u9762\u7684\u4ee3\u7801\u3002 defaults : adapter : postgres host : localhost development : database : myapp_development adapter : postgres host : localhost test : database : myapp_test adapter : postgres host : localhost \u4e0b\u9762\u662f\u53e6\u4e00\u4e2a\u4f8b\u5b50\u3002 - &showell Steve - Clark - Brian - Oren - *showell \u7b49\u540c\u4e8e - Steve - Clark - Brian - Oren - Steve","title":"\u5b57\u7b26\u4e32"},{"location":"basic/Reference/Yaml/#_8","text":"Playbooks \u91c7\u7528YMAL \u8bed\u6cd5\u7ed3\u6784\uff0c\u57fa\u672c\u7684YMAL \u8bed\u6cd5\u8bf7\u53c2\u8003 http://docs.ansible.com/YAMLSyntax.html python\u5229\u7528pyyaml\u6a21\u5757\u8fdb\u884c\u89e3\u6790yaml\u8bed\u8a00 http://pyyaml.org/wiki/PyYAMLDocumentation yaml\u683c\u5f0f\u5728\u7ebf\u68c0\u67e5 http://yaml-online-parser.appspot.com/","title":"\u53c2\u8003"},{"location":"basic/Windows/manager-windows/","text":"\u7ba1\u7406 windows \u4e3b\u673a \u00b6 windows \u7cfb\u7edf\u8981\u6c42 \u00b6 PowerShell 3 \u6216\u66f4\u9ad8 \u4e0d\u652f\u6301Cygwin \u5728Windows 7\u548cServer 2008 R2\u8ba1\u7b97\u673a\u4e0a\uff0c\u7531\u4e8eWindows Management Framework 3.0\u4e2d\u7684\u9519\u8bef\uff0c\u53ef\u80fd\u9700\u8981\u5b89\u88c5\u6b64\u4fee\u8865\u7a0b\u5e8f http://support.microsoft.com/kb/2842230 \u4ee5\u907f\u514d\u6536\u5230\u5185\u5b58\u548c\u5806\u6808\u6ea2\u51fa\u5f02\u5e38\u3002\u5df2\u77e5\u65b0\u5b89\u88c5\u7684Server 2008 R2\u7cfb\u7edf\u4e0eWindows\u66f4\u65b0\u4e0d\u517c\u5bb9\uff0c\u5177\u6709\u6b64\u95ee\u9898\u3002Windows 8.1\u548cServer 2012 R2\u4e0d\u53d7Windows Management Framework 4.0\u9644\u5e26\u7684\u6b64\u95ee\u9898\u7684\u5f71\u54cd\u3002 inventory \u793a\u4f8b\u6587\u4ef6 \u00b6 [windows] winserver1.example.com winserver2.example.com [windows:vars] ansible_user=Administrator ansible_password=123456 ansible_port=5986 ansible_connection=winrm # The following is necessary for Python 2.7.9+ (or any older Python that has backported SSLContext, eg, Python 2.7.5 on RHEL7) when using default WinRM self-signed certificates: ansible_winrm_server_cert_validation=ignore inventory \u53ef\u7528\u53d8\u91cf \u00b6 ansible_winrm_scheme\uff1a\u6307\u5b9a\u7528\u4e8eWinRM\u8fde\u63a5\u7684\u8fde\u63a5\u65b9\u6848\uff08http\u6216https\uff09\u3002https\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4f7f\u7528\uff0c\u9664\u975e\u7aef\u53e3\u662f5985\u3002 ansible_winrm_path\uff1a\u6307\u5b9aWinRM\u7aef\u70b9\u7684\u5907\u7528\u8def\u5f84\u3002/wsman\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4f7f\u7528\u3002 ansible_winrm_realm\uff1a\u6307\u5b9a\u7528\u4e8eKerberos\u8eab\u4efd\u9a8c\u8bc1\u7684\u9886\u57df\u3002\u5982\u679c\u7528\u6237\u540d\u5305\u542b@\uff0cAnsible\u5c06@\u9ed8\u8ba4\u4f7f\u7528\u90e8\u5206\u7528\u6237\u540d\u3002 ansible_winrm_transport\uff1a\u4ee5\u4e00\u4e2a\u9017\u53f7\u5206\u9694\u7684\u5217\u8868\u6307\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\u4f20\u8f93\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ckerberos,plaintext\u5982\u679c\u5df2kerberos\u5b89\u88c5\u6a21\u5757\u5e76\u5b9a\u4e49\u4e86\u4e00\u4e2a\u57df\uff0c\u5219\u201c \u53ef\u7528\u201d\u5c06\u4f1a\u4f7f\u7528\uff0c\u5426\u5219plaintext\u3002 ansible_winrm_server_cert_validation\uff1a\u6307\u5b9a\u670d\u52a1\u5668\u8bc1\u4e66\u9a8c\u8bc1\u6a21\u5f0f\uff08ignore\u6216validate\uff09\u3002validatePython 2.7.9\u53ca\u66f4\u9ad8\u7248\u672c\u7684\u53ef\u9009\u9ed8\u8ba4\u503c\u5c06\u5bfc\u81f4Windows\u81ea\u7b7e\u540d\u8bc1\u4e66\u7684\u8bc1\u4e66\u9a8c\u8bc1\u9519\u8bef\u3002\u9664\u975e\u5728WinRM\u4fa6\u542c\u5668\u4e0a\u914d\u7f6e\u4e86\u53ef\u9a8c\u8bc1\u7684\u8bc1\u4e66\uff0c\u5426\u5219\u5e94\u5c06\u5176\u8bbe\u7f6e\u4e3aignore ansible_winrm_kerberos_delegation\uff1a\u8bbe\u7f6e\u4e3atrue\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u4f7f\u7528Kerberos\u65f6\u542f\u7528\u547d\u4ee4\u59d4\u6d3e\u3002 ansible_winrm_*\uff1awinrm.Protocol\u53ef\u4ee5\u63d0\u4f9b\u652f\u6301\u7684\u4efb\u4f55\u5176\u4ed6\u5173\u952e\u5b57\u53c2\u6570\u3002 \u6709\u4ec0\u4e48\u6a21\u5757\u53ef\u4ee5\u7528\u7684\uff1f \u00b6 \u2022 add_host \u2022 assert \u2022 async \u2022 debug \u2022 fail \u2022 fetch \u2022 group_by \u2022 include_vars \u2022 meta \u2022 pause \u2022 raw \u2022 script \u2022 set_fact \u2022 setup \u2022 slurp \u2022 template (also: win_template) \u4e13\u95e8\u7528\u4f5cwindows\u7cfb\u7edf\u7684 \u6a21\u5757 \u83b7\u53d6 Windows Facts \u00b6 ansible winhost.example.com -m setup Windows Playbook\u793a\u4f8b \u00b6 # \u6267\u884cpowershell\u811a\u672c - name : test script module hosts : windows tasks : - name : run test script script : files/test_script.ps1 # \u83b7\u53d6ip\u5730\u5740\u4fe1\u606f - name : test raw module hosts : windows tasks : - name : run ipconfig win_command : ipconfig register : ipconfig - debug : var=ipconfig # \u4f7f\u7528dos\u547d\u4ee4\uff0c\u79fb\u52a8\u6587\u4ef6 - name : another raw module example hosts : windows tasks : - name : Move file on remote Windows Server from one location to another win_command : CMD /C \"MOVE /Y C:\\teststuff\\myfile.conf C:\\builds\\smtp.conf\" # \u4f7f\u7528powershell\u547d\u4ee4\uff0c\u79fb\u52a8\u6587\u4ef6 - name : another raw module example demonstrating powershell one liner hosts : windows tasks : - name : Move file on remote Windows Server from one location to another win_command : Powershell.exe \"Move-Item C:\\teststuff\\myfile.conf C:\\builds\\smtp.conf\" # \u67e5\u770b\u6587\u4ef6\u72b6\u6001 - name : test stat module hosts : windows tasks : - name : test stat module on file win_stat : path=\"C:/Windows/win.ini\" register : stat_file - debug : var=stat_file - name : check stat_file result assert : that : - \"stat_file.stat.exists\" - \"not stat_file.stat.isdir\" - \"stat_file.stat.size > 0\" - \"stat_file.stat.md5\" \u672c\u6b21\u5b9e\u9a8c\u73af\u5883 \u00b6 windows os\uff1a Microsoft Windows Server 2016 ansible manager\uff1a centos 7.7 X64 ansible version\uff1a 2.9.6.0 python version\uff1a Python 2.7.5 Windows Server 2016 \u8282\u70b9\u914d\u7f6e \u00b6 \u4ee5\u7ba1\u7406\u5458\u8eab\u4efd\u6253\u5f00powershell \u67e5\u770b\u5f53\u524dps\u7248\u672c PS C : \\ Users \\ Administrator > $PSVersionTable Name Value ---- ----- PSVersion 5 . 1 . 14393 . 1884 PSEdition Desktop PSCompatibleVersions { 1 . 0 , 2 . 0 , 3 . 0 , 4 . 0 ...} BuildVersion 10 . 0 . 14393 . 1884 CLRVersion 4 . 0 . 30319 . 42000 WSManStackVersion 3 . 0 PSRemotingProtocolVersion 2 . 3 SerializationVersion 1 . 1 . 0 . 1 Tips Ansible \u9700\u8981\u5728 powershell 3.0, .net Framework 4.0\u6216\u66f4\u65b0\u7684\u7248\u672c\u4e0a\u8fd0\u884c\uff0c\u53ef\u4ee5\u7528\u4e0b\u5217\u547d\u4ee4\u5347\u7ea7powershell $url = \"https://raw.githubusercontent.com/jborean93/ansible-windows/master/scripts/Upgrade-PowerShell.ps1\" $file = \"$env:temp\\Upgrade-PowerShell.ps1\" $username = \"Administrator\" $password = \"Password\" ( New-Object -TypeName System . Net . WebClient ). DownloadFile ( $url , $file ) Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Force # Version can be 3.0, 4.0 or 5.1 & $file -Version 5 . 1 -Username $username -Password $password -Verbose \u5b8c\u6210\u540e\uff0c\u60a8\u9700\u8981\u5c06\u5220\u9664\u81ea\u52a8\u767b\u5f55\u5e76\u5c06\u6267\u884c\u7b56\u7565\u8bbe\u7f6e\u56de\u9ed8\u8ba4\u503cRestricted\u3002 # This isn't needed but is a good security practice to complete Set-ExecutionPolicy -ExecutionPolicy Restricted -Force $reg_winlogon_path = \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" Set-ItemProperty -Path $reg_winlogon_path -Name AutoAdminLogon -Value 0 Remove-ItemProperty -Path $reg_winlogon_path -Name DefaultUserName -ErrorAction SilentlyContinue Remove-ItemProperty -Path $reg_winlogon_path -Name DefaultPassword -ErrorAction SilentlyContinue \u5728PowerShell v3.0\u4e0a\u8fd0\u884c\u65f6\uff0cWinRM\u670d\u52a1\u6709\u4e00\u4e2a\u7f3a\u9677\uff0c\u9650\u5236\u4e86WinRM\u53ef\u7528\u7684\u5185\u5b58\u91cf\u3002\u53ef\u4ee5\u4f7f\u7528\u4e0b\u5217\u547d\u4ee4\u4fee\u8865\u3002 $url = \"https://raw.githubusercontent.com/jborean93/ansible-windows/master/scripts/Install-WMF3Hotfix.ps1\" $file = \"$env:temp\\Install-WMF3Hotfix.ps1\" ( New-Object -TypeName System . Net . WebClient ). DownloadFile ( $url , $file ) powershell . exe -ExecutionPolicy ByPass -File $file -Verbose \u914d\u7f6ewinrm \u4f7f\u7528\u811a\u672c\u542f\u7528HTTP\u548cHTTPS\u7684\u4fa6\u542c\u5668 $url = \"https://raw.githubusercontent.com/ansible/ansible/devel/examples/scripts/ConfigureRemotingForAnsible.ps1\" $file = \"$env:temp\\ConfigureRemotingForAnsible.ps1\" ( New-Object -TypeName System . Net . WebClient ). DownloadFile ( $url , $file ) powershell . exe -ExecutionPolicy ByPass -File $file \u83b7\u53d6winrm\u4fe1\u606f PS C : \\ Users \\ Administrator \\ Desktop > winrm get winrm / config / Service Service RootSDDL = O : NSG : BAD : P ( A ;; GA ;;; BA )( A ;; GR ;;; IU ) S : P ( AU ; FA ; GA ;;; WD )( AU ; SA ; GXGW ;;; WD ) MaxConcurrentOperations = 4294967295 MaxConcurrentOperationsPerUser = 1500 EnumerationTimeoutms = 240000 MaxConnections = 300 MaxPacketRetrievalTimeSeconds = 120 AllowUnencrypted = false Auth Basic = true Kerberos = true Negotiate = true Certificate = false CredSSP = false CbtHardeningLevel = Relaxed DefaultPorts HTTP = 5985 HTTPS = 5986 IPv4Filter = * IPv6Filter = * EnableCompatibilityHttpListener = false EnableCompatibilityHttpsListener = false CertificateThumbprint AllowRemoteAccess = true PS C : \\ Users \\ Administrator \\ Desktop > winrm get winrm / config / Winrs Winrs AllowRemoteShellAccess = true IdleTimeout = 7200000 MaxConcurrentUsers = 2147483647 MaxShellRunTime = 2147483647 MaxProcessesPerShell = 2147483647 MaxMemoryPerShellMB = 2147483647 MaxShellsPerUser = 2147483647 \u6d4b\u8bd5winrm\u8fde\u63a5 $username = \"Administrator\" $password = \"Admin123\" # Test out HTTP winrs -r : http : // 127 . 0 . 0 . 1 : 5985 / wsman -u : $username -p : $password ipconfig # Test out HTTPS (will fail if the cert is not verifiable) winrs -r : https : // 127 . 0 . 0 . 1 : 5986 / wsman -u : $username -p : $password -ssl ipconfig # Test out HTTPS, ignoring certificate verification $username = \"Administrator\" $password = ConvertTo-SecureString -String \"Admin123\" -AsPlainText -Force $cred = New-Object -TypeName System . Management . Automation . PSCredential -ArgumentList $username , $password $session_option = New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck Invoke-Command -ComputerName 127 . 0 . 0 . 1 -UseSSL -ScriptBlock { ipconfig } -Credential $cred -SessionOption $session_option ansible manager \u914d\u7f6e \u00b6 \u5b89\u88c5ansible\u548cpywinrm yum -y install ansible curl -sL https://bootstrap.pypa.io/get-pip.py | python pip install pywinrm \u914d\u7f6ehosts [ root@master ~ ] # cd /etc/ansible/ [ root@master ansible ] # cat win_hosts [ windows ] 192 .168.77.135 [ windows:vars ] ansible_user = Administrator ansible_password = Admin123 ansible_port = 5986 ansible_connection = winrm ansible_winrm_server_cert_validation = ignore \u6d4b\u8bd5\u901a\u4fe1 bash # ansible -i win_hosts windows -m win_ping 192.168.77.135 | SUCCESS => { \"changed\": false, \"ping\": \"pong\" } \u67e5\u770b\u7cfb\u7edf\u4fe1\u606f # ansible -i win_hosts windows -m win_command -a \"whoami\" 192 .168.77.135 | CHANGED | rc = 0 >> win-v5sbnpsnfom \\a dministrator # ansible -i win_hosts windows -m win_command -a \"systeminfo\" 192 .168.77.135 | CHANGED | rc = 0 >> Host Name: WIN-V5SBNPSNFOM OS Name: Microsoft Windows Server 2016 Datacenter OS Version: 10 .0.14393 N/A Build 14393 OS Manufacturer: Microsoft Corporation OS Configuration: Standalone Server OS Build Type: Multiprocessor Free Registered Owner: Windows \u7528\u6237 Registered Organization: Product ID: 00376 -40000-00000-AA947 Original Install Date: 2019 /7/24, 14 :54:43 System Boot Time: 2020 /4/8, 18 :03:12 System Manufacturer: VMware, Inc. System Model: VMware7,1 System Type: x64-based PC Processor ( s ) : 2 Processor ( s ) Installed. [ 01 ] : Intel64 Family 6 Model 60 Stepping 3 GenuineIntel ~3592 Mhz [ 02 ] : Intel64 Family 6 Model 60 Stepping 3 GenuineIntel ~3592 Mhz BIOS Version: VMware, Inc. VMW71.00V.14410784.B64.1908150010, 2019 /8/15 Windows Directory: C: \\W indows System Directory: C: \\W indows \\s ystem32 Boot Device: \\D evice \\H arddiskVolume2 System Locale: zh-cn ; Chinese ( China ) Input Locale: zh-cn ; Chinese ( China ) Time Zone: ( UTC+08:00 ) Beijing, Chongqing, Hong Kong, Urumqi Total Physical Memory: 2 ,047 MB Available Physical Memory: 847 MB Virtual Memory: Max Size: 3 ,199 MB Virtual Memory: Available: 2 ,019 MB Virtual Memory: In Use: 1 ,180 MB Page File Location ( s ) : C: \\p agefile.sys Domain: WORKGROUP Logon Server: \\\\ WIN-V5SBNPSNFOM Hotfix ( s ) : 2 Hotfix ( s ) Installed. [ 01 ] : KB4049065 [ 02 ] : KB4048953 Network Card ( s ) : 1 NIC ( s ) Installed. [ 01 ] : Intel ( R ) 82574L Gigabit Network Connection Connection Name: Ethernet0 DHCP Enabled: Yes DHCP Server: 192 .168.77.254 IP address ( es ) [ 01 ] : 192 .168.77.135 [ 02 ] : fe80::cd89:483d:58ae:d350 Hyper-V Requirements: A hypervisor has been detected. Features required for Hyper-V will not be displayed. # ansible -i win_hosts windows -m win_shell -a \"\\$PSVersionTable\" 192 .168.77.135 | CHANGED | rc = 0 >> Name Value ---- ----- PSVersion 5 .1.14393.1884 PSEdition Desktop PSCompatibleVersions { 1 .0, 2 .0, 3 .0, 4 .0... } BuildVersion 10 .0.14393.1884 CLRVersion 4 .0.30319.42000 WSManStackVersion 3 .0 PSRemotingProtocolVersion 2 .3 SerializationVersion 1 .1.0.1 \u67e5\u770bip\u5730\u5740 # ansible -i win_hosts windows -m win_command -a \"ipconfig\" 192 .168.77.135 | CHANGED | rc = 0 >> Windows IP Configuration Ethernet adapter Ethernet0: Connection-specific DNS Suffix . : localdomain Link-local IPv6 Address . . . . . : fe80::cd89:483d:58ae:d350%4 IPv4 Address. . . . . . . . . . . : 192 .168.77.135 Subnet Mask . . . . . . . . . . . : 255 .255.255.0 Default Gateway . . . . . . . . . : 192 .168.77.2 Tunnel adapter isatap.localdomain: Media State . . . . . . . . . . . : Media disconnected Connection-specific DNS Suffix . : localdomain Tunnel adapter Teredo Tunneling Pseudo-Interface: Connection-specific DNS Suffix . : IPv6 Address. . . . . . . . . . . : 2001 :0:348b:fb58:1014:186b:3f57:b278 Link-local IPv6 Address . . . . . : fe80::1014:186b:3f57:b278%2 Default Gateway . . . . . . . . . : :: # ansible -i win_hosts windows -m raw -a \"ipconfig\" 192 .168.77.135 | CHANGED | rc = 0 >> Windows IP Configuration Ethernet adapter Ethernet0: Connection-specific DNS Suffix . : localdomain Link-local IPv6 Address . . . . . : fe80::cd89:483d:58ae:d350%4 IPv4 Address. . . . . . . . . . . : 192 .168.77.135 Subnet Mask . . . . . . . . . . . : 255 .255.255.0 Default Gateway . . . . . . . . . : 192 .168.77.2 Tunnel adapter isatap.localdomain: Media State . . . . . . . . . . . : Media disconnected Connection-specific DNS Suffix . : localdomain Tunnel adapter Teredo Tunneling Pseudo-Interface: Connection-specific DNS Suffix . : IPv6 Address. . . . . . . . . . . : 2001 :0:348b:fb58:1014:186b:3f57:b278 Link-local IPv6 Address . . . . . : fe80::1014:186b:3f57:b278%2 Default Gateway . . . . . . . . . : ::","title":"1. \u7ba1\u7406 Windows \u4e3b\u673a"},{"location":"basic/Windows/manager-windows/#windows","text":"","title":"\u7ba1\u7406 windows \u4e3b\u673a"},{"location":"basic/Windows/manager-windows/#windows_1","text":"PowerShell 3 \u6216\u66f4\u9ad8 \u4e0d\u652f\u6301Cygwin \u5728Windows 7\u548cServer 2008 R2\u8ba1\u7b97\u673a\u4e0a\uff0c\u7531\u4e8eWindows Management Framework 3.0\u4e2d\u7684\u9519\u8bef\uff0c\u53ef\u80fd\u9700\u8981\u5b89\u88c5\u6b64\u4fee\u8865\u7a0b\u5e8f http://support.microsoft.com/kb/2842230 \u4ee5\u907f\u514d\u6536\u5230\u5185\u5b58\u548c\u5806\u6808\u6ea2\u51fa\u5f02\u5e38\u3002\u5df2\u77e5\u65b0\u5b89\u88c5\u7684Server 2008 R2\u7cfb\u7edf\u4e0eWindows\u66f4\u65b0\u4e0d\u517c\u5bb9\uff0c\u5177\u6709\u6b64\u95ee\u9898\u3002Windows 8.1\u548cServer 2012 R2\u4e0d\u53d7Windows Management Framework 4.0\u9644\u5e26\u7684\u6b64\u95ee\u9898\u7684\u5f71\u54cd\u3002","title":"windows \u7cfb\u7edf\u8981\u6c42"},{"location":"basic/Windows/manager-windows/#inventory","text":"[windows] winserver1.example.com winserver2.example.com [windows:vars] ansible_user=Administrator ansible_password=123456 ansible_port=5986 ansible_connection=winrm # The following is necessary for Python 2.7.9+ (or any older Python that has backported SSLContext, eg, Python 2.7.5 on RHEL7) when using default WinRM self-signed certificates: ansible_winrm_server_cert_validation=ignore","title":"inventory \u793a\u4f8b\u6587\u4ef6"},{"location":"basic/Windows/manager-windows/#inventory_1","text":"ansible_winrm_scheme\uff1a\u6307\u5b9a\u7528\u4e8eWinRM\u8fde\u63a5\u7684\u8fde\u63a5\u65b9\u6848\uff08http\u6216https\uff09\u3002https\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4f7f\u7528\uff0c\u9664\u975e\u7aef\u53e3\u662f5985\u3002 ansible_winrm_path\uff1a\u6307\u5b9aWinRM\u7aef\u70b9\u7684\u5907\u7528\u8def\u5f84\u3002/wsman\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4f7f\u7528\u3002 ansible_winrm_realm\uff1a\u6307\u5b9a\u7528\u4e8eKerberos\u8eab\u4efd\u9a8c\u8bc1\u7684\u9886\u57df\u3002\u5982\u679c\u7528\u6237\u540d\u5305\u542b@\uff0cAnsible\u5c06@\u9ed8\u8ba4\u4f7f\u7528\u90e8\u5206\u7528\u6237\u540d\u3002 ansible_winrm_transport\uff1a\u4ee5\u4e00\u4e2a\u9017\u53f7\u5206\u9694\u7684\u5217\u8868\u6307\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\u4f20\u8f93\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ckerberos,plaintext\u5982\u679c\u5df2kerberos\u5b89\u88c5\u6a21\u5757\u5e76\u5b9a\u4e49\u4e86\u4e00\u4e2a\u57df\uff0c\u5219\u201c \u53ef\u7528\u201d\u5c06\u4f1a\u4f7f\u7528\uff0c\u5426\u5219plaintext\u3002 ansible_winrm_server_cert_validation\uff1a\u6307\u5b9a\u670d\u52a1\u5668\u8bc1\u4e66\u9a8c\u8bc1\u6a21\u5f0f\uff08ignore\u6216validate\uff09\u3002validatePython 2.7.9\u53ca\u66f4\u9ad8\u7248\u672c\u7684\u53ef\u9009\u9ed8\u8ba4\u503c\u5c06\u5bfc\u81f4Windows\u81ea\u7b7e\u540d\u8bc1\u4e66\u7684\u8bc1\u4e66\u9a8c\u8bc1\u9519\u8bef\u3002\u9664\u975e\u5728WinRM\u4fa6\u542c\u5668\u4e0a\u914d\u7f6e\u4e86\u53ef\u9a8c\u8bc1\u7684\u8bc1\u4e66\uff0c\u5426\u5219\u5e94\u5c06\u5176\u8bbe\u7f6e\u4e3aignore ansible_winrm_kerberos_delegation\uff1a\u8bbe\u7f6e\u4e3atrue\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u4f7f\u7528Kerberos\u65f6\u542f\u7528\u547d\u4ee4\u59d4\u6d3e\u3002 ansible_winrm_*\uff1awinrm.Protocol\u53ef\u4ee5\u63d0\u4f9b\u652f\u6301\u7684\u4efb\u4f55\u5176\u4ed6\u5173\u952e\u5b57\u53c2\u6570\u3002","title":"inventory \u53ef\u7528\u53d8\u91cf"},{"location":"basic/Windows/manager-windows/#_1","text":"\u2022 add_host \u2022 assert \u2022 async \u2022 debug \u2022 fail \u2022 fetch \u2022 group_by \u2022 include_vars \u2022 meta \u2022 pause \u2022 raw \u2022 script \u2022 set_fact \u2022 setup \u2022 slurp \u2022 template (also: win_template) \u4e13\u95e8\u7528\u4f5cwindows\u7cfb\u7edf\u7684 \u6a21\u5757","title":"\u6709\u4ec0\u4e48\u6a21\u5757\u53ef\u4ee5\u7528\u7684\uff1f"},{"location":"basic/Windows/manager-windows/#windows-facts","text":"ansible winhost.example.com -m setup","title":"\u83b7\u53d6 Windows Facts"},{"location":"basic/Windows/manager-windows/#windows-playbook","text":"# \u6267\u884cpowershell\u811a\u672c - name : test script module hosts : windows tasks : - name : run test script script : files/test_script.ps1 # \u83b7\u53d6ip\u5730\u5740\u4fe1\u606f - name : test raw module hosts : windows tasks : - name : run ipconfig win_command : ipconfig register : ipconfig - debug : var=ipconfig # \u4f7f\u7528dos\u547d\u4ee4\uff0c\u79fb\u52a8\u6587\u4ef6 - name : another raw module example hosts : windows tasks : - name : Move file on remote Windows Server from one location to another win_command : CMD /C \"MOVE /Y C:\\teststuff\\myfile.conf C:\\builds\\smtp.conf\" # \u4f7f\u7528powershell\u547d\u4ee4\uff0c\u79fb\u52a8\u6587\u4ef6 - name : another raw module example demonstrating powershell one liner hosts : windows tasks : - name : Move file on remote Windows Server from one location to another win_command : Powershell.exe \"Move-Item C:\\teststuff\\myfile.conf C:\\builds\\smtp.conf\" # \u67e5\u770b\u6587\u4ef6\u72b6\u6001 - name : test stat module hosts : windows tasks : - name : test stat module on file win_stat : path=\"C:/Windows/win.ini\" register : stat_file - debug : var=stat_file - name : check stat_file result assert : that : - \"stat_file.stat.exists\" - \"not stat_file.stat.isdir\" - \"stat_file.stat.size > 0\" - \"stat_file.stat.md5\"","title":"Windows Playbook\u793a\u4f8b"},{"location":"basic/Windows/manager-windows/#_2","text":"windows os\uff1a Microsoft Windows Server 2016 ansible manager\uff1a centos 7.7 X64 ansible version\uff1a 2.9.6.0 python version\uff1a Python 2.7.5","title":"\u672c\u6b21\u5b9e\u9a8c\u73af\u5883"},{"location":"basic/Windows/manager-windows/#windows-server-2016","text":"\u4ee5\u7ba1\u7406\u5458\u8eab\u4efd\u6253\u5f00powershell \u67e5\u770b\u5f53\u524dps\u7248\u672c PS C : \\ Users \\ Administrator > $PSVersionTable Name Value ---- ----- PSVersion 5 . 1 . 14393 . 1884 PSEdition Desktop PSCompatibleVersions { 1 . 0 , 2 . 0 , 3 . 0 , 4 . 0 ...} BuildVersion 10 . 0 . 14393 . 1884 CLRVersion 4 . 0 . 30319 . 42000 WSManStackVersion 3 . 0 PSRemotingProtocolVersion 2 . 3 SerializationVersion 1 . 1 . 0 . 1 Tips Ansible \u9700\u8981\u5728 powershell 3.0, .net Framework 4.0\u6216\u66f4\u65b0\u7684\u7248\u672c\u4e0a\u8fd0\u884c\uff0c\u53ef\u4ee5\u7528\u4e0b\u5217\u547d\u4ee4\u5347\u7ea7powershell $url = \"https://raw.githubusercontent.com/jborean93/ansible-windows/master/scripts/Upgrade-PowerShell.ps1\" $file = \"$env:temp\\Upgrade-PowerShell.ps1\" $username = \"Administrator\" $password = \"Password\" ( New-Object -TypeName System . Net . WebClient ). DownloadFile ( $url , $file ) Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Force # Version can be 3.0, 4.0 or 5.1 & $file -Version 5 . 1 -Username $username -Password $password -Verbose \u5b8c\u6210\u540e\uff0c\u60a8\u9700\u8981\u5c06\u5220\u9664\u81ea\u52a8\u767b\u5f55\u5e76\u5c06\u6267\u884c\u7b56\u7565\u8bbe\u7f6e\u56de\u9ed8\u8ba4\u503cRestricted\u3002 # This isn't needed but is a good security practice to complete Set-ExecutionPolicy -ExecutionPolicy Restricted -Force $reg_winlogon_path = \"HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" Set-ItemProperty -Path $reg_winlogon_path -Name AutoAdminLogon -Value 0 Remove-ItemProperty -Path $reg_winlogon_path -Name DefaultUserName -ErrorAction SilentlyContinue Remove-ItemProperty -Path $reg_winlogon_path -Name DefaultPassword -ErrorAction SilentlyContinue \u5728PowerShell v3.0\u4e0a\u8fd0\u884c\u65f6\uff0cWinRM\u670d\u52a1\u6709\u4e00\u4e2a\u7f3a\u9677\uff0c\u9650\u5236\u4e86WinRM\u53ef\u7528\u7684\u5185\u5b58\u91cf\u3002\u53ef\u4ee5\u4f7f\u7528\u4e0b\u5217\u547d\u4ee4\u4fee\u8865\u3002 $url = \"https://raw.githubusercontent.com/jborean93/ansible-windows/master/scripts/Install-WMF3Hotfix.ps1\" $file = \"$env:temp\\Install-WMF3Hotfix.ps1\" ( New-Object -TypeName System . Net . WebClient ). DownloadFile ( $url , $file ) powershell . exe -ExecutionPolicy ByPass -File $file -Verbose \u914d\u7f6ewinrm \u4f7f\u7528\u811a\u672c\u542f\u7528HTTP\u548cHTTPS\u7684\u4fa6\u542c\u5668 $url = \"https://raw.githubusercontent.com/ansible/ansible/devel/examples/scripts/ConfigureRemotingForAnsible.ps1\" $file = \"$env:temp\\ConfigureRemotingForAnsible.ps1\" ( New-Object -TypeName System . Net . WebClient ). DownloadFile ( $url , $file ) powershell . exe -ExecutionPolicy ByPass -File $file \u83b7\u53d6winrm\u4fe1\u606f PS C : \\ Users \\ Administrator \\ Desktop > winrm get winrm / config / Service Service RootSDDL = O : NSG : BAD : P ( A ;; GA ;;; BA )( A ;; GR ;;; IU ) S : P ( AU ; FA ; GA ;;; WD )( AU ; SA ; GXGW ;;; WD ) MaxConcurrentOperations = 4294967295 MaxConcurrentOperationsPerUser = 1500 EnumerationTimeoutms = 240000 MaxConnections = 300 MaxPacketRetrievalTimeSeconds = 120 AllowUnencrypted = false Auth Basic = true Kerberos = true Negotiate = true Certificate = false CredSSP = false CbtHardeningLevel = Relaxed DefaultPorts HTTP = 5985 HTTPS = 5986 IPv4Filter = * IPv6Filter = * EnableCompatibilityHttpListener = false EnableCompatibilityHttpsListener = false CertificateThumbprint AllowRemoteAccess = true PS C : \\ Users \\ Administrator \\ Desktop > winrm get winrm / config / Winrs Winrs AllowRemoteShellAccess = true IdleTimeout = 7200000 MaxConcurrentUsers = 2147483647 MaxShellRunTime = 2147483647 MaxProcessesPerShell = 2147483647 MaxMemoryPerShellMB = 2147483647 MaxShellsPerUser = 2147483647 \u6d4b\u8bd5winrm\u8fde\u63a5 $username = \"Administrator\" $password = \"Admin123\" # Test out HTTP winrs -r : http : // 127 . 0 . 0 . 1 : 5985 / wsman -u : $username -p : $password ipconfig # Test out HTTPS (will fail if the cert is not verifiable) winrs -r : https : // 127 . 0 . 0 . 1 : 5986 / wsman -u : $username -p : $password -ssl ipconfig # Test out HTTPS, ignoring certificate verification $username = \"Administrator\" $password = ConvertTo-SecureString -String \"Admin123\" -AsPlainText -Force $cred = New-Object -TypeName System . Management . Automation . PSCredential -ArgumentList $username , $password $session_option = New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck Invoke-Command -ComputerName 127 . 0 . 0 . 1 -UseSSL -ScriptBlock { ipconfig } -Credential $cred -SessionOption $session_option","title":"Windows Server 2016 \u8282\u70b9\u914d\u7f6e"},{"location":"basic/Windows/manager-windows/#ansible-manager","text":"\u5b89\u88c5ansible\u548cpywinrm yum -y install ansible curl -sL https://bootstrap.pypa.io/get-pip.py | python pip install pywinrm \u914d\u7f6ehosts [ root@master ~ ] # cd /etc/ansible/ [ root@master ansible ] # cat win_hosts [ windows ] 192 .168.77.135 [ windows:vars ] ansible_user = Administrator ansible_password = Admin123 ansible_port = 5986 ansible_connection = winrm ansible_winrm_server_cert_validation = ignore \u6d4b\u8bd5\u901a\u4fe1 bash # ansible -i win_hosts windows -m win_ping 192.168.77.135 | SUCCESS => { \"changed\": false, \"ping\": \"pong\" } \u67e5\u770b\u7cfb\u7edf\u4fe1\u606f # ansible -i win_hosts windows -m win_command -a \"whoami\" 192 .168.77.135 | CHANGED | rc = 0 >> win-v5sbnpsnfom \\a dministrator # ansible -i win_hosts windows -m win_command -a \"systeminfo\" 192 .168.77.135 | CHANGED | rc = 0 >> Host Name: WIN-V5SBNPSNFOM OS Name: Microsoft Windows Server 2016 Datacenter OS Version: 10 .0.14393 N/A Build 14393 OS Manufacturer: Microsoft Corporation OS Configuration: Standalone Server OS Build Type: Multiprocessor Free Registered Owner: Windows \u7528\u6237 Registered Organization: Product ID: 00376 -40000-00000-AA947 Original Install Date: 2019 /7/24, 14 :54:43 System Boot Time: 2020 /4/8, 18 :03:12 System Manufacturer: VMware, Inc. System Model: VMware7,1 System Type: x64-based PC Processor ( s ) : 2 Processor ( s ) Installed. [ 01 ] : Intel64 Family 6 Model 60 Stepping 3 GenuineIntel ~3592 Mhz [ 02 ] : Intel64 Family 6 Model 60 Stepping 3 GenuineIntel ~3592 Mhz BIOS Version: VMware, Inc. VMW71.00V.14410784.B64.1908150010, 2019 /8/15 Windows Directory: C: \\W indows System Directory: C: \\W indows \\s ystem32 Boot Device: \\D evice \\H arddiskVolume2 System Locale: zh-cn ; Chinese ( China ) Input Locale: zh-cn ; Chinese ( China ) Time Zone: ( UTC+08:00 ) Beijing, Chongqing, Hong Kong, Urumqi Total Physical Memory: 2 ,047 MB Available Physical Memory: 847 MB Virtual Memory: Max Size: 3 ,199 MB Virtual Memory: Available: 2 ,019 MB Virtual Memory: In Use: 1 ,180 MB Page File Location ( s ) : C: \\p agefile.sys Domain: WORKGROUP Logon Server: \\\\ WIN-V5SBNPSNFOM Hotfix ( s ) : 2 Hotfix ( s ) Installed. [ 01 ] : KB4049065 [ 02 ] : KB4048953 Network Card ( s ) : 1 NIC ( s ) Installed. [ 01 ] : Intel ( R ) 82574L Gigabit Network Connection Connection Name: Ethernet0 DHCP Enabled: Yes DHCP Server: 192 .168.77.254 IP address ( es ) [ 01 ] : 192 .168.77.135 [ 02 ] : fe80::cd89:483d:58ae:d350 Hyper-V Requirements: A hypervisor has been detected. Features required for Hyper-V will not be displayed. # ansible -i win_hosts windows -m win_shell -a \"\\$PSVersionTable\" 192 .168.77.135 | CHANGED | rc = 0 >> Name Value ---- ----- PSVersion 5 .1.14393.1884 PSEdition Desktop PSCompatibleVersions { 1 .0, 2 .0, 3 .0, 4 .0... } BuildVersion 10 .0.14393.1884 CLRVersion 4 .0.30319.42000 WSManStackVersion 3 .0 PSRemotingProtocolVersion 2 .3 SerializationVersion 1 .1.0.1 \u67e5\u770bip\u5730\u5740 # ansible -i win_hosts windows -m win_command -a \"ipconfig\" 192 .168.77.135 | CHANGED | rc = 0 >> Windows IP Configuration Ethernet adapter Ethernet0: Connection-specific DNS Suffix . : localdomain Link-local IPv6 Address . . . . . : fe80::cd89:483d:58ae:d350%4 IPv4 Address. . . . . . . . . . . : 192 .168.77.135 Subnet Mask . . . . . . . . . . . : 255 .255.255.0 Default Gateway . . . . . . . . . : 192 .168.77.2 Tunnel adapter isatap.localdomain: Media State . . . . . . . . . . . : Media disconnected Connection-specific DNS Suffix . : localdomain Tunnel adapter Teredo Tunneling Pseudo-Interface: Connection-specific DNS Suffix . : IPv6 Address. . . . . . . . . . . : 2001 :0:348b:fb58:1014:186b:3f57:b278 Link-local IPv6 Address . . . . . : fe80::1014:186b:3f57:b278%2 Default Gateway . . . . . . . . . : :: # ansible -i win_hosts windows -m raw -a \"ipconfig\" 192 .168.77.135 | CHANGED | rc = 0 >> Windows IP Configuration Ethernet adapter Ethernet0: Connection-specific DNS Suffix . : localdomain Link-local IPv6 Address . . . . . : fe80::cd89:483d:58ae:d350%4 IPv4 Address. . . . . . . . . . . : 192 .168.77.135 Subnet Mask . . . . . . . . . . . : 255 .255.255.0 Default Gateway . . . . . . . . . : 192 .168.77.2 Tunnel adapter isatap.localdomain: Media State . . . . . . . . . . . : Media disconnected Connection-specific DNS Suffix . : localdomain Tunnel adapter Teredo Tunneling Pseudo-Interface: Connection-specific DNS Suffix . : IPv6 Address. . . . . . . . . . . : 2001 :0:348b:fb58:1014:186b:3f57:b278 Link-local IPv6 Address . . . . . : fe80::1014:186b:3f57:b278%2 Default Gateway . . . . . . . . . : ::","title":"ansible manager \u914d\u7f6e"},{"location":"certification/","text":"Ansible \u8ba4\u8bc1 \u00b6 \u901a\u8fc7\u7ea2\u5e3d Ansible \u81ea\u52a8\u5316\u4e13\u4e1a\u6280\u80fd\u8bc1\u4e66\u8003\u8bd5\u7684 IT \u4e13\u4e1a\u4eba\u5458\uff0c\u8bc1\u660e\u5176\u5177\u5907\u5728\u4f01\u4e1a\u73af\u5883\u4e2d\uff0c\u719f\u7ec3\u8fd0\u7528 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\u7cfb\u7edf\u7ba1\u7406\u548c\u90e8\u7f72\u81ea\u52a8\u5316\u6240\u9700\u7684\u6280\u80fd\u3001\u77e5\u8bc6\u548c\u80fd\u529b\u3002 \u53ef\u4ee5\u52a0\u5165 https://join.slack.com/t/redhat-certs \u7ec4\u4e00\u8d77\u5b66\u4e60\u3002 \u7ea2\u5e3d\u8ba4\u8bc1 Ansible \u81ea\u52a8\u5316\u4e13\u5bb6 \u00b6 \u83b7\u5f97\u7ea2\u5e3d Ansible \u81ea\u52a8\u5316\u4e13\u4e1a\u6280\u80fd\u8bc1\u4e66\u7684 IT \u4e13\u4e1a\u4eba\u5458\u80fd\u591f\u6267\u884c\u4ee5\u4e0b\u4efb\u52a1\uff1a \u4f7f\u7528 Ansible \u6e05\u5355 (inventory) \u5b9a\u4e49\u4e3b\u673a\u7ec4 \u521b\u5efa Ansible playbook \u4f7f\u7528 playbook\uff0c\u5c06\u7cfb\u7edf\u914d\u7f6e\u4e3a\u6307\u5b9a\u7684\u72b6\u6001 \u521b\u5efa\u548c\u4f7f\u7528 Ansible \u6a21\u677f\u6765\u4e3a\u4e3b\u673a\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u914d\u7f6e\u6587\u4ef6 \u521b\u5efa Ansible \u89d2\u8272 \u5229\u7528 playbook \u4e2d\u7684 Ansible Vault \u4fdd\u62a4\u654f\u611f\u6570\u636e \u5b89\u88c5 Ansible Tower \u5e76\u7528\u5b83\u6765\u7ba1\u7406\u7cfb\u7edf \u8ba4\u8bc1 \u00b6 \u7ea2\u5e3d Ansible \u81ea\u52a8\u5316\u4e13\u4e1a\u6280\u80fd\u8bc1\u4e66\u8003\u8bd5 (EX407) \u5b98\u65b9\u57f9\u8bad\u8bfe\u7a0b \u00b6 \u5229\u7528 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\u8bfe\u7a0b (DO407) \u5229\u7528 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\u8bfe\u7a0b\u53ca\u8003\u8bd5 (DO408) DO407\u57fa\u4e8e\u7ea2\u5e3d\u4f01\u4e1a\u7ea7\u64cd\u4f5c\u7cfb\u7edf7\uff0c\u5229\u7528 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\u8bfe\u7a0b I (DO407) \u4e13\u4e3a\u60f3\u8981\u501f\u52a9 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\u3001\u914d\u7f6e\u548c\u7ba1\u7406\u7684\u7cfb\u7edf\u7ba1\u7406\u5458\u800c\u8bbe\u8ba1\u3002\u4e86\u89e3\u5982\u4f55\u5b89\u88c5\u548c\u914d\u7f6e Ansible\u3001\u521b\u5efa\u548c\u8fd0\u884c playbook \u6765\u914d\u7f6e\u7cfb\u7edf\u4ee5\u53ca\u7ba1\u7406 inventory (\u914d\u7f6e\u6587\u4ef6)\uff0c\u5b9e\u73b0\u81ea\u52a8\u5316\u90e8\u7f72\u3001\u6279\u91cf\u90e8\u7f72\u3001\u6279\u91cf\u914d\u7f6e\u4fee\u6539\u53ca\u6570\u636e\u4e2d\u5fc3\u76d1\u63a7\uff0c\u9488\u5bf9\u5f00\u6e90\u63d0\u4f9b\u7684playbook\u5b9e\u73b0\u90e8\u7f72\u548c\u5e94\u7528\uff0c\u540c\u65f6\u5bf9\u4f01\u4e1a\u4e2a\u6027\u5316\u670d\u52a1\u3001\u4e2a\u6027\u5316\u4fee\u6539\u63d0\u4f9b\u4e8c\u6b21\u5f00\u53d1\u548c\u7f16\u5199\u7684\u80fd\u529b\u3002 \u8003\u8bd5\u4ecb\u7ecd \u00b6 \u8003\u8bd5\u6982\u8ff0 \u00b6 \u7ea2\u5e3d\u8ba4\u8bc1 Ansible \u81ea\u52a8\u5316\u4e13\u5bb6\u8003\u8bd5\uff08EX407\uff09\u65e8\u5728\u6d4b\u8bd5\u60a8\u8fd0\u7528 Ansible \u5b9e\u73b0\u7cfb\u7edf\u548c\u5e94\u7528\u914d\u7f6e\u81ea\u52a8\u5316\u7684\u80fd\u529b\u3002 \u901a\u8fc7\u6b64\u9879\u8003\u8bd5\u540e\uff0c\u60a8\u5c06\u6210\u4e3a \u7ea2\u5e3d\u8ba4\u8bc1 Ansible \u81ea\u52a8\u5316\u4e13\u5bb6 \uff0c\u5e76\u5c06\u8ba1\u5165\u7ea2\u5e3d\u8ba4\u8bc1\u67b6\u6784\u5e08\uff08RHCA\uff09\u7684\u8ba4\u8bc1\u6210\u7ee9\u4e2d\u3002 \u672c\u8bfe\u7a0b\u57fa\u4e8e\u7ea2\u5e3d\u00ae \u4f01\u4e1a Linux\u00ae 7.5 \u548c Ansible 2.7\u3002 \u73b0\u5728\uff0c\u6b64\u9879\u8003\u8bd5\u6db5\u76d6\u7684\u6750\u6599\u5305\u542b\u5728 \u7ea2\u5e3d\u8ba4\u8bc1\u5de5\u7a0b\u5e08 (RHCE) \u8003\u8bd5 (EX294) \u7684\u8bfe\u7a0b\u4e2d\u3002\u6b64\u9879\u65b0\u8003\u8bd5\u65e8\u5728\u6d4b\u8bd5\u60a8\u80fd\u5426\u4f7f\u7528\u7ea2\u5e3d Ansible \u81ea\u52a8\u5316\u4f7f\u4e0d\u540c\u529f\u80fd\u5b9e\u73b0\u81ea\u52a8\u5316\u5e76\u6709\u6548\u6269\u5c55\u57fa\u7840\u67b6\u6784\u3002 \u8003\u6838\u5bf9\u8c61 \u00b6 \u9700\u8981\u7ba1\u7406\u5927\u91cf\u7cfb\u7edf\u7684\u7cfb\u7edf\u7ba1\u7406\u5458 \u5728 DevOps \u73af\u5883\u4e2d\u5de5\u4f5c\u3001\u5e76\u60f3\u5b9e\u73b0\u5927\u90e8\u5206\u65e5\u5e38\u4f5c\u4e1a\u91cf\u81ea\u52a8\u5316\u7684\u7cfb\u7edf\u7ba1\u7406\u5458 \u5177\u6709\u57fa\u672c\u7cfb\u7edf\u7ba1\u7406\u80cc\u666f\u3001\u5e76\u60f3\u5b9e\u73b0\u5f00\u53d1\u6d41\u7a0b\u81ea\u52a8\u5316\u7684\u5f00\u53d1\u4eba\u5458 \u6709\u5174\u8da3\u6210\u4e3a\u7ea2\u5e3d\u8ba4\u8bc1\u4e13\u5bb6\u6216 \u7ea2\u5e3d\u8ba4\u8bc1\u67b6\u6784\u5e08\uff08RHCA\uff09 \u7684 \u7ea2\u5e3d\u8ba4\u8bc1\u5de5\u7a0b\u5e08\uff08RHCE\uff09 \u8003\u8bd5\u524d\u63d0\u6761\u4ef6 \u00b6 \u6210\u529f\u5b8c\u6210 \u5229\u7528 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\uff08DO407\uff09 \u8bfe\u7a0b\uff0c\u6216\u5177\u6709\u4f7f\u7528 Ansible \u914d\u7f6e\u7cfb\u7edf\u7684\u540c\u7b49\u7ecf\u9a8c \u5efa\u8bae\u5148\u6210\u4e3a \u7ea2\u5e3d\u8ba4\u8bc1\u7cfb\u7edf\u7ba1\u7406\u5458\uff08RHCSA\uff09 \u6216\u5177\u6709\u540c\u7b49\u6216\u66f4\u9ad8\u7684\u7cfb\u7edf\u7ba1\u7406\u7ecf\u9a8c\uff0c\u4f46\u4e0d\u5f3a\u5236\u8981\u6c42 \u8003\u67e5\u8981\u70b9 \u00b6 \u6211\u4eec\u5efa\u8bae\u8003\u751f\u5728\u53c2\u52a0\u6b64\u9879\u8003\u8bd5\u524d\u5148\u6210\u4e3a \u7ea2\u5e3d\u8ba4\u8bc1\u5de5\u7a0b\u5e08\uff08RHCE\u00ae\uff09 \u6216\u81f3\u5c11\u6210\u4e3a \u7ea2\u5e3d\u8ba4\u8bc1\u7cfb\u7edf\u7ba1\u7406\u5458\uff08RHCSA\u00ae\uff09 \uff0c\u4f46\u4e24\u8005\u5e76\u4e0d\u5f3a\u5236\u8981\u6c42\u3002 \u4e3a\u4e86\u5e2e\u52a9\u60a8\u5907\u8003\uff0c\u8bf7\u67e5\u770b\u672c\u6587\u7ed9\u51fa\u7684\u8003\u8bd5\u76ee\u6807\uff0c\u5176\u4e2d\u5217\u51fa\u4e86\u64cd\u4f5c\u4efb\u52a1\u7684\u8003\u67e5\u8303\u56f4\u3002\u7ea2\u5e3d\u4fdd\u7559\u6dfb\u52a0\u3001\u66f4\u6539\u548c\u5220\u9664\u8003\u8bd5\u76ee\u6807\u7684\u6743\u5229\u3002\u6b64\u7c7b\u53d8\u66f4\u5c06\u5728\u8003\u524d\u516c\u5e03\u3002 \u60a8\u5e94\u80fd\u591f\uff1a \u4e86\u89e3 Ansible \u7684\u6838\u5fc3\u7ec4\u4ef6 Inventory\uff08\u914d\u7f6e\u6587\u4ef6\uff09 \u6a21\u5757 \u53d8\u91cf Fact Play Playbook \u914d\u7f6e\u6587\u4ef6 \u5b89\u88c5\u548c\u914d\u7f6e Ansible \u63a7\u5236\u8282\u70b9 \u5b89\u88c5\u6240\u9700\u8f6f\u4ef6\u5305 \u521b\u5efa\u9759\u6001\u4e3b\u673a inventory \u6587\u4ef6 \u521b\u5efa\u914d\u7f6e\u6587\u4ef6 \u914d\u7f6e Ansible \u6258\u7ba1\u7684\u8282\u70b9 \u521b\u5efa SSH \u5bc6\u94a5\u5e76\u5c06\u5176\u5206\u914d\u7ed9\u6258\u7ba1\u8282\u70b9 \u5728\u6258\u7ba1\u8282\u70b9\u4e0a\u914d\u7f6e\u6743\u9650\u63d0\u5347 \u4f7f\u7528 ad-hoc Ansible \u547d\u4ee4\u9a8c\u8bc1\u6709\u6548\u914d\u7f6e \u521b\u5efa\u8fd0\u884c ad hoc Ansible \u547d\u4ee4\u7684\u7b80\u5355 shell \u811a\u672c \u4f7f\u7528\u9759\u6001\u548c\u52a8\u6001 inventory \u5b9a\u4e49\u4e3b\u673a\u7fa4\u7ec4 \u4f7f\u7528\u73b0\u6709\u7684\u52a8\u6001 inventory \u811a\u672c \u521b\u5efa Ansible play \u548c playbook \u4e86\u89e3\u5982\u4f55\u4f7f\u7528\u5e38\u7528\u7684 Ansible \u6a21\u5757 \u4f7f\u7528\u53d8\u91cf\u68c0\u7d22\u547d\u4ee4\u8fd0\u884c\u7684\u7ed3\u679c \u4f7f\u7528\u6761\u4ef6\u63a7\u5236 play \u7684\u6267\u884c \u914d\u7f6e\u9519\u8bef\u5904\u7406 \u521b\u5efa playbook\uff0c\u5c06\u7cfb\u7edf\u914d\u7f6e\u4e3a\u6307\u5b9a\u7684\u72b6\u6001 \u4f7f\u7528 Ansible \u6a21\u5757\u6267\u884c\u6709\u5173\u4ee5\u4e0b\u5185\u5bb9\u7684\u7cfb\u7edf\u7ba1\u7406\u4efb\u52a1\uff1a \u8f6f\u4ef6\u5305\u548c\u5b58\u50a8\u5e93 \u670d\u52a1 \u9632\u706b\u5899\u89c4\u5219 \u6587\u4ef6\u7cfb\u7edf \u5b58\u50a8\u8bbe\u5907 \u6587\u4ef6\u5185\u5bb9 \u5f52\u6863 \u8ba1\u5212\u4efb\u52a1 \u5b89\u5168\u6027 \u7528\u6237\u548c\u7fa4\u7ec4 \u521b\u5efa\u548c\u4f7f\u7528\u6a21\u677f\u6765\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u914d\u7f6e\u6587\u4ef6 \u4f7f\u7528 Ansible \u53d8\u91cf\u548c fact \u521b\u5efa\u548c\u4f7f\u7528\u89d2\u8272 \u4ece Ansible Galaxy \u4e0b\u8f7d\u89d2\u8272\u5e76\u4f7f\u7528 \u5e76\u884c\u7ba1\u7406 \u5229\u7528 playbook \u4e2d\u7684 Ansible Vault \u4fdd\u62a4\u654f\u611f\u6570\u636e \u4f7f\u7528\u63d0\u4f9b\u7684\u6587\u6863\u67e5\u627e\u6709\u5173 Ansible \u6a21\u5757\u548c\u547d\u4ee4\u7684\u7279\u5b9a\u4fe1\u606f \u5907\u8003 \u00b6 \u7ea2\u5e3d\u5efa\u8bae\u60a8\u5b66\u4e60 \u5229\u7528 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\u4e00\uff08DO407\uff09 \u8bfe\u7a0b\uff0c\u4ee5\u5e2e\u52a9\u5907\u8003\u3002\u6b64\u8bfe\u7a0b\u5e76\u975e\u5f3a\u5236\u6027\u8981\u6c42\uff0c\u8003\u751f\u53ef\u4ee5\u9009\u62e9\u53ea\u53c2\u52a0\u8003\u8bd5\u3002 \u5c3d\u7ba1\u53c2\u52a0\u7ea2\u5e3d\u57f9\u8bad\u8bfe\u7a0b\u662f\u60a8\u5907\u8003\u7684\u4e00\u4e2a\u91cd\u8981\u90e8\u5206\uff0c\u4f46\u53ea\u53c2\u52a0\u8bfe\u7a0b\u5e76\u4e0d\u80fd\u786e\u4fdd\u987a\u5229\u901a\u8fc7\u8003\u8bd5\u3002\u60a8\u7684\u4ee5\u5f80\u7ecf\u9a8c\u3001\u5b9e\u8df5\u4ee5\u53ca\u81ea\u8eab\u8d44\u8d28\u4e5f\u662f\u51b3\u5b9a\u80fd\u5426\u901a\u8fc7\u8003\u8bd5\u7684\u91cd\u8981\u56e0\u7d20\u3002 \u6211\u4eec\u62e5\u6709\u4f17\u591a\u6709\u5173\u7ea2\u5e3d\u4ea7\u54c1\u7cfb\u7edf\u7ba1\u7406\u7684\u4e66\u7c4d\u548c\u5b66\u4e60\u8d44\u6e90\u4f9b\u60a8\u9009\u62e9\u3002\u7ea2\u5e3d\u672a\u6307\u5b9a\u4efb\u4f55\u5185\u5bb9\u4f5c\u4e3a\u5907\u8003\u6307\u5357\u3002\u7136\u800c\uff0c\u60a8\u53ef\u80fd\u53d1\u73b0\u989d\u5916\u7684\u9605\u8bfb\u4f1a\u5bf9\u52a0\u6df1\u7406\u89e3\u6709\u5e2e\u52a9\u3002 \u8003\u8bd5\u5f62\u5f0f \u00b6 \u8fd9\u662f\u4e00\u9879\u57fa\u4e8e\u5b9e\u9645\u64cd\u4f5c\u80fd\u529b\u7684\u8003\u8bd5\uff0c\u65e8\u5728\u8bc4\u4f30\u60a8\u8fd0\u7528 Ansible \u5b9e\u73b0\u7cfb\u7edf\u914d\u7f6e\u548c\u5e94\u7528\u90e8\u7f72\u81ea\u52a8\u5316\u7684\u80fd\u529b\u3002\u8003\u8bd5\u57fa\u4e8e\u5b9e\u9645\u64cd\u4f5c\uff0c\u8981\u6c42\u60a8\u6267\u884c\u7c7b\u4f3c\u65e5\u5e38\u5de5\u4f5c\u804c\u8d23\u7684\u4efb\u52a1\u64cd\u4f5c\u3002 \u60a8\u9700\u8981\u5f00\u53d1 Ansible playbook \u6765\u4e3a\u7279\u5b9a\u7684\u89d2\u8272\u914d\u7f6e\u7cfb\u7edf\uff0c\u7136\u540e\u5c06 playbook \u5e94\u7528\u81f3\u7cfb\u7edf\u6765\u5b9e\u65bd\u8fd9\u4e9b\u89d2\u8272\u3002\u6b64\u5916\uff0c\u60a8\u8fd8\u9700\u8981\u5c55\u793a\u81ea\u5df1\u9488\u5bf9\u7279\u5b9a\u884c\u4e3a\u8fd0\u884c Ansible playbook \u548c\u914d\u7f6e Ansible \u73af\u5883\u7684\u80fd\u529b\u3002\u60a8\u5c06\u63a5\u53d7\u76f8\u5e94\u4efb\u52a1\u8bc4\u4f30\uff0c\u4ee5\u786e\u5b9a\u662f\u5426\u8fbe\u5230\u89c4\u5b9a\u7684\u8bc4\u6d4b\u6807\u51c6\u3002 \u8003\u8bd5\u65f6\u95f4\u4e3a4\u5c0f\u65f6\u3002\u603b\u5206300\u5206\uff0c \u6210\u7ee9\u53ca\u516c\u5e03 \u00b6 \u8003\u8bd5\u7684\u5b98\u65b9\u6210\u7ee9\u7531 \u7ea2\u5e3d\u8ba4\u8bc1\u4e2d\u5fc3 \u72ec\u5bb6\u516c\u5e03\u3002\u7ea2\u5e3d\u672a\u6388\u6743\u8003\u5b98\u6216\u57f9\u8bad\u5408\u4f5c\u4f19\u4f34\u76f4\u63a5\u5411\u8003\u751f\u516c\u5e03\u8003\u8bd5\u7ed3\u679c\u3002\u8003\u8bd5\u6210\u7ee9\u901a\u5e38\u4f1a\u5728 3 \u4e2a\u7f8e\u56fd\u5de5\u4f5c\u65e5\u5185\u516c\u5e03\u3002 \u516c\u5e03\u7684\u8003\u8bd5\u7ed3\u679c\u4e3a\u603b\u5206\u3002\u7ea2\u5e3d\u4e0d\u516c\u5e03\u5355\u4e2a\u9879\u76ee\u7684\u6210\u7ee9\uff0c\u4e5f\u4e0d\u4f1a\u5e94\u8003\u751f\u8981\u6c42\u63d0\u4f9b\u989d\u5916\u4fe1\u606f\u3002 \u7ea2\u5e3d\u8ba4\u8bc1\u9ad8\u7ea7\u81ea\u52a8\u5316\u4e13\u5bb6\uff1aAnsible \u6700\u4f73\u5b9e\u8df5 \u00b6 \u7ea2\u5e3d\u8ba4\u8bc1\u9ad8\u7ea7\u81ea\u52a8\u5316\u4e13\u5bb6\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\u80fd\u591f\u6267\u884c\u4ee5\u4e0b\u4efb\u52a1\uff1a \u7406\u89e3\u5e76\u4f7f\u7528 Git \u6765\u7ba1\u7406 playbook \u96c6\u5408 \u7ba1\u7406 Ansible \u4efb\u52a1\u6267\u884c \u5b89\u88c5\u548c\u7ba1\u7406 Ansible Tower \u7684\u8bbf\u95ee\u6743\u9650 \u7ba1\u7406\u5e93\u5b58\u6e05\u5355\u3001\u51ed\u8bc1\u3001\u9ad8\u7ea7\u5e93\u5b58\u6e05\u5355\u3001\u9879\u76ee\u548c\u5de5\u4f5c\u6d41 \u4f7f\u7528 Ansible Tower API \u542f\u52a8\u4f5c\u4e1a \u8ba4\u8bc1 \u00b6 \u7ea2\u5e3d\u8ba4\u8bc1\u9ad8\u7ea7\u81ea\u52a8\u5316\u4e13\u5bb6\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\uff08EX447\uff09 \u5b98\u65b9\u57f9\u8bad\u8bfe\u7a0b \u00b6 \u9ad8\u7ea7\u81ea\u52a8\u5316\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\uff08DO447\uff09 \u8003\u8bd5\u4ecb\u7ecd \u00b6 \u8003\u8bd5\u6982\u8ff0 \u00b6 \u7ea2\u5e3d\u8ba4\u8bc1\u9ad8\u7ea7\u81ea\u52a8\u5316\u4e13\u5bb6\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\u8003\u8bd5\uff08EX447\uff09\u65e8\u5728\u901a\u8fc7\u5b9e\u9645\u4efb\u52a1\u64cd\u4f5c\uff0c\u8003\u6838\u60a8\u4f7f\u7528\u7ea2\u5e3d\u00ae Ansible\u00ae \u5f15\u64ce\u548c\u7ea2\u5e3d Ansible Tower \u6765\u7ba1\u7406\u591a\u4e2a\u7cfb\u7edf\u7684\u77e5\u8bc6\u548c\u6280\u80fd\u3002 \u901a\u8fc7\u6b64\u9879\u8003\u8bd5\u540e\uff0c\u60a8\u5c06\u6210\u4e3a \u7ea2\u5e3d\u8ba4\u8bc1\u9ad8\u7ea7\u81ea\u52a8\u5316\u4e13\u5bb6\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\u8003\u8bd5 \uff0c\u5e76\u5c06\u8ba1\u5165 \u7ea2\u5e3d\u8ba4\u8bc1\u67b6\u6784\u5e08\uff08RHCA\u00ae\uff09 \u7684\u8ba4\u8bc1\u6210\u7ee9\u4e2d\u3002 \u672c\u8003\u8bd5\u57fa\u4e8e\u7ea2\u5e3d\u4f01\u4e1a Linux 8.0\u3001\u7ea2\u5e3d Ansible 2.8 \u548c\u7ea2\u5e3d Ansible Tower 3.5\u3002 \u8003\u6838\u5bf9\u8c61 \u00b6 \u7ea2\u5e3d\u8ba4\u8bc1\u9ad8\u7ea7\u81ea\u52a8\u5316\u4e13\u5bb6\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\u8003\u8bd5\u9002\u5408\uff1a\u60f3\u8981\u68c0\u9a8c\u6709\u5173 Ansible \u6700\u4f73\u5b9e\u8df5\u7684\u5e7f\u535a\u77e5\u8bc6\u548c\u6df1\u5165\u7406\u89e3\u3001\u5e0c\u671b\u5728\u66f4\u5927\u548c\u66f4\u590d\u6742\u7684\u9879\u76ee\u4e2d\u5e94\u7528 Ansible\uff0c\u4ee5\u53ca\u4f7f\u7528 Ansible Tower \u7684\u4eba\u58eb\uff0c\u5305\u62ec\uff1a \u5177\u5907\u4e30\u5bcc\u7ecf\u9a8c\u7684 Linux \u7cfb\u7edf\u7ba1\u7406\u5458 DevOps \u5de5\u7a0b\u5e08 \u4e91\u7ba1\u7406\u5458 \u5176\u4ed6 IT \u4e13\u4e1a\u4eba\u5458 \u8003\u8bd5\u524d\u63d0\u6761\u4ef6 \u00b6 \u53c2\u52a0\u8fc7 \u9ad8\u7ea7\u81ea\u52a8\u5316\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\uff08DO447\uff09 \u8bfe\u7a0b\uff0c\u6216\u62e5\u6709\u7ea2\u5e3d\u4f01\u4e1a Linux\u00ae\u3001Ansible \u548c Ansible Tower \u65b9\u9762\u7684\u540c\u7b49\u5de5\u4f5c\u7ecf\u9a8c \u53c2\u52a0\u8fc7 \u7ea2\u5e3d\u7cfb\u7edf\u7ba1\u7406\u4e09\uff1aLinux \u81ea\u52a8\u5316\uff08RH294\uff09 \u8bfe\u7a0b\uff0c\u6216\u62e5\u6709\u7ea2\u5e3d\u4f01\u4e1a Linux \u548c Ansible \u65b9\u9762\u7684\u540c\u7b49\u5de5\u4f5c\u7ecf\u9a8c \u7b26\u5408\u8003\u8bd5\u76ee\u6807 \u8003\u67e5\u8981\u70b9 \u00b6 \u60a8\u5e94\u80fd\u72ec\u7acb\u5b8c\u6210\u4e0b\u5217\u5206\u7ec4\u4efb\u52a1\uff1a \u7406\u89e3\u548c\u8fd0\u7528 Git \u514b\u9686 Git \u5b58\u50a8\u5e93 \u5728 Git \u5b58\u50a8\u5e93\u4e2d\u66f4\u65b0\u3001\u4fee\u6539\u548c\u521b\u5efa\u6587\u4ef6 \u5c06\u8fd9\u4e9b\u4fee\u6539\u8fc7\u7684\u6587\u4ef6\u6dfb\u52a0\u56de Git \u5b58\u50a8\u5e93 \u7ba1\u7406\u5e93\u5b58\u6e05\u5355\u53d8\u91cf \u5229\u7528\u6bcf\u4e2a\u4e3b\u673a\u6216\u7ec4\u7684\u591a\u4e2a\u6587\u4ef6\uff0c\u6784\u5efa\u4e3b\u673a\u548c\u7ec4\u53d8\u91cf \u4f7f\u7528\u7279\u6b8a\u53d8\u91cf\u6765\u8986\u76d6\u4e3b\u673a\u3001\u7aef\u53e3\u6216 Ansible \u9488\u5bf9\u7279\u5b9a\u4e3b\u673a\u800c\u4f7f\u7528\u7684\u8fdc\u7a0b\u7528\u6237 \u4e3a\u67d0\u4e9b\u6258\u7ba1\u4e3b\u673a\u8bbe\u7f6e\u5305\u542b\u591a\u4e2a\u4e3b\u673a\u53d8\u91cf\u6587\u4ef6\u7684\u76ee\u5f55 \u4ee5\u4e0d\u540c\u7684\u540d\u79f0\u6216 IP \u5730\u5740\u6765\u8986\u76d6\u5e93\u5b58\u6e05\u5355\u6587\u4ef6\u4e2d\u6240\u7528\u7684\u540d\u79f0 \u7ba1\u7406\u4efb\u52a1\u7684\u6267\u884c \u63a7\u5236\u6743\u9650\u6267\u884c \u8fd0\u884c\u6240\u9009\u7684\u4efb\u52a1 \u501f\u52a9\u8fc7\u6ee4\u5668\u548c\u63d2\u4ef6\u8f6c\u6362\u6570\u636e \u4f7f\u7528\u67e5\u627e\u63d2\u4ef6\uff0c\u7528\u6765\u81ea\u5916\u90e8\u6e90\u7684\u6570\u636e\u586b\u5145\u53d8\u91cf \u4f7f\u7528\u67e5\u627e\u548c\u67e5\u8be2\u529f\u80fd\uff0c\u5c06\u6765\u81ea\u5916\u90e8\u6e90\u7684\u6a21\u677f\u6570\u636e\u5316\u4e3a playbook \u548c\u5df2\u90e8\u7f72\u7684\u6a21\u677f\u6587\u4ef6 \u4f7f\u7528\u67e5\u627e\u63d2\u4ef6\u548c\u8fc7\u6ee4\u5668\uff0c\u7528\u9664\u7b80\u5355\u5217\u8868\u4e4b\u5916\u7684\u7ed3\u6784\u5b9e\u73b0\u5faa\u73af \u4f7f\u7528\u8fc7\u6ee4\u5668\uff0c\u68c0\u67e5\u3001\u9a8c\u8bc1\u548c\u64cd\u4f5c\u5305\u542b\u7f51\u7edc\u4fe1\u606f\u7684\u53d8\u91cf \u59d4\u6d3e\u4efb\u52a1 \u5728\u53e6\u4e00\u53f0\u4e3b\u673a\u4e0a\u8fd0\u884c\u6258\u7ba1\u4e3b\u673a\u7684\u4efb\u52a1\uff0c\u7136\u540e\u63a7\u5236\u662f\u5426\u5c06\u8be5\u4efb\u52a1\u6536\u96c6\u7684 fact \u59d4\u6d3e\u7ed9\u6258\u7ba1\u4e3b\u673a\u6216\u5176\u4ed6\u4e3b\u673a \u5b89\u88c5 Ansible Tower \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u6267\u884c Ansible Tower \u7684\u57fa\u672c\u914d\u7f6e \u7ba1\u7406 Ansible Tower \u7684\u8bbf\u95ee\u6743\u9650 \u521b\u5efa Ansible Tower \u7528\u6237\u548c\u56e2\u961f\u5e76\u8ba9\u5176\u76f8\u4e92\u5173\u8054 \u7ba1\u7406\u5e93\u5b58\u6e05\u5355\u548c\u51ed\u636e \u7ba1\u7406\u9ad8\u7ea7\u5e93\u5b58\u6e05\u5355 \u4ece\u8eab\u4efd\u7ba1\u7406\u670d\u52a1\u5668\u6216\u6570\u636e\u5e93\u670d\u52a1\u5668\u521b\u5efa\u52a8\u6001\u5e93\u5b58\u6e05\u5355 \u521b\u5efa\u673a\u5668\u51ed\u636e\u4ee5\u8bbf\u95ee\u5e93\u5b58\u6e05\u5355\u4e3b\u673a \u521b\u5efa\u6e90\u4ee3\u7801\u63a7\u5236\u51ed\u636e \u7ba1\u7406\u9879\u76ee \u521b\u5efa\u4f5c\u4e1a\u6a21\u677f \u7ba1\u7406\u5de5\u4f5c\u6d41 \u521b\u5efa\u5de5\u4f5c\u6d41\u6a21\u677f \u4f7f\u7528 Ansible Tower API \u7f16\u5199 API \u811a\u672c\u5c0f\u7a0b\u5e8f\u4ee5\u542f\u52a8\u4f5c\u4e1a \u5907\u4efd Ansible Tower \u5907\u4efd Ansible Tower \u7684\u5b9e\u4f8b \u5bf9\u4e8e\u6240\u6709\u5b9e\u9645\u4efb\u52a1\u64cd\u4f5c\u578b\u7684\u7ea2\u5e3d\u8003\u8bd5\uff0c\u60a8\u7684\u6240\u6709\u7cfb\u7edf\u914d\u7f6e\u5fc5\u987b\u5728\u91cd\u542f\u540e\u4ecd\u7136\u6709\u6548\uff08\u65e0\u9700\u4eba\u5de5\u5e72\u9884\uff09\u3002 \u5907\u8003 \u00b6 \u4e3a\u4e86\u66f4\u597d\u5907\u8003\uff0c\u7ea2\u5e3d\u5efa\u8bae\u60a8\u5b66\u4e60 \u9ad8\u7ea7\u81ea\u52a8\u5316\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\uff08DO447\uff09 \u8bfe\u7a0b\u3002 \u6b64\u7c7b\u8bfe\u7a0b\u5e76\u975e\u5f3a\u5236\u6027\u8981\u6c42\uff0c\u8003\u751f\u53ef\u4ee5\u9009\u62e9\u53ea\u53c2\u52a0\u8003\u8bd5\u3002 \u5c3d\u7ba1\u53c2\u52a0\u7ea2\u5e3d\u57f9\u8bad\u8bfe\u7a0b\u662f\u60a8\u5907\u8003\u7684\u4e00\u4e2a\u91cd\u8981\u90e8\u5206\uff0c\u4f46\u53ea\u53c2\u52a0\u8bfe\u7a0b\u5e76\u4e0d\u80fd\u786e\u4fdd\u987a\u5229\u901a\u8fc7\u8003\u8bd5\u3002\u60a8\u7684\u4ee5\u5f80\u7ecf\u9a8c\u3001\u5b9e\u8df5\u4ee5\u53ca\u81ea\u8eab\u8d44\u8d28\u4e5f\u662f\u51b3\u5b9a\u80fd\u5426\u901a\u8fc7\u8003\u8bd5\u7684\u91cd\u8981\u56e0\u7d20\u3002 \u6211\u4eec\u62e5\u6709\u4f17\u591a\u6709\u5173\u7ea2\u5e3d\u4ea7\u54c1\u7cfb\u7edf\u7ba1\u7406\u7684\u4e66\u7c4d\u548c\u5b66\u4e60\u8d44\u6e90\u4f9b\u60a8\u9009\u62e9\u3002\u7ea2\u5e3d\u672a\u6307\u5b9a\u4efb\u4f55\u5185\u5bb9\u4f5c\u4e3a\u5907\u8003\u6307\u5357\u3002\u7136\u800c\uff0c\u6d89\u730e\u66f4\u591a\u4f1a\u6709\u52a9\u52a0\u6df1\u60a8\u5bf9\u6240\u5b66\u77e5\u8bc6\u7684\u7406\u89e3\u3002 \u8003\u8bd5\u5f62\u5f0f \u00b6 \u6b64\u9879\u8003\u8bd5\u5c5e\u4e8e \u4e0a\u673a\u5b9e\u8df5\u64cd\u4f5c\u8003\u8bd5 \uff0c\u8981\u6c42\u60a8\u5b8c\u6210\u771f\u5b9e\u7684\u4efb\u52a1\u3002\u6211\u4eec\u5c06\u5411\u60a8\u63d0\u4f9b\u4e00\u4e2a\u6216\u591a\u4e2a\u865a\u62df\u7cfb\u7edf\uff0c\u800c\u60a8\u9700\u8981\u6267\u884c\u4e0e\u771f\u5b9e\u4f5c\u4e1a\u76f8\u7c7b\u4f3c\u7684\u4efb\u52a1\u3002\u8003\u8bd5\u671f\u95f4\u4e0d\u63d0\u4f9b\u4e92\u8054\u7f51\u63a5\u5165\uff0c\u60a8\u4e5f\u4e0d\u5f97\u5c06\u4efb\u4f55\u7eb8\u8d28\u6216\u7535\u5b50\u6587\u6863\u5e26\u5165\u8003\u573a\u3002\u7981\u6b62\u643a\u5e26\u7684\u7269\u54c1\u5305\u62ec\uff1a\u7b14\u8bb0\u3001\u4e66\u7c4d\u6216\u4efb\u4f55\u5176\u4ed6\u6750\u6599\u3002\u5728\u53c2\u52a0\u5927\u591a\u6570\u8003\u8bd5\u65f6\uff0c\u60a8\u90fd\u53ef\u4ee5\u4f7f\u7528\u4ea7\u54c1\u968f\u9644\u7684\u6587\u6863\u3002 \u6210\u7ee9\u53ca\u516c\u5e03 \u00b6 \u8003\u8bd5\u7684\u5b98\u65b9\u6210\u7ee9\u7531 \u7ea2\u5e3d\u8ba4\u8bc1\u4e2d\u5fc3 \u72ec\u5bb6\u516c\u5e03\u3002\u7ea2\u5e3d\u672a\u6388\u6743\u8003\u5b98\u6216\u57f9\u8bad\u5408\u4f5c\u4f19\u4f34\u76f4\u63a5\u5411\u8003\u751f\u516c\u5e03\u8003\u8bd5\u7ed3\u679c\u3002\u8003\u8bd5\u6210\u7ee9\u901a\u5e38\u4f1a\u5728 3 \u4e2a\u7f8e\u56fd\u5de5\u4f5c\u65e5\u5185\u516c\u5e03\u3002 \u516c\u5e03\u7684\u8003\u8bd5\u7ed3\u679c\u4e3a\u603b\u5206\u3002\u7ea2\u5e3d\u4e0d\u516c\u5e03\u5355\u4e2a\u9879\u76ee\u7684\u6210\u7ee9\uff0c\u4e5f\u4e0d\u4f1a\u5e94\u8003\u751f\u8981\u6c42\u63d0\u4f9b\u989d\u5916\u4fe1\u606f\u3002","title":"Ansible \u8ba4\u8bc1\u8bf4\u660e"},{"location":"certification/#ansible","text":"\u901a\u8fc7\u7ea2\u5e3d Ansible \u81ea\u52a8\u5316\u4e13\u4e1a\u6280\u80fd\u8bc1\u4e66\u8003\u8bd5\u7684 IT \u4e13\u4e1a\u4eba\u5458\uff0c\u8bc1\u660e\u5176\u5177\u5907\u5728\u4f01\u4e1a\u73af\u5883\u4e2d\uff0c\u719f\u7ec3\u8fd0\u7528 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\u7cfb\u7edf\u7ba1\u7406\u548c\u90e8\u7f72\u81ea\u52a8\u5316\u6240\u9700\u7684\u6280\u80fd\u3001\u77e5\u8bc6\u548c\u80fd\u529b\u3002 \u53ef\u4ee5\u52a0\u5165 https://join.slack.com/t/redhat-certs \u7ec4\u4e00\u8d77\u5b66\u4e60\u3002","title":"Ansible \u8ba4\u8bc1"},{"location":"certification/#ansible_1","text":"\u83b7\u5f97\u7ea2\u5e3d Ansible \u81ea\u52a8\u5316\u4e13\u4e1a\u6280\u80fd\u8bc1\u4e66\u7684 IT \u4e13\u4e1a\u4eba\u5458\u80fd\u591f\u6267\u884c\u4ee5\u4e0b\u4efb\u52a1\uff1a \u4f7f\u7528 Ansible \u6e05\u5355 (inventory) \u5b9a\u4e49\u4e3b\u673a\u7ec4 \u521b\u5efa Ansible playbook \u4f7f\u7528 playbook\uff0c\u5c06\u7cfb\u7edf\u914d\u7f6e\u4e3a\u6307\u5b9a\u7684\u72b6\u6001 \u521b\u5efa\u548c\u4f7f\u7528 Ansible \u6a21\u677f\u6765\u4e3a\u4e3b\u673a\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u914d\u7f6e\u6587\u4ef6 \u521b\u5efa Ansible \u89d2\u8272 \u5229\u7528 playbook \u4e2d\u7684 Ansible Vault \u4fdd\u62a4\u654f\u611f\u6570\u636e \u5b89\u88c5 Ansible Tower \u5e76\u7528\u5b83\u6765\u7ba1\u7406\u7cfb\u7edf","title":"\u7ea2\u5e3d\u8ba4\u8bc1 Ansible \u81ea\u52a8\u5316\u4e13\u5bb6"},{"location":"certification/#_1","text":"\u7ea2\u5e3d Ansible \u81ea\u52a8\u5316\u4e13\u4e1a\u6280\u80fd\u8bc1\u4e66\u8003\u8bd5 (EX407)","title":"\u8ba4\u8bc1"},{"location":"certification/#_2","text":"\u5229\u7528 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\u8bfe\u7a0b (DO407) \u5229\u7528 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\u8bfe\u7a0b\u53ca\u8003\u8bd5 (DO408) DO407\u57fa\u4e8e\u7ea2\u5e3d\u4f01\u4e1a\u7ea7\u64cd\u4f5c\u7cfb\u7edf7\uff0c\u5229\u7528 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\u8bfe\u7a0b I (DO407) \u4e13\u4e3a\u60f3\u8981\u501f\u52a9 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\u3001\u914d\u7f6e\u548c\u7ba1\u7406\u7684\u7cfb\u7edf\u7ba1\u7406\u5458\u800c\u8bbe\u8ba1\u3002\u4e86\u89e3\u5982\u4f55\u5b89\u88c5\u548c\u914d\u7f6e Ansible\u3001\u521b\u5efa\u548c\u8fd0\u884c playbook \u6765\u914d\u7f6e\u7cfb\u7edf\u4ee5\u53ca\u7ba1\u7406 inventory (\u914d\u7f6e\u6587\u4ef6)\uff0c\u5b9e\u73b0\u81ea\u52a8\u5316\u90e8\u7f72\u3001\u6279\u91cf\u90e8\u7f72\u3001\u6279\u91cf\u914d\u7f6e\u4fee\u6539\u53ca\u6570\u636e\u4e2d\u5fc3\u76d1\u63a7\uff0c\u9488\u5bf9\u5f00\u6e90\u63d0\u4f9b\u7684playbook\u5b9e\u73b0\u90e8\u7f72\u548c\u5e94\u7528\uff0c\u540c\u65f6\u5bf9\u4f01\u4e1a\u4e2a\u6027\u5316\u670d\u52a1\u3001\u4e2a\u6027\u5316\u4fee\u6539\u63d0\u4f9b\u4e8c\u6b21\u5f00\u53d1\u548c\u7f16\u5199\u7684\u80fd\u529b\u3002","title":"\u5b98\u65b9\u57f9\u8bad\u8bfe\u7a0b"},{"location":"certification/#_3","text":"","title":"\u8003\u8bd5\u4ecb\u7ecd"},{"location":"certification/#_4","text":"\u7ea2\u5e3d\u8ba4\u8bc1 Ansible \u81ea\u52a8\u5316\u4e13\u5bb6\u8003\u8bd5\uff08EX407\uff09\u65e8\u5728\u6d4b\u8bd5\u60a8\u8fd0\u7528 Ansible \u5b9e\u73b0\u7cfb\u7edf\u548c\u5e94\u7528\u914d\u7f6e\u81ea\u52a8\u5316\u7684\u80fd\u529b\u3002 \u901a\u8fc7\u6b64\u9879\u8003\u8bd5\u540e\uff0c\u60a8\u5c06\u6210\u4e3a \u7ea2\u5e3d\u8ba4\u8bc1 Ansible \u81ea\u52a8\u5316\u4e13\u5bb6 \uff0c\u5e76\u5c06\u8ba1\u5165\u7ea2\u5e3d\u8ba4\u8bc1\u67b6\u6784\u5e08\uff08RHCA\uff09\u7684\u8ba4\u8bc1\u6210\u7ee9\u4e2d\u3002 \u672c\u8bfe\u7a0b\u57fa\u4e8e\u7ea2\u5e3d\u00ae \u4f01\u4e1a Linux\u00ae 7.5 \u548c Ansible 2.7\u3002 \u73b0\u5728\uff0c\u6b64\u9879\u8003\u8bd5\u6db5\u76d6\u7684\u6750\u6599\u5305\u542b\u5728 \u7ea2\u5e3d\u8ba4\u8bc1\u5de5\u7a0b\u5e08 (RHCE) \u8003\u8bd5 (EX294) \u7684\u8bfe\u7a0b\u4e2d\u3002\u6b64\u9879\u65b0\u8003\u8bd5\u65e8\u5728\u6d4b\u8bd5\u60a8\u80fd\u5426\u4f7f\u7528\u7ea2\u5e3d Ansible \u81ea\u52a8\u5316\u4f7f\u4e0d\u540c\u529f\u80fd\u5b9e\u73b0\u81ea\u52a8\u5316\u5e76\u6709\u6548\u6269\u5c55\u57fa\u7840\u67b6\u6784\u3002","title":"\u8003\u8bd5\u6982\u8ff0"},{"location":"certification/#_5","text":"\u9700\u8981\u7ba1\u7406\u5927\u91cf\u7cfb\u7edf\u7684\u7cfb\u7edf\u7ba1\u7406\u5458 \u5728 DevOps \u73af\u5883\u4e2d\u5de5\u4f5c\u3001\u5e76\u60f3\u5b9e\u73b0\u5927\u90e8\u5206\u65e5\u5e38\u4f5c\u4e1a\u91cf\u81ea\u52a8\u5316\u7684\u7cfb\u7edf\u7ba1\u7406\u5458 \u5177\u6709\u57fa\u672c\u7cfb\u7edf\u7ba1\u7406\u80cc\u666f\u3001\u5e76\u60f3\u5b9e\u73b0\u5f00\u53d1\u6d41\u7a0b\u81ea\u52a8\u5316\u7684\u5f00\u53d1\u4eba\u5458 \u6709\u5174\u8da3\u6210\u4e3a\u7ea2\u5e3d\u8ba4\u8bc1\u4e13\u5bb6\u6216 \u7ea2\u5e3d\u8ba4\u8bc1\u67b6\u6784\u5e08\uff08RHCA\uff09 \u7684 \u7ea2\u5e3d\u8ba4\u8bc1\u5de5\u7a0b\u5e08\uff08RHCE\uff09","title":"\u8003\u6838\u5bf9\u8c61"},{"location":"certification/#_6","text":"\u6210\u529f\u5b8c\u6210 \u5229\u7528 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\uff08DO407\uff09 \u8bfe\u7a0b\uff0c\u6216\u5177\u6709\u4f7f\u7528 Ansible \u914d\u7f6e\u7cfb\u7edf\u7684\u540c\u7b49\u7ecf\u9a8c \u5efa\u8bae\u5148\u6210\u4e3a \u7ea2\u5e3d\u8ba4\u8bc1\u7cfb\u7edf\u7ba1\u7406\u5458\uff08RHCSA\uff09 \u6216\u5177\u6709\u540c\u7b49\u6216\u66f4\u9ad8\u7684\u7cfb\u7edf\u7ba1\u7406\u7ecf\u9a8c\uff0c\u4f46\u4e0d\u5f3a\u5236\u8981\u6c42","title":"\u8003\u8bd5\u524d\u63d0\u6761\u4ef6"},{"location":"certification/#_7","text":"\u6211\u4eec\u5efa\u8bae\u8003\u751f\u5728\u53c2\u52a0\u6b64\u9879\u8003\u8bd5\u524d\u5148\u6210\u4e3a \u7ea2\u5e3d\u8ba4\u8bc1\u5de5\u7a0b\u5e08\uff08RHCE\u00ae\uff09 \u6216\u81f3\u5c11\u6210\u4e3a \u7ea2\u5e3d\u8ba4\u8bc1\u7cfb\u7edf\u7ba1\u7406\u5458\uff08RHCSA\u00ae\uff09 \uff0c\u4f46\u4e24\u8005\u5e76\u4e0d\u5f3a\u5236\u8981\u6c42\u3002 \u4e3a\u4e86\u5e2e\u52a9\u60a8\u5907\u8003\uff0c\u8bf7\u67e5\u770b\u672c\u6587\u7ed9\u51fa\u7684\u8003\u8bd5\u76ee\u6807\uff0c\u5176\u4e2d\u5217\u51fa\u4e86\u64cd\u4f5c\u4efb\u52a1\u7684\u8003\u67e5\u8303\u56f4\u3002\u7ea2\u5e3d\u4fdd\u7559\u6dfb\u52a0\u3001\u66f4\u6539\u548c\u5220\u9664\u8003\u8bd5\u76ee\u6807\u7684\u6743\u5229\u3002\u6b64\u7c7b\u53d8\u66f4\u5c06\u5728\u8003\u524d\u516c\u5e03\u3002 \u60a8\u5e94\u80fd\u591f\uff1a \u4e86\u89e3 Ansible \u7684\u6838\u5fc3\u7ec4\u4ef6 Inventory\uff08\u914d\u7f6e\u6587\u4ef6\uff09 \u6a21\u5757 \u53d8\u91cf Fact Play Playbook \u914d\u7f6e\u6587\u4ef6 \u5b89\u88c5\u548c\u914d\u7f6e Ansible \u63a7\u5236\u8282\u70b9 \u5b89\u88c5\u6240\u9700\u8f6f\u4ef6\u5305 \u521b\u5efa\u9759\u6001\u4e3b\u673a inventory \u6587\u4ef6 \u521b\u5efa\u914d\u7f6e\u6587\u4ef6 \u914d\u7f6e Ansible \u6258\u7ba1\u7684\u8282\u70b9 \u521b\u5efa SSH \u5bc6\u94a5\u5e76\u5c06\u5176\u5206\u914d\u7ed9\u6258\u7ba1\u8282\u70b9 \u5728\u6258\u7ba1\u8282\u70b9\u4e0a\u914d\u7f6e\u6743\u9650\u63d0\u5347 \u4f7f\u7528 ad-hoc Ansible \u547d\u4ee4\u9a8c\u8bc1\u6709\u6548\u914d\u7f6e \u521b\u5efa\u8fd0\u884c ad hoc Ansible \u547d\u4ee4\u7684\u7b80\u5355 shell \u811a\u672c \u4f7f\u7528\u9759\u6001\u548c\u52a8\u6001 inventory \u5b9a\u4e49\u4e3b\u673a\u7fa4\u7ec4 \u4f7f\u7528\u73b0\u6709\u7684\u52a8\u6001 inventory \u811a\u672c \u521b\u5efa Ansible play \u548c playbook \u4e86\u89e3\u5982\u4f55\u4f7f\u7528\u5e38\u7528\u7684 Ansible \u6a21\u5757 \u4f7f\u7528\u53d8\u91cf\u68c0\u7d22\u547d\u4ee4\u8fd0\u884c\u7684\u7ed3\u679c \u4f7f\u7528\u6761\u4ef6\u63a7\u5236 play \u7684\u6267\u884c \u914d\u7f6e\u9519\u8bef\u5904\u7406 \u521b\u5efa playbook\uff0c\u5c06\u7cfb\u7edf\u914d\u7f6e\u4e3a\u6307\u5b9a\u7684\u72b6\u6001 \u4f7f\u7528 Ansible \u6a21\u5757\u6267\u884c\u6709\u5173\u4ee5\u4e0b\u5185\u5bb9\u7684\u7cfb\u7edf\u7ba1\u7406\u4efb\u52a1\uff1a \u8f6f\u4ef6\u5305\u548c\u5b58\u50a8\u5e93 \u670d\u52a1 \u9632\u706b\u5899\u89c4\u5219 \u6587\u4ef6\u7cfb\u7edf \u5b58\u50a8\u8bbe\u5907 \u6587\u4ef6\u5185\u5bb9 \u5f52\u6863 \u8ba1\u5212\u4efb\u52a1 \u5b89\u5168\u6027 \u7528\u6237\u548c\u7fa4\u7ec4 \u521b\u5efa\u548c\u4f7f\u7528\u6a21\u677f\u6765\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u914d\u7f6e\u6587\u4ef6 \u4f7f\u7528 Ansible \u53d8\u91cf\u548c fact \u521b\u5efa\u548c\u4f7f\u7528\u89d2\u8272 \u4ece Ansible Galaxy \u4e0b\u8f7d\u89d2\u8272\u5e76\u4f7f\u7528 \u5e76\u884c\u7ba1\u7406 \u5229\u7528 playbook \u4e2d\u7684 Ansible Vault \u4fdd\u62a4\u654f\u611f\u6570\u636e \u4f7f\u7528\u63d0\u4f9b\u7684\u6587\u6863\u67e5\u627e\u6709\u5173 Ansible \u6a21\u5757\u548c\u547d\u4ee4\u7684\u7279\u5b9a\u4fe1\u606f","title":"\u8003\u67e5\u8981\u70b9"},{"location":"certification/#_8","text":"\u7ea2\u5e3d\u5efa\u8bae\u60a8\u5b66\u4e60 \u5229\u7528 Ansible \u5b9e\u73b0\u81ea\u52a8\u5316\u4e00\uff08DO407\uff09 \u8bfe\u7a0b\uff0c\u4ee5\u5e2e\u52a9\u5907\u8003\u3002\u6b64\u8bfe\u7a0b\u5e76\u975e\u5f3a\u5236\u6027\u8981\u6c42\uff0c\u8003\u751f\u53ef\u4ee5\u9009\u62e9\u53ea\u53c2\u52a0\u8003\u8bd5\u3002 \u5c3d\u7ba1\u53c2\u52a0\u7ea2\u5e3d\u57f9\u8bad\u8bfe\u7a0b\u662f\u60a8\u5907\u8003\u7684\u4e00\u4e2a\u91cd\u8981\u90e8\u5206\uff0c\u4f46\u53ea\u53c2\u52a0\u8bfe\u7a0b\u5e76\u4e0d\u80fd\u786e\u4fdd\u987a\u5229\u901a\u8fc7\u8003\u8bd5\u3002\u60a8\u7684\u4ee5\u5f80\u7ecf\u9a8c\u3001\u5b9e\u8df5\u4ee5\u53ca\u81ea\u8eab\u8d44\u8d28\u4e5f\u662f\u51b3\u5b9a\u80fd\u5426\u901a\u8fc7\u8003\u8bd5\u7684\u91cd\u8981\u56e0\u7d20\u3002 \u6211\u4eec\u62e5\u6709\u4f17\u591a\u6709\u5173\u7ea2\u5e3d\u4ea7\u54c1\u7cfb\u7edf\u7ba1\u7406\u7684\u4e66\u7c4d\u548c\u5b66\u4e60\u8d44\u6e90\u4f9b\u60a8\u9009\u62e9\u3002\u7ea2\u5e3d\u672a\u6307\u5b9a\u4efb\u4f55\u5185\u5bb9\u4f5c\u4e3a\u5907\u8003\u6307\u5357\u3002\u7136\u800c\uff0c\u60a8\u53ef\u80fd\u53d1\u73b0\u989d\u5916\u7684\u9605\u8bfb\u4f1a\u5bf9\u52a0\u6df1\u7406\u89e3\u6709\u5e2e\u52a9\u3002","title":"\u5907\u8003"},{"location":"certification/#_9","text":"\u8fd9\u662f\u4e00\u9879\u57fa\u4e8e\u5b9e\u9645\u64cd\u4f5c\u80fd\u529b\u7684\u8003\u8bd5\uff0c\u65e8\u5728\u8bc4\u4f30\u60a8\u8fd0\u7528 Ansible \u5b9e\u73b0\u7cfb\u7edf\u914d\u7f6e\u548c\u5e94\u7528\u90e8\u7f72\u81ea\u52a8\u5316\u7684\u80fd\u529b\u3002\u8003\u8bd5\u57fa\u4e8e\u5b9e\u9645\u64cd\u4f5c\uff0c\u8981\u6c42\u60a8\u6267\u884c\u7c7b\u4f3c\u65e5\u5e38\u5de5\u4f5c\u804c\u8d23\u7684\u4efb\u52a1\u64cd\u4f5c\u3002 \u60a8\u9700\u8981\u5f00\u53d1 Ansible playbook \u6765\u4e3a\u7279\u5b9a\u7684\u89d2\u8272\u914d\u7f6e\u7cfb\u7edf\uff0c\u7136\u540e\u5c06 playbook \u5e94\u7528\u81f3\u7cfb\u7edf\u6765\u5b9e\u65bd\u8fd9\u4e9b\u89d2\u8272\u3002\u6b64\u5916\uff0c\u60a8\u8fd8\u9700\u8981\u5c55\u793a\u81ea\u5df1\u9488\u5bf9\u7279\u5b9a\u884c\u4e3a\u8fd0\u884c Ansible playbook \u548c\u914d\u7f6e Ansible \u73af\u5883\u7684\u80fd\u529b\u3002\u60a8\u5c06\u63a5\u53d7\u76f8\u5e94\u4efb\u52a1\u8bc4\u4f30\uff0c\u4ee5\u786e\u5b9a\u662f\u5426\u8fbe\u5230\u89c4\u5b9a\u7684\u8bc4\u6d4b\u6807\u51c6\u3002 \u8003\u8bd5\u65f6\u95f4\u4e3a4\u5c0f\u65f6\u3002\u603b\u5206300\u5206\uff0c","title":"\u8003\u8bd5\u5f62\u5f0f"},{"location":"certification/#_10","text":"\u8003\u8bd5\u7684\u5b98\u65b9\u6210\u7ee9\u7531 \u7ea2\u5e3d\u8ba4\u8bc1\u4e2d\u5fc3 \u72ec\u5bb6\u516c\u5e03\u3002\u7ea2\u5e3d\u672a\u6388\u6743\u8003\u5b98\u6216\u57f9\u8bad\u5408\u4f5c\u4f19\u4f34\u76f4\u63a5\u5411\u8003\u751f\u516c\u5e03\u8003\u8bd5\u7ed3\u679c\u3002\u8003\u8bd5\u6210\u7ee9\u901a\u5e38\u4f1a\u5728 3 \u4e2a\u7f8e\u56fd\u5de5\u4f5c\u65e5\u5185\u516c\u5e03\u3002 \u516c\u5e03\u7684\u8003\u8bd5\u7ed3\u679c\u4e3a\u603b\u5206\u3002\u7ea2\u5e3d\u4e0d\u516c\u5e03\u5355\u4e2a\u9879\u76ee\u7684\u6210\u7ee9\uff0c\u4e5f\u4e0d\u4f1a\u5e94\u8003\u751f\u8981\u6c42\u63d0\u4f9b\u989d\u5916\u4fe1\u606f\u3002","title":"\u6210\u7ee9\u53ca\u516c\u5e03"},{"location":"certification/#ansible_2","text":"\u7ea2\u5e3d\u8ba4\u8bc1\u9ad8\u7ea7\u81ea\u52a8\u5316\u4e13\u5bb6\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\u80fd\u591f\u6267\u884c\u4ee5\u4e0b\u4efb\u52a1\uff1a \u7406\u89e3\u5e76\u4f7f\u7528 Git \u6765\u7ba1\u7406 playbook \u96c6\u5408 \u7ba1\u7406 Ansible \u4efb\u52a1\u6267\u884c \u5b89\u88c5\u548c\u7ba1\u7406 Ansible Tower \u7684\u8bbf\u95ee\u6743\u9650 \u7ba1\u7406\u5e93\u5b58\u6e05\u5355\u3001\u51ed\u8bc1\u3001\u9ad8\u7ea7\u5e93\u5b58\u6e05\u5355\u3001\u9879\u76ee\u548c\u5de5\u4f5c\u6d41 \u4f7f\u7528 Ansible Tower API \u542f\u52a8\u4f5c\u4e1a","title":"\u7ea2\u5e3d\u8ba4\u8bc1\u9ad8\u7ea7\u81ea\u52a8\u5316\u4e13\u5bb6\uff1aAnsible \u6700\u4f73\u5b9e\u8df5"},{"location":"certification/#_11","text":"\u7ea2\u5e3d\u8ba4\u8bc1\u9ad8\u7ea7\u81ea\u52a8\u5316\u4e13\u5bb6\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\uff08EX447\uff09","title":"\u8ba4\u8bc1"},{"location":"certification/#_12","text":"\u9ad8\u7ea7\u81ea\u52a8\u5316\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\uff08DO447\uff09","title":"\u5b98\u65b9\u57f9\u8bad\u8bfe\u7a0b"},{"location":"certification/#_13","text":"","title":"\u8003\u8bd5\u4ecb\u7ecd"},{"location":"certification/#_14","text":"\u7ea2\u5e3d\u8ba4\u8bc1\u9ad8\u7ea7\u81ea\u52a8\u5316\u4e13\u5bb6\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\u8003\u8bd5\uff08EX447\uff09\u65e8\u5728\u901a\u8fc7\u5b9e\u9645\u4efb\u52a1\u64cd\u4f5c\uff0c\u8003\u6838\u60a8\u4f7f\u7528\u7ea2\u5e3d\u00ae Ansible\u00ae \u5f15\u64ce\u548c\u7ea2\u5e3d Ansible Tower \u6765\u7ba1\u7406\u591a\u4e2a\u7cfb\u7edf\u7684\u77e5\u8bc6\u548c\u6280\u80fd\u3002 \u901a\u8fc7\u6b64\u9879\u8003\u8bd5\u540e\uff0c\u60a8\u5c06\u6210\u4e3a \u7ea2\u5e3d\u8ba4\u8bc1\u9ad8\u7ea7\u81ea\u52a8\u5316\u4e13\u5bb6\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\u8003\u8bd5 \uff0c\u5e76\u5c06\u8ba1\u5165 \u7ea2\u5e3d\u8ba4\u8bc1\u67b6\u6784\u5e08\uff08RHCA\u00ae\uff09 \u7684\u8ba4\u8bc1\u6210\u7ee9\u4e2d\u3002 \u672c\u8003\u8bd5\u57fa\u4e8e\u7ea2\u5e3d\u4f01\u4e1a Linux 8.0\u3001\u7ea2\u5e3d Ansible 2.8 \u548c\u7ea2\u5e3d Ansible Tower 3.5\u3002","title":"\u8003\u8bd5\u6982\u8ff0"},{"location":"certification/#_15","text":"\u7ea2\u5e3d\u8ba4\u8bc1\u9ad8\u7ea7\u81ea\u52a8\u5316\u4e13\u5bb6\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\u8003\u8bd5\u9002\u5408\uff1a\u60f3\u8981\u68c0\u9a8c\u6709\u5173 Ansible \u6700\u4f73\u5b9e\u8df5\u7684\u5e7f\u535a\u77e5\u8bc6\u548c\u6df1\u5165\u7406\u89e3\u3001\u5e0c\u671b\u5728\u66f4\u5927\u548c\u66f4\u590d\u6742\u7684\u9879\u76ee\u4e2d\u5e94\u7528 Ansible\uff0c\u4ee5\u53ca\u4f7f\u7528 Ansible Tower \u7684\u4eba\u58eb\uff0c\u5305\u62ec\uff1a \u5177\u5907\u4e30\u5bcc\u7ecf\u9a8c\u7684 Linux \u7cfb\u7edf\u7ba1\u7406\u5458 DevOps \u5de5\u7a0b\u5e08 \u4e91\u7ba1\u7406\u5458 \u5176\u4ed6 IT \u4e13\u4e1a\u4eba\u5458","title":"\u8003\u6838\u5bf9\u8c61"},{"location":"certification/#_16","text":"\u53c2\u52a0\u8fc7 \u9ad8\u7ea7\u81ea\u52a8\u5316\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\uff08DO447\uff09 \u8bfe\u7a0b\uff0c\u6216\u62e5\u6709\u7ea2\u5e3d\u4f01\u4e1a Linux\u00ae\u3001Ansible \u548c Ansible Tower \u65b9\u9762\u7684\u540c\u7b49\u5de5\u4f5c\u7ecf\u9a8c \u53c2\u52a0\u8fc7 \u7ea2\u5e3d\u7cfb\u7edf\u7ba1\u7406\u4e09\uff1aLinux \u81ea\u52a8\u5316\uff08RH294\uff09 \u8bfe\u7a0b\uff0c\u6216\u62e5\u6709\u7ea2\u5e3d\u4f01\u4e1a Linux \u548c Ansible \u65b9\u9762\u7684\u540c\u7b49\u5de5\u4f5c\u7ecf\u9a8c \u7b26\u5408\u8003\u8bd5\u76ee\u6807","title":"\u8003\u8bd5\u524d\u63d0\u6761\u4ef6"},{"location":"certification/#_17","text":"\u60a8\u5e94\u80fd\u72ec\u7acb\u5b8c\u6210\u4e0b\u5217\u5206\u7ec4\u4efb\u52a1\uff1a \u7406\u89e3\u548c\u8fd0\u7528 Git \u514b\u9686 Git \u5b58\u50a8\u5e93 \u5728 Git \u5b58\u50a8\u5e93\u4e2d\u66f4\u65b0\u3001\u4fee\u6539\u548c\u521b\u5efa\u6587\u4ef6 \u5c06\u8fd9\u4e9b\u4fee\u6539\u8fc7\u7684\u6587\u4ef6\u6dfb\u52a0\u56de Git \u5b58\u50a8\u5e93 \u7ba1\u7406\u5e93\u5b58\u6e05\u5355\u53d8\u91cf \u5229\u7528\u6bcf\u4e2a\u4e3b\u673a\u6216\u7ec4\u7684\u591a\u4e2a\u6587\u4ef6\uff0c\u6784\u5efa\u4e3b\u673a\u548c\u7ec4\u53d8\u91cf \u4f7f\u7528\u7279\u6b8a\u53d8\u91cf\u6765\u8986\u76d6\u4e3b\u673a\u3001\u7aef\u53e3\u6216 Ansible \u9488\u5bf9\u7279\u5b9a\u4e3b\u673a\u800c\u4f7f\u7528\u7684\u8fdc\u7a0b\u7528\u6237 \u4e3a\u67d0\u4e9b\u6258\u7ba1\u4e3b\u673a\u8bbe\u7f6e\u5305\u542b\u591a\u4e2a\u4e3b\u673a\u53d8\u91cf\u6587\u4ef6\u7684\u76ee\u5f55 \u4ee5\u4e0d\u540c\u7684\u540d\u79f0\u6216 IP \u5730\u5740\u6765\u8986\u76d6\u5e93\u5b58\u6e05\u5355\u6587\u4ef6\u4e2d\u6240\u7528\u7684\u540d\u79f0 \u7ba1\u7406\u4efb\u52a1\u7684\u6267\u884c \u63a7\u5236\u6743\u9650\u6267\u884c \u8fd0\u884c\u6240\u9009\u7684\u4efb\u52a1 \u501f\u52a9\u8fc7\u6ee4\u5668\u548c\u63d2\u4ef6\u8f6c\u6362\u6570\u636e \u4f7f\u7528\u67e5\u627e\u63d2\u4ef6\uff0c\u7528\u6765\u81ea\u5916\u90e8\u6e90\u7684\u6570\u636e\u586b\u5145\u53d8\u91cf \u4f7f\u7528\u67e5\u627e\u548c\u67e5\u8be2\u529f\u80fd\uff0c\u5c06\u6765\u81ea\u5916\u90e8\u6e90\u7684\u6a21\u677f\u6570\u636e\u5316\u4e3a playbook \u548c\u5df2\u90e8\u7f72\u7684\u6a21\u677f\u6587\u4ef6 \u4f7f\u7528\u67e5\u627e\u63d2\u4ef6\u548c\u8fc7\u6ee4\u5668\uff0c\u7528\u9664\u7b80\u5355\u5217\u8868\u4e4b\u5916\u7684\u7ed3\u6784\u5b9e\u73b0\u5faa\u73af \u4f7f\u7528\u8fc7\u6ee4\u5668\uff0c\u68c0\u67e5\u3001\u9a8c\u8bc1\u548c\u64cd\u4f5c\u5305\u542b\u7f51\u7edc\u4fe1\u606f\u7684\u53d8\u91cf \u59d4\u6d3e\u4efb\u52a1 \u5728\u53e6\u4e00\u53f0\u4e3b\u673a\u4e0a\u8fd0\u884c\u6258\u7ba1\u4e3b\u673a\u7684\u4efb\u52a1\uff0c\u7136\u540e\u63a7\u5236\u662f\u5426\u5c06\u8be5\u4efb\u52a1\u6536\u96c6\u7684 fact \u59d4\u6d3e\u7ed9\u6258\u7ba1\u4e3b\u673a\u6216\u5176\u4ed6\u4e3b\u673a \u5b89\u88c5 Ansible Tower \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u6267\u884c Ansible Tower \u7684\u57fa\u672c\u914d\u7f6e \u7ba1\u7406 Ansible Tower \u7684\u8bbf\u95ee\u6743\u9650 \u521b\u5efa Ansible Tower \u7528\u6237\u548c\u56e2\u961f\u5e76\u8ba9\u5176\u76f8\u4e92\u5173\u8054 \u7ba1\u7406\u5e93\u5b58\u6e05\u5355\u548c\u51ed\u636e \u7ba1\u7406\u9ad8\u7ea7\u5e93\u5b58\u6e05\u5355 \u4ece\u8eab\u4efd\u7ba1\u7406\u670d\u52a1\u5668\u6216\u6570\u636e\u5e93\u670d\u52a1\u5668\u521b\u5efa\u52a8\u6001\u5e93\u5b58\u6e05\u5355 \u521b\u5efa\u673a\u5668\u51ed\u636e\u4ee5\u8bbf\u95ee\u5e93\u5b58\u6e05\u5355\u4e3b\u673a \u521b\u5efa\u6e90\u4ee3\u7801\u63a7\u5236\u51ed\u636e \u7ba1\u7406\u9879\u76ee \u521b\u5efa\u4f5c\u4e1a\u6a21\u677f \u7ba1\u7406\u5de5\u4f5c\u6d41 \u521b\u5efa\u5de5\u4f5c\u6d41\u6a21\u677f \u4f7f\u7528 Ansible Tower API \u7f16\u5199 API \u811a\u672c\u5c0f\u7a0b\u5e8f\u4ee5\u542f\u52a8\u4f5c\u4e1a \u5907\u4efd Ansible Tower \u5907\u4efd Ansible Tower \u7684\u5b9e\u4f8b \u5bf9\u4e8e\u6240\u6709\u5b9e\u9645\u4efb\u52a1\u64cd\u4f5c\u578b\u7684\u7ea2\u5e3d\u8003\u8bd5\uff0c\u60a8\u7684\u6240\u6709\u7cfb\u7edf\u914d\u7f6e\u5fc5\u987b\u5728\u91cd\u542f\u540e\u4ecd\u7136\u6709\u6548\uff08\u65e0\u9700\u4eba\u5de5\u5e72\u9884\uff09\u3002","title":"\u8003\u67e5\u8981\u70b9"},{"location":"certification/#_18","text":"\u4e3a\u4e86\u66f4\u597d\u5907\u8003\uff0c\u7ea2\u5e3d\u5efa\u8bae\u60a8\u5b66\u4e60 \u9ad8\u7ea7\u81ea\u52a8\u5316\uff1aAnsible \u6700\u4f73\u5b9e\u8df5\uff08DO447\uff09 \u8bfe\u7a0b\u3002 \u6b64\u7c7b\u8bfe\u7a0b\u5e76\u975e\u5f3a\u5236\u6027\u8981\u6c42\uff0c\u8003\u751f\u53ef\u4ee5\u9009\u62e9\u53ea\u53c2\u52a0\u8003\u8bd5\u3002 \u5c3d\u7ba1\u53c2\u52a0\u7ea2\u5e3d\u57f9\u8bad\u8bfe\u7a0b\u662f\u60a8\u5907\u8003\u7684\u4e00\u4e2a\u91cd\u8981\u90e8\u5206\uff0c\u4f46\u53ea\u53c2\u52a0\u8bfe\u7a0b\u5e76\u4e0d\u80fd\u786e\u4fdd\u987a\u5229\u901a\u8fc7\u8003\u8bd5\u3002\u60a8\u7684\u4ee5\u5f80\u7ecf\u9a8c\u3001\u5b9e\u8df5\u4ee5\u53ca\u81ea\u8eab\u8d44\u8d28\u4e5f\u662f\u51b3\u5b9a\u80fd\u5426\u901a\u8fc7\u8003\u8bd5\u7684\u91cd\u8981\u56e0\u7d20\u3002 \u6211\u4eec\u62e5\u6709\u4f17\u591a\u6709\u5173\u7ea2\u5e3d\u4ea7\u54c1\u7cfb\u7edf\u7ba1\u7406\u7684\u4e66\u7c4d\u548c\u5b66\u4e60\u8d44\u6e90\u4f9b\u60a8\u9009\u62e9\u3002\u7ea2\u5e3d\u672a\u6307\u5b9a\u4efb\u4f55\u5185\u5bb9\u4f5c\u4e3a\u5907\u8003\u6307\u5357\u3002\u7136\u800c\uff0c\u6d89\u730e\u66f4\u591a\u4f1a\u6709\u52a9\u52a0\u6df1\u60a8\u5bf9\u6240\u5b66\u77e5\u8bc6\u7684\u7406\u89e3\u3002","title":"\u5907\u8003"},{"location":"certification/#_19","text":"\u6b64\u9879\u8003\u8bd5\u5c5e\u4e8e \u4e0a\u673a\u5b9e\u8df5\u64cd\u4f5c\u8003\u8bd5 \uff0c\u8981\u6c42\u60a8\u5b8c\u6210\u771f\u5b9e\u7684\u4efb\u52a1\u3002\u6211\u4eec\u5c06\u5411\u60a8\u63d0\u4f9b\u4e00\u4e2a\u6216\u591a\u4e2a\u865a\u62df\u7cfb\u7edf\uff0c\u800c\u60a8\u9700\u8981\u6267\u884c\u4e0e\u771f\u5b9e\u4f5c\u4e1a\u76f8\u7c7b\u4f3c\u7684\u4efb\u52a1\u3002\u8003\u8bd5\u671f\u95f4\u4e0d\u63d0\u4f9b\u4e92\u8054\u7f51\u63a5\u5165\uff0c\u60a8\u4e5f\u4e0d\u5f97\u5c06\u4efb\u4f55\u7eb8\u8d28\u6216\u7535\u5b50\u6587\u6863\u5e26\u5165\u8003\u573a\u3002\u7981\u6b62\u643a\u5e26\u7684\u7269\u54c1\u5305\u62ec\uff1a\u7b14\u8bb0\u3001\u4e66\u7c4d\u6216\u4efb\u4f55\u5176\u4ed6\u6750\u6599\u3002\u5728\u53c2\u52a0\u5927\u591a\u6570\u8003\u8bd5\u65f6\uff0c\u60a8\u90fd\u53ef\u4ee5\u4f7f\u7528\u4ea7\u54c1\u968f\u9644\u7684\u6587\u6863\u3002","title":"\u8003\u8bd5\u5f62\u5f0f"},{"location":"certification/#_20","text":"\u8003\u8bd5\u7684\u5b98\u65b9\u6210\u7ee9\u7531 \u7ea2\u5e3d\u8ba4\u8bc1\u4e2d\u5fc3 \u72ec\u5bb6\u516c\u5e03\u3002\u7ea2\u5e3d\u672a\u6388\u6743\u8003\u5b98\u6216\u57f9\u8bad\u5408\u4f5c\u4f19\u4f34\u76f4\u63a5\u5411\u8003\u751f\u516c\u5e03\u8003\u8bd5\u7ed3\u679c\u3002\u8003\u8bd5\u6210\u7ee9\u901a\u5e38\u4f1a\u5728 3 \u4e2a\u7f8e\u56fd\u5de5\u4f5c\u65e5\u5185\u516c\u5e03\u3002 \u516c\u5e03\u7684\u8003\u8bd5\u7ed3\u679c\u4e3a\u603b\u5206\u3002\u7ea2\u5e3d\u4e0d\u516c\u5e03\u5355\u4e2a\u9879\u76ee\u7684\u6210\u7ee9\uff0c\u4e5f\u4e0d\u4f1a\u5e94\u8003\u751f\u8981\u6c42\u63d0\u4f9b\u989d\u5916\u4fe1\u606f\u3002","title":"\u6210\u7ee9\u53ca\u516c\u5e03"},{"location":"certification/ex407-example/","text":"\u9002\u7528\u4e8e EX407 / EX294 \u7684Ansible\u793a\u4f8b\u8003\u8bd5 \u00b6 \u8fd9\u662f\u6211\u4e3a\u51c6\u5907EX407\u800c\u521b\u5efa\u7684Ansible\u6837\u672c\u8003\u8bd5\u3002\u6211\u5c1a\u672a\u53c2\u52a0EX407\u8003\u8bd5\u3002 \u60a8\u4e5f\u53ef\u4ee5\u5c06\u5176\u7528\u4e8e\u65b0\u7684RHCE 8\u8003\u8bd5EX294\u3002 \u4e0e\u771f\u5b9e\u8003\u8bd5\u4e00\u6837\uff0c\u5c06\u4e0d\u63d0\u4f9b\u6837\u672c\u8003\u8bd5\u95ee\u9898\u7684\u7b54\u6848\u3002 \u8981\u6c42 \u00b6 \u603b\u5171\u670918\u4e2a\u95ee\u9898\u3002 \u60a8\u5c06\u9700\u8981\u4e94\u4e2aRHEL 7\uff08\u6216CentOS 7\uff09\u865a\u62df\u673a\u624d\u80fd\u6210\u529f\u5b8c\u6210\u6240\u6709\u95ee\u9898\u3002 \u4e00\u53f0VM\u5c06\u914d\u7f6e\u4e3aAnsible\u63a7\u5236\u8282\u70b9\u3002\u5176\u4ed6\u56db\u4e2aVM\u5c06\u7528\u4e8e\u5e94\u7528\u5267\u672c\u6765\u89e3\u51b3\u793a\u4f8b\u8003\u8bd5\u95ee\u9898\u3002\u5728\u6574\u4e2a\u6837\u672c\u8003\u8bd5\u4e2d\u5c06\u4f7f\u7528\u4ee5\u4e0bFQDN\u3002 ansible-control.hl.local \u2013 Ansible\u63a7\u5236\u8282\u70b9 ansible2.hl.local \u2013\u6258\u7ba1\u4e3b\u673a ansible3.hl.local \u2013\u6258\u7ba1\u4e3b\u673a ansible4.hl.local \u2013\u6258\u7ba1\u4e3b\u673a ansible5.hl.local \u2013\u6258\u7ba1\u4e3b\u673a \u5728\u7ee7\u7eed\u8fdb\u884c\u64cd\u4f5c\u4e4b\u524d\uff0c\u9700\u8981\u6ee1\u8db3\u51e0\u4e2a\u8981\u6c42\uff1a ansible-control.hl.local \u670d\u52a1\u5668\u5177\u6709\u5bf9\u6240\u6709\u53d7\u7ba1\u670d\u52a1\u5668\u7684\u65e0\u5bc6\u7801SSH\u8bbf\u95ee\uff08\u4f7f\u7528root\u7528\u6237\uff09\u3002 ansible5.hl.local \u670d\u52a1\u5668\u5df2 /dev/sdb \u8fde\u63a51GB\u8f85\u52a9\u78c1\u76d8\u3002 \u5728\u4efb\u4f55\u670d\u52a1\u5668\u4e0a\u90fd\u6ca1\u6709\u521b\u5efa\u666e\u901a\u7528\u6237\u3002 \u63d0\u793a\u4e0e\u5efa\u8bae \u00b6 \u6211\u8bd5\u56fe\u6db5\u76d6\u5c3d\u53ef\u80fd\u591a\u7684\u8003\u8bd5\u76ee\u6807\uff0c\u4f46\u662f\u8bf7\u6ce8\u610f\uff0c\u4e0d\u4f1a\u51fa\u73b0\u4e0e\u52a8\u6001\u6e05\u5355\u6709\u5173\u7684\u95ee\u9898\u3002 \u6709\u4e9b\u95ee\u9898\u53ef\u80fd\u53d6\u51b3\u4e8e\u5176\u4ed6\u95ee\u9898\u7684\u7ed3\u679c\u3002\u8bf7\u5148\u9605\u8bfb\u6240\u6709\u95ee\u9898\uff0c\u7136\u540e\u518d\u7ee7\u7eed\u3002 \u8bf7\u6ce8\u610f\uff0c\u6837\u672c\u8003\u8bd5\u7684\u76ee\u7684\u662f\u6d4b\u8bd5\u60a8\u7684\u6280\u80fd\u3002\u8bf7\u4e0d\u8981\u5728\u8bc4\u8bba\u90e8\u5206\u53d1\u5e03\u60a8\u7684\u5267\u672c\u3002 \u8003\u8bd5\u6837\u9898 \u00b6 \u6ce8\u610f\uff1a\u60a8\u5177\u6709\u5bf9\u6240\u6709\u4e94\u53f0\u670d\u52a1\u5668\u7684\u8d85\u7ea7\u7528\u6237\u8bbf\u95ee\u6743\u9650\u3002 \u4efb\u52a11\uff1aAnsible\u5b89\u88c5\u548c\u914d\u7f6e \u00b6 \u5728\u63a7\u5236\u8282\u70b9\u4e0a\u5b89\u88c5ansible\u8f6f\u4ef6\u5305\uff08\u5305\u62ec\u6240\u6709\u4f9d\u8d56\u9879\uff09\u5e76\u914d\u7f6e\u4ee5\u4e0b\u5185\u5bb9\uff1a \u4f7f\u7528 devops \u5bc6\u7801\u521b\u5efa\u5e38\u89c4\u7684\u7528\u6237 \u81ea\u52a8\u5316 \u3002\u9664\u975e\u60a8\u6b63\u5728\u6267\u884c\u9700\u8981\u5728\u6e05\u5355\u4e3b\u673a\u4e0a\u521b\u5efa \u81ea\u52a8\u5316 \u7528\u6237\u7684\u4efb\u52a1\uff032\uff0c\u5426\u5219\u8bf7\u5c06\u8be5\u7528\u6237\u7528\u4e8e\u6240\u6709\u793a\u4f8b\u8003\u8bd5\u4efb\u52a1\u548c\u7ec3\u4e60\u7c3f\u3002\u60a8\u5177\u6709\u5bf9\u6240\u6709\u4e94\u53f0\u670d\u52a1\u5668\u7684\u8d85\u7ea7\u7528\u6237\u8bbf\u95ee\u6743\u9650\u3002 \u60a8\u4e3a\u6b64\u793a\u4f8b\u8003\u8bd5\u521b\u5efa\u7684\u6240\u6709\u5267\u672c\u548c\u5176\u4ed6Ansible\u914d\u7f6e\u90fd\u5e94\u5b58\u50a8\u5728\u4e2d /home/automation/plays \u3002 \u521b\u5efa /home/automation/plays/ansible.cfg \u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42\u7684\u914d\u7f6e\u6587\u4ef6\uff1a \u89d2\u8272\u8def\u5f84\u5e94\u5305\u62ec /home/automation/plays/roles \uff0c\u4ee5\u53ca\u793a\u4f8b\u8003\u8bd5\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u9700\u8981\u7684\u4efb\u4f55\u5176\u4ed6\u8def\u5f84\u3002 \u5e93\u5b58\u6587\u4ef6\u8def\u5f84\u4e3a /home/automation/plays/inventory \u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7279\u6743\u5347\u7ea7\u662f \u7981\u7528 \u7684\u3002 Ansible\u5e94\u8be5\u80fd\u591f\u4e00\u6b21\u7ba1\u7406 10\u4e2a\u4e3b\u673a \u3002 Ansible\u5e94\u8be5\u4f7f\u7528 \u81ea\u52a8\u5316 \u7528\u6237\u8fde\u63a5\u5230\u6240\u6709\u53d7\u7ba1\u8282\u70b9\u3002 /home/automation/plays/inventory \u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efa\u6e05\u5355\u6587\u4ef6\uff1a ansible2.hl.local\u662f \u4ee3\u7406 \u4e3b\u673a\u7ec4\u7684\u6210\u5458\u3002 ansible3.hl.local\u662f Webservers \u4e3b\u673a\u7ec4\u7684\u6210\u5458\u3002 ansible4.hl.local\u662f Webservers \u4e3b\u673a\u7ec4\u7684\u6210\u5458\u3002 ansible5.hl.local\u662f \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u7684\u6210\u5458\u3002 \u4efb\u52a12\uff1a\u4e34\u65f6\u547d\u4ee4 \u00b6 \u5728\u63a7\u5236\u8282\u70b9\u4e0a\u751f\u6210SSH\u5bc6\u94a5\u5bf9\u3002\u60a8\u53ef\u4ee5\u624b\u52a8\u6267\u884c\u6b64\u6b65\u9aa4\u3002 \u7f16\u5199\u4e00\u4e2a /home/automation/plays/adhoc \u4f7f\u7528Ansible ad-hoc\u547d\u4ee4\u6765\u5b9e\u73b0\u4ee5\u4e0b\u76ee\u7684\u7684\u811a\u672c\uff1a \u5728\u6240\u6709\u6e05\u5355\u4e3b\u673a\uff08\u4e0d\u662f\u63a7\u5236\u8282\u70b9\uff09\u4e0a\u521b\u5efa\u7528\u6237 \u81ea\u52a8\u5316 \u3002 SSH\u5bc6\u94a5\uff08\u60a8\u751f\u6210\u7684\uff09\u5df2\u590d\u5236\u5230 \u81ea\u52a8\u5316 \u7528\u6237\u7684\u6240\u6709\u6e05\u5355\u4e3b\u673a\u4e2d\uff0c\u5e76\u5b58\u50a8\u5728\u4e2d /home/automation/.ssh/authorized_keys \u3002 \u8be5 \u81ea\u52a8\u5316 \u5141\u8bb8\u7528\u6237\u63d0\u5347\u5bf9\u6240\u6709\u5e93\u5b58\u7684\u4e3b\u673a\u6743\u9650\uff0c\u800c\u65e0\u9700\u63d0\u4f9b\u5bc6\u7801\u3002 \u8fd0\u884cadhoc\u811a\u672c\u540e\uff0c\u60a8\u5e94\u8be5\u80fd\u591f\u4f7f\u7528\u6ca1\u6709\u5bc6\u7801\u7684 \u81ea\u52a8\u5316 \u7528\u6237SSH\u8fdb\u5165\u6240\u6709\u6e05\u5355\u4e3b\u673a\uff0c\u4ee5\u53ca\u8fd0\u884c\u6240\u6709\u7279\u6743\u547d\u4ee4\u3002 \u4efb\u52a13\uff1a\u6587\u4ef6\u5185\u5bb9 \u00b6 \u521b\u5efa\u4e00\u4e2a /home/automation/plays/motd.yml \u5728\u6240\u6709\u6e05\u5355\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u8be5\u5267\u672c\u5e94\u5c06\u6240\u6709\u73b0\u6709\u5185\u5bb9\u66ff\u6362\u4e3a /etc/motd \u6587\u5b57\u3002\u6587\u672c\u53d6\u51b3\u4e8e\u4e3b\u673a\u7ec4\u3002 \u5728 \u4ee3\u7406 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\uff0c\u8be5\u884c\u5e94\u4e3a\u201c Welcome to HAProxy server\u201d\u3002 \u5728 Web\u670d\u52a1\u5668 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\uff0c\u8be5\u884c\u5e94\u4e3a\u201c Welcome to Apache server\u201d\u3002 \u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\uff0c\u8be5\u884c\u5e94\u4e3a\u201c Welcome to MySQL server\u201d\u3002 \u4efb\u52a14\uff1a\u914d\u7f6eSSH\u670d\u52a1\u5668 \u00b6 \u521b\u5efa\u4e00\u4e2a /home/automation/plays/sshd.yml \u5728\u6240\u6709\u6e05\u5355\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6309\u5982\u4e0b\u65b9\u5f0f\u914d\u7f6eSSHD\u5b88\u62a4\u7a0b\u5e8f\uff1a \u6807\u8bed\u8bbe\u7f6e\u4e3a /etc/motd X11\u8f6c\u53d1\u7981\u7528 MaxAuthTries\u8bbe\u7f6e\u4e3a3 \u4efb\u52a15\uff1aAnsible\u4fdd\u7ba1\u7bb1 \u00b6 \u521b\u5efaAnsible\u5e93\u6587\u4ef6 /home/automation/plays/secret.yml \u3002\u52a0\u5bc6/\u89e3\u5bc6\u5bc6\u7801\u4e3a devops \u3002 \u5c06\u4ee5\u4e0b\u53d8\u91cf\u6dfb\u52a0\u5230Vault\uff1a user_password \u7684\u503c\u4e3a ** devops** database_password \u4e0e\u4ef7\u503c ** DEVOPS** \u5c06Ansible\u4fdd\u7ba1\u5e93\u5bc6\u7801\u5b58\u50a8\u5728\u6587\u4ef6\u4e2d /home/automation/plays/vault_key \u3002 \u4efb\u52a16\uff1a\u7528\u6237\u548c\u7ec4 \u00b6 \u5df2\u4e3a\u60a8\u63d0\u4f9b\u4ee5\u4e0b\u7528\u6237\u5217\u8868\u3002 \u4f7f\u7528 /home/automation/plays/vars/user_list.yml \u6587\u4ef6\u4fdd\u5b58\u6b64\u5185\u5bb9\u3002 --- users: - username: alice uid: 1201 - username: vincent uid: 1202 - username: sandy uid: 2201 - username: patrick uid: 2202 \u521b\u5efa /home/automation/plays/users.yml \u4f7f\u7528\u5e93\u6587\u4ef6 /home/automation/plays/secret.yml \u5b9e\u73b0\u4ee5\u4e0b\u76ee\u7684\u7684\u5267\u672c\uff1a \u7528\u6237ID\u4ee51\u5f00\u5934\u7684\u7528\u6237\u5e94\u5728 webservers \u4e3b\u673a\u7ec4\u4e2d\u7684 \u670d\u52a1\u5668 \u4e0a\u521b\u5efa\u3002\u7528\u6237\u5bc6\u7801\u5e94\u901a\u8fc7 user_password \u53d8\u91cf\u4f7f\u7528\u3002 \u5e94\u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u670d\u52a1\u5668\u4e0a\u521b\u5efa\u7528\u6237ID\u4ee52\u5f00\u5934\u7684\u7528\u6237\u3002\u7528\u6237\u5bc6\u7801\u5e94\u901a\u8fc7 user_password \u53d8\u91cf\u4f7f\u7528\u3002 \u6240\u6709\u7528\u6237\u90fd\u5e94\u8be5\u662f\u8f85\u52a9\u7ec4 \u8f6e\u7684 \u6210\u5458\u3002 \u5e94\u8be5 /bin/bash \u4e3a\u6240\u6709\u7528\u6237\u8bbe\u7f6eShell \u3002 \u5e10\u6237\u5bc6\u7801\u5e94\u4f7f\u7528SHA512\u54c8\u5e0c\u683c\u5f0f\u3002 \u6bcf\u4e2a\u7528\u6237\u90fd\u5e94\u8be5\u4e0a\u4f20\u4e00\u4e2aSSH\u5bc6\u94a5\uff08\u4f7f\u7528\u5148\u524d\u521b\u5efa\u7684SSH\u5bc6\u94a5\uff0c\u8bf7\u53c2\u9605\u4efb\u52a1\uff032\uff09\u3002 \u8fd0\u884c\u5267\u672c\u540e\uff0c\u7528\u6237\u5e94\u8be5\u53ef\u4ee5\u65e0\u9700\u5bc6\u7801\u5373\u53ef\u901a\u8fc7SSH\u8fdb\u5165\u5404\u81ea\u7684\u670d\u52a1\u5668\u3002 \u4efb\u52a17\uff1a\u8ba1\u5212\u4efb\u52a1 \u00b6 \u521b\u5efa\u4e00\u4e2a /home/automation/plays/regular_tasks.yml \u5728 \u4ee3\u7406 \u4e3b\u673a\u7ec4\u4e2d\u7684 \u670d\u52a1\u5668 \u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u5c06\u521b\u5efa\u4e00\u4e2a\u6839crontab\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u6bcf\u5c0f\u65f6\u8fd0\u884c\u4e00\u6b21\u3002 cron\u4f5c\u4e1a\u5c06\u6587\u4ef6\u9644\u52a0 date \u547d\u4ee4 /var/log/time.log \u7684\u8f93\u51fa\u3002 \u4efb\u52a18\uff1a\u8f6f\u4ef6\u5b58\u50a8\u5e93 \u00b6 \u521b\u5efa\u4e00\u4e2a /home/automation/plays/repository.yml \u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u521b\u5efa\u4e00\u4e2aYUM\u5b58\u50a8\u5e93\u6587\u4ef6\u3002 \u5b58\u50a8\u5e93\u7684\u540d\u79f0\u662f mysql56-community \u3002 \u4ed3\u5e93\u7684\u63cf\u8ff0\u662f\u201c MySQL 5.6 YUM Repo\u201d\u3002 \u4ed3\u5e93\u7684\u57fa\u672cURL\u662f http://repo.mysql.com/yum/mysql-5.6-community/el/7/x86_64/ \u3002 \u4ed3\u5e93GPG\u5bc6\u94a5\u4f4d\u4e8e http://repo.mysql.com/RPM-GPG-KEY-mysql \u3002 \u50a8\u5b58\u5e93GPG\u68c0\u67e5\u5df2\u542f\u7528\u3002 \u5b58\u50a8\u5e93\u5df2\u542f\u7528\u3002 \u4efb\u52a19\uff1a\u521b\u5efa\u548c\u4f7f\u7528\u89d2\u8272 \u00b6 \u521b\u5efa\u4e00\u4e2a\u540d\u4e3a sample-mysql \u7684\u89d2\u8272\u5e76\u5c06\u5176\u5b58\u50a8\u5728\u4e2d /home/automation/plays/roles \u3002\u8be5\u89d2\u8272\u5e94\u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42\uff1a \u5728\u8bbe\u5907 /dev/sdb \u4e0a\u521b\u5efa\u5927\u5c0f\u4e3a800MB\u7684\u4e3b\u5206\u533a\u53f71 \u3002 vg_database \u521b\u5efa\u4e00\u4e2a\u540d\u4e3aLVM\u7684\u5377\u7ec4\uff0c\u8be5\u5377\u7ec4\u4f7f\u7528\u4e0a\u9762\u521b\u5efa\u7684\u4e3b\u5206\u533a\u3002 lv_mysql \u5728\u5377\u7ec4\u4e2d\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u4e3a512MB \u7684LVM\u903b\u8f91\u5377 vg_database \u3002 \u5728\u903b\u8f91\u5377 lv_mysql \u4e0a\u521b\u5efa\u4e86\u4e00\u4e2aXFS\u6587\u4ef6\u7cfb\u7edf\u3002 \u903b\u8f91\u5377 lv_mysql \u5df2\u6c38\u4e45\u5b89\u88c5\u5728\u4e0a /mnt/mysql_backups \u3002 mysql-community-server \u8f6f\u4ef6\u5305\u5df2\u5b89\u88c5\u3002 \u9632\u706b\u5899\u914d\u7f6e\u4e3a\u5141\u8bb8MySQL\u7aef\u53e3TCP 3306\u4e0a\u7684\u6240\u6709\u4f20\u5165\u6d41\u91cf\u3002 MySQL\u6839\u7528\u6237\u5bc6\u7801\u5e94\u4ece\u53d8\u91cf database_password \u8bbe\u7f6e\uff08\u8bf7\u53c2\u9605\u4efb\u52a1\uff035\uff09\u3002 MySQL\u670d\u52a1\u5668\u5e94\u5df2\u542f\u52a8\u5e76\u5728\u542f\u52a8\u65f6\u542f\u7528\u3002 MySQL\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u662f\u4ece my.cnf.j2 Jinja2\u6a21\u677f\u751f\u6210\u7684\uff0c\u5177\u6709\u4ee5\u4e0b\u5185\u5bb9\uff1a [mysqld] bind_address = {{ ansible_default_ipv4.address }} skip_name_resolve datadir=/var/lib/mysql socket=/var/lib/mysql/mysql.sock symbolic-links=0 sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES [mysqld_safe] log-error=/var/log/mysqld.log pid-file=/var/run/mysqld/mysqld.pid \u521b\u5efa /home/automation/plays/mysql.yml \u4f7f\u7528\u8be5\u89d2\u8272\u5e76\u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\u3002 \u4efb\u52a110\uff1a\u521b\u5efa\u548c\u4f7f\u7528\u89d2\u8272\uff08\u66f4\u591a\uff09 \u00b6 \u521b\u5efa\u4e00\u4e2a\u540d\u4e3a sample-apache \u7684\u89d2\u8272\u5e76\u5c06\u5176\u5b58\u50a8\u5728\u4e2d /home/automation/plays/roles \u3002\u8be5\u89d2\u8272\u5e94\u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42\uff1a \u8be5 httpd\u7684 \uff0c mod_ssl \u548c PHP \u7684\u8f6f\u4ef6\u5305\u3002Apache\u670d\u52a1\u6b63\u5728\u8fd0\u884c\u5e76\u5728\u542f\u52a8\u65f6\u542f\u7528\u3002 \u9632\u706b\u5899\u914d\u7f6e\u4e3a\u5141\u8bb8HTTP\u7aef\u53e3TCP 80\u548cHTTPS\u7aef\u53e3TCP 443\u4e0a\u7684\u6240\u6709\u4f20\u5165\u6d41\u91cf\u3002 \u6bcf\u6b21 /var/www/html/index.html \u4fee\u6539\u6587\u4ef6\u65f6\uff0c\u90fd\u5e94\u91cd\u65b0\u542f\u52a8Apache\u670d\u52a1\u3002 Jinja2\u6a21\u677f\u6587\u4ef6 index.html.j2 \u7528\u4e8e\u521b\u5efa /var/www/html/index.html \u5177\u6709\u4ee5\u4e0b\u5185\u5bb9\u7684\u6587\u4ef6\uff1a The address of the server is: IPV4ADDRESS IPV4ADDRESS\u662f\u53d7\u7ba1\u8282\u70b9\u7684IP\u5730\u5740\u3002 \u521b\u5efa /home/automation/plays/apache.yml \u4f7f\u7528\u8be5\u89d2\u8272\u5e76\u5728 webservers \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\u3002 \u4efb\u52a111\uff1a\u4eceAnsible Galaxy\u4e0b\u8f7d\u89d2\u8272\u5e76\u4f7f\u7528\u5b83\u4eec \u00b6 \u4f7f\u7528Ansible Galaxy\u4e0b\u8f7d\u5e76\u5b89\u88c5 geerlingguy.haproxy \u89d2\u8272 /home/automation/plays/roles \u3002 \u521b\u5efa\u4e00\u4e2a /home/automation/plays/haproxy.yml \u5728 \u4ee3\u7406 \u4e3b\u673a\u7ec4\u4e2d\u7684 \u670d\u52a1\u5668 \u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u4f7f\u7528geerlingguy.haproxy\u89d2\u8272\u5728 Webservers \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e4b\u95f4\u8d1f\u8f7d\u5747\u8861\u8bf7\u6c42\u3002 \u4f7f\u7528 \u8f6e\u8be2 \u8d1f\u8f7d\u5747\u8861\u65b9\u6cd5\u3002 HAProxy\u540e\u7aef\u670d\u52a1\u5668\u5e94\u4ec5\u914d\u7f6e\u4e3a\u4f7f\u7528HTTP\uff08\u7aef\u53e380\uff09\u3002 \u9632\u706b\u5899\u914d\u7f6e\u4e3a\u5141\u8bb8\u7aef\u53e380\u4e0a\u7684\u6240\u6709\u4f20\u5165\u6d41\u91cf\u3002 \u5982\u679c\u60a8\u7684\u5267\u672c\u6709\u6548\uff0c\u5219\u6267\u884c\u201c curl http://ansible2.hl.local/ \u201d\u5e94\u4eceWeb\u670d\u52a1\u5668\u8fd4\u56de\u8f93\u51fa\uff08\u8bf7\u53c2\u9605\u4efb\u52a1\uff0310\uff09\u3002\u518d\u6b21\u8fd0\u884c\u8be5\u547d\u4ee4\u5e94\u8fd4\u56de\u5176\u4ed6Web\u670d\u52a1\u5668\u7684\u8f93\u51fa\u3002 \u4efb\u52a112\uff1a\u5b89\u5168\u6027 \u00b6 \u521b\u5efa\u4e00\u4e2a /home/automation/plays/selinux.yml \u5728 webservers \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u4f7f\u7528selinux RHEL\u7cfb\u7edf\u89d2\u8272 \u3002 \u542f\u7528 httpd_can_network_connect SELinux\u5e03\u5c14\u503c\u3002 \u66f4\u6539\u5fc5\u987b\u5728\u7cfb\u7edf\u91cd\u65b0\u5f15\u5bfc\u540e\u7ee7\u7eed\u6709\u6548\u3002 \u4efb\u52a113\uff1a\u4f7f\u7528\u6761\u4ef6\u63a7\u5236\u64ad\u653e\u6267\u884c \u00b6 \u521b\u5efa\u4e00\u4e2a /home/automation/plays/sysctl.yml \u5728\u6240\u6709\u6e05\u5355\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u5982\u679c\u670d\u52a1\u5668\u5177\u6709\u8d85\u8fc72048MB\u7684RAM\uff0c\u5219\u53c2\u6570 vm.swappiness \u8bbe\u7f6e\u4e3a10\u3002 \u5982\u679c\u670d\u52a1\u5668\u7684RAM\u5c11\u4e8e2048MB\uff0c\u5219\u4f1a\u663e\u793a\u4ee5\u4e0b\u9519\u8bef\u6d88\u606f\uff1a \u670d\u52a1\u5668\u5185\u5b58\u5c0f\u4e8e2048MB \u4efb\u52a114\uff1a\u4f7f\u7528\u5b58\u6863 \u00b6 \u521b\u5efa\u4e00\u4e2a /home/automation/plays/archive.yml \u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a /mnt/mysql_backups/database_list.txt \u521b\u5efa\u7684\u6587\u4ef6\u5305\u542b\u4ee5\u4e0b\u884c\uff1adev\uff0ctest\uff0cqa\uff0cprod\u3002 \u8be5\u6587\u4ef6\u7684gzip\u5b58\u6863 /mnt/mysql_backups/database_list.txt \u5df2\u521b\u5efa\u5e76\u5b58\u50a8\u5728\u4e2d /mnt/mysql_backups/archive.gz \u3002 \u4efb\u52a115\uff1a\u5904\u7406\u4e8b\u5b9e \u00b6 \u521b\u5efa\u4e00\u4e2a /home/automation/plays/facts.yml \u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u521b\u5efa\u4e86\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684Ansible\u4e8b\u5b9e server_role = mysql \uff0c\u53ef\u4ee5\u5728\u4f7f\u7528Ansible\u8bbe\u7f6e\u6a21\u5757\u65f6\u4ece ** ansible_local.custom.sample_exam** \u4e2d\u68c0\u7d22\u8be5\u4e8b\u5b9e\u3002 \u4efb\u52a116\uff1a\u8f6f\u4ef6\u5305 \u00b6 \u521b\u5efa\u4e00\u4e2a /home/automation/plays/packages.yml \u5728\u6240\u6709\u6e05\u5355\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u5728 \u4ee3\u7406 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u5b89\u88c5 tcpdump \u548c mailx \u8f6f\u4ef6\u5305\u3002 \u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u5b89\u88c5 lsof \u548c mailx \u4ee5\u53ca\u7a0b\u5e8f\u5305\u3002 \u4efb\u52a117\uff1a\u670d\u52a1 \u00b6 \u521b\u5efa\u4e00\u4e2a /home/automation/plays/target.yml \u5728 webservers \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u5c06\u9ed8\u8ba4\u542f\u52a8\u76ee\u6807\u8bbe\u7f6e\u4e3a multi-user \u3002 \u4efb\u52a118\uff1a\u521b\u5efa\u548c\u4f7f\u7528\u6a21\u677f\u6765\u521b\u5efa\u5b9a\u5236\u7684\u914d\u7f6e\u6587\u4ef6 \u00b6 \u521b\u5efa\u4e00\u4e2a /home/automation/plays/server_list.yml \u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\u7684\u5267\u672c\uff1a Playbook\u4f7f\u7528Jinja2\u6a21\u677f\u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a server_list.j2 \u521b\u5efa\u6587\u4ef6\u3002 /etc/server_list.txt \u8be5\u6587\u4ef6 /etc/server_list.txt \u5f52 \u81ea\u52a8\u5316 \u7528\u6237\u6240\u6709\u3002 \u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 0600 \u3002 SELinux\u6587\u4ef6\u6807\u7b7e\u5e94\u8bbe\u7f6e\u4e3a net_conf_t \u3002 \u8be5\u6587\u4ef6\u7684\u5185\u5bb9\u662f\u6240\u6709\u6e05\u5355\u4e3b\u673a\u7684FQDN\u7684\u5217\u8868\u3002 \u8fd0\u884c\u5267\u672c\u540e\uff0c\u6587\u4ef6\u5185\u5bb9 /etc/server_list.txt \u5e94\u4e3a\u4ee5\u4e0b\u5185\u5bb9\uff1a ansible2.hl.local ansible3.hl.local ansible4.hl.local ansible5.hl.local \u6ce8\u610f\uff1a\u5982\u679c\u4efb\u4f55\u6e05\u5355\u4e3b\u673a\u7684FQDN\u53d1\u751f\u53d8\u5316\uff0c\u5219\u91cd\u65b0\u8fd0\u884c\u5267\u672c\u5e94\u4f7f\u7528\u65b0\u503c\u66f4\u65b0\u6587\u4ef6\u3002 \u6765\u6e90\uff1a https://www.lisenet.com/2019/ansible-sample-exam-for-ex407/","title":"EX407 \u793a\u4f8b\u8bd5\u9898"},{"location":"certification/ex407-example/#ex407-ex294-ansible","text":"\u8fd9\u662f\u6211\u4e3a\u51c6\u5907EX407\u800c\u521b\u5efa\u7684Ansible\u6837\u672c\u8003\u8bd5\u3002\u6211\u5c1a\u672a\u53c2\u52a0EX407\u8003\u8bd5\u3002 \u60a8\u4e5f\u53ef\u4ee5\u5c06\u5176\u7528\u4e8e\u65b0\u7684RHCE 8\u8003\u8bd5EX294\u3002 \u4e0e\u771f\u5b9e\u8003\u8bd5\u4e00\u6837\uff0c\u5c06\u4e0d\u63d0\u4f9b\u6837\u672c\u8003\u8bd5\u95ee\u9898\u7684\u7b54\u6848\u3002","title":"\u9002\u7528\u4e8e EX407 / EX294 \u7684Ansible\u793a\u4f8b\u8003\u8bd5"},{"location":"certification/ex407-example/#_1","text":"\u603b\u5171\u670918\u4e2a\u95ee\u9898\u3002 \u60a8\u5c06\u9700\u8981\u4e94\u4e2aRHEL 7\uff08\u6216CentOS 7\uff09\u865a\u62df\u673a\u624d\u80fd\u6210\u529f\u5b8c\u6210\u6240\u6709\u95ee\u9898\u3002 \u4e00\u53f0VM\u5c06\u914d\u7f6e\u4e3aAnsible\u63a7\u5236\u8282\u70b9\u3002\u5176\u4ed6\u56db\u4e2aVM\u5c06\u7528\u4e8e\u5e94\u7528\u5267\u672c\u6765\u89e3\u51b3\u793a\u4f8b\u8003\u8bd5\u95ee\u9898\u3002\u5728\u6574\u4e2a\u6837\u672c\u8003\u8bd5\u4e2d\u5c06\u4f7f\u7528\u4ee5\u4e0bFQDN\u3002 ansible-control.hl.local \u2013 Ansible\u63a7\u5236\u8282\u70b9 ansible2.hl.local \u2013\u6258\u7ba1\u4e3b\u673a ansible3.hl.local \u2013\u6258\u7ba1\u4e3b\u673a ansible4.hl.local \u2013\u6258\u7ba1\u4e3b\u673a ansible5.hl.local \u2013\u6258\u7ba1\u4e3b\u673a \u5728\u7ee7\u7eed\u8fdb\u884c\u64cd\u4f5c\u4e4b\u524d\uff0c\u9700\u8981\u6ee1\u8db3\u51e0\u4e2a\u8981\u6c42\uff1a ansible-control.hl.local \u670d\u52a1\u5668\u5177\u6709\u5bf9\u6240\u6709\u53d7\u7ba1\u670d\u52a1\u5668\u7684\u65e0\u5bc6\u7801SSH\u8bbf\u95ee\uff08\u4f7f\u7528root\u7528\u6237\uff09\u3002 ansible5.hl.local \u670d\u52a1\u5668\u5df2 /dev/sdb \u8fde\u63a51GB\u8f85\u52a9\u78c1\u76d8\u3002 \u5728\u4efb\u4f55\u670d\u52a1\u5668\u4e0a\u90fd\u6ca1\u6709\u521b\u5efa\u666e\u901a\u7528\u6237\u3002","title":"\u8981\u6c42"},{"location":"certification/ex407-example/#_2","text":"\u6211\u8bd5\u56fe\u6db5\u76d6\u5c3d\u53ef\u80fd\u591a\u7684\u8003\u8bd5\u76ee\u6807\uff0c\u4f46\u662f\u8bf7\u6ce8\u610f\uff0c\u4e0d\u4f1a\u51fa\u73b0\u4e0e\u52a8\u6001\u6e05\u5355\u6709\u5173\u7684\u95ee\u9898\u3002 \u6709\u4e9b\u95ee\u9898\u53ef\u80fd\u53d6\u51b3\u4e8e\u5176\u4ed6\u95ee\u9898\u7684\u7ed3\u679c\u3002\u8bf7\u5148\u9605\u8bfb\u6240\u6709\u95ee\u9898\uff0c\u7136\u540e\u518d\u7ee7\u7eed\u3002 \u8bf7\u6ce8\u610f\uff0c\u6837\u672c\u8003\u8bd5\u7684\u76ee\u7684\u662f\u6d4b\u8bd5\u60a8\u7684\u6280\u80fd\u3002\u8bf7\u4e0d\u8981\u5728\u8bc4\u8bba\u90e8\u5206\u53d1\u5e03\u60a8\u7684\u5267\u672c\u3002","title":"\u63d0\u793a\u4e0e\u5efa\u8bae"},{"location":"certification/ex407-example/#_3","text":"\u6ce8\u610f\uff1a\u60a8\u5177\u6709\u5bf9\u6240\u6709\u4e94\u53f0\u670d\u52a1\u5668\u7684\u8d85\u7ea7\u7528\u6237\u8bbf\u95ee\u6743\u9650\u3002","title":"\u8003\u8bd5\u6837\u9898"},{"location":"certification/ex407-example/#1ansible","text":"\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u5b89\u88c5ansible\u8f6f\u4ef6\u5305\uff08\u5305\u62ec\u6240\u6709\u4f9d\u8d56\u9879\uff09\u5e76\u914d\u7f6e\u4ee5\u4e0b\u5185\u5bb9\uff1a \u4f7f\u7528 devops \u5bc6\u7801\u521b\u5efa\u5e38\u89c4\u7684\u7528\u6237 \u81ea\u52a8\u5316 \u3002\u9664\u975e\u60a8\u6b63\u5728\u6267\u884c\u9700\u8981\u5728\u6e05\u5355\u4e3b\u673a\u4e0a\u521b\u5efa \u81ea\u52a8\u5316 \u7528\u6237\u7684\u4efb\u52a1\uff032\uff0c\u5426\u5219\u8bf7\u5c06\u8be5\u7528\u6237\u7528\u4e8e\u6240\u6709\u793a\u4f8b\u8003\u8bd5\u4efb\u52a1\u548c\u7ec3\u4e60\u7c3f\u3002\u60a8\u5177\u6709\u5bf9\u6240\u6709\u4e94\u53f0\u670d\u52a1\u5668\u7684\u8d85\u7ea7\u7528\u6237\u8bbf\u95ee\u6743\u9650\u3002 \u60a8\u4e3a\u6b64\u793a\u4f8b\u8003\u8bd5\u521b\u5efa\u7684\u6240\u6709\u5267\u672c\u548c\u5176\u4ed6Ansible\u914d\u7f6e\u90fd\u5e94\u5b58\u50a8\u5728\u4e2d /home/automation/plays \u3002 \u521b\u5efa /home/automation/plays/ansible.cfg \u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42\u7684\u914d\u7f6e\u6587\u4ef6\uff1a \u89d2\u8272\u8def\u5f84\u5e94\u5305\u62ec /home/automation/plays/roles \uff0c\u4ee5\u53ca\u793a\u4f8b\u8003\u8bd5\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u9700\u8981\u7684\u4efb\u4f55\u5176\u4ed6\u8def\u5f84\u3002 \u5e93\u5b58\u6587\u4ef6\u8def\u5f84\u4e3a /home/automation/plays/inventory \u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7279\u6743\u5347\u7ea7\u662f \u7981\u7528 \u7684\u3002 Ansible\u5e94\u8be5\u80fd\u591f\u4e00\u6b21\u7ba1\u7406 10\u4e2a\u4e3b\u673a \u3002 Ansible\u5e94\u8be5\u4f7f\u7528 \u81ea\u52a8\u5316 \u7528\u6237\u8fde\u63a5\u5230\u6240\u6709\u53d7\u7ba1\u8282\u70b9\u3002 /home/automation/plays/inventory \u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efa\u6e05\u5355\u6587\u4ef6\uff1a ansible2.hl.local\u662f \u4ee3\u7406 \u4e3b\u673a\u7ec4\u7684\u6210\u5458\u3002 ansible3.hl.local\u662f Webservers \u4e3b\u673a\u7ec4\u7684\u6210\u5458\u3002 ansible4.hl.local\u662f Webservers \u4e3b\u673a\u7ec4\u7684\u6210\u5458\u3002 ansible5.hl.local\u662f \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u7684\u6210\u5458\u3002","title":"\u4efb\u52a11\uff1aAnsible\u5b89\u88c5\u548c\u914d\u7f6e"},{"location":"certification/ex407-example/#2","text":"\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u751f\u6210SSH\u5bc6\u94a5\u5bf9\u3002\u60a8\u53ef\u4ee5\u624b\u52a8\u6267\u884c\u6b64\u6b65\u9aa4\u3002 \u7f16\u5199\u4e00\u4e2a /home/automation/plays/adhoc \u4f7f\u7528Ansible ad-hoc\u547d\u4ee4\u6765\u5b9e\u73b0\u4ee5\u4e0b\u76ee\u7684\u7684\u811a\u672c\uff1a \u5728\u6240\u6709\u6e05\u5355\u4e3b\u673a\uff08\u4e0d\u662f\u63a7\u5236\u8282\u70b9\uff09\u4e0a\u521b\u5efa\u7528\u6237 \u81ea\u52a8\u5316 \u3002 SSH\u5bc6\u94a5\uff08\u60a8\u751f\u6210\u7684\uff09\u5df2\u590d\u5236\u5230 \u81ea\u52a8\u5316 \u7528\u6237\u7684\u6240\u6709\u6e05\u5355\u4e3b\u673a\u4e2d\uff0c\u5e76\u5b58\u50a8\u5728\u4e2d /home/automation/.ssh/authorized_keys \u3002 \u8be5 \u81ea\u52a8\u5316 \u5141\u8bb8\u7528\u6237\u63d0\u5347\u5bf9\u6240\u6709\u5e93\u5b58\u7684\u4e3b\u673a\u6743\u9650\uff0c\u800c\u65e0\u9700\u63d0\u4f9b\u5bc6\u7801\u3002 \u8fd0\u884cadhoc\u811a\u672c\u540e\uff0c\u60a8\u5e94\u8be5\u80fd\u591f\u4f7f\u7528\u6ca1\u6709\u5bc6\u7801\u7684 \u81ea\u52a8\u5316 \u7528\u6237SSH\u8fdb\u5165\u6240\u6709\u6e05\u5355\u4e3b\u673a\uff0c\u4ee5\u53ca\u8fd0\u884c\u6240\u6709\u7279\u6743\u547d\u4ee4\u3002","title":"\u4efb\u52a12\uff1a\u4e34\u65f6\u547d\u4ee4"},{"location":"certification/ex407-example/#3","text":"\u521b\u5efa\u4e00\u4e2a /home/automation/plays/motd.yml \u5728\u6240\u6709\u6e05\u5355\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u8be5\u5267\u672c\u5e94\u5c06\u6240\u6709\u73b0\u6709\u5185\u5bb9\u66ff\u6362\u4e3a /etc/motd \u6587\u5b57\u3002\u6587\u672c\u53d6\u51b3\u4e8e\u4e3b\u673a\u7ec4\u3002 \u5728 \u4ee3\u7406 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\uff0c\u8be5\u884c\u5e94\u4e3a\u201c Welcome to HAProxy server\u201d\u3002 \u5728 Web\u670d\u52a1\u5668 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\uff0c\u8be5\u884c\u5e94\u4e3a\u201c Welcome to Apache server\u201d\u3002 \u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\uff0c\u8be5\u884c\u5e94\u4e3a\u201c Welcome to MySQL server\u201d\u3002","title":"\u4efb\u52a13\uff1a\u6587\u4ef6\u5185\u5bb9"},{"location":"certification/ex407-example/#4ssh","text":"\u521b\u5efa\u4e00\u4e2a /home/automation/plays/sshd.yml \u5728\u6240\u6709\u6e05\u5355\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6309\u5982\u4e0b\u65b9\u5f0f\u914d\u7f6eSSHD\u5b88\u62a4\u7a0b\u5e8f\uff1a \u6807\u8bed\u8bbe\u7f6e\u4e3a /etc/motd X11\u8f6c\u53d1\u7981\u7528 MaxAuthTries\u8bbe\u7f6e\u4e3a3","title":"\u4efb\u52a14\uff1a\u914d\u7f6eSSH\u670d\u52a1\u5668"},{"location":"certification/ex407-example/#5ansible","text":"\u521b\u5efaAnsible\u5e93\u6587\u4ef6 /home/automation/plays/secret.yml \u3002\u52a0\u5bc6/\u89e3\u5bc6\u5bc6\u7801\u4e3a devops \u3002 \u5c06\u4ee5\u4e0b\u53d8\u91cf\u6dfb\u52a0\u5230Vault\uff1a user_password \u7684\u503c\u4e3a ** devops** database_password \u4e0e\u4ef7\u503c ** DEVOPS** \u5c06Ansible\u4fdd\u7ba1\u5e93\u5bc6\u7801\u5b58\u50a8\u5728\u6587\u4ef6\u4e2d /home/automation/plays/vault_key \u3002","title":"\u4efb\u52a15\uff1aAnsible\u4fdd\u7ba1\u7bb1"},{"location":"certification/ex407-example/#6","text":"\u5df2\u4e3a\u60a8\u63d0\u4f9b\u4ee5\u4e0b\u7528\u6237\u5217\u8868\u3002 \u4f7f\u7528 /home/automation/plays/vars/user_list.yml \u6587\u4ef6\u4fdd\u5b58\u6b64\u5185\u5bb9\u3002 --- users: - username: alice uid: 1201 - username: vincent uid: 1202 - username: sandy uid: 2201 - username: patrick uid: 2202 \u521b\u5efa /home/automation/plays/users.yml \u4f7f\u7528\u5e93\u6587\u4ef6 /home/automation/plays/secret.yml \u5b9e\u73b0\u4ee5\u4e0b\u76ee\u7684\u7684\u5267\u672c\uff1a \u7528\u6237ID\u4ee51\u5f00\u5934\u7684\u7528\u6237\u5e94\u5728 webservers \u4e3b\u673a\u7ec4\u4e2d\u7684 \u670d\u52a1\u5668 \u4e0a\u521b\u5efa\u3002\u7528\u6237\u5bc6\u7801\u5e94\u901a\u8fc7 user_password \u53d8\u91cf\u4f7f\u7528\u3002 \u5e94\u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u670d\u52a1\u5668\u4e0a\u521b\u5efa\u7528\u6237ID\u4ee52\u5f00\u5934\u7684\u7528\u6237\u3002\u7528\u6237\u5bc6\u7801\u5e94\u901a\u8fc7 user_password \u53d8\u91cf\u4f7f\u7528\u3002 \u6240\u6709\u7528\u6237\u90fd\u5e94\u8be5\u662f\u8f85\u52a9\u7ec4 \u8f6e\u7684 \u6210\u5458\u3002 \u5e94\u8be5 /bin/bash \u4e3a\u6240\u6709\u7528\u6237\u8bbe\u7f6eShell \u3002 \u5e10\u6237\u5bc6\u7801\u5e94\u4f7f\u7528SHA512\u54c8\u5e0c\u683c\u5f0f\u3002 \u6bcf\u4e2a\u7528\u6237\u90fd\u5e94\u8be5\u4e0a\u4f20\u4e00\u4e2aSSH\u5bc6\u94a5\uff08\u4f7f\u7528\u5148\u524d\u521b\u5efa\u7684SSH\u5bc6\u94a5\uff0c\u8bf7\u53c2\u9605\u4efb\u52a1\uff032\uff09\u3002 \u8fd0\u884c\u5267\u672c\u540e\uff0c\u7528\u6237\u5e94\u8be5\u53ef\u4ee5\u65e0\u9700\u5bc6\u7801\u5373\u53ef\u901a\u8fc7SSH\u8fdb\u5165\u5404\u81ea\u7684\u670d\u52a1\u5668\u3002","title":"\u4efb\u52a16\uff1a\u7528\u6237\u548c\u7ec4"},{"location":"certification/ex407-example/#7","text":"\u521b\u5efa\u4e00\u4e2a /home/automation/plays/regular_tasks.yml \u5728 \u4ee3\u7406 \u4e3b\u673a\u7ec4\u4e2d\u7684 \u670d\u52a1\u5668 \u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u5c06\u521b\u5efa\u4e00\u4e2a\u6839crontab\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u6bcf\u5c0f\u65f6\u8fd0\u884c\u4e00\u6b21\u3002 cron\u4f5c\u4e1a\u5c06\u6587\u4ef6\u9644\u52a0 date \u547d\u4ee4 /var/log/time.log \u7684\u8f93\u51fa\u3002","title":"\u4efb\u52a17\uff1a\u8ba1\u5212\u4efb\u52a1"},{"location":"certification/ex407-example/#8","text":"\u521b\u5efa\u4e00\u4e2a /home/automation/plays/repository.yml \u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u521b\u5efa\u4e00\u4e2aYUM\u5b58\u50a8\u5e93\u6587\u4ef6\u3002 \u5b58\u50a8\u5e93\u7684\u540d\u79f0\u662f mysql56-community \u3002 \u4ed3\u5e93\u7684\u63cf\u8ff0\u662f\u201c MySQL 5.6 YUM Repo\u201d\u3002 \u4ed3\u5e93\u7684\u57fa\u672cURL\u662f http://repo.mysql.com/yum/mysql-5.6-community/el/7/x86_64/ \u3002 \u4ed3\u5e93GPG\u5bc6\u94a5\u4f4d\u4e8e http://repo.mysql.com/RPM-GPG-KEY-mysql \u3002 \u50a8\u5b58\u5e93GPG\u68c0\u67e5\u5df2\u542f\u7528\u3002 \u5b58\u50a8\u5e93\u5df2\u542f\u7528\u3002","title":"\u4efb\u52a18\uff1a\u8f6f\u4ef6\u5b58\u50a8\u5e93"},{"location":"certification/ex407-example/#9","text":"\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a sample-mysql \u7684\u89d2\u8272\u5e76\u5c06\u5176\u5b58\u50a8\u5728\u4e2d /home/automation/plays/roles \u3002\u8be5\u89d2\u8272\u5e94\u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42\uff1a \u5728\u8bbe\u5907 /dev/sdb \u4e0a\u521b\u5efa\u5927\u5c0f\u4e3a800MB\u7684\u4e3b\u5206\u533a\u53f71 \u3002 vg_database \u521b\u5efa\u4e00\u4e2a\u540d\u4e3aLVM\u7684\u5377\u7ec4\uff0c\u8be5\u5377\u7ec4\u4f7f\u7528\u4e0a\u9762\u521b\u5efa\u7684\u4e3b\u5206\u533a\u3002 lv_mysql \u5728\u5377\u7ec4\u4e2d\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u4e3a512MB \u7684LVM\u903b\u8f91\u5377 vg_database \u3002 \u5728\u903b\u8f91\u5377 lv_mysql \u4e0a\u521b\u5efa\u4e86\u4e00\u4e2aXFS\u6587\u4ef6\u7cfb\u7edf\u3002 \u903b\u8f91\u5377 lv_mysql \u5df2\u6c38\u4e45\u5b89\u88c5\u5728\u4e0a /mnt/mysql_backups \u3002 mysql-community-server \u8f6f\u4ef6\u5305\u5df2\u5b89\u88c5\u3002 \u9632\u706b\u5899\u914d\u7f6e\u4e3a\u5141\u8bb8MySQL\u7aef\u53e3TCP 3306\u4e0a\u7684\u6240\u6709\u4f20\u5165\u6d41\u91cf\u3002 MySQL\u6839\u7528\u6237\u5bc6\u7801\u5e94\u4ece\u53d8\u91cf database_password \u8bbe\u7f6e\uff08\u8bf7\u53c2\u9605\u4efb\u52a1\uff035\uff09\u3002 MySQL\u670d\u52a1\u5668\u5e94\u5df2\u542f\u52a8\u5e76\u5728\u542f\u52a8\u65f6\u542f\u7528\u3002 MySQL\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u662f\u4ece my.cnf.j2 Jinja2\u6a21\u677f\u751f\u6210\u7684\uff0c\u5177\u6709\u4ee5\u4e0b\u5185\u5bb9\uff1a [mysqld] bind_address = {{ ansible_default_ipv4.address }} skip_name_resolve datadir=/var/lib/mysql socket=/var/lib/mysql/mysql.sock symbolic-links=0 sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES [mysqld_safe] log-error=/var/log/mysqld.log pid-file=/var/run/mysqld/mysqld.pid \u521b\u5efa /home/automation/plays/mysql.yml \u4f7f\u7528\u8be5\u89d2\u8272\u5e76\u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\u3002","title":"\u4efb\u52a19\uff1a\u521b\u5efa\u548c\u4f7f\u7528\u89d2\u8272"},{"location":"certification/ex407-example/#10","text":"\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a sample-apache \u7684\u89d2\u8272\u5e76\u5c06\u5176\u5b58\u50a8\u5728\u4e2d /home/automation/plays/roles \u3002\u8be5\u89d2\u8272\u5e94\u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42\uff1a \u8be5 httpd\u7684 \uff0c mod_ssl \u548c PHP \u7684\u8f6f\u4ef6\u5305\u3002Apache\u670d\u52a1\u6b63\u5728\u8fd0\u884c\u5e76\u5728\u542f\u52a8\u65f6\u542f\u7528\u3002 \u9632\u706b\u5899\u914d\u7f6e\u4e3a\u5141\u8bb8HTTP\u7aef\u53e3TCP 80\u548cHTTPS\u7aef\u53e3TCP 443\u4e0a\u7684\u6240\u6709\u4f20\u5165\u6d41\u91cf\u3002 \u6bcf\u6b21 /var/www/html/index.html \u4fee\u6539\u6587\u4ef6\u65f6\uff0c\u90fd\u5e94\u91cd\u65b0\u542f\u52a8Apache\u670d\u52a1\u3002 Jinja2\u6a21\u677f\u6587\u4ef6 index.html.j2 \u7528\u4e8e\u521b\u5efa /var/www/html/index.html \u5177\u6709\u4ee5\u4e0b\u5185\u5bb9\u7684\u6587\u4ef6\uff1a The address of the server is: IPV4ADDRESS IPV4ADDRESS\u662f\u53d7\u7ba1\u8282\u70b9\u7684IP\u5730\u5740\u3002 \u521b\u5efa /home/automation/plays/apache.yml \u4f7f\u7528\u8be5\u89d2\u8272\u5e76\u5728 webservers \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\u3002","title":"\u4efb\u52a110\uff1a\u521b\u5efa\u548c\u4f7f\u7528\u89d2\u8272\uff08\u66f4\u591a\uff09"},{"location":"certification/ex407-example/#11ansible-galaxy","text":"\u4f7f\u7528Ansible Galaxy\u4e0b\u8f7d\u5e76\u5b89\u88c5 geerlingguy.haproxy \u89d2\u8272 /home/automation/plays/roles \u3002 \u521b\u5efa\u4e00\u4e2a /home/automation/plays/haproxy.yml \u5728 \u4ee3\u7406 \u4e3b\u673a\u7ec4\u4e2d\u7684 \u670d\u52a1\u5668 \u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u4f7f\u7528geerlingguy.haproxy\u89d2\u8272\u5728 Webservers \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e4b\u95f4\u8d1f\u8f7d\u5747\u8861\u8bf7\u6c42\u3002 \u4f7f\u7528 \u8f6e\u8be2 \u8d1f\u8f7d\u5747\u8861\u65b9\u6cd5\u3002 HAProxy\u540e\u7aef\u670d\u52a1\u5668\u5e94\u4ec5\u914d\u7f6e\u4e3a\u4f7f\u7528HTTP\uff08\u7aef\u53e380\uff09\u3002 \u9632\u706b\u5899\u914d\u7f6e\u4e3a\u5141\u8bb8\u7aef\u53e380\u4e0a\u7684\u6240\u6709\u4f20\u5165\u6d41\u91cf\u3002 \u5982\u679c\u60a8\u7684\u5267\u672c\u6709\u6548\uff0c\u5219\u6267\u884c\u201c curl http://ansible2.hl.local/ \u201d\u5e94\u4eceWeb\u670d\u52a1\u5668\u8fd4\u56de\u8f93\u51fa\uff08\u8bf7\u53c2\u9605\u4efb\u52a1\uff0310\uff09\u3002\u518d\u6b21\u8fd0\u884c\u8be5\u547d\u4ee4\u5e94\u8fd4\u56de\u5176\u4ed6Web\u670d\u52a1\u5668\u7684\u8f93\u51fa\u3002","title":"\u4efb\u52a111\uff1a\u4eceAnsible Galaxy\u4e0b\u8f7d\u89d2\u8272\u5e76\u4f7f\u7528\u5b83\u4eec"},{"location":"certification/ex407-example/#12","text":"\u521b\u5efa\u4e00\u4e2a /home/automation/plays/selinux.yml \u5728 webservers \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u4f7f\u7528selinux RHEL\u7cfb\u7edf\u89d2\u8272 \u3002 \u542f\u7528 httpd_can_network_connect SELinux\u5e03\u5c14\u503c\u3002 \u66f4\u6539\u5fc5\u987b\u5728\u7cfb\u7edf\u91cd\u65b0\u5f15\u5bfc\u540e\u7ee7\u7eed\u6709\u6548\u3002","title":"\u4efb\u52a112\uff1a\u5b89\u5168\u6027"},{"location":"certification/ex407-example/#13","text":"\u521b\u5efa\u4e00\u4e2a /home/automation/plays/sysctl.yml \u5728\u6240\u6709\u6e05\u5355\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u5982\u679c\u670d\u52a1\u5668\u5177\u6709\u8d85\u8fc72048MB\u7684RAM\uff0c\u5219\u53c2\u6570 vm.swappiness \u8bbe\u7f6e\u4e3a10\u3002 \u5982\u679c\u670d\u52a1\u5668\u7684RAM\u5c11\u4e8e2048MB\uff0c\u5219\u4f1a\u663e\u793a\u4ee5\u4e0b\u9519\u8bef\u6d88\u606f\uff1a \u670d\u52a1\u5668\u5185\u5b58\u5c0f\u4e8e2048MB","title":"\u4efb\u52a113\uff1a\u4f7f\u7528\u6761\u4ef6\u63a7\u5236\u64ad\u653e\u6267\u884c"},{"location":"certification/ex407-example/#14","text":"\u521b\u5efa\u4e00\u4e2a /home/automation/plays/archive.yml \u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a /mnt/mysql_backups/database_list.txt \u521b\u5efa\u7684\u6587\u4ef6\u5305\u542b\u4ee5\u4e0b\u884c\uff1adev\uff0ctest\uff0cqa\uff0cprod\u3002 \u8be5\u6587\u4ef6\u7684gzip\u5b58\u6863 /mnt/mysql_backups/database_list.txt \u5df2\u521b\u5efa\u5e76\u5b58\u50a8\u5728\u4e2d /mnt/mysql_backups/archive.gz \u3002","title":"\u4efb\u52a114\uff1a\u4f7f\u7528\u5b58\u6863"},{"location":"certification/ex407-example/#15","text":"\u521b\u5efa\u4e00\u4e2a /home/automation/plays/facts.yml \u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u521b\u5efa\u4e86\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684Ansible\u4e8b\u5b9e server_role = mysql \uff0c\u53ef\u4ee5\u5728\u4f7f\u7528Ansible\u8bbe\u7f6e\u6a21\u5757\u65f6\u4ece ** ansible_local.custom.sample_exam** \u4e2d\u68c0\u7d22\u8be5\u4e8b\u5b9e\u3002","title":"\u4efb\u52a115\uff1a\u5904\u7406\u4e8b\u5b9e"},{"location":"certification/ex407-example/#16","text":"\u521b\u5efa\u4e00\u4e2a /home/automation/plays/packages.yml \u5728\u6240\u6709\u6e05\u5355\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u5728 \u4ee3\u7406 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u5b89\u88c5 tcpdump \u548c mailx \u8f6f\u4ef6\u5305\u3002 \u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u5b89\u88c5 lsof \u548c mailx \u4ee5\u53ca\u7a0b\u5e8f\u5305\u3002","title":"\u4efb\u52a116\uff1a\u8f6f\u4ef6\u5305"},{"location":"certification/ex407-example/#17","text":"\u521b\u5efa\u4e00\u4e2a /home/automation/plays/target.yml \u5728 webservers \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u5267\u672c\uff0c\u5e76\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u5c06\u9ed8\u8ba4\u542f\u52a8\u76ee\u6807\u8bbe\u7f6e\u4e3a multi-user \u3002","title":"\u4efb\u52a117\uff1a\u670d\u52a1"},{"location":"certification/ex407-example/#18","text":"\u521b\u5efa\u4e00\u4e2a /home/automation/plays/server_list.yml \u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\u7684\u5267\u672c\uff1a Playbook\u4f7f\u7528Jinja2\u6a21\u677f\u5728 \u6570\u636e\u5e93 \u4e3b\u673a\u7ec4\u4e2d\u7684\u4e3b\u673a\u4e0a server_list.j2 \u521b\u5efa\u6587\u4ef6\u3002 /etc/server_list.txt \u8be5\u6587\u4ef6 /etc/server_list.txt \u5f52 \u81ea\u52a8\u5316 \u7528\u6237\u6240\u6709\u3002 \u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 0600 \u3002 SELinux\u6587\u4ef6\u6807\u7b7e\u5e94\u8bbe\u7f6e\u4e3a net_conf_t \u3002 \u8be5\u6587\u4ef6\u7684\u5185\u5bb9\u662f\u6240\u6709\u6e05\u5355\u4e3b\u673a\u7684FQDN\u7684\u5217\u8868\u3002 \u8fd0\u884c\u5267\u672c\u540e\uff0c\u6587\u4ef6\u5185\u5bb9 /etc/server_list.txt \u5e94\u4e3a\u4ee5\u4e0b\u5185\u5bb9\uff1a ansible2.hl.local ansible3.hl.local ansible4.hl.local ansible5.hl.local \u6ce8\u610f\uff1a\u5982\u679c\u4efb\u4f55\u6e05\u5355\u4e3b\u673a\u7684FQDN\u53d1\u751f\u53d8\u5316\uff0c\u5219\u91cd\u65b0\u8fd0\u884c\u5267\u672c\u5e94\u4f7f\u7528\u65b0\u503c\u66f4\u65b0\u6587\u4ef6\u3002 \u6765\u6e90\uff1a https://www.lisenet.com/2019/ansible-sample-exam-for-ex407/","title":"\u4efb\u52a118\uff1a\u521b\u5efa\u548c\u4f7f\u7528\u6a21\u677f\u6765\u521b\u5efa\u5b9a\u5236\u7684\u914d\u7f6e\u6587\u4ef6"},{"location":"dev/","text":"Ansible \u5f00\u53d1 \u00b6 \u5b98\u65b9\u5f00\u53d1\u6587\u6863 \u00b6 http://docs.ansible.com/ansible/dev_guide/index.html \u975e\u5e38\u63a8\u8350\u5927\u5bb6\u770b\u770b \u5b98\u65b9\u6587\u6863 \u73af\u5883 \u00b6 \u672c\u6b21\u6240\u7528\u7684\u73af\u5883 ansible 2.9.6.0 os Centos 7.7 X64 python 2.7.5 \u4ecb\u7ecd \u00b6 Ansible \u5f00\u53d1\u5206\u4e3a\u4e24\u5927\u6a21\u5757\uff0c\u4e00\u662f modules \uff0c\u4e8c\u662f plugins \u3002 \u9996\u5148\uff0c\u8981\u8bb0\u4f4f\u8fd9\u4e24\u90e8\u5206\u5185\u5bb9\u5728\u54ea\u4e2a\u5730\u65b9\u6267\u884c\uff1f modules \u6587\u4ef6\u88ab\u4f20\u9001\u5230 \u8fdc\u7aef\u4e3b\u673a \u5e76\u6267\u884c\u3002 plugins \u662f\u5728 ansible\u63a7\u5236\u8282\u70b9 \u4e0a\u6267\u884c\u7684\u3002 \u518d\u8005\u662f\u6267\u884c\u987a\u5e8f\uff1f plugins \u5148\u4e8e modules \u6267\u884c\u3002 \u7136\u540e\u5927\u5bb6\u660e\u786e\u8fd9\u4e24\u90e8\u5206\u5185\u5bb9\u662f\u5e72\u5565\u7528\u7684\uff1f modules \u662fansible\u7684\u6838\u5fc3\u5185\u5bb9\uff0c\u5b83\u4f7fplaybook\u53d8\u5f97\u66f4\u52a0\u7b80\u5355\u660e\u4e86\uff0c\u4e00\u4e2atask\u5c31\u662f\u5b8c\u6210\u67d0\u4e00\u9879\u529f\u80fd\u3002ansible\u6a21\u5757\u662f\u88ab\u4f20\u9001\u5230\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u3002\u6240\u4ee5\u5b83\u4eec\u53ef\u4ee5\u7528\u8fdc\u7a0b\u4e3b\u673a\u53ef\u4ee5\u6267\u884c\u7684\u4efb\u4f55\u8bed\u8a00\u7f16\u5199modules\u3002 plugins \u662f\u5728 ansible\u63a7\u5236\u8282\u70b9 \u4e0a\u6267\u884c\u7684\uff0c\u7528\u6765\u8f85\u52a9modules\u505a\u4e00\u4e9b\u64cd\u4f5c\u3002\u6bd4\u5982\u8fde\u63a5\u8fdc\u7a0b\u4e3b\u673a\uff0c\u62f7\u8d1d\u6587\u4ef6\u5230\u8fdc\u7a0b\u4e3b\u673a\u4e4b\u7c7b\u7684\u3002 \u6700\u540e\uff0c\u5b66\u4e60\u5f00\u53d1\u4e4b\u524d\uff0c\u8981\u5148\u5b66\u4f1a Debug Ad-hoc \u6267\u884c\u8fc7\u7a0b \u00b6 # ansible 192.168.77.130 -m ping -vvv ansible 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible python version = 2 .7.5 ( default, Aug 7 2019 , 00 :51:29 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] Using /etc/ansible/ansible.cfg as config file host_list declined parsing /etc/ansible/hosts as it did not pass its verify_file () method script declined parsing /etc/ansible/hosts as it did not pass its verify_file () method auto declined parsing /etc/ansible/hosts as it did not pass its verify_file () method Parsed /etc/ansible/hosts inventory source with ini plugin META: ran handlers < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" 'echo ~root && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '/root\\n' , '' ) < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" '( umask 77 && mkdir -p \"` echo /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356 `\" && echo ansible-tmp-1586615361.42-9030567083356=\"` echo /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356 `\" ) && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , 'ansible-tmp-1586615361.42-9030567083356=/root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356\\n' , '' ) < 192 .168.77.130> Attempting python interpreter discovery < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" 'echo PLATFORM; uname; echo FOUND; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.5' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/libexec/platform-python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python3' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python' \"'\" '\"' \"'\" '\"' \"'\" '; echo ENDFOUND && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , 'PLATFORM\\nLinux\\nFOUND\\n/usr/bin/python\\n/usr/bin/python2.7\\n/usr/libexec/platform-python\\n/usr/bin/python\\nENDFOUND\\n' , '' ) < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '{\"osrelease_content\": \"NAME=\\\\\"CentOS Linux\\\\\"\\\\nVERSION=\\\\\"7 (Core)\\\\\"\\\\nID=\\\\\"centos\\\\\"\\\\nID_LIKE=\\\\\"rhel fedora\\\\\"\\\\nVERSION_ID=\\\\\"7\\\\\"\\\\nPRETTY_NAME=\\\\\"CentOS Linux 7 (Core)\\\\\"\\\\nANSI_COLOR=\\\\\"0;31\\\\\"\\\\nCPE_NAME=\\\\\"cpe:/o:centos:centos:7\\\\\"\\\\nHOME_URL=\\\\\"https://www.centos.org/\\\\\"\\\\nBUG_REPORT_URL=\\\\\"https://bugs.centos.org/\\\\\"\\\\n\\\\nCENTOS_MANTISBT_PROJECT=\\\\\"CentOS-7\\\\\"\\\\nCENTOS_MANTISBT_PROJECT_VERSION=\\\\\"7\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT=\\\\\"centos\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT_VERSION=\\\\\"7\\\\\"\\\\n\\\\n\", \"platform_dist_result\": [\"centos\", \"7.4.1708\", \"Core\"]}\\n' , '' ) Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/ping.py < 192 .168.77.130> PUT /root/.ansible/tmp/ansible-local-50740hJgOb9/tmpp7Dy_u TO /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356/AnsiballZ_ping.py < 192 .168.77.130> SSH: EXEC sshpass -d8 sftp -o BatchMode = no -b - -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 '[192.168.77.130]' < 192 .168.77.130> ( 0 , 'sftp> put /root/.ansible/tmp/ansible-local-50740hJgOb9/tmpp7Dy_u /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356/AnsiballZ_ping.py\\n' , '' ) < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" 'chmod u+x /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356/ /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356/AnsiballZ_ping.py && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '' , '' ) < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 -tt 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356/AnsiballZ_ping.py && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '\\r\\n{\"invocation\": {\"module_args\": {\"data\": \"pong\"}}, \"ping\": \"pong\"}\\r\\n' , 'Shared connection to 192.168.77.130 closed.\\r\\n' ) < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" 'rm -f -r /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356/ > /dev/null 2>&1 && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '' , '' ) 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"invocation\" : { \"module_args\" : { \"data\" : \"pong\" } } , \"ping\" : \"pong\" } META: ran handlers META: ran handlers \u9996\u5148\uff0c\u5c06\u6a21\u5757\u6587\u4ef6\u8bfb\u5165\u5185\u5b58\uff0c\u7136\u540e\u6dfb\u52a0\u4f20\u9012\u7ed9\u6a21\u5757\u7684\u53c2\u6570\uff0c\u6700\u540e\u5c06\u6a21\u5757\u4e2d\u6240\u9700\u8981\u7684\u7c7b\u6dfb\u52a0\u5230\u5185\u5b58\uff0c\u7531zipfile\u538b\u7f29\u540e\uff0c\u518d\u7531base64\u8fdb\u884c\u7f16\u7801\uff0c\u5199\u5165\u5230\u6a21\u7248\u6587\u4ef6\u5185\u3002 \u901a\u8fc7\u9ed8\u8ba4\u7684\u8fde\u63a5\u65b9\u5f0f\uff0c\u4e00\u822c\u662fssh\u3002ansible\u901a\u8fc7ssh\u8fde\u63a5\u5230\u8fdc\u7a0b\u4e3b\u673a\uff0c\u521b\u5efa\u4e34\u65f6\u76ee\u5f55\uff0c\u5e76\u5173\u95ed\u8fde\u63a5\u3002\u7136\u540e\u5c06\u6253\u5f00\u53e6\u5916\u4e00\u4e2assh\u8fde\u63a5\uff0c\u5c06\u6a21\u7248\u6587\u4ef6\u4ee5sftp\u65b9\u5f0f\u4f20\u9001\u5230\u521a\u521a\u521b\u5efa\u7684\u4e34\u65f6\u76ee\u5f55\u4e2d\uff0c\u5199\u5b8c\u540e\u5173\u95ed\u8fde\u63a5\u3002\u7136\u540e\u6253\u5f00\u4e00\u4e2assh\u8fde\u63a5\u5c06\u4efb\u52a1\u5bf9\u8c61\u8d4b\u4e88\u53ef\u6267\u884c\u6743\u9650\uff0c\u6267\u884c\u6210\u529f\u540e\u5173\u95ed\u8fde\u63a5\u3002 \u6700\u540e\uff0cansible\u5c06\u6253\u5f00\u7b2c\u4e09\u4e2a\u8fde\u63a5\u6765\u6267\u884c\u6a21\u5757\uff0c\u5e76\u5220\u9664\u4e34\u65f6\u76ee\u5f55\u53ca\u5176\u6240\u6709\u5185\u5bb9\u3002\u6a21\u5757\u7684\u7ed3\u679c\u662f\u4ece\u6807\u51c6\u8f93\u51fastdout\u4e2d\u83b7\u53d6json\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u3002ansible\u5c06\u89e3\u6790\u548c\u5904\u7406\u6b64\u5b57\u7b26\u4e32\u3002\u5982\u679c\u6709\u4efb\u52a1\u662f\u5f02\u6b65\u63a7\u5236\u6267\u884c\u7684\uff0cansible\u5c06\u5728\u6a21\u5757\u5b8c\u6210\u4e4b\u524d\u5173\u95ed\u7b2c\u4e09\u4e2a\u8fde\u63a5\uff0c\u5e76\u4e14\u8fd4\u56de\u4e3b\u673a\u540e\uff0c\u5728\u89c4\u5b9a\u7684\u65f6\u95f4\u5185\u68c0\u67e5\u4efb\u52a1\u72b6\u6001\uff0c\u76f4\u5230\u6a21\u5757\u5b8c\u6210\u6216\u89c4\u5b9a\u7684\u65f6\u95f4\u8d85\u65f6\u3002 Note \u5982\u679c\u8981\u6df1\u5165\u4e86\u89e3\u6267\u884c\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u67e5\u770b\u66f4\u8be6\u7ec6\u7684\u4ee3\u7801\u6267\u884c\u8fc7\u7a0b Ansible ad-hoc\u6267\u884c\u8fc7\u7a0b \u4f7f\u7528\u4e86 \u7ba1\u9053\u8fde\u63a5 \u540e\uff0c\u4e0e\u8fdc\u7a0b\u4e3b\u673a\u53ea\u6709\u4e00\u4e2a\u8fde\u63a5\uff0c\u547d\u4ee4\u901a\u8fc7\u6570\u636e\u6d41\u7684\u65b9\u5f0f\u53d1\u9001\u6267\u884c\u3002 \u914d\u7f6e\u65b9\u5f0f vim /etc/ansible/ansible.cfg pipelining = True \u6267\u884c\u8fc7\u7a0b # ansible 192.168.77.130 -m ping -vvv ansible 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible python version = 2 .7.5 ( default, Aug 7 2019 , 00 :51:29 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] Using /etc/ansible/ansible.cfg as config file host_list declined parsing /etc/ansible/hosts as it did not pass its verify_file () method script declined parsing /etc/ansible/hosts as it did not pass its verify_file () method auto declined parsing /etc/ansible/hosts as it did not pass its verify_file () method Parsed /etc/ansible/hosts inventory source with ini plugin META: ran handlers < 192 .168.77.130> Attempting python interpreter discovery < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" 'echo PLATFORM; uname; echo FOUND; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.5' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/libexec/platform-python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python3' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python' \"'\" '\"' \"'\" '\"' \"'\" '; echo ENDFOUND && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , 'PLATFORM\\nLinux\\nFOUND\\n/usr/bin/python\\n/usr/bin/python2.7\\n/usr/libexec/platform-python\\n/usr/bin/python\\nENDFOUND\\n' , '' ) < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '{\"osrelease_content\": \"NAME=\\\\\"CentOS Linux\\\\\"\\\\nVERSION=\\\\\"7 (Core)\\\\\"\\\\nID=\\\\\"centos\\\\\"\\\\nID_LIKE=\\\\\"rhel fedora\\\\\"\\\\nVERSION_ID=\\\\\"7\\\\\"\\\\nPRETTY_NAME=\\\\\"CentOS Linux 7 (Core)\\\\\"\\\\nANSI_COLOR=\\\\\"0;31\\\\\"\\\\nCPE_NAME=\\\\\"cpe:/o:centos:centos:7\\\\\"\\\\nHOME_URL=\\\\\"https://www.centos.org/\\\\\"\\\\nBUG_REPORT_URL=\\\\\"https://bugs.centos.org/\\\\\"\\\\n\\\\nCENTOS_MANTISBT_PROJECT=\\\\\"CentOS-7\\\\\"\\\\nCENTOS_MANTISBT_PROJECT_VERSION=\\\\\"7\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT=\\\\\"centos\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT_VERSION=\\\\\"7\\\\\"\\\\n\\\\n\", \"platform_dist_result\": [\"centos\", \"7.4.1708\", \"Core\"]}\\n' , '' ) Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/ping.py Pipelining is enabled. < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '\\n{\"invocation\": {\"module_args\": {\"data\": \"pong\"}}, \"ping\": \"pong\"}\\n' , '' ) 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"invocation\" : { \"module_args\" : { \"data\" : \"pong\" } } , \"ping\" : \"pong\" } META: ran handlers META: ran handlers \u6267\u884c\u5b8c\u540e\uff0c\u4f1a\u6709\u4e00\u4e2assh\u7684\u7ba1\u9053, \u4e0b\u6b21\u8fde\u63a5\u8fdc\u7a0b\u4e3b\u673a\u65f6\uff0c\u4f1a\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u7ba1\u9053\uff0c\u800c\u4e0d\u5fc5\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\u3002 # ps aux | grep [a]nsible root 50757 0 .0 0 .3 176416 3424 ? Ss 22 :29 0 :00 ssh: /root/.ansible/cp/09e16ea432 [ mux ]","title":"Ansible \u5f00\u53d1\u8bf4\u660e"},{"location":"dev/#ansible","text":"","title":"Ansible \u5f00\u53d1"},{"location":"dev/#_1","text":"http://docs.ansible.com/ansible/dev_guide/index.html \u975e\u5e38\u63a8\u8350\u5927\u5bb6\u770b\u770b \u5b98\u65b9\u6587\u6863","title":"\u5b98\u65b9\u5f00\u53d1\u6587\u6863"},{"location":"dev/#_2","text":"\u672c\u6b21\u6240\u7528\u7684\u73af\u5883 ansible 2.9.6.0 os Centos 7.7 X64 python 2.7.5","title":"\u73af\u5883"},{"location":"dev/#_3","text":"Ansible \u5f00\u53d1\u5206\u4e3a\u4e24\u5927\u6a21\u5757\uff0c\u4e00\u662f modules \uff0c\u4e8c\u662f plugins \u3002 \u9996\u5148\uff0c\u8981\u8bb0\u4f4f\u8fd9\u4e24\u90e8\u5206\u5185\u5bb9\u5728\u54ea\u4e2a\u5730\u65b9\u6267\u884c\uff1f modules \u6587\u4ef6\u88ab\u4f20\u9001\u5230 \u8fdc\u7aef\u4e3b\u673a \u5e76\u6267\u884c\u3002 plugins \u662f\u5728 ansible\u63a7\u5236\u8282\u70b9 \u4e0a\u6267\u884c\u7684\u3002 \u518d\u8005\u662f\u6267\u884c\u987a\u5e8f\uff1f plugins \u5148\u4e8e modules \u6267\u884c\u3002 \u7136\u540e\u5927\u5bb6\u660e\u786e\u8fd9\u4e24\u90e8\u5206\u5185\u5bb9\u662f\u5e72\u5565\u7528\u7684\uff1f modules \u662fansible\u7684\u6838\u5fc3\u5185\u5bb9\uff0c\u5b83\u4f7fplaybook\u53d8\u5f97\u66f4\u52a0\u7b80\u5355\u660e\u4e86\uff0c\u4e00\u4e2atask\u5c31\u662f\u5b8c\u6210\u67d0\u4e00\u9879\u529f\u80fd\u3002ansible\u6a21\u5757\u662f\u88ab\u4f20\u9001\u5230\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u3002\u6240\u4ee5\u5b83\u4eec\u53ef\u4ee5\u7528\u8fdc\u7a0b\u4e3b\u673a\u53ef\u4ee5\u6267\u884c\u7684\u4efb\u4f55\u8bed\u8a00\u7f16\u5199modules\u3002 plugins \u662f\u5728 ansible\u63a7\u5236\u8282\u70b9 \u4e0a\u6267\u884c\u7684\uff0c\u7528\u6765\u8f85\u52a9modules\u505a\u4e00\u4e9b\u64cd\u4f5c\u3002\u6bd4\u5982\u8fde\u63a5\u8fdc\u7a0b\u4e3b\u673a\uff0c\u62f7\u8d1d\u6587\u4ef6\u5230\u8fdc\u7a0b\u4e3b\u673a\u4e4b\u7c7b\u7684\u3002 \u6700\u540e\uff0c\u5b66\u4e60\u5f00\u53d1\u4e4b\u524d\uff0c\u8981\u5148\u5b66\u4f1a Debug","title":"\u4ecb\u7ecd"},{"location":"dev/#ad-hoc","text":"# ansible 192.168.77.130 -m ping -vvv ansible 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible python version = 2 .7.5 ( default, Aug 7 2019 , 00 :51:29 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] Using /etc/ansible/ansible.cfg as config file host_list declined parsing /etc/ansible/hosts as it did not pass its verify_file () method script declined parsing /etc/ansible/hosts as it did not pass its verify_file () method auto declined parsing /etc/ansible/hosts as it did not pass its verify_file () method Parsed /etc/ansible/hosts inventory source with ini plugin META: ran handlers < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" 'echo ~root && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '/root\\n' , '' ) < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" '( umask 77 && mkdir -p \"` echo /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356 `\" && echo ansible-tmp-1586615361.42-9030567083356=\"` echo /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356 `\" ) && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , 'ansible-tmp-1586615361.42-9030567083356=/root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356\\n' , '' ) < 192 .168.77.130> Attempting python interpreter discovery < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" 'echo PLATFORM; uname; echo FOUND; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.5' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/libexec/platform-python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python3' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python' \"'\" '\"' \"'\" '\"' \"'\" '; echo ENDFOUND && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , 'PLATFORM\\nLinux\\nFOUND\\n/usr/bin/python\\n/usr/bin/python2.7\\n/usr/libexec/platform-python\\n/usr/bin/python\\nENDFOUND\\n' , '' ) < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '{\"osrelease_content\": \"NAME=\\\\\"CentOS Linux\\\\\"\\\\nVERSION=\\\\\"7 (Core)\\\\\"\\\\nID=\\\\\"centos\\\\\"\\\\nID_LIKE=\\\\\"rhel fedora\\\\\"\\\\nVERSION_ID=\\\\\"7\\\\\"\\\\nPRETTY_NAME=\\\\\"CentOS Linux 7 (Core)\\\\\"\\\\nANSI_COLOR=\\\\\"0;31\\\\\"\\\\nCPE_NAME=\\\\\"cpe:/o:centos:centos:7\\\\\"\\\\nHOME_URL=\\\\\"https://www.centos.org/\\\\\"\\\\nBUG_REPORT_URL=\\\\\"https://bugs.centos.org/\\\\\"\\\\n\\\\nCENTOS_MANTISBT_PROJECT=\\\\\"CentOS-7\\\\\"\\\\nCENTOS_MANTISBT_PROJECT_VERSION=\\\\\"7\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT=\\\\\"centos\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT_VERSION=\\\\\"7\\\\\"\\\\n\\\\n\", \"platform_dist_result\": [\"centos\", \"7.4.1708\", \"Core\"]}\\n' , '' ) Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/ping.py < 192 .168.77.130> PUT /root/.ansible/tmp/ansible-local-50740hJgOb9/tmpp7Dy_u TO /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356/AnsiballZ_ping.py < 192 .168.77.130> SSH: EXEC sshpass -d8 sftp -o BatchMode = no -b - -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 '[192.168.77.130]' < 192 .168.77.130> ( 0 , 'sftp> put /root/.ansible/tmp/ansible-local-50740hJgOb9/tmpp7Dy_u /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356/AnsiballZ_ping.py\\n' , '' ) < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" 'chmod u+x /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356/ /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356/AnsiballZ_ping.py && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '' , '' ) < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 -tt 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356/AnsiballZ_ping.py && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '\\r\\n{\"invocation\": {\"module_args\": {\"data\": \"pong\"}}, \"ping\": \"pong\"}\\r\\n' , 'Shared connection to 192.168.77.130 closed.\\r\\n' ) < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" 'rm -f -r /root/.ansible/tmp/ansible-tmp-1586615361.42-9030567083356/ > /dev/null 2>&1 && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '' , '' ) 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"invocation\" : { \"module_args\" : { \"data\" : \"pong\" } } , \"ping\" : \"pong\" } META: ran handlers META: ran handlers \u9996\u5148\uff0c\u5c06\u6a21\u5757\u6587\u4ef6\u8bfb\u5165\u5185\u5b58\uff0c\u7136\u540e\u6dfb\u52a0\u4f20\u9012\u7ed9\u6a21\u5757\u7684\u53c2\u6570\uff0c\u6700\u540e\u5c06\u6a21\u5757\u4e2d\u6240\u9700\u8981\u7684\u7c7b\u6dfb\u52a0\u5230\u5185\u5b58\uff0c\u7531zipfile\u538b\u7f29\u540e\uff0c\u518d\u7531base64\u8fdb\u884c\u7f16\u7801\uff0c\u5199\u5165\u5230\u6a21\u7248\u6587\u4ef6\u5185\u3002 \u901a\u8fc7\u9ed8\u8ba4\u7684\u8fde\u63a5\u65b9\u5f0f\uff0c\u4e00\u822c\u662fssh\u3002ansible\u901a\u8fc7ssh\u8fde\u63a5\u5230\u8fdc\u7a0b\u4e3b\u673a\uff0c\u521b\u5efa\u4e34\u65f6\u76ee\u5f55\uff0c\u5e76\u5173\u95ed\u8fde\u63a5\u3002\u7136\u540e\u5c06\u6253\u5f00\u53e6\u5916\u4e00\u4e2assh\u8fde\u63a5\uff0c\u5c06\u6a21\u7248\u6587\u4ef6\u4ee5sftp\u65b9\u5f0f\u4f20\u9001\u5230\u521a\u521a\u521b\u5efa\u7684\u4e34\u65f6\u76ee\u5f55\u4e2d\uff0c\u5199\u5b8c\u540e\u5173\u95ed\u8fde\u63a5\u3002\u7136\u540e\u6253\u5f00\u4e00\u4e2assh\u8fde\u63a5\u5c06\u4efb\u52a1\u5bf9\u8c61\u8d4b\u4e88\u53ef\u6267\u884c\u6743\u9650\uff0c\u6267\u884c\u6210\u529f\u540e\u5173\u95ed\u8fde\u63a5\u3002 \u6700\u540e\uff0cansible\u5c06\u6253\u5f00\u7b2c\u4e09\u4e2a\u8fde\u63a5\u6765\u6267\u884c\u6a21\u5757\uff0c\u5e76\u5220\u9664\u4e34\u65f6\u76ee\u5f55\u53ca\u5176\u6240\u6709\u5185\u5bb9\u3002\u6a21\u5757\u7684\u7ed3\u679c\u662f\u4ece\u6807\u51c6\u8f93\u51fastdout\u4e2d\u83b7\u53d6json\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u3002ansible\u5c06\u89e3\u6790\u548c\u5904\u7406\u6b64\u5b57\u7b26\u4e32\u3002\u5982\u679c\u6709\u4efb\u52a1\u662f\u5f02\u6b65\u63a7\u5236\u6267\u884c\u7684\uff0cansible\u5c06\u5728\u6a21\u5757\u5b8c\u6210\u4e4b\u524d\u5173\u95ed\u7b2c\u4e09\u4e2a\u8fde\u63a5\uff0c\u5e76\u4e14\u8fd4\u56de\u4e3b\u673a\u540e\uff0c\u5728\u89c4\u5b9a\u7684\u65f6\u95f4\u5185\u68c0\u67e5\u4efb\u52a1\u72b6\u6001\uff0c\u76f4\u5230\u6a21\u5757\u5b8c\u6210\u6216\u89c4\u5b9a\u7684\u65f6\u95f4\u8d85\u65f6\u3002 Note \u5982\u679c\u8981\u6df1\u5165\u4e86\u89e3\u6267\u884c\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u67e5\u770b\u66f4\u8be6\u7ec6\u7684\u4ee3\u7801\u6267\u884c\u8fc7\u7a0b Ansible ad-hoc\u6267\u884c\u8fc7\u7a0b \u4f7f\u7528\u4e86 \u7ba1\u9053\u8fde\u63a5 \u540e\uff0c\u4e0e\u8fdc\u7a0b\u4e3b\u673a\u53ea\u6709\u4e00\u4e2a\u8fde\u63a5\uff0c\u547d\u4ee4\u901a\u8fc7\u6570\u636e\u6d41\u7684\u65b9\u5f0f\u53d1\u9001\u6267\u884c\u3002 \u914d\u7f6e\u65b9\u5f0f vim /etc/ansible/ansible.cfg pipelining = True \u6267\u884c\u8fc7\u7a0b # ansible 192.168.77.130 -m ping -vvv ansible 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible python version = 2 .7.5 ( default, Aug 7 2019 , 00 :51:29 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] Using /etc/ansible/ansible.cfg as config file host_list declined parsing /etc/ansible/hosts as it did not pass its verify_file () method script declined parsing /etc/ansible/hosts as it did not pass its verify_file () method auto declined parsing /etc/ansible/hosts as it did not pass its verify_file () method Parsed /etc/ansible/hosts inventory source with ini plugin META: ran handlers < 192 .168.77.130> Attempting python interpreter discovery < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" 'echo PLATFORM; uname; echo FOUND; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.5' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/libexec/platform-python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python3' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python' \"'\" '\"' \"'\" '\"' \"'\" '; echo ENDFOUND && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , 'PLATFORM\\nLinux\\nFOUND\\n/usr/bin/python\\n/usr/bin/python2.7\\n/usr/libexec/platform-python\\n/usr/bin/python\\nENDFOUND\\n' , '' ) < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '{\"osrelease_content\": \"NAME=\\\\\"CentOS Linux\\\\\"\\\\nVERSION=\\\\\"7 (Core)\\\\\"\\\\nID=\\\\\"centos\\\\\"\\\\nID_LIKE=\\\\\"rhel fedora\\\\\"\\\\nVERSION_ID=\\\\\"7\\\\\"\\\\nPRETTY_NAME=\\\\\"CentOS Linux 7 (Core)\\\\\"\\\\nANSI_COLOR=\\\\\"0;31\\\\\"\\\\nCPE_NAME=\\\\\"cpe:/o:centos:centos:7\\\\\"\\\\nHOME_URL=\\\\\"https://www.centos.org/\\\\\"\\\\nBUG_REPORT_URL=\\\\\"https://bugs.centos.org/\\\\\"\\\\n\\\\nCENTOS_MANTISBT_PROJECT=\\\\\"CentOS-7\\\\\"\\\\nCENTOS_MANTISBT_PROJECT_VERSION=\\\\\"7\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT=\\\\\"centos\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT_VERSION=\\\\\"7\\\\\"\\\\n\\\\n\", \"platform_dist_result\": [\"centos\", \"7.4.1708\", \"Core\"]}\\n' , '' ) Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/ping.py Pipelining is enabled. < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/09e16ea432 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '\\n{\"invocation\": {\"module_args\": {\"data\": \"pong\"}}, \"ping\": \"pong\"}\\n' , '' ) 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"invocation\" : { \"module_args\" : { \"data\" : \"pong\" } } , \"ping\" : \"pong\" } META: ran handlers META: ran handlers \u6267\u884c\u5b8c\u540e\uff0c\u4f1a\u6709\u4e00\u4e2assh\u7684\u7ba1\u9053, \u4e0b\u6b21\u8fde\u63a5\u8fdc\u7a0b\u4e3b\u673a\u65f6\uff0c\u4f1a\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u7ba1\u9053\uff0c\u800c\u4e0d\u5fc5\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\u3002 # ps aux | grep [a]nsible root 50757 0 .0 0 .3 176416 3424 ? Ss 22 :29 0 :00 ssh: /root/.ansible/cp/09e16ea432 [ mux ]","title":"Ad-hoc \u6267\u884c\u8fc7\u7a0b"},{"location":"dev/ansible-architecture/","text":"Ansible \u67b6\u6784 \u00b6 Modules \u00b6 Ansible\u901a\u8fc7\u8fde\u63a5\u5230\u8282\u70b9\u5e76\u5411\u5176\u63a8\u51fa\u79f0\u4e3a\u201c Ansible Modules\u201d\u7684\u811a\u672c\u6765\u5de5\u4f5c\u3002 \u5927\u591a\u6570\u6a21\u5757\u63a5\u53d7\u63cf\u8ff0\u7cfb\u7edf\u6240\u9700\u72b6\u6001\u7684\u53c2\u6570\u3002 \u7136\u540e\uff0cAnsible\u6267\u884c\u8fd9\u4e9b\u6a21\u5757\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u901a\u8fc7SSH\uff09\uff0c\u5e76\u5728\u5b8c\u6210\u540e\u5c06\u5176\u5220\u9664\u3002 \u60a8\u7684\u6a21\u5757\u5e93\u53ef\u4ee5\u9a7b\u7559\u5728\u4efb\u4f55\u8ba1\u7b97\u673a\u4e0a\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u670d\u52a1\u5668\uff0c\u5b88\u62a4\u7a0b\u5e8f\u6216\u6570\u636e\u5e93\u3002 \u60a8\u53ef\u4ee5\u7528\u4efb\u4f55\u8bed\u8a00 (Ruby\u3001Python\u3001bash\u7b49)\u7f16\u5199\u53ef\u4ee5\u8fd4\u56de JSON \u7684\u6a21\u5757\u3002 Module utilities \u00b6 \u5f53\u591a\u4e2a\u6a21\u5757\u4f7f\u7528\u76f8\u540c\u7684\u4ee3\u7801\u65f6\uff0cAnsible\u5c06\u8fd9\u4e9b\u529f\u80fd\u5b58\u50a8\u4e3aModule utilities\uff0c\u4ee5\u51cf\u5c11\u91cd\u590d\u548c\u7ef4\u62a4\u3002 Plugins \u00b6 \u63d2\u4ef6\u589e\u5f3a\u4e86Ansible\u7684\u6838\u5fc3\u529f\u80fd\u3002\u6a21\u5757\u5728\u76ee\u6807\u7cfb\u7edf\u4e0a\u4ee5\u72ec\u7acb\u7684\u8fdb\u7a0b\u6267\u884c(\u901a\u5e38\u662f\u5728\u8fdc\u7a0b\u7cfb\u7edf\u4e0a)\uff0c\u63d2\u4ef6\u5219\u662f\u5728 /usr/ bin/nsible \u8fdb\u7a0b\u5185\u7684\u63a7\u5236\u8282\u70b9\u4e0a\u6267\u884c\u3002 \u63d2\u4ef6\u4e3aAnsible\u7684\u6838\u5fc3\u7279\u6027\u63d0\u4f9b\u4e86\u9009\u9879\u548c\u6269\u5c55\u2014\u8f6c\u6362\u6570\u636e\u3001\u65e5\u5fd7\u8f93\u51fa\u3001\u8fde\u63a5\u5230\u76ee\u5f55\u7b49\u7b49\u3002\u60a8\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2ainventory\u63d2\u4ef6\u6765\u8fde\u63a5\u4efb\u4f55\u8fd4\u56deJSON\u7684\u6570\u636e\u6e90\u3002\u63d2\u4ef6\u5fc5\u987b\u7528Python\u7f16\u5199\u3002 Inventory \u00b6 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAnsible\u5728\u6587\u4ef6\uff08INI\uff0cYAML\u7b49\uff09\u4e2d\u8868\u793a\u5176\u7ba1\u7406\u7684\u8ba1\u7b97\u673a\uff0c\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u52a8\u6001\u5f62\u5f0f\u4eceEC2\u3001Rackspace\u6216OpenStack\u7b49\u6570\u636e\u6e90\u83b7\u53d6\u4e3b\u673a\u3002 \u9759\u6001\u6587\u4ef6\u6587\u4ef6\u5185\u5bb9 --- [ webservers ] www1.example.com www2.example.com [dbservers] db0.example.com db1.example.com Playbooks \u00b6 \u5267\u672c\u53ef\u4ee5\u5f88\u597d\u5730\u534f\u8c03\u57fa\u7840\u7ed3\u6784\u4e2d\u7684\u5404\u4e2atask\uff0c\u5e76\u4e14\u53ef\u4ee5\u63a7\u5236\u5e76\u53d1\u5904\u7406\u7684\u8ba1\u7b97\u673a\u6570\u91cf\u3002 \u4e00\u4e2a\u7b80\u5355\u7684playbook --- - hosts: webservers serial: 5 # update 5 machines at a time roles: - common - webapp - hosts: content_servers roles: - common - content Ansible \u641c\u7d22\u8def\u5f84 \u00b6 \u6a21\u5757\u3001\u6a21\u5757\u5de5\u5177\u7c7b\u3001\u63d2\u4ef6\u3001\u5267\u672c\u548c\u89d2\u8272\u53ef\u4ee5\u4f4d\u4e8e\u591a\u4e2a\u4f4d\u7f6e\u3002\u5982\u679c\u4f60\u7f16\u5199\u81ea\u5df1\u7684\u4ee3\u7801\u6765\u6269\u5c55Ansible\u7684\u6838\u5fc3\u529f\u80fd\uff0c\u4f60\u53ef\u80fd\u5728\u4f60\u7684Ansible\u63a7\u5236\u8282\u70b9\u7684\u4e0d\u540c\u4f4d\u7f6e\u6709\u591a\u4e2a\u540d\u79f0\u76f8\u4f3c\u6216\u76f8\u540c\u7684\u6587\u4ef6\u3002\u641c\u7d22\u8def\u5f84\u51b3\u5b9a\u4e86\u54ea\u4e9b\u6587\u4ef6\u5c06\u88ab\u6307\u5b9a\u7684\u5267\u672c\u6240\u4f7f\u7528\u3002 \u5728\u6574\u4e2a\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0cAnsible\u7684\u641c\u7d22\u8def\u5f84\u4f1a\u9010\u6e10\u589e\u52a0\u3002 \u5f53Ansible\u67e5\u627e\u7ed9\u5b9a\u8fd0\u884c\u4e2d\u5305\u542b\u7684\u6bcf\u4e2a\u5267\u672c\u548c\u89d2\u8272\u65f6\uff0c\u5b83\u5c06\u4e0e\u8be5\u5267\u672c\u6216\u89d2\u8272\u76f8\u5173\u7684\u6240\u6709\u76ee\u5f55\u8ffd\u52a0\u5230\u641c\u7d22\u8def\u5f84\u4e2d\u3002 \u5373\u4f7f\u5728\u5267\u672c\u6216\u89d2\u8272\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u8fd9\u4e9b\u76ee\u5f55\u4ecd\u5728\u8fd0\u884c\u671f\u95f4\u4fdd\u6301\u4f5c\u7528\u57df\u3002 Ansible\u6309\u4ee5\u4e0b\u987a\u5e8f\u52a0\u8f7d\u6a21\u5757\uff0c\u6a21\u5757\u5de5\u5177\u7c7b\u548c\u63d2\u4ef6\uff1a \u5982\u679c\u4f7f\u7528 ansible-playbook /path/to/play.yml \u8fd0\u884cAnsible\uff0c\u5219Ansible\u4f1a\u9644\u52a0\u4ee5\u4e0b\u76ee\u5f55\uff08\u5982\u679c\u5b58\u5728\uff09\uff1a /path/to/modules /path/to/module_utils /path/to/plugins \u5982\u679c play.yml \u5305\u542b -import_playbook\uff1a/path/to/subdir/play1.yml \uff0c\u5219Ansible\u5c06\u9644\u52a0\u4ee5\u4e0b\u76ee\u5f55\uff08\u5982\u679c\u5b58\u5728\uff09\uff1a /path/to/subdir/modules /path/to/subdir/module_utils /path/to/subdir/plugins \u5982\u679c play.yml \u8fd0\u884c myrole \uff0c\u5219Ansible\u5c06\u9644\u52a0\u4ee5\u4e0b\u76ee\u5f55\uff08\u5982\u679c\u5b58\u5728\uff09\uff1a /path/to/roles/myrole/modules /path/to/roles/myrole/module_utils /path/to/roles/myrole/plugins \u53ef\u4ee5\u5728 ansible.cfg \u4e2d\u4e3a\u5176\u6307\u5b9a\u9ed8\u8ba4\u76ee\u5f55\u6216\u8005\u7531\u76f8\u5173\u7684\u73af\u5883\u53d8\u91cf\u6307\u5b9a library module_utils cache_plugins filter_plugins \u5bf9\u5e94\u7684\u73af\u5883\u53d8\u91cf ANSIBLE_LIBRARY ANSIBLE_MODULE_UTILS ANSIBLE_CACHE_PLUGINS ANSIBLE_FILTER_PLUGINS \u66f4\u591a\u7684\u53c2\u6570\u8bbe\u7f6e\u89c1 Ansible \u914d\u7f6e \u4f5c\u4e3aAnsible\u53d1\u884c\u7248\u4e00\u90e8\u5206\u63d0\u4f9b\u7684\u6807\u51c6\u76ee\u5f55 /lib/python2.7/site-packages/ansible/modules/ /lib/python2.7/site-packages/ansible/module_utils/ /lib/python2.7/site-packages/ansible/plugins/","title":"Ansible \u67b6\u6784"},{"location":"dev/ansible-architecture/#ansible","text":"","title":"Ansible \u67b6\u6784"},{"location":"dev/ansible-architecture/#modules","text":"Ansible\u901a\u8fc7\u8fde\u63a5\u5230\u8282\u70b9\u5e76\u5411\u5176\u63a8\u51fa\u79f0\u4e3a\u201c Ansible Modules\u201d\u7684\u811a\u672c\u6765\u5de5\u4f5c\u3002 \u5927\u591a\u6570\u6a21\u5757\u63a5\u53d7\u63cf\u8ff0\u7cfb\u7edf\u6240\u9700\u72b6\u6001\u7684\u53c2\u6570\u3002 \u7136\u540e\uff0cAnsible\u6267\u884c\u8fd9\u4e9b\u6a21\u5757\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u901a\u8fc7SSH\uff09\uff0c\u5e76\u5728\u5b8c\u6210\u540e\u5c06\u5176\u5220\u9664\u3002 \u60a8\u7684\u6a21\u5757\u5e93\u53ef\u4ee5\u9a7b\u7559\u5728\u4efb\u4f55\u8ba1\u7b97\u673a\u4e0a\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u670d\u52a1\u5668\uff0c\u5b88\u62a4\u7a0b\u5e8f\u6216\u6570\u636e\u5e93\u3002 \u60a8\u53ef\u4ee5\u7528\u4efb\u4f55\u8bed\u8a00 (Ruby\u3001Python\u3001bash\u7b49)\u7f16\u5199\u53ef\u4ee5\u8fd4\u56de JSON \u7684\u6a21\u5757\u3002","title":"Modules"},{"location":"dev/ansible-architecture/#module-utilities","text":"\u5f53\u591a\u4e2a\u6a21\u5757\u4f7f\u7528\u76f8\u540c\u7684\u4ee3\u7801\u65f6\uff0cAnsible\u5c06\u8fd9\u4e9b\u529f\u80fd\u5b58\u50a8\u4e3aModule utilities\uff0c\u4ee5\u51cf\u5c11\u91cd\u590d\u548c\u7ef4\u62a4\u3002","title":"Module utilities"},{"location":"dev/ansible-architecture/#plugins","text":"\u63d2\u4ef6\u589e\u5f3a\u4e86Ansible\u7684\u6838\u5fc3\u529f\u80fd\u3002\u6a21\u5757\u5728\u76ee\u6807\u7cfb\u7edf\u4e0a\u4ee5\u72ec\u7acb\u7684\u8fdb\u7a0b\u6267\u884c(\u901a\u5e38\u662f\u5728\u8fdc\u7a0b\u7cfb\u7edf\u4e0a)\uff0c\u63d2\u4ef6\u5219\u662f\u5728 /usr/ bin/nsible \u8fdb\u7a0b\u5185\u7684\u63a7\u5236\u8282\u70b9\u4e0a\u6267\u884c\u3002 \u63d2\u4ef6\u4e3aAnsible\u7684\u6838\u5fc3\u7279\u6027\u63d0\u4f9b\u4e86\u9009\u9879\u548c\u6269\u5c55\u2014\u8f6c\u6362\u6570\u636e\u3001\u65e5\u5fd7\u8f93\u51fa\u3001\u8fde\u63a5\u5230\u76ee\u5f55\u7b49\u7b49\u3002\u60a8\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2ainventory\u63d2\u4ef6\u6765\u8fde\u63a5\u4efb\u4f55\u8fd4\u56deJSON\u7684\u6570\u636e\u6e90\u3002\u63d2\u4ef6\u5fc5\u987b\u7528Python\u7f16\u5199\u3002","title":"Plugins"},{"location":"dev/ansible-architecture/#inventory","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAnsible\u5728\u6587\u4ef6\uff08INI\uff0cYAML\u7b49\uff09\u4e2d\u8868\u793a\u5176\u7ba1\u7406\u7684\u8ba1\u7b97\u673a\uff0c\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u52a8\u6001\u5f62\u5f0f\u4eceEC2\u3001Rackspace\u6216OpenStack\u7b49\u6570\u636e\u6e90\u83b7\u53d6\u4e3b\u673a\u3002 \u9759\u6001\u6587\u4ef6\u6587\u4ef6\u5185\u5bb9 --- [ webservers ] www1.example.com www2.example.com [dbservers] db0.example.com db1.example.com","title":"Inventory"},{"location":"dev/ansible-architecture/#playbooks","text":"\u5267\u672c\u53ef\u4ee5\u5f88\u597d\u5730\u534f\u8c03\u57fa\u7840\u7ed3\u6784\u4e2d\u7684\u5404\u4e2atask\uff0c\u5e76\u4e14\u53ef\u4ee5\u63a7\u5236\u5e76\u53d1\u5904\u7406\u7684\u8ba1\u7b97\u673a\u6570\u91cf\u3002 \u4e00\u4e2a\u7b80\u5355\u7684playbook --- - hosts: webservers serial: 5 # update 5 machines at a time roles: - common - webapp - hosts: content_servers roles: - common - content","title":"Playbooks"},{"location":"dev/ansible-architecture/#ansible_1","text":"\u6a21\u5757\u3001\u6a21\u5757\u5de5\u5177\u7c7b\u3001\u63d2\u4ef6\u3001\u5267\u672c\u548c\u89d2\u8272\u53ef\u4ee5\u4f4d\u4e8e\u591a\u4e2a\u4f4d\u7f6e\u3002\u5982\u679c\u4f60\u7f16\u5199\u81ea\u5df1\u7684\u4ee3\u7801\u6765\u6269\u5c55Ansible\u7684\u6838\u5fc3\u529f\u80fd\uff0c\u4f60\u53ef\u80fd\u5728\u4f60\u7684Ansible\u63a7\u5236\u8282\u70b9\u7684\u4e0d\u540c\u4f4d\u7f6e\u6709\u591a\u4e2a\u540d\u79f0\u76f8\u4f3c\u6216\u76f8\u540c\u7684\u6587\u4ef6\u3002\u641c\u7d22\u8def\u5f84\u51b3\u5b9a\u4e86\u54ea\u4e9b\u6587\u4ef6\u5c06\u88ab\u6307\u5b9a\u7684\u5267\u672c\u6240\u4f7f\u7528\u3002 \u5728\u6574\u4e2a\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0cAnsible\u7684\u641c\u7d22\u8def\u5f84\u4f1a\u9010\u6e10\u589e\u52a0\u3002 \u5f53Ansible\u67e5\u627e\u7ed9\u5b9a\u8fd0\u884c\u4e2d\u5305\u542b\u7684\u6bcf\u4e2a\u5267\u672c\u548c\u89d2\u8272\u65f6\uff0c\u5b83\u5c06\u4e0e\u8be5\u5267\u672c\u6216\u89d2\u8272\u76f8\u5173\u7684\u6240\u6709\u76ee\u5f55\u8ffd\u52a0\u5230\u641c\u7d22\u8def\u5f84\u4e2d\u3002 \u5373\u4f7f\u5728\u5267\u672c\u6216\u89d2\u8272\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u8fd9\u4e9b\u76ee\u5f55\u4ecd\u5728\u8fd0\u884c\u671f\u95f4\u4fdd\u6301\u4f5c\u7528\u57df\u3002 Ansible\u6309\u4ee5\u4e0b\u987a\u5e8f\u52a0\u8f7d\u6a21\u5757\uff0c\u6a21\u5757\u5de5\u5177\u7c7b\u548c\u63d2\u4ef6\uff1a \u5982\u679c\u4f7f\u7528 ansible-playbook /path/to/play.yml \u8fd0\u884cAnsible\uff0c\u5219Ansible\u4f1a\u9644\u52a0\u4ee5\u4e0b\u76ee\u5f55\uff08\u5982\u679c\u5b58\u5728\uff09\uff1a /path/to/modules /path/to/module_utils /path/to/plugins \u5982\u679c play.yml \u5305\u542b -import_playbook\uff1a/path/to/subdir/play1.yml \uff0c\u5219Ansible\u5c06\u9644\u52a0\u4ee5\u4e0b\u76ee\u5f55\uff08\u5982\u679c\u5b58\u5728\uff09\uff1a /path/to/subdir/modules /path/to/subdir/module_utils /path/to/subdir/plugins \u5982\u679c play.yml \u8fd0\u884c myrole \uff0c\u5219Ansible\u5c06\u9644\u52a0\u4ee5\u4e0b\u76ee\u5f55\uff08\u5982\u679c\u5b58\u5728\uff09\uff1a /path/to/roles/myrole/modules /path/to/roles/myrole/module_utils /path/to/roles/myrole/plugins \u53ef\u4ee5\u5728 ansible.cfg \u4e2d\u4e3a\u5176\u6307\u5b9a\u9ed8\u8ba4\u76ee\u5f55\u6216\u8005\u7531\u76f8\u5173\u7684\u73af\u5883\u53d8\u91cf\u6307\u5b9a library module_utils cache_plugins filter_plugins \u5bf9\u5e94\u7684\u73af\u5883\u53d8\u91cf ANSIBLE_LIBRARY ANSIBLE_MODULE_UTILS ANSIBLE_CACHE_PLUGINS ANSIBLE_FILTER_PLUGINS \u66f4\u591a\u7684\u53c2\u6570\u8bbe\u7f6e\u89c1 Ansible \u914d\u7f6e \u4f5c\u4e3aAnsible\u53d1\u884c\u7248\u4e00\u90e8\u5206\u63d0\u4f9b\u7684\u6807\u51c6\u76ee\u5f55 /lib/python2.7/site-packages/ansible/modules/ /lib/python2.7/site-packages/ansible/module_utils/ /lib/python2.7/site-packages/ansible/plugins/","title":"Ansible \u641c\u7d22\u8def\u5f84"},{"location":"dev/pycharm-remote-development/","text":"\u4f7f\u7528 PyCharm \u8fdc\u7a0b\u5f00\u53d1 \u00b6 \u5728linux\u4e3b\u673a\u4e0a\u4f7f\u7528vim\u5f00\u53d1Ansible\u6a21\u5757\u6216\u63d2\u4ef6\uff0c\u5bf9\u4e8e\u65b0\u624b\u6765\u8bf4\u4e0d\u662f\u5f88\u65b9\u4fbf\u3002\u5927\u591a\u6570\u4eba\u7684\u5de5\u4f5c\u73af\u5883\u90fd\u662f\u57fa\u4e8eWindows\u73af\u5883\u7684\uff0c\u4f46\u662f Ansible \u4e0d\u80fd\u8fd0\u884c\u5728Windows\u73af\u5883\u4e0b\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u60f3\u4f7f\u7528Windows\u73af\u5883\u4e0b\u7684PyCharm \u5de5\u5177\u65f6\uff0c\u53ea\u80fd\u901a\u8fc7\u8fdc\u7a0b\u8fde\u63a5\u7684\u65b9\u5f0f\u8fdb\u884c\u5f00\u53d1playbook\u6216\u6a21\u5757\u63d2\u4ef6\u3002 \u63a5\u4e0b\u6765\uff0c\u8ddf\u6211\u4e00\u8d77\u6765\u914d\u7f6e PyCharm \u5de5\u5177\uff0c\u4f7f\u5176\u80fd\u591f\u8fdc\u7a0b\u5f00\u53d1Ansible\u76f8\u5173\u7a0b\u5e8f\u3002 \u8fdc\u7a0b\u4e3b\u673a \u00b6 OS: cetnos 7.7 x64 Python: 2.7.5 Ansible: 2.9.6 \u5de5\u4f5c\u7a7a\u95f4 \u00b6 \u65b0\u5efa\u4e00\u4e2a\u5de5\u4f5c\u76ee\u5f55\uff0c\u672c\u6b21\u4f7f\u7528 D:\\dev\\ansible \u76ee\u5f55 \u8bbe\u7f6ePython Interpreter \u00b6 \u4f7f\u7528 PyCharm \u6253\u5f00\u521b\u5efa\u597d\u7684\u5de5\u4f5c\u76ee\u5f55\uff0c\u9009\u4e2d\u9879\u76ee\uff0c\u6253\u5f00\u9009\u9879 Files => Settings => Project: ansible => Project Interpreter \u5728 Project Interpreter \u53f3\u4fa7\u9009\u62e9 Add \u6dfb\u52a0 \u9009\u62e9 SSH Interpreter \u8fdb\u884c\u8bbe\u7f6e\u8fdc\u7a0b\u4e3b\u673a\u7684\u8fde\u63a5\u4fe1\u606f \u8f93\u5165\u8fde\u63a5\u4fe1\u606f\u540e\uff0c\u8fd8\u9700\u586b\u5199\u8ba4\u8bc1\u4fe1\u606f\u3002 \u8ba4\u8bc1\u901a\u8fc7\u540e\uff0c\u5c31\u8981\u8bbe\u7f6e\u8fdc\u7a0b\u4e3b\u673a\u7684 Python \u53ef\u6267\u884c\u8def\u5f84\u548c\u9700\u8981\u540c\u6b65\u7684\u76ee\u5f55 \u672c\u6b21\u4f7f\u7528\u7684\u65f6\u5de5\u4f5c\u76ee\u5f55\u548c\u8fdc\u7a0b\u7684 /etc/ansible \u76ee\u5f55\u8fdb\u884c\u540c\u6b65 \u8bbe\u7f6e\u5b8c\u6210\u540e\uff0c\u70b9\u51fb OK \u786e\u8ba4\u8bbe\u7f6e \u540c\u6b65\u76ee\u5f55 \u00b6 \u6211\u4eec\u5de5\u4f5c\u7a7a\u95f4\u6b64\u523b\u8fd8\u662f\u7a7a\u7684\uff0c\u9700\u8981\u4e0e\u8fdc\u7a0b\u76ee\u5f55\u8fdb\u884c\u540c\u6b65\uff0c\u5c06\u8fdc\u7a0b\u76ee\u5f55\u7684\u6570\u636e\u4e0b\u8f7d\u5230\u5de5\u4f5c\u7a7a\u95f4 \u9009\u4e2d\u9879\u76ee\uff0c\u6253\u5f00\u9009\u9879 Tools => Deployment => Download from root@192.168.77.130:22 \u7b49\u5f85\u4e00\u4f1a\uff0c\u5c31\u540c\u6b65\u5b8c\u6210\u4e86 \u5f00\u53d1\u6587\u4ef6 \u00b6 \u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5728 library \u76ee\u5f55\u4e2d\u521b\u5efa\u4e00\u4e2a remote_copy.py \u6587\u4ef6 \u53ef\u4ee5\u53d1\u73b0\uff0c\u6211\u4eec\u5728Windows\u4e0a\u4e5f\u80fdimport ansible\u76f8\u5173\u4fe1\u606f\u4e86\u3002 pycharm\u4f1a\u5728\u540e\u53f0\u8d77\u4e00\u4e2a\u8fdb\u7a0b\u6765\u76d1\u63a7\u5de5\u4f5c\u7a7a\u95f4\u7684\u53d8\u52a8\uff0c\u5982\u6709\u53d8\u52a8\u5c06\u4f1a\u540c\u6b65\u5230\u8fdc\u7a0b\u4e3b\u673a\u76ee\u5f55 \u70b9\u51fb\u5de6\u4e0b\u89d2\u7684 Python Console \u53ef\u4ee5\u8fdb\u5165\u8fdc\u7a0b\u4e3b\u673a\u7684python\u89e3\u91ca\u5668\u4e2d \u6267\u884c\u547d\u4ee4 \u00b6 \u5728\u6211\u4eec\u9700\u8981\u8fd0\u884cansible\u6a21\u5757\u6216\u63d2\u4ef6\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdc\u7a0b\u8fde\u63a5\u5230\u4e3b\u673a\u4e0a\u8fdb\u884c\u64cd\u4f5cansible\u547d\u4ee4\u8fd0\u884cplaybook \u6253\u5f00\u9009\u9879 Tools => Start SSH session... , \u9009\u62e9 192.168.77.130 \u4e3b\u673a \u8fde\u63a5\u6210\u529f\u540e\uff0c\u5c31\u53ef\u4ee5\u5728 Terminal \u754c\u9762\u64cd\u4f5cansible\u547d\u4ee4\u4e86 Debug\u4ee3\u7801 \u00b6 \u89c1 PyCharm \u8fdc\u7a0b\u8c03\u8bd5","title":"\u4f7f\u7528 PyCharm \u8fdc\u7a0b\u5f00\u53d1"},{"location":"dev/pycharm-remote-development/#pycharm","text":"\u5728linux\u4e3b\u673a\u4e0a\u4f7f\u7528vim\u5f00\u53d1Ansible\u6a21\u5757\u6216\u63d2\u4ef6\uff0c\u5bf9\u4e8e\u65b0\u624b\u6765\u8bf4\u4e0d\u662f\u5f88\u65b9\u4fbf\u3002\u5927\u591a\u6570\u4eba\u7684\u5de5\u4f5c\u73af\u5883\u90fd\u662f\u57fa\u4e8eWindows\u73af\u5883\u7684\uff0c\u4f46\u662f Ansible \u4e0d\u80fd\u8fd0\u884c\u5728Windows\u73af\u5883\u4e0b\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u60f3\u4f7f\u7528Windows\u73af\u5883\u4e0b\u7684PyCharm \u5de5\u5177\u65f6\uff0c\u53ea\u80fd\u901a\u8fc7\u8fdc\u7a0b\u8fde\u63a5\u7684\u65b9\u5f0f\u8fdb\u884c\u5f00\u53d1playbook\u6216\u6a21\u5757\u63d2\u4ef6\u3002 \u63a5\u4e0b\u6765\uff0c\u8ddf\u6211\u4e00\u8d77\u6765\u914d\u7f6e PyCharm \u5de5\u5177\uff0c\u4f7f\u5176\u80fd\u591f\u8fdc\u7a0b\u5f00\u53d1Ansible\u76f8\u5173\u7a0b\u5e8f\u3002","title":"\u4f7f\u7528 PyCharm \u8fdc\u7a0b\u5f00\u53d1"},{"location":"dev/pycharm-remote-development/#_1","text":"OS: cetnos 7.7 x64 Python: 2.7.5 Ansible: 2.9.6","title":"\u8fdc\u7a0b\u4e3b\u673a"},{"location":"dev/pycharm-remote-development/#_2","text":"\u65b0\u5efa\u4e00\u4e2a\u5de5\u4f5c\u76ee\u5f55\uff0c\u672c\u6b21\u4f7f\u7528 D:\\dev\\ansible \u76ee\u5f55","title":"\u5de5\u4f5c\u7a7a\u95f4"},{"location":"dev/pycharm-remote-development/#python-interpreter","text":"\u4f7f\u7528 PyCharm \u6253\u5f00\u521b\u5efa\u597d\u7684\u5de5\u4f5c\u76ee\u5f55\uff0c\u9009\u4e2d\u9879\u76ee\uff0c\u6253\u5f00\u9009\u9879 Files => Settings => Project: ansible => Project Interpreter \u5728 Project Interpreter \u53f3\u4fa7\u9009\u62e9 Add \u6dfb\u52a0 \u9009\u62e9 SSH Interpreter \u8fdb\u884c\u8bbe\u7f6e\u8fdc\u7a0b\u4e3b\u673a\u7684\u8fde\u63a5\u4fe1\u606f \u8f93\u5165\u8fde\u63a5\u4fe1\u606f\u540e\uff0c\u8fd8\u9700\u586b\u5199\u8ba4\u8bc1\u4fe1\u606f\u3002 \u8ba4\u8bc1\u901a\u8fc7\u540e\uff0c\u5c31\u8981\u8bbe\u7f6e\u8fdc\u7a0b\u4e3b\u673a\u7684 Python \u53ef\u6267\u884c\u8def\u5f84\u548c\u9700\u8981\u540c\u6b65\u7684\u76ee\u5f55 \u672c\u6b21\u4f7f\u7528\u7684\u65f6\u5de5\u4f5c\u76ee\u5f55\u548c\u8fdc\u7a0b\u7684 /etc/ansible \u76ee\u5f55\u8fdb\u884c\u540c\u6b65 \u8bbe\u7f6e\u5b8c\u6210\u540e\uff0c\u70b9\u51fb OK \u786e\u8ba4\u8bbe\u7f6e","title":"\u8bbe\u7f6ePython Interpreter"},{"location":"dev/pycharm-remote-development/#_3","text":"\u6211\u4eec\u5de5\u4f5c\u7a7a\u95f4\u6b64\u523b\u8fd8\u662f\u7a7a\u7684\uff0c\u9700\u8981\u4e0e\u8fdc\u7a0b\u76ee\u5f55\u8fdb\u884c\u540c\u6b65\uff0c\u5c06\u8fdc\u7a0b\u76ee\u5f55\u7684\u6570\u636e\u4e0b\u8f7d\u5230\u5de5\u4f5c\u7a7a\u95f4 \u9009\u4e2d\u9879\u76ee\uff0c\u6253\u5f00\u9009\u9879 Tools => Deployment => Download from root@192.168.77.130:22 \u7b49\u5f85\u4e00\u4f1a\uff0c\u5c31\u540c\u6b65\u5b8c\u6210\u4e86","title":"\u540c\u6b65\u76ee\u5f55"},{"location":"dev/pycharm-remote-development/#_4","text":"\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5728 library \u76ee\u5f55\u4e2d\u521b\u5efa\u4e00\u4e2a remote_copy.py \u6587\u4ef6 \u53ef\u4ee5\u53d1\u73b0\uff0c\u6211\u4eec\u5728Windows\u4e0a\u4e5f\u80fdimport ansible\u76f8\u5173\u4fe1\u606f\u4e86\u3002 pycharm\u4f1a\u5728\u540e\u53f0\u8d77\u4e00\u4e2a\u8fdb\u7a0b\u6765\u76d1\u63a7\u5de5\u4f5c\u7a7a\u95f4\u7684\u53d8\u52a8\uff0c\u5982\u6709\u53d8\u52a8\u5c06\u4f1a\u540c\u6b65\u5230\u8fdc\u7a0b\u4e3b\u673a\u76ee\u5f55 \u70b9\u51fb\u5de6\u4e0b\u89d2\u7684 Python Console \u53ef\u4ee5\u8fdb\u5165\u8fdc\u7a0b\u4e3b\u673a\u7684python\u89e3\u91ca\u5668\u4e2d","title":"\u5f00\u53d1\u6587\u4ef6"},{"location":"dev/pycharm-remote-development/#_5","text":"\u5728\u6211\u4eec\u9700\u8981\u8fd0\u884cansible\u6a21\u5757\u6216\u63d2\u4ef6\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdc\u7a0b\u8fde\u63a5\u5230\u4e3b\u673a\u4e0a\u8fdb\u884c\u64cd\u4f5cansible\u547d\u4ee4\u8fd0\u884cplaybook \u6253\u5f00\u9009\u9879 Tools => Start SSH session... , \u9009\u62e9 192.168.77.130 \u4e3b\u673a \u8fde\u63a5\u6210\u529f\u540e\uff0c\u5c31\u53ef\u4ee5\u5728 Terminal \u754c\u9762\u64cd\u4f5cansible\u547d\u4ee4\u4e86","title":"\u6267\u884c\u547d\u4ee4"},{"location":"dev/pycharm-remote-development/#debug","text":"\u89c1 PyCharm \u8fdc\u7a0b\u8c03\u8bd5","title":"Debug\u4ee3\u7801"},{"location":"dev/api/","text":"Python API \u4f7f\u7528 \u00b6 Note \u8be5API\u4f9b\u5185\u90e8Ansible\u4f7f\u7528\u3002 Ansible\u53ef\u4ee5\u968f\u65f6\u5bf9\u6b64API\u8fdb\u884c\u66f4\u6539\uff0c\u8fd9\u53ef\u80fd\u4f1a\u7834\u574f\u4e0e\u8be5API\u8f83\u65e9\u7248\u672c\u7684\u5411\u540e\u517c\u5bb9\u6027\u3002 \u56e0\u6b64\uff0cAnsible\u4e0d\u652f\u6301\u5916\u90e8\u4f7f\u7528\u3002 Note \u7531\u4e8eAnsible\u4f9d\u8d56\u4e8eFork\u8fdb\u7a0b\uff0c\u56e0\u6b64\u8be5API\u5e76\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\u3002 \u770b\u5230\u8fd9\u91cc\uff0c\u4f60\u8fd8\u60f3\u4f7f\u7528API\u7684\u8bdd\uff0c\u5c31\u770b\u770b\u4e0b\u9762\u7684\u4f8b\u5b50\u5427\u3002","title":"API \u4f7f\u7528\u8bf4\u660e"},{"location":"dev/api/#python-api","text":"Note \u8be5API\u4f9b\u5185\u90e8Ansible\u4f7f\u7528\u3002 Ansible\u53ef\u4ee5\u968f\u65f6\u5bf9\u6b64API\u8fdb\u884c\u66f4\u6539\uff0c\u8fd9\u53ef\u80fd\u4f1a\u7834\u574f\u4e0e\u8be5API\u8f83\u65e9\u7248\u672c\u7684\u5411\u540e\u517c\u5bb9\u6027\u3002 \u56e0\u6b64\uff0cAnsible\u4e0d\u652f\u6301\u5916\u90e8\u4f7f\u7528\u3002 Note \u7531\u4e8eAnsible\u4f9d\u8d56\u4e8eFork\u8fdb\u7a0b\uff0c\u56e0\u6b64\u8be5API\u5e76\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\u3002 \u770b\u5230\u8fd9\u91cc\uff0c\u4f60\u8fd8\u60f3\u4f7f\u7528API\u7684\u8bdd\uff0c\u5c31\u770b\u770b\u4e0b\u9762\u7684\u4f8b\u5b50\u5427\u3002","title":"Python API \u4f7f\u7528"},{"location":"dev/api/api-ansible-runner/","text":"Ansible Runner \u00b6 Ansible Runner \u662fansible\u5b98\u65b9\u63d0\u4f9b\u7684\u4e00\u4e2a\u5de5\u5177\u548cpython\u5e93\uff0c\u5f53\u76f4\u63a5\u4e0eAnsible\u8fdb\u884c\u4ea4\u4e92\u6216\u4f5c\u4e3a\u53e6\u4e00\u4e2a\u7cfb\u7edf\u7684\u4e00\u90e8\u5206\u4e0eAnsible\u8fdb\u884c\u4ea4\u4e92\u65f6\uff0c\u65e0\u8bba\u662f\u901a\u8fc7\u5bb9\u5668\u6620\u50cf\u63a5\u53e3\uff0c\u4f5c\u4e3a\u72ec\u7acb\u5de5\u5177\u8fd8\u662f\u4f5c\u4e3a\u53ef\u4ee5\u5bfc\u5165\u7684Python\u6a21\u5757\uff0c\u5b83\u90fd\u53ef\u4ee5\u63d0\u4f9b\u5e2e\u52a9\u3002 \u76ee\u7684\u662f\u4e3aAnsible\u63d0\u4f9b\u7a33\u5b9a\u4e14\u4e00\u81f4\u7684\u63a5\u53e3\u62bd\u8c61\u3002 Ansible Runner \u5728 Ansible Tower / AWX \u4e2d\u8d1f\u8d23\u8fd0\u884c ansible \u548c ansible-playbook \u4efb\u52a1\u7684\u90e8\u5206\u6a21\u5757\u5316\uff0c\u5e76\u4ece\u4e2d\u6536\u96c6\u8f93\u51fa\u3002\u5373\u4f7f Ansible \u672c\u8eab\u5728\u6210\u957f\u548c\u53d1\u5c55\uff0c\u5b83\u4e5f\u4f1a\u63d0\u4f9b\u4e00\u4e2a\u4e0d\u53d8\u7684\u901a\u7528\u63a5\u53e3\u3002 \u8be6\u7ec6\u6587\u6863\u8bf7\u770b https://ansible-runner.readthedocs.io/en/latest/ \u73af\u5883 \u00b6 os Centos 7.7 X64 ansible 2.9.6.0 python 2.7.5 \u5b89\u88c5 \u00b6 yum -y install gcc python-devel python-pip pip install ansible_runner \u793a\u4f8b \u00b6 #!/bin/env python #! coding: utf-8 import ansible_runner data_dir = \"/tmp/demo\" myhosts = \"/etc/ansible/hosts\" print ( \"\u6267\u884cmodule\" ) m = ansible_runner . run ( private_data_dir = data_dir , inventory = myhosts , host_pattern = 'localhost' , module = 'shell' , module_args = 'whoami' , extravars = { \"ansible_ssh_pass\" : \"123456\" }) print ( \" {} : {} \" . format ( m . status , m . rc )) # successful: 0 for each_host_event in m . events : print ( each_host_event [ 'event' ]) print ( \"Final status:\" , m . stats ) print ( \"\u6267\u884cplaybook\" ) # config\u914d\u7f6e rc = ansible_runner . RunnerConfig ( private_data_dir = data_dir , playbook = '/etc/ansible/test.yml' , inventory = myhosts , extravars = { \"ansible_test\" : \"test_playbook\" }) # \u57fa\u672c\u68c0\u67e5 rc . prepare () # \u6267\u884c r = ansible_runner . Runner ( config = rc ) p = r . run () if 'failed' in p : print ( 'Exec error:' , p ) else : # successful: 0 for each_host_event in r . events : print ( each_host_event [ 'event' ]) print ( \"Final status:\" , p [ 1 ]) \u6267\u884c\u7ed3\u679c # python test_api.py \u6267\u884cmodule localhost | CHANGED | rc = 0 >> root successful: 0 playbook_on_start runner_on_start runner_on_ok playbook_on_stats ( 'Final status:' , { 'dark' : {} , 'skipped' : {} , 'ok' : { u 'localhost' : 1 } , 'processed' : { u 'localhost' : 1 } , 'failures' : {} , 'changed' : { u 'localhost' : 1 }}) \u6267\u884cplaybook PLAY [ all ] ********************************************************************* TASK [ hello ] ******************************************************************* ok: [ localhost ] = > { \"msg\" : \"hello, ansible.\" } TASK [ show var ] **************************************************************** ok: [ localhost ] = > { \"ansible_test\" : \"test_playbook\" } PLAY RECAP ********************************************************************* localhost : ok = 2 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 playbook_on_start playbook_on_start runner_on_start playbook_on_play_start runner_on_ok playbook_on_task_start playbook_on_stats runner_on_start runner_on_ok playbook_on_task_start runner_on_start runner_on_ok playbook_on_stats ( 'Final status:' , 0 ) RunnerConfig\u7684\u53c2\u6570\u5217\u8868 \u00b6 private_data_dir=None playbook=None ident=uuid4() inventory=None roles_path=None limit=None module=None module_args=None verbosity=None quiet=False json_mode=False artifact_dir=None rotate_artifacts=0 host_pattern=None binary=None extravars=None suppress_ansible_output=False process_isolation=False process_isolation_executable=None process_isolation_path=None process_isolation_hide_paths=None process_isolation_show_paths=None process_isolation_ro_paths=None resource_profiling=False resource_profiling_base_cgroup='ansible-runner' resource_profiling_cpu_poll_interval=0.25 resource_profiling_memory_poll_interval=0.25 resource_profiling_pid_poll_interval=0.25 resource_profiling_results_dir=None tags=None skip_tags=None fact_cache_type='jsonfile' fact_cache=None ssh_key=None project_dir=None directory_isolation_base_path=None envvars=None forks=None cmdline=None omit_event_data=False only_failed_event_data=False","title":"\u4f7f\u7528 ansible runner"},{"location":"dev/api/api-ansible-runner/#ansible-runner","text":"Ansible Runner \u662fansible\u5b98\u65b9\u63d0\u4f9b\u7684\u4e00\u4e2a\u5de5\u5177\u548cpython\u5e93\uff0c\u5f53\u76f4\u63a5\u4e0eAnsible\u8fdb\u884c\u4ea4\u4e92\u6216\u4f5c\u4e3a\u53e6\u4e00\u4e2a\u7cfb\u7edf\u7684\u4e00\u90e8\u5206\u4e0eAnsible\u8fdb\u884c\u4ea4\u4e92\u65f6\uff0c\u65e0\u8bba\u662f\u901a\u8fc7\u5bb9\u5668\u6620\u50cf\u63a5\u53e3\uff0c\u4f5c\u4e3a\u72ec\u7acb\u5de5\u5177\u8fd8\u662f\u4f5c\u4e3a\u53ef\u4ee5\u5bfc\u5165\u7684Python\u6a21\u5757\uff0c\u5b83\u90fd\u53ef\u4ee5\u63d0\u4f9b\u5e2e\u52a9\u3002 \u76ee\u7684\u662f\u4e3aAnsible\u63d0\u4f9b\u7a33\u5b9a\u4e14\u4e00\u81f4\u7684\u63a5\u53e3\u62bd\u8c61\u3002 Ansible Runner \u5728 Ansible Tower / AWX \u4e2d\u8d1f\u8d23\u8fd0\u884c ansible \u548c ansible-playbook \u4efb\u52a1\u7684\u90e8\u5206\u6a21\u5757\u5316\uff0c\u5e76\u4ece\u4e2d\u6536\u96c6\u8f93\u51fa\u3002\u5373\u4f7f Ansible \u672c\u8eab\u5728\u6210\u957f\u548c\u53d1\u5c55\uff0c\u5b83\u4e5f\u4f1a\u63d0\u4f9b\u4e00\u4e2a\u4e0d\u53d8\u7684\u901a\u7528\u63a5\u53e3\u3002 \u8be6\u7ec6\u6587\u6863\u8bf7\u770b https://ansible-runner.readthedocs.io/en/latest/","title":"Ansible Runner"},{"location":"dev/api/api-ansible-runner/#_1","text":"os Centos 7.7 X64 ansible 2.9.6.0 python 2.7.5","title":"\u73af\u5883"},{"location":"dev/api/api-ansible-runner/#_2","text":"yum -y install gcc python-devel python-pip pip install ansible_runner","title":"\u5b89\u88c5"},{"location":"dev/api/api-ansible-runner/#_3","text":"#!/bin/env python #! coding: utf-8 import ansible_runner data_dir = \"/tmp/demo\" myhosts = \"/etc/ansible/hosts\" print ( \"\u6267\u884cmodule\" ) m = ansible_runner . run ( private_data_dir = data_dir , inventory = myhosts , host_pattern = 'localhost' , module = 'shell' , module_args = 'whoami' , extravars = { \"ansible_ssh_pass\" : \"123456\" }) print ( \" {} : {} \" . format ( m . status , m . rc )) # successful: 0 for each_host_event in m . events : print ( each_host_event [ 'event' ]) print ( \"Final status:\" , m . stats ) print ( \"\u6267\u884cplaybook\" ) # config\u914d\u7f6e rc = ansible_runner . RunnerConfig ( private_data_dir = data_dir , playbook = '/etc/ansible/test.yml' , inventory = myhosts , extravars = { \"ansible_test\" : \"test_playbook\" }) # \u57fa\u672c\u68c0\u67e5 rc . prepare () # \u6267\u884c r = ansible_runner . Runner ( config = rc ) p = r . run () if 'failed' in p : print ( 'Exec error:' , p ) else : # successful: 0 for each_host_event in r . events : print ( each_host_event [ 'event' ]) print ( \"Final status:\" , p [ 1 ]) \u6267\u884c\u7ed3\u679c # python test_api.py \u6267\u884cmodule localhost | CHANGED | rc = 0 >> root successful: 0 playbook_on_start runner_on_start runner_on_ok playbook_on_stats ( 'Final status:' , { 'dark' : {} , 'skipped' : {} , 'ok' : { u 'localhost' : 1 } , 'processed' : { u 'localhost' : 1 } , 'failures' : {} , 'changed' : { u 'localhost' : 1 }}) \u6267\u884cplaybook PLAY [ all ] ********************************************************************* TASK [ hello ] ******************************************************************* ok: [ localhost ] = > { \"msg\" : \"hello, ansible.\" } TASK [ show var ] **************************************************************** ok: [ localhost ] = > { \"ansible_test\" : \"test_playbook\" } PLAY RECAP ********************************************************************* localhost : ok = 2 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 playbook_on_start playbook_on_start runner_on_start playbook_on_play_start runner_on_ok playbook_on_task_start playbook_on_stats runner_on_start runner_on_ok playbook_on_task_start runner_on_start runner_on_ok playbook_on_stats ( 'Final status:' , 0 )","title":"\u793a\u4f8b"},{"location":"dev/api/api-ansible-runner/#runnerconfig","text":"private_data_dir=None playbook=None ident=uuid4() inventory=None roles_path=None limit=None module=None module_args=None verbosity=None quiet=False json_mode=False artifact_dir=None rotate_artifacts=0 host_pattern=None binary=None extravars=None suppress_ansible_output=False process_isolation=False process_isolation_executable=None process_isolation_path=None process_isolation_hide_paths=None process_isolation_show_paths=None process_isolation_ro_paths=None resource_profiling=False resource_profiling_base_cgroup='ansible-runner' resource_profiling_cpu_poll_interval=0.25 resource_profiling_memory_poll_interval=0.25 resource_profiling_pid_poll_interval=0.25 resource_profiling_results_dir=None tags=None skip_tags=None fact_cache_type='jsonfile' fact_cache=None ssh_key=None project_dir=None directory_isolation_base_path=None envvars=None forks=None cmdline=None omit_event_data=False only_failed_event_data=False","title":"RunnerConfig\u7684\u53c2\u6570\u5217\u8868"},{"location":"dev/api/api-playbook/","text":"\u4f7f\u7528 API \u8fd0\u884c playbook \u00b6 \u9700\u6c42 \u00b6 \u4f7f\u7528 Ansible API\u7684\u65b9\u5f0f\u6267\u884cplaybook\u4e2d\u7684\u4efb\u52a1 \u73af\u5883 \u00b6 os Centos 7.7 X64 ansible 2.9.6.0 python 2.7.5 \u4e3b\u673a\u6e05\u5355 \u00b6 # cat /etc/ansible/hosts [test] node1 ansible_ssh_host = 192.168.77.130 ansible_port=22 node2 ansible_ssh_host = 192.168.77.130 ansible_port=22 api \u793a\u4f8b \u00b6 #!/bin/env python #! coding: utf-8 import os from ansible.module_utils.common.collections import ImmutableDict from ansible.parsing.dataloader import DataLoader from ansible.vars.manager import VariableManager from ansible.inventory.manager import InventoryManager from ansible.executor.playbook_executor import PlaybookExecutor from ansible import context # \u8bbe\u7f6eansible\u9009\u9879 context . CLIARGS = ImmutableDict ( connection = 'smart' , module_path = [ '/to/mymodules' ], forks = 10 , become = None , become_method = None , become_user = None , check = False , diff = False , syntax = False , start_at_task = None ) # \u8bbe\u7f6e\u4e3b\u673a\u5bc6\u7801\uff0c\u4e3b\u673a\u672a\u5b9a\u4e49\u5bc6\u7801\u7684\u65f6\u5019\u624d\u751f\u6548\uff0cconn_pass\u6307\u8fde\u63a5\u8fdc\u7aef\u7684\u5bc6\u7801\uff0cbecome_pass\u6307\u63d0\u5347\u6743\u9650\u7684\u5bc6\u7801 passwords = dict ( conn_pass = '123456' , become_pass = '123456' ) # \u4e3b\u673a\u6e05\u5355\u6587\u4ef6 host_path = '/etc/ansible/hosts' if not os . path . exists ( host_path ): print '[INFO] The [ %s ] inventory does not exist' % host_path sys . exit () # \u521d\u59cb\u8bdd\u9700\u8981\u7684\u7c7b variable_manager = VariableManager () # \u7528\u6765\u7ba1\u7406\u53d8\u91cf\uff0c\u5305\u62ec\u4e3b\u673a\u3001\u7ec4\u3001\u6269\u5c55\u7b49\u53d8\u91cf\uff0c\u8be5\u7c7b\u5728\u4e4b\u524d\u7684Inventory\u5185\u7f6e # \u9700\u8981\u521d\u59cb\u5316\u7684\u5bf9\u8c61 loader = DataLoader () # \u8d1f\u8d23\u67e5\u627e\u548c\u8bfb\u53d6yaml\uff0cjson\u548cini\u6587\u4ef6 # \u521b\u5efa\u4e3b\u673a\u6e05\u5355\uff0c\u4f7f\u7528path\u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6\u7684\u6e90\u6587\u4ef6\uff0c\u6216\u8005\u7528\u9017\u53f7\u5206\u9694\u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a\u4e3b\u673a inventory = InventoryManager ( loader = loader , sources = host_path ) # \u53d8\u91cf\u7ba1\u7406\u5668\u8d1f\u8d23\u5408\u5e76\u6240\u6709\u4e0d\u540c\u7684\u6e90 variable_manager = VariableManager ( loader = loader , inventory = inventory ) # \u591a\u4e2ayaml\u6587\u4ef6\u5219\u4ee5\u5217\u8868\u5f62\u5f0f playbook_path = [ '/etc/ansible/test.yml' ] for i in playbook_path : if not os . path . exists ( i ): print '[INFO] The [ %s ] playbook does not exist' % i sys . exit () playbook = PlaybookExecutor ( playbooks = playbook_path , inventory = inventory , variable_manager = variable_manager , loader = loader , passwords = passwords ) # \u6267\u884cplaybook result = playbook . run () # \u8fd4\u56de\u6267\u884c\u7ed3\u679c print ( '\u6267\u884c\u7ed3\u679c: %s ' % result ) \u6267\u884c\u7ed3\u679c \u00b6 # python test-playbook.py PLAY [ all ] ******************************************************************************************************************************************************************************************* TASK [ hello ] ***************************************************************************************************************************************************************************************** ok: [ node1 ] = > { \"msg\" : \"hello api.\" } PLAY RECAP ******************************************************************************************************************************************************************************************* node1 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u6267\u884c\u7ed3\u679c: 0 [ root@node130 ansible ] # vim hosts [ root@node130 ansible ] # python test_playbook.py PLAY [ all ] ******************************************************************************************************************************************************************************************* TASK [ hello ] ***************************************************************************************************************************************************************************************** ok: [ node1 ] = > { \"msg\" : \"hello api.\" } ok: [ node2 ] = > { \"msg\" : \"hello api.\" } PLAY RECAP ******************************************************************************************************************************************************************************************* node1 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 node2 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u6267\u884c\u7ed3\u679c: 0","title":"\u4f7f\u7528 API \u8fd0\u884c Palybook"},{"location":"dev/api/api-playbook/#api-playbook","text":"","title":"\u4f7f\u7528 API \u8fd0\u884c playbook"},{"location":"dev/api/api-playbook/#_1","text":"\u4f7f\u7528 Ansible API\u7684\u65b9\u5f0f\u6267\u884cplaybook\u4e2d\u7684\u4efb\u52a1","title":"\u9700\u6c42"},{"location":"dev/api/api-playbook/#_2","text":"os Centos 7.7 X64 ansible 2.9.6.0 python 2.7.5","title":"\u73af\u5883"},{"location":"dev/api/api-playbook/#_3","text":"# cat /etc/ansible/hosts [test] node1 ansible_ssh_host = 192.168.77.130 ansible_port=22 node2 ansible_ssh_host = 192.168.77.130 ansible_port=22","title":"\u4e3b\u673a\u6e05\u5355"},{"location":"dev/api/api-playbook/#api","text":"#!/bin/env python #! coding: utf-8 import os from ansible.module_utils.common.collections import ImmutableDict from ansible.parsing.dataloader import DataLoader from ansible.vars.manager import VariableManager from ansible.inventory.manager import InventoryManager from ansible.executor.playbook_executor import PlaybookExecutor from ansible import context # \u8bbe\u7f6eansible\u9009\u9879 context . CLIARGS = ImmutableDict ( connection = 'smart' , module_path = [ '/to/mymodules' ], forks = 10 , become = None , become_method = None , become_user = None , check = False , diff = False , syntax = False , start_at_task = None ) # \u8bbe\u7f6e\u4e3b\u673a\u5bc6\u7801\uff0c\u4e3b\u673a\u672a\u5b9a\u4e49\u5bc6\u7801\u7684\u65f6\u5019\u624d\u751f\u6548\uff0cconn_pass\u6307\u8fde\u63a5\u8fdc\u7aef\u7684\u5bc6\u7801\uff0cbecome_pass\u6307\u63d0\u5347\u6743\u9650\u7684\u5bc6\u7801 passwords = dict ( conn_pass = '123456' , become_pass = '123456' ) # \u4e3b\u673a\u6e05\u5355\u6587\u4ef6 host_path = '/etc/ansible/hosts' if not os . path . exists ( host_path ): print '[INFO] The [ %s ] inventory does not exist' % host_path sys . exit () # \u521d\u59cb\u8bdd\u9700\u8981\u7684\u7c7b variable_manager = VariableManager () # \u7528\u6765\u7ba1\u7406\u53d8\u91cf\uff0c\u5305\u62ec\u4e3b\u673a\u3001\u7ec4\u3001\u6269\u5c55\u7b49\u53d8\u91cf\uff0c\u8be5\u7c7b\u5728\u4e4b\u524d\u7684Inventory\u5185\u7f6e # \u9700\u8981\u521d\u59cb\u5316\u7684\u5bf9\u8c61 loader = DataLoader () # \u8d1f\u8d23\u67e5\u627e\u548c\u8bfb\u53d6yaml\uff0cjson\u548cini\u6587\u4ef6 # \u521b\u5efa\u4e3b\u673a\u6e05\u5355\uff0c\u4f7f\u7528path\u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6\u7684\u6e90\u6587\u4ef6\uff0c\u6216\u8005\u7528\u9017\u53f7\u5206\u9694\u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a\u4e3b\u673a inventory = InventoryManager ( loader = loader , sources = host_path ) # \u53d8\u91cf\u7ba1\u7406\u5668\u8d1f\u8d23\u5408\u5e76\u6240\u6709\u4e0d\u540c\u7684\u6e90 variable_manager = VariableManager ( loader = loader , inventory = inventory ) # \u591a\u4e2ayaml\u6587\u4ef6\u5219\u4ee5\u5217\u8868\u5f62\u5f0f playbook_path = [ '/etc/ansible/test.yml' ] for i in playbook_path : if not os . path . exists ( i ): print '[INFO] The [ %s ] playbook does not exist' % i sys . exit () playbook = PlaybookExecutor ( playbooks = playbook_path , inventory = inventory , variable_manager = variable_manager , loader = loader , passwords = passwords ) # \u6267\u884cplaybook result = playbook . run () # \u8fd4\u56de\u6267\u884c\u7ed3\u679c print ( '\u6267\u884c\u7ed3\u679c: %s ' % result )","title":"api \u793a\u4f8b"},{"location":"dev/api/api-playbook/#_4","text":"# python test-playbook.py PLAY [ all ] ******************************************************************************************************************************************************************************************* TASK [ hello ] ***************************************************************************************************************************************************************************************** ok: [ node1 ] = > { \"msg\" : \"hello api.\" } PLAY RECAP ******************************************************************************************************************************************************************************************* node1 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u6267\u884c\u7ed3\u679c: 0 [ root@node130 ansible ] # vim hosts [ root@node130 ansible ] # python test_playbook.py PLAY [ all ] ******************************************************************************************************************************************************************************************* TASK [ hello ] ***************************************************************************************************************************************************************************************** ok: [ node1 ] = > { \"msg\" : \"hello api.\" } ok: [ node2 ] = > { \"msg\" : \"hello api.\" } PLAY RECAP ******************************************************************************************************************************************************************************************* node1 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 node2 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u6267\u884c\u7ed3\u679c: 0","title":"\u6267\u884c\u7ed3\u679c"},{"location":"dev/api/api-suitable/","text":"\u4f7f\u7528 suitable \u00b6 \u524d\u9762\u6211\u4eec\u4f7f\u7528\u4e86\u5b98\u65b9\u63d0\u4f9b\u7684\u5185\u90e8API\u63a5\u53e3\uff0c\u56e0\u4e3a\u662fansible\u5185\u90e8\u4f7f\u7528\u7684\uff0c\u6240\u4ee5\u5165\u624b\u8fd8\u662f\u6bd4\u8f83\u96be\u7684\uff0c\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u5f00\u6e90\u7684\u5bf9ansible api\u8fdb\u884c\u5c01\u88c5\u540e\u7684\u4e00\u4e2a\u9879\u76ee suitable \uff0c\u5173\u4e8e\u5b83\u5230\u8be6\u7ec6\u4fe1\u606f\u53ef\u4ee5\u67e5\u770b \u9879\u76ee\u6587\u6863 \u3002 \u672c\u6587\u4ec5\u7528\u5c0f\u4f8b\u5b50\u6765\u7b80\u5355\u4f7f\u7528suitable\u3002 \u73af\u5883 \u00b6 os Centos 7.7 X64 ansible 2.9.6.0 python 2.7.5 \u5b89\u88c5 \u00b6 pip install suitable \u793a\u4f8b \u00b6 from suitable import Api api = Api ( servers = [ '192.168.77.130' ], connection = 'smart' , remote_user = 'root' , remote_pass = '123456' , become = True , become_user = 'root' , sudo = True , ssh_extra_args = '-o StrictHostKeyChecking=no' ) facts_data = api . setup () shell_result = api . shell ( 'whoami' ) command_result = api . command ( 'whoami' ) print ( 'facts:' , facts_data ) print ( 'shell:' , shell_result ) print ( 'command:' , command_result ) \u6267\u884c\u7ed3\u679c # python test.py ( 'facts:' , { 'unreachable' : {} , 'contacted' : { '192.168.77.130' : { '_ansible_no_log' : False, 'success' : True, u 'invocation' : { u 'module_args' : { u 'filter' : u '*' , u 'gather_subset' : [ u 'all' ] , u 'fact_path' : u '/etc/ansible/facts.d' , u 'gather_timeout' : 10 }} , 'changed' : False, '_ansible_verbose_override' : True, u 'ansible_facts' : { u 'ansible_processor_count' : ..... # \u7701\u7565\u4e00\u5927\u90e8\u5206\u5185\u5bb9 u 'cap_sys_tty_config' , u 'cap_mknod' , u 'cap_lease' , u 'cap_audit_write' , u 'cap_audit_control' , u 'cap_setfcap' , u 'cap_mac_override' , u 'cap_mac_admin' , u 'cap_syslog' , u '35' , u '36' , u '37+ep' ] , u 'ansible_processor_threads_per_core' : 1 , u 'ansible_product_name' : u 'VMware Virtual Platform' , u 'ansible_all_ipv4_addresses' : [ u '172.17.0.1' , u '192.168.77.130' ] , u 'ansible_python_version' : u '2.7.5' }}}}) ( 'shell:' , { 'unreachable' : {} , 'contacted' : { '192.168.77.130' : { 'stderr_lines' : [] , u 'changed' : True, u 'end' : u '2020-05-04 22:30:18.457327' , '_ansible_no_log' : False, 'success' : True, u 'stdout' : u 'root' , u 'cmd' : u 'whoami' , u 'start' : u '2020-05-04 22:30:18.408973' , u 'delta' : u '0:00:00.048354' , u 'stderr' : u '' , u 'rc' : 0 , u 'invocation' : { u 'module_args' : { u 'warn' : True, u 'executable' : None, u '_uses_shell' : True, u 'strip_empty_ends' : True, u '_raw_params' : u 'whoami' , u 'removes' : None, u 'argv' : None, u 'creates' : None, u 'chdir' : None, u 'stdin_add_newline' : True, u 'stdin' : None }} , 'stdout_lines' : [ u 'root' ] , 'ansible_facts' : { u 'discovered_interpreter_python' : u '/usr/bin/python' }}}}) ( 'command:' , { 'unreachable' : {} , 'contacted' : { '192.168.77.130' : { 'stderr_lines' : [] , u 'changed' : True, u 'end' : u '2020-05-04 22:30:18.741639' , '_ansible_no_log' : False, 'success' : True, u 'stdout' : u 'root' , u 'cmd' : [ u 'whoami' ] , u 'start' : u '2020-05-04 22:30:18.737730' , u 'delta' : u '0:00:00.003909' , u 'stderr' : u '' , u 'rc' : 0 , u 'invocation' : { u 'module_args' : { u 'warn' : True, u 'executable' : None, u '_uses_shell' : False, u 'strip_empty_ends' : True, u '_raw_params' : u 'whoami' , u 'removes' : None, u 'argv' : None, u 'creates' : None, u 'chdir' : None, u 'stdin_add_newline' : True, u 'stdin' : None }} , 'stdout_lines' : [ u 'root' ] , 'ansible_facts' : { u 'discovered_interpreter_python' : u '/usr/bin/python' }}}}) API \u53c2\u6570 \u00b6 \u5217\u51fa\u5e38\u7528\u7684\u53c2\u6570 servers \u00b6 \u4e3b\u673a\u5217\u8868\u7684\u793a\u4f8b api = Api(['web.example.org', 'db.example.org']) api = Api('web.example.org') api = Api('web.example.org db.example.org') api = Api({'web.example.org': {'ansible_host': '10.10.5.1'}}) api = Api(['example.org:2222', 'example.org:2223']) sudo \u00b6 \u7528\u4e8e\u63d0\u6743 Api ( 'example.org' , become = True, become_user = 'root' , become_method = 'sudo ' become_pass = \u2018123456\u2019 ) environment \u00b6 \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf api = Api ( 'example.org' , environment ={ 'PGPORT' : '5432' }) extra_vars \u00b6 \u8bbe\u7f6e\u989d\u5916\u53d8\u91cf\uff0c\u8fd9\u4e9b\u53d8\u91cf\u662f\u5168\u5c40\u53d8\u91cf api = Api ( 'example.org' , extra_vars = { 'ansible_python_interpreter' : '/path/to/interpreter' }) \u5176\u4ed6\u53c2\u6570 \u00b6 ignore_unreachable ignore_errors host_key_checking sudo dry_run strategy forks private_key_file ssh_common_args ssh_extra_args sftp_extra_args scp_extra_args extra_vars diff verbosity check \u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u53ef\u4ee5\u67e5\u770b \u9879\u76ee\u6587\u6863 \u3002","title":"\u4f7f\u7528 suitable"},{"location":"dev/api/api-suitable/#suitable","text":"\u524d\u9762\u6211\u4eec\u4f7f\u7528\u4e86\u5b98\u65b9\u63d0\u4f9b\u7684\u5185\u90e8API\u63a5\u53e3\uff0c\u56e0\u4e3a\u662fansible\u5185\u90e8\u4f7f\u7528\u7684\uff0c\u6240\u4ee5\u5165\u624b\u8fd8\u662f\u6bd4\u8f83\u96be\u7684\uff0c\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u5f00\u6e90\u7684\u5bf9ansible api\u8fdb\u884c\u5c01\u88c5\u540e\u7684\u4e00\u4e2a\u9879\u76ee suitable \uff0c\u5173\u4e8e\u5b83\u5230\u8be6\u7ec6\u4fe1\u606f\u53ef\u4ee5\u67e5\u770b \u9879\u76ee\u6587\u6863 \u3002 \u672c\u6587\u4ec5\u7528\u5c0f\u4f8b\u5b50\u6765\u7b80\u5355\u4f7f\u7528suitable\u3002","title":"\u4f7f\u7528 suitable"},{"location":"dev/api/api-suitable/#_1","text":"os Centos 7.7 X64 ansible 2.9.6.0 python 2.7.5","title":"\u73af\u5883"},{"location":"dev/api/api-suitable/#_2","text":"pip install suitable","title":"\u5b89\u88c5"},{"location":"dev/api/api-suitable/#_3","text":"from suitable import Api api = Api ( servers = [ '192.168.77.130' ], connection = 'smart' , remote_user = 'root' , remote_pass = '123456' , become = True , become_user = 'root' , sudo = True , ssh_extra_args = '-o StrictHostKeyChecking=no' ) facts_data = api . setup () shell_result = api . shell ( 'whoami' ) command_result = api . command ( 'whoami' ) print ( 'facts:' , facts_data ) print ( 'shell:' , shell_result ) print ( 'command:' , command_result ) \u6267\u884c\u7ed3\u679c # python test.py ( 'facts:' , { 'unreachable' : {} , 'contacted' : { '192.168.77.130' : { '_ansible_no_log' : False, 'success' : True, u 'invocation' : { u 'module_args' : { u 'filter' : u '*' , u 'gather_subset' : [ u 'all' ] , u 'fact_path' : u '/etc/ansible/facts.d' , u 'gather_timeout' : 10 }} , 'changed' : False, '_ansible_verbose_override' : True, u 'ansible_facts' : { u 'ansible_processor_count' : ..... # \u7701\u7565\u4e00\u5927\u90e8\u5206\u5185\u5bb9 u 'cap_sys_tty_config' , u 'cap_mknod' , u 'cap_lease' , u 'cap_audit_write' , u 'cap_audit_control' , u 'cap_setfcap' , u 'cap_mac_override' , u 'cap_mac_admin' , u 'cap_syslog' , u '35' , u '36' , u '37+ep' ] , u 'ansible_processor_threads_per_core' : 1 , u 'ansible_product_name' : u 'VMware Virtual Platform' , u 'ansible_all_ipv4_addresses' : [ u '172.17.0.1' , u '192.168.77.130' ] , u 'ansible_python_version' : u '2.7.5' }}}}) ( 'shell:' , { 'unreachable' : {} , 'contacted' : { '192.168.77.130' : { 'stderr_lines' : [] , u 'changed' : True, u 'end' : u '2020-05-04 22:30:18.457327' , '_ansible_no_log' : False, 'success' : True, u 'stdout' : u 'root' , u 'cmd' : u 'whoami' , u 'start' : u '2020-05-04 22:30:18.408973' , u 'delta' : u '0:00:00.048354' , u 'stderr' : u '' , u 'rc' : 0 , u 'invocation' : { u 'module_args' : { u 'warn' : True, u 'executable' : None, u '_uses_shell' : True, u 'strip_empty_ends' : True, u '_raw_params' : u 'whoami' , u 'removes' : None, u 'argv' : None, u 'creates' : None, u 'chdir' : None, u 'stdin_add_newline' : True, u 'stdin' : None }} , 'stdout_lines' : [ u 'root' ] , 'ansible_facts' : { u 'discovered_interpreter_python' : u '/usr/bin/python' }}}}) ( 'command:' , { 'unreachable' : {} , 'contacted' : { '192.168.77.130' : { 'stderr_lines' : [] , u 'changed' : True, u 'end' : u '2020-05-04 22:30:18.741639' , '_ansible_no_log' : False, 'success' : True, u 'stdout' : u 'root' , u 'cmd' : [ u 'whoami' ] , u 'start' : u '2020-05-04 22:30:18.737730' , u 'delta' : u '0:00:00.003909' , u 'stderr' : u '' , u 'rc' : 0 , u 'invocation' : { u 'module_args' : { u 'warn' : True, u 'executable' : None, u '_uses_shell' : False, u 'strip_empty_ends' : True, u '_raw_params' : u 'whoami' , u 'removes' : None, u 'argv' : None, u 'creates' : None, u 'chdir' : None, u 'stdin_add_newline' : True, u 'stdin' : None }} , 'stdout_lines' : [ u 'root' ] , 'ansible_facts' : { u 'discovered_interpreter_python' : u '/usr/bin/python' }}}})","title":"\u793a\u4f8b"},{"location":"dev/api/api-suitable/#api","text":"\u5217\u51fa\u5e38\u7528\u7684\u53c2\u6570","title":"API \u53c2\u6570"},{"location":"dev/api/api-suitable/#servers","text":"\u4e3b\u673a\u5217\u8868\u7684\u793a\u4f8b api = Api(['web.example.org', 'db.example.org']) api = Api('web.example.org') api = Api('web.example.org db.example.org') api = Api({'web.example.org': {'ansible_host': '10.10.5.1'}}) api = Api(['example.org:2222', 'example.org:2223'])","title":"servers"},{"location":"dev/api/api-suitable/#sudo","text":"\u7528\u4e8e\u63d0\u6743 Api ( 'example.org' , become = True, become_user = 'root' , become_method = 'sudo ' become_pass = \u2018123456\u2019 )","title":"sudo"},{"location":"dev/api/api-suitable/#environment","text":"\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf api = Api ( 'example.org' , environment ={ 'PGPORT' : '5432' })","title":"environment"},{"location":"dev/api/api-suitable/#extra_vars","text":"\u8bbe\u7f6e\u989d\u5916\u53d8\u91cf\uff0c\u8fd9\u4e9b\u53d8\u91cf\u662f\u5168\u5c40\u53d8\u91cf api = Api ( 'example.org' , extra_vars = { 'ansible_python_interpreter' : '/path/to/interpreter' })","title":"extra_vars"},{"location":"dev/api/api-suitable/#_4","text":"ignore_unreachable ignore_errors host_key_checking sudo dry_run strategy forks private_key_file ssh_common_args ssh_extra_args sftp_extra_args scp_extra_args extra_vars diff verbosity check \u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u53ef\u4ee5\u67e5\u770b \u9879\u76ee\u6587\u6863 \u3002","title":"\u5176\u4ed6\u53c2\u6570"},{"location":"dev/api/api-task/","text":"\u4f7f\u7528 API \u8fd0\u884c task \u00b6 \u9700\u6c42 \u00b6 \u4f7f\u7528 Ansible API\u7684\u65b9\u5f0f\u6267\u884ctask\u4efb\u52a1 \u73af\u5883 \u00b6 os Centos 7.7 X64 ansible 2.9.6.0 python 2.7.5 api \u793a\u4f8b \u00b6 #!/usr/bin/env python #! coding: utf-8 import json import shutil from ansible.module_utils.common.collections import ImmutableDict from ansible.parsing.dataloader import DataLoader from ansible.vars.manager import VariableManager from ansible.inventory.manager import InventoryManager from ansible.playbook.play import Play from ansible.executor.task_queue_manager import TaskQueueManager from ansible.plugins.callback import CallbackBase from ansible import context import ansible.constants as C class ResultCallback ( CallbackBase ): \"\"\"\u81ea\u5b9a\u4e49 callback\uff0c\u5373\u5728\u8fd0\u884c api \u540e\u8c03\u7528\u672c\u7c7b\u4e2d\u7684 v2_runner_on_ok() \"\"\" def v2_runner_on_ok ( self , result , ** kwargs ): \"\"\"\u6253\u5370\u4e00\u4e2ajson\u6570\u636e\u7684\u7ed3\u679c \"\"\" host = result . _host print ( json . dumps ({ host . name : result . _result }, indent = 4 )) print ( '---' ) # \u8bbe\u7f6eansible\u9009\u9879 context . CLIARGS = ImmutableDict ( connection = 'local' , module_path = [ '/to/mymodules' ], forks = 10 , become = None , become_method = None , become_user = None , check = False , diff = False ) # \u9700\u8981\u521d\u59cb\u5316\u7684\u5bf9\u8c61 loader = DataLoader () # \u8d1f\u8d23\u67e5\u627e\u548c\u8bfb\u53d6yaml\uff0cjson\u548cini\u6587\u4ef6 # \u8bbe\u7f6e\u4e3b\u673a\u5bc6\u7801\uff0c\u4e3b\u673a\u672a\u5b9a\u4e49\u5bc6\u7801\u7684\u65f6\u5019\u624d\u751f\u6548\uff0cconn_pass\u6307\u8fde\u63a5\u8fdc\u7aef\u7684\u5bc6\u7801\uff0cbecome_pass\u6307\u63d0\u5347\u6743\u9650\u7684\u5bc6\u7801 passwords = dict ( conn_pass = '123456' , become_pass = '123456' ) # \u5b9e\u4f8b\u5316ResultCallback\uff0c\u6765\u5904\u7406\u8f93\u51fa\u7ed3\u679c results_callback = ResultCallback () # \u521b\u5efa\u4e3b\u673a\u6e05\u5355\uff0c\u4f7f\u7528path\u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6\u7684\u6e90\u6587\u4ef6\uff0c\u6216\u8005\u7528\u9017\u53f7\u5206\u9694\u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a\u4e3b\u673a inventory = InventoryManager ( loader = loader , sources = 'localhost,' ) # \u53d8\u91cf\u7ba1\u7406\u5668\u8d1f\u8d23\u5408\u5e76\u6240\u6709\u4e0d\u540c\u7684\u6e90 variable_manager = VariableManager ( loader = loader , inventory = inventory ) # \u521b\u5efa\u6570\u636e\u7ed3\u6784, \u8fd9\u91cc\u57fa\u672c\u4e0a\u6211\u4eecyaml\u6587\u4ef6\u5b9a\u4e49\u7684\u4fe1\u606f play_source = dict ( name = \"Ansible Play\" , # paly name hosts = 'localhost' , # patterns gather_facts = 'no' , # paly \u5173\u952e\u5b57 tasks = [ dict ( action = dict ( module = 'shell' , args = 'ls' ), register = 'shell_out' ), dict ( action = dict ( module = 'debug' , args = dict ( msg = '{{shell_out.stdout}}' ))) ] ) # \u521b\u5efaplay\u5bf9\u8c61\uff0cplaybook\u4f1a\u4f7f\u7528\u8fd9\u4e2a\u5bf9\u8c61 play = Play () . load ( play_source , variable_manager = variable_manager , loader = loader ) # \u5b9e\u4f8b\u5316\u4efb\u52a1\u961f\u5217\u7ba1\u7406\u5668\uff0c\u5b83\u8d1f\u8d23\u521b\u5efa\u548c\u8bbe\u7f6e\u6240\u6709\u5bf9\u8c61\u6765\u904d\u5386\u4e3b\u673a\u5217\u8868\u548c\u4efb\u52a1 tqm = None try : tqm = TaskQueueManager ( inventory = inventory , variable_manager = variable_manager , loader = loader , passwords = passwords , stdout_callback = results_callback , # \u4f7f\u7528\u81ea\u5b9a\u4e49\u7684callback\u63d2\u4ef6\uff0c\u9ed8\u8ba4\u662f`default`\u63d2\u4ef6 ) result = tqm . run ( play ) # \u5728\u961f\u5217\u4e2d\u6267\u884cplay print ( '\u4efb\u52a1\u6267\u884c\u8fd4\u56de\u7801: %s ' % result ) # \u8fd4\u56de\u7801\uff0c\u53ea\u8981\u6709\u4e00\u4e2a host \u51fa\u9519\u5c31\u4f1a\u8fd4\u56de \u975e0 \u6570\u5b57 finally : # \u603b\u662f\u8981\u6e05\u7406\u5b50\u8fdb\u7a0b\u548c\u5176\u901a\u4fe1\u4fe1\u606f if tqm is not None : tqm . cleanup () # \u5220\u9664 ansible \u4e34\u65f6\u76ee\u5f55 shutil . rmtree ( C . DEFAULT_LOCAL_TMP , True ) \u6267\u884c\u7ed3\u679c # python test-api.py { \"localhost\" : { \"stderr_lines\" : [] , \"changed\" : true, \"end\" : \"2020-05-03 23:02:39.296937\" , \"_ansible_no_log\" : false, \"stdout\" : \"ansible.cfg\\nasynctest.yaml\\ncallback_plugins\\ncsv_inventory\\ndebuger.yaml\\nfilter_plugins\\ngroup_vars\\nhosts\\nlibrary\\nplugins\\nroles\\nsplit.yml\\ntest-api.py\\ntest_black_hole.yml\\ntest_inventory_script.yml\\ntest_remote_copy.yml\\ntest_touch.yml\\ntest.yml\" , \"cmd\" : \"ls\" , \"start\" : \"2020-05-03 23:02:39.292814\" , \"delta\" : \"0:00:00.004123\" , \"stderr\" : \"\" , \"rc\" : 0 , \"invocation\" : { \"module_args\" : { \"warn\" : true, \"executable\" : null, \"_uses_shell\" : true, \"strip_empty_ends\" : true, \"_raw_params\" : \"ls\" , \"removes\" : null, \"argv\" : null, \"creates\" : null, \"chdir\" : null, \"stdin_add_newline\" : true, \"stdin\" : null } } , \"stdout_lines\" : [ \"ansible.cfg\" , \"asynctest.yaml\" , \"callback_plugins\" , \"csv_inventory\" , \"debuger.yaml\" , \"filter_plugins\" , \"group_vars\" , \"hosts\" , \"library\" , \"plugins\" , \"roles\" , \"split.yml\" , \"test-api.py\" , \"test_black_hole.yml\" , \"test_inventory_script.yml\" , \"test_remote_copy.yml\" , \"test_touch.yml\" , \"test.yml\" ] , \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } } } --- { \"localhost\" : { \"msg\" : \"ansible.cfg\\nasynctest.yaml\\ncallback_plugins\\ncsv_inventory\\ndebuger.yaml\\nfilter_plugins\\ngroup_vars\\nhosts\\nlibrary\\nplugins\\nroles\\nsplit.yml\\ntest-api.py\\ntest_black_hole.yml\\ntest_inventory_script.yml\\ntest_remote_copy.yml\\ntest_touch.yml\\ntest.yml\" , \"changed\" : false, \"_ansible_verbose_always\" : true, \"_ansible_no_log\" : false } } --- \u4efb\u52a1\u6267\u884c\u8fd4\u56de\u7801: 0 TaskQueueManager \u5b57\u6bb5\u8bf4\u660e \u00b6 inventory \u2192 \u7531ansible.inventory\u6a21\u5757\u521b\u5efa\uff0c\u7528\u4e8e\u5bfc\u5165inventory\u6587\u4ef6 variable_manager \u2192 \u7531ansible.vars\u6a21\u5757\u521b\u5efa\uff0c\u7528\u4e8e\u5b58\u50a8\u5404\u7c7b\u53d8\u91cf\u4fe1\u606f loader \u2192 \u7531ansible.parsing.dataloader\u6a21\u5757\u521b\u5efa\uff0c\u7528\u4e8e\u6570\u636e\u89e3\u6790 passwords \u2192 \u767b\u5f55\u5bc6\u7801\uff0c\u53ef\u8bbe\u7f6e\u52a0\u5bc6\u4fe1\u606f stdout_callback \u2192 \u56de\u8c03\u51fd\u6570 run_tree \u2192 \u662f\u5426\u4ee5tree\u6a21\u5f0f\u8fd0\u884c forks \u2192 \u8bbe\u7f6e\u5e76\u884c\u6570 TaskQueueManager.run\u65b9\u6cd5\u7684\u8fd4\u56de\u72b6\u6001\u7801 \u00b6 RUN_OK = 0 RUN_ERROR = 1 RUN_FAILED_HOSTS = 2 RUN_UNREACHABLE_HOSTS = 4 RUN_FAILED_BREAK_PLAY = 8 RUN_UNKNOWN_ERROR = 255","title":"\u4f7f\u7528 API \u8fd0\u884c\u4efb\u52a1"},{"location":"dev/api/api-task/#api-task","text":"","title":"\u4f7f\u7528 API \u8fd0\u884c task"},{"location":"dev/api/api-task/#_1","text":"\u4f7f\u7528 Ansible API\u7684\u65b9\u5f0f\u6267\u884ctask\u4efb\u52a1","title":"\u9700\u6c42"},{"location":"dev/api/api-task/#_2","text":"os Centos 7.7 X64 ansible 2.9.6.0 python 2.7.5","title":"\u73af\u5883"},{"location":"dev/api/api-task/#api","text":"#!/usr/bin/env python #! coding: utf-8 import json import shutil from ansible.module_utils.common.collections import ImmutableDict from ansible.parsing.dataloader import DataLoader from ansible.vars.manager import VariableManager from ansible.inventory.manager import InventoryManager from ansible.playbook.play import Play from ansible.executor.task_queue_manager import TaskQueueManager from ansible.plugins.callback import CallbackBase from ansible import context import ansible.constants as C class ResultCallback ( CallbackBase ): \"\"\"\u81ea\u5b9a\u4e49 callback\uff0c\u5373\u5728\u8fd0\u884c api \u540e\u8c03\u7528\u672c\u7c7b\u4e2d\u7684 v2_runner_on_ok() \"\"\" def v2_runner_on_ok ( self , result , ** kwargs ): \"\"\"\u6253\u5370\u4e00\u4e2ajson\u6570\u636e\u7684\u7ed3\u679c \"\"\" host = result . _host print ( json . dumps ({ host . name : result . _result }, indent = 4 )) print ( '---' ) # \u8bbe\u7f6eansible\u9009\u9879 context . CLIARGS = ImmutableDict ( connection = 'local' , module_path = [ '/to/mymodules' ], forks = 10 , become = None , become_method = None , become_user = None , check = False , diff = False ) # \u9700\u8981\u521d\u59cb\u5316\u7684\u5bf9\u8c61 loader = DataLoader () # \u8d1f\u8d23\u67e5\u627e\u548c\u8bfb\u53d6yaml\uff0cjson\u548cini\u6587\u4ef6 # \u8bbe\u7f6e\u4e3b\u673a\u5bc6\u7801\uff0c\u4e3b\u673a\u672a\u5b9a\u4e49\u5bc6\u7801\u7684\u65f6\u5019\u624d\u751f\u6548\uff0cconn_pass\u6307\u8fde\u63a5\u8fdc\u7aef\u7684\u5bc6\u7801\uff0cbecome_pass\u6307\u63d0\u5347\u6743\u9650\u7684\u5bc6\u7801 passwords = dict ( conn_pass = '123456' , become_pass = '123456' ) # \u5b9e\u4f8b\u5316ResultCallback\uff0c\u6765\u5904\u7406\u8f93\u51fa\u7ed3\u679c results_callback = ResultCallback () # \u521b\u5efa\u4e3b\u673a\u6e05\u5355\uff0c\u4f7f\u7528path\u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6\u7684\u6e90\u6587\u4ef6\uff0c\u6216\u8005\u7528\u9017\u53f7\u5206\u9694\u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a\u4e3b\u673a inventory = InventoryManager ( loader = loader , sources = 'localhost,' ) # \u53d8\u91cf\u7ba1\u7406\u5668\u8d1f\u8d23\u5408\u5e76\u6240\u6709\u4e0d\u540c\u7684\u6e90 variable_manager = VariableManager ( loader = loader , inventory = inventory ) # \u521b\u5efa\u6570\u636e\u7ed3\u6784, \u8fd9\u91cc\u57fa\u672c\u4e0a\u6211\u4eecyaml\u6587\u4ef6\u5b9a\u4e49\u7684\u4fe1\u606f play_source = dict ( name = \"Ansible Play\" , # paly name hosts = 'localhost' , # patterns gather_facts = 'no' , # paly \u5173\u952e\u5b57 tasks = [ dict ( action = dict ( module = 'shell' , args = 'ls' ), register = 'shell_out' ), dict ( action = dict ( module = 'debug' , args = dict ( msg = '{{shell_out.stdout}}' ))) ] ) # \u521b\u5efaplay\u5bf9\u8c61\uff0cplaybook\u4f1a\u4f7f\u7528\u8fd9\u4e2a\u5bf9\u8c61 play = Play () . load ( play_source , variable_manager = variable_manager , loader = loader ) # \u5b9e\u4f8b\u5316\u4efb\u52a1\u961f\u5217\u7ba1\u7406\u5668\uff0c\u5b83\u8d1f\u8d23\u521b\u5efa\u548c\u8bbe\u7f6e\u6240\u6709\u5bf9\u8c61\u6765\u904d\u5386\u4e3b\u673a\u5217\u8868\u548c\u4efb\u52a1 tqm = None try : tqm = TaskQueueManager ( inventory = inventory , variable_manager = variable_manager , loader = loader , passwords = passwords , stdout_callback = results_callback , # \u4f7f\u7528\u81ea\u5b9a\u4e49\u7684callback\u63d2\u4ef6\uff0c\u9ed8\u8ba4\u662f`default`\u63d2\u4ef6 ) result = tqm . run ( play ) # \u5728\u961f\u5217\u4e2d\u6267\u884cplay print ( '\u4efb\u52a1\u6267\u884c\u8fd4\u56de\u7801: %s ' % result ) # \u8fd4\u56de\u7801\uff0c\u53ea\u8981\u6709\u4e00\u4e2a host \u51fa\u9519\u5c31\u4f1a\u8fd4\u56de \u975e0 \u6570\u5b57 finally : # \u603b\u662f\u8981\u6e05\u7406\u5b50\u8fdb\u7a0b\u548c\u5176\u901a\u4fe1\u4fe1\u606f if tqm is not None : tqm . cleanup () # \u5220\u9664 ansible \u4e34\u65f6\u76ee\u5f55 shutil . rmtree ( C . DEFAULT_LOCAL_TMP , True ) \u6267\u884c\u7ed3\u679c # python test-api.py { \"localhost\" : { \"stderr_lines\" : [] , \"changed\" : true, \"end\" : \"2020-05-03 23:02:39.296937\" , \"_ansible_no_log\" : false, \"stdout\" : \"ansible.cfg\\nasynctest.yaml\\ncallback_plugins\\ncsv_inventory\\ndebuger.yaml\\nfilter_plugins\\ngroup_vars\\nhosts\\nlibrary\\nplugins\\nroles\\nsplit.yml\\ntest-api.py\\ntest_black_hole.yml\\ntest_inventory_script.yml\\ntest_remote_copy.yml\\ntest_touch.yml\\ntest.yml\" , \"cmd\" : \"ls\" , \"start\" : \"2020-05-03 23:02:39.292814\" , \"delta\" : \"0:00:00.004123\" , \"stderr\" : \"\" , \"rc\" : 0 , \"invocation\" : { \"module_args\" : { \"warn\" : true, \"executable\" : null, \"_uses_shell\" : true, \"strip_empty_ends\" : true, \"_raw_params\" : \"ls\" , \"removes\" : null, \"argv\" : null, \"creates\" : null, \"chdir\" : null, \"stdin_add_newline\" : true, \"stdin\" : null } } , \"stdout_lines\" : [ \"ansible.cfg\" , \"asynctest.yaml\" , \"callback_plugins\" , \"csv_inventory\" , \"debuger.yaml\" , \"filter_plugins\" , \"group_vars\" , \"hosts\" , \"library\" , \"plugins\" , \"roles\" , \"split.yml\" , \"test-api.py\" , \"test_black_hole.yml\" , \"test_inventory_script.yml\" , \"test_remote_copy.yml\" , \"test_touch.yml\" , \"test.yml\" ] , \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } } } --- { \"localhost\" : { \"msg\" : \"ansible.cfg\\nasynctest.yaml\\ncallback_plugins\\ncsv_inventory\\ndebuger.yaml\\nfilter_plugins\\ngroup_vars\\nhosts\\nlibrary\\nplugins\\nroles\\nsplit.yml\\ntest-api.py\\ntest_black_hole.yml\\ntest_inventory_script.yml\\ntest_remote_copy.yml\\ntest_touch.yml\\ntest.yml\" , \"changed\" : false, \"_ansible_verbose_always\" : true, \"_ansible_no_log\" : false } } --- \u4efb\u52a1\u6267\u884c\u8fd4\u56de\u7801: 0","title":"api \u793a\u4f8b"},{"location":"dev/api/api-task/#taskqueuemanager","text":"inventory \u2192 \u7531ansible.inventory\u6a21\u5757\u521b\u5efa\uff0c\u7528\u4e8e\u5bfc\u5165inventory\u6587\u4ef6 variable_manager \u2192 \u7531ansible.vars\u6a21\u5757\u521b\u5efa\uff0c\u7528\u4e8e\u5b58\u50a8\u5404\u7c7b\u53d8\u91cf\u4fe1\u606f loader \u2192 \u7531ansible.parsing.dataloader\u6a21\u5757\u521b\u5efa\uff0c\u7528\u4e8e\u6570\u636e\u89e3\u6790 passwords \u2192 \u767b\u5f55\u5bc6\u7801\uff0c\u53ef\u8bbe\u7f6e\u52a0\u5bc6\u4fe1\u606f stdout_callback \u2192 \u56de\u8c03\u51fd\u6570 run_tree \u2192 \u662f\u5426\u4ee5tree\u6a21\u5f0f\u8fd0\u884c forks \u2192 \u8bbe\u7f6e\u5e76\u884c\u6570","title":"TaskQueueManager \u5b57\u6bb5\u8bf4\u660e"},{"location":"dev/api/api-task/#taskqueuemanagerrun","text":"RUN_OK = 0 RUN_ERROR = 1 RUN_FAILED_HOSTS = 2 RUN_UNREACHABLE_HOSTS = 4 RUN_FAILED_BREAK_PLAY = 8 RUN_UNKNOWN_ERROR = 255","title":"TaskQueueManager.run\u65b9\u6cd5\u7684\u8fd4\u56de\u72b6\u6001\u7801"},{"location":"dev/debug/module-debug/","text":"\u6a21\u5757\u8c03\u8bd5 \u00b6 \u672c\u5730\u8c03\u8bd5 \u00b6 \u4f7f\u7528\u5b98\u65b9\u63d0\u4f9b\u7684\u811a\u672c\u5728\u672c\u5730\u8fd0\u884c\u6a21\u5757\u3002 wget https://raw.githubusercontent.com/ansible/ansible/devel/hacking/test-module.py \u4f7f\u4e0b\u5217\u547d\u4ee4\u8fd0\u884cmodule # python test-module.py -m /usr/lib/python2.7/site-packages/ansible/modules/system/ping.py * including generated source, if any, saving to: /root/.ansible_module_generated * ansiballz module detected ; extracted module source to: /root/debug_dir *********************************** RAW OUTPUT { \"invocation\" : { \"module_args\" : { \"data\" : \"pong\" }} , \"ping\" : \"pong\" } *********************************** PARSED OUTPUT { \"invocation\" : { \"module_args\" : { \"data\" : \"pong\" } } , \"ping\" : \"pong\" } # python test-module.py -m /usr/lib/python2.7/site-packages/ansible/modules/commands/command.py -a \"/bin/sleep 3\" * including generated source, if any, saving to: /root/.ansible_module_generated * ansiballz module detected ; extracted module source to: /root/debug_dir *********************************** RAW OUTPUT { \"changed\" : true, \"end\" : \"2020-04-08 23:48:57.125895\" , \"stdout\" : \"\" , \"cmd\" : [ \"/bin/sleep\" , \"3\" ] , \"rc\" : 0 , \"start\" : \"2020-04-08 23:48:54.048553\" , \"stderr\" : \"\" , \"delta\" : \"0:00:03.077342\" , \"invocation\" : { \"module_args\" : { \"creates\" : null, \"executable\" : null, \"_uses_shell\" : false, \"strip_empty_ends\" : true, \"_raw_params\" : \"/bin/sleep 3\" , \"removes\" : null, \"argv\" : null, \"warn\" : true, \"chdir\" : null, \"stdin_add_newline\" : true, \"stdin\" : null }}} *********************************** PARSED OUTPUT { \"changed\" : true, \"cmd\" : [ \"/bin/sleep\" , \"3\" ] , \"delta\" : \"0:00:03.077342\" , \"end\" : \"2020-04-08 23:48:57.125895\" , \"invocation\" : { \"module_args\" : { \"_raw_params\" : \"/bin/sleep 3\" , \"_uses_shell\" : false, \"argv\" : null, \"chdir\" : null, \"creates\" : null, \"executable\" : null, \"removes\" : null, \"stdin\" : null, \"stdin_add_newline\" : true, \"strip_empty_ends\" : true, \"warn\" : true } } , \"rc\" : 0 , \"start\" : \"2020-04-08 23:48:54.048553\" , \"stderr\" : \"\" , \"stdout\" : \"\" } test-module.py \u4f7f\u7528\u53c2\u6570 # python test-module.py --help Usage: test-module.py - [ options ] ( -h for help ) Options: -h, --help show this help message and exit -m MODULE_PATH, --module-path = MODULE_PATH REQUIRED: full path of module source to execute -a MODULE_ARGS, --args = MODULE_ARGS module argument string -D DEBUGGER, --debugger = DEBUGGER path to python debugger ( e.g. /usr/bin/pdb ) -I INTERPRETER_TYPE = INTERPRETER_PATH, --interpreter = INTERPRETER_TYPE = INTERPRETER_PATH path to interpreter to use for this module ( e.g. ansible_python_interpreter = /usr/bin/python ) -c, --check run the module in check mode -n, --noexecute do not run the resulting module -o FILENAME, --output = FILENAME Filename for resulting module \u8fdc\u7a0b\u8c03\u8bd5 \u00b6 \u5728\u524d\u9762\u7684\u4ecb\u7ecd\u4e2d\uff0c\u6211\u4eec\u77e5\u9053 modules\u662f\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u6267\u884c\u7684 \uff0c\u8c03\u8bd5\u6a21\u5757\u90a3\u5c31\u9700\u8981\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u6267\u884c\uff0cansible\u9ed8\u8ba4\u5728\u6267\u884c\u5b8cmodules\uff0c\u4f1a\u81ea\u52a8\u6e05\u7406\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u7684\u4e34\u65f6\u6587\u4ef6\u3002 \u4f7f\u7528 ANSIBLE_KEEP_REMOTE_FILES=1 \u73af\u5883\u53d8\u91cf \uff0c\u53ef\u4ee5\u4fdd\u7559ansible\u5728\u8fdc\u7a0b\u4e3b\u673a\u7684\u6267\u884c\u6587\u4ef6\uff0c\u4ece\u800c\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u8c03\u8bd5\u6a21\u5757\u3002 # ANSIBLE_KEEP_REMOTE_FILES=1 ansible localhost -m ping -a 'data=debugging_session' -vvv sing module file /usr/lib/python2.6/site-packages/ansible/modules/core/system/ping.py <localhost> ESTABLISH LOCAL CONNECTION FOR USER: root <localhost> EXEC /bin/sh -c '( umask 77 && mkdir -p \"` echo ~/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932 `\" && echo ansible-tmp-1489477306.61-275734926719932=\"` echo ~/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932 `\" ) && sleep 0' <localhost> PUT /tmp/tmpv4EenK TO /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py <localhost> EXEC /bin/sh -c 'chmod u+x /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py && sleep 0' <localhost> EXEC /bin/sh -c '/usr/bin/python /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py && sleep 0' localhost | SUCCESS = > { \"changed\" : false, \"invocation\" : { \"module_args\" : { \"data\" : \"debugging_session\" } , \"module_name\" : \"ping\" } , \"ping\" : \"debugging_session\" } \u6a21\u5757\u6587\u4ef6\u662f\u7531base64\u7f16\u7801\u7684\u5b57\u7b26\u4e32\u6587\u4ef6\uff0c\u53ef\u4f7f\u7528 explode \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u6210\u53ef\u6267\u884c\u7684python\u6587\u4ef6 # python /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py explode Module expanded into: /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/debug_dir \u67e5\u770bdebug_dir\u76ee\u5f55 $ tree /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/debug_dir/ /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/debug_dir/ \u251c\u2500\u2500 ansible \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2514\u2500\u2500 module_utils \u2502 \u251c\u2500\u2500 basic.py \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u251c\u2500\u2500 pycompat24.py \u2502 \u251c\u2500\u2500 six.py \u2502 \u2514\u2500\u2500 _text.py \u251c\u2500\u2500 ansible_module_ping.py \u2514\u2500\u2500 args ansible_module_ping.py \u662f\u6a21\u5757\u672c\u8eab\u7684\u4ee3\u7801\u3002 args \u6587\u4ef6\u5305\u542b\u4e00\u4e2aJSON\u5b57\u7b26\u4e32\u3002 \u8be5\u5b57\u7b26\u4e32\u662f\u4e00\u4e2a\u5305\u542b\u6a21\u5757\u53c2\u6570\u548c\u5176\u4ed6\u53d8\u91cf\u7684\u5b57\u5178\u3002 ansible\u76ee\u5f55\u5305\u542b\u7531ansible_module_ping\u6a21\u5757\u4f7f\u7528\u7684ansible.module_utils\u7684\u4ee3\u7801\u6587\u4ef6\u3002 \u4fee\u6539\u4e86debug_dir\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\u4e4b\u540e\uff0c\u9700\u8981\u4f7f\u7528 execute \u6267\u884c\u4ee3\u7801 # python /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py execute { \"invocation\" : { \"module_args\" : { \"data\" : \"debugging_session\" }} , \"changed\" : false, \"ping\" : \"debugging_session\" }","title":"\u6a21\u5757\u8c03\u8bd5"},{"location":"dev/debug/module-debug/#_1","text":"","title":"\u6a21\u5757\u8c03\u8bd5"},{"location":"dev/debug/module-debug/#_2","text":"\u4f7f\u7528\u5b98\u65b9\u63d0\u4f9b\u7684\u811a\u672c\u5728\u672c\u5730\u8fd0\u884c\u6a21\u5757\u3002 wget https://raw.githubusercontent.com/ansible/ansible/devel/hacking/test-module.py \u4f7f\u4e0b\u5217\u547d\u4ee4\u8fd0\u884cmodule # python test-module.py -m /usr/lib/python2.7/site-packages/ansible/modules/system/ping.py * including generated source, if any, saving to: /root/.ansible_module_generated * ansiballz module detected ; extracted module source to: /root/debug_dir *********************************** RAW OUTPUT { \"invocation\" : { \"module_args\" : { \"data\" : \"pong\" }} , \"ping\" : \"pong\" } *********************************** PARSED OUTPUT { \"invocation\" : { \"module_args\" : { \"data\" : \"pong\" } } , \"ping\" : \"pong\" } # python test-module.py -m /usr/lib/python2.7/site-packages/ansible/modules/commands/command.py -a \"/bin/sleep 3\" * including generated source, if any, saving to: /root/.ansible_module_generated * ansiballz module detected ; extracted module source to: /root/debug_dir *********************************** RAW OUTPUT { \"changed\" : true, \"end\" : \"2020-04-08 23:48:57.125895\" , \"stdout\" : \"\" , \"cmd\" : [ \"/bin/sleep\" , \"3\" ] , \"rc\" : 0 , \"start\" : \"2020-04-08 23:48:54.048553\" , \"stderr\" : \"\" , \"delta\" : \"0:00:03.077342\" , \"invocation\" : { \"module_args\" : { \"creates\" : null, \"executable\" : null, \"_uses_shell\" : false, \"strip_empty_ends\" : true, \"_raw_params\" : \"/bin/sleep 3\" , \"removes\" : null, \"argv\" : null, \"warn\" : true, \"chdir\" : null, \"stdin_add_newline\" : true, \"stdin\" : null }}} *********************************** PARSED OUTPUT { \"changed\" : true, \"cmd\" : [ \"/bin/sleep\" , \"3\" ] , \"delta\" : \"0:00:03.077342\" , \"end\" : \"2020-04-08 23:48:57.125895\" , \"invocation\" : { \"module_args\" : { \"_raw_params\" : \"/bin/sleep 3\" , \"_uses_shell\" : false, \"argv\" : null, \"chdir\" : null, \"creates\" : null, \"executable\" : null, \"removes\" : null, \"stdin\" : null, \"stdin_add_newline\" : true, \"strip_empty_ends\" : true, \"warn\" : true } } , \"rc\" : 0 , \"start\" : \"2020-04-08 23:48:54.048553\" , \"stderr\" : \"\" , \"stdout\" : \"\" } test-module.py \u4f7f\u7528\u53c2\u6570 # python test-module.py --help Usage: test-module.py - [ options ] ( -h for help ) Options: -h, --help show this help message and exit -m MODULE_PATH, --module-path = MODULE_PATH REQUIRED: full path of module source to execute -a MODULE_ARGS, --args = MODULE_ARGS module argument string -D DEBUGGER, --debugger = DEBUGGER path to python debugger ( e.g. /usr/bin/pdb ) -I INTERPRETER_TYPE = INTERPRETER_PATH, --interpreter = INTERPRETER_TYPE = INTERPRETER_PATH path to interpreter to use for this module ( e.g. ansible_python_interpreter = /usr/bin/python ) -c, --check run the module in check mode -n, --noexecute do not run the resulting module -o FILENAME, --output = FILENAME Filename for resulting module","title":"\u672c\u5730\u8c03\u8bd5"},{"location":"dev/debug/module-debug/#_3","text":"\u5728\u524d\u9762\u7684\u4ecb\u7ecd\u4e2d\uff0c\u6211\u4eec\u77e5\u9053 modules\u662f\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u6267\u884c\u7684 \uff0c\u8c03\u8bd5\u6a21\u5757\u90a3\u5c31\u9700\u8981\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u6267\u884c\uff0cansible\u9ed8\u8ba4\u5728\u6267\u884c\u5b8cmodules\uff0c\u4f1a\u81ea\u52a8\u6e05\u7406\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u7684\u4e34\u65f6\u6587\u4ef6\u3002 \u4f7f\u7528 ANSIBLE_KEEP_REMOTE_FILES=1 \u73af\u5883\u53d8\u91cf \uff0c\u53ef\u4ee5\u4fdd\u7559ansible\u5728\u8fdc\u7a0b\u4e3b\u673a\u7684\u6267\u884c\u6587\u4ef6\uff0c\u4ece\u800c\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u8c03\u8bd5\u6a21\u5757\u3002 # ANSIBLE_KEEP_REMOTE_FILES=1 ansible localhost -m ping -a 'data=debugging_session' -vvv sing module file /usr/lib/python2.6/site-packages/ansible/modules/core/system/ping.py <localhost> ESTABLISH LOCAL CONNECTION FOR USER: root <localhost> EXEC /bin/sh -c '( umask 77 && mkdir -p \"` echo ~/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932 `\" && echo ansible-tmp-1489477306.61-275734926719932=\"` echo ~/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932 `\" ) && sleep 0' <localhost> PUT /tmp/tmpv4EenK TO /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py <localhost> EXEC /bin/sh -c 'chmod u+x /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py && sleep 0' <localhost> EXEC /bin/sh -c '/usr/bin/python /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py && sleep 0' localhost | SUCCESS = > { \"changed\" : false, \"invocation\" : { \"module_args\" : { \"data\" : \"debugging_session\" } , \"module_name\" : \"ping\" } , \"ping\" : \"debugging_session\" } \u6a21\u5757\u6587\u4ef6\u662f\u7531base64\u7f16\u7801\u7684\u5b57\u7b26\u4e32\u6587\u4ef6\uff0c\u53ef\u4f7f\u7528 explode \u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u6210\u53ef\u6267\u884c\u7684python\u6587\u4ef6 # python /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py explode Module expanded into: /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/debug_dir \u67e5\u770bdebug_dir\u76ee\u5f55 $ tree /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/debug_dir/ /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/debug_dir/ \u251c\u2500\u2500 ansible \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2514\u2500\u2500 module_utils \u2502 \u251c\u2500\u2500 basic.py \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u251c\u2500\u2500 pycompat24.py \u2502 \u251c\u2500\u2500 six.py \u2502 \u2514\u2500\u2500 _text.py \u251c\u2500\u2500 ansible_module_ping.py \u2514\u2500\u2500 args ansible_module_ping.py \u662f\u6a21\u5757\u672c\u8eab\u7684\u4ee3\u7801\u3002 args \u6587\u4ef6\u5305\u542b\u4e00\u4e2aJSON\u5b57\u7b26\u4e32\u3002 \u8be5\u5b57\u7b26\u4e32\u662f\u4e00\u4e2a\u5305\u542b\u6a21\u5757\u53c2\u6570\u548c\u5176\u4ed6\u53d8\u91cf\u7684\u5b57\u5178\u3002 ansible\u76ee\u5f55\u5305\u542b\u7531ansible_module_ping\u6a21\u5757\u4f7f\u7528\u7684ansible.module_utils\u7684\u4ee3\u7801\u6587\u4ef6\u3002 \u4fee\u6539\u4e86debug_dir\u6587\u4ef6\u4e2d\u7684\u4ee3\u7801\u4e4b\u540e\uff0c\u9700\u8981\u4f7f\u7528 execute \u6267\u884c\u4ee3\u7801 # python /root/.ansible/tmp/ansible-tmp-1489477306.61-275734926719932/ping.py execute { \"invocation\" : { \"module_args\" : { \"data\" : \"debugging_session\" }} , \"changed\" : false, \"ping\" : \"debugging_session\" }","title":"\u8fdc\u7a0b\u8c03\u8bd5"},{"location":"dev/debug/pdb/","text":"pdb\u672c\u5730\u8c03\u8bd5 \u00b6 Ansible\u662f\u7528Python\u7f16\u5199\u7684\uff0c\u7528\u4e8e\u8c03\u8bd5\u672c\u5730\u4ee3\u7801\u6267\u884c\u7684\u5de5\u5177\u662fPython\u8c03\u8bd5\u5668 pdb \u3002\u8fd9\u4e2a\u5de5\u5177\u5141\u8bb8\u6211\u4eec\u5728Ansys\u4e2d\u63d2\u5165\u65ad\u70b9\u4ee3\u7801\u548c\u4ea4\u4e92\u5f0f\u5730\u9010\u884c\u6267\u884c\u4ee3\u7801\u3002 \u8c03\u8bd5 ansible \u4ee3\u7801 \u00b6 \u627e\u5230ansible\u7684\u8fd0\u884c\u6587\u4ef6 [ root@master ~ ] # whereis ansible ansible: /usr/bin/ansible /etc/ansible /usr/share/man/man1/ansible.1.gz \u5728 /usr/bin/ansible \u6587\u4ef6\u5f00\u59cb\u5904\u52a0\u5165 57 if __name__ == '__main__' : 58 59 import pdb; pdb.set_trace () 60 display = LastResort () 61 62 try : # bad ANSIBLE_CONFIG or config options can force ugly stacktrace 63 import ansible.constants as C 64 from ansible.utils. display import Display 65 except AnsibleOptionsError as e : 66 display .error ( to_text ( e ), wrap_text = False ) 67 sys. exit ( 5 ) \u7136\u540e\u8fd0\u884cansible\u547d\u4ee4\uff0c\u5c31\u8fdb\u5165\u4e86pdb\u8c03\u8bd5\u72b6\u6001 # ansible localhost -m ping > /usr/bin/ansible ( 60 ) <module> () -> display = LastResort () ( Pdb ) pdb\u5e38\u7528\u547d\u4ee4 \u00b6 \u8f93\u5165 help \u67e5\u770b\u5e2e\u52a9\u4fe1\u606f ( Pdb ) help Documented commands ( type help <topic> ) : ======================================== EOF bt cont enable jump pp run unt a c continue exit l q s until alias cl d h list quit step up args clear debug help n r tbreak w b commands disable ignore next restart u whatis break condition down j p return unalias where Miscellaneous help topics: ========================== exec pdb Undocumented commands: ====================== retval rv \u8f93\u5165 n(next) \uff0c\u8ba9\u7a0b\u5e8f\u8fd0\u884c\u4e0b\u4e00\u884c\uff0c\u5982\u679c\u5f53\u524d\u8bed\u53e5\u6709\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\uff0c\u7528n\u662f\u4e0d\u4f1a\u8fdb\u5165\u88ab\u8c03\u7528\u7684\u51fd\u6570\u4f53\u4e2d\u7684 ( Pdb ) n > /usr/bin/ansible ( 62 ) <module> () -> try: # bad ANSIBLE_CONFIG or config options can force ugly stacktrace ( Pdb ) \u8f93\u5165 l(list) \uff0c\u67e5\u770b\u4ee3\u7801\u7247\u6bb5 ( Pdb ) l 57 if __name__ == '__main__' : 58 59 import pdb ; pdb.set_trace () 60 display = LastResort () 61 62 -> try: # bad ANSIBLE_CONFIG or config options can force ugly stacktrace 63 import ansible.constants as C 64 from ansible.utils.display import Display 65 except AnsibleOptionsError as e: 66 display.error ( to_text ( e ) , wrap_text = False ) 67 sys.exit ( 5 ) ( Pdb ) \u8f93\u5165 p(pp) \u67e5\u770b\u53d8\u91cf\u7684\u503c ( Pdb ) pp display <__main__.LastResort object at 0xbe3410> ( Pdb ) p display <__main__.LastResort object at 0xbe3410> ( Pdb ) \u8f93\u5165 s(step into) \u8ddf n \u76f8\u4f3c\uff0c\u4f46\u662f\u5982\u679c\u5f53\u524d\u6709\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\uff0c\u90a3\u4e48 s \u4f1a\u8fdb\u5165\u88ab\u8c03\u7528\u7684\u51fd\u6570\u4f53\u4e2d ( Pdb ) s > /usr/bin/ansible ( 63 ) <module> () -> import ansible.constants as C ( Pdb ) \u8f93\u5165 r(return) \u6267\u884c\u4ee3\u7801\u76f4\u5230\u4ece\u5f53\u524d\u51fd\u6570\u8fd4\u56de ( Pdb ) r --Call-- > /usr/lib/python2.7/site-packages/ansible/module_utils/six/__init__.py ( 193 ) find_module () -> def find_module ( self, fullname, path = None ) : ( Pdb ) \u8f93\u5165 b \u8bbe\u7f6e\u65ad\u70b9\uff0c\u4f8b\u5982 \"b 78\"\uff0c\u5c31\u662f\u5728\u5f53\u524d\u811a\u672c\u768478\u884c\u6253\u4e0a\u65ad\u70b9\uff0c\u8fd8\u80fd\u8f93\u5165\u51fd\u6570\u540d\u4f5c\u4e3a\u53c2\u6570\uff0c\u65ad\u70b9\u5c31\u6253\u5230\u5177\u4f53\u7684\u51fd\u6570\u5165\u53e3\uff0c\u5982\u679c\u53ea\u6572b\uff0c\u4f1a\u663e\u793a\u73b0\u6709\u7684\u5168\u90e8\u65ad\u70b9 ( Pdb ) b 194 Breakpoint 1 at /usr/lib/python2.7/site-packages/ansible/module_utils/six/__init__.py:194 ( Pdb ) b Num Type Disp Enb Where 1 breakpoint keep yes at /usr/lib/python2.7/site-packages/ansible/module_utils/six/__init__.py:194 ( Pdb ) \u8f93\u5165 a(rgs) \uff0c\u6253\u5370\u5f53\u524d\u51fd\u6570\u7684\u53c2\u6570 ( Pdb ) a self = <ansible.module_utils.six._SixMetaPathImporter object at 0xb016d0> fullname = ansible.constants path = [ '/usr/lib/python2.7/site-packages/ansible' ] ( Pdb ) \u8f93\u5165 bt(w) \u6253\u5370\u5806\u6808\u8ddf\u8e2a\uff0c\u6700\u4e0b\u9762\u7684\u5e27\u4f4d\u4e8e\u5e95\u90e8\u3002\u7bad\u5934\u8868\u793a\"\u5f53\u524d\u5e27\"\uff0c\u5b83\u51b3\u5b9a\u4e86\u5927\u591a\u6570\u547d\u4ee4\u7684\u4e0a\u4e0b\u6587\u3002 ( Pdb ) bt /usr/bin/ansible ( 63 ) <module> () -> import ansible.constants as C > /usr/lib/python2.7/site-packages/ansible/module_utils/six/__init__.py ( 193 ) find_module () -> def find_module ( self, fullname, path = None ) : ( Pdb ) \u8f93\u5165 c (continue) \u505c\u6b62 debug \u7ee7\u7eed\u6267\u884c\u7a0b\u5e8f,\u76f4\u5230\u4e0b\u4e00\u4e2a\u65ad\u70b9\u3002 ( Pdb ) c > /usr/lib/python2.7/site-packages/ansible/module_utils/six/__init__.py ( 194 ) find_module () -> if fullname in self.known_modules: ( Pdb ) \u8f93\u5165 q(uit) \uff0c\u9000\u51fa\u8c03\u8bd5 \u6709\u65f6\u5019\u6211\u4eec\u53ea\u662f\u60f3\u8c03\u8bd5\u67d0\u4e00\u90e8\u5206\u4ee3\u7801\uff0c\u5982\u679c\u4ece\u547d\u4ee4\u5165\u53e3\u5f00\u59cb\u8c03\u8bd5\u5219\u5f88\u96be\u627e\u5230\u76f8\u5e94\u7684\u4ee3\u7801\uff0c\u8fd9\u6837\u5c31\u9700\u8981\u5728\u67d0\u4e00\u6a21\u5757\u7684\u5165\u53e3\u4e0a\u6dfb\u52a0\u8c03\u8bd5\u70b9\u5c31\u53ef\u4ee5\u4e86\u3002 \u8c03\u8bd5 Playbook \u4ee3\u7801 \u00b6 Playbook \u8d1f\u8d23\u52a0\u8f7d\uff0c\u89e3\u6790\uff0c\u6267\u884cyml\u6587\u4ef6\u7684playbook\u3002 palybook\u7684\u4e3b\u8981\u5165\u53e3\u5728 playbook/__init__.py \u6587\u4ef6\u7684Playbook\u7c7b\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5728linux\u4e0b\u901a\u5e38\u5b58\u5728 /usr/lib/python2.7/site-packages/ansible/playbook/__init__.py . \u4e0b\u9762\u662f\u5728__init__()\u65b9\u6cd5\u4e2d\u6dfb\u52a0\u4e86\u65ad\u70b9 38 class Playbook: 39 40 def __init__ ( self , loader ) : 41 import pdb; pdb.set_trace () 42 # Entries in the datastructure of a playbook may 43 # be either a play or an include statement 44 self._entries = [] 45 self._basedir = to_text ( os.getcwd (), errors = 'surrogate_or_strict' ) 46 self._loader = loader 47 self._file_name = None \u8fd0\u884c\u547d\u4ee4 # ansible-playbook debuger.yaml > /usr/lib/python2.7/site-packages/ansible/playbook/__init__.py ( 44 ) __init__ () -> self._entries = [] ( Pdb ) l 39 40 def __init__ ( self, loader ) : 41 import pdb ; pdb.set_trace () 42 # Entries in the datastructure of a playbook may 43 # be either a play or an include statement 44 -> self._entries = [] 45 self._basedir = to_text ( os.getcwd () , errors = 'surrogate_or_strict' ) 46 self._loader = loader 47 self._file_name = None 48 49 @staticmethod ( Pdb ) \u8c03\u8bd5 Inventory \u4ee3\u7801 \u00b6 inventory \u8d1f\u8d23\u53d1\u73b0\uff0c\u89e3\u6790\uff0c\u52a0\u8f7d\u4e3b\u673a\u6e05\u5355\u3002 inventory \u7684\u4e3b\u8981\u5165\u53e3\u5728 inventory/manager.py \u6587\u4ef6\u4e2d\u7684InventoryManager\u7c7b\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5728linux\u4e0b\u901a\u5e38\u5b58\u5728 /usr/lib/python2.7/site-packages/ansible/inventory/manager.py \uff0c\u5982\u679c\u4e0d\u77e5\u9053\u81ea\u5df1\u7684ansible\u8def\u5f84\u5728\u54ea\u91cc\uff0c\u53ef\u4ee5\u4f7f\u7528 python -c \"import ansible; print(ansible)\" \u547d\u4ee4\u67e5\u770b\u3002 \u4e0b\u9762\u662f\u5728__init__()\u65b9\u6cd5\u4e2d\u6dfb\u52a0\u4e86\u65ad\u70b9 136 class InventoryManager ( object ) : 137 ''' Creates and manages inventory ''' 138 139 def __init__ ( self , loader , sources = None ) : 140 import pdb; pdb.set_trace () 141 142 # base objects 143 self._loader = loader 144 self._inventory = InventoryData () \u6267\u884c\u547d\u4ee4 # ansible localhost -m ping > /usr/lib/python2.7/site-packages/ansible/inventory/manager.py ( 143 ) __init__ () -> self._loader = loader ( Pdb ) l 138 139 def __init__ ( self, loader, sources = None ) : 140 import pdb ; pdb.set_trace () 141 142 # base objects 143 -> self._loader = loader 144 self._inventory = InventoryData () 145 146 # a list of host(names) to contain current inquiries to 147 self._restriction = None 148 self._subset = None ( Pdb ) \u8c03\u8bd5 Plugins \u4ee3\u7801 \u00b6 plugins \u76f8\u5173\u7684\u4ee3\u7801\u662f\u5728\u63a7\u5236\u8282\u70b9\u4e2d\u6267\u884c\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u672c\u5730\u8c03\u8bd5\u3002\u4e0b\u5217\u4ee5 callback/default \u63d2\u4ef6\u4ee3\u7801\u4e3a\u6d4b\u8bd5 \u6587\u4ef6 /usr/lib/python2.7/site-packages/ansible/plugins/callback/default.py 63 class CallbackModule ( CallbackBase ) : 64 65 '' ' 66 This is the default callback interface , which simply prints messages 67 to stdout when new callback events are received. 68 '' ' 69 70 CALLBACK_VERSION = 2 . 0 71 CALLBACK_TYPE = 'stdout' 72 CALLBACK_NAME = 'default' 73 74 def __init__ ( self ) : 75 76 import pdb; pdb.set_trace () \u53ef\u4ee5\u66f4\u8fdb\u4e00\u6b65\u7684\u8c03\u8bd5callback\u56de\u8c03\u63a5\u53e3 95 def v2_runner_on_failed ( self , result , ignore_errors = False ) : 96 97 import pdb; pdb.set_trace () 98 delegated_vars = result._result.get ( '_ansible_delegated_vars' , None ) 99 self._clean_results ( result._result , result._task.action ) 122 def v2_runner_on_ok ( self , result ) : 123 import pdb; pdb.set_trace () 124 125 delegated_vars = result._result.get ( '_ansible_delegated_vars' , None ) 126 127 if isinstance ( result._task , TaskInclude ) : \u8fd0\u884c\u547d\u4ee4 # ansible-playbook debuger.yaml > /usr/lib/python2.7/site-packages/ansible/plugins/callback/default.py ( 77 ) __init__ () -> self._play = None ( Pdb ) l 72 CALLBACK_NAME = 'default' 73 74 def __init__ ( self ) : 75 76 import pdb ; pdb.set_trace () 77 -> self._play = None 78 self._last_task_banner = None 79 self._last_task_name = None 80 self._task_type_cache = {} 81 super ( CallbackModule, self ) .__init__ () 82 Info module \u6a21\u5757\u4ee3\u7801\u662f\u5728\u8fdc\u7aef\u6267\u884c\u7684\uff0c\u6240\u4ee5\u4e0d\u80fd\u4f7f\u7528pdb\u672c\u5730\u8c03\u8bd5 \u672c\u5730\u8fd0\u884c\u6a21\u5757 \u00b6 python -m pdb ./my_new_test_module.py ./args.json","title":"pdb \u672c\u5730\u8c03\u8bd5"},{"location":"dev/debug/pdb/#pdb","text":"Ansible\u662f\u7528Python\u7f16\u5199\u7684\uff0c\u7528\u4e8e\u8c03\u8bd5\u672c\u5730\u4ee3\u7801\u6267\u884c\u7684\u5de5\u5177\u662fPython\u8c03\u8bd5\u5668 pdb \u3002\u8fd9\u4e2a\u5de5\u5177\u5141\u8bb8\u6211\u4eec\u5728Ansys\u4e2d\u63d2\u5165\u65ad\u70b9\u4ee3\u7801\u548c\u4ea4\u4e92\u5f0f\u5730\u9010\u884c\u6267\u884c\u4ee3\u7801\u3002","title":"pdb\u672c\u5730\u8c03\u8bd5"},{"location":"dev/debug/pdb/#ansible","text":"\u627e\u5230ansible\u7684\u8fd0\u884c\u6587\u4ef6 [ root@master ~ ] # whereis ansible ansible: /usr/bin/ansible /etc/ansible /usr/share/man/man1/ansible.1.gz \u5728 /usr/bin/ansible \u6587\u4ef6\u5f00\u59cb\u5904\u52a0\u5165 57 if __name__ == '__main__' : 58 59 import pdb; pdb.set_trace () 60 display = LastResort () 61 62 try : # bad ANSIBLE_CONFIG or config options can force ugly stacktrace 63 import ansible.constants as C 64 from ansible.utils. display import Display 65 except AnsibleOptionsError as e : 66 display .error ( to_text ( e ), wrap_text = False ) 67 sys. exit ( 5 ) \u7136\u540e\u8fd0\u884cansible\u547d\u4ee4\uff0c\u5c31\u8fdb\u5165\u4e86pdb\u8c03\u8bd5\u72b6\u6001 # ansible localhost -m ping > /usr/bin/ansible ( 60 ) <module> () -> display = LastResort () ( Pdb )","title":"\u8c03\u8bd5 ansible \u4ee3\u7801"},{"location":"dev/debug/pdb/#pdb_1","text":"\u8f93\u5165 help \u67e5\u770b\u5e2e\u52a9\u4fe1\u606f ( Pdb ) help Documented commands ( type help <topic> ) : ======================================== EOF bt cont enable jump pp run unt a c continue exit l q s until alias cl d h list quit step up args clear debug help n r tbreak w b commands disable ignore next restart u whatis break condition down j p return unalias where Miscellaneous help topics: ========================== exec pdb Undocumented commands: ====================== retval rv \u8f93\u5165 n(next) \uff0c\u8ba9\u7a0b\u5e8f\u8fd0\u884c\u4e0b\u4e00\u884c\uff0c\u5982\u679c\u5f53\u524d\u8bed\u53e5\u6709\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\uff0c\u7528n\u662f\u4e0d\u4f1a\u8fdb\u5165\u88ab\u8c03\u7528\u7684\u51fd\u6570\u4f53\u4e2d\u7684 ( Pdb ) n > /usr/bin/ansible ( 62 ) <module> () -> try: # bad ANSIBLE_CONFIG or config options can force ugly stacktrace ( Pdb ) \u8f93\u5165 l(list) \uff0c\u67e5\u770b\u4ee3\u7801\u7247\u6bb5 ( Pdb ) l 57 if __name__ == '__main__' : 58 59 import pdb ; pdb.set_trace () 60 display = LastResort () 61 62 -> try: # bad ANSIBLE_CONFIG or config options can force ugly stacktrace 63 import ansible.constants as C 64 from ansible.utils.display import Display 65 except AnsibleOptionsError as e: 66 display.error ( to_text ( e ) , wrap_text = False ) 67 sys.exit ( 5 ) ( Pdb ) \u8f93\u5165 p(pp) \u67e5\u770b\u53d8\u91cf\u7684\u503c ( Pdb ) pp display <__main__.LastResort object at 0xbe3410> ( Pdb ) p display <__main__.LastResort object at 0xbe3410> ( Pdb ) \u8f93\u5165 s(step into) \u8ddf n \u76f8\u4f3c\uff0c\u4f46\u662f\u5982\u679c\u5f53\u524d\u6709\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\uff0c\u90a3\u4e48 s \u4f1a\u8fdb\u5165\u88ab\u8c03\u7528\u7684\u51fd\u6570\u4f53\u4e2d ( Pdb ) s > /usr/bin/ansible ( 63 ) <module> () -> import ansible.constants as C ( Pdb ) \u8f93\u5165 r(return) \u6267\u884c\u4ee3\u7801\u76f4\u5230\u4ece\u5f53\u524d\u51fd\u6570\u8fd4\u56de ( Pdb ) r --Call-- > /usr/lib/python2.7/site-packages/ansible/module_utils/six/__init__.py ( 193 ) find_module () -> def find_module ( self, fullname, path = None ) : ( Pdb ) \u8f93\u5165 b \u8bbe\u7f6e\u65ad\u70b9\uff0c\u4f8b\u5982 \"b 78\"\uff0c\u5c31\u662f\u5728\u5f53\u524d\u811a\u672c\u768478\u884c\u6253\u4e0a\u65ad\u70b9\uff0c\u8fd8\u80fd\u8f93\u5165\u51fd\u6570\u540d\u4f5c\u4e3a\u53c2\u6570\uff0c\u65ad\u70b9\u5c31\u6253\u5230\u5177\u4f53\u7684\u51fd\u6570\u5165\u53e3\uff0c\u5982\u679c\u53ea\u6572b\uff0c\u4f1a\u663e\u793a\u73b0\u6709\u7684\u5168\u90e8\u65ad\u70b9 ( Pdb ) b 194 Breakpoint 1 at /usr/lib/python2.7/site-packages/ansible/module_utils/six/__init__.py:194 ( Pdb ) b Num Type Disp Enb Where 1 breakpoint keep yes at /usr/lib/python2.7/site-packages/ansible/module_utils/six/__init__.py:194 ( Pdb ) \u8f93\u5165 a(rgs) \uff0c\u6253\u5370\u5f53\u524d\u51fd\u6570\u7684\u53c2\u6570 ( Pdb ) a self = <ansible.module_utils.six._SixMetaPathImporter object at 0xb016d0> fullname = ansible.constants path = [ '/usr/lib/python2.7/site-packages/ansible' ] ( Pdb ) \u8f93\u5165 bt(w) \u6253\u5370\u5806\u6808\u8ddf\u8e2a\uff0c\u6700\u4e0b\u9762\u7684\u5e27\u4f4d\u4e8e\u5e95\u90e8\u3002\u7bad\u5934\u8868\u793a\"\u5f53\u524d\u5e27\"\uff0c\u5b83\u51b3\u5b9a\u4e86\u5927\u591a\u6570\u547d\u4ee4\u7684\u4e0a\u4e0b\u6587\u3002 ( Pdb ) bt /usr/bin/ansible ( 63 ) <module> () -> import ansible.constants as C > /usr/lib/python2.7/site-packages/ansible/module_utils/six/__init__.py ( 193 ) find_module () -> def find_module ( self, fullname, path = None ) : ( Pdb ) \u8f93\u5165 c (continue) \u505c\u6b62 debug \u7ee7\u7eed\u6267\u884c\u7a0b\u5e8f,\u76f4\u5230\u4e0b\u4e00\u4e2a\u65ad\u70b9\u3002 ( Pdb ) c > /usr/lib/python2.7/site-packages/ansible/module_utils/six/__init__.py ( 194 ) find_module () -> if fullname in self.known_modules: ( Pdb ) \u8f93\u5165 q(uit) \uff0c\u9000\u51fa\u8c03\u8bd5 \u6709\u65f6\u5019\u6211\u4eec\u53ea\u662f\u60f3\u8c03\u8bd5\u67d0\u4e00\u90e8\u5206\u4ee3\u7801\uff0c\u5982\u679c\u4ece\u547d\u4ee4\u5165\u53e3\u5f00\u59cb\u8c03\u8bd5\u5219\u5f88\u96be\u627e\u5230\u76f8\u5e94\u7684\u4ee3\u7801\uff0c\u8fd9\u6837\u5c31\u9700\u8981\u5728\u67d0\u4e00\u6a21\u5757\u7684\u5165\u53e3\u4e0a\u6dfb\u52a0\u8c03\u8bd5\u70b9\u5c31\u53ef\u4ee5\u4e86\u3002","title":"pdb\u5e38\u7528\u547d\u4ee4"},{"location":"dev/debug/pdb/#playbook","text":"Playbook \u8d1f\u8d23\u52a0\u8f7d\uff0c\u89e3\u6790\uff0c\u6267\u884cyml\u6587\u4ef6\u7684playbook\u3002 palybook\u7684\u4e3b\u8981\u5165\u53e3\u5728 playbook/__init__.py \u6587\u4ef6\u7684Playbook\u7c7b\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5728linux\u4e0b\u901a\u5e38\u5b58\u5728 /usr/lib/python2.7/site-packages/ansible/playbook/__init__.py . \u4e0b\u9762\u662f\u5728__init__()\u65b9\u6cd5\u4e2d\u6dfb\u52a0\u4e86\u65ad\u70b9 38 class Playbook: 39 40 def __init__ ( self , loader ) : 41 import pdb; pdb.set_trace () 42 # Entries in the datastructure of a playbook may 43 # be either a play or an include statement 44 self._entries = [] 45 self._basedir = to_text ( os.getcwd (), errors = 'surrogate_or_strict' ) 46 self._loader = loader 47 self._file_name = None \u8fd0\u884c\u547d\u4ee4 # ansible-playbook debuger.yaml > /usr/lib/python2.7/site-packages/ansible/playbook/__init__.py ( 44 ) __init__ () -> self._entries = [] ( Pdb ) l 39 40 def __init__ ( self, loader ) : 41 import pdb ; pdb.set_trace () 42 # Entries in the datastructure of a playbook may 43 # be either a play or an include statement 44 -> self._entries = [] 45 self._basedir = to_text ( os.getcwd () , errors = 'surrogate_or_strict' ) 46 self._loader = loader 47 self._file_name = None 48 49 @staticmethod ( Pdb )","title":"\u8c03\u8bd5 Playbook \u4ee3\u7801"},{"location":"dev/debug/pdb/#inventory","text":"inventory \u8d1f\u8d23\u53d1\u73b0\uff0c\u89e3\u6790\uff0c\u52a0\u8f7d\u4e3b\u673a\u6e05\u5355\u3002 inventory \u7684\u4e3b\u8981\u5165\u53e3\u5728 inventory/manager.py \u6587\u4ef6\u4e2d\u7684InventoryManager\u7c7b\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5728linux\u4e0b\u901a\u5e38\u5b58\u5728 /usr/lib/python2.7/site-packages/ansible/inventory/manager.py \uff0c\u5982\u679c\u4e0d\u77e5\u9053\u81ea\u5df1\u7684ansible\u8def\u5f84\u5728\u54ea\u91cc\uff0c\u53ef\u4ee5\u4f7f\u7528 python -c \"import ansible; print(ansible)\" \u547d\u4ee4\u67e5\u770b\u3002 \u4e0b\u9762\u662f\u5728__init__()\u65b9\u6cd5\u4e2d\u6dfb\u52a0\u4e86\u65ad\u70b9 136 class InventoryManager ( object ) : 137 ''' Creates and manages inventory ''' 138 139 def __init__ ( self , loader , sources = None ) : 140 import pdb; pdb.set_trace () 141 142 # base objects 143 self._loader = loader 144 self._inventory = InventoryData () \u6267\u884c\u547d\u4ee4 # ansible localhost -m ping > /usr/lib/python2.7/site-packages/ansible/inventory/manager.py ( 143 ) __init__ () -> self._loader = loader ( Pdb ) l 138 139 def __init__ ( self, loader, sources = None ) : 140 import pdb ; pdb.set_trace () 141 142 # base objects 143 -> self._loader = loader 144 self._inventory = InventoryData () 145 146 # a list of host(names) to contain current inquiries to 147 self._restriction = None 148 self._subset = None ( Pdb )","title":"\u8c03\u8bd5  Inventory \u4ee3\u7801"},{"location":"dev/debug/pdb/#plugins","text":"plugins \u76f8\u5173\u7684\u4ee3\u7801\u662f\u5728\u63a7\u5236\u8282\u70b9\u4e2d\u6267\u884c\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u672c\u5730\u8c03\u8bd5\u3002\u4e0b\u5217\u4ee5 callback/default \u63d2\u4ef6\u4ee3\u7801\u4e3a\u6d4b\u8bd5 \u6587\u4ef6 /usr/lib/python2.7/site-packages/ansible/plugins/callback/default.py 63 class CallbackModule ( CallbackBase ) : 64 65 '' ' 66 This is the default callback interface , which simply prints messages 67 to stdout when new callback events are received. 68 '' ' 69 70 CALLBACK_VERSION = 2 . 0 71 CALLBACK_TYPE = 'stdout' 72 CALLBACK_NAME = 'default' 73 74 def __init__ ( self ) : 75 76 import pdb; pdb.set_trace () \u53ef\u4ee5\u66f4\u8fdb\u4e00\u6b65\u7684\u8c03\u8bd5callback\u56de\u8c03\u63a5\u53e3 95 def v2_runner_on_failed ( self , result , ignore_errors = False ) : 96 97 import pdb; pdb.set_trace () 98 delegated_vars = result._result.get ( '_ansible_delegated_vars' , None ) 99 self._clean_results ( result._result , result._task.action ) 122 def v2_runner_on_ok ( self , result ) : 123 import pdb; pdb.set_trace () 124 125 delegated_vars = result._result.get ( '_ansible_delegated_vars' , None ) 126 127 if isinstance ( result._task , TaskInclude ) : \u8fd0\u884c\u547d\u4ee4 # ansible-playbook debuger.yaml > /usr/lib/python2.7/site-packages/ansible/plugins/callback/default.py ( 77 ) __init__ () -> self._play = None ( Pdb ) l 72 CALLBACK_NAME = 'default' 73 74 def __init__ ( self ) : 75 76 import pdb ; pdb.set_trace () 77 -> self._play = None 78 self._last_task_banner = None 79 self._last_task_name = None 80 self._task_type_cache = {} 81 super ( CallbackModule, self ) .__init__ () 82 Info module \u6a21\u5757\u4ee3\u7801\u662f\u5728\u8fdc\u7aef\u6267\u884c\u7684\uff0c\u6240\u4ee5\u4e0d\u80fd\u4f7f\u7528pdb\u672c\u5730\u8c03\u8bd5","title":"\u8c03\u8bd5 Plugins \u4ee3\u7801"},{"location":"dev/debug/pdb/#_1","text":"python -m pdb ./my_new_test_module.py ./args.json","title":"\u672c\u5730\u8fd0\u884c\u6a21\u5757"},{"location":"dev/debug/pycharm/","text":"PyCharm \u8fdc\u7a0b\u8c03\u8bd5 \u00b6 \u4ecb\u7ecd \u00b6 PyCharm\u662f\u4e00\u79cdPython IDE\uff0c\u5e26\u6709\u4e00\u6574\u5957\u53ef\u4ee5\u5e2e\u52a9\u7528\u6237\u5728\u4f7f\u7528Python\u8bed\u8a00\u5f00\u53d1\u65f6\u63d0\u9ad8\u5176\u6548\u7387\u7684\u5de5\u5177\uff0c\u6bd4\u5982\u8c03\u8bd5\u3001\u8bed\u6cd5\u9ad8\u4eae\u3001Project\u7ba1\u7406\u3001\u4ee3\u7801\u8df3\u8f6c\u3001\u667a\u80fd\u63d0\u793a\u3001\u81ea\u52a8\u5b8c\u6210\u3001\u5355\u5143\u6d4b\u8bd5\u3001\u7248\u672c\u63a7\u5236\u3002\u6b64\u5916\uff0c\u8be5IDE\u63d0\u4f9b\u4e86\u4e00\u4e9b\u9ad8\u7ea7\u529f\u80fd\uff0c\u4ee5\u7528\u4e8e\u652f\u6301Django\u6846\u67b6\u4e0b\u7684\u4e13\u4e1aWeb\u5f00\u53d1\u3002 \u672c\u5730\u8c03\u8bd5\u6709\u8bb8\u591a\u4e0d\u65b9\u4fbf\u7684\u5730\u65b9\u3002PyCharm\u63d0\u4f9b\u4e86\u6240\u89c1\u53ca\u6240\u5f97\u7684\u8c03\u8bd5\u754c\u9762\u3002\u8c03\u8bd5\u66f4\u52a0\u8f7b\u677e\u65b9\u4fbf\u3002 \u914d\u7f6ePyCharm\u8fdc\u7a0b\u8c03\u8bd5 \u00b6 \u6253\u5f00pycharm--\u300bRUN ==\u300bEdit Configuration \u70b9\u51fb+\u53f7\u6309\u94ae\uff0c\u9009\u62e9Python Remote Debug \u8bbe\u7f6e\u8fdc\u7a0bdebug\u7684\u76d1\u542c\u5730\u5740\u3002 Local host name \u662f\u672c\u673a\u7684IP\u3002 Port \u5728\u4fdd\u8bc1\u4e0d\u51b2\u7a81\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4efb\u610f\u6307\u5b9a\u3002 \u542f\u52a8pycharm\u8c03\u8bd5 \u53ef\u4ee5\u770b\u5230console\u91cc\u7684\u76d1\u542c\u4fe1\u606f\uff0c\u6b63\u5728\u7b49\u5f85\u8fdc\u7a0b\u4e3b\u673a\u8fde\u63a5\u3002 \u5728\u63a7\u5236\u8282\u70b9\u4e0a\u5b89\u88c5\u8fdc\u7a0b\u8c03\u8bd5\u63d2\u4ef6 \u00b6 \u5c06pycharm-debug.egg\u6587\u4ef6\u62f7\u8d1d\u5230\u8fdc\u7a0b\u4e3b\u673a\u7684python\u7684site-packages\u76ee\u5f55\u4e0b\uff0c\u5e76\u5b89\u88c5\u3002 \u5b89\u88c5pycharm-debug.egg \u5728\u9700\u8981\u8c03\u8bd5\u7684\u4ee3\u7801\u4e2d\u52a0\u5165\u8fdc\u7a0b\u8c03\u8bd5\u6240\u9700\u7684\u4ee3\u7801 \u67e5\u627e\u5230ansible\u6267\u884c\u6587\u4ef6 \u5728\u7a0b\u5e8f\u5165\u53e3\u6dfb\u52a0\u4e0b\u9762\u4e24\u884c\u4ee3\u7801 import pydevd pydevd . settrace ( '192.168.77.1' , port = 9999 , stdoutToServer = True , stderrToServer = True ) \u542f\u52a8ansible\u547d\u4ee4 \u4f7f\u7528PyCharm\u8c03\u8bd5\u8fdc\u7a0b\u4ee3\u7801 \u00b6 \u67e5\u770bpycharm\u7a97\u53e3\uff0c\u53ef\u4ee5\u770b\u5230\u6709\u94fe\u63a5\u8fdb\u6765\u3002 \u6b64\u65f6\u53ef\u70b9\u51fb\u201dDownload\u201d\u4e0b\u8f7d\u6e90\u7801 \u70b9\u51fb\u5b8c\u6210\u540e\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u8fdc\u7a0b\u7684ansible\u4ee3\u7801\u3002 \u8c03\u8bd5\u7684\u4e00\u4e9b\u5e38\u7528\u6309\u94ae","title":"PyCharm \u8fdc\u7a0b\u8c03\u8bd5"},{"location":"dev/debug/pycharm/#pycharm","text":"","title":"PyCharm \u8fdc\u7a0b\u8c03\u8bd5"},{"location":"dev/debug/pycharm/#_1","text":"PyCharm\u662f\u4e00\u79cdPython IDE\uff0c\u5e26\u6709\u4e00\u6574\u5957\u53ef\u4ee5\u5e2e\u52a9\u7528\u6237\u5728\u4f7f\u7528Python\u8bed\u8a00\u5f00\u53d1\u65f6\u63d0\u9ad8\u5176\u6548\u7387\u7684\u5de5\u5177\uff0c\u6bd4\u5982\u8c03\u8bd5\u3001\u8bed\u6cd5\u9ad8\u4eae\u3001Project\u7ba1\u7406\u3001\u4ee3\u7801\u8df3\u8f6c\u3001\u667a\u80fd\u63d0\u793a\u3001\u81ea\u52a8\u5b8c\u6210\u3001\u5355\u5143\u6d4b\u8bd5\u3001\u7248\u672c\u63a7\u5236\u3002\u6b64\u5916\uff0c\u8be5IDE\u63d0\u4f9b\u4e86\u4e00\u4e9b\u9ad8\u7ea7\u529f\u80fd\uff0c\u4ee5\u7528\u4e8e\u652f\u6301Django\u6846\u67b6\u4e0b\u7684\u4e13\u4e1aWeb\u5f00\u53d1\u3002 \u672c\u5730\u8c03\u8bd5\u6709\u8bb8\u591a\u4e0d\u65b9\u4fbf\u7684\u5730\u65b9\u3002PyCharm\u63d0\u4f9b\u4e86\u6240\u89c1\u53ca\u6240\u5f97\u7684\u8c03\u8bd5\u754c\u9762\u3002\u8c03\u8bd5\u66f4\u52a0\u8f7b\u677e\u65b9\u4fbf\u3002","title":"\u4ecb\u7ecd"},{"location":"dev/debug/pycharm/#pycharm_1","text":"\u6253\u5f00pycharm--\u300bRUN ==\u300bEdit Configuration \u70b9\u51fb+\u53f7\u6309\u94ae\uff0c\u9009\u62e9Python Remote Debug \u8bbe\u7f6e\u8fdc\u7a0bdebug\u7684\u76d1\u542c\u5730\u5740\u3002 Local host name \u662f\u672c\u673a\u7684IP\u3002 Port \u5728\u4fdd\u8bc1\u4e0d\u51b2\u7a81\u7684\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4efb\u610f\u6307\u5b9a\u3002 \u542f\u52a8pycharm\u8c03\u8bd5 \u53ef\u4ee5\u770b\u5230console\u91cc\u7684\u76d1\u542c\u4fe1\u606f\uff0c\u6b63\u5728\u7b49\u5f85\u8fdc\u7a0b\u4e3b\u673a\u8fde\u63a5\u3002","title":"\u914d\u7f6ePyCharm\u8fdc\u7a0b\u8c03\u8bd5"},{"location":"dev/debug/pycharm/#_2","text":"\u5c06pycharm-debug.egg\u6587\u4ef6\u62f7\u8d1d\u5230\u8fdc\u7a0b\u4e3b\u673a\u7684python\u7684site-packages\u76ee\u5f55\u4e0b\uff0c\u5e76\u5b89\u88c5\u3002 \u5b89\u88c5pycharm-debug.egg \u5728\u9700\u8981\u8c03\u8bd5\u7684\u4ee3\u7801\u4e2d\u52a0\u5165\u8fdc\u7a0b\u8c03\u8bd5\u6240\u9700\u7684\u4ee3\u7801 \u67e5\u627e\u5230ansible\u6267\u884c\u6587\u4ef6 \u5728\u7a0b\u5e8f\u5165\u53e3\u6dfb\u52a0\u4e0b\u9762\u4e24\u884c\u4ee3\u7801 import pydevd pydevd . settrace ( '192.168.77.1' , port = 9999 , stdoutToServer = True , stderrToServer = True ) \u542f\u52a8ansible\u547d\u4ee4","title":"\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u5b89\u88c5\u8fdc\u7a0b\u8c03\u8bd5\u63d2\u4ef6"},{"location":"dev/debug/pycharm/#pycharm_2","text":"\u67e5\u770bpycharm\u7a97\u53e3\uff0c\u53ef\u4ee5\u770b\u5230\u6709\u94fe\u63a5\u8fdb\u6765\u3002 \u6b64\u65f6\u53ef\u70b9\u51fb\u201dDownload\u201d\u4e0b\u8f7d\u6e90\u7801 \u70b9\u51fb\u5b8c\u6210\u540e\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u8fdc\u7a0b\u7684ansible\u4ee3\u7801\u3002 \u8c03\u8bd5\u7684\u4e00\u4e9b\u5e38\u7528\u6309\u94ae","title":"\u4f7f\u7528PyCharm\u8c03\u8bd5\u8fdc\u7a0b\u4ee3\u7801"},{"location":"dev/debug/verbose-debug/","text":"\u8be6\u7ec6\u8f93\u51fa \u00b6 \u5982\u679c\u4f60\u60f3\u8981\u83b7\u53d6ansible\u8fd0\u884c\u65f6\u6240\u6709\u53d1\u751f\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u53ef\u4ee5\u4f7f\u7528 -vvvv \u6a21\u5f0f\u5f00\u542f\u8be6\u7ec6\u8f93\u51fa\u3002 \u8be6\u7ec6\u8f93\u51fa\u5305\u542b\u51e0\u4e2a\u7247\u6bb5\uff0c\u53ef\u4ee5\u6709\u52a9\u4e8e\u4f60\u67e5\u627e\u95ee\u9898\u3002 \u89e3\u6790\u914d\u7f6e\u6587\u4ef6\u548c\u4e3b\u673a\u6e05\u5355 \u8fdc\u7a0b\u8fde\u63a5\u4fe1\u606f \u901a\u7528\u4fe1\u606f \u8fdc\u7a0b\u6267\u884c\u7684\u6587\u4ef6 \u6a21\u5757\u8f93\u51fa ansible \u8be6\u7ec6\u8f93\u51fa \u00b6 # ansible 192.168.77.130 -m ping -vvvv ansible 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible python version = 2 .7.5 ( default, Aug 7 2019 , 00 :51:29 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] Using /etc/ansible/ansible.cfg as config file setting up inventory plugins host_list declined parsing /etc/ansible/hosts as it did not pass its verify_file () method script declined parsing /etc/ansible/hosts as it did not pass its verify_file () method auto declined parsing /etc/ansible/hosts as it did not pass its verify_file () method Parsed /etc/ansible/hosts inventory source with ini plugin Loading callback plugin minimal of type stdout, v2.0 from /usr/lib/python2.7/site-packages/ansible/plugins/callback/minimal.pyc META: ran handlers < 192 .168.77.130> Attempting python interpreter discovery < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" 'echo PLATFORM; uname; echo FOUND; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.5' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/libexec/platform-python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python3' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python' \"'\" '\"' \"'\" '\"' \"'\" '; echo ENDFOUND && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , 'PLATFORM\\nLinux\\nFOUND\\n/usr/bin/python\\n/usr/bin/python2.7\\n/usr/libexec/platform-python\\n/usr/bin/python\\nENDFOUND\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug1: Control socket \"/root/.ansible/cp/192.168.77.130-root\" does not exist\\r\\ndebug2: resolving \"192.168.77.130\" port 22\\r\\ndebug2: ssh_connect_direct: needpriv 0\\r\\ndebug1: Connecting to 192.168.77.130 [192.168.77.130] port 22.\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug1: fd 3 clearing O_NONBLOCK\\r\\ndebug1: Connection established.\\r\\ndebug3: timeout: 10000 ms remain after connect\\r\\ndebug1: permanently_set_uid: 0/0\\r\\ndebug1: identity file /root/.ssh/id_rsa type 1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_rsa-cert type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_dsa type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_dsa-cert type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ecdsa type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ecdsa-cert type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ed25519 type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ed25519-cert type -1\\r\\ndebug1: Enabling compatibility mode for protocol 2.0\\r\\ndebug1: Local version string SSH-2.0-OpenSSH_7.4\\r\\ndebug1: Remote protocol version 2.0, remote software version OpenSSH_7.4\\r\\ndebug1: match: OpenSSH_7.4 pat OpenSSH* compat 0x04000000\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug1: Authenticating to 192.168.77.130:22 as \\' root \\'\\r\\n debug3: hostkeys_foreach: reading file \"/root/.ssh/known_hosts\" \\r\\n debug3: record_hostkey: found key type ECDSA in file /root/.ssh/known_hosts:3 \\r\\n debug3: load_hostkeys: loaded 1 keys from 192 .168.77.130 \\r\\n debug3: order_hostkeyalgs: prefer hostkeyalgs: ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp521-cert-v01@openssh.com,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521 \\r\\n debug3: send packet: type 20 \\r\\n debug1: SSH2_MSG_KEXINIT sent \\r\\n debug3: receive packet: type 20 \\r\\n debug1: SSH2_MSG_KEXINIT received \\r\\n debug2: local client KEXINIT proposal \\r\\n debug2: KEX algorithms: curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha256,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1,ext-info-c \\r\\n debug2: host key algorithms: ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp521-cert-v01@openssh.com,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,ssh-ed25519-cert-v01@openssh.com,ssh-rsa-cert-v01@openssh.com,ssh-dss-cert-v01@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256,ssh-rsa,ssh-dss \\r\\n debug2: ciphers ctos: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc \\r\\n debug2: ciphers stoc: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc \\r\\n debug2: MACs ctos: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: MACs stoc: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: compression ctos: zlib@openssh.com,zlib,none \\r\\n debug2: compression stoc: zlib@openssh.com,zlib,none \\r\\n debug2: languages ctos: \\r\\n debug2: languages stoc: \\r\\n debug2: first_kex_follows 0 \\r\\n debug2: reserved 0 \\r\\n debug2: peer server KEXINIT proposal \\r\\n debug2: KEX algorithms: curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha256,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1 \\r\\n debug2: host key algorithms: ssh-rsa,rsa-sha2-512,rsa-sha2-256,ecdsa-sha2-nistp256,ssh-ed25519 \\r\\n debug2: ciphers ctos: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc,blowfish-cbc,cast128-cbc,3des-cbc \\r\\n debug2: ciphers stoc: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc,blowfish-cbc,cast128-cbc,3des-cbc \\r\\n debug2: MACs ctos: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: MACs stoc: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: compression ctos: none,zlib@openssh.com \\r\\n debug2: compression stoc: none,zlib@openssh.com \\r\\n debug2: languages ctos: \\r\\n debug2: languages stoc: \\r\\n debug2: first_kex_follows 0 \\r\\n debug2: reserved 0 \\r\\n debug1: kex: algorithm: curve25519-sha256 \\r\\n debug1: kex: host key algorithm: ecdsa-sha2-nistp256 \\r\\n debug1: kex: server->client cipher: chacha20-poly1305@openssh.com MAC: <implicit> compression: zlib@openssh.com \\r\\n debug1: kex: client->server cipher: chacha20-poly1305@openssh.com MAC: <implicit> compression: zlib@openssh.com \\r\\n debug1: kex: curve25519-sha256 need = 64 dh_need = 64 \\r\\n debug1: kex: curve25519-sha256 need = 64 dh_need = 64 \\r\\n debug3: send packet: type 30 \\r\\n debug1: expecting SSH2_MSG_KEX_ECDH_REPLY \\r\\n debug3: receive packet: type 31 \\r\\n debug1: Server host key: ecdsa-sha2-nistp256 SHA256:2lWSIJMF9r8hnfLwlKONY07eQCeZaDVZ/xWZizr9wqs \\r\\n debug3: hostkeys_foreach: reading file \"/root/.ssh/known_hosts\" \\r\\n debug3: record_hostkey: found key type ECDSA in file /root/.ssh/known_hosts:3 \\r\\n debug3: load_hostkeys: loaded 1 keys from 192 .168.77.130 \\r\\n debug1: Host \\' 192 .168.77.130 \\' is known and matches the ECDSA host key. \\r\\n debug1: Found key in /root/.ssh/known_hosts:3 \\r\\n debug3: send packet: type 21 \\r\\n debug2: set_newkeys: mode 1 \\r\\n debug1: rekey after 134217728 blocks \\r\\n debug1: SSH2_MSG_NEWKEYS sent \\r\\n debug1: expecting SSH2_MSG_NEWKEYS \\r\\n debug3: receive packet: type 21 \\r\\n debug1: SSH2_MSG_NEWKEYS received \\r\\n debug2: set_newkeys: mode 0 \\r\\n debug1: rekey after 134217728 blocks \\r\\n debug2: key: /root/.ssh/id_rsa ( 0x55f6213acd00 ) \\r\\n debug2: key: /root/.ssh/id_dsa (( nil )) \\r\\n debug2: key: /root/.ssh/id_ecdsa (( nil )) \\r\\n debug2: key: /root/.ssh/id_ed25519 (( nil )) \\r\\n debug3: send packet: type 5 \\r\\n debug3: receive packet: type 7 \\r\\n debug1: SSH2_MSG_EXT_INFO received \\r\\n debug1: kex_input_ext_info: server-sig-algs = <rsa-sha2-256,rsa-sha2-512> \\r\\n debug3: receive packet: type 6 \\r\\n debug2: service_accept: ssh-userauth \\r\\n debug1: SSH2_MSG_SERVICE_ACCEPT received \\r\\n debug3: send packet: type 50 \\r\\n debug3: receive packet: type 51 \\r\\n debug1: Authentications that can continue : publickey,gssapi-keyex,gssapi-with-mic,password \\r\\n debug3: start over, passed a different list publickey,gssapi-keyex,gssapi-with-mic,password \\r\\n debug3: preferred gssapi-keyex,gssapi-with-mic,publickey,keyboard-interactive,password \\r\\n debug3: authmethod_lookup gssapi-keyex \\r\\n debug3: remaining preferred: gssapi-with-mic,publickey,keyboard-interactive,password \\r\\n debug3: authmethod_is_enabled gssapi-keyex \\r\\n debug1: Next authentication method: gssapi-keyex \\r\\n debug1: No valid Key exchange context \\r\\n debug2: we did not send a packet, disable method \\r\\n debug3: authmethod_lookup gssapi-with-mic \\r\\n debug3: remaining preferred: publickey,keyboard-interactive,password \\r\\n debug3: authmethod_is_enabled gssapi-with-mic \\r\\n debug1: Next authentication method: gssapi-with-mic \\r\\n debug1: Unspecified GSS failure. Minor code may provide more information \\n No Kerberos credentials available ( default cache: KEYRING:persistent:0 ) \\n\\r\\n debug1: Unspecified GSS failure. Minor code may provide more information \\n No Kerberos credentials available ( default cache: KEYRING:persistent:0 ) \\n\\r\\n debug2: we did not send a packet, disable method \\r\\n debug3: authmethod_lookup publickey \\r\\n debug3: remaining preferred: keyboard-interactive,password \\r\\n debug3: authmethod_is_enabled publickey \\r\\n debug1: Next authentication method: publickey \\r\\n debug1: Offering RSA public key: /root/.ssh/id_rsa \\r\\n debug3: send_pubkey_test \\r\\n debug3: send packet: type 50 \\r\\n debug2: we sent a publickey packet, wait for reply \\r\\n debug3: receive packet: type 60 \\r\\n debug1: Server accepts key: pkalg rsa-sha2-512 blen 535 \\r\\n debug2: input_userauth_pk_ok: fp SHA256:fFR+c7Nyf0e+Zr3vsC0dKzR2EcfUwOu6Ku1EaTvvSmM \\r\\n debug3: sign_and_send_pubkey: RSA SHA256:fFR+c7Nyf0e+Zr3vsC0dKzR2EcfUwOu6Ku1EaTvvSmM \\r\\n debug3: send packet: type 50 \\r\\n debug3: receive packet: type 52 \\r\\n debug1: Enabling compression at level 6 . \\r\\n debug1: Authentication succeeded ( publickey ) . \\r\\n Authenticated to 192 .168.77.130 ([ 192 .168.77.130 ] :22 ) . \\r\\n debug1: setting up multiplex master socket \\r\\n debug3: muxserver_listen: temporary control path /root/.ansible/cp/192.168.77.130-root.oO7SZfDChRqqB6Dk \\r\\n debug2: fd 4 setting O_NONBLOCK \\r\\n debug3: fd 4 is O_NONBLOCK \\r\\n debug3: fd 4 is O_NONBLOCK \\r\\n debug1: channel 0 : new [ /root/.ansible/cp/192.168.77.130-root ] \\r\\n debug3: muxserver_listen: mux listener channel 0 fd 4 \\r\\n debug2: fd 3 setting TCP_NODELAY \\r\\n debug3: ssh_packet_set_tos: set IP_TOS 0x08 \\r\\n debug1: control_persist_detach: backgrounding master process \\r\\n debug2: control_persist_detach: background process is 56533 \\r\\n debug2: fd 4 setting O_NONBLOCK \\r\\n debug1: forking to background \\r\\n debug1: Entering interactive session. \\r\\n debug1: pledge: id \\r\\n debug2: set_control_persist_exit_time: schedule exit in 60 seconds \\r\\n debug1: multiplexing control connection \\r\\n debug2: fd 5 setting O_NONBLOCK \\r\\n debug3: fd 5 is O_NONBLOCK \\r\\n debug1: channel 1 : new [ mux-control ] \\r\\n debug3: channel_post_mux_listener: new mux channel 1 fd 5 \\r\\n debug3: mux_master_read_cb: channel 1 : hello sent \\r\\n debug2: set_control_persist_exit_time: cancel scheduled exit \\r\\n debug3: mux_master_read_cb: channel 1 packet type 0x00000001 len 4 \\r\\n debug2: process_mux_master_hello: channel 1 slave version 4 \\r\\n debug2: mux_client_hello_exchange: master version 4 \\r\\n debug3: mux_client_forwards: request forwardings: 0 local, 0 remote \\r\\n debug3: mux_client_request_session: entering \\r\\n debug3: mux_client_request_alive: entering \\r\\n debug3: mux_master_read_cb: channel 1 packet type 0x10000004 len 4 \\r\\n debug2: process_mux_alive_check: channel 1 : alive check \\r\\n debug3: mux_client_request_alive: done pid = 56535 \\r\\n debug3: mux_client_request_session: session request sent \\r\\n debug3: mux_master_read_cb: channel 1 packet type 0x10000002 len 449 \\r\\n debug2: process_mux_new_session: channel 1 : request tty 0 , X 0 , agent 0 , subsys 0 , term \"xterm\" , cmd \"/bin/sh -c \\'echo PLATFORM; uname; echo FOUND; command -v \\'\" \\' \"\\'/usr/bin/python\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python3.7\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python3.6\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python3.5\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python2.7\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python2.6\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'/usr/libexec/platform-python\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'/usr/bin/python3\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python\\'\" \\' \"\\'; echo ENDFOUND && sleep 0\\'\" , env 1 \\r\\n debug3: process_mux_new_session: got fds stdin 6 , stdout 7 , stderr 8 \\r\\n debug2: fd 7 setting O_NONBLOCK \\r\\n debug2: fd 8 setting O_NONBLOCK \\r\\n debug1: channel 2 : new [ client-session ] \\r\\n debug2: process_mux_new_session: channel_new: 2 linked to control channel 1 \\r\\n debug2: channel 2 : send open \\r\\n debug3: send packet: type 90 \\r\\n debug3: receive packet: type 80 \\r\\n debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0 \\r\\n debug3: receive packet: type 91 \\r\\n debug2: callback start \\r\\n debug2: client_session2_setup: id 2 \\r\\n debug1: Sending environment. \\r\\n debug1: Sending env LANG = zh_CN.UTF-8 \\r\\n debug2: channel 2 : request env confirm 0 \\r\\n debug3: send packet: type 98 \\r\\n debug1: Sending command: /bin/sh -c \\' echo PLATFORM ; uname ; echo FOUND ; command -v \\' \"\\'\" \\' /usr/bin/python \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python3.7 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python3.6 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python3.5 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python2.7 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python2.6 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' /usr/libexec/platform-python \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' /usr/bin/python3 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python \\' \"\\'\" \\' ; echo ENDFOUND && sleep 0 \\'\\r\\n debug2: channel 2 : request exec confirm 1 \\r\\n debug3: send packet: type 98 \\r\\n debug3: mux_session_confirm: sending success reply \\r\\n debug2: callback done \\r\\n debug2: channel 2 : open confirm rwindow 0 rmax 32768 \\r\\n debug1: mux_client_request_session: master session id: 2 \\r\\n debug2: channel 2 : rcvd adjust 2097152 \\r\\n debug3: receive packet: type 99 \\r\\n debug2: channel_input_status_confirm: type 99 id 2 \\r\\n debug2: exec request accepted on channel 2 \\r\\n debug3: receive packet: type 98 \\r\\n debug1: client_input_channel_req: channel 2 rtype exit-status reply 0 \\r\\n debug3: mux_exit_message: channel 2 : exit message, exitval 0 \\r\\n debug3: receive packet: type 98 \\r\\n debug1: client_input_channel_req: channel 2 rtype eow@openssh.com reply 0 \\r\\n debug2: channel 2 : rcvd eow \\r\\n debug2: channel 2 : close_read \\r\\n debug2: channel 2 : input open -> closed \\r\\n debug3: receive packet: type 96 \\r\\n debug2: channel 2 : rcvd eof \\r\\n debug2: channel 2 : output open -> drain \\r\\n debug2: channel 2 : obuf empty \\r\\n debug2: channel 2 : close_write \\r\\n debug2: channel 2 : output drain -> closed \\r\\n debug3: receive packet: type 97 \\r\\n debug2: channel 2 : rcvd close \\r\\n debug3: channel 2 : will not send data after close \\r\\n debug2: channel 2 : send close \\r\\n debug3: send packet: type 97 \\r\\n debug2: channel 2 : is dead \\r\\n debug2: channel 2 : gc: notify user \\r\\n debug3: mux_master_session_cleanup_cb: entering for channel 2 \\r\\n debug2: channel 1 : rcvd close \\r\\n debug2: channel 1 : output open -> drain \\r\\n debug2: channel 1 : close_read \\r\\n debug2: channel 1 : input open -> closed \\r\\n debug2: channel 2 : gc: user detached \\r\\n debug2: channel 2 : is dead \\r\\n debug2: channel 2 : garbage collecting \\r\\n debug1: channel 2 : free: client-session, nchannels 3 \\r\\n debug3: channel 2 : status: The following connections are open: \\r\\n #1 mux-control (t16 r-1 i3/0 o1/16 fd 5/5 cc -1)\\r\\n #2 client-session (t4 r0 i3/0 o3/0 fd -1/-1 cc -1)\\r\\n\\r\\ndebug2: channel 1: obuf empty\\r\\ndebug2: channel 1: close_write\\r\\ndebug2: channel 1: output drain -> closed\\r\\ndebug2: channel 1: is dead (local)\\r\\ndebug2: channel 1: gc: notify user\\r\\ndebug3: mux_master_control_cleanup_cb: entering for channel 1\\r\\ndebug2: channel 1: gc: user detached\\r\\ndebug2: channel 1: is dead (local)\\r\\ndebug2: channel 1: garbage collecting\\r\\ndebug1: channel 1: free: mux-control, nchannels 2\\r\\ndebug3: channel 1: status: The following connections are open:\\r\\n #1 mux-control (t16 r-1 i3/0 o3/0 fd 5/5 cc -1)\\r\\n\\r\\ndebug2: set_control_persist_exit_time: schedule exit in 60 seconds\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n') < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '{\"osrelease_content\": \"NAME=\\\\\"CentOS Linux\\\\\"\\\\nVERSION=\\\\\"7 (Core)\\\\\"\\\\nID=\\\\\"centos\\\\\"\\\\nID_LIKE=\\\\\"rhel fedora\\\\\"\\\\nVERSION_ID=\\\\\"7\\\\\"\\\\nPRETTY_NAME=\\\\\"CentOS Linux 7 (Core)\\\\\"\\\\nANSI_COLOR=\\\\\"0;31\\\\\"\\\\nCPE_NAME=\\\\\"cpe:/o:centos:centos:7\\\\\"\\\\nHOME_URL=\\\\\"https://www.centos.org/\\\\\"\\\\nBUG_REPORT_URL=\\\\\"https://bugs.centos.org/\\\\\"\\\\n\\\\nCENTOS_MANTISBT_PROJECT=\\\\\"CentOS-7\\\\\"\\\\nCENTOS_MANTISBT_PROJECT_VERSION=\\\\\"7\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT=\\\\\"centos\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT_VERSION=\\\\\"7\\\\\"\\\\n\\\\n\", \"platform_dist_result\": [\"centos\", \"7.4.1708\", \"Core\"]}\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug2: mux_client_hello_exchange: master version 4\\r\\ndebug3: mux_client_forwards: request forwardings: 0 local, 0 remote\\r\\ndebug3: mux_client_request_session: entering\\r\\ndebug3: mux_client_request_alive: entering\\r\\ndebug3: mux_client_request_alive: done pid = 56535\\r\\ndebug3: mux_client_request_session: session request sent\\r\\ndebug1: mux_client_request_session: master session id: 2\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n' ) Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/ping.py Pipelining is enabled. < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '\\n{\"invocation\": {\"module_args\": {\"data\": \"pong\"}}, \"ping\": \"pong\"}\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug2: mux_client_hello_exchange: master version 4\\r\\ndebug3: mux_client_forwards: request forwardings: 0 local, 0 remote\\r\\ndebug3: mux_client_request_session: entering\\r\\ndebug3: mux_client_request_alive: entering\\r\\ndebug3: mux_client_request_alive: done pid = 56535\\r\\ndebug3: mux_client_request_session: session request sent\\r\\ndebug1: mux_client_request_session: master session id: 2\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n' ) 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"invocation\" : { \"module_args\" : { \"data\" : \"pong\" } } , \"ping\" : \"pong\" } META: ran handlers META: ran handlers playbook \u8be6\u7ec6\u8f93\u51fa \u00b6 # ansible-playbook test.yml -vvvv ansible-playbook 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible-playbook python version = 2 .7.5 ( default, Aug 7 2019 , 00 :51:29 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] Using /etc/ansible/ansible.cfg as config file setting up inventory plugins host_list declined parsing /etc/ansible/hosts as it did not pass its verify_file () method script declined parsing /etc/ansible/hosts as it did not pass its verify_file () method auto declined parsing /etc/ansible/hosts as it did not pass its verify_file () method Parsed /etc/ansible/hosts inventory source with ini plugin Loading callback plugin default of type stdout, v2.0 from /usr/lib/python2.7/site-packages/ansible/plugins/callback/default.pyc PLAYBOOK: test.yml *********************************************************************************************************************************************************************************** Positional arguments: test.yml become_method: sudo inventory: ( u '/etc/ansible/hosts' , ) forks: 5 tags: ( u 'all' , ) verbosity: 4 connection: smart timeout: 10 1 plays in test.yml PLAY [ 192 .168.77.130 ] ******************************************************************************************************************************************************************************** TASK [ Gathering Facts ] ******************************************************************************************************************************************************************************* task path: /etc/ansible/test.yml:3 < 192 .168.77.130> Attempting python interpreter discovery < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" 'echo PLATFORM; uname; echo FOUND; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.5' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/libexec/platform-python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python3' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python' \"'\" '\"' \"'\" '\"' \"'\" '; echo ENDFOUND && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , 'PLATFORM\\nLinux\\nFOUND\\n/usr/bin/python\\n/usr/bin/python2.7\\n/usr/libexec/platform-python\\n/usr/bin/python\\nENDFOUND\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug1: Control socket \"/root/.ansible/cp/192.168.77.130-root\" does not exist\\r\\ndebug2: resolving \"192.168.77.130\" port 22\\r\\ndebug2: ssh_connect_direct: needpriv 0\\r\\ndebug1: Connecting to 192.168.77.130 [192.168.77.130] port 22.\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug1: fd 3 clearing O_NONBLOCK\\r\\ndebug1: Connection established.\\r\\ndebug3: timeout: 10000 ms remain after connect\\r\\ndebug1: permanently_set_uid: 0/0\\r\\ndebug1: identity file /root/.ssh/id_rsa type 1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_rsa-cert type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_dsa type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_dsa-cert type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ecdsa type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ecdsa-cert type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ed25519 type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ed25519-cert type -1\\r\\ndebug1: Enabling compatibility mode for protocol 2.0\\r\\ndebug1: Local version string SSH-2.0-OpenSSH_7.4\\r\\ndebug1: Remote protocol version 2.0, remote software version OpenSSH_7.4\\r\\ndebug1: match: OpenSSH_7.4 pat OpenSSH* compat 0x04000000\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug1: Authenticating to 192.168.77.130:22 as \\' root \\'\\r\\n debug3: hostkeys_foreach: reading file \"/root/.ssh/known_hosts\" \\r\\n debug3: record_hostkey: found key type ECDSA in file /root/.ssh/known_hosts:3 \\r\\n debug3: load_hostkeys: loaded 1 keys from 192 .168.77.130 \\r\\n debug3: order_hostkeyalgs: prefer hostkeyalgs: ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp521-cert-v01@openssh.com,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521 \\r\\n debug3: send packet: type 20 \\r\\n debug1: SSH2_MSG_KEXINIT sent \\r\\n debug3: receive packet: type 20 \\r\\n debug1: SSH2_MSG_KEXINIT received \\r\\n debug2: local client KEXINIT proposal \\r\\n debug2: KEX algorithms: curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha256,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1,ext-info-c \\r\\n debug2: host key algorithms: ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp521-cert-v01@openssh.com,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,ssh-ed25519-cert-v01@openssh.com,ssh-rsa-cert-v01@openssh.com,ssh-dss-cert-v01@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256,ssh-rsa,ssh-dss \\r\\n debug2: ciphers ctos: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc \\r\\n debug2: ciphers stoc: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc \\r\\n debug2: MACs ctos: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: MACs stoc: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: compression ctos: zlib@openssh.com,zlib,none \\r\\n debug2: compression stoc: zlib@openssh.com,zlib,none \\r\\n debug2: languages ctos: \\r\\n debug2: languages stoc: \\r\\n debug2: first_kex_follows 0 \\r\\n debug2: reserved 0 \\r\\n debug2: peer server KEXINIT proposal \\r\\n debug2: KEX algorithms: curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha256,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1 \\r\\n debug2: host key algorithms: ssh-rsa,rsa-sha2-512,rsa-sha2-256,ecdsa-sha2-nistp256,ssh-ed25519 \\r\\n debug2: ciphers ctos: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc,blowfish-cbc,cast128-cbc,3des-cbc \\r\\n debug2: ciphers stoc: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc,blowfish-cbc,cast128-cbc,3des-cbc \\r\\n debug2: MACs ctos: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: MACs stoc: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: compression ctos: none,zlib@openssh.com \\r\\n debug2: compression stoc: none,zlib@openssh.com \\r\\n debug2: languages ctos: \\r\\n debug2: languages stoc: \\r\\n debug2: first_kex_follows 0 \\r\\n debug2: reserved 0 \\r\\n debug1: kex: algorithm: curve25519-sha256 \\r\\n debug1: kex: host key algorithm: ecdsa-sha2-nistp256 \\r\\n debug1: kex: server->client cipher: chacha20-poly1305@openssh.com MAC: <implicit> compression: zlib@openssh.com \\r\\n debug1: kex: client->server cipher: chacha20-poly1305@openssh.com MAC: <implicit> compression: zlib@openssh.com \\r\\n debug1: kex: curve25519-sha256 need = 64 dh_need = 64 \\r\\n debug1: kex: curve25519-sha256 need = 64 dh_need = 64 \\r\\n debug3: send packet: type 30 \\r\\n debug1: expecting SSH2_MSG_KEX_ECDH_REPLY \\r\\n debug3: receive packet: type 31 \\r\\n debug1: Server host key: ecdsa-sha2-nistp256 SHA256:2lWSIJMF9r8hnfLwlKONY07eQCeZaDVZ/xWZizr9wqs \\r\\n debug3: hostkeys_foreach: reading file \"/root/.ssh/known_hosts\" \\r\\n debug3: record_hostkey: found key type ECDSA in file /root/.ssh/known_hosts:3 \\r\\n debug3: load_hostkeys: loaded 1 keys from 192 .168.77.130 \\r\\n debug1: Host \\' 192 .168.77.130 \\' is known and matches the ECDSA host key. \\r\\n debug1: Found key in /root/.ssh/known_hosts:3 \\r\\n debug3: send packet: type 21 \\r\\n debug2: set_newkeys: mode 1 \\r\\n debug1: rekey after 134217728 blocks \\r\\n debug1: SSH2_MSG_NEWKEYS sent \\r\\n debug1: expecting SSH2_MSG_NEWKEYS \\r\\n debug3: receive packet: type 21 \\r\\n debug1: SSH2_MSG_NEWKEYS received \\r\\n debug2: set_newkeys: mode 0 \\r\\n debug1: rekey after 134217728 blocks \\r\\n debug2: key: /root/.ssh/id_rsa ( 0x556b5d8e7d20 ) \\r\\n debug2: key: /root/.ssh/id_dsa (( nil )) \\r\\n debug2: key: /root/.ssh/id_ecdsa (( nil )) \\r\\n debug2: key: /root/.ssh/id_ed25519 (( nil )) \\r\\n debug3: send packet: type 5 \\r\\n debug3: receive packet: type 7 \\r\\n debug1: SSH2_MSG_EXT_INFO received \\r\\n debug1: kex_input_ext_info: server-sig-algs = <rsa-sha2-256,rsa-sha2-512> \\r\\n debug3: receive packet: type 6 \\r\\n debug2: service_accept: ssh-userauth \\r\\n debug1: SSH2_MSG_SERVICE_ACCEPT received \\r\\n debug3: send packet: type 50 \\r\\n debug3: receive packet: type 51 \\r\\n debug1: Authentications that can continue : publickey,gssapi-keyex,gssapi-with-mic,password \\r\\n debug3: start over, passed a different list publickey,gssapi-keyex,gssapi-with-mic,password \\r\\n debug3: preferred gssapi-keyex,gssapi-with-mic,publickey,keyboard-interactive,password \\r\\n debug3: authmethod_lookup gssapi-keyex \\r\\n debug3: remaining preferred: gssapi-with-mic,publickey,keyboard-interactive,password \\r\\n debug3: authmethod_is_enabled gssapi-keyex \\r\\n debug1: Next authentication method: gssapi-keyex \\r\\n debug1: No valid Key exchange context \\r\\n debug2: we did not send a packet, disable method \\r\\n debug3: authmethod_lookup gssapi-with-mic \\r\\n debug3: remaining preferred: publickey,keyboard-interactive,password \\r\\n debug3: authmethod_is_enabled gssapi-with-mic \\r\\n debug1: Next authentication method: gssapi-with-mic \\r\\n debug1: Unspecified GSS failure. Minor code may provide more information \\n No Kerberos credentials available ( default cache: KEYRING:persistent:0 ) \\n\\r\\n debug1: Unspecified GSS failure. Minor code may provide more information \\n No Kerberos credentials available ( default cache: KEYRING:persistent:0 ) \\n\\r\\n debug2: we did not send a packet, disable method \\r\\n debug3: authmethod_lookup publickey \\r\\n debug3: remaining preferred: keyboard-interactive,password \\r\\n debug3: authmethod_is_enabled publickey \\r\\n debug1: Next authentication method: publickey \\r\\n debug1: Offering RSA public key: /root/.ssh/id_rsa \\r\\n debug3: send_pubkey_test \\r\\n debug3: send packet: type 50 \\r\\n debug2: we sent a publickey packet, wait for reply \\r\\n debug3: receive packet: type 60 \\r\\n debug1: Server accepts key: pkalg rsa-sha2-512 blen 535 \\r\\n debug2: input_userauth_pk_ok: fp SHA256:fFR+c7Nyf0e+Zr3vsC0dKzR2EcfUwOu6Ku1EaTvvSmM \\r\\n debug3: sign_and_send_pubkey: RSA SHA256:fFR+c7Nyf0e+Zr3vsC0dKzR2EcfUwOu6Ku1EaTvvSmM \\r\\n debug3: send packet: type 50 \\r\\n debug3: receive packet: type 52 \\r\\n debug1: Enabling compression at level 6 . \\r\\n debug1: Authentication succeeded ( publickey ) . \\r\\n Authenticated to 192 .168.77.130 ([ 192 .168.77.130 ] :22 ) . \\r\\n debug1: setting up multiplex master socket \\r\\n debug3: muxserver_listen: temporary control path /root/.ansible/cp/192.168.77.130-root.2qeJDnNpYpqMN20m \\r\\n debug2: fd 4 setting O_NONBLOCK \\r\\n debug3: fd 4 is O_NONBLOCK \\r\\n debug3: fd 4 is O_NONBLOCK \\r\\n debug1: channel 0 : new [ /root/.ansible/cp/192.168.77.130-root ] \\r\\n debug3: muxserver_listen: mux listener channel 0 fd 4 \\r\\n debug2: fd 3 setting TCP_NODELAY \\r\\n debug3: ssh_packet_set_tos: set IP_TOS 0x08 \\r\\n debug1: control_persist_detach: backgrounding master process \\r\\n debug2: control_persist_detach: background process is 56633 \\r\\n debug2: fd 4 setting O_NONBLOCK \\r\\n debug1: forking to background \\r\\n debug1: Entering interactive session. \\r\\n debug1: pledge: id \\r\\n debug2: set_control_persist_exit_time: schedule exit in 60 seconds \\r\\n debug1: multiplexing control connection \\r\\n debug2: fd 5 setting O_NONBLOCK \\r\\n debug3: fd 5 is O_NONBLOCK \\r\\n debug1: channel 1 : new [ mux-control ] \\r\\n debug3: channel_post_mux_listener: new mux channel 1 fd 5 \\r\\n debug3: mux_master_read_cb: channel 1 : hello sent \\r\\n debug2: set_control_persist_exit_time: cancel scheduled exit \\r\\n debug3: mux_master_read_cb: channel 1 packet type 0x00000001 len 4 \\r\\n debug2: process_mux_master_hello: channel 1 slave version 4 \\r\\n debug2: mux_client_hello_exchange: master version 4 \\r\\n debug3: mux_client_forwards: request forwardings: 0 local, 0 remote \\r\\n debug3: mux_client_request_session: entering \\r\\n debug3: mux_client_request_alive: entering \\r\\n debug3: mux_master_read_cb: channel 1 packet type 0x10000004 len 4 \\r\\n debug2: process_mux_alive_check: channel 1 : alive check \\r\\n debug3: mux_client_request_alive: done pid = 56635 \\r\\n debug3: mux_client_request_session: session request sent \\r\\n debug3: mux_master_read_cb: channel 1 packet type 0x10000002 len 449 \\r\\n debug2: process_mux_new_session: channel 1 : request tty 0 , X 0 , agent 0 , subsys 0 , term \"xterm\" , cmd \"/bin/sh -c \\'echo PLATFORM; uname; echo FOUND; command -v \\'\" \\' \"\\'/usr/bin/python\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python3.7\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python3.6\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python3.5\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python2.7\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python2.6\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'/usr/libexec/platform-python\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'/usr/bin/python3\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python\\'\" \\' \"\\'; echo ENDFOUND && sleep 0\\'\" , env 1 \\r\\n debug3: process_mux_new_session: got fds stdin 6 , stdout 7 , stderr 8 \\r\\n debug2: fd 7 setting O_NONBLOCK \\r\\n debug2: fd 8 setting O_NONBLOCK \\r\\n debug1: channel 2 : new [ client-session ] \\r\\n debug2: process_mux_new_session: channel_new: 2 linked to control channel 1 \\r\\n debug2: channel 2 : send open \\r\\n debug3: send packet: type 90 \\r\\n debug3: receive packet: type 80 \\r\\n debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0 \\r\\n debug3: receive packet: type 91 \\r\\n debug2: callback start \\r\\n debug2: client_session2_setup: id 2 \\r\\n debug1: Sending environment. \\r\\n debug1: Sending env LANG = zh_CN.UTF-8 \\r\\n debug2: channel 2 : request env confirm 0 \\r\\n debug3: send packet: type 98 \\r\\n debug1: Sending command: /bin/sh -c \\' echo PLATFORM ; uname ; echo FOUND ; command -v \\' \"\\'\" \\' /usr/bin/python \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python3.7 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python3.6 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python3.5 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python2.7 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python2.6 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' /usr/libexec/platform-python \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' /usr/bin/python3 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python \\' \"\\'\" \\' ; echo ENDFOUND && sleep 0 \\'\\r\\n debug2: channel 2 : request exec confirm 1 \\r\\n debug3: send packet: type 98 \\r\\n debug3: mux_session_confirm: sending success reply \\r\\n debug2: callback done \\r\\n debug2: channel 2 : open confirm rwindow 0 rmax 32768 \\r\\n debug1: mux_client_request_session: master session id: 2 \\r\\n debug2: channel 2 : rcvd adjust 2097152 \\r\\n debug3: receive packet: type 99 \\r\\n debug2: channel_input_status_confirm: type 99 id 2 \\r\\n debug2: exec request accepted on channel 2 \\r\\n debug3: receive packet: type 98 \\r\\n debug1: client_input_channel_req: channel 2 rtype exit-status reply 0 \\r\\n debug3: mux_exit_message: channel 2 : exit message, exitval 0 \\r\\n debug3: receive packet: type 98 \\r\\n debug1: client_input_channel_req: channel 2 rtype eow@openssh.com reply 0 \\r\\n debug2: channel 2 : rcvd eow \\r\\n debug2: channel 2 : close_read \\r\\n debug2: channel 2 : input open -> closed \\r\\n debug3: receive packet: type 96 \\r\\n debug2: channel 2 : rcvd eof \\r\\n debug2: channel 2 : output open -> drain \\r\\n debug2: channel 2 : obuf empty \\r\\n debug2: channel 2 : close_write \\r\\n debug2: channel 2 : output drain -> closed \\r\\n debug3: receive packet: type 97 \\r\\n debug2: channel 2 : rcvd close \\r\\n debug3: channel 2 : will not send data after close \\r\\n debug2: channel 2 : send close \\r\\n debug3: send packet: type 97 \\r\\n debug2: channel 2 : is dead \\r\\n debug2: channel 2 : gc: notify user \\r\\n debug3: mux_master_session_cleanup_cb: entering for channel 2 \\r\\n debug2: channel 1 : rcvd close \\r\\n debug2: channel 1 : output open -> drain \\r\\n debug2: channel 1 : close_read \\r\\n debug2: channel 1 : input open -> closed \\r\\n debug2: channel 2 : gc: user detached \\r\\n debug2: channel 2 : is dead \\r\\n debug2: channel 2 : garbage collecting \\r\\n debug1: channel 2 : free: client-session, nchannels 3 \\r\\n debug3: channel 2 : status: The following connections are open: \\r\\n #1 mux-control (t16 r-1 i3/0 o1/16 fd 5/5 cc -1)\\r\\n #2 client-session (t4 r0 i3/0 o3/0 fd -1/-1 cc -1)\\r\\n\\r\\ndebug2: channel 1: obuf empty\\r\\ndebug2: channel 1: close_write\\r\\ndebug2: channel 1: output drain -> closed\\r\\ndebug2: channel 1: is dead (local)\\r\\ndebug2: channel 1: gc: notify user\\r\\ndebug3: mux_master_control_cleanup_cb: entering for channel 1\\r\\ndebug2: channel 1: gc: user detached\\r\\ndebug2: channel 1: is dead (local)\\r\\ndebug2: channel 1: garbage collecting\\r\\ndebug1: channel 1: free: mux-control, nchannels 2\\r\\ndebug3: channel 1: status: The following connections are open:\\r\\n #1 mux-control (t16 r-1 i3/0 o3/0 fd 5/5 cc -1)\\r\\n\\r\\ndebug2: set_control_persist_exit_time: schedule exit in 60 seconds\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n') < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '{\"osrelease_content\": \"NAME=\\\\\"CentOS Linux\\\\\"\\\\nVERSION=\\\\\"7 (Core)\\\\\"\\\\nID=\\\\\"centos\\\\\"\\\\nID_LIKE=\\\\\"rhel fedora\\\\\"\\\\nVERSION_ID=\\\\\"7\\\\\"\\\\nPRETTY_NAME=\\\\\"CentOS Linux 7 (Core)\\\\\"\\\\nANSI_COLOR=\\\\\"0;31\\\\\"\\\\nCPE_NAME=\\\\\"cpe:/o:centos:centos:7\\\\\"\\\\nHOME_URL=\\\\\"https://www.centos.org/\\\\\"\\\\nBUG_REPORT_URL=\\\\\"https://bugs.centos.org/\\\\\"\\\\n\\\\nCENTOS_MANTISBT_PROJECT=\\\\\"CentOS-7\\\\\"\\\\nCENTOS_MANTISBT_PROJECT_VERSION=\\\\\"7\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT=\\\\\"centos\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT_VERSION=\\\\\"7\\\\\"\\\\n\\\\n\", \"platform_dist_result\": [\"centos\", \"7.4.1708\", \"Core\"]}\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug2: mux_client_hello_exchange: master version 4\\r\\ndebug3: mux_client_forwards: request forwardings: 0 local, 0 remote\\r\\ndebug3: mux_client_request_session: entering\\r\\ndebug3: mux_client_request_alive: entering\\r\\ndebug3: mux_client_request_alive: done pid = 56635\\r\\ndebug3: mux_client_request_session: session request sent\\r\\ndebug1: mux_client_request_session: master session id: 2\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n' ) Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/setup.py Pipelining is enabled. < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '\\n{\"invocation\": {\"module_args\": {\"filter\": \"*\", \"gather_subset\": [\"all\"], \"fact_path\": \"/etc/ansible/facts.d\", \"gather_timeout\": 10}}, \"ansible_facts\": {\"ansible_fibre_channel_wwn\": [], \"module_setup\": true, \"ansible_distribution_version\": \"7.4\", \"ansible_distribution_file_variety\": \"RedHat\", \"ansible_env\": {\"LANG\": \"zh_CN.UTF-8\", \"SHELL\": \"/bin/bash\", \"XDG_RUNTIME_DIR\": \"/run/user/0\", \"SHLVL\": \"2\", \"XDG_SESSION_ID\": \"180\", \"CLASSPATH\": \".:/usr/java/jdk1.8.0_131/lib/dt.jar:/usr/java/jdk1.8.0_131/lib/tools.jar\", \"PWD\": \"/root\", \"LESSOPEN\": \"||/usr/bin/lesspipe.sh %s\", \"SSH_CLIENT\": \"192.168.77.130 37228 22\", \"LOGNAME\": \"root\", \"USER\": \"root\", \"MAIL\": \"/var/mail/root\", \"PATH\": \"/usr/java/jdk1.8.0_131/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin\", \"JAVA_HOME\": \"/usr/java/jdk1.8.0_131\", \"HOME\": \"/root\", \"_\": \"/usr/bin/python\", \"SSH_CONNECTION\": \"192.168.77.130 37228 192.168.77.130 22\"}, \"ansible_userspace_bits\": \"64\", \"ansible_architecture\": \"x86_64\", \"ansible_default_ipv4\": {\"macaddress\": \"00:0c:29:db:d1:39\", \"network\": \"192.168.77.0\", \"mtu\": 1500, \"broadcast\": \"192.168.77.255\", \"alias\": \"ens33\", \"netmask\": \"255.255.255.0\", \"address\": \"192.168.77.130\", \"interface\": \"ens33\", \"type\": \"ether\", \"gateway\": \"192.168.77.2\"}, \"ansible_swapfree_mb\": 10116, \"ansible_default_ipv6\": {}, \"ansible_cmdline\": {\"BOOT_IMAGE\": \"/vmlinuz-5.1.15-1.el7.elrepo.x86_64\", \"quiet\": true, \"user_namespace.enable\": \"1\", \"rhgb\": true, \"crashkernel\": \"auto\", \"ro\": true, \"root\": \"UUID=a7d49533-e756-4a71-a977-5efb174eb09c\"}, \"ansible_machine_id\": \"c6e2cb0cdbad41f19c30d690896aabe0\", \"ansible_userspace_architecture\": \"x86_64\", \"ansible_product_uuid\": \"5af44d56-0800-32e7-8576-613693dbd139\", \"ansible_pkg_mgr\": \"yum\", \"ansible_distribution\": \"CentOS\", \"ansible_iscsi_iqn\": \"\", \"ansible_all_ipv6_addresses\": [\"fe80::42:56ff:fec2:83be\", \"fe80::20c:29ff:fedb:d139\"], \"ansible_uptime_seconds\": 75217, \"ansible_kernel\": \"5.1.15-1.el7.elrepo.x86_64\", \"ansible_system_capabilities_enforced\": \"True\", \"ansible_python\": {\"executable\": \"/usr/bin/python\", \"version\": {\"micro\": 5, \"major\": 2, \"releaselevel\": \"final\", \"serial\": 0, \"minor\": 7}, \"type\": \"CPython\", \"has_sslcontext\": true, \"version_info\": [2, 7, 5, \"final\", 0]}, \"ansible_is_chroot\": false, \"ansible_hostnqn\": \"\", \"ansible_user_shell\": \"/bin/bash\", \"ansible_product_serial\": \"VMware-56 4d f4 5a 00 08 e7 32-85 76 61 36 93 db d1 39\", \"ansible_form_factor\": \"Other\", \"ansible_distribution_file_parsed\": true, \"ansible_fips\": false, \"ansible_user_id\": \"root\", \"ansible_selinux_python_present\": true, \"ansible_kernel_version\": \"#1 SMP Tue Jun 25 10:52:45 EDT 2019\", \"ansible_local\": {}, \"ansible_processor_vcpus\": 1, \"ansible_docker0\": {\"macaddress\": \"02:42:56:c2:83:be\", \"features\": {\"tx_checksum_ipv4\": \"off [fixed]\", \"generic_receive_offload\": \"on\", \"tx_checksum_ipv6\": \"off [fixed]\", \"tx_scatter_gather_fraglist\": \"on\", \"rx_all\": \"off [fixed]\", \"highdma\": \"on\", \"tls_hw_rx_offload\": \"off [fixed]\", \"tx_lockless\": \"on [fixed]\", \"tx_tcp_ecn_segmentation\": \"on\", \"rx_udp_tunnel_port_offload\": \"off [fixed]\", \"esp_hw_offload\": \"off [fixed]\", \"tx_gso_robust\": \"on\", \"tx_udp_segmentation\": \"on\", \"tx_tcp_mangleid_segmentation\": \"on\", \"tx_ipxip4_segmentation\": \"on\", \"tx_checksumming\": \"on\", \"vlan_challenged\": \"off [fixed]\", \"loopback\": \"off [fixed]\", \"tx_ipxip6_segmentation\": \"on\", \"fcoe_mtu\": \"off [fixed]\", \"scatter_gather\": \"on\", \"tx_checksum_sctp\": \"off [fixed]\", \"tx_vlan_stag_hw_insert\": \"on\", \"rx_vlan_stag_hw_parse\": \"off [fixed]\", \"tx_gso_partial\": \"on\", \"tx_tcp_segmentation\": \"on\", \"rx_vlan_stag_filter\": \"off [fixed]\", \"large_receive_offload\": \"off [fixed]\", \"tx_scatter_gather\": \"on\", \"tx_tcp6_segmentation\": \"on\", \"rx_checksumming\": \"off [fixed]\", \"rx_gro_hw\": \"off [fixed]\", \"netns_local\": \"on [fixed]\", \"tx_esp_segmentation\": \"on\", \"generic_segmentation_offload\": \"on\", \"rx_fcs\": \"off [fixed]\", \"tcp_segmentation_offload\": \"on\", \"l2_fwd_offload\": \"off [fixed]\", \"rx_vlan_offload\": \"off [fixed]\", \"ntuple_filters\": \"off [fixed]\", \"tx_gre_csum_segmentation\": \"on\", \"esp_tx_csum_hw_offload\": \"off [fixed]\", \"tx_udp_tnl_segmentation\": \"on\", \"tx_udp_tnl_csum_segmentation\": \"on\", \"tx_sctp_segmentation\": \"on\", \"udp_fragmentation_offload\": \"off\", \"tls_hw_record\": \"off [fixed]\", \"tls_hw_tx_offload\": \"off [fixed]\", \"tx_checksum_fcoe_crc\": \"off [fixed]\", \"hw_tc_offload\": \"off [fixed]\", \"tx_checksum_ip_generic\": \"on\", \"tx_fcoe_segmentation\": \"on\", \"tx_nocache_copy\": \"off\", \"rx_vlan_filter\": \"off [fixed]\", \"tx_vlan_offload\": \"on\", \"receive_hashing\": \"off [fixed]\", \"tx_gre_segmentation\": \"on\"}, \"interfaces\": [], \"id\": \"8000.024256c283be\", \"mtu\": 1500, \"device\": \"docker0\", \"promisc\": false, \"stp\": false, \"ipv4\": {\"broadcast\": \"172.17.255.255\", \"netmask\": \"255.255.0.0\", \"network\": \"172.17.0.0\", \"address\": \"172.17.0.1\"}, \"ipv6\": [{\"scope\": \"link\", \"prefix\": \"64\", \"address\": \"fe80::42:56ff:fec2:83be\"}], \"active\": false, \"timestamping\": [\"rx_software\", \"software\"], \"type\": \"bridge\", \"hw_timestamp_filters\": []}, \"ansible_processor\": [\"0\", \"GenuineIntel\", \"Intel(R) Core(TM) i7-6700HQ CPU @ 2.60GHz\"], \"ansible_ssh_host_key_ecdsa_public\": \"AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBK2zovckFKduH7EsvGaWar2mA+LdC4kTjgFG4h9RQlxZ1v5kEPx8Bs7jWnj94Cd8lY8BGb7RU7akUFpq3V59WIY=\", \"ansible_user_gid\": 0, \"ansible_system_vendor\": \"VMware, Inc.\", \"ansible_swaptotal_mb\": 10239, \"ansible_distribution_major_version\": \"7\", \"ansible_real_group_id\": 0, \"ansible_lsb\": {}, \"ansible_ens33\": {\"macaddress\": \"00:0c:29:db:d1:39\", \"features\": {\"tx_checksum_ipv4\": \"off [fixed]\", \"generic_receive_offload\": \"on\", \"tx_checksum_ipv6\": \"off [fixed]\", \"tx_scatter_gather_fraglist\": \"off [fixed]\", \"rx_all\": \"off\", \"highdma\": \"off [fixed]\", \"tls_hw_rx_offload\": \"off [fixed]\", \"tx_lockless\": \"off [fixed]\", \"tx_tcp_ecn_segmentation\": \"off [fixed]\", \"rx_udp_tunnel_port_offload\": \"off [fixed]\", \"esp_hw_offload\": \"off [fixed]\", \"tx_gso_robust\": \"off [fixed]\", \"tx_udp_segmentation\": \"off [fixed]\", \"tx_tcp_mangleid_segmentation\": \"off\", \"tx_ipxip4_segmentation\": \"off [fixed]\", \"tx_checksumming\": \"on\", \"vlan_challenged\": \"off [fixed]\", \"loopback\": \"off [fixed]\", \"tx_ipxip6_segmentation\": \"off [fixed]\", \"fcoe_mtu\": \"off [fixed]\", \"scatter_gather\": \"on\", \"tx_checksum_sctp\": \"off [fixed]\", \"tx_vlan_stag_hw_insert\": \"off [fixed]\", \"rx_vlan_stag_hw_parse\": \"off [fixed]\", \"tx_gso_partial\": \"off [fixed]\", \"tx_tcp_segmentation\": \"on\", \"rx_vlan_stag_filter\": \"off [fixed]\", \"large_receive_offload\": \"off [fixed]\", \"tx_scatter_gather\": \"on\", \"tx_tcp6_segmentation\": \"off [fixed]\", \"rx_checksumming\": \"off\", \"rx_gro_hw\": \"off [fixed]\", \"netns_local\": \"off [fixed]\", \"tx_esp_segmentation\": \"off [fixed]\", \"generic_segmentation_offload\": \"on\", \"rx_fcs\": \"off\", \"tcp_segmentation_offload\": \"on\", \"l2_fwd_offload\": \"off [fixed]\", \"rx_vlan_offload\": \"on\", \"ntuple_filters\": \"off [fixed]\", \"tx_gre_csum_segmentation\": \"off [fixed]\", \"esp_tx_csum_hw_offload\": \"off [fixed]\", \"tx_udp_tnl_segmentation\": \"off [fixed]\", \"tx_udp_tnl_csum_segmentation\": \"off [fixed]\", \"tx_sctp_segmentation\": \"off [fixed]\", \"udp_fragmentation_offload\": \"off\", \"tls_hw_record\": \"off [fixed]\", \"tls_hw_tx_offload\": \"off [fixed]\", \"tx_checksum_fcoe_crc\": \"off [fixed]\", \"hw_tc_offload\": \"off [fixed]\", \"tx_checksum_ip_generic\": \"on\", \"tx_fcoe_segmentation\": \"off [fixed]\", \"tx_nocache_copy\": \"off\", \"rx_vlan_filter\": \"on [fixed]\", \"tx_vlan_offload\": \"on [fixed]\", \"receive_hashing\": \"off [fixed]\", \"tx_gre_segmentation\": \"off [fixed]\"}, \"type\": \"ether\", \"pciid\": \"0000:02:01.0\", \"module\": \"e1000\", \"mtu\": 1500, \"device\": \"ens33\", \"promisc\": false, \"timestamping\": [\"tx_software\", \"rx_software\", \"software\"], \"ipv4\": {\"broadcast\": \"192.168.77.255\", \"netmask\": \"255.255.255.0\", \"network\": \"192.168.77.0\", \"address\": \"192.168.77.130\"}, \"ipv6\": [{\"scope\": \"link\", \"prefix\": \"64\", \"address\": \"fe80::20c:29ff:fedb:d139\"}], \"active\": true, \"speed\": 1000, \"hw_timestamp_filters\": []}, \"ansible_machine\": \"x86_64\", \"ansible_ssh_host_key_rsa_public\": \"AAAAB3NzaC1yc2EAAAADAQABAAABAQDfNgNsUWXmYOD7Iz94nO98XRmw4dWKREbxWz6rZBP2QHYFN38nzdo9h5UT4HMuUM/FraPwwbfPubznNgn0/cXfMkqu8JIssxizpIRBZv82HFqwHTYRvkFAEII8ftkHs2RVlq64+ljPZzWvGL14nkfU7P+kc8Ym4jZGtorKRBoHFCeu67fycmZSCLFJxkKSumOaZ9TbNzP6bziyfmdDIGfj8UgzJRSuBW+B5XNeJp/QtsQZTjgpxSZZ9QRf/FeRx1NDR5Si91Fkd0NILIgoOSz536lP+aCCUOx7ukaoV1T/kyUKOj8a3wpBGiBWWZUGZa6O02Ig0eHnx8F4lZ2iOnNN\", \"ansible_user_gecos\": \"root\", \"ansible_processor_threads_per_core\": 1, \"ansible_product_name\": \"VMware Virtual Platform\", \"ansible_all_ipv4_addresses\": [\"172.17.0.1\", \"192.168.77.130\"], \"ansible_python_version\": \"2.7.5\", \"ansible_product_version\": \"None\", \"ansible_service_mgr\": \"systemd\", \"ansible_memory_mb\": {\"real\": {\"total\": 960, \"used\": 877, \"free\": 83}, \"swap\": {\"cached\": 17, \"total\": 10239, \"free\": 10116, \"used\": 123}, \"nocache\": {\"used\": 596, \"free\": 364}}, \"ansible_user_dir\": \"/root\", \"gather_subset\": [\"all\"], \"ansible_real_user_id\": 0, \"ansible_virtualization_role\": \"guest\", \"ansible_dns\": {\"nameservers\": [\"192.168.77.2\"]}, \"ansible_effective_group_id\": 0, \"ansible_lo\": {\"features\": {\"tx_checksum_ipv4\": \"off [fixed]\", \"generic_receive_offload\": \"on\", \"tx_checksum_ipv6\": \"off [fixed]\", \"tx_scatter_gather_fraglist\": \"on [fixed]\", \"rx_all\": \"off [fixed]\", \"highdma\": \"on [fixed]\", \"tls_hw_rx_offload\": \"off [fixed]\", \"tx_lockless\": \"on [fixed]\", \"tx_tcp_ecn_segmentation\": \"on\", \"rx_udp_tunnel_port_offload\": \"off [fixed]\", \"esp_hw_offload\": \"off [fixed]\", \"tx_gso_robust\": \"off [fixed]\", \"tx_udp_segmentation\": \"off [fixed]\", \"tx_tcp_mangleid_segmentation\": \"on\", \"tx_ipxip4_segmentation\": \"off [fixed]\", \"tx_checksumming\": \"on\", \"vlan_challenged\": \"on [fixed]\", \"loopback\": \"on [fixed]\", \"tx_ipxip6_segmentation\": \"off [fixed]\", \"fcoe_mtu\": \"off [fixed]\", \"scatter_gather\": \"on\", \"tx_checksum_sctp\": \"on [fixed]\", \"tx_vlan_stag_hw_insert\": \"off [fixed]\", \"rx_vlan_stag_hw_parse\": \"off [fixed]\", \"tx_gso_partial\": \"off [fixed]\", \"tx_tcp_segmentation\": \"on\", \"rx_vlan_stag_filter\": \"off [fixed]\", \"large_receive_offload\": \"off [fixed]\", \"tx_scatter_gather\": \"on [fixed]\", \"tx_tcp6_segmentation\": \"on\", \"rx_checksumming\": \"on [fixed]\", \"rx_gro_hw\": \"off [fixed]\", \"netns_local\": \"on [fixed]\", \"tx_esp_segmentation\": \"off [fixed]\", \"generic_segmentation_offload\": \"on\", \"rx_fcs\": \"off [fixed]\", \"tcp_segmentation_offload\": \"on\", \"l2_fwd_offload\": \"off [fixed]\", \"rx_vlan_offload\": \"off [fixed]\", \"ntuple_filters\": \"off [fixed]\", \"tx_gre_csum_segmentation\": \"off [fixed]\", \"esp_tx_csum_hw_offload\": \"off [fixed]\", \"tx_udp_tnl_segmentation\": \"off [fixed]\", \"tx_udp_tnl_csum_segmentation\": \"off [fixed]\", \"tx_sctp_segmentation\": \"on\", \"udp_fragmentation_offload\": \"off\", \"tls_hw_record\": \"off [fixed]\", \"tls_hw_tx_offload\": \"off [fixed]\", \"tx_checksum_fcoe_crc\": \"off [fixed]\", \"hw_tc_offload\": \"off [fixed]\", \"tx_checksum_ip_generic\": \"on [fixed]\", \"tx_fcoe_segmentation\": \"off [fixed]\", \"tx_nocache_copy\": \"off [fixed]\", \"rx_vlan_filter\": \"off [fixed]\", \"tx_vlan_offload\": \"off [fixed]\", \"receive_hashing\": \"off [fixed]\", \"tx_gre_segmentation\": \"off [fixed]\"}, \"hw_timestamp_filters\": [], \"mtu\": 65536, \"device\": \"lo\", \"promisc\": false, \"timestamping\": [\"tx_software\", \"rx_software\", \"software\"], \"ipv4\": {\"broadcast\": \"host\", \"netmask\": \"255.0.0.0\", \"network\": \"127.0.0.0\", \"address\": \"127.0.0.1\"}, \"ipv6\": [{\"scope\": \"host\", \"prefix\": \"128\", \"address\": \"::1\"}], \"active\": true, \"type\": \"loopback\"}, \"ansible_memtotal_mb\": 960, \"ansible_device_links\": {\"masters\": {}, \"labels\": {}, \"ids\": {\"sr0\": [\"ata-VMware_Virtual_IDE_CDROM_Drive_10000000000000000001\"]}, \"uuids\": {\"sda2\": [\"0c0f8a5a-58dd-4fc6-a49e-fc5e63f5d8a3\"], \"sda3\": [\"a7d49533-e756-4a71-a977-5efb174eb09c\"], \"sda1\": [\"93556f71-6dad-4761-9207-edee35d47129\"]}}, \"ansible_apparmor\": {\"status\": \"disabled\"}, \"ansible_proc_cmdline\": {\"BOOT_IMAGE\": \"/vmlinuz-5.1.15-1.el7.elrepo.x86_64\", \"quiet\": true, \"user_namespace.enable\": \"1\", \"rhgb\": true, \"crashkernel\": \"auto\", \"ro\": true, \"root\": \"UUID=a7d49533-e756-4a71-a977-5efb174eb09c\"}, \"ansible_memfree_mb\": 83, \"ansible_processor_count\": 1, \"ansible_hostname\": \"node130\", \"ansible_interfaces\": [\"lo\", \"docker0\", \"ens33\"], \"ansible_selinux\": {\"status\": \"disabled\"}, \"ansible_fqdn\": \"node130\", \"ansible_mounts\": [{\"block_used\": 32390, \"uuid\": \"93556f71-6dad-4761-9207-edee35d47129\", \"size_total\": 206213120, \"block_total\": 50345, \"mount\": \"/boot\", \"block_available\": 17955, \"size_available\": 73543680, \"fstype\": \"xfs\", \"inode_total\": 102400, \"options\": \"rw,relatime,attr2,inode64,noquota\", \"device\": \"/dev/sda1\", \"inode_used\": 332, \"block_size\": 4096, \"inode_available\": 102068}, {\"block_used\": 790464, \"uuid\": \"a7d49533-e756-4a71-a977-5efb174eb09c\", \"size_total\": 31985868800, \"block_total\": 7809050, \"mount\": \"/\", \"block_available\": 7018586, \"size_available\": 28748128256, \"fstype\": \"xfs\", \"inode_total\": 15625728, \"options\": \"rw,relatime,attr2,inode64,noquota\", \"device\": \"/dev/sda3\", \"inode_used\": 116574, \"block_size\": 4096, \"inode_available\": 15509154}], \"ansible_nodename\": \"node130\", \"ansible_domain\": \"\", \"ansible_distribution_file_path\": \"/etc/redhat-release\", \"ansible_virtualization_type\": \"VMware\", \"ansible_ssh_host_key_ed25519_public\": \"AAAAC3NzaC1lZDI1NTE5AAAAIEgM8JK59UtnryS0IhtNoPJHbOSqy7Xy2jExPYMvAex5\", \"ansible_processor_cores\": 1, \"ansible_bios_version\": \"6.00\", \"ansible_date_time\": {\"weekday_number\": \"0\", \"iso8601_basic_short\": \"20200412T202718\", \"tz\": \"CST\", \"weeknumber\": \"14\", \"hour\": \"20\", \"year\": \"2020\", \"minute\": \"27\", \"tz_offset\": \"+0800\", \"month\": \"04\", \"epoch\": \"1586694438\", \"iso8601_micro\": \"2020-04-12T12:27:18.102117Z\", \"weekday\": \"\\\\u661f\\\\u671f\\\\u65e5\", \"time\": \"20:27:18\", \"date\": \"2020-04-12\", \"iso8601\": \"2020-04-12T12:27:18Z\", \"day\": \"12\", \"iso8601_basic\": \"20200412T202718102042\", \"second\": \"18\"}, \"ansible_distribution_release\": \"Core\", \"ansible_os_family\": \"RedHat\", \"ansible_effective_user_id\": 0, \"ansible_system\": \"Linux\", \"ansible_devices\": {\"sr0\": {\"scheduler_mode\": \"mq-deadline\", \"rotational\": \"1\", \"vendor\": \"NECVMWar\", \"sectors\": \"2097151\", \"links\": {\"masters\": [], \"labels\": [], \"ids\": [\"ata-VMware_Virtual_IDE_CDROM_Drive_10000000000000000001\"], \"uuids\": []}, \"sas_device_handle\": null, \"sas_address\": null, \"virtual\": 1, \"host\": \"IDE interface: Intel Corporation 82371AB/EB/MB PIIX4 IDE (rev 01)\", \"sectorsize\": \"512\", \"removable\": \"1\", \"support_discard\": \"0\", \"model\": \"VMware IDE CDR10\", \"partitions\": {}, \"holders\": [], \"size\": \"1024.00 MB\"}, \"sda\": {\"scheduler_mode\": \"mq-deadline\", \"rotational\": \"1\", \"vendor\": \"VMware,\", \"sectors\": \"83886080\", \"links\": {\"masters\": [], \"labels\": [], \"ids\": [], \"uuids\": []}, \"sas_device_handle\": null, \"sas_address\": null, \"virtual\": 1, \"host\": \"SCSI storage controller: LSI Logic / Symbios Logic 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI (rev 01)\", \"sectorsize\": \"512\", \"removable\": \"0\", \"support_discard\": \"0\", \"model\": \"VMware Virtual S\", \"partitions\": {\"sda2\": {\"sectorsize\": 512, \"uuid\": \"0c0f8a5a-58dd-4fc6-a49e-fc5e63f5d8a3\", \"links\": {\"masters\": [], \"labels\": [], \"ids\": [], \"uuids\": [\"0c0f8a5a-58dd-4fc6-a49e-fc5e63f5d8a3\"]}, \"sectors\": \"20971520\", \"start\": \"411648\", \"holders\": [], \"size\": \"10.00 GB\"}, \"sda3\": {\"sectorsize\": 512, \"uuid\": \"a7d49533-e756-4a71-a977-5efb174eb09c\", \"links\": {\"masters\": [], \"labels\": [], \"ids\": [], \"uuids\": [\"a7d49533-e756-4a71-a977-5efb174eb09c\"]}, \"sectors\": \"62502912\", \"start\": \"21383168\", \"holders\": [], \"size\": \"29.80 GB\"}, \"sda1\": {\"sectorsize\": 512, \"uuid\": \"93556f71-6dad-4761-9207-edee35d47129\", \"links\": {\"masters\": [], \"labels\": [], \"ids\": [], \"uuids\": [\"93556f71-6dad-4761-9207-edee35d47129\"]}, \"sectors\": \"409600\", \"start\": \"2048\", \"holders\": [], \"size\": \"200.00 MB\"}}, \"holders\": [], \"size\": \"40.00 GB\"}}, \"ansible_user_uid\": 0, \"ansible_bios_date\": \"07/29/2019\", \"ansible_system_capabilities\": [\"cap_chown\", \"cap_dac_override\", \"cap_dac_read_search\", \"cap_fowner\", \"cap_fsetid\", \"cap_kill\", \"cap_setgid\", \"cap_setuid\", \"cap_setpcap\", \"cap_linux_immutable\", \"cap_net_bind_service\", \"cap_net_broadcast\", \"cap_net_admin\", \"cap_net_raw\", \"cap_ipc_lock\", \"cap_ipc_owner\", \"cap_sys_module\", \"cap_sys_rawio\", \"cap_sys_chroot\", \"cap_sys_ptrace\", \"cap_sys_pacct\", \"cap_sys_admin\", \"cap_sys_boot\", \"cap_sys_nice\", \"cap_sys_resource\", \"cap_sys_time\", \"cap_sys_tty_config\", \"cap_mknod\", \"cap_lease\", \"cap_audit_write\", \"cap_audit_control\", \"cap_setfcap\", \"cap_mac_override\", \"cap_mac_admin\", \"cap_syslog\", \"35\", \"36\", \"37+ep\"]}}\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug2: mux_client_hello_exchange: master version 4\\r\\ndebug3: mux_client_forwards: request forwardings: 0 local, 0 remote\\r\\ndebug3: mux_client_request_session: entering\\r\\ndebug3: mux_client_request_alive: entering\\r\\ndebug3: mux_client_request_alive: done pid = 56635\\r\\ndebug3: mux_client_request_session: session request sent\\r\\ndebug1: mux_client_request_session: master session id: 2\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n' ) ok: [ 192 .168.77.130 ] META: ran handlers TASK [ ping ] ****************************************************************************************************************************************************************************************** task path: /etc/ansible/test.yml:5 Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/ping.py Pipelining is enabled. < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '\\n{\"invocation\": {\"module_args\": {\"data\": \"pong\"}}, \"ping\": \"pong\"}\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug2: mux_client_hello_exchange: master version 4\\r\\ndebug3: mux_client_forwards: request forwardings: 0 local, 0 remote\\r\\ndebug3: mux_client_request_session: entering\\r\\ndebug3: mux_client_request_alive: entering\\r\\ndebug3: mux_client_request_alive: done pid = 56635\\r\\ndebug3: mux_client_request_session: session request sent\\r\\ndebug1: mux_client_request_session: master session id: 2\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n' ) ok: [ 192 .168.77.130 ] = > { \"changed\" : false, \"invocation\" : { \"module_args\" : { \"data\" : \"pong\" } } , \"ping\" : \"pong\" } META: ran handlers META: ran handlers PLAY RECAP ******************************************************************************************************************************************************************************************* 192 .168.77.130 : ok = 2 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0","title":"\u8be6\u7ec6\u8f93\u51fa"},{"location":"dev/debug/verbose-debug/#_1","text":"\u5982\u679c\u4f60\u60f3\u8981\u83b7\u53d6ansible\u8fd0\u884c\u65f6\u6240\u6709\u53d1\u751f\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u53ef\u4ee5\u4f7f\u7528 -vvvv \u6a21\u5f0f\u5f00\u542f\u8be6\u7ec6\u8f93\u51fa\u3002 \u8be6\u7ec6\u8f93\u51fa\u5305\u542b\u51e0\u4e2a\u7247\u6bb5\uff0c\u53ef\u4ee5\u6709\u52a9\u4e8e\u4f60\u67e5\u627e\u95ee\u9898\u3002 \u89e3\u6790\u914d\u7f6e\u6587\u4ef6\u548c\u4e3b\u673a\u6e05\u5355 \u8fdc\u7a0b\u8fde\u63a5\u4fe1\u606f \u901a\u7528\u4fe1\u606f \u8fdc\u7a0b\u6267\u884c\u7684\u6587\u4ef6 \u6a21\u5757\u8f93\u51fa","title":"\u8be6\u7ec6\u8f93\u51fa"},{"location":"dev/debug/verbose-debug/#ansible","text":"# ansible 192.168.77.130 -m ping -vvvv ansible 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible python version = 2 .7.5 ( default, Aug 7 2019 , 00 :51:29 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] Using /etc/ansible/ansible.cfg as config file setting up inventory plugins host_list declined parsing /etc/ansible/hosts as it did not pass its verify_file () method script declined parsing /etc/ansible/hosts as it did not pass its verify_file () method auto declined parsing /etc/ansible/hosts as it did not pass its verify_file () method Parsed /etc/ansible/hosts inventory source with ini plugin Loading callback plugin minimal of type stdout, v2.0 from /usr/lib/python2.7/site-packages/ansible/plugins/callback/minimal.pyc META: ran handlers < 192 .168.77.130> Attempting python interpreter discovery < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" 'echo PLATFORM; uname; echo FOUND; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.5' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/libexec/platform-python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python3' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python' \"'\" '\"' \"'\" '\"' \"'\" '; echo ENDFOUND && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , 'PLATFORM\\nLinux\\nFOUND\\n/usr/bin/python\\n/usr/bin/python2.7\\n/usr/libexec/platform-python\\n/usr/bin/python\\nENDFOUND\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug1: Control socket \"/root/.ansible/cp/192.168.77.130-root\" does not exist\\r\\ndebug2: resolving \"192.168.77.130\" port 22\\r\\ndebug2: ssh_connect_direct: needpriv 0\\r\\ndebug1: Connecting to 192.168.77.130 [192.168.77.130] port 22.\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug1: fd 3 clearing O_NONBLOCK\\r\\ndebug1: Connection established.\\r\\ndebug3: timeout: 10000 ms remain after connect\\r\\ndebug1: permanently_set_uid: 0/0\\r\\ndebug1: identity file /root/.ssh/id_rsa type 1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_rsa-cert type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_dsa type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_dsa-cert type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ecdsa type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ecdsa-cert type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ed25519 type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ed25519-cert type -1\\r\\ndebug1: Enabling compatibility mode for protocol 2.0\\r\\ndebug1: Local version string SSH-2.0-OpenSSH_7.4\\r\\ndebug1: Remote protocol version 2.0, remote software version OpenSSH_7.4\\r\\ndebug1: match: OpenSSH_7.4 pat OpenSSH* compat 0x04000000\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug1: Authenticating to 192.168.77.130:22 as \\' root \\'\\r\\n debug3: hostkeys_foreach: reading file \"/root/.ssh/known_hosts\" \\r\\n debug3: record_hostkey: found key type ECDSA in file /root/.ssh/known_hosts:3 \\r\\n debug3: load_hostkeys: loaded 1 keys from 192 .168.77.130 \\r\\n debug3: order_hostkeyalgs: prefer hostkeyalgs: ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp521-cert-v01@openssh.com,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521 \\r\\n debug3: send packet: type 20 \\r\\n debug1: SSH2_MSG_KEXINIT sent \\r\\n debug3: receive packet: type 20 \\r\\n debug1: SSH2_MSG_KEXINIT received \\r\\n debug2: local client KEXINIT proposal \\r\\n debug2: KEX algorithms: curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha256,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1,ext-info-c \\r\\n debug2: host key algorithms: ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp521-cert-v01@openssh.com,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,ssh-ed25519-cert-v01@openssh.com,ssh-rsa-cert-v01@openssh.com,ssh-dss-cert-v01@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256,ssh-rsa,ssh-dss \\r\\n debug2: ciphers ctos: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc \\r\\n debug2: ciphers stoc: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc \\r\\n debug2: MACs ctos: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: MACs stoc: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: compression ctos: zlib@openssh.com,zlib,none \\r\\n debug2: compression stoc: zlib@openssh.com,zlib,none \\r\\n debug2: languages ctos: \\r\\n debug2: languages stoc: \\r\\n debug2: first_kex_follows 0 \\r\\n debug2: reserved 0 \\r\\n debug2: peer server KEXINIT proposal \\r\\n debug2: KEX algorithms: curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha256,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1 \\r\\n debug2: host key algorithms: ssh-rsa,rsa-sha2-512,rsa-sha2-256,ecdsa-sha2-nistp256,ssh-ed25519 \\r\\n debug2: ciphers ctos: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc,blowfish-cbc,cast128-cbc,3des-cbc \\r\\n debug2: ciphers stoc: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc,blowfish-cbc,cast128-cbc,3des-cbc \\r\\n debug2: MACs ctos: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: MACs stoc: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: compression ctos: none,zlib@openssh.com \\r\\n debug2: compression stoc: none,zlib@openssh.com \\r\\n debug2: languages ctos: \\r\\n debug2: languages stoc: \\r\\n debug2: first_kex_follows 0 \\r\\n debug2: reserved 0 \\r\\n debug1: kex: algorithm: curve25519-sha256 \\r\\n debug1: kex: host key algorithm: ecdsa-sha2-nistp256 \\r\\n debug1: kex: server->client cipher: chacha20-poly1305@openssh.com MAC: <implicit> compression: zlib@openssh.com \\r\\n debug1: kex: client->server cipher: chacha20-poly1305@openssh.com MAC: <implicit> compression: zlib@openssh.com \\r\\n debug1: kex: curve25519-sha256 need = 64 dh_need = 64 \\r\\n debug1: kex: curve25519-sha256 need = 64 dh_need = 64 \\r\\n debug3: send packet: type 30 \\r\\n debug1: expecting SSH2_MSG_KEX_ECDH_REPLY \\r\\n debug3: receive packet: type 31 \\r\\n debug1: Server host key: ecdsa-sha2-nistp256 SHA256:2lWSIJMF9r8hnfLwlKONY07eQCeZaDVZ/xWZizr9wqs \\r\\n debug3: hostkeys_foreach: reading file \"/root/.ssh/known_hosts\" \\r\\n debug3: record_hostkey: found key type ECDSA in file /root/.ssh/known_hosts:3 \\r\\n debug3: load_hostkeys: loaded 1 keys from 192 .168.77.130 \\r\\n debug1: Host \\' 192 .168.77.130 \\' is known and matches the ECDSA host key. \\r\\n debug1: Found key in /root/.ssh/known_hosts:3 \\r\\n debug3: send packet: type 21 \\r\\n debug2: set_newkeys: mode 1 \\r\\n debug1: rekey after 134217728 blocks \\r\\n debug1: SSH2_MSG_NEWKEYS sent \\r\\n debug1: expecting SSH2_MSG_NEWKEYS \\r\\n debug3: receive packet: type 21 \\r\\n debug1: SSH2_MSG_NEWKEYS received \\r\\n debug2: set_newkeys: mode 0 \\r\\n debug1: rekey after 134217728 blocks \\r\\n debug2: key: /root/.ssh/id_rsa ( 0x55f6213acd00 ) \\r\\n debug2: key: /root/.ssh/id_dsa (( nil )) \\r\\n debug2: key: /root/.ssh/id_ecdsa (( nil )) \\r\\n debug2: key: /root/.ssh/id_ed25519 (( nil )) \\r\\n debug3: send packet: type 5 \\r\\n debug3: receive packet: type 7 \\r\\n debug1: SSH2_MSG_EXT_INFO received \\r\\n debug1: kex_input_ext_info: server-sig-algs = <rsa-sha2-256,rsa-sha2-512> \\r\\n debug3: receive packet: type 6 \\r\\n debug2: service_accept: ssh-userauth \\r\\n debug1: SSH2_MSG_SERVICE_ACCEPT received \\r\\n debug3: send packet: type 50 \\r\\n debug3: receive packet: type 51 \\r\\n debug1: Authentications that can continue : publickey,gssapi-keyex,gssapi-with-mic,password \\r\\n debug3: start over, passed a different list publickey,gssapi-keyex,gssapi-with-mic,password \\r\\n debug3: preferred gssapi-keyex,gssapi-with-mic,publickey,keyboard-interactive,password \\r\\n debug3: authmethod_lookup gssapi-keyex \\r\\n debug3: remaining preferred: gssapi-with-mic,publickey,keyboard-interactive,password \\r\\n debug3: authmethod_is_enabled gssapi-keyex \\r\\n debug1: Next authentication method: gssapi-keyex \\r\\n debug1: No valid Key exchange context \\r\\n debug2: we did not send a packet, disable method \\r\\n debug3: authmethod_lookup gssapi-with-mic \\r\\n debug3: remaining preferred: publickey,keyboard-interactive,password \\r\\n debug3: authmethod_is_enabled gssapi-with-mic \\r\\n debug1: Next authentication method: gssapi-with-mic \\r\\n debug1: Unspecified GSS failure. Minor code may provide more information \\n No Kerberos credentials available ( default cache: KEYRING:persistent:0 ) \\n\\r\\n debug1: Unspecified GSS failure. Minor code may provide more information \\n No Kerberos credentials available ( default cache: KEYRING:persistent:0 ) \\n\\r\\n debug2: we did not send a packet, disable method \\r\\n debug3: authmethod_lookup publickey \\r\\n debug3: remaining preferred: keyboard-interactive,password \\r\\n debug3: authmethod_is_enabled publickey \\r\\n debug1: Next authentication method: publickey \\r\\n debug1: Offering RSA public key: /root/.ssh/id_rsa \\r\\n debug3: send_pubkey_test \\r\\n debug3: send packet: type 50 \\r\\n debug2: we sent a publickey packet, wait for reply \\r\\n debug3: receive packet: type 60 \\r\\n debug1: Server accepts key: pkalg rsa-sha2-512 blen 535 \\r\\n debug2: input_userauth_pk_ok: fp SHA256:fFR+c7Nyf0e+Zr3vsC0dKzR2EcfUwOu6Ku1EaTvvSmM \\r\\n debug3: sign_and_send_pubkey: RSA SHA256:fFR+c7Nyf0e+Zr3vsC0dKzR2EcfUwOu6Ku1EaTvvSmM \\r\\n debug3: send packet: type 50 \\r\\n debug3: receive packet: type 52 \\r\\n debug1: Enabling compression at level 6 . \\r\\n debug1: Authentication succeeded ( publickey ) . \\r\\n Authenticated to 192 .168.77.130 ([ 192 .168.77.130 ] :22 ) . \\r\\n debug1: setting up multiplex master socket \\r\\n debug3: muxserver_listen: temporary control path /root/.ansible/cp/192.168.77.130-root.oO7SZfDChRqqB6Dk \\r\\n debug2: fd 4 setting O_NONBLOCK \\r\\n debug3: fd 4 is O_NONBLOCK \\r\\n debug3: fd 4 is O_NONBLOCK \\r\\n debug1: channel 0 : new [ /root/.ansible/cp/192.168.77.130-root ] \\r\\n debug3: muxserver_listen: mux listener channel 0 fd 4 \\r\\n debug2: fd 3 setting TCP_NODELAY \\r\\n debug3: ssh_packet_set_tos: set IP_TOS 0x08 \\r\\n debug1: control_persist_detach: backgrounding master process \\r\\n debug2: control_persist_detach: background process is 56533 \\r\\n debug2: fd 4 setting O_NONBLOCK \\r\\n debug1: forking to background \\r\\n debug1: Entering interactive session. \\r\\n debug1: pledge: id \\r\\n debug2: set_control_persist_exit_time: schedule exit in 60 seconds \\r\\n debug1: multiplexing control connection \\r\\n debug2: fd 5 setting O_NONBLOCK \\r\\n debug3: fd 5 is O_NONBLOCK \\r\\n debug1: channel 1 : new [ mux-control ] \\r\\n debug3: channel_post_mux_listener: new mux channel 1 fd 5 \\r\\n debug3: mux_master_read_cb: channel 1 : hello sent \\r\\n debug2: set_control_persist_exit_time: cancel scheduled exit \\r\\n debug3: mux_master_read_cb: channel 1 packet type 0x00000001 len 4 \\r\\n debug2: process_mux_master_hello: channel 1 slave version 4 \\r\\n debug2: mux_client_hello_exchange: master version 4 \\r\\n debug3: mux_client_forwards: request forwardings: 0 local, 0 remote \\r\\n debug3: mux_client_request_session: entering \\r\\n debug3: mux_client_request_alive: entering \\r\\n debug3: mux_master_read_cb: channel 1 packet type 0x10000004 len 4 \\r\\n debug2: process_mux_alive_check: channel 1 : alive check \\r\\n debug3: mux_client_request_alive: done pid = 56535 \\r\\n debug3: mux_client_request_session: session request sent \\r\\n debug3: mux_master_read_cb: channel 1 packet type 0x10000002 len 449 \\r\\n debug2: process_mux_new_session: channel 1 : request tty 0 , X 0 , agent 0 , subsys 0 , term \"xterm\" , cmd \"/bin/sh -c \\'echo PLATFORM; uname; echo FOUND; command -v \\'\" \\' \"\\'/usr/bin/python\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python3.7\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python3.6\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python3.5\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python2.7\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python2.6\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'/usr/libexec/platform-python\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'/usr/bin/python3\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python\\'\" \\' \"\\'; echo ENDFOUND && sleep 0\\'\" , env 1 \\r\\n debug3: process_mux_new_session: got fds stdin 6 , stdout 7 , stderr 8 \\r\\n debug2: fd 7 setting O_NONBLOCK \\r\\n debug2: fd 8 setting O_NONBLOCK \\r\\n debug1: channel 2 : new [ client-session ] \\r\\n debug2: process_mux_new_session: channel_new: 2 linked to control channel 1 \\r\\n debug2: channel 2 : send open \\r\\n debug3: send packet: type 90 \\r\\n debug3: receive packet: type 80 \\r\\n debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0 \\r\\n debug3: receive packet: type 91 \\r\\n debug2: callback start \\r\\n debug2: client_session2_setup: id 2 \\r\\n debug1: Sending environment. \\r\\n debug1: Sending env LANG = zh_CN.UTF-8 \\r\\n debug2: channel 2 : request env confirm 0 \\r\\n debug3: send packet: type 98 \\r\\n debug1: Sending command: /bin/sh -c \\' echo PLATFORM ; uname ; echo FOUND ; command -v \\' \"\\'\" \\' /usr/bin/python \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python3.7 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python3.6 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python3.5 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python2.7 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python2.6 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' /usr/libexec/platform-python \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' /usr/bin/python3 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python \\' \"\\'\" \\' ; echo ENDFOUND && sleep 0 \\'\\r\\n debug2: channel 2 : request exec confirm 1 \\r\\n debug3: send packet: type 98 \\r\\n debug3: mux_session_confirm: sending success reply \\r\\n debug2: callback done \\r\\n debug2: channel 2 : open confirm rwindow 0 rmax 32768 \\r\\n debug1: mux_client_request_session: master session id: 2 \\r\\n debug2: channel 2 : rcvd adjust 2097152 \\r\\n debug3: receive packet: type 99 \\r\\n debug2: channel_input_status_confirm: type 99 id 2 \\r\\n debug2: exec request accepted on channel 2 \\r\\n debug3: receive packet: type 98 \\r\\n debug1: client_input_channel_req: channel 2 rtype exit-status reply 0 \\r\\n debug3: mux_exit_message: channel 2 : exit message, exitval 0 \\r\\n debug3: receive packet: type 98 \\r\\n debug1: client_input_channel_req: channel 2 rtype eow@openssh.com reply 0 \\r\\n debug2: channel 2 : rcvd eow \\r\\n debug2: channel 2 : close_read \\r\\n debug2: channel 2 : input open -> closed \\r\\n debug3: receive packet: type 96 \\r\\n debug2: channel 2 : rcvd eof \\r\\n debug2: channel 2 : output open -> drain \\r\\n debug2: channel 2 : obuf empty \\r\\n debug2: channel 2 : close_write \\r\\n debug2: channel 2 : output drain -> closed \\r\\n debug3: receive packet: type 97 \\r\\n debug2: channel 2 : rcvd close \\r\\n debug3: channel 2 : will not send data after close \\r\\n debug2: channel 2 : send close \\r\\n debug3: send packet: type 97 \\r\\n debug2: channel 2 : is dead \\r\\n debug2: channel 2 : gc: notify user \\r\\n debug3: mux_master_session_cleanup_cb: entering for channel 2 \\r\\n debug2: channel 1 : rcvd close \\r\\n debug2: channel 1 : output open -> drain \\r\\n debug2: channel 1 : close_read \\r\\n debug2: channel 1 : input open -> closed \\r\\n debug2: channel 2 : gc: user detached \\r\\n debug2: channel 2 : is dead \\r\\n debug2: channel 2 : garbage collecting \\r\\n debug1: channel 2 : free: client-session, nchannels 3 \\r\\n debug3: channel 2 : status: The following connections are open: \\r\\n #1 mux-control (t16 r-1 i3/0 o1/16 fd 5/5 cc -1)\\r\\n #2 client-session (t4 r0 i3/0 o3/0 fd -1/-1 cc -1)\\r\\n\\r\\ndebug2: channel 1: obuf empty\\r\\ndebug2: channel 1: close_write\\r\\ndebug2: channel 1: output drain -> closed\\r\\ndebug2: channel 1: is dead (local)\\r\\ndebug2: channel 1: gc: notify user\\r\\ndebug3: mux_master_control_cleanup_cb: entering for channel 1\\r\\ndebug2: channel 1: gc: user detached\\r\\ndebug2: channel 1: is dead (local)\\r\\ndebug2: channel 1: garbage collecting\\r\\ndebug1: channel 1: free: mux-control, nchannels 2\\r\\ndebug3: channel 1: status: The following connections are open:\\r\\n #1 mux-control (t16 r-1 i3/0 o3/0 fd 5/5 cc -1)\\r\\n\\r\\ndebug2: set_control_persist_exit_time: schedule exit in 60 seconds\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n') < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '{\"osrelease_content\": \"NAME=\\\\\"CentOS Linux\\\\\"\\\\nVERSION=\\\\\"7 (Core)\\\\\"\\\\nID=\\\\\"centos\\\\\"\\\\nID_LIKE=\\\\\"rhel fedora\\\\\"\\\\nVERSION_ID=\\\\\"7\\\\\"\\\\nPRETTY_NAME=\\\\\"CentOS Linux 7 (Core)\\\\\"\\\\nANSI_COLOR=\\\\\"0;31\\\\\"\\\\nCPE_NAME=\\\\\"cpe:/o:centos:centos:7\\\\\"\\\\nHOME_URL=\\\\\"https://www.centos.org/\\\\\"\\\\nBUG_REPORT_URL=\\\\\"https://bugs.centos.org/\\\\\"\\\\n\\\\nCENTOS_MANTISBT_PROJECT=\\\\\"CentOS-7\\\\\"\\\\nCENTOS_MANTISBT_PROJECT_VERSION=\\\\\"7\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT=\\\\\"centos\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT_VERSION=\\\\\"7\\\\\"\\\\n\\\\n\", \"platform_dist_result\": [\"centos\", \"7.4.1708\", \"Core\"]}\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug2: mux_client_hello_exchange: master version 4\\r\\ndebug3: mux_client_forwards: request forwardings: 0 local, 0 remote\\r\\ndebug3: mux_client_request_session: entering\\r\\ndebug3: mux_client_request_alive: entering\\r\\ndebug3: mux_client_request_alive: done pid = 56535\\r\\ndebug3: mux_client_request_session: session request sent\\r\\ndebug1: mux_client_request_session: master session id: 2\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n' ) Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/ping.py Pipelining is enabled. < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '\\n{\"invocation\": {\"module_args\": {\"data\": \"pong\"}}, \"ping\": \"pong\"}\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug2: mux_client_hello_exchange: master version 4\\r\\ndebug3: mux_client_forwards: request forwardings: 0 local, 0 remote\\r\\ndebug3: mux_client_request_session: entering\\r\\ndebug3: mux_client_request_alive: entering\\r\\ndebug3: mux_client_request_alive: done pid = 56535\\r\\ndebug3: mux_client_request_session: session request sent\\r\\ndebug1: mux_client_request_session: master session id: 2\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n' ) 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"invocation\" : { \"module_args\" : { \"data\" : \"pong\" } } , \"ping\" : \"pong\" } META: ran handlers META: ran handlers","title":"ansible \u8be6\u7ec6\u8f93\u51fa"},{"location":"dev/debug/verbose-debug/#playbook","text":"# ansible-playbook test.yml -vvvv ansible-playbook 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible-playbook python version = 2 .7.5 ( default, Aug 7 2019 , 00 :51:29 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] Using /etc/ansible/ansible.cfg as config file setting up inventory plugins host_list declined parsing /etc/ansible/hosts as it did not pass its verify_file () method script declined parsing /etc/ansible/hosts as it did not pass its verify_file () method auto declined parsing /etc/ansible/hosts as it did not pass its verify_file () method Parsed /etc/ansible/hosts inventory source with ini plugin Loading callback plugin default of type stdout, v2.0 from /usr/lib/python2.7/site-packages/ansible/plugins/callback/default.pyc PLAYBOOK: test.yml *********************************************************************************************************************************************************************************** Positional arguments: test.yml become_method: sudo inventory: ( u '/etc/ansible/hosts' , ) forks: 5 tags: ( u 'all' , ) verbosity: 4 connection: smart timeout: 10 1 plays in test.yml PLAY [ 192 .168.77.130 ] ******************************************************************************************************************************************************************************** TASK [ Gathering Facts ] ******************************************************************************************************************************************************************************* task path: /etc/ansible/test.yml:3 < 192 .168.77.130> Attempting python interpreter discovery < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" 'echo PLATFORM; uname; echo FOUND; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python3.5' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.7' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python2.6' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/libexec/platform-python' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" '/usr/bin/python3' \"'\" '\"' \"'\" '\"' \"'\" '; command -v ' \"'\" '\"' \"'\" '\"' \"'\" 'python' \"'\" '\"' \"'\" '\"' \"'\" '; echo ENDFOUND && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , 'PLATFORM\\nLinux\\nFOUND\\n/usr/bin/python\\n/usr/bin/python2.7\\n/usr/libexec/platform-python\\n/usr/bin/python\\nENDFOUND\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug1: Control socket \"/root/.ansible/cp/192.168.77.130-root\" does not exist\\r\\ndebug2: resolving \"192.168.77.130\" port 22\\r\\ndebug2: ssh_connect_direct: needpriv 0\\r\\ndebug1: Connecting to 192.168.77.130 [192.168.77.130] port 22.\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug1: fd 3 clearing O_NONBLOCK\\r\\ndebug1: Connection established.\\r\\ndebug3: timeout: 10000 ms remain after connect\\r\\ndebug1: permanently_set_uid: 0/0\\r\\ndebug1: identity file /root/.ssh/id_rsa type 1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_rsa-cert type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_dsa type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_dsa-cert type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ecdsa type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ecdsa-cert type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ed25519 type -1\\r\\ndebug1: key_load_public: No such file or directory\\r\\ndebug1: identity file /root/.ssh/id_ed25519-cert type -1\\r\\ndebug1: Enabling compatibility mode for protocol 2.0\\r\\ndebug1: Local version string SSH-2.0-OpenSSH_7.4\\r\\ndebug1: Remote protocol version 2.0, remote software version OpenSSH_7.4\\r\\ndebug1: match: OpenSSH_7.4 pat OpenSSH* compat 0x04000000\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug1: Authenticating to 192.168.77.130:22 as \\' root \\'\\r\\n debug3: hostkeys_foreach: reading file \"/root/.ssh/known_hosts\" \\r\\n debug3: record_hostkey: found key type ECDSA in file /root/.ssh/known_hosts:3 \\r\\n debug3: load_hostkeys: loaded 1 keys from 192 .168.77.130 \\r\\n debug3: order_hostkeyalgs: prefer hostkeyalgs: ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp521-cert-v01@openssh.com,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521 \\r\\n debug3: send packet: type 20 \\r\\n debug1: SSH2_MSG_KEXINIT sent \\r\\n debug3: receive packet: type 20 \\r\\n debug1: SSH2_MSG_KEXINIT received \\r\\n debug2: local client KEXINIT proposal \\r\\n debug2: KEX algorithms: curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha256,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1,ext-info-c \\r\\n debug2: host key algorithms: ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp521-cert-v01@openssh.com,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,ssh-ed25519-cert-v01@openssh.com,ssh-rsa-cert-v01@openssh.com,ssh-dss-cert-v01@openssh.com,ssh-ed25519,rsa-sha2-512,rsa-sha2-256,ssh-rsa,ssh-dss \\r\\n debug2: ciphers ctos: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc \\r\\n debug2: ciphers stoc: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc \\r\\n debug2: MACs ctos: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: MACs stoc: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: compression ctos: zlib@openssh.com,zlib,none \\r\\n debug2: compression stoc: zlib@openssh.com,zlib,none \\r\\n debug2: languages ctos: \\r\\n debug2: languages stoc: \\r\\n debug2: first_kex_follows 0 \\r\\n debug2: reserved 0 \\r\\n debug2: peer server KEXINIT proposal \\r\\n debug2: KEX algorithms: curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha256,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1 \\r\\n debug2: host key algorithms: ssh-rsa,rsa-sha2-512,rsa-sha2-256,ecdsa-sha2-nistp256,ssh-ed25519 \\r\\n debug2: ciphers ctos: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc,blowfish-cbc,cast128-cbc,3des-cbc \\r\\n debug2: ciphers stoc: chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-cbc,aes192-cbc,aes256-cbc,blowfish-cbc,cast128-cbc,3des-cbc \\r\\n debug2: MACs ctos: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: MACs stoc: umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1 \\r\\n debug2: compression ctos: none,zlib@openssh.com \\r\\n debug2: compression stoc: none,zlib@openssh.com \\r\\n debug2: languages ctos: \\r\\n debug2: languages stoc: \\r\\n debug2: first_kex_follows 0 \\r\\n debug2: reserved 0 \\r\\n debug1: kex: algorithm: curve25519-sha256 \\r\\n debug1: kex: host key algorithm: ecdsa-sha2-nistp256 \\r\\n debug1: kex: server->client cipher: chacha20-poly1305@openssh.com MAC: <implicit> compression: zlib@openssh.com \\r\\n debug1: kex: client->server cipher: chacha20-poly1305@openssh.com MAC: <implicit> compression: zlib@openssh.com \\r\\n debug1: kex: curve25519-sha256 need = 64 dh_need = 64 \\r\\n debug1: kex: curve25519-sha256 need = 64 dh_need = 64 \\r\\n debug3: send packet: type 30 \\r\\n debug1: expecting SSH2_MSG_KEX_ECDH_REPLY \\r\\n debug3: receive packet: type 31 \\r\\n debug1: Server host key: ecdsa-sha2-nistp256 SHA256:2lWSIJMF9r8hnfLwlKONY07eQCeZaDVZ/xWZizr9wqs \\r\\n debug3: hostkeys_foreach: reading file \"/root/.ssh/known_hosts\" \\r\\n debug3: record_hostkey: found key type ECDSA in file /root/.ssh/known_hosts:3 \\r\\n debug3: load_hostkeys: loaded 1 keys from 192 .168.77.130 \\r\\n debug1: Host \\' 192 .168.77.130 \\' is known and matches the ECDSA host key. \\r\\n debug1: Found key in /root/.ssh/known_hosts:3 \\r\\n debug3: send packet: type 21 \\r\\n debug2: set_newkeys: mode 1 \\r\\n debug1: rekey after 134217728 blocks \\r\\n debug1: SSH2_MSG_NEWKEYS sent \\r\\n debug1: expecting SSH2_MSG_NEWKEYS \\r\\n debug3: receive packet: type 21 \\r\\n debug1: SSH2_MSG_NEWKEYS received \\r\\n debug2: set_newkeys: mode 0 \\r\\n debug1: rekey after 134217728 blocks \\r\\n debug2: key: /root/.ssh/id_rsa ( 0x556b5d8e7d20 ) \\r\\n debug2: key: /root/.ssh/id_dsa (( nil )) \\r\\n debug2: key: /root/.ssh/id_ecdsa (( nil )) \\r\\n debug2: key: /root/.ssh/id_ed25519 (( nil )) \\r\\n debug3: send packet: type 5 \\r\\n debug3: receive packet: type 7 \\r\\n debug1: SSH2_MSG_EXT_INFO received \\r\\n debug1: kex_input_ext_info: server-sig-algs = <rsa-sha2-256,rsa-sha2-512> \\r\\n debug3: receive packet: type 6 \\r\\n debug2: service_accept: ssh-userauth \\r\\n debug1: SSH2_MSG_SERVICE_ACCEPT received \\r\\n debug3: send packet: type 50 \\r\\n debug3: receive packet: type 51 \\r\\n debug1: Authentications that can continue : publickey,gssapi-keyex,gssapi-with-mic,password \\r\\n debug3: start over, passed a different list publickey,gssapi-keyex,gssapi-with-mic,password \\r\\n debug3: preferred gssapi-keyex,gssapi-with-mic,publickey,keyboard-interactive,password \\r\\n debug3: authmethod_lookup gssapi-keyex \\r\\n debug3: remaining preferred: gssapi-with-mic,publickey,keyboard-interactive,password \\r\\n debug3: authmethod_is_enabled gssapi-keyex \\r\\n debug1: Next authentication method: gssapi-keyex \\r\\n debug1: No valid Key exchange context \\r\\n debug2: we did not send a packet, disable method \\r\\n debug3: authmethod_lookup gssapi-with-mic \\r\\n debug3: remaining preferred: publickey,keyboard-interactive,password \\r\\n debug3: authmethod_is_enabled gssapi-with-mic \\r\\n debug1: Next authentication method: gssapi-with-mic \\r\\n debug1: Unspecified GSS failure. Minor code may provide more information \\n No Kerberos credentials available ( default cache: KEYRING:persistent:0 ) \\n\\r\\n debug1: Unspecified GSS failure. Minor code may provide more information \\n No Kerberos credentials available ( default cache: KEYRING:persistent:0 ) \\n\\r\\n debug2: we did not send a packet, disable method \\r\\n debug3: authmethod_lookup publickey \\r\\n debug3: remaining preferred: keyboard-interactive,password \\r\\n debug3: authmethod_is_enabled publickey \\r\\n debug1: Next authentication method: publickey \\r\\n debug1: Offering RSA public key: /root/.ssh/id_rsa \\r\\n debug3: send_pubkey_test \\r\\n debug3: send packet: type 50 \\r\\n debug2: we sent a publickey packet, wait for reply \\r\\n debug3: receive packet: type 60 \\r\\n debug1: Server accepts key: pkalg rsa-sha2-512 blen 535 \\r\\n debug2: input_userauth_pk_ok: fp SHA256:fFR+c7Nyf0e+Zr3vsC0dKzR2EcfUwOu6Ku1EaTvvSmM \\r\\n debug3: sign_and_send_pubkey: RSA SHA256:fFR+c7Nyf0e+Zr3vsC0dKzR2EcfUwOu6Ku1EaTvvSmM \\r\\n debug3: send packet: type 50 \\r\\n debug3: receive packet: type 52 \\r\\n debug1: Enabling compression at level 6 . \\r\\n debug1: Authentication succeeded ( publickey ) . \\r\\n Authenticated to 192 .168.77.130 ([ 192 .168.77.130 ] :22 ) . \\r\\n debug1: setting up multiplex master socket \\r\\n debug3: muxserver_listen: temporary control path /root/.ansible/cp/192.168.77.130-root.2qeJDnNpYpqMN20m \\r\\n debug2: fd 4 setting O_NONBLOCK \\r\\n debug3: fd 4 is O_NONBLOCK \\r\\n debug3: fd 4 is O_NONBLOCK \\r\\n debug1: channel 0 : new [ /root/.ansible/cp/192.168.77.130-root ] \\r\\n debug3: muxserver_listen: mux listener channel 0 fd 4 \\r\\n debug2: fd 3 setting TCP_NODELAY \\r\\n debug3: ssh_packet_set_tos: set IP_TOS 0x08 \\r\\n debug1: control_persist_detach: backgrounding master process \\r\\n debug2: control_persist_detach: background process is 56633 \\r\\n debug2: fd 4 setting O_NONBLOCK \\r\\n debug1: forking to background \\r\\n debug1: Entering interactive session. \\r\\n debug1: pledge: id \\r\\n debug2: set_control_persist_exit_time: schedule exit in 60 seconds \\r\\n debug1: multiplexing control connection \\r\\n debug2: fd 5 setting O_NONBLOCK \\r\\n debug3: fd 5 is O_NONBLOCK \\r\\n debug1: channel 1 : new [ mux-control ] \\r\\n debug3: channel_post_mux_listener: new mux channel 1 fd 5 \\r\\n debug3: mux_master_read_cb: channel 1 : hello sent \\r\\n debug2: set_control_persist_exit_time: cancel scheduled exit \\r\\n debug3: mux_master_read_cb: channel 1 packet type 0x00000001 len 4 \\r\\n debug2: process_mux_master_hello: channel 1 slave version 4 \\r\\n debug2: mux_client_hello_exchange: master version 4 \\r\\n debug3: mux_client_forwards: request forwardings: 0 local, 0 remote \\r\\n debug3: mux_client_request_session: entering \\r\\n debug3: mux_client_request_alive: entering \\r\\n debug3: mux_master_read_cb: channel 1 packet type 0x10000004 len 4 \\r\\n debug2: process_mux_alive_check: channel 1 : alive check \\r\\n debug3: mux_client_request_alive: done pid = 56635 \\r\\n debug3: mux_client_request_session: session request sent \\r\\n debug3: mux_master_read_cb: channel 1 packet type 0x10000002 len 449 \\r\\n debug2: process_mux_new_session: channel 1 : request tty 0 , X 0 , agent 0 , subsys 0 , term \"xterm\" , cmd \"/bin/sh -c \\'echo PLATFORM; uname; echo FOUND; command -v \\'\" \\' \"\\'/usr/bin/python\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python3.7\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python3.6\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python3.5\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python2.7\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python2.6\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'/usr/libexec/platform-python\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'/usr/bin/python3\\'\" \\' \"\\'; command -v \\'\" \\' \"\\'python\\'\" \\' \"\\'; echo ENDFOUND && sleep 0\\'\" , env 1 \\r\\n debug3: process_mux_new_session: got fds stdin 6 , stdout 7 , stderr 8 \\r\\n debug2: fd 7 setting O_NONBLOCK \\r\\n debug2: fd 8 setting O_NONBLOCK \\r\\n debug1: channel 2 : new [ client-session ] \\r\\n debug2: process_mux_new_session: channel_new: 2 linked to control channel 1 \\r\\n debug2: channel 2 : send open \\r\\n debug3: send packet: type 90 \\r\\n debug3: receive packet: type 80 \\r\\n debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0 \\r\\n debug3: receive packet: type 91 \\r\\n debug2: callback start \\r\\n debug2: client_session2_setup: id 2 \\r\\n debug1: Sending environment. \\r\\n debug1: Sending env LANG = zh_CN.UTF-8 \\r\\n debug2: channel 2 : request env confirm 0 \\r\\n debug3: send packet: type 98 \\r\\n debug1: Sending command: /bin/sh -c \\' echo PLATFORM ; uname ; echo FOUND ; command -v \\' \"\\'\" \\' /usr/bin/python \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python3.7 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python3.6 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python3.5 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python2.7 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python2.6 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' /usr/libexec/platform-python \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' /usr/bin/python3 \\' \"\\'\" \\' ; command -v \\' \"\\'\" \\' python \\' \"\\'\" \\' ; echo ENDFOUND && sleep 0 \\'\\r\\n debug2: channel 2 : request exec confirm 1 \\r\\n debug3: send packet: type 98 \\r\\n debug3: mux_session_confirm: sending success reply \\r\\n debug2: callback done \\r\\n debug2: channel 2 : open confirm rwindow 0 rmax 32768 \\r\\n debug1: mux_client_request_session: master session id: 2 \\r\\n debug2: channel 2 : rcvd adjust 2097152 \\r\\n debug3: receive packet: type 99 \\r\\n debug2: channel_input_status_confirm: type 99 id 2 \\r\\n debug2: exec request accepted on channel 2 \\r\\n debug3: receive packet: type 98 \\r\\n debug1: client_input_channel_req: channel 2 rtype exit-status reply 0 \\r\\n debug3: mux_exit_message: channel 2 : exit message, exitval 0 \\r\\n debug3: receive packet: type 98 \\r\\n debug1: client_input_channel_req: channel 2 rtype eow@openssh.com reply 0 \\r\\n debug2: channel 2 : rcvd eow \\r\\n debug2: channel 2 : close_read \\r\\n debug2: channel 2 : input open -> closed \\r\\n debug3: receive packet: type 96 \\r\\n debug2: channel 2 : rcvd eof \\r\\n debug2: channel 2 : output open -> drain \\r\\n debug2: channel 2 : obuf empty \\r\\n debug2: channel 2 : close_write \\r\\n debug2: channel 2 : output drain -> closed \\r\\n debug3: receive packet: type 97 \\r\\n debug2: channel 2 : rcvd close \\r\\n debug3: channel 2 : will not send data after close \\r\\n debug2: channel 2 : send close \\r\\n debug3: send packet: type 97 \\r\\n debug2: channel 2 : is dead \\r\\n debug2: channel 2 : gc: notify user \\r\\n debug3: mux_master_session_cleanup_cb: entering for channel 2 \\r\\n debug2: channel 1 : rcvd close \\r\\n debug2: channel 1 : output open -> drain \\r\\n debug2: channel 1 : close_read \\r\\n debug2: channel 1 : input open -> closed \\r\\n debug2: channel 2 : gc: user detached \\r\\n debug2: channel 2 : is dead \\r\\n debug2: channel 2 : garbage collecting \\r\\n debug1: channel 2 : free: client-session, nchannels 3 \\r\\n debug3: channel 2 : status: The following connections are open: \\r\\n #1 mux-control (t16 r-1 i3/0 o1/16 fd 5/5 cc -1)\\r\\n #2 client-session (t4 r0 i3/0 o3/0 fd -1/-1 cc -1)\\r\\n\\r\\ndebug2: channel 1: obuf empty\\r\\ndebug2: channel 1: close_write\\r\\ndebug2: channel 1: output drain -> closed\\r\\ndebug2: channel 1: is dead (local)\\r\\ndebug2: channel 1: gc: notify user\\r\\ndebug3: mux_master_control_cleanup_cb: entering for channel 1\\r\\ndebug2: channel 1: gc: user detached\\r\\ndebug2: channel 1: is dead (local)\\r\\ndebug2: channel 1: garbage collecting\\r\\ndebug1: channel 1: free: mux-control, nchannels 2\\r\\ndebug3: channel 1: status: The following connections are open:\\r\\n #1 mux-control (t16 r-1 i3/0 o3/0 fd 5/5 cc -1)\\r\\n\\r\\ndebug2: set_control_persist_exit_time: schedule exit in 60 seconds\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n') < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '{\"osrelease_content\": \"NAME=\\\\\"CentOS Linux\\\\\"\\\\nVERSION=\\\\\"7 (Core)\\\\\"\\\\nID=\\\\\"centos\\\\\"\\\\nID_LIKE=\\\\\"rhel fedora\\\\\"\\\\nVERSION_ID=\\\\\"7\\\\\"\\\\nPRETTY_NAME=\\\\\"CentOS Linux 7 (Core)\\\\\"\\\\nANSI_COLOR=\\\\\"0;31\\\\\"\\\\nCPE_NAME=\\\\\"cpe:/o:centos:centos:7\\\\\"\\\\nHOME_URL=\\\\\"https://www.centos.org/\\\\\"\\\\nBUG_REPORT_URL=\\\\\"https://bugs.centos.org/\\\\\"\\\\n\\\\nCENTOS_MANTISBT_PROJECT=\\\\\"CentOS-7\\\\\"\\\\nCENTOS_MANTISBT_PROJECT_VERSION=\\\\\"7\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT=\\\\\"centos\\\\\"\\\\nREDHAT_SUPPORT_PRODUCT_VERSION=\\\\\"7\\\\\"\\\\n\\\\n\", \"platform_dist_result\": [\"centos\", \"7.4.1708\", \"Core\"]}\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug2: mux_client_hello_exchange: master version 4\\r\\ndebug3: mux_client_forwards: request forwardings: 0 local, 0 remote\\r\\ndebug3: mux_client_request_session: entering\\r\\ndebug3: mux_client_request_alive: entering\\r\\ndebug3: mux_client_request_alive: done pid = 56635\\r\\ndebug3: mux_client_request_session: session request sent\\r\\ndebug1: mux_client_request_session: master session id: 2\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n' ) Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/setup.py Pipelining is enabled. < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '\\n{\"invocation\": {\"module_args\": {\"filter\": \"*\", \"gather_subset\": [\"all\"], \"fact_path\": \"/etc/ansible/facts.d\", \"gather_timeout\": 10}}, \"ansible_facts\": {\"ansible_fibre_channel_wwn\": [], \"module_setup\": true, \"ansible_distribution_version\": \"7.4\", \"ansible_distribution_file_variety\": \"RedHat\", \"ansible_env\": {\"LANG\": \"zh_CN.UTF-8\", \"SHELL\": \"/bin/bash\", \"XDG_RUNTIME_DIR\": \"/run/user/0\", \"SHLVL\": \"2\", \"XDG_SESSION_ID\": \"180\", \"CLASSPATH\": \".:/usr/java/jdk1.8.0_131/lib/dt.jar:/usr/java/jdk1.8.0_131/lib/tools.jar\", \"PWD\": \"/root\", \"LESSOPEN\": \"||/usr/bin/lesspipe.sh %s\", \"SSH_CLIENT\": \"192.168.77.130 37228 22\", \"LOGNAME\": \"root\", \"USER\": \"root\", \"MAIL\": \"/var/mail/root\", \"PATH\": \"/usr/java/jdk1.8.0_131/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin\", \"JAVA_HOME\": \"/usr/java/jdk1.8.0_131\", \"HOME\": \"/root\", \"_\": \"/usr/bin/python\", \"SSH_CONNECTION\": \"192.168.77.130 37228 192.168.77.130 22\"}, \"ansible_userspace_bits\": \"64\", \"ansible_architecture\": \"x86_64\", \"ansible_default_ipv4\": {\"macaddress\": \"00:0c:29:db:d1:39\", \"network\": \"192.168.77.0\", \"mtu\": 1500, \"broadcast\": \"192.168.77.255\", \"alias\": \"ens33\", \"netmask\": \"255.255.255.0\", \"address\": \"192.168.77.130\", \"interface\": \"ens33\", \"type\": \"ether\", \"gateway\": \"192.168.77.2\"}, \"ansible_swapfree_mb\": 10116, \"ansible_default_ipv6\": {}, \"ansible_cmdline\": {\"BOOT_IMAGE\": \"/vmlinuz-5.1.15-1.el7.elrepo.x86_64\", \"quiet\": true, \"user_namespace.enable\": \"1\", \"rhgb\": true, \"crashkernel\": \"auto\", \"ro\": true, \"root\": \"UUID=a7d49533-e756-4a71-a977-5efb174eb09c\"}, \"ansible_machine_id\": \"c6e2cb0cdbad41f19c30d690896aabe0\", \"ansible_userspace_architecture\": \"x86_64\", \"ansible_product_uuid\": \"5af44d56-0800-32e7-8576-613693dbd139\", \"ansible_pkg_mgr\": \"yum\", \"ansible_distribution\": \"CentOS\", \"ansible_iscsi_iqn\": \"\", \"ansible_all_ipv6_addresses\": [\"fe80::42:56ff:fec2:83be\", \"fe80::20c:29ff:fedb:d139\"], \"ansible_uptime_seconds\": 75217, \"ansible_kernel\": \"5.1.15-1.el7.elrepo.x86_64\", \"ansible_system_capabilities_enforced\": \"True\", \"ansible_python\": {\"executable\": \"/usr/bin/python\", \"version\": {\"micro\": 5, \"major\": 2, \"releaselevel\": \"final\", \"serial\": 0, \"minor\": 7}, \"type\": \"CPython\", \"has_sslcontext\": true, \"version_info\": [2, 7, 5, \"final\", 0]}, \"ansible_is_chroot\": false, \"ansible_hostnqn\": \"\", \"ansible_user_shell\": \"/bin/bash\", \"ansible_product_serial\": \"VMware-56 4d f4 5a 00 08 e7 32-85 76 61 36 93 db d1 39\", \"ansible_form_factor\": \"Other\", \"ansible_distribution_file_parsed\": true, \"ansible_fips\": false, \"ansible_user_id\": \"root\", \"ansible_selinux_python_present\": true, \"ansible_kernel_version\": \"#1 SMP Tue Jun 25 10:52:45 EDT 2019\", \"ansible_local\": {}, \"ansible_processor_vcpus\": 1, \"ansible_docker0\": {\"macaddress\": \"02:42:56:c2:83:be\", \"features\": {\"tx_checksum_ipv4\": \"off [fixed]\", \"generic_receive_offload\": \"on\", \"tx_checksum_ipv6\": \"off [fixed]\", \"tx_scatter_gather_fraglist\": \"on\", \"rx_all\": \"off [fixed]\", \"highdma\": \"on\", \"tls_hw_rx_offload\": \"off [fixed]\", \"tx_lockless\": \"on [fixed]\", \"tx_tcp_ecn_segmentation\": \"on\", \"rx_udp_tunnel_port_offload\": \"off [fixed]\", \"esp_hw_offload\": \"off [fixed]\", \"tx_gso_robust\": \"on\", \"tx_udp_segmentation\": \"on\", \"tx_tcp_mangleid_segmentation\": \"on\", \"tx_ipxip4_segmentation\": \"on\", \"tx_checksumming\": \"on\", \"vlan_challenged\": \"off [fixed]\", \"loopback\": \"off [fixed]\", \"tx_ipxip6_segmentation\": \"on\", \"fcoe_mtu\": \"off [fixed]\", \"scatter_gather\": \"on\", \"tx_checksum_sctp\": \"off [fixed]\", \"tx_vlan_stag_hw_insert\": \"on\", \"rx_vlan_stag_hw_parse\": \"off [fixed]\", \"tx_gso_partial\": \"on\", \"tx_tcp_segmentation\": \"on\", \"rx_vlan_stag_filter\": \"off [fixed]\", \"large_receive_offload\": \"off [fixed]\", \"tx_scatter_gather\": \"on\", \"tx_tcp6_segmentation\": \"on\", \"rx_checksumming\": \"off [fixed]\", \"rx_gro_hw\": \"off [fixed]\", \"netns_local\": \"on [fixed]\", \"tx_esp_segmentation\": \"on\", \"generic_segmentation_offload\": \"on\", \"rx_fcs\": \"off [fixed]\", \"tcp_segmentation_offload\": \"on\", \"l2_fwd_offload\": \"off [fixed]\", \"rx_vlan_offload\": \"off [fixed]\", \"ntuple_filters\": \"off [fixed]\", \"tx_gre_csum_segmentation\": \"on\", \"esp_tx_csum_hw_offload\": \"off [fixed]\", \"tx_udp_tnl_segmentation\": \"on\", \"tx_udp_tnl_csum_segmentation\": \"on\", \"tx_sctp_segmentation\": \"on\", \"udp_fragmentation_offload\": \"off\", \"tls_hw_record\": \"off [fixed]\", \"tls_hw_tx_offload\": \"off [fixed]\", \"tx_checksum_fcoe_crc\": \"off [fixed]\", \"hw_tc_offload\": \"off [fixed]\", \"tx_checksum_ip_generic\": \"on\", \"tx_fcoe_segmentation\": \"on\", \"tx_nocache_copy\": \"off\", \"rx_vlan_filter\": \"off [fixed]\", \"tx_vlan_offload\": \"on\", \"receive_hashing\": \"off [fixed]\", \"tx_gre_segmentation\": \"on\"}, \"interfaces\": [], \"id\": \"8000.024256c283be\", \"mtu\": 1500, \"device\": \"docker0\", \"promisc\": false, \"stp\": false, \"ipv4\": {\"broadcast\": \"172.17.255.255\", \"netmask\": \"255.255.0.0\", \"network\": \"172.17.0.0\", \"address\": \"172.17.0.1\"}, \"ipv6\": [{\"scope\": \"link\", \"prefix\": \"64\", \"address\": \"fe80::42:56ff:fec2:83be\"}], \"active\": false, \"timestamping\": [\"rx_software\", \"software\"], \"type\": \"bridge\", \"hw_timestamp_filters\": []}, \"ansible_processor\": [\"0\", \"GenuineIntel\", \"Intel(R) Core(TM) i7-6700HQ CPU @ 2.60GHz\"], \"ansible_ssh_host_key_ecdsa_public\": \"AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBK2zovckFKduH7EsvGaWar2mA+LdC4kTjgFG4h9RQlxZ1v5kEPx8Bs7jWnj94Cd8lY8BGb7RU7akUFpq3V59WIY=\", \"ansible_user_gid\": 0, \"ansible_system_vendor\": \"VMware, Inc.\", \"ansible_swaptotal_mb\": 10239, \"ansible_distribution_major_version\": \"7\", \"ansible_real_group_id\": 0, \"ansible_lsb\": {}, \"ansible_ens33\": {\"macaddress\": \"00:0c:29:db:d1:39\", \"features\": {\"tx_checksum_ipv4\": \"off [fixed]\", \"generic_receive_offload\": \"on\", \"tx_checksum_ipv6\": \"off [fixed]\", \"tx_scatter_gather_fraglist\": \"off [fixed]\", \"rx_all\": \"off\", \"highdma\": \"off [fixed]\", \"tls_hw_rx_offload\": \"off [fixed]\", \"tx_lockless\": \"off [fixed]\", \"tx_tcp_ecn_segmentation\": \"off [fixed]\", \"rx_udp_tunnel_port_offload\": \"off [fixed]\", \"esp_hw_offload\": \"off [fixed]\", \"tx_gso_robust\": \"off [fixed]\", \"tx_udp_segmentation\": \"off [fixed]\", \"tx_tcp_mangleid_segmentation\": \"off\", \"tx_ipxip4_segmentation\": \"off [fixed]\", \"tx_checksumming\": \"on\", \"vlan_challenged\": \"off [fixed]\", \"loopback\": \"off [fixed]\", \"tx_ipxip6_segmentation\": \"off [fixed]\", \"fcoe_mtu\": \"off [fixed]\", \"scatter_gather\": \"on\", \"tx_checksum_sctp\": \"off [fixed]\", \"tx_vlan_stag_hw_insert\": \"off [fixed]\", \"rx_vlan_stag_hw_parse\": \"off [fixed]\", \"tx_gso_partial\": \"off [fixed]\", \"tx_tcp_segmentation\": \"on\", \"rx_vlan_stag_filter\": \"off [fixed]\", \"large_receive_offload\": \"off [fixed]\", \"tx_scatter_gather\": \"on\", \"tx_tcp6_segmentation\": \"off [fixed]\", \"rx_checksumming\": \"off\", \"rx_gro_hw\": \"off [fixed]\", \"netns_local\": \"off [fixed]\", \"tx_esp_segmentation\": \"off [fixed]\", \"generic_segmentation_offload\": \"on\", \"rx_fcs\": \"off\", \"tcp_segmentation_offload\": \"on\", \"l2_fwd_offload\": \"off [fixed]\", \"rx_vlan_offload\": \"on\", \"ntuple_filters\": \"off [fixed]\", \"tx_gre_csum_segmentation\": \"off [fixed]\", \"esp_tx_csum_hw_offload\": \"off [fixed]\", \"tx_udp_tnl_segmentation\": \"off [fixed]\", \"tx_udp_tnl_csum_segmentation\": \"off [fixed]\", \"tx_sctp_segmentation\": \"off [fixed]\", \"udp_fragmentation_offload\": \"off\", \"tls_hw_record\": \"off [fixed]\", \"tls_hw_tx_offload\": \"off [fixed]\", \"tx_checksum_fcoe_crc\": \"off [fixed]\", \"hw_tc_offload\": \"off [fixed]\", \"tx_checksum_ip_generic\": \"on\", \"tx_fcoe_segmentation\": \"off [fixed]\", \"tx_nocache_copy\": \"off\", \"rx_vlan_filter\": \"on [fixed]\", \"tx_vlan_offload\": \"on [fixed]\", \"receive_hashing\": \"off [fixed]\", \"tx_gre_segmentation\": \"off [fixed]\"}, \"type\": \"ether\", \"pciid\": \"0000:02:01.0\", \"module\": \"e1000\", \"mtu\": 1500, \"device\": \"ens33\", \"promisc\": false, \"timestamping\": [\"tx_software\", \"rx_software\", \"software\"], \"ipv4\": {\"broadcast\": \"192.168.77.255\", \"netmask\": \"255.255.255.0\", \"network\": \"192.168.77.0\", \"address\": \"192.168.77.130\"}, \"ipv6\": [{\"scope\": \"link\", \"prefix\": \"64\", \"address\": \"fe80::20c:29ff:fedb:d139\"}], \"active\": true, \"speed\": 1000, \"hw_timestamp_filters\": []}, \"ansible_machine\": \"x86_64\", \"ansible_ssh_host_key_rsa_public\": \"AAAAB3NzaC1yc2EAAAADAQABAAABAQDfNgNsUWXmYOD7Iz94nO98XRmw4dWKREbxWz6rZBP2QHYFN38nzdo9h5UT4HMuUM/FraPwwbfPubznNgn0/cXfMkqu8JIssxizpIRBZv82HFqwHTYRvkFAEII8ftkHs2RVlq64+ljPZzWvGL14nkfU7P+kc8Ym4jZGtorKRBoHFCeu67fycmZSCLFJxkKSumOaZ9TbNzP6bziyfmdDIGfj8UgzJRSuBW+B5XNeJp/QtsQZTjgpxSZZ9QRf/FeRx1NDR5Si91Fkd0NILIgoOSz536lP+aCCUOx7ukaoV1T/kyUKOj8a3wpBGiBWWZUGZa6O02Ig0eHnx8F4lZ2iOnNN\", \"ansible_user_gecos\": \"root\", \"ansible_processor_threads_per_core\": 1, \"ansible_product_name\": \"VMware Virtual Platform\", \"ansible_all_ipv4_addresses\": [\"172.17.0.1\", \"192.168.77.130\"], \"ansible_python_version\": \"2.7.5\", \"ansible_product_version\": \"None\", \"ansible_service_mgr\": \"systemd\", \"ansible_memory_mb\": {\"real\": {\"total\": 960, \"used\": 877, \"free\": 83}, \"swap\": {\"cached\": 17, \"total\": 10239, \"free\": 10116, \"used\": 123}, \"nocache\": {\"used\": 596, \"free\": 364}}, \"ansible_user_dir\": \"/root\", \"gather_subset\": [\"all\"], \"ansible_real_user_id\": 0, \"ansible_virtualization_role\": \"guest\", \"ansible_dns\": {\"nameservers\": [\"192.168.77.2\"]}, \"ansible_effective_group_id\": 0, \"ansible_lo\": {\"features\": {\"tx_checksum_ipv4\": \"off [fixed]\", \"generic_receive_offload\": \"on\", \"tx_checksum_ipv6\": \"off [fixed]\", \"tx_scatter_gather_fraglist\": \"on [fixed]\", \"rx_all\": \"off [fixed]\", \"highdma\": \"on [fixed]\", \"tls_hw_rx_offload\": \"off [fixed]\", \"tx_lockless\": \"on [fixed]\", \"tx_tcp_ecn_segmentation\": \"on\", \"rx_udp_tunnel_port_offload\": \"off [fixed]\", \"esp_hw_offload\": \"off [fixed]\", \"tx_gso_robust\": \"off [fixed]\", \"tx_udp_segmentation\": \"off [fixed]\", \"tx_tcp_mangleid_segmentation\": \"on\", \"tx_ipxip4_segmentation\": \"off [fixed]\", \"tx_checksumming\": \"on\", \"vlan_challenged\": \"on [fixed]\", \"loopback\": \"on [fixed]\", \"tx_ipxip6_segmentation\": \"off [fixed]\", \"fcoe_mtu\": \"off [fixed]\", \"scatter_gather\": \"on\", \"tx_checksum_sctp\": \"on [fixed]\", \"tx_vlan_stag_hw_insert\": \"off [fixed]\", \"rx_vlan_stag_hw_parse\": \"off [fixed]\", \"tx_gso_partial\": \"off [fixed]\", \"tx_tcp_segmentation\": \"on\", \"rx_vlan_stag_filter\": \"off [fixed]\", \"large_receive_offload\": \"off [fixed]\", \"tx_scatter_gather\": \"on [fixed]\", \"tx_tcp6_segmentation\": \"on\", \"rx_checksumming\": \"on [fixed]\", \"rx_gro_hw\": \"off [fixed]\", \"netns_local\": \"on [fixed]\", \"tx_esp_segmentation\": \"off [fixed]\", \"generic_segmentation_offload\": \"on\", \"rx_fcs\": \"off [fixed]\", \"tcp_segmentation_offload\": \"on\", \"l2_fwd_offload\": \"off [fixed]\", \"rx_vlan_offload\": \"off [fixed]\", \"ntuple_filters\": \"off [fixed]\", \"tx_gre_csum_segmentation\": \"off [fixed]\", \"esp_tx_csum_hw_offload\": \"off [fixed]\", \"tx_udp_tnl_segmentation\": \"off [fixed]\", \"tx_udp_tnl_csum_segmentation\": \"off [fixed]\", \"tx_sctp_segmentation\": \"on\", \"udp_fragmentation_offload\": \"off\", \"tls_hw_record\": \"off [fixed]\", \"tls_hw_tx_offload\": \"off [fixed]\", \"tx_checksum_fcoe_crc\": \"off [fixed]\", \"hw_tc_offload\": \"off [fixed]\", \"tx_checksum_ip_generic\": \"on [fixed]\", \"tx_fcoe_segmentation\": \"off [fixed]\", \"tx_nocache_copy\": \"off [fixed]\", \"rx_vlan_filter\": \"off [fixed]\", \"tx_vlan_offload\": \"off [fixed]\", \"receive_hashing\": \"off [fixed]\", \"tx_gre_segmentation\": \"off [fixed]\"}, \"hw_timestamp_filters\": [], \"mtu\": 65536, \"device\": \"lo\", \"promisc\": false, \"timestamping\": [\"tx_software\", \"rx_software\", \"software\"], \"ipv4\": {\"broadcast\": \"host\", \"netmask\": \"255.0.0.0\", \"network\": \"127.0.0.0\", \"address\": \"127.0.0.1\"}, \"ipv6\": [{\"scope\": \"host\", \"prefix\": \"128\", \"address\": \"::1\"}], \"active\": true, \"type\": \"loopback\"}, \"ansible_memtotal_mb\": 960, \"ansible_device_links\": {\"masters\": {}, \"labels\": {}, \"ids\": {\"sr0\": [\"ata-VMware_Virtual_IDE_CDROM_Drive_10000000000000000001\"]}, \"uuids\": {\"sda2\": [\"0c0f8a5a-58dd-4fc6-a49e-fc5e63f5d8a3\"], \"sda3\": [\"a7d49533-e756-4a71-a977-5efb174eb09c\"], \"sda1\": [\"93556f71-6dad-4761-9207-edee35d47129\"]}}, \"ansible_apparmor\": {\"status\": \"disabled\"}, \"ansible_proc_cmdline\": {\"BOOT_IMAGE\": \"/vmlinuz-5.1.15-1.el7.elrepo.x86_64\", \"quiet\": true, \"user_namespace.enable\": \"1\", \"rhgb\": true, \"crashkernel\": \"auto\", \"ro\": true, \"root\": \"UUID=a7d49533-e756-4a71-a977-5efb174eb09c\"}, \"ansible_memfree_mb\": 83, \"ansible_processor_count\": 1, \"ansible_hostname\": \"node130\", \"ansible_interfaces\": [\"lo\", \"docker0\", \"ens33\"], \"ansible_selinux\": {\"status\": \"disabled\"}, \"ansible_fqdn\": \"node130\", \"ansible_mounts\": [{\"block_used\": 32390, \"uuid\": \"93556f71-6dad-4761-9207-edee35d47129\", \"size_total\": 206213120, \"block_total\": 50345, \"mount\": \"/boot\", \"block_available\": 17955, \"size_available\": 73543680, \"fstype\": \"xfs\", \"inode_total\": 102400, \"options\": \"rw,relatime,attr2,inode64,noquota\", \"device\": \"/dev/sda1\", \"inode_used\": 332, \"block_size\": 4096, \"inode_available\": 102068}, {\"block_used\": 790464, \"uuid\": \"a7d49533-e756-4a71-a977-5efb174eb09c\", \"size_total\": 31985868800, \"block_total\": 7809050, \"mount\": \"/\", \"block_available\": 7018586, \"size_available\": 28748128256, \"fstype\": \"xfs\", \"inode_total\": 15625728, \"options\": \"rw,relatime,attr2,inode64,noquota\", \"device\": \"/dev/sda3\", \"inode_used\": 116574, \"block_size\": 4096, \"inode_available\": 15509154}], \"ansible_nodename\": \"node130\", \"ansible_domain\": \"\", \"ansible_distribution_file_path\": \"/etc/redhat-release\", \"ansible_virtualization_type\": \"VMware\", \"ansible_ssh_host_key_ed25519_public\": \"AAAAC3NzaC1lZDI1NTE5AAAAIEgM8JK59UtnryS0IhtNoPJHbOSqy7Xy2jExPYMvAex5\", \"ansible_processor_cores\": 1, \"ansible_bios_version\": \"6.00\", \"ansible_date_time\": {\"weekday_number\": \"0\", \"iso8601_basic_short\": \"20200412T202718\", \"tz\": \"CST\", \"weeknumber\": \"14\", \"hour\": \"20\", \"year\": \"2020\", \"minute\": \"27\", \"tz_offset\": \"+0800\", \"month\": \"04\", \"epoch\": \"1586694438\", \"iso8601_micro\": \"2020-04-12T12:27:18.102117Z\", \"weekday\": \"\\\\u661f\\\\u671f\\\\u65e5\", \"time\": \"20:27:18\", \"date\": \"2020-04-12\", \"iso8601\": \"2020-04-12T12:27:18Z\", \"day\": \"12\", \"iso8601_basic\": \"20200412T202718102042\", \"second\": \"18\"}, \"ansible_distribution_release\": \"Core\", \"ansible_os_family\": \"RedHat\", \"ansible_effective_user_id\": 0, \"ansible_system\": \"Linux\", \"ansible_devices\": {\"sr0\": {\"scheduler_mode\": \"mq-deadline\", \"rotational\": \"1\", \"vendor\": \"NECVMWar\", \"sectors\": \"2097151\", \"links\": {\"masters\": [], \"labels\": [], \"ids\": [\"ata-VMware_Virtual_IDE_CDROM_Drive_10000000000000000001\"], \"uuids\": []}, \"sas_device_handle\": null, \"sas_address\": null, \"virtual\": 1, \"host\": \"IDE interface: Intel Corporation 82371AB/EB/MB PIIX4 IDE (rev 01)\", \"sectorsize\": \"512\", \"removable\": \"1\", \"support_discard\": \"0\", \"model\": \"VMware IDE CDR10\", \"partitions\": {}, \"holders\": [], \"size\": \"1024.00 MB\"}, \"sda\": {\"scheduler_mode\": \"mq-deadline\", \"rotational\": \"1\", \"vendor\": \"VMware,\", \"sectors\": \"83886080\", \"links\": {\"masters\": [], \"labels\": [], \"ids\": [], \"uuids\": []}, \"sas_device_handle\": null, \"sas_address\": null, \"virtual\": 1, \"host\": \"SCSI storage controller: LSI Logic / Symbios Logic 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI (rev 01)\", \"sectorsize\": \"512\", \"removable\": \"0\", \"support_discard\": \"0\", \"model\": \"VMware Virtual S\", \"partitions\": {\"sda2\": {\"sectorsize\": 512, \"uuid\": \"0c0f8a5a-58dd-4fc6-a49e-fc5e63f5d8a3\", \"links\": {\"masters\": [], \"labels\": [], \"ids\": [], \"uuids\": [\"0c0f8a5a-58dd-4fc6-a49e-fc5e63f5d8a3\"]}, \"sectors\": \"20971520\", \"start\": \"411648\", \"holders\": [], \"size\": \"10.00 GB\"}, \"sda3\": {\"sectorsize\": 512, \"uuid\": \"a7d49533-e756-4a71-a977-5efb174eb09c\", \"links\": {\"masters\": [], \"labels\": [], \"ids\": [], \"uuids\": [\"a7d49533-e756-4a71-a977-5efb174eb09c\"]}, \"sectors\": \"62502912\", \"start\": \"21383168\", \"holders\": [], \"size\": \"29.80 GB\"}, \"sda1\": {\"sectorsize\": 512, \"uuid\": \"93556f71-6dad-4761-9207-edee35d47129\", \"links\": {\"masters\": [], \"labels\": [], \"ids\": [], \"uuids\": [\"93556f71-6dad-4761-9207-edee35d47129\"]}, \"sectors\": \"409600\", \"start\": \"2048\", \"holders\": [], \"size\": \"200.00 MB\"}}, \"holders\": [], \"size\": \"40.00 GB\"}}, \"ansible_user_uid\": 0, \"ansible_bios_date\": \"07/29/2019\", \"ansible_system_capabilities\": [\"cap_chown\", \"cap_dac_override\", \"cap_dac_read_search\", \"cap_fowner\", \"cap_fsetid\", \"cap_kill\", \"cap_setgid\", \"cap_setuid\", \"cap_setpcap\", \"cap_linux_immutable\", \"cap_net_bind_service\", \"cap_net_broadcast\", \"cap_net_admin\", \"cap_net_raw\", \"cap_ipc_lock\", \"cap_ipc_owner\", \"cap_sys_module\", \"cap_sys_rawio\", \"cap_sys_chroot\", \"cap_sys_ptrace\", \"cap_sys_pacct\", \"cap_sys_admin\", \"cap_sys_boot\", \"cap_sys_nice\", \"cap_sys_resource\", \"cap_sys_time\", \"cap_sys_tty_config\", \"cap_mknod\", \"cap_lease\", \"cap_audit_write\", \"cap_audit_control\", \"cap_setfcap\", \"cap_mac_override\", \"cap_mac_admin\", \"cap_syslog\", \"35\", \"36\", \"37+ep\"]}}\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug2: mux_client_hello_exchange: master version 4\\r\\ndebug3: mux_client_forwards: request forwardings: 0 local, 0 remote\\r\\ndebug3: mux_client_request_session: entering\\r\\ndebug3: mux_client_request_alive: entering\\r\\ndebug3: mux_client_request_alive: done pid = 56635\\r\\ndebug3: mux_client_request_session: session request sent\\r\\ndebug1: mux_client_request_session: master session id: 2\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n' ) ok: [ 192 .168.77.130 ] META: ran handlers TASK [ ping ] ****************************************************************************************************************************************************************************************** task path: /etc/ansible/test.yml:5 Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/ping.py Pipelining is enabled. < 192 .168.77.130> ESTABLISH SSH CONNECTION FOR USER: root < 192 .168.77.130> SSH: EXEC sshpass -d8 ssh -vvv -C -o ControlMaster = auto -o ControlPersist = 60s -o StrictHostKeyChecking = no -o Port = 22 -o 'User=\"root\"' -o ConnectTimeout = 10 -o ControlPath = /root/.ansible/cp/%h-%r 192 .168.77.130 '/bin/sh -c ' \"'\" '/usr/bin/python && sleep 0' \"'\" '' < 192 .168.77.130> ( 0 , '\\n{\"invocation\": {\"module_args\": {\"data\": \"pong\"}}, \"ping\": \"pong\"}\\n' , 'OpenSSH_7.4p1, OpenSSL 1.0.2k-fips 26 Jan 2017\\r\\ndebug1: Reading configuration data /etc/ssh/ssh_config\\r\\ndebug1: /etc/ssh/ssh_config line 58: Applying options for *\\r\\ndebug1: auto-mux: Trying existing master\\r\\ndebug2: fd 3 setting O_NONBLOCK\\r\\ndebug2: mux_client_hello_exchange: master version 4\\r\\ndebug3: mux_client_forwards: request forwardings: 0 local, 0 remote\\r\\ndebug3: mux_client_request_session: entering\\r\\ndebug3: mux_client_request_alive: entering\\r\\ndebug3: mux_client_request_alive: done pid = 56635\\r\\ndebug3: mux_client_request_session: session request sent\\r\\ndebug1: mux_client_request_session: master session id: 2\\r\\ndebug3: mux_client_read_packet: read header failed: Broken pipe\\r\\ndebug2: Received exit status from master 0\\r\\n' ) ok: [ 192 .168.77.130 ] = > { \"changed\" : false, \"invocation\" : { \"module_args\" : { \"data\" : \"pong\" } } , \"ping\" : \"pong\" } META: ran handlers META: ran handlers PLAY RECAP ******************************************************************************************************************************************************************************************* 192 .168.77.130 : ok = 2 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0","title":"playbook \u8be6\u7ec6\u8f93\u51fa"},{"location":"dev/modules/","text":"\u6a21\u5757\u4ecb\u7ecd \u00b6 \u6a21\u5757(\u4e5f\u79f0\u4e3atask\u63d2\u4ef6\u6216library\u63d2\u4ef6)\u662f\u53ef\u4ee5\u4ece\u547d\u4ee4\u884c\u6216playbook\u4efb\u52a1\u4e2d\u4f7f\u7528\u7684\u72ec\u7acb\u5355\u5143\u3002Ansible\u901a\u5e38\u5728\u8fdc\u7a0b\u76ee\u6807\u8282\u70b9\u4e0a\u6267\u884c\u6bcf\u4e2a\u6a21\u5757\uff0c\u5e76\u6536\u96c6\u8fd4\u56de\u503c\u3002 \u53ef\u4ee5\u4f7f\u7528\u4e0b\u5217\u547d\u4ee4\u6267\u884c\u6a21\u5757 ansible webservers -m service -a \"name=httpd state=started\" ansible webservers -m ping ansible webservers -m command -a \"/sbin/reboot -t now\" \u6bcf\u4e2a\u6a21\u5757\u90fd\u652f\u6301\u91c7\u7528\u53c2\u6570\u3002 \u51e0\u4e4e\u6240\u6709\u6a21\u5757\u90fd\u91c7\u7528key = value\u53c2\u6570\uff0c\u4ee5\u7a7a\u683c\u5206\u9694\u3002 \u4e00\u4e9b\u6a21\u5757\u4e0d\u5e26\u4efb\u4f55\u53c2\u6570\uff0c\u800ccommand/shell\u6a21\u5757\u4ec5\u91c7\u7528\u8981\u8fd0\u884c\u547d\u4ee4\u7684\u5b57\u7b26\u4e32\u3002 \u5728playbook\u4e2d\u4f7f\u7528\u6a21\u5757 - name: reboot the servers action: command /sbin/reboot -t now - name: reboot the servers command: /sbin/reboot -t now - name: restart webserver service: name: httpd state: restarted \u83b7\u53d6\u6a21\u5757\u7684\u5e2e\u52a9\u4fe1\u606f ansible-doc yum \u83b7\u53d6\u53ef\u7528\u7684\u6a21\u5757\u5217\u8868 ansible-doc -l \u66f4\u591a\u547d\u4ee4\u4ecb\u7ecd\u89c1 ansible-doc \u5728\u5f00\u53d1\u6a21\u5757\u4e4b\u524d\uff0c\u73b0\u95ee\u4e0b\u81ea\u5df1\u51e0\u4e2a\u95ee\u9898\uff1f \u00b6 \u5b98\u65b9\u662f\u5426\u6709\u63d0\u4f9b\u7684\u7c7b\u4f3c\u529f\u80fd\u6a21\u5757\uff1f \u53ef\u4ece\u4e0b\u9762\u4e24\u4e2a\u8fde\u63a5\u786e\u5b9a\u5b98\u65b9\u63d0\u4f9b\u7684\u6a21\u5757\uff0c\u4ee5\u514d\u91cd\u590d\u9020\u8f6e\u5b50 \u5b98\u65b9\u5df2\u53d1\u5e03\u7684\u6a21\u5757 http://docs.ansible.com/ansible/modules.html \u5b98\u65b9\u6b63\u5728\u5f00\u53d1\u7684\u6a21\u5757 https://github.com/ansible/ansible/labels/module \u4f60\u9700\u8981\u5f00\u53d1\u4e00\u4e2aaction \u63d2\u4ef6\u4e48\uff1f action\u63d2\u4ef6\u662f\u5728ansible\u4e3b\u673a\u4e0a\u8fd0\u884c\uff0c\u800c\u4e0d\u662f\u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u3002\u5bf9\u4e8e\u7c7b\u4f3cfile/copy/template\u529f\u80fd\u7684\u6a21\u5757\uff0c\u5728\u6a21\u5757\u6267\u884c\u524d\u9700\u8981\u5728ansible\u4e3b\u673a\u4e0a\u505a\u4e00\u4e9b\u64cd\u4f5c\u7684\u3002\u6709\u5173action\u63d2\u4ef6\u7684\u5f00\u53d1\u8bf7\u79fb\u6b65\u5230 \u660e\u786e\u51e0\u70b9 \u00b6 \u6a21\u5757\u662f\u4f20\u9001\u5230\u76ee\u6807\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u3002 \u6a21\u5757\u7684\u8fd4\u56de\u503c\u5fc5\u987b\u662fjson dumps\u7684\u5b57\u7b26\u4e32\u3002 \u6a21\u5757\u7684\u901a\u7528\u8fd4\u56de\u503c\u89c1 \u6a21\u5757\u8fd4\u56de\u503c \u672c\u5730\u6dfb\u52a0\u6a21\u5757 \u00b6 Ansible\u81ea\u52a8\u5c06\u5728\u67d0\u4e9b\u76ee\u5f55\u4e2d\u627e\u5230\u7684\u6240\u6709\u53ef\u6267\u884c\u6587\u4ef6\u4f5c\u4e3a\u6a21\u5757\u52a0\u8f7d\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5728\u4ee5\u4e0b\u4efb\u610f\u4f4d\u7f6e\u521b\u5efa\u6216\u6dfb\u52a0\u672c\u5730\u6a21\u5757\uff1a \u4f7f\u7528\u73af\u5883\u53d8\u91cf ANSIBLE_LIBRARY \u5b9a\u4e49\u7684\u76ee\u5f55\u5217\u8868\uff0c\u4f7f\u7528\u9017\u53f7\u5206\u9694\u3002 ~/.ansible/plugins/modules/ /usr/share/ansible/plugins/modules/ \u9488\u5bf9\u4e8eplaybook\u4f7f\u7528 \u4fdd\u5b58\u5728playbook\u5f53\u524d\u76ee\u5f55 library \u76ee\u5f55\u4e2d\u7684\u6587\u4ef6 \u9488\u5bf9\u4e8erole\u4f7f\u7528 \u4fdd\u5b58\u5728role\u76ee\u5f55\u4e0b library \u76ee\u5f55\u4e2d\u7684\u6587\u4ef6 \u4e5f\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u6a21\u5757\u76ee\u5f55 [defaults] library = /usr/share/my_modules/ module_utils = /usr/share/my_module_utils/ \u6a21\u5757\u5de5\u5177 \u00b6 Ansible\u63d0\u4f9b\u4e86\u8bb8\u591a\u6a21\u5757\u5b9e\u7528\u7a0b\u5e8f\uff0c\u5b83\u4eec\u63d0\u4f9b\u4e86\u5728\u5f00\u53d1\u81ea\u5df1\u7684\u6a21\u5757\u65f6\u53ef\u4ee5\u4f7f\u7528\u7684\u8f85\u52a9\u529f\u80fd\u3002 basic.py\u6a21\u5757\u4e3a\u7a0b\u5e8f\u63d0\u4f9b\u8bbf\u95eeAnsible\u5e93\u7684\u4e3b\u8981\u5165\u53e3\u70b9\uff0c\u6240\u6709Ansible\u6a21\u5757\u5fc5\u987b\u81f3\u5c11\u4ecebasic.py\u5bfc\u5165\uff1a from ansible.module_utils.basic import *","title":"Module \u5f00\u53d1\u8bf4\u660e"},{"location":"dev/modules/#_1","text":"\u6a21\u5757(\u4e5f\u79f0\u4e3atask\u63d2\u4ef6\u6216library\u63d2\u4ef6)\u662f\u53ef\u4ee5\u4ece\u547d\u4ee4\u884c\u6216playbook\u4efb\u52a1\u4e2d\u4f7f\u7528\u7684\u72ec\u7acb\u5355\u5143\u3002Ansible\u901a\u5e38\u5728\u8fdc\u7a0b\u76ee\u6807\u8282\u70b9\u4e0a\u6267\u884c\u6bcf\u4e2a\u6a21\u5757\uff0c\u5e76\u6536\u96c6\u8fd4\u56de\u503c\u3002 \u53ef\u4ee5\u4f7f\u7528\u4e0b\u5217\u547d\u4ee4\u6267\u884c\u6a21\u5757 ansible webservers -m service -a \"name=httpd state=started\" ansible webservers -m ping ansible webservers -m command -a \"/sbin/reboot -t now\" \u6bcf\u4e2a\u6a21\u5757\u90fd\u652f\u6301\u91c7\u7528\u53c2\u6570\u3002 \u51e0\u4e4e\u6240\u6709\u6a21\u5757\u90fd\u91c7\u7528key = value\u53c2\u6570\uff0c\u4ee5\u7a7a\u683c\u5206\u9694\u3002 \u4e00\u4e9b\u6a21\u5757\u4e0d\u5e26\u4efb\u4f55\u53c2\u6570\uff0c\u800ccommand/shell\u6a21\u5757\u4ec5\u91c7\u7528\u8981\u8fd0\u884c\u547d\u4ee4\u7684\u5b57\u7b26\u4e32\u3002 \u5728playbook\u4e2d\u4f7f\u7528\u6a21\u5757 - name: reboot the servers action: command /sbin/reboot -t now - name: reboot the servers command: /sbin/reboot -t now - name: restart webserver service: name: httpd state: restarted \u83b7\u53d6\u6a21\u5757\u7684\u5e2e\u52a9\u4fe1\u606f ansible-doc yum \u83b7\u53d6\u53ef\u7528\u7684\u6a21\u5757\u5217\u8868 ansible-doc -l \u66f4\u591a\u547d\u4ee4\u4ecb\u7ecd\u89c1 ansible-doc","title":"\u6a21\u5757\u4ecb\u7ecd"},{"location":"dev/modules/#_2","text":"\u5b98\u65b9\u662f\u5426\u6709\u63d0\u4f9b\u7684\u7c7b\u4f3c\u529f\u80fd\u6a21\u5757\uff1f \u53ef\u4ece\u4e0b\u9762\u4e24\u4e2a\u8fde\u63a5\u786e\u5b9a\u5b98\u65b9\u63d0\u4f9b\u7684\u6a21\u5757\uff0c\u4ee5\u514d\u91cd\u590d\u9020\u8f6e\u5b50 \u5b98\u65b9\u5df2\u53d1\u5e03\u7684\u6a21\u5757 http://docs.ansible.com/ansible/modules.html \u5b98\u65b9\u6b63\u5728\u5f00\u53d1\u7684\u6a21\u5757 https://github.com/ansible/ansible/labels/module \u4f60\u9700\u8981\u5f00\u53d1\u4e00\u4e2aaction \u63d2\u4ef6\u4e48\uff1f action\u63d2\u4ef6\u662f\u5728ansible\u4e3b\u673a\u4e0a\u8fd0\u884c\uff0c\u800c\u4e0d\u662f\u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u3002\u5bf9\u4e8e\u7c7b\u4f3cfile/copy/template\u529f\u80fd\u7684\u6a21\u5757\uff0c\u5728\u6a21\u5757\u6267\u884c\u524d\u9700\u8981\u5728ansible\u4e3b\u673a\u4e0a\u505a\u4e00\u4e9b\u64cd\u4f5c\u7684\u3002\u6709\u5173action\u63d2\u4ef6\u7684\u5f00\u53d1\u8bf7\u79fb\u6b65\u5230","title":"\u5728\u5f00\u53d1\u6a21\u5757\u4e4b\u524d\uff0c\u73b0\u95ee\u4e0b\u81ea\u5df1\u51e0\u4e2a\u95ee\u9898\uff1f"},{"location":"dev/modules/#_3","text":"\u6a21\u5757\u662f\u4f20\u9001\u5230\u76ee\u6807\u4e3b\u673a\u4e0a\u8fd0\u884c\u7684\u3002 \u6a21\u5757\u7684\u8fd4\u56de\u503c\u5fc5\u987b\u662fjson dumps\u7684\u5b57\u7b26\u4e32\u3002 \u6a21\u5757\u7684\u901a\u7528\u8fd4\u56de\u503c\u89c1 \u6a21\u5757\u8fd4\u56de\u503c","title":"\u660e\u786e\u51e0\u70b9"},{"location":"dev/modules/#_4","text":"Ansible\u81ea\u52a8\u5c06\u5728\u67d0\u4e9b\u76ee\u5f55\u4e2d\u627e\u5230\u7684\u6240\u6709\u53ef\u6267\u884c\u6587\u4ef6\u4f5c\u4e3a\u6a21\u5757\u52a0\u8f7d\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u5728\u4ee5\u4e0b\u4efb\u610f\u4f4d\u7f6e\u521b\u5efa\u6216\u6dfb\u52a0\u672c\u5730\u6a21\u5757\uff1a \u4f7f\u7528\u73af\u5883\u53d8\u91cf ANSIBLE_LIBRARY \u5b9a\u4e49\u7684\u76ee\u5f55\u5217\u8868\uff0c\u4f7f\u7528\u9017\u53f7\u5206\u9694\u3002 ~/.ansible/plugins/modules/ /usr/share/ansible/plugins/modules/ \u9488\u5bf9\u4e8eplaybook\u4f7f\u7528 \u4fdd\u5b58\u5728playbook\u5f53\u524d\u76ee\u5f55 library \u76ee\u5f55\u4e2d\u7684\u6587\u4ef6 \u9488\u5bf9\u4e8erole\u4f7f\u7528 \u4fdd\u5b58\u5728role\u76ee\u5f55\u4e0b library \u76ee\u5f55\u4e2d\u7684\u6587\u4ef6 \u4e5f\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u6a21\u5757\u76ee\u5f55 [defaults] library = /usr/share/my_modules/ module_utils = /usr/share/my_module_utils/","title":"\u672c\u5730\u6dfb\u52a0\u6a21\u5757"},{"location":"dev/modules/#_5","text":"Ansible\u63d0\u4f9b\u4e86\u8bb8\u591a\u6a21\u5757\u5b9e\u7528\u7a0b\u5e8f\uff0c\u5b83\u4eec\u63d0\u4f9b\u4e86\u5728\u5f00\u53d1\u81ea\u5df1\u7684\u6a21\u5757\u65f6\u53ef\u4ee5\u4f7f\u7528\u7684\u8f85\u52a9\u529f\u80fd\u3002 basic.py\u6a21\u5757\u4e3a\u7a0b\u5e8f\u63d0\u4f9b\u8bbf\u95eeAnsible\u5e93\u7684\u4e3b\u8981\u5165\u53e3\u70b9\uff0c\u6240\u6709Ansible\u6a21\u5757\u5fc5\u987b\u81f3\u5c11\u4ecebasic.py\u5bfc\u5165\uff1a from ansible.module_utils.basic import *","title":"\u6a21\u5757\u5de5\u5177"},{"location":"dev/modules/huawei-switch/","text":"huawei switch \u6a21\u5757 \u00b6 \u9700\u6c42 \u00b6 \u8fdc\u7a0b\u5728switch\u4e0a\u6267\u884c\u547d\u4ee4 \u5b9e\u73b0\u60f3\u6cd5 \u00b6 \u4f7f\u7528ssh\u8fde\u63a5\u5230switch\u4e0a\uff0c\u8fdc\u7a0b\u8f93\u5165\u547d\u4ee4\u5230switch\uff0c\u83b7\u53d6\u8fd4\u56de\u7ed3\u679c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 \u534e\u4e3a\u7684s5700\u4ea4\u6362\u673a \u6ca1\u6709\u5b9e\u4f53\u673a\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528ensp\uff0c\u4e0b\u56fe\u662f\u6211\u7684\u6d4b\u8bd5\u73af\u5883 \u4ea4\u6362\u673a\u5f00\u542fssh\u8fde\u63a5 \u00b6 s5700 <Huawei>system-view [ Huawei ] rsa local-key-pair create The key name will be: Huawei_Host % RSA keys defined for Huawei_Host already exist. Confirm to replace them? [ y/n ] :y The range of public key size is ( 512 ~ 2048 ) . NOTES: If the key modulus is greater than 512 , it will take a few minutes. Input the bits in the modulus [ default = 512 ] :2048 Generating keys... ..........+++ .....................................................................+++ ..............++++++++ .............++++++++ [ Huawei ] user-interface vty 0 4 [ Huawei-ui-vty0-4 ] authentication-mode aaa [ Huawei-ui-vty0-4 ] protocol inbound ssh [ Huawei-ui-vty0-4 ] quit [ Huawei ] aaa [ Huawei-aaa ] local-user user1 password cipher Huawei@123 [ Huawei-aaa ] local-user user1 service-type ssh [ Huawei-aaa ] quit [ Huawei ] ssh user user1 authentication-type password Info: Succeeded in adding a new SSH user. [ Huawei ] ssh user user1 service-type stelnet [ Huawei ] stelnet server enable Info: Succeeded in starting the Stelnet server. \u5c31\u53ef\u4ee5\u4f7f\u7528ssh\u65b9\u5f0f\u8fde\u63a5\u4ea4\u6362\u673a\u4e86\u3002 modules \u00b6 \u5148\u4f7f\u7528\u4f2a\u4ee3\u7801\u5b9a\u4e49Hwcon\u7c7b\u4ee5\u53ca\u65b9\u6cd5 class Hwcon ( object ): def __init__ ( self , address , username , password , port = 22 ): # \u521d\u59cb\u5316ssh\u8fde\u63a5 def close ( self ): # \u5173\u95ed\u8fde\u63a5 def openShell ( self ): # \u5728ssh\u8fde\u63a5\u4e2d\u6253\u5f00\u4e00\u4e2aterminal def send_command ( self , command = '' ): # \u5411terminal\u53d1\u9001\u547d\u4ee4 def get_command_result ( self , cmd ): # \u83b7\u53d6\u547d\u4ee4\u7684\u8f93\u51fa\u7ed3\u679c def parse_result_data ( self , data ): # \u89e3\u6790\u547d\u4ee4\u7684\u8f93\u51fa\u7ed3\u679c def save_config ( self ): # \u4fdd\u5b58\u914d\u7f6e def run ( self , cmd ): # \u6267\u884c\u547d\u4ee4 \u4f7f\u7528\u65b9\u6cd5\uff1a connection = Hwcon ( b_host , b_user , b_password , module . params [ 'sport' ]) connection . openShell () rc , stdout , stderr = connection . run ( b_command ) connection . save_config () connection . close () \u5c31\u53ef\u5b8c\u6210\u6211\u4eec\u6267\u884c\u547d\u4ee4\u7684\u529f\u80fd\uff0c\u5f53\u7136\u8fd9\u53ea\u662f\u4f2a\u4ee3\u7801\uff0c\u4e0b\u9762\u6211\u4eec\u5f00\u59cb\u586b\u5145\u91cc\u9762\u7684\u529f\u80fd\u4ee3\u7801\u3002 \u6846\u67b6\u6211\u4eec\u5b9a\u4e49\u597d\u4e86\uff0c\u4e0b\u9762\u5b9a\u4e49\u547d\u4ee4\u7684\u9519\u8bef\uff0c\u6b63\u786e\u8f93\u51fa\u4fe1\u606f\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u4ee5\u4fbf\u6211\u4eec\u80fd\u786e\u8ba4\u547d\u4ee4\u8f93\u51fa\u7ed3\u679c\u662f\u5426\u6b63\u786e\u3002 terminal_stdout_re = [ re . compile ( r '[\\r\\n]?<.+>(?:\\s*)$' ), re . compile ( r '[\\r\\n]?\\[.+\\](?:\\s*)$' ), ] terminal_stderr_re = [ re . compile ( r \"% ?Error: \" ), re . compile ( r \"^% \\w+\" , re . M ), re . compile ( r \"% ?Bad secret\" ), re . compile ( r \"invalid input\" , re . I ), re . compile ( r \"(?:incomplete|ambiguous) command\" , re . I ), re . compile ( r \"connection timed out\" , re . I ), re . compile ( r \"[^\\r\\n]+ not found\" , re . I ), re . compile ( r \"'[^']' +returned error code: ?\\d+\" ), re . compile ( r \"syntax error\" ), re . compile ( r \"unknown command\" ), re . compile ( r \"Error\\[\\d+\\]: \" , re . I ), re . compile ( r \"Error:\" , re . I ) ] \u5bfc\u5165\u6211\u4eec\u9700\u8981\u7684\u5e93 import time import re from ansible.module_utils.basic import AnsibleModule from ansible.module_utils._text import to_bytes from ansible.errors import AnsibleError , AnsibleConnectionFailure try : import paramiko except ImportError : raise AnsibleError ( \"paramiko is not installed, please use pip install paramiko\" ) try : from __main__ import display except ImportError : from ansible.utils.display import Display display = Display () \u586b\u5145\u6211\u4eec\u7684hwcon\u7c7b class Hwcon ( object ): shell = None client = None def __init__ ( self , address , username , password , port = 22 ): display . vv ( \"Connecting to network device on ip\" , str ( address ) + \".\" ) self . client = paramiko . client . SSHClient () self . client . set_missing_host_key_policy ( paramiko . client . AutoAddPolicy ()) self . client . connect ( address , port = port , username = username , password = password , look_for_keys = False , allow_agent = False ) def close ( self ): if self . client is not None : self . client . close () def openShell ( self ): self . shell = self . client . invoke_shell () def send_command ( self , command = '' ): if self . shell : if command not in ( '?' ,): command += \" \\n \" self . shell . send ( command ) while True : if self . shell . recv_ready () or self . shell . recv_stderr_ready (): break time . sleep ( 0.1 ) def get_command_result ( self , cmd ): buffersize = 4096 self . send_command () self . shell . recv ( buffersize ) self . send_command ( cmd ) stdout = self . shell . recv ( buffersize ) b_data = stdout . split ( ' \\r\\n ' ) result_tmp = '' while '- More -' in b_data [ - 1 ]: self . shell . send ( \" \\n \" ) time . sleep ( 0.1 ) tmp = self . shell . recv ( buffersize ) b_data = tmp . split ( ' \\r\\n ' ) result_tmp += tmp if self . shell . recv_stderr_ready (): stderr = self . shell . recv_stderr ( buffersize ) else : stderr = '' stdout = ' \\r\\n ' . join ( stdout . split ( ' \\r\\n ' )[: - 1 ]) + ' \\n ' + result_tmp stdout = stdout . replace ( ' - More -' , '' ) . replace ( ' \\x1b [42D \\x1b [42D' , '' ) return stdout , stderr def parse_result_data ( self , data ): b_data = data . split ( ' \\r\\n ' ) result = b_data [ 1 : - 1 ] return ' \\r\\n ' . join ( result ) def save_config ( self ): rc = 1 buffersize = 4096 self . send_command () stdout = self . shell . recv ( buffersize ) t1 = terminal_stdout_re [ 0 ] . findall ( stdout ) while not t1 : self . send_command ( 'quit' ) stdout = self . shell . recv ( buffersize ) t1 = terminal_stdout_re [ 0 ] . findall ( stdout ) self . send_command ( 'save' ) time . sleep ( 0.1 ) self . send_command ( 'y' ) time . sleep ( 3 ) stdout = self . shell . recv ( buffersize ) if stdout . find ( 'successfully' ): rc = 0 return rc def run ( self , cmd ): rc = 1 stdout , stderr = self . get_command_result ( cmd ) for regex in terminal_stderr_re : r1 = regex . findall ( stdout ) if not r1 : stdout = self . parse_result_data ( stdout ) rc = 0 return rc , stdout , stderr \u628a\u4f7f\u7528\u65b9\u6cd5\u586b\u5165main\u65b9\u6cd5\u4e2d def main (): module = AnsibleModule ( argument_spec = dict ( command = dict ( required = True , type = 'str' ), shost = dict ( required = True , type = 'str' ), sport = dict ( required = False , type = 'int' , default = 22 ), suser = dict ( required = True , type = 'str' ), spass = dict ( required = True , type = 'str' , no_log = True ), save = dict ( required = False , type = 'bool' ) ), supports_check_mode = True ) b_command = to_bytes ( module . params [ 'command' ], errors = 'surrogate_or_strict' ) b_host = to_bytes ( module . params [ 'shost' ], errors = 'surrogate_or_strict' ) b_user = to_bytes ( module . params [ 'suser' ], errors = 'surrogate_or_strict' ) b_password = to_bytes ( module . params [ 'spass' ], errors = 'surrogate_or_strict' ) result = { 'changed' : False } try : connection = Hwcon ( b_host , b_user , b_password , module . params [ 'sport' ]) except Exception as e : raise AnsibleConnectionFailure ( str ( e )) try : connection . openShell () except Exception as e : msg = \"Failed to open session\" if len ( str ( e )) > 0 : msg += \": %s \" % str ( e ) raise AnsibleConnectionFailure ( msg ) display . vvv ( \"EXEC %s \" % b_command , host = b_host ) try : rc , stdout , stderr = connection . run ( b_command ) except Exception as e : raise AnsibleError ( 'Exec command error. \\n ' + str ( e ) ) if rc == 0 and b_command . find ( 'display' ): result [ 'changed' ] = True elif rc == 1 : module . fail_json ( msg = stdout + stderr ) if module . params [ 'save' ]: try : save_rc = connection . save_config () except Exception as e : raise AnsibleError ( 'Save config error. \\n ' + str ( e ) ) if save_rc != 0 : msg = \"not save config!\" module . fail_json ( msg = msg ) connection . close () result . update ({ 'command' : b_command , 'rc' : rc , 'stdout' : stdout , 'stderr' : stderr }) module . exit_json ( ** result ) if __name__ == '__main__' : main () \u6dfb\u52a0\u5b8c\u63cf\u8ff0\u4fe1\u606f\uff0c\u5b8c\u6574\u7684\u4ee3\u7801\u5982\u4e0b #!/usr/bin/python ANSIBLE_METADATA = { 'status' : [ 'preview' ], 'supported_by' : 'community' , 'metadata_version' : '1.0' } DOCUMENTATION = ''' module: hwos_command version_added: \"2.3\" short_description: Run arbitrary command on HUAWEI network devices. description: - Run arbitrary command on HUAWEI network devices. options: command: description: - HUAWEI network devices command required: true shost: description: - remote network devices ip address required: true sport: description: - remote network devices ssh port required: false default: 22 suser: description: - remote network devices ssh user required: true spass: description: - remote network devices ssh user password required: true save: description: - save current configuration required: false default: no author: - \"Lework\" ''' EXAMPLES = \"\"\" - hosts: localhost gather_facts: no connection: local vars: sport: 22 suser: \"user1\" spass: \"test\" shost: \"192.168.77.140\" tasks: - name: display version hwos_command: sport: \"{{ sport }}\" shost: \"{{ shost }}\" suser: \"{{ suser }}\" spass: \"{{ spass }}\" command: display version - name: add vlan 800 and int 0/0/11 hwos_command: sport: \"{{ sport }}\" shost: \"{{ shost }}\" suser: \"{{ suser }}\" spass: \"{{ spass }}\" save: true command: | system-view vlan 800 quit interface GigabitEthernet 0/0/12 port link-type access vlan 800 port GigabitEthernet 0/0/12 \"\"\" RETUN = \"\"\" stdout: description: the set of responses from the commands returned: always type: list sample: ['...', '...'] stdout_lines: description: The value of stdout split into a list returned: always type: list sample: [['...', '...'], ['...'], ['...']] command: description: rum command returned: always type: str sample: display version \"\"\" import time import re from ansible.module_utils.basic import AnsibleModule from ansible.module_utils._text import to_bytes from ansible.errors import AnsibleError , AnsibleConnectionFailure try : import paramiko except ImportError : raise AnsibleError ( \"paramiko is not installed, please use pip install paramiko\" ) try : from __main__ import display except ImportError : from ansible.utils.display import Display display = Display () terminal_stdout_re = [ re . compile ( r '[\\r\\n]?<.+>(?:\\s*)$' ), re . compile ( r '[\\r\\n]?\\[.+\\](?:\\s*)$' ), ] terminal_stderr_re = [ re . compile ( r \"% ?Error: \" ), re . compile ( r \"^% \\w+\" , re . M ), re . compile ( r \"% ?Bad secret\" ), re . compile ( r \"invalid input\" , re . I ), re . compile ( r \"(?:incomplete|ambiguous) command\" , re . I ), re . compile ( r \"connection timed out\" , re . I ), re . compile ( r \"[^\\r\\n]+ not found\" , re . I ), re . compile ( r \"'[^']' +returned error code: ?\\d+\" ), re . compile ( r \"syntax error\" ), re . compile ( r \"unknown command\" ), re . compile ( r \"Error\\[\\d+\\]: \" , re . I ), re . compile ( r \"Error:\" , re . I ) ] class Hwcon ( object ): shell = None client = None def __init__ ( self , address , username , password , port = 22 ): display . vv ( \"Connecting to network device on ip\" , str ( address ) + \".\" ) self . client = paramiko . client . SSHClient () self . client . set_missing_host_key_policy ( paramiko . client . AutoAddPolicy ()) self . client . connect ( address , port = port , username = username , password = password , look_for_keys = False , allow_agent = False ) def close ( self ): if self . client is not None : self . client . close () def openShell ( self ): self . shell = self . client . invoke_shell () def send_command ( self , command = '' ): if self . shell : if command not in ( '?' ,): command += \" \\n \" self . shell . send ( command ) while True : if self . shell . recv_ready () or self . shell . recv_stderr_ready (): break time . sleep ( 0.1 ) def get_command_result ( self , cmd ): buffersize = 4096 self . send_command () self . shell . recv ( buffersize ) self . send_command ( cmd ) stdout = self . shell . recv ( buffersize ) b_data = stdout . split ( ' \\r\\n ' ) result_tmp = '' while '- More -' in b_data [ - 1 ]: self . shell . send ( \" \\n \" ) time . sleep ( 0.1 ) tmp = self . shell . recv ( buffersize ) b_data = tmp . split ( ' \\r\\n ' ) result_tmp += tmp if self . shell . recv_stderr_ready (): stderr = self . shell . recv_stderr ( buffersize ) else : stderr = '' stdout = ' \\r\\n ' . join ( stdout . split ( ' \\r\\n ' )[: - 1 ]) + ' \\n ' + result_tmp stdout = stdout . replace ( ' - More -' , '' ) . replace ( ' \\x1b [42D \\x1b [42D' , '' ) return stdout , stderr def parse_result_data ( self , data ): b_data = data . split ( ' \\r\\n ' ) result = b_data [ 1 : - 1 ] return ' \\r\\n ' . join ( result ) def save_config ( self ): rc = 1 buffersize = 4096 self . send_command () stdout = self . shell . recv ( buffersize ) t1 = terminal_stdout_re [ 0 ] . findall ( stdout ) while not t1 : self . send_command ( 'quit' ) stdout = self . shell . recv ( buffersize ) t1 = terminal_stdout_re [ 0 ] . findall ( stdout ) self . send_command ( 'save' ) time . sleep ( 0.1 ) self . send_command ( 'y' ) time . sleep ( 3 ) stdout = self . shell . recv ( buffersize ) if stdout . find ( 'successfully' ): rc = 0 return rc def run ( self , cmd ): rc = 1 stdout , stderr = self . get_command_result ( cmd ) for regex in terminal_stderr_re : r1 = regex . findall ( stdout ) if not r1 : stdout = self . parse_result_data ( stdout ) rc = 0 return rc , stdout , stderr def main (): module = AnsibleModule ( argument_spec = dict ( command = dict ( required = True , type = 'str' ), shost = dict ( required = True , type = 'str' ), sport = dict ( required = False , type = 'int' , default = 22 ), suser = dict ( required = True , type = 'str' ), spass = dict ( required = True , type = 'str' , no_log = True ), save = dict ( required = False , type = 'bool' ) ), supports_check_mode = True ) b_command = to_bytes ( module . params [ 'command' ], errors = 'surrogate_or_strict' ) b_host = to_bytes ( module . params [ 'shost' ], errors = 'surrogate_or_strict' ) b_user = to_bytes ( module . params [ 'suser' ], errors = 'surrogate_or_strict' ) b_password = to_bytes ( module . params [ 'spass' ], errors = 'surrogate_or_strict' ) result = { 'changed' : False } try : connection = Hwcon ( b_host , b_user , b_password , module . params [ 'sport' ]) except Exception as e : raise AnsibleConnectionFailure ( str ( e )) try : connection . openShell () except Exception as e : msg = \"Failed to open session\" if len ( str ( e )) > 0 : msg += \": %s \" % str ( e ) raise AnsibleConnectionFailure ( msg ) display . vvv ( \"EXEC %s \" % b_command , host = b_host ) try : rc , stdout , stderr = connection . run ( b_command ) except Exception as e : raise AnsibleError ( 'Exec command error. \\n ' + str ( e ) ) if rc == 0 and b_command . find ( 'display' ): result [ 'changed' ] = True elif rc == 1 : module . fail_json ( msg = stdout + stderr ) if module . params [ 'save' ]: try : save_rc = connection . save_config () except Exception as e : raise AnsibleError ( 'Save config error. \\n ' + str ( e ) ) if save_rc != 0 : msg = \"not save config!\" module . fail_json ( msg = msg ) connection . close () result . update ({ 'command' : b_command , 'rc' : rc , 'stdout' : stdout , 'stderr' : stderr }) module . exit_json ( ** result ) if __name__ == '__main__' : main () \u6267\u884c\u6a21\u5757 \u00b6 \u4f7f\u7528playbook - hosts: localhost gather_facts: no vars: sport: 22 suser: \"user1\" spass: \"Huawei@123\" shost: \"192.168.77.140\" tasks: - name: display version hwos_command: sport: \"{{ sport }}\" shost: \"{{ shost }}\" suser: \"{{ suser }}\" spass: \"{{ spass }}\" command: display version - name: display vlan 900 hwos_command: sport: \"{{ sport }}\" shost: \"{{ shost }}\" suser: \"{{ suser }}\" spass: \"{{ spass }}\" command: display vlan 900 ignore_errors: true register: result - debug: msg={{result.stdout_lines | d()}} - name: add vlan 900 and int 0/0/13 hwos_command: sport: \"{{ sport }}\" shost: \"{{ shost }}\" suser: \"{{ suser }}\" spass: \"{{ spass }}\" save: true command: | system-view vlan 900 quit interface GigabitEthernet 0/0/13 port link-type access vlan 900 port GigabitEthernet 0/0/13 - name: display vlan 900 hwos_command: sport: \"{{ sport }}\" shost: \"{{ shost }}\" suser: \"{{ suser }}\" spass: \"{{ spass }}\" command: display vlan 900 register: result - debug: msg={{result.stdout_lines}}","title":"module \u793a\u4f8b: \u8fde\u63a5\u534e\u4e3a\u4ea4\u6362\u673a"},{"location":"dev/modules/huawei-switch/#huawei-switch","text":"","title":"huawei switch \u6a21\u5757"},{"location":"dev/modules/huawei-switch/#_1","text":"\u8fdc\u7a0b\u5728switch\u4e0a\u6267\u884c\u547d\u4ee4","title":"\u9700\u6c42"},{"location":"dev/modules/huawei-switch/#_2","text":"\u4f7f\u7528ssh\u8fde\u63a5\u5230switch\u4e0a\uff0c\u8fdc\u7a0b\u8f93\u5165\u547d\u4ee4\u5230switch\uff0c\u83b7\u53d6\u8fd4\u56de\u7ed3\u679c\u3002","title":"\u5b9e\u73b0\u60f3\u6cd5"},{"location":"dev/modules/huawei-switch/#_3","text":"\u534e\u4e3a\u7684s5700\u4ea4\u6362\u673a \u6ca1\u6709\u5b9e\u4f53\u673a\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528ensp\uff0c\u4e0b\u56fe\u662f\u6211\u7684\u6d4b\u8bd5\u73af\u5883","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"dev/modules/huawei-switch/#ssh","text":"s5700 <Huawei>system-view [ Huawei ] rsa local-key-pair create The key name will be: Huawei_Host % RSA keys defined for Huawei_Host already exist. Confirm to replace them? [ y/n ] :y The range of public key size is ( 512 ~ 2048 ) . NOTES: If the key modulus is greater than 512 , it will take a few minutes. Input the bits in the modulus [ default = 512 ] :2048 Generating keys... ..........+++ .....................................................................+++ ..............++++++++ .............++++++++ [ Huawei ] user-interface vty 0 4 [ Huawei-ui-vty0-4 ] authentication-mode aaa [ Huawei-ui-vty0-4 ] protocol inbound ssh [ Huawei-ui-vty0-4 ] quit [ Huawei ] aaa [ Huawei-aaa ] local-user user1 password cipher Huawei@123 [ Huawei-aaa ] local-user user1 service-type ssh [ Huawei-aaa ] quit [ Huawei ] ssh user user1 authentication-type password Info: Succeeded in adding a new SSH user. [ Huawei ] ssh user user1 service-type stelnet [ Huawei ] stelnet server enable Info: Succeeded in starting the Stelnet server. \u5c31\u53ef\u4ee5\u4f7f\u7528ssh\u65b9\u5f0f\u8fde\u63a5\u4ea4\u6362\u673a\u4e86\u3002","title":"\u4ea4\u6362\u673a\u5f00\u542fssh\u8fde\u63a5"},{"location":"dev/modules/huawei-switch/#modules","text":"\u5148\u4f7f\u7528\u4f2a\u4ee3\u7801\u5b9a\u4e49Hwcon\u7c7b\u4ee5\u53ca\u65b9\u6cd5 class Hwcon ( object ): def __init__ ( self , address , username , password , port = 22 ): # \u521d\u59cb\u5316ssh\u8fde\u63a5 def close ( self ): # \u5173\u95ed\u8fde\u63a5 def openShell ( self ): # \u5728ssh\u8fde\u63a5\u4e2d\u6253\u5f00\u4e00\u4e2aterminal def send_command ( self , command = '' ): # \u5411terminal\u53d1\u9001\u547d\u4ee4 def get_command_result ( self , cmd ): # \u83b7\u53d6\u547d\u4ee4\u7684\u8f93\u51fa\u7ed3\u679c def parse_result_data ( self , data ): # \u89e3\u6790\u547d\u4ee4\u7684\u8f93\u51fa\u7ed3\u679c def save_config ( self ): # \u4fdd\u5b58\u914d\u7f6e def run ( self , cmd ): # \u6267\u884c\u547d\u4ee4 \u4f7f\u7528\u65b9\u6cd5\uff1a connection = Hwcon ( b_host , b_user , b_password , module . params [ 'sport' ]) connection . openShell () rc , stdout , stderr = connection . run ( b_command ) connection . save_config () connection . close () \u5c31\u53ef\u5b8c\u6210\u6211\u4eec\u6267\u884c\u547d\u4ee4\u7684\u529f\u80fd\uff0c\u5f53\u7136\u8fd9\u53ea\u662f\u4f2a\u4ee3\u7801\uff0c\u4e0b\u9762\u6211\u4eec\u5f00\u59cb\u586b\u5145\u91cc\u9762\u7684\u529f\u80fd\u4ee3\u7801\u3002 \u6846\u67b6\u6211\u4eec\u5b9a\u4e49\u597d\u4e86\uff0c\u4e0b\u9762\u5b9a\u4e49\u547d\u4ee4\u7684\u9519\u8bef\uff0c\u6b63\u786e\u8f93\u51fa\u4fe1\u606f\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u4ee5\u4fbf\u6211\u4eec\u80fd\u786e\u8ba4\u547d\u4ee4\u8f93\u51fa\u7ed3\u679c\u662f\u5426\u6b63\u786e\u3002 terminal_stdout_re = [ re . compile ( r '[\\r\\n]?<.+>(?:\\s*)$' ), re . compile ( r '[\\r\\n]?\\[.+\\](?:\\s*)$' ), ] terminal_stderr_re = [ re . compile ( r \"% ?Error: \" ), re . compile ( r \"^% \\w+\" , re . M ), re . compile ( r \"% ?Bad secret\" ), re . compile ( r \"invalid input\" , re . I ), re . compile ( r \"(?:incomplete|ambiguous) command\" , re . I ), re . compile ( r \"connection timed out\" , re . I ), re . compile ( r \"[^\\r\\n]+ not found\" , re . I ), re . compile ( r \"'[^']' +returned error code: ?\\d+\" ), re . compile ( r \"syntax error\" ), re . compile ( r \"unknown command\" ), re . compile ( r \"Error\\[\\d+\\]: \" , re . I ), re . compile ( r \"Error:\" , re . I ) ] \u5bfc\u5165\u6211\u4eec\u9700\u8981\u7684\u5e93 import time import re from ansible.module_utils.basic import AnsibleModule from ansible.module_utils._text import to_bytes from ansible.errors import AnsibleError , AnsibleConnectionFailure try : import paramiko except ImportError : raise AnsibleError ( \"paramiko is not installed, please use pip install paramiko\" ) try : from __main__ import display except ImportError : from ansible.utils.display import Display display = Display () \u586b\u5145\u6211\u4eec\u7684hwcon\u7c7b class Hwcon ( object ): shell = None client = None def __init__ ( self , address , username , password , port = 22 ): display . vv ( \"Connecting to network device on ip\" , str ( address ) + \".\" ) self . client = paramiko . client . SSHClient () self . client . set_missing_host_key_policy ( paramiko . client . AutoAddPolicy ()) self . client . connect ( address , port = port , username = username , password = password , look_for_keys = False , allow_agent = False ) def close ( self ): if self . client is not None : self . client . close () def openShell ( self ): self . shell = self . client . invoke_shell () def send_command ( self , command = '' ): if self . shell : if command not in ( '?' ,): command += \" \\n \" self . shell . send ( command ) while True : if self . shell . recv_ready () or self . shell . recv_stderr_ready (): break time . sleep ( 0.1 ) def get_command_result ( self , cmd ): buffersize = 4096 self . send_command () self . shell . recv ( buffersize ) self . send_command ( cmd ) stdout = self . shell . recv ( buffersize ) b_data = stdout . split ( ' \\r\\n ' ) result_tmp = '' while '- More -' in b_data [ - 1 ]: self . shell . send ( \" \\n \" ) time . sleep ( 0.1 ) tmp = self . shell . recv ( buffersize ) b_data = tmp . split ( ' \\r\\n ' ) result_tmp += tmp if self . shell . recv_stderr_ready (): stderr = self . shell . recv_stderr ( buffersize ) else : stderr = '' stdout = ' \\r\\n ' . join ( stdout . split ( ' \\r\\n ' )[: - 1 ]) + ' \\n ' + result_tmp stdout = stdout . replace ( ' - More -' , '' ) . replace ( ' \\x1b [42D \\x1b [42D' , '' ) return stdout , stderr def parse_result_data ( self , data ): b_data = data . split ( ' \\r\\n ' ) result = b_data [ 1 : - 1 ] return ' \\r\\n ' . join ( result ) def save_config ( self ): rc = 1 buffersize = 4096 self . send_command () stdout = self . shell . recv ( buffersize ) t1 = terminal_stdout_re [ 0 ] . findall ( stdout ) while not t1 : self . send_command ( 'quit' ) stdout = self . shell . recv ( buffersize ) t1 = terminal_stdout_re [ 0 ] . findall ( stdout ) self . send_command ( 'save' ) time . sleep ( 0.1 ) self . send_command ( 'y' ) time . sleep ( 3 ) stdout = self . shell . recv ( buffersize ) if stdout . find ( 'successfully' ): rc = 0 return rc def run ( self , cmd ): rc = 1 stdout , stderr = self . get_command_result ( cmd ) for regex in terminal_stderr_re : r1 = regex . findall ( stdout ) if not r1 : stdout = self . parse_result_data ( stdout ) rc = 0 return rc , stdout , stderr \u628a\u4f7f\u7528\u65b9\u6cd5\u586b\u5165main\u65b9\u6cd5\u4e2d def main (): module = AnsibleModule ( argument_spec = dict ( command = dict ( required = True , type = 'str' ), shost = dict ( required = True , type = 'str' ), sport = dict ( required = False , type = 'int' , default = 22 ), suser = dict ( required = True , type = 'str' ), spass = dict ( required = True , type = 'str' , no_log = True ), save = dict ( required = False , type = 'bool' ) ), supports_check_mode = True ) b_command = to_bytes ( module . params [ 'command' ], errors = 'surrogate_or_strict' ) b_host = to_bytes ( module . params [ 'shost' ], errors = 'surrogate_or_strict' ) b_user = to_bytes ( module . params [ 'suser' ], errors = 'surrogate_or_strict' ) b_password = to_bytes ( module . params [ 'spass' ], errors = 'surrogate_or_strict' ) result = { 'changed' : False } try : connection = Hwcon ( b_host , b_user , b_password , module . params [ 'sport' ]) except Exception as e : raise AnsibleConnectionFailure ( str ( e )) try : connection . openShell () except Exception as e : msg = \"Failed to open session\" if len ( str ( e )) > 0 : msg += \": %s \" % str ( e ) raise AnsibleConnectionFailure ( msg ) display . vvv ( \"EXEC %s \" % b_command , host = b_host ) try : rc , stdout , stderr = connection . run ( b_command ) except Exception as e : raise AnsibleError ( 'Exec command error. \\n ' + str ( e ) ) if rc == 0 and b_command . find ( 'display' ): result [ 'changed' ] = True elif rc == 1 : module . fail_json ( msg = stdout + stderr ) if module . params [ 'save' ]: try : save_rc = connection . save_config () except Exception as e : raise AnsibleError ( 'Save config error. \\n ' + str ( e ) ) if save_rc != 0 : msg = \"not save config!\" module . fail_json ( msg = msg ) connection . close () result . update ({ 'command' : b_command , 'rc' : rc , 'stdout' : stdout , 'stderr' : stderr }) module . exit_json ( ** result ) if __name__ == '__main__' : main () \u6dfb\u52a0\u5b8c\u63cf\u8ff0\u4fe1\u606f\uff0c\u5b8c\u6574\u7684\u4ee3\u7801\u5982\u4e0b #!/usr/bin/python ANSIBLE_METADATA = { 'status' : [ 'preview' ], 'supported_by' : 'community' , 'metadata_version' : '1.0' } DOCUMENTATION = ''' module: hwos_command version_added: \"2.3\" short_description: Run arbitrary command on HUAWEI network devices. description: - Run arbitrary command on HUAWEI network devices. options: command: description: - HUAWEI network devices command required: true shost: description: - remote network devices ip address required: true sport: description: - remote network devices ssh port required: false default: 22 suser: description: - remote network devices ssh user required: true spass: description: - remote network devices ssh user password required: true save: description: - save current configuration required: false default: no author: - \"Lework\" ''' EXAMPLES = \"\"\" - hosts: localhost gather_facts: no connection: local vars: sport: 22 suser: \"user1\" spass: \"test\" shost: \"192.168.77.140\" tasks: - name: display version hwos_command: sport: \"{{ sport }}\" shost: \"{{ shost }}\" suser: \"{{ suser }}\" spass: \"{{ spass }}\" command: display version - name: add vlan 800 and int 0/0/11 hwos_command: sport: \"{{ sport }}\" shost: \"{{ shost }}\" suser: \"{{ suser }}\" spass: \"{{ spass }}\" save: true command: | system-view vlan 800 quit interface GigabitEthernet 0/0/12 port link-type access vlan 800 port GigabitEthernet 0/0/12 \"\"\" RETUN = \"\"\" stdout: description: the set of responses from the commands returned: always type: list sample: ['...', '...'] stdout_lines: description: The value of stdout split into a list returned: always type: list sample: [['...', '...'], ['...'], ['...']] command: description: rum command returned: always type: str sample: display version \"\"\" import time import re from ansible.module_utils.basic import AnsibleModule from ansible.module_utils._text import to_bytes from ansible.errors import AnsibleError , AnsibleConnectionFailure try : import paramiko except ImportError : raise AnsibleError ( \"paramiko is not installed, please use pip install paramiko\" ) try : from __main__ import display except ImportError : from ansible.utils.display import Display display = Display () terminal_stdout_re = [ re . compile ( r '[\\r\\n]?<.+>(?:\\s*)$' ), re . compile ( r '[\\r\\n]?\\[.+\\](?:\\s*)$' ), ] terminal_stderr_re = [ re . compile ( r \"% ?Error: \" ), re . compile ( r \"^% \\w+\" , re . M ), re . compile ( r \"% ?Bad secret\" ), re . compile ( r \"invalid input\" , re . I ), re . compile ( r \"(?:incomplete|ambiguous) command\" , re . I ), re . compile ( r \"connection timed out\" , re . I ), re . compile ( r \"[^\\r\\n]+ not found\" , re . I ), re . compile ( r \"'[^']' +returned error code: ?\\d+\" ), re . compile ( r \"syntax error\" ), re . compile ( r \"unknown command\" ), re . compile ( r \"Error\\[\\d+\\]: \" , re . I ), re . compile ( r \"Error:\" , re . I ) ] class Hwcon ( object ): shell = None client = None def __init__ ( self , address , username , password , port = 22 ): display . vv ( \"Connecting to network device on ip\" , str ( address ) + \".\" ) self . client = paramiko . client . SSHClient () self . client . set_missing_host_key_policy ( paramiko . client . AutoAddPolicy ()) self . client . connect ( address , port = port , username = username , password = password , look_for_keys = False , allow_agent = False ) def close ( self ): if self . client is not None : self . client . close () def openShell ( self ): self . shell = self . client . invoke_shell () def send_command ( self , command = '' ): if self . shell : if command not in ( '?' ,): command += \" \\n \" self . shell . send ( command ) while True : if self . shell . recv_ready () or self . shell . recv_stderr_ready (): break time . sleep ( 0.1 ) def get_command_result ( self , cmd ): buffersize = 4096 self . send_command () self . shell . recv ( buffersize ) self . send_command ( cmd ) stdout = self . shell . recv ( buffersize ) b_data = stdout . split ( ' \\r\\n ' ) result_tmp = '' while '- More -' in b_data [ - 1 ]: self . shell . send ( \" \\n \" ) time . sleep ( 0.1 ) tmp = self . shell . recv ( buffersize ) b_data = tmp . split ( ' \\r\\n ' ) result_tmp += tmp if self . shell . recv_stderr_ready (): stderr = self . shell . recv_stderr ( buffersize ) else : stderr = '' stdout = ' \\r\\n ' . join ( stdout . split ( ' \\r\\n ' )[: - 1 ]) + ' \\n ' + result_tmp stdout = stdout . replace ( ' - More -' , '' ) . replace ( ' \\x1b [42D \\x1b [42D' , '' ) return stdout , stderr def parse_result_data ( self , data ): b_data = data . split ( ' \\r\\n ' ) result = b_data [ 1 : - 1 ] return ' \\r\\n ' . join ( result ) def save_config ( self ): rc = 1 buffersize = 4096 self . send_command () stdout = self . shell . recv ( buffersize ) t1 = terminal_stdout_re [ 0 ] . findall ( stdout ) while not t1 : self . send_command ( 'quit' ) stdout = self . shell . recv ( buffersize ) t1 = terminal_stdout_re [ 0 ] . findall ( stdout ) self . send_command ( 'save' ) time . sleep ( 0.1 ) self . send_command ( 'y' ) time . sleep ( 3 ) stdout = self . shell . recv ( buffersize ) if stdout . find ( 'successfully' ): rc = 0 return rc def run ( self , cmd ): rc = 1 stdout , stderr = self . get_command_result ( cmd ) for regex in terminal_stderr_re : r1 = regex . findall ( stdout ) if not r1 : stdout = self . parse_result_data ( stdout ) rc = 0 return rc , stdout , stderr def main (): module = AnsibleModule ( argument_spec = dict ( command = dict ( required = True , type = 'str' ), shost = dict ( required = True , type = 'str' ), sport = dict ( required = False , type = 'int' , default = 22 ), suser = dict ( required = True , type = 'str' ), spass = dict ( required = True , type = 'str' , no_log = True ), save = dict ( required = False , type = 'bool' ) ), supports_check_mode = True ) b_command = to_bytes ( module . params [ 'command' ], errors = 'surrogate_or_strict' ) b_host = to_bytes ( module . params [ 'shost' ], errors = 'surrogate_or_strict' ) b_user = to_bytes ( module . params [ 'suser' ], errors = 'surrogate_or_strict' ) b_password = to_bytes ( module . params [ 'spass' ], errors = 'surrogate_or_strict' ) result = { 'changed' : False } try : connection = Hwcon ( b_host , b_user , b_password , module . params [ 'sport' ]) except Exception as e : raise AnsibleConnectionFailure ( str ( e )) try : connection . openShell () except Exception as e : msg = \"Failed to open session\" if len ( str ( e )) > 0 : msg += \": %s \" % str ( e ) raise AnsibleConnectionFailure ( msg ) display . vvv ( \"EXEC %s \" % b_command , host = b_host ) try : rc , stdout , stderr = connection . run ( b_command ) except Exception as e : raise AnsibleError ( 'Exec command error. \\n ' + str ( e ) ) if rc == 0 and b_command . find ( 'display' ): result [ 'changed' ] = True elif rc == 1 : module . fail_json ( msg = stdout + stderr ) if module . params [ 'save' ]: try : save_rc = connection . save_config () except Exception as e : raise AnsibleError ( 'Save config error. \\n ' + str ( e ) ) if save_rc != 0 : msg = \"not save config!\" module . fail_json ( msg = msg ) connection . close () result . update ({ 'command' : b_command , 'rc' : rc , 'stdout' : stdout , 'stderr' : stderr }) module . exit_json ( ** result ) if __name__ == '__main__' : main ()","title":"modules"},{"location":"dev/modules/huawei-switch/#_4","text":"\u4f7f\u7528playbook - hosts: localhost gather_facts: no vars: sport: 22 suser: \"user1\" spass: \"Huawei@123\" shost: \"192.168.77.140\" tasks: - name: display version hwos_command: sport: \"{{ sport }}\" shost: \"{{ shost }}\" suser: \"{{ suser }}\" spass: \"{{ spass }}\" command: display version - name: display vlan 900 hwos_command: sport: \"{{ sport }}\" shost: \"{{ shost }}\" suser: \"{{ suser }}\" spass: \"{{ spass }}\" command: display vlan 900 ignore_errors: true register: result - debug: msg={{result.stdout_lines | d()}} - name: add vlan 900 and int 0/0/13 hwos_command: sport: \"{{ sport }}\" shost: \"{{ shost }}\" suser: \"{{ suser }}\" spass: \"{{ spass }}\" save: true command: | system-view vlan 900 quit interface GigabitEthernet 0/0/13 port link-type access vlan 900 port GigabitEthernet 0/0/13 - name: display vlan 900 hwos_command: sport: \"{{ sport }}\" shost: \"{{ shost }}\" suser: \"{{ suser }}\" spass: \"{{ spass }}\" command: display vlan 900 register: result - debug: msg={{result.stdout_lines}}","title":"\u6267\u884c\u6a21\u5757"},{"location":"dev/modules/module-architecture/","text":"\u6a21\u5757\u67b6\u6784 \u00b6 \u5982\u679c\u60a8\u6b63\u5728\u4f7f\u7528Ansible Core\u4ee3\u7801\u3001\u7f16\u5199Ansible\u6a21\u5757\u6216\u5f00\u53d1\u52a8\u4f5c\u63d2\u4ef6\uff0c\u90a3\u4e48\u672c\u6b21\u6df1\u5165\u7814\u7a76\u53ef\u5e2e\u52a9\u60a8\u4e86\u89e3Ansible\u7a0b\u5e8f\u6d41\u7a0b\u662f\u5982\u4f55\u6267\u884c\u7684\u3002 \u5982\u679c\u60a8\u53ea\u662f\u5728\u5267\u672c\u4e2d\u4f7f\u7528Ansible\u6a21\u5757\uff0c\u5219\u53ef\u4ee5\u8df3\u8fc7\u6b64\u90e8\u5206\u3002 \u6a21\u5757\u7c7b\u578b \u00b6 Ansible\u5728\u5176\u4ee3\u7801\u5e93\u4e2d\u652f\u6301\u51e0\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u6a21\u5757\u3002 \u5176\u4e2d\u4e00\u4e9b\u662f\u4e3a\u4e86\u5411\u540e\u517c\u5bb9\uff0c\u800c\u5176\u4ed6\u4e00\u4e9b\u5219\u662f\u4e3a\u4e86\u5b9e\u73b0\u7075\u6d3b\u6027\u3002 Aaction plugins \u00b6 \u5bf9\u4e8eplaybook\u6765\u8bf4\uff0c action \u63d2\u4ef6\u770b\u8d77\u6765\u662f\u6a21\u5757\u3002\u5927\u591a\u6570 action \u63d2\u4ef6\u7684\u4f7f\u7528\u6587\u6863\u90fd\u4f4d\u4e8e\u540c\u540d\u7684\u6a21\u5757\u4e2d\u3002 \u4e00\u4e9b action \u63d2\u4ef6\u53ef\u4ee5\u5b8c\u6210\u6240\u6709\u5de5\u4f5c\uff0c\u800c\u8be5\u6a21\u5757\u4ec5\u63d0\u4f9b\u6587\u6863\u3002 \u4e00\u4e9b action \u63d2\u4ef6\u5219\u548c\u6a21\u5757\u4e00\u8d77\u6267\u884c\u3002 normal action ** \u63d2\u4ef6\u4f1a\u6267\u884c\u6ca1\u6709\u7279\u6b8a **action \u63d2\u4ef6\u7684\u6a21\u5757\u3002 action \u63d2\u4ef6\u59cb\u7ec8\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u6267\u884c\u3002 \u6709\u4e00\u4e9b action \u63d2\u4ef6\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u5c31\u80fd\u5b8c\u6210\u6240\u6709\u7684\u5de5\u4f5c\u3002\u4f8b\u5982\uff1a debug **action **\u63d2\u4ef6(\u6253\u5370\u6587\u672c\u4f9b\u7528\u6237\u67e5\u770b)\u548c assert **action **\u63d2\u4ef6(\u6d4b\u8bd5\u5267\u672c\u4e2d\u7684\u503c\u662f\u5426\u6ee1\u8db3\u67d0\u4e9b\u6761\u4ef6)\u5b8c\u5168\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u6267\u884c\u3002 \u5927\u591a\u6570 action \u63d2\u4ef6\u4f1a\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u8bbe\u7f6e\u4e00\u4e9b\u503c\uff0c\u7136\u540e\u5728\u53d7\u7ba1\u8282\u70b9\u4e0a\u8c03\u7528\u4e00\u4e2a\u6a21\u5757\u6765\u5bf9\u8fd9\u4e9b\u503c\u8fdb\u884c\u5904\u7406\u3002 \u4f8b\u5982\uff1a template **action **\u63d2\u4ef6\u4f7f\u7528\u6765\u81ea\u5267\u672c\u4e2d\u7684\u53d8\u91cf\uff0c\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u7684\u4e34\u65f6\u76ee\u5f55\u4e2d\u6784\u5efa\u6587\u4ef6\u3002 \u7136\u540e\uff0c\u5b83\u5c06\u4e34\u65f6\u6587\u4ef6\u4f20\u8f93\u5230\u8fdc\u7a0b\u7cfb\u7edf\u4e0a\u7684\u4e34\u65f6\u76ee\u5f55\u4e2d\u3002 \u4e4b\u540e\uff0c\u5b83\u5c06\u8c03\u7528\u5728\u8fdc\u7a0b\u7cfb\u7edf\u4e0a\u8fd0\u884c\u7684 copy \u6a21\u5757\uff0c\u4ee5\u5c06\u6587\u4ef6\u79fb\u81f3\u5176\u6700\u7ec8\u4f4d\u7f6e\uff0c\u518d\u53bb\u8bbe\u7f6e\u6587\u4ef6\u5c5e\u6027\u7b49\u4fe1\u606f\u3002 action \u63d2\u4ef6\u5728 python2.7 \u7684\u9ed8\u8ba4\u5b58\u50a8\u4f4d\u7f6e /usr/lib/python2.7/site-packages/ansible/plugins/**action**/ New-style modules \u00b6 Ansible\u9644\u5e26\u7684\u6240\u6709\u6a21\u5757\u90fd\u5c5e\u4e8e\u6b64\u7c7b\u522b\u3002 \u60a8\u53ef\u4ee5\u4f7f\u7528 \u4efb\u4f55\u8bed\u8a00 \u7f16\u5199\u6a21\u5757\uff0c\u4f46\u6240\u6709\u5b98\u65b9\u6a21\u5757\uff08Ansible\u9644\u5e26\uff09\u5747\u4f7f\u7528Python\u6216 PowerShell \u3002 \u65b0\u5f0f\u6a21\u5757\u4ee5\u67d0\u79cd\u65b9\u5f0f\u5c06\u6a21\u5757\u7684\u53c2\u6570\u5d4c\u5165\u5176\u4e2d\u3002\u8001\u5f0f\u7684\u6a21\u5757\u9700\u8981\u5c06\u53c2\u6570\u6587\u4ef6\u590d\u5236\u5230\u53d7\u7ba1\u8282\u70b9\uff0c\u8fd9\u6837\u6548\u7387\u8f83\u4f4e\uff0c\u56e0\u4e3a\u5b83\u9700\u8981\u4e24\u6b21\u8fde\u63a5\u800c\u4e0d\u662f\u4e00\u6b21\u8fde\u63a5\u3002 Python \u00b6 \u65b0\u5f0fPython\u6a21\u5757\u4f7f\u7528 Ansiballz framework \u6846\u67b6\u6765\u6784\u5efa\u6a21\u5757\u3002 \u8fd9\u4e9b\u6a21\u5757\u4f7f\u7528\u6765\u81ea ansible.module_utils \u7684\u5bfc\u5165\u7684\u6a21\u5757\u4ee3\u7801\uff0c\u4f8b\u5982\u53c2\u6570\u89e3\u6790\uff0c\u5c06\u8fd4\u56de\u503c\u683c\u5f0f\u5316\u4e3a JSON \u4ee5\u53ca\u5404\u79cd\u6587\u4ef6\u64cd\u4f5c\u3002 PowerShell \u00b6 \u65b0\u5f0fPowerShell\u6a21\u5757\u4f7f\u7528 Module Replacer framework \u6846\u67b6\u6784\u5efa\u6a21\u5757\u3002\u8fd9\u4e9b\u6a21\u5757\u5728\u88ab\u53d1\u9001\u5230\u53d7\u7ba1\u8282\u70b9\u4e4b\u524d\uff0c\u4f1a\u83b7\u5f97\u4e00\u4e2a\u5d4c\u5165\u5176\u4e2d\u7684PowerShell\u4ee3\u7801\u6587\u4ef6\u3002 JSONARGS modules \u00b6 \u4f7f\u7528\u6b64\u6a21\u5f0f\u5199\u7684\u6a21\u5757\u4e00\u822c\u90fd\u662f\u811a\u672c\uff0c\u5176\u4e3b\u4f53\u4e2d\u5305\u542b\u5b57\u7b26\u4e32 <<INCLUDE_ANSIBLE_MODULE_JSON_ARGS>> \u3002 \u8be5\u5b57\u7b26\u4e32\u5c31\u662fJSON\u683c\u5f0f\u7684\u53c2\u6570\u5b57\u7b26\u4e32\u3002 \u5982\u4e0b\u6240\u793a\uff1a json_arguments = \"\"\"<<INCLUDE_ANSIBLE_MODULE_JSON_ARGS>>\"\"\" \u6269\u5c55\u5199\u6cd5 json_arguments = \"\"\"{\"param1\": \"test's quotes\", \"param2\": \" \\\" To be or not to be \\\" - Hamlet\"}\"\"\" \u8fd9\u4e9b\u6a21\u5757\u901a\u5e38\u4f7f\u7528JSON\u5e93\u89e3\u6790 json_arguments \u7684\u5185\u5bb9\uff0c\u7136\u540e\u5728\u6574\u4e2a\u4ee3\u7801\u4e2d\u4f7f\u7528\u5b83\u4eec\u3002 Non-native want JSON modules \u00b6 \u5982\u679c\u6a21\u5757\u5728\u4efb\u4f55\u4f4d\u7f6e\u90fd\u5305\u542b\u5b57\u7b26\u4e32 WANT_JSON \uff0c\u5219Ansible\u4f1a\u5c06\u5176\u89c6\u4e3a\u975e\u672c\u5730\u6a21\u5757\uff0c\u8be5\u6a21\u5757\u63a5\u53d7\u6587\u4ef6\u540d\u4f5c\u4e3a\u5176\u552f\u4e00\u7684\u547d\u4ee4\u884c\u53c2\u6570\u3002 \u8be5\u6587\u4ef6\u540d\u7528\u4e8e\u5305\u542bJSON\u5b57\u7b26\u4e32\uff08\u5305\u542b\u6a21\u5757\u53c2\u6570\uff09\u7684\u4e34\u65f6\u6587\u4ef6\u3002 \u6a21\u5757\u9700\u8981\u5728\u9000\u51fa\u4e4b\u524d\u6253\u5f00\u6587\u4ef6\uff0c\u8bfb\u53d6\u548c\u89e3\u6790\u53c2\u6570\uff0c\u5bf9\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\uff0c\u5e76\u5c06\u5176\u8fd4\u56de\u6570\u636e\u4f5c\u4e3aJSON\u7f16\u7801\u7684\u5b57\u5178\u6253\u5370\u5230stdout\u3002 \u4e00\u4e2aruby\u7f16\u5199\u7684\u6a21\u5757 #!/usr/bin/ruby # WANT_JSON require 'rubygems' require 'json' # this is a bare minimum example of a 'facts' module that returns some variables into the ansible # namespace. It may not be sufficiently idiomatic and doesn't do a lot of error checking. File . open ( ARGV [ 0 ] ) do | fh | data = JSON . parse ( fh . read ()) begin a = data [ 'a' ]. to_i () b = data [ 'b' ]. to_i () rescue # to raise an error, return failed=True and a msg string. print JSON . dump ({ 'failed' => true , 'msg' => 'failed to parse inputs x or y' }) # the error code here is not so important, the JSON is! exit ( 1 ) end # we may also wish to return changed=True or changed=False # if we were modifying system resources to support handlers and change tracking # if the module decides to not run, it can also return skipped=True result = { 'a' => a , 'b' => b , 'sum' => a + b , } print JSON . dump ( result ) end playbook - hosts : example_servers gather_facts : False tasks : - name : 'call our ruby utility module' action : my_ruby_calculator a=7 b=100 register : my_result - action : debug var=my_result \u5b9e\u9645\u4e0a\u7684\u6267\u884c # cat /path/to/test.json { \"a\" : 2 , \"b\" : 3 } # ruby ./modules/my_calculator /path/to/test.json Binary modules \u00b6 \u4eceAnsible 2.2\u5f00\u59cb\uff0c\u6a21\u5757\u4e5f\u53ef\u4ee5\u662f\u4e8c\u8fdb\u5236\u7a0b\u5e8f\u3002 Ansible\u5e76\u4e0d\u4f1a\u5904\u7406\u4e0d\u540c\u7cfb\u7edf\u7684\u8fd0\u884c\u65f6\u4f9d\u8d56\uff0c\u56e0\u6b64\u5b83\u4eec\u81ea\u5df1\u5904\u7406\u4e8c\u8fdb\u5236\u8fd0\u884c\u65f6\u7684\u4f9d\u8d56\u9879\u3002 \u5c3d\u7ba1\u6709\u8fd9\u4e9b\u7f3a\u70b9\uff0c\u4f46\u5982\u679c\u8fd9\u662f\u8bbf\u95ee\u67d0\u4e9b\u8d44\u6e90\u7684\u552f\u4e00\u65b9\u6cd5\uff0c\u5219\u53ef\u80fd\u5fc5\u987b\u9488\u5bf9\u7279\u5b9a\u7684\u4e8c\u8fdb\u5236\u5e93\u7f16\u8bd1\u6210\u81ea\u5b9a\u4e49\u6a21\u5757\u3002 \u4e00\u4e2ago\u8bed\u8a00\u7684\u4e8c\u8fdb\u5236\u6a21\u5757 helloworld.go Old-style modules \u00b6 \u8001\u5f0f\u6a21\u5757\u7c7b\u4f3c\u4e8e want JSON \u6a21\u5757 \uff0c\u53ea\u662f\u5b83\u4eec\u53c2\u6570\u662f\u4ee5 key=value \u5f62\u5f0f\u4fdd\u5b58\u5728\u6587\u4ef6\u4e2d\uff0c\u800c\u4e0d\u662fJSON\u3002 \u5982\u679c\u6a21\u5757\u4e2d\u6ca1\u6709\u4efb\u4f55\u6807\u8bb0\u53ef\u4ee5\u8868\u660e\u5b83\u662f\u5176\u4ed6\u7c7b\u578b\u4e4b\u4e00\uff0c\u5219Ansible\u4f1a\u786e\u5b9a\u8be5\u6a21\u5757\u4e3a\u8001\u5f0f\u6a21\u5757\u3002 \u4e00\u4e2abash\u811a\u672c\u7684\u4f8b\u5b50 #!/bin/sh args_file = $1 [ ! -f \" $args_file \" ] && echo -n '{\"failed\": true, \"msg\": \"missing required arguments: file\"}' && exit 1 args_result = $( cat $args_file | gawk -F 'file=' '{print $2}' | gawk -F ' ' '{print $1}' ) [ ! -n \" $args_result \" ] && echo -n \"{\\\"failed\\\": true, \\\"msg\\\": \\\"file () is absent, cannot continue\\\", \\\"file\\\": \\\" $args_result \\\"}\" && exit 1 touch $args_result && echo -n \"{\\\"changed\\\": true, \\\"rc\\\": $? ,\\\"file\\\": \\\" $args_result \\\"}\" || echo -n \"{\\\"failed\\\": true, \\\"rc\\\": $? , \\\"file\\\": \\\" $args_result \\\"}\" exit $? \u53c2\u6570\u7684\u5f62\u5f0f # cat args file = /tmp/foo # sh touch.sh args { \"changed\" : true, \"rc\" : 0 , \"file\" : \"/tmp/foo\" } \u6a21\u5757\u662f\u5982\u4f55\u6267\u884c\u7684 \u00b6 \u5f53\u7528\u6237\u4f7f\u7528 ansible \u6216 ansible-playbook \u65f6\uff0c\u4ed6\u4eec\u6307\u5b9a\u8981\u6267\u884c\u7684\u4efb\u52a1\u3002 \u4efb\u52a1\u901a\u5e38\u662f\u6a21\u5757\u7684\u540d\u79f0\u4ee5\u53ca\u8981\u4f20\u9012\u7ed9\u6a21\u5757\u7684\u51e0\u4e2a\u53c2\u6570\u3002 \u5728\u8fdc\u7a0b\u8ba1\u7b97\u673a\u4e0a\u6267\u884c\u4e4b\u524d\uff0cAnsible\u4f1a\u83b7\u53d6\u8fd9\u4e9b\u503c\u5e76\u4ee5\u5404\u79cd\u65b9\u5f0f\u5bf9\u5176\u8fdb\u884c\u5904\u7406\u3002 Executor/task_executor \u00b6 TaskExecutor \u63a5\u6536\u4ece\u5267\u672c\uff08\u6216\u5728 /usr/bin/ansible \u7684\u60c5\u51b5\u4e0b\u4ece\u547d\u4ee4\u884c\uff09\u89e3\u6790\u7684\u6a21\u5757\u540d\u79f0\u548c\u53c2\u6570\u3002 \u5b83\u4f7f\u7528\u540d\u79f0\u6765\u786e\u5b9a\u662f\u5728\u67e5\u770b \u6a21\u5757 \u8fd8\u662f\u5728\u67e5\u770b Action Plugin \u3002 \u5982\u679c\u662f\u6a21\u5757\uff0c\u5b83\u5c06\u52a0\u8f7d \"Normal Action Plugin\" \uff0c\u5e76\u5c06\u540d\u79f0\uff0c\u53d8\u91cf\u548c\u6709\u5173\u4efb\u52a1\u7684\u5176\u4ed6\u4fe1\u606f\u4f20\u9012\u7ed9\u8be5action\u63d2\u4ef6\u4ee5\u8fdb\u884c\u8fdb\u4e00\u6b65\u5904\u7406\u3002 normal action plugin \u00b6 normal action \u63d2\u4ef6\u5c06\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u6267\u884c\u8be5\u6a21\u5757\u3002\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e3b\u8981\u5185\u5bb9\u5c31\u662f\u6267\u884c\u6a21\u5757\u3002 \u5b83\u4e3a\u4efb\u52a1\u52a0\u8f7d\u9002\u5f53\u7684 \u8fde\u63a5\u63d2\u4ef6 \uff0c\u7136\u540e\u6839\u636e\u9700\u8981\u4f20\u8f93\u6216\u6267\u884c\u4ee5\u521b\u5efa\u4e0e\u8be5\u4e3b\u673a\u7684\u8fde\u63a5\u3002 \u5b83\u5c06Ansible\u7684\u6240\u6709\u5185\u90e8\u5c5e\u6027\u6dfb\u52a0\u5230\u6a21\u5757\u7684\u53c2\u6570\uff08\u4f8b\u5982\uff0c\u5c06no_log\u4f20\u9012\u7ed9\u6a21\u5757\u7684\u5c5e\u6027\uff09\u3002 \u5b83\u53ef\u4ee5\u4e0e\u5176\u4ed6\u63d2\u4ef6\uff08connection, shell, become\uff0c\u5176\u4ed6action\u63d2\u4ef6\uff09\u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u5728\u8fdc\u7a0b\u8ba1\u7b97\u673a\u4e0a\u521b\u5efa\u4e34\u65f6\u6587\u4ef6\uff0c\u7136\u540e\u8fdb\u884c\u6e05\u7406\u3002 \u5b83\u5c06\u6a21\u5757\u548c\u6a21\u5757\u53c2\u6570\u63a8\u9001\u5230\u8fdc\u7a0b\u4e3b\u673a\u3002 \u5b83\u5904\u7406\u6a21\u5757\u7684\u6240\u6709\u7279\u6b8a\u60c5\u51b5\uff08\u4f8b\u5982\uff0c\u5f02\u6b65\u6267\u884c\u6216Windows\u6a21\u5757\u5468\u56f4\u7684\u590d\u6742\u6027\uff0c\u8fd9\u4e9b\u6a21\u5757\u5fc5\u987b\u4e0ePython\u6a21\u5757\u5177\u6709\u76f8\u540c\u7684\u540d\u79f0\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u4ece\u5176\u4ed6Action Plugins\u8fdb\u884c\u5185\u90e8\u6a21\u5757\u8c03\u7528\u3002 \uff09 \u6b64\u529f\u80fd\u5927\u90e8\u5206\u6765\u81ea BaseAction \u7c7b\uff0c\u8be5\u7c7b\u4f4d\u4e8e plugins/action/__ init__.py \u4e2d\u3002 \u5b83\u4f7f\u7528 Connection \u548c Shell \u5bf9\u8c61\u8fdb\u884c\u5de5\u4f5c\u3002 \u5f53\u4f7f\u7528 async \u53c2\u6570\u8fd0\u884c\u4efb\u52a1\u65f6\uff0cAnsible\u5c06\u4f7f\u7528 async action\u63d2\u4ef6\u800c\u4e0d\u662f normal action\u63d2\u4ef6\u6765\u8c03\u7528\u5b83\u3002 Executor/module_common.py \u00b6 executor/module_common.py \u7528\u4e8e\u7ec4\u88c5\u8981\u53d1\u9001\u5230\u53d7\u7ba1\u8282\u70b9\u7684\u6a21\u5757\u3002 \u9996\u5148\u8bfb\u5165\u6a21\u5757\u5185\u5bb9\uff0c\u7136\u540e\u68c0\u67e5\u4ee5\u786e\u5b9a\u5176\u7c7b\u578b\uff1a PowerShell \u548c JSON-args \u6a21\u5757\u901a\u8fc7\u6a21\u5757\u66ff\u6362\u5668\u4f20\u9012\u3002 \u65b0\u5f0fPython\u6a21\u5757\u7531 Assembler frameworks \u7ec4\u88c5\u3002 Non-native-want-JSON , Binary modules , \u548c Old-Style modules \u4e0d\u4f1a\u88ab\u6539\u53d8\u3002 \u7ec4\u88c5\u6b65\u9aa4\u5b8c\u6210\u4e4b\u540e\uff0c\u5bf9\u6240\u6709\u5177\u6709*shebang*\u7684\u6a21\u5757\u8fdb\u884c\u6700\u540e\u4fee\u6539\u3002 Ansible\u68c0\u67e5*shebang*\u884c\u4e2d\u7684\u89e3\u91ca\u5668\u662f\u5426\u5177\u6709\u901a\u8fc7 ansible_$X_interpreter \u6e05\u5355\u53d8\u91cf\u914d\u7f6e\u7684\u7279\u5b9a\u8def\u5f84\u3002 \u5982\u679c\u6709\uff0cAnsible\u4f1a\u5c06\u8be5\u8def\u5f84\u66ff\u6362\u4e3a\u6a21\u5757\u4e2d\u7ed9\u5b9a\u7684\u89e3\u91ca\u5668\u8def\u5f84\u3002 \u6b64\u540e\uff0cAnsible\u5c06\u5b8c\u6574\u7684\u6a21\u5757\u6570\u636e\u548c\u6a21\u5757\u7c7b\u578b\u8fd4\u56de\u5230 normal action \uff0c\u8be5action\u5c06\u7ee7\u7eed\u6267\u884c\u6a21\u5757\u3002 Assembler frameworks \u00b6 Ansible\u652f\u6301\u4e24\u4e2a\u6c47\u7f16\u7a0b\u5e8f\u6846\u67b6\uff1a Ansiballz \u548c Module Replacer (\u65e7\u7684)\u3002 Module Replacer framework \u00b6 Module Replacer \u6846\u67b6\u662f\u5b9e\u73b0\u65b0\u578b\u6a21\u5757\u7684\u539f\u59cb\u6846\u67b6\uff0c\u5e76\u4e14\u4ecd\u7528\u4e8e PowerShell \u6a21\u5757\u3002 \u5b83\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u9884\u5904\u7406\u5668\uff08\u5c31\u50cf\u719f\u6089\u8be5\u7f16\u7a0b\u8bed\u8a00\u7684C\u9884\u5904\u7406\u5668\u4e00\u6837\uff09\u3002 \u5b83\u5bf9\u6a21\u5757\u6587\u4ef6\u4e2d\u7684\u7279\u5b9a\u5b50\u5b57\u7b26\u4e32\u6a21\u5f0f\u8fdb\u884c\u76f4\u63a5\u66ff\u6362\u3002 \u6709\u4e24\u79cd\u7c7b\u578b\u7684\u66ff\u6362\uff1a \u4ec5\u5728\u6a21\u5757\u6587\u4ef6\u4e2d\u53d1\u751f\u7684\u66ff\u6362\u3002 \u8fd9\u4e9b\u662f\u6a21\u5757\u7684\u516c\u5171\u66ff\u6362\u5b57\u7b26\u4e32\uff0c\u53ef\u7528\u4e8e\u83b7\u53d6\u6709\u7528\u7684\u6837\u677f\u6216\u8bbf\u95ee\u53c2\u6570\u3002 from ansible.module_utils.MOD_LIB_NAME import * \u66ff\u6362\u6210 ansible.module_utils.MOD_LIB_NAME \u3002\u8fd9\u4e9b\u4ec5\u5e94\u4e0e\u65b0\u578bPython\u6a21\u5757\u4e00\u8d77\u4f7f\u7528\u3002 #<<INCLUDE_ANSIBLE_MODULE_COMMON>> \u7b49\u540c\u4e8e ansible.module_utils.basic import * \uff0c\u5e76\u4e14\u4e5f\u4ec5\u9002\u7528\u4e8e\u65b0\u578bPython\u6a21\u5757\u3002 #POWERSHELL_COMMON \u66ff\u6362 ansible/module_utils/powershell.ps1 \u7684\u5185\u5bb9\u3002 \u5b83\u53ea\u80fd\u4e0e\u65b0\u578bPowershell\u6a21\u5757\u4e00\u8d77\u4f7f\u7528\u3002 ansible.module_utils \u4ee3\u7801\u4f7f\u7528\u7684\u66ff\u6362\u3002 \u8fd9\u4e9b\u662f\u5185\u90e8\u66ff\u6362\u6a21\u5f0f\u3002 \u5b83\u4eec\u53ef\u4ee5\u5728\u4e0a\u9762\u7684\u516c\u5171\u66ff\u6362\u4e2d\u5185\u90e8\u4f7f\u7528\uff0c\u4f46\u4e0d\u5e94\u76f4\u63a5\u7531\u6a21\u5757\u4f7f\u7528\u3002 <<ANSIBLE VERSION>> \u88abANSIBLE VERSION\u66ff\u6362\u3002\u5728Ansiballz\u6846\u67b6\u6846\u67b6\u4e0b\u7684\u65b0\u578bPython\u6a21\u5757\u4e2d\uff0c\u6b63\u786e\u7684\u65b9\u6cd5\u662f\u5b9e\u4f8b\u5316\u4e00\u4e2a AnsibleModul e\uff0c\u7136\u540e\u4ece:attr: AnsibleModule.ansible_version \u8bbf\u95ee\u8fd9\u4e2a\u7248\u672c\u3002 <<INCLUDE_ANSIBLE_MODULE_COMPLEX_ARGS>> \u66ff\u6362\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8be5\u5b57\u7b26\u4e32\u662f\u6a21\u5757\u53c2\u6570\u5728Python\u4e2d\u7684JSON\u7f16\u7801\u3002 \u5728JSON\u5b57\u7b26\u4e32\u4e0a\u4f7f\u7528 repr \u53ef\u4ee5\u5b89\u5168\u5730\u5d4c\u5165\u5230Python\u6587\u4ef6\u4e2d\u3002 \u5728Ansiballz\u6846\u67b6\u4e0b\u7684\u65b0\u578bPython\u6a21\u5757\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b9e\u4f8b\u5316 AnsibleModule \u7136\u540e\u4f7f\u7528 AnsibleModule.params \u6765\u66f4\u597d\u5730\u8fdb\u884c\u8bbf\u95ee\u3002 <<SELINUX_SPECIAL_FILESYSTEMS>> \u66ff\u6362\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8be5\u5b57\u7b26\u4e32\u662f\u4ee5\u9017\u53f7\u5206\u9694\u7684\u6587\u4ef6\u7cfb\u7edf\u5217\u8868\uff0c\u8fd9\u4e9b\u6587\u4ef6\u7cfb\u7edf\u5728SELinux\u4e2d\u5177\u6709\u4e0e\u6587\u4ef6\u7cfb\u7edf\u76f8\u5173\u7684\u5b89\u5168\u4e0a\u4e0b\u6587\u3002 \u5728\u65b0\u578bPython\u6a21\u5757\u4e2d\uff0c\u5982\u679c\u786e\u5b9e\u9700\u8981\u8fd9\u6837\u505a\uff0c\u5219\u5e94\u5b9e\u4f8b\u5316 AnsibleModule \uff0c\u7136\u540e\u4f7f\u7528 AnsibleModule._selinux_special_fs \u3002 \u8be5\u53d8\u91cf\u8fd8\u4ece\u6587\u4ef6\u7cfb\u7edf\u540d\u79f0\u7684\u9017\u53f7\u5206\u9694\u5b57\u7b26\u4e32\u66f4\u6539\u4e3a\u6587\u4ef6\u7cfb\u7edf\u540d\u79f0\u7684\u5b9e\u9645python\u5217\u8868\u3002 <<INCLUDE ANSIBLE MODULE JSON ARGS>> \u5c06MODULE\u53c2\u6570\u66ff\u6362\u4e3aJSON\u5b57\u7b26\u4e32\u3002\u5fc5\u987b\u6ce8\u610f\u6b63\u786e\u5f15\u7528\u5b57\u7b26\u4e32\uff0c\u56e0\u4e3aJSON\u6570\u636e\u53ef\u80fd\u5305\u542b\u5f15\u53f7\u3002\u8fd9\u79cd\u6a21\u5f0f\u5728\u65b0\u578bPython\u6a21\u5757\u4e2d\u6ca1\u6709\u88ab\u66ff\u4ee3\uff0c\u56e0\u4e3a\u5b83\u4eec\u53ef\u4ee5\u901a\u8fc7\u53e6\u4e00\u79cd\u65b9\u5f0f\u83b7\u5f97\u6a21\u5757\u53c2\u6570\u3002 \u5f53\u5b57\u7b26\u4e32 syslog.LOG_USER \u4e0esyslog\u5de5\u5177\u4e00\u8d77\u51fa\u73b0\u65f6\uff0c\u5c31\u4f1a\u88ab\u66ff\u6362\uff0c syslog_facility \u662f\u5728ansible.cfg\u6216\u4efb\u4f55\u9002\u7528\u4e8e\u6b64\u4e3b\u673a\u7684 ansible_syslog_facility \u7f16\u76ee\u53d8\u91cf\u4e2d\u547d\u540d\u7684\u3002\u5728\u65b0\u578b\u7684Python\u6a21\u5757\u4e2d\uff0c\u8fd9\u79cd\u60c5\u51b5\u7565\u6709\u6539\u53d8\u3002\u5982\u679c\u60a8\u786e\u5b9e\u9700\u8981\u8bbf\u95ee\u5b83\uff0c\u60a8\u5e94\u8be5\u5b9e\u4f8b\u5316\u4e00\u4e2a AnsibleModule \uff0c\u7136\u540e\u4f7f\u7528 AnsibleModule._syslog_facility \u8bbf\u95ee\u5b83\u3002\u5b83\u4e0d\u518d\u662f\u5b9e\u9645\u7684syslog\u5de5\u5177\uff0c\u73b0\u5728\u662fsyslog\u5de5\u5177\u7684\u540d\u79f0\u3002 Ansiballz framework \u00b6 Ansiballz\u6846\u67b6\u5728Ansible 2.1\u4e2d\u91c7\u7528\uff0c\u5e76\u7528\u4e8e\u6240\u6709\u65b0\u578bPython\u6a21\u5757\u3002 \u4e0e Module Replacer \u4e0d\u540c\uff0cAnsiballz\u5728 ansible/module_utils \u4e2d\u4f7f\u7528\u771f\u5b9e\u7684\u5bfc\u5165Python\u5bf9\u8c61\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u5bf9\u6a21\u5757\u8fdb\u884c\u9884\u5904\u7406\u3002 \u5b83\u901a\u8fc7\u6784\u9020\u4e00\u4e2azip\u6587\u4ef6\u6765\u505a\u5230\u8fd9\u4e00\u70b9-\u5305\u62ec\u6a21\u5757\u6587\u4ef6\uff0c\u6a21\u5757\u5bfc\u5165\u7684 ansible/module_utils \u4e2d\u7684\u6587\u4ef6\u4ee5\u53ca\u4e00\u4e9b\u4f20\u9012\u6a21\u5757\u53c2\u6570\u7684\u6837\u677f\u6587\u4ef6\u3002 \u7136\u540e\uff0c\u5bf9zipfile\u8fdb\u884cBase64\u7f16\u7801\uff0c\u7136\u540e\u5c06\u5176\u5305\u88c5\u5728\u4e00\u4e2a\u5c0f\u7684Python\u811a\u672c\u4e2d\uff0c\u8be5\u811a\u672c\u4f1a\u89e3\u7801Base64\u7f16\u7801\uff0c\u5e76\u5c06zipfile\u653e\u5165\u53d7\u7ba1\u8282\u70b9\u4e0a\u7684temp\u76ee\u5f55\u4e2d\u3002 \u7136\u540e\uff0c\u5b83\u4ec5\u4ecezip\u6587\u4ef6\u4e2d\u63d0\u53d6Ansible\u6a21\u5757\u811a\u672c\uff0c\u5e76\u5c06\u5176\u4e5f\u653e\u7f6e\u5728\u4e34\u65f6\u76ee\u5f55\u4e2d\u3002 \u7136\u540e\uff0c\u5b83\u5c06 PYTHONPATH \u8bbe\u7f6e\u4e3a\u5728zip\u6587\u4ef6\u4e2d\u67e5\u627ePython\u6a21\u5757\uff0c\u5e76\u5c06Ansible\u6a21\u5757\u4f5c\u4e3a\u7279\u6b8a\u540d\u79f0 __main__ \u5bfc\u5165\u3002 \u5c06\u5176\u5bfc\u5165\u4e3a __main__ \u4f1a\u4f7fPython\u8ba4\u4e3a\u5b83\u6b63\u5728\u6267\u884c\u811a\u672c\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u5730\u5bfc\u5165\u6a21\u5757\u3002 \u8fd9\u6837\uff0cAnsible\u53ef\u4ee5\u5728\u8fdc\u7a0b\u8ba1\u7b97\u673a\u4e0a\u7684Python\u5355\u4e2a\u526f\u672c\u4e2d\u8fd0\u884c\u5305\u88c5\u8fc7\u7684\u811a\u672c\u548c\u6a21\u5757\u4ee3\u7801\u3002 \u5728Ansiballz\u4e2d\uff0c\u4ece ansible.module_utils \u5305\u4e2d\u5bfc\u5165\u7684\u4efb\u4f55Python\u6a21\u5757\u90fd\u4f1a\u89e6\u53d1\u5c06\u8be5Python\u6587\u4ef6\u5305\u542b\u5230zipfile\u4e2d\u3002\u6a21\u5757\u4e2d #<<INCLUDE_ANSIBLE_MODULE_COMMON>> \u7684\u5b9e\u4f8b\u7531 ansible.module_utils.basic import * \u8f6c\u6362\u800c\u6765\u3002\u7136\u540e\uff0c ansible/module-utils/basic.py \u4e5f\u5305\u542b\u5728zipfile\u4e2d\u3002 \u81ea\u8eab\u5c06\u626b\u63cf module_utils \u4e2d\u5305\u542b\u7684\u6587\u4ef6\uff0c\u5e76\u4ece module_utils \u4e2d\u5bfc\u5165\u5176\u4ed6Python\u6a21\u5757\uff0c\u4ee5\u4fbf\u5c06\u5176\u5305\u542b\u5728zip\u6587\u4ef6\u4e2d\u3002 \u53c2\u6570\u4f20\u9012 \u00b6 \u4e24\u4e2a\u6846\u67b6\u901a\u8fc7\u4e0d\u540c\u7684\u65b9\u5f0f\u4f20\u9012\u53c2\u6570\uff1a \u5728Module Replacer\u6846\u67b6\u4e2d\uff0c\u6a21\u5757\u53c2\u6570\u88ab\u8f6c\u6362\u6210json\u5316\u7684\u5b57\u7b26\u4e32\uff0c\u5e76\u88ab\u66ff\u6362\u5230\u7ec4\u5408\u7684\u6a21\u5757\u6587\u4ef6\u4e2d\u3002 \u5728Ansiballz\u6846\u67b6\u4e2d\uff0cjson\u5316\u7684\u5b57\u7b26\u4e32\u662fzipfile\u7684\u4e00\u90e8\u5206\u3002\u5c31\u5728\u5305\u88c5\u5668\u811a\u672c\u5c06Ansible\u6a21\u5757\u4f5c\u4e3a\u4e3b\u6a21\u5757\u5bfc\u5165\u4e4b\u524d\uff0c\u5b83\u7528\u53d8\u91cf\u503c\u5bf9\u79c1\u6709\u7684 _ANSIBLE_ARGS \u53d8\u91cf basic.py \u8fdb\u884c\u4e86monkey-patch\u3002\u5f53 ansible.module_utils.basic.AnsibleModule \u5b9e\u4f8b\u5316\u65f6 \uff0c \u5b83\u5c06\u89e3\u6790\u6b64\u5b57\u7b26\u4e32\u5e76\u5c06args\u653e\u5165 AnsibleModule.params \u4e2d\uff0c\u6a21\u5757\u7684\u5176\u4ed6\u4ee3\u7801\u53ef\u4ee5\u5728\u5176\u4e2d\u8bbf\u95ee\u5b83\u3002 \u5185\u90e8\u53c2\u6570 \u00b6 \u9664\u4e86\u7528\u6237\u5728playbook\u4e2d\u6307\u5b9a\u7684\u53c2\u6570\u5916\uff0cModule Replacer\u6846\u67b6\u548cAnsiballz\u6846\u67b6\u90fd\u5411\u6a21\u5757\u53d1\u9001\u989d\u5916\u7684\u53c2\u6570\u3002\u8fd9\u4e9b\u989d\u5916\u7684\u53c2\u6570\u662f\u5e2e\u52a9\u5b9e\u73b0\u5168\u5c40Ansible\u7279\u6027\u7684\u5185\u90e8\u53c2\u6570\u3002\u6a21\u5757\u901a\u5e38\u4e0d\u9700\u8981\u660e\u786e\u5730\u77e5\u9053\u8fd9\u4e9b\uff0c\u56e0\u4e3a\u529f\u80fd\u662f\u5728ansible\u5b9e\u73b0\u7684\u3002\u6a21\u5757\u8dd1\u9f99\u5957\u3002\u57fa\u672c\u7684\uff0c\u4f46\u67d0\u4e9b\u529f\u80fd\u9700\u8981\u4ece\u6a21\u5757\u7684\u652f\u6301\uff0c\u6240\u4ee5\u4e86\u89e3\u4ed6\u4eec\u4e5f\u662f\u6709\u5e2e\u52a9\u5f00\u53d1\u7684\u3002 \u6b64\u5904\u5217\u51fa\u7684\u5185\u90e8\u53c2\u6570\u662f\u5168\u5c40\u7684\u3002 \u5982\u679c\u9700\u8981\u5728\u81ea\u5b9a\u4e49\u6a21\u5757\u4e2d\u6dfb\u52a0\u672c\u5730\u5185\u90e8\u53c2\u6570\uff0c\u8bf7\u4e3a\u8be5\u7279\u5b9a\u6a21\u5757\u521b\u5efa\u4e00\u4e2aaction\u63d2\u4ef6-\u6709\u5173\u793a\u4f8b\uff0c\u8bf7\u53c2\u89c1copy action\u63d2\u4ef6\u4e2d\u7684 _original_basename \u3002 _ansible_no_log \u00b6 \u5e03\u5c14\u503c\u3002 \u6bcf\u5f53task\u6216paly\u4e2d\u7684\u53c2\u6570\u6307\u5b9ano_log\u65f6\uff0c\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3aTrue\u3002 \u4efb\u4f55\u8c03\u7528 AnsibleModule.log() \u7684\u6a21\u5757\u90fd\u4f1a\u81ea\u52a8\u5904\u7406\u6b64\u95ee\u9898\u3002 \u5982\u679c\u6a21\u5757\u5b9e\u73b0\u81ea\u5df1\u7684\u65e5\u5fd7\u8bb0\u5f55\uff0c\u5219\u9700\u8981\u68c0\u67e5\u8be5\u503c\u3002 \u8981\u8bbf\u95ee\u6a21\u5757\uff0c\u8bf7\u5b9e\u4f8b\u5316 AnsibleModule \uff0c\u7136\u540e\u68c0\u67e5 AnsibleModule.no_log \u7684\u503c\u3002 _ansible_debug \u00b6 \u5e03\u5c14\u503c\u3002 \u6253\u5f00\u6216\u5173\u95ed\u66f4\u8be6\u7ec6\u7684\u65e5\u5fd7\u8bb0\u5f55\uff0c\u5e76\u6253\u5f00\u6a21\u5757\u6267\u884c\u7684\u5916\u90e8\u547d\u4ee4\u7684\u65e5\u5fd7\u8bb0\u5f55\u3002 \u5982\u679c\u6a21\u5757\u4f7f\u7528 AnsibleModule.debug() \u800c\u4e0d\u662f AnsibleModule.log() \uff0c\u5219\u4ec5\u5728 _ansible_debug \u8bbe\u7f6e\u4e3aTrue\u65f6\u624d\u8bb0\u5f55\u6d88\u606f\u3002 \u8981\u8fdb\u884c\u8bbe\u7f6e\uff0c\u8bf7\u5728ansible.cfg\u4e2d\u6dfb\u52a0 debug: true \u6216\u8bbe\u7f6e\u73af\u5883\u53d8\u91cfANSIBLE_DEBUG\u3002 \u8981\u8bbf\u95ee\u6a21\u5757\uff0c\u8bf7\u5b9e\u4f8b\u5316 AnsibleModule \u5e76\u8bbf\u95ee AnsibleModule._debug \u3002 _ansible_diff \u00b6 \u5e03\u5c14\u503c\u3002 \u5982\u679c\u6a21\u5757\u652f\u6301\uff0c\u5219\u544a\u8bc9\u6a21\u5757\u663e\u793a\u8981\u5bf9\u6a21\u677f\u6587\u4ef6\u8fdb\u884c\u7684\u66f4\u6539\u7684\u7edf\u4e00\u5dee\u5f02\u3002 \u8981\u8fdb\u884c\u8bbe\u7f6e\uff0c\u8bf7\u4f20\u9012 --diff \u547d\u4ee4\u884c\u9009\u9879\u3002 \u8981\u8bbf\u95ee\u6a21\u5757\uff0c\u8bf7\u5b9e\u4f8b\u5316 AnsibleModule \u5e76\u8bbf\u95ee AnsibleModule._diff \u3002 _ansible_verbosity \u00b6 \u672a\u4f7f\u7528\u7684\u3002\u6b64\u503c\u53ef\u7528\u4e8e\u5bf9\u65e5\u5fd7\u8fdb\u884c\u66f4\u7ec6\u7c92\u5ea6\u7684\u63a7\u5236\u3002 _ansible_selinux_special_fs \u00b6 \u5217\u8868\u3002 \u5177\u6709\u7279\u6b8aSELinux\u4e0a\u4e0b\u6587\u7684\u6587\u4ef6\u7cfb\u7edf\u7684\u540d\u79f0\u3002 AnsibleModule\u65b9\u6cd5\u4f7f\u7528\u5b83\u4eec\uff0c\u8be5\u65b9\u6cd5\u5bf9\u6587\u4ef6\u8fdb\u884c\u64cd\u4f5c\uff08\u66f4\u6539\u5c5e\u6027\uff0c\u79fb\u52a8\u548c\u590d\u5236\uff09\u3002 \u8981\u8fdb\u884c\u8bbe\u7f6e\uff0c\u8bf7\u5728ansible.cfg\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u7528\u9017\u53f7\u5206\u9694\u7684\u6587\u4ef6\u7cfb\u7edf\u540d\u79f0\u5b57\u7b26\u4e32\uff1a # ansible.cfg [selinux] special_context_filesystems = nfs,vboxsf,fuse,ramfs,vfat \u5927\u591a\u6570\u6a21\u5757\u53ef\u4ee5\u4f7f\u7528\u5185\u7f6e\u7684AnsibleModule\u65b9\u6cd5\u6765\u5904\u7406\u6587\u4ef6\u3002 \u8981\u8bbf\u95ee\u9700\u8981\u4e86\u89e3\u8fd9\u4e9b\u7279\u6b8a\u4e0a\u4e0b\u6587\u6587\u4ef6\u7cfb\u7edf\u7684\u6a21\u5757\uff0c\u8bf7\u5b9e\u4f8b\u5316 AnsibleModule \u5e76\u68c0\u67e5 AnsibleModule._selinux_special_fs \u4e2d\u7684\u5217\u8868\u3002 \u5728 Module Replacer \u6846\u67b6\u4e2d\uff0c\u5c06\u66ff\u6362 ansible.module_utils.basic.SELINUX_SPECIAL_FS , \u5728Module Replacer\u4e2d\uff0c\u5b83\u662f\u4e00\u4e2a\u7528\u9017\u53f7\u5206\u9694\u7684\u6587\u4ef6\u7cfb\u7edf\u540d\u79f0\u5b57\u7b26\u4e32\u3002 \u5728Ansiballz\u4e0b\u662f\u4e00\u4e2a\u5b9e\u9645\u5217\u8868\u3002 _ansible_syslog_facility \u00b6 \u6b64\u53c2\u6570\u63a7\u5236Ansible\u6a21\u5757\u767b\u5f55\u5230\u54ea\u4e2asyslog\u5de5\u5177\u3002 \u8981\u8fdb\u884c\u8bbe\u7f6e\uff0c\u8bf7\u66f4\u6539ansible.cfg\u4e2d\u7684 syslog_facility \u503c\u3002 \u5927\u591a\u6570\u6a21\u5757\u5e94\u8be5\u53ea\u4f7f\u7528 AnsibleModule.log() \uff0c\u7136\u540e\u518d\u5229\u7528\u5b83\u3002 \u5982\u679c\u6a21\u5757\u5fc5\u987b\u81ea\u5df1\u4f7f\u7528\u5b83\uff0c\u5219\u5e94\u5b9e\u4f8b\u5316 AnsibleModule \uff0c\u7136\u540e\u4ece AnsibleModule._syslog_facility \u68c0\u7d22syslog\u5de5\u5177\u7684\u540d\u79f0\u3002 Ansiballz\u4ee3\u7801\u6bd4\u65e7\u7684Module Replacer\u6846\u67b6\u4ee3\u7801\u66f4\u7b80\u6d01\uff1a # Old module_replacer way import syslog syslog . openlog ( NAME , 0 , syslog . LOG_USER ) # New Ansiballz way import syslog facility_name = module . _syslog_facility facility = getattr ( syslog , facility_name , syslog . LOG_USER ) syslog . openlog ( NAME , 0 , facility ) _ansible_version \u00b6 \u6b64\u53c2\u6570\u4f20\u9012\u8fd0\u884c\u8be5\u6a21\u5757\u7684Ansible\u7248\u672c\u3002 \u8981\u8bbf\u95ee\u5b83\uff0c\u6a21\u5757\u5e94\u5b9e\u4f8b\u5316 AnsibleModule \uff0c\u7136\u540e\u4ece AnsibleModule.ansible_version \u68c0\u7d22\u5b83\u3002 \u8fd9\u5c06\u66ff\u6362Module Replacer \u6846\u67b6\u4e2d\u7684 ansible.module_utils.basic.ANSIBLE_VERSION \u3002 \u6a21\u5757\u8fd4\u56de\u503c\u548c\u4e0d\u5b89\u5168\u5b57\u7b26\u4e32 \u00b6 \u5728\u6a21\u5757\u6267\u884c\u7ed3\u675f\u65f6\uff0c\u5b83\u5c06\u8981\u8fd4\u56de\u7684\u6570\u636e\u683c\u5f0f\u5316\u4e3aJSON\u5b57\u7b26\u4e32\uff0c\u5e76\u5c06\u8be5\u5b57\u7b26\u4e32\u6253\u5370\u5230\u5176\u6807\u51c6\u8f93\u51fa\u3002 normal action\u63d2\u4ef6\u63a5\u6536JSON\u5b57\u7b26\u4e32\uff0c\u5c06\u5176\u89e3\u6790\u4e3aPython\u5b57\u5178\uff0c\u7136\u540e\u5c06\u5176\u8fd4\u56de\u7ed9\u6267\u884c\u7a0b\u5e8f\u3002 \u5982\u679cAnsible\u6a21\u677f\u5316\u6bcf\u4e2a\u5b57\u7b26\u4e32\u8fd4\u56de\u503c\uff0c\u5219\u5f88\u5bb9\u6613\u53d7\u5230\u6709\u6743\u8bbf\u95ee\u53d7\u7ba1\u8282\u70b9\u7684\u7528\u6237\u7684\u653b\u51fb\u3002 \u5982\u679c\u4e0d\u9053\u5fb7\u7684\u7528\u6237\u5c06\u6076\u610f\u4ee3\u7801\u4f2a\u88c5\u6210Ansible\u8fd4\u56de\u503c\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u5728\u63a7\u5236\u5668\u4e0a\u5c06\u8fd9\u4e9b\u5b57\u7b26\u4e32\u6a21\u677f\u5316\uff0c\u5219Ansible\u53ef\u4ee5\u6267\u884c\u4efb\u610f\u4ee3\u7801\u3002 \u4e3a\u4e86\u9632\u6b62\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff0cAnsible\u5c06\u8fd4\u56de\u6570\u636e\u4e2d\u7684\u6240\u6709\u5b57\u7b26\u4e32\u6807\u8bb0\u4e3a\u201cUnsafe\u201d\uff0c\u9010\u5b57\u53d1\u5c04\u5b57\u7b26\u4e32\u4e2d\u7684\u4efb\u4f55Jinja2\u6a21\u677f\uff0c\u800c\u4e0d\u662fJinja2\u5bf9\u5176\u8fdb\u884c\u6269\u5c55\u3002 \u901a\u8fc7 ActionPlugin._execute_module() \u8c03\u7528\u6a21\u5757\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u5c06\u7531 normal action\u63d2\u4ef6\u81ea\u52a8\u6807\u8bb0\u4e3a\u201cUnsafe\u201d\u3002 \u5982\u679c\u53e6\u4e00\u4e2aaction\u63d2\u4ef6\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u4ece\u6a21\u5757\u68c0\u7d22\u4fe1\u606f\uff0c\u5219\u5b83\u5fc5\u987b\u81ea\u5df1\u5c06\u5176\u8fd4\u56de\u6570\u636e\u6807\u8bb0\u4e3a\u201cUnsafe\u201d\u3002 \u5982\u679caction\u63d2\u4ef6\u672a\u80fd\u5c06\u5176\u7ed3\u679c\u6807\u8bb0\u4e3a\u201c\u4e0dUnsafe\u201d\uff0c\u5219Ansible\u5728\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u6267\u884c\u7a0b\u5e8f\u65f6\u4f1a\u518d\u6b21\u5ba1\u6838\u7ed3\u679c\uff0c\u5c06\u6240\u6709\u5b57\u7b26\u4e32\u6807\u8bb0\u4e3a\u201cUnsafe\u201d\u3002 normal action\u63d2\u4ef6\u4ee5\u7ed3\u679c\u6570\u636e\u4f5c\u4e3a\u53c2\u6570\u6765\u4fdd\u62a4\u81ea\u5df1\u548c\u5b83\u8c03\u7528\u7684\u4efb\u4f55\u5176\u4ed6\u4ee3\u7801\u3002 \u6267\u884c\u7a0b\u5e8f\u4e2d\u7684\u68c0\u67e5\u53ef\u4fdd\u62a4\u6240\u6709\u5176\u4ed6action\u63d2\u4ef6\u7684\u8f93\u51fa\uff0c\u4ece\u800c\u786e\u4fdd\u7531Ansible\u8fd0\u884c\u7684\u540e\u7eed\u4efb\u52a1\u4e5f\u4e0d\u4f1a\u4ece\u8fd9\u4e9b\u7ed3\u679c\u4e2d\u83b7\u53d6\u4efb\u4f55\u6a21\u677f\u3002 \u7279\u6b8a\u4e8b\u9879 \u00b6 Pipelining \u00b6 Ansible\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u4e4b\u4e00\u5c06\u6a21\u5757\u4f20\u8f93\u5230\u8fdc\u7a0b\u8ba1\u7b97\u673a\uff1a \u5b83\u53ef\u4ee5\u5c06\u6a21\u5757\u5199\u5230\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u7684\u4e34\u65f6\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u4f7f\u7528\u4e0e\u8fdc\u7a0b\u4e3b\u673a\u7684\u7b2c\u4e8c\u4e2a\u8fde\u63a5\u6765\u4f7f\u7528\u6a21\u5757\u6240\u9700\u7684\u89e3\u91ca\u5668\u6267\u884c\u5b83 \u6216\u8005\uff0c\u5b83\u4e5f\u53ef\u4ee5\u4f7f\u7528Pipelining\u6765\u6267\u884c\u6a21\u5757\uff0c\u5c06\u6a21\u5757\u5bfc\u5165\u8fdc\u7a0b\u89e3\u91ca\u5668\u7684stdin\u4e2d\u3002 \u76ee\u524d\uff0cPipelining\u4ec5\u9002\u7528\u4e8e\u7528Python\u7f16\u5199\u7684\u6a21\u5757\uff0c\u56e0\u4e3aAnsible\u53ea\u77e5\u9053Python\u652f\u6301\u8fd9\u79cd\u64cd\u4f5c\u6a21\u5f0f\u3002 \u652f\u6301Pipelining\u610f\u5473\u7740\uff0c\u6a21\u5757\u6709\u6548\u8f7d\u8377\u901a\u8fc7\u6709\u7ebf\u53d1\u9001\u4e4b\u524d\u91c7\u7528\u7684\u4efb\u4f55\u683c\u5f0f\uff0c\u90fd\u5fc5\u987b\u7531Python\u901a\u8fc7stdin\u6267\u884c\u3002 \u4e3a\u4ec0\u4e48\u5728stdin\u4f20\u9012\u53c2\u6570? \u00b6 \u9009\u62e9\u901a\u8fc7stdin\u4f20\u9012\u53c2\u6570\u7684\u539f\u56e0\u5982\u4e0b\uff1a \u4e0e ANSIBLE_PIPELINING \u7ed3\u5408\u4f7f\u7528\u65f6\uff0c\u53ef\u4ee5\u9632\u6b62\u6a21\u5757\u7684\u53c2\u6570\u4e34\u65f6\u4fdd\u5b58\u5230\u8fdc\u7a0b\u8ba1\u7b97\u673a\u7684\u78c1\u76d8\u4e0a\u3002 \u8fd9\u4f7f\u5f97\u8fdc\u7a0b\u8ba1\u7b97\u673a\u4e0a\u7684\u6076\u610f\u7528\u6237\u66f4\u96be\uff08\u4f46\u5e76\u975e\u4e0d\u53ef\u80fd\uff09\u7a83\u53d6\u81ea\u53d8\u91cf\u4e2d\u53ef\u80fd\u5b58\u5728\u7684\u4efb\u4f55\u654f\u611f\u4fe1\u606f\u3002 \u547d\u4ee4\u884c\u53c2\u6570\u662f\u4e0d\u5b89\u5168\u7684\uff0c\u56e0\u4e3a\u5927\u591a\u6570\u7cfb\u7edf\u5141\u8bb8\u975e\u7279\u6743\u7528\u6237\u8bfb\u53d6\u8fdb\u7a0b\u7684\u5b8c\u6574\u547d\u4ee4\u884c\u3002 \u73af\u5883\u53d8\u91cf\u901a\u5e38\u6bd4\u547d\u4ee4\u884c\u66f4\u5b89\u5168\uff0c\u4f46\u662f\u4e00\u4e9b\u7cfb\u7edf\u9650\u5236\u73af\u5883\u7684\u603b\u4f53\u5927\u5c0f\u3002\u5982\u679c\u8fbe\u5230\u8fd9\u4e2a\u9650\u5236\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u53c2\u6570\u622a\u65ad\u3002 AnsibleModule \u00b6 \u53c2\u6570 \u00b6 \u63d0\u4f9b\u7ed9 AnsibleModule \u7684 arguments_spec \u5b9a\u4e49\u4e86\u6a21\u5757\u652f\u6301\u7684\u53c2\u6570\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u7c7b\u578b\uff0c\u9ed8\u8ba4\u503c\u548c\u66f4\u591a\u5185\u5bb9\u3002 module = AnsibleModule ( argument_spec = dict ( top_level = dict ( type = 'dict' , options = dict ( second_level = dict ( default = True , type = 'bool' , ) ) ) )) \u53c2\u6570\u7684\u9009\u9879 type \u00b6 type\u5141\u8bb8\u60a8\u5b9a\u4e49\u4e3a\u53c2\u6570\u63a5\u53d7\u7684\u503c\u7684\u7c7b\u578b\u3002\u7c7b\u578b\u7684\u9ed8\u8ba4\u503c\u662fstr\u3002\u53ef\u80fd\u7684\u503c\u662f str list dict bool int float path raw jsonarg json bytes bits raw \u7c7b\u578b\uff0c\u4e0d\u6267\u884c\u4efb\u4f55\u7c7b\u578b\u9a8c\u8bc1\u6216\u7c7b\u578b\u5927\u5c0f\u5199\uff0c\u5e76\u7ef4\u62a4\u4f20\u9012\u503c\u7684\u7c7b\u578b\u3002 elements \u00b6 \u5f53 type ='list' \u65f6\uff0celements\u4e0etype\u7ed3\u5408\u4f7f\u7528\u3002 \u7136\u540e\u53ef\u4ee5\u5c06elements\u5b9a\u4e49\u4e3a elements ='int' \u6216\u4efb\u4f55\u5176\u4ed6\u7c7b\u578b\uff0c\u6307\u793a\u6307\u5b9a\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u5e94\u8be5\u5c5e\u4e8e\u8be5\u7c7b\u578b\u3002 default \u00b6 default \u9009\u9879\u5141\u8bb8\u5728\u4e0d\u5411\u6a21\u5757\u63d0\u4f9b\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u4e3a\u573a\u666f\u7684\u53c2\u6570\u8bbe\u7f6e\u9ed8\u8ba4\u503c\u3002\u672a\u6307\u5b9a\u65f6\uff0c\u9ed8\u8ba4\u503c\u4e3aNone\u3002 fallback \u00b6 fallback \u63a5\u53d7\u4e00\u4e2a\u5143\u7ec4\uff0c\u5176\u4e2d\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u53ef\u8c03\u7528\u7684\uff08\u51fd\u6570\uff09\uff0c\u5c06\u7528\u4e8e\u57fa\u4e8e\u7b2c\u4e8c\u4e2a\u53c2\u6570\u6267\u884c\u67e5\u627e\u3002 \u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u53ef\u8c03\u7528\u5bf9\u8c61\u63a5\u53d7\u7684\u503c\u7684\u5217\u8868\u3002 \u6700\u5e38\u7528\u7684\u53ef\u8c03\u7528\u65b9\u6cd5\u662f env_fallback \uff0c\u5f53\u4e0d\u63d0\u4f9b\u53c2\u6570\u65f6\uff0c\u5b83\u5c06\u5141\u8bb8\u53c2\u6570\u6709\u9009\u62e9\u5730\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u3002 username = dict ( fallback = ( env_fallback , [ 'ANSIBLE_NET_USERNAME' ])) choices \u00b6 options\u63a5\u53d7\u53c2\u6570\u5c06\u63a5\u53d7\u7684choices\u5217\u8868\u3002\u9009\u62e9\u7684\u7c7b\u578b\u5e94\u8be5\u4e0e\u7c7b\u578b\u5339\u914d\u3002 required \u00b6 required\u63a5\u53d7\u4e00\u4e2a\u5e03\u5c14\u503c\uff0cTrue\u6216False\u8868\u793a\u8be5\u53c2\u6570\u662f\u5fc5\u9700\u7684\u3002 \u8fd9\u4e0d\u5e94\u4e0e\u9ed8\u8ba4\u503c\u7ed3\u5408\u4f7f\u7528\u3002 no_log \u00b6 no_log\u63a5\u53d7\u5e03\u5c14\u503c\uff08True\u6216False\uff09\uff0c\u8be5\u5e03\u5c14\u503c\u660e\u786e\u6307\u793a\u53c2\u6570\u503c\u662f\u5426\u5e94\u5728\u65e5\u5fd7\u548c\u8f93\u51fa\u4e2d\u5c4f\u853d\u3002 aliases \u00b6 aliases\u63a5\u53d7\u53c2\u6570\u7684\u66ff\u4ee3\u53c2\u6570\u540d\u79f0\u7684\u5217\u8868\uff0c\u4f8b\u5982\u53c2\u6570\u4e3a name \u4f46\u6a21\u5757\u63a5\u53d7 aliases=['pkg'] \u7684\u60c5\u51b5\uff0c\u4ee5\u5141\u8bb8pkg\u4e0e name \u4e92\u6362 options \u00b6 options\u5b9e\u73b0\u4e86\u521b\u5efa\u5b50\u9009\u9879\u7684\u529f\u80fd\uff0c \u672c\u8282\u7684\u793a\u4f8b\u6f14\u793a\u4e86\u9009\u9879\u7684\u4f7f\u7528\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7c7b\u578b\u6216\u5143\u7d20\u5e94\u8be5\u662fdict\u3002 apply_defaults \u00b6 apply defaults\u4e0eoptions\u4e00\u8d77\u5de5\u4f5c\uff0c\u5e76\u5141\u8bb8\u5e94\u7528\u5b50\u9009\u9879\u7684\u9ed8\u8ba4\u503c\uff0c\u5373\u4f7f\u5728\u6ca1\u6709\u63d0\u4f9b\u9876\u7ea7\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u4e5f\u662f\u5982\u6b64\u3002 removed_in_version \u00b6 remove_in_version \u6307\u660e\u5c06\u5728\u54ea\u4e2aAnsible\u7248\u672c\u4e2d\u5220\u9664\u4e0d\u63a8\u8350\u4f7f\u7528\u7684\u53c2\u6570\u3002","title":"module \u67b6\u6784"},{"location":"dev/modules/module-architecture/#_1","text":"\u5982\u679c\u60a8\u6b63\u5728\u4f7f\u7528Ansible Core\u4ee3\u7801\u3001\u7f16\u5199Ansible\u6a21\u5757\u6216\u5f00\u53d1\u52a8\u4f5c\u63d2\u4ef6\uff0c\u90a3\u4e48\u672c\u6b21\u6df1\u5165\u7814\u7a76\u53ef\u5e2e\u52a9\u60a8\u4e86\u89e3Ansible\u7a0b\u5e8f\u6d41\u7a0b\u662f\u5982\u4f55\u6267\u884c\u7684\u3002 \u5982\u679c\u60a8\u53ea\u662f\u5728\u5267\u672c\u4e2d\u4f7f\u7528Ansible\u6a21\u5757\uff0c\u5219\u53ef\u4ee5\u8df3\u8fc7\u6b64\u90e8\u5206\u3002","title":"\u6a21\u5757\u67b6\u6784"},{"location":"dev/modules/module-architecture/#_2","text":"Ansible\u5728\u5176\u4ee3\u7801\u5e93\u4e2d\u652f\u6301\u51e0\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u6a21\u5757\u3002 \u5176\u4e2d\u4e00\u4e9b\u662f\u4e3a\u4e86\u5411\u540e\u517c\u5bb9\uff0c\u800c\u5176\u4ed6\u4e00\u4e9b\u5219\u662f\u4e3a\u4e86\u5b9e\u73b0\u7075\u6d3b\u6027\u3002","title":"\u6a21\u5757\u7c7b\u578b"},{"location":"dev/modules/module-architecture/#aaction-plugins","text":"\u5bf9\u4e8eplaybook\u6765\u8bf4\uff0c action \u63d2\u4ef6\u770b\u8d77\u6765\u662f\u6a21\u5757\u3002\u5927\u591a\u6570 action \u63d2\u4ef6\u7684\u4f7f\u7528\u6587\u6863\u90fd\u4f4d\u4e8e\u540c\u540d\u7684\u6a21\u5757\u4e2d\u3002 \u4e00\u4e9b action \u63d2\u4ef6\u53ef\u4ee5\u5b8c\u6210\u6240\u6709\u5de5\u4f5c\uff0c\u800c\u8be5\u6a21\u5757\u4ec5\u63d0\u4f9b\u6587\u6863\u3002 \u4e00\u4e9b action \u63d2\u4ef6\u5219\u548c\u6a21\u5757\u4e00\u8d77\u6267\u884c\u3002 normal action ** \u63d2\u4ef6\u4f1a\u6267\u884c\u6ca1\u6709\u7279\u6b8a **action \u63d2\u4ef6\u7684\u6a21\u5757\u3002 action \u63d2\u4ef6\u59cb\u7ec8\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u6267\u884c\u3002 \u6709\u4e00\u4e9b action \u63d2\u4ef6\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u5c31\u80fd\u5b8c\u6210\u6240\u6709\u7684\u5de5\u4f5c\u3002\u4f8b\u5982\uff1a debug **action **\u63d2\u4ef6(\u6253\u5370\u6587\u672c\u4f9b\u7528\u6237\u67e5\u770b)\u548c assert **action **\u63d2\u4ef6(\u6d4b\u8bd5\u5267\u672c\u4e2d\u7684\u503c\u662f\u5426\u6ee1\u8db3\u67d0\u4e9b\u6761\u4ef6)\u5b8c\u5168\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u6267\u884c\u3002 \u5927\u591a\u6570 action \u63d2\u4ef6\u4f1a\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u8bbe\u7f6e\u4e00\u4e9b\u503c\uff0c\u7136\u540e\u5728\u53d7\u7ba1\u8282\u70b9\u4e0a\u8c03\u7528\u4e00\u4e2a\u6a21\u5757\u6765\u5bf9\u8fd9\u4e9b\u503c\u8fdb\u884c\u5904\u7406\u3002 \u4f8b\u5982\uff1a template **action **\u63d2\u4ef6\u4f7f\u7528\u6765\u81ea\u5267\u672c\u4e2d\u7684\u53d8\u91cf\uff0c\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u7684\u4e34\u65f6\u76ee\u5f55\u4e2d\u6784\u5efa\u6587\u4ef6\u3002 \u7136\u540e\uff0c\u5b83\u5c06\u4e34\u65f6\u6587\u4ef6\u4f20\u8f93\u5230\u8fdc\u7a0b\u7cfb\u7edf\u4e0a\u7684\u4e34\u65f6\u76ee\u5f55\u4e2d\u3002 \u4e4b\u540e\uff0c\u5b83\u5c06\u8c03\u7528\u5728\u8fdc\u7a0b\u7cfb\u7edf\u4e0a\u8fd0\u884c\u7684 copy \u6a21\u5757\uff0c\u4ee5\u5c06\u6587\u4ef6\u79fb\u81f3\u5176\u6700\u7ec8\u4f4d\u7f6e\uff0c\u518d\u53bb\u8bbe\u7f6e\u6587\u4ef6\u5c5e\u6027\u7b49\u4fe1\u606f\u3002 action \u63d2\u4ef6\u5728 python2.7 \u7684\u9ed8\u8ba4\u5b58\u50a8\u4f4d\u7f6e /usr/lib/python2.7/site-packages/ansible/plugins/**action**/","title":"Aaction plugins"},{"location":"dev/modules/module-architecture/#new-style-modules","text":"Ansible\u9644\u5e26\u7684\u6240\u6709\u6a21\u5757\u90fd\u5c5e\u4e8e\u6b64\u7c7b\u522b\u3002 \u60a8\u53ef\u4ee5\u4f7f\u7528 \u4efb\u4f55\u8bed\u8a00 \u7f16\u5199\u6a21\u5757\uff0c\u4f46\u6240\u6709\u5b98\u65b9\u6a21\u5757\uff08Ansible\u9644\u5e26\uff09\u5747\u4f7f\u7528Python\u6216 PowerShell \u3002 \u65b0\u5f0f\u6a21\u5757\u4ee5\u67d0\u79cd\u65b9\u5f0f\u5c06\u6a21\u5757\u7684\u53c2\u6570\u5d4c\u5165\u5176\u4e2d\u3002\u8001\u5f0f\u7684\u6a21\u5757\u9700\u8981\u5c06\u53c2\u6570\u6587\u4ef6\u590d\u5236\u5230\u53d7\u7ba1\u8282\u70b9\uff0c\u8fd9\u6837\u6548\u7387\u8f83\u4f4e\uff0c\u56e0\u4e3a\u5b83\u9700\u8981\u4e24\u6b21\u8fde\u63a5\u800c\u4e0d\u662f\u4e00\u6b21\u8fde\u63a5\u3002","title":"New-style modules"},{"location":"dev/modules/module-architecture/#python","text":"\u65b0\u5f0fPython\u6a21\u5757\u4f7f\u7528 Ansiballz framework \u6846\u67b6\u6765\u6784\u5efa\u6a21\u5757\u3002 \u8fd9\u4e9b\u6a21\u5757\u4f7f\u7528\u6765\u81ea ansible.module_utils \u7684\u5bfc\u5165\u7684\u6a21\u5757\u4ee3\u7801\uff0c\u4f8b\u5982\u53c2\u6570\u89e3\u6790\uff0c\u5c06\u8fd4\u56de\u503c\u683c\u5f0f\u5316\u4e3a JSON \u4ee5\u53ca\u5404\u79cd\u6587\u4ef6\u64cd\u4f5c\u3002","title":"Python"},{"location":"dev/modules/module-architecture/#powershell","text":"\u65b0\u5f0fPowerShell\u6a21\u5757\u4f7f\u7528 Module Replacer framework \u6846\u67b6\u6784\u5efa\u6a21\u5757\u3002\u8fd9\u4e9b\u6a21\u5757\u5728\u88ab\u53d1\u9001\u5230\u53d7\u7ba1\u8282\u70b9\u4e4b\u524d\uff0c\u4f1a\u83b7\u5f97\u4e00\u4e2a\u5d4c\u5165\u5176\u4e2d\u7684PowerShell\u4ee3\u7801\u6587\u4ef6\u3002","title":"PowerShell"},{"location":"dev/modules/module-architecture/#jsonargs-modules","text":"\u4f7f\u7528\u6b64\u6a21\u5f0f\u5199\u7684\u6a21\u5757\u4e00\u822c\u90fd\u662f\u811a\u672c\uff0c\u5176\u4e3b\u4f53\u4e2d\u5305\u542b\u5b57\u7b26\u4e32 <<INCLUDE_ANSIBLE_MODULE_JSON_ARGS>> \u3002 \u8be5\u5b57\u7b26\u4e32\u5c31\u662fJSON\u683c\u5f0f\u7684\u53c2\u6570\u5b57\u7b26\u4e32\u3002 \u5982\u4e0b\u6240\u793a\uff1a json_arguments = \"\"\"<<INCLUDE_ANSIBLE_MODULE_JSON_ARGS>>\"\"\" \u6269\u5c55\u5199\u6cd5 json_arguments = \"\"\"{\"param1\": \"test's quotes\", \"param2\": \" \\\" To be or not to be \\\" - Hamlet\"}\"\"\" \u8fd9\u4e9b\u6a21\u5757\u901a\u5e38\u4f7f\u7528JSON\u5e93\u89e3\u6790 json_arguments \u7684\u5185\u5bb9\uff0c\u7136\u540e\u5728\u6574\u4e2a\u4ee3\u7801\u4e2d\u4f7f\u7528\u5b83\u4eec\u3002","title":"JSONARGS modules"},{"location":"dev/modules/module-architecture/#non-native-want-json-modules","text":"\u5982\u679c\u6a21\u5757\u5728\u4efb\u4f55\u4f4d\u7f6e\u90fd\u5305\u542b\u5b57\u7b26\u4e32 WANT_JSON \uff0c\u5219Ansible\u4f1a\u5c06\u5176\u89c6\u4e3a\u975e\u672c\u5730\u6a21\u5757\uff0c\u8be5\u6a21\u5757\u63a5\u53d7\u6587\u4ef6\u540d\u4f5c\u4e3a\u5176\u552f\u4e00\u7684\u547d\u4ee4\u884c\u53c2\u6570\u3002 \u8be5\u6587\u4ef6\u540d\u7528\u4e8e\u5305\u542bJSON\u5b57\u7b26\u4e32\uff08\u5305\u542b\u6a21\u5757\u53c2\u6570\uff09\u7684\u4e34\u65f6\u6587\u4ef6\u3002 \u6a21\u5757\u9700\u8981\u5728\u9000\u51fa\u4e4b\u524d\u6253\u5f00\u6587\u4ef6\uff0c\u8bfb\u53d6\u548c\u89e3\u6790\u53c2\u6570\uff0c\u5bf9\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\uff0c\u5e76\u5c06\u5176\u8fd4\u56de\u6570\u636e\u4f5c\u4e3aJSON\u7f16\u7801\u7684\u5b57\u5178\u6253\u5370\u5230stdout\u3002 \u4e00\u4e2aruby\u7f16\u5199\u7684\u6a21\u5757 #!/usr/bin/ruby # WANT_JSON require 'rubygems' require 'json' # this is a bare minimum example of a 'facts' module that returns some variables into the ansible # namespace. It may not be sufficiently idiomatic and doesn't do a lot of error checking. File . open ( ARGV [ 0 ] ) do | fh | data = JSON . parse ( fh . read ()) begin a = data [ 'a' ]. to_i () b = data [ 'b' ]. to_i () rescue # to raise an error, return failed=True and a msg string. print JSON . dump ({ 'failed' => true , 'msg' => 'failed to parse inputs x or y' }) # the error code here is not so important, the JSON is! exit ( 1 ) end # we may also wish to return changed=True or changed=False # if we were modifying system resources to support handlers and change tracking # if the module decides to not run, it can also return skipped=True result = { 'a' => a , 'b' => b , 'sum' => a + b , } print JSON . dump ( result ) end playbook - hosts : example_servers gather_facts : False tasks : - name : 'call our ruby utility module' action : my_ruby_calculator a=7 b=100 register : my_result - action : debug var=my_result \u5b9e\u9645\u4e0a\u7684\u6267\u884c # cat /path/to/test.json { \"a\" : 2 , \"b\" : 3 } # ruby ./modules/my_calculator /path/to/test.json","title":"Non-native want JSON modules"},{"location":"dev/modules/module-architecture/#binary-modules","text":"\u4eceAnsible 2.2\u5f00\u59cb\uff0c\u6a21\u5757\u4e5f\u53ef\u4ee5\u662f\u4e8c\u8fdb\u5236\u7a0b\u5e8f\u3002 Ansible\u5e76\u4e0d\u4f1a\u5904\u7406\u4e0d\u540c\u7cfb\u7edf\u7684\u8fd0\u884c\u65f6\u4f9d\u8d56\uff0c\u56e0\u6b64\u5b83\u4eec\u81ea\u5df1\u5904\u7406\u4e8c\u8fdb\u5236\u8fd0\u884c\u65f6\u7684\u4f9d\u8d56\u9879\u3002 \u5c3d\u7ba1\u6709\u8fd9\u4e9b\u7f3a\u70b9\uff0c\u4f46\u5982\u679c\u8fd9\u662f\u8bbf\u95ee\u67d0\u4e9b\u8d44\u6e90\u7684\u552f\u4e00\u65b9\u6cd5\uff0c\u5219\u53ef\u80fd\u5fc5\u987b\u9488\u5bf9\u7279\u5b9a\u7684\u4e8c\u8fdb\u5236\u5e93\u7f16\u8bd1\u6210\u81ea\u5b9a\u4e49\u6a21\u5757\u3002 \u4e00\u4e2ago\u8bed\u8a00\u7684\u4e8c\u8fdb\u5236\u6a21\u5757 helloworld.go","title":"Binary modules"},{"location":"dev/modules/module-architecture/#old-style-modules","text":"\u8001\u5f0f\u6a21\u5757\u7c7b\u4f3c\u4e8e want JSON \u6a21\u5757 \uff0c\u53ea\u662f\u5b83\u4eec\u53c2\u6570\u662f\u4ee5 key=value \u5f62\u5f0f\u4fdd\u5b58\u5728\u6587\u4ef6\u4e2d\uff0c\u800c\u4e0d\u662fJSON\u3002 \u5982\u679c\u6a21\u5757\u4e2d\u6ca1\u6709\u4efb\u4f55\u6807\u8bb0\u53ef\u4ee5\u8868\u660e\u5b83\u662f\u5176\u4ed6\u7c7b\u578b\u4e4b\u4e00\uff0c\u5219Ansible\u4f1a\u786e\u5b9a\u8be5\u6a21\u5757\u4e3a\u8001\u5f0f\u6a21\u5757\u3002 \u4e00\u4e2abash\u811a\u672c\u7684\u4f8b\u5b50 #!/bin/sh args_file = $1 [ ! -f \" $args_file \" ] && echo -n '{\"failed\": true, \"msg\": \"missing required arguments: file\"}' && exit 1 args_result = $( cat $args_file | gawk -F 'file=' '{print $2}' | gawk -F ' ' '{print $1}' ) [ ! -n \" $args_result \" ] && echo -n \"{\\\"failed\\\": true, \\\"msg\\\": \\\"file () is absent, cannot continue\\\", \\\"file\\\": \\\" $args_result \\\"}\" && exit 1 touch $args_result && echo -n \"{\\\"changed\\\": true, \\\"rc\\\": $? ,\\\"file\\\": \\\" $args_result \\\"}\" || echo -n \"{\\\"failed\\\": true, \\\"rc\\\": $? , \\\"file\\\": \\\" $args_result \\\"}\" exit $? \u53c2\u6570\u7684\u5f62\u5f0f # cat args file = /tmp/foo # sh touch.sh args { \"changed\" : true, \"rc\" : 0 , \"file\" : \"/tmp/foo\" }","title":"Old-style modules"},{"location":"dev/modules/module-architecture/#_3","text":"\u5f53\u7528\u6237\u4f7f\u7528 ansible \u6216 ansible-playbook \u65f6\uff0c\u4ed6\u4eec\u6307\u5b9a\u8981\u6267\u884c\u7684\u4efb\u52a1\u3002 \u4efb\u52a1\u901a\u5e38\u662f\u6a21\u5757\u7684\u540d\u79f0\u4ee5\u53ca\u8981\u4f20\u9012\u7ed9\u6a21\u5757\u7684\u51e0\u4e2a\u53c2\u6570\u3002 \u5728\u8fdc\u7a0b\u8ba1\u7b97\u673a\u4e0a\u6267\u884c\u4e4b\u524d\uff0cAnsible\u4f1a\u83b7\u53d6\u8fd9\u4e9b\u503c\u5e76\u4ee5\u5404\u79cd\u65b9\u5f0f\u5bf9\u5176\u8fdb\u884c\u5904\u7406\u3002","title":"\u6a21\u5757\u662f\u5982\u4f55\u6267\u884c\u7684"},{"location":"dev/modules/module-architecture/#executortask_executor","text":"TaskExecutor \u63a5\u6536\u4ece\u5267\u672c\uff08\u6216\u5728 /usr/bin/ansible \u7684\u60c5\u51b5\u4e0b\u4ece\u547d\u4ee4\u884c\uff09\u89e3\u6790\u7684\u6a21\u5757\u540d\u79f0\u548c\u53c2\u6570\u3002 \u5b83\u4f7f\u7528\u540d\u79f0\u6765\u786e\u5b9a\u662f\u5728\u67e5\u770b \u6a21\u5757 \u8fd8\u662f\u5728\u67e5\u770b Action Plugin \u3002 \u5982\u679c\u662f\u6a21\u5757\uff0c\u5b83\u5c06\u52a0\u8f7d \"Normal Action Plugin\" \uff0c\u5e76\u5c06\u540d\u79f0\uff0c\u53d8\u91cf\u548c\u6709\u5173\u4efb\u52a1\u7684\u5176\u4ed6\u4fe1\u606f\u4f20\u9012\u7ed9\u8be5action\u63d2\u4ef6\u4ee5\u8fdb\u884c\u8fdb\u4e00\u6b65\u5904\u7406\u3002","title":"Executor/task_executor"},{"location":"dev/modules/module-architecture/#normal-action-plugin","text":"normal action \u63d2\u4ef6\u5c06\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u6267\u884c\u8be5\u6a21\u5757\u3002\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e3b\u8981\u5185\u5bb9\u5c31\u662f\u6267\u884c\u6a21\u5757\u3002 \u5b83\u4e3a\u4efb\u52a1\u52a0\u8f7d\u9002\u5f53\u7684 \u8fde\u63a5\u63d2\u4ef6 \uff0c\u7136\u540e\u6839\u636e\u9700\u8981\u4f20\u8f93\u6216\u6267\u884c\u4ee5\u521b\u5efa\u4e0e\u8be5\u4e3b\u673a\u7684\u8fde\u63a5\u3002 \u5b83\u5c06Ansible\u7684\u6240\u6709\u5185\u90e8\u5c5e\u6027\u6dfb\u52a0\u5230\u6a21\u5757\u7684\u53c2\u6570\uff08\u4f8b\u5982\uff0c\u5c06no_log\u4f20\u9012\u7ed9\u6a21\u5757\u7684\u5c5e\u6027\uff09\u3002 \u5b83\u53ef\u4ee5\u4e0e\u5176\u4ed6\u63d2\u4ef6\uff08connection, shell, become\uff0c\u5176\u4ed6action\u63d2\u4ef6\uff09\u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u5728\u8fdc\u7a0b\u8ba1\u7b97\u673a\u4e0a\u521b\u5efa\u4e34\u65f6\u6587\u4ef6\uff0c\u7136\u540e\u8fdb\u884c\u6e05\u7406\u3002 \u5b83\u5c06\u6a21\u5757\u548c\u6a21\u5757\u53c2\u6570\u63a8\u9001\u5230\u8fdc\u7a0b\u4e3b\u673a\u3002 \u5b83\u5904\u7406\u6a21\u5757\u7684\u6240\u6709\u7279\u6b8a\u60c5\u51b5\uff08\u4f8b\u5982\uff0c\u5f02\u6b65\u6267\u884c\u6216Windows\u6a21\u5757\u5468\u56f4\u7684\u590d\u6742\u6027\uff0c\u8fd9\u4e9b\u6a21\u5757\u5fc5\u987b\u4e0ePython\u6a21\u5757\u5177\u6709\u76f8\u540c\u7684\u540d\u79f0\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u4ece\u5176\u4ed6Action Plugins\u8fdb\u884c\u5185\u90e8\u6a21\u5757\u8c03\u7528\u3002 \uff09 \u6b64\u529f\u80fd\u5927\u90e8\u5206\u6765\u81ea BaseAction \u7c7b\uff0c\u8be5\u7c7b\u4f4d\u4e8e plugins/action/__ init__.py \u4e2d\u3002 \u5b83\u4f7f\u7528 Connection \u548c Shell \u5bf9\u8c61\u8fdb\u884c\u5de5\u4f5c\u3002 \u5f53\u4f7f\u7528 async \u53c2\u6570\u8fd0\u884c\u4efb\u52a1\u65f6\uff0cAnsible\u5c06\u4f7f\u7528 async action\u63d2\u4ef6\u800c\u4e0d\u662f normal action\u63d2\u4ef6\u6765\u8c03\u7528\u5b83\u3002","title":"normal action plugin"},{"location":"dev/modules/module-architecture/#executormodule_commonpy","text":"executor/module_common.py \u7528\u4e8e\u7ec4\u88c5\u8981\u53d1\u9001\u5230\u53d7\u7ba1\u8282\u70b9\u7684\u6a21\u5757\u3002 \u9996\u5148\u8bfb\u5165\u6a21\u5757\u5185\u5bb9\uff0c\u7136\u540e\u68c0\u67e5\u4ee5\u786e\u5b9a\u5176\u7c7b\u578b\uff1a PowerShell \u548c JSON-args \u6a21\u5757\u901a\u8fc7\u6a21\u5757\u66ff\u6362\u5668\u4f20\u9012\u3002 \u65b0\u5f0fPython\u6a21\u5757\u7531 Assembler frameworks \u7ec4\u88c5\u3002 Non-native-want-JSON , Binary modules , \u548c Old-Style modules \u4e0d\u4f1a\u88ab\u6539\u53d8\u3002 \u7ec4\u88c5\u6b65\u9aa4\u5b8c\u6210\u4e4b\u540e\uff0c\u5bf9\u6240\u6709\u5177\u6709*shebang*\u7684\u6a21\u5757\u8fdb\u884c\u6700\u540e\u4fee\u6539\u3002 Ansible\u68c0\u67e5*shebang*\u884c\u4e2d\u7684\u89e3\u91ca\u5668\u662f\u5426\u5177\u6709\u901a\u8fc7 ansible_$X_interpreter \u6e05\u5355\u53d8\u91cf\u914d\u7f6e\u7684\u7279\u5b9a\u8def\u5f84\u3002 \u5982\u679c\u6709\uff0cAnsible\u4f1a\u5c06\u8be5\u8def\u5f84\u66ff\u6362\u4e3a\u6a21\u5757\u4e2d\u7ed9\u5b9a\u7684\u89e3\u91ca\u5668\u8def\u5f84\u3002 \u6b64\u540e\uff0cAnsible\u5c06\u5b8c\u6574\u7684\u6a21\u5757\u6570\u636e\u548c\u6a21\u5757\u7c7b\u578b\u8fd4\u56de\u5230 normal action \uff0c\u8be5action\u5c06\u7ee7\u7eed\u6267\u884c\u6a21\u5757\u3002","title":"Executor/module_common.py"},{"location":"dev/modules/module-architecture/#assembler-frameworks","text":"Ansible\u652f\u6301\u4e24\u4e2a\u6c47\u7f16\u7a0b\u5e8f\u6846\u67b6\uff1a Ansiballz \u548c Module Replacer (\u65e7\u7684)\u3002","title":"Assembler frameworks"},{"location":"dev/modules/module-architecture/#module-replacer-framework","text":"Module Replacer \u6846\u67b6\u662f\u5b9e\u73b0\u65b0\u578b\u6a21\u5757\u7684\u539f\u59cb\u6846\u67b6\uff0c\u5e76\u4e14\u4ecd\u7528\u4e8e PowerShell \u6a21\u5757\u3002 \u5b83\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u9884\u5904\u7406\u5668\uff08\u5c31\u50cf\u719f\u6089\u8be5\u7f16\u7a0b\u8bed\u8a00\u7684C\u9884\u5904\u7406\u5668\u4e00\u6837\uff09\u3002 \u5b83\u5bf9\u6a21\u5757\u6587\u4ef6\u4e2d\u7684\u7279\u5b9a\u5b50\u5b57\u7b26\u4e32\u6a21\u5f0f\u8fdb\u884c\u76f4\u63a5\u66ff\u6362\u3002 \u6709\u4e24\u79cd\u7c7b\u578b\u7684\u66ff\u6362\uff1a \u4ec5\u5728\u6a21\u5757\u6587\u4ef6\u4e2d\u53d1\u751f\u7684\u66ff\u6362\u3002 \u8fd9\u4e9b\u662f\u6a21\u5757\u7684\u516c\u5171\u66ff\u6362\u5b57\u7b26\u4e32\uff0c\u53ef\u7528\u4e8e\u83b7\u53d6\u6709\u7528\u7684\u6837\u677f\u6216\u8bbf\u95ee\u53c2\u6570\u3002 from ansible.module_utils.MOD_LIB_NAME import * \u66ff\u6362\u6210 ansible.module_utils.MOD_LIB_NAME \u3002\u8fd9\u4e9b\u4ec5\u5e94\u4e0e\u65b0\u578bPython\u6a21\u5757\u4e00\u8d77\u4f7f\u7528\u3002 #<<INCLUDE_ANSIBLE_MODULE_COMMON>> \u7b49\u540c\u4e8e ansible.module_utils.basic import * \uff0c\u5e76\u4e14\u4e5f\u4ec5\u9002\u7528\u4e8e\u65b0\u578bPython\u6a21\u5757\u3002 #POWERSHELL_COMMON \u66ff\u6362 ansible/module_utils/powershell.ps1 \u7684\u5185\u5bb9\u3002 \u5b83\u53ea\u80fd\u4e0e\u65b0\u578bPowershell\u6a21\u5757\u4e00\u8d77\u4f7f\u7528\u3002 ansible.module_utils \u4ee3\u7801\u4f7f\u7528\u7684\u66ff\u6362\u3002 \u8fd9\u4e9b\u662f\u5185\u90e8\u66ff\u6362\u6a21\u5f0f\u3002 \u5b83\u4eec\u53ef\u4ee5\u5728\u4e0a\u9762\u7684\u516c\u5171\u66ff\u6362\u4e2d\u5185\u90e8\u4f7f\u7528\uff0c\u4f46\u4e0d\u5e94\u76f4\u63a5\u7531\u6a21\u5757\u4f7f\u7528\u3002 <<ANSIBLE VERSION>> \u88abANSIBLE VERSION\u66ff\u6362\u3002\u5728Ansiballz\u6846\u67b6\u6846\u67b6\u4e0b\u7684\u65b0\u578bPython\u6a21\u5757\u4e2d\uff0c\u6b63\u786e\u7684\u65b9\u6cd5\u662f\u5b9e\u4f8b\u5316\u4e00\u4e2a AnsibleModul e\uff0c\u7136\u540e\u4ece:attr: AnsibleModule.ansible_version \u8bbf\u95ee\u8fd9\u4e2a\u7248\u672c\u3002 <<INCLUDE_ANSIBLE_MODULE_COMPLEX_ARGS>> \u66ff\u6362\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8be5\u5b57\u7b26\u4e32\u662f\u6a21\u5757\u53c2\u6570\u5728Python\u4e2d\u7684JSON\u7f16\u7801\u3002 \u5728JSON\u5b57\u7b26\u4e32\u4e0a\u4f7f\u7528 repr \u53ef\u4ee5\u5b89\u5168\u5730\u5d4c\u5165\u5230Python\u6587\u4ef6\u4e2d\u3002 \u5728Ansiballz\u6846\u67b6\u4e0b\u7684\u65b0\u578bPython\u6a21\u5757\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b9e\u4f8b\u5316 AnsibleModule \u7136\u540e\u4f7f\u7528 AnsibleModule.params \u6765\u66f4\u597d\u5730\u8fdb\u884c\u8bbf\u95ee\u3002 <<SELINUX_SPECIAL_FILESYSTEMS>> \u66ff\u6362\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8be5\u5b57\u7b26\u4e32\u662f\u4ee5\u9017\u53f7\u5206\u9694\u7684\u6587\u4ef6\u7cfb\u7edf\u5217\u8868\uff0c\u8fd9\u4e9b\u6587\u4ef6\u7cfb\u7edf\u5728SELinux\u4e2d\u5177\u6709\u4e0e\u6587\u4ef6\u7cfb\u7edf\u76f8\u5173\u7684\u5b89\u5168\u4e0a\u4e0b\u6587\u3002 \u5728\u65b0\u578bPython\u6a21\u5757\u4e2d\uff0c\u5982\u679c\u786e\u5b9e\u9700\u8981\u8fd9\u6837\u505a\uff0c\u5219\u5e94\u5b9e\u4f8b\u5316 AnsibleModule \uff0c\u7136\u540e\u4f7f\u7528 AnsibleModule._selinux_special_fs \u3002 \u8be5\u53d8\u91cf\u8fd8\u4ece\u6587\u4ef6\u7cfb\u7edf\u540d\u79f0\u7684\u9017\u53f7\u5206\u9694\u5b57\u7b26\u4e32\u66f4\u6539\u4e3a\u6587\u4ef6\u7cfb\u7edf\u540d\u79f0\u7684\u5b9e\u9645python\u5217\u8868\u3002 <<INCLUDE ANSIBLE MODULE JSON ARGS>> \u5c06MODULE\u53c2\u6570\u66ff\u6362\u4e3aJSON\u5b57\u7b26\u4e32\u3002\u5fc5\u987b\u6ce8\u610f\u6b63\u786e\u5f15\u7528\u5b57\u7b26\u4e32\uff0c\u56e0\u4e3aJSON\u6570\u636e\u53ef\u80fd\u5305\u542b\u5f15\u53f7\u3002\u8fd9\u79cd\u6a21\u5f0f\u5728\u65b0\u578bPython\u6a21\u5757\u4e2d\u6ca1\u6709\u88ab\u66ff\u4ee3\uff0c\u56e0\u4e3a\u5b83\u4eec\u53ef\u4ee5\u901a\u8fc7\u53e6\u4e00\u79cd\u65b9\u5f0f\u83b7\u5f97\u6a21\u5757\u53c2\u6570\u3002 \u5f53\u5b57\u7b26\u4e32 syslog.LOG_USER \u4e0esyslog\u5de5\u5177\u4e00\u8d77\u51fa\u73b0\u65f6\uff0c\u5c31\u4f1a\u88ab\u66ff\u6362\uff0c syslog_facility \u662f\u5728ansible.cfg\u6216\u4efb\u4f55\u9002\u7528\u4e8e\u6b64\u4e3b\u673a\u7684 ansible_syslog_facility \u7f16\u76ee\u53d8\u91cf\u4e2d\u547d\u540d\u7684\u3002\u5728\u65b0\u578b\u7684Python\u6a21\u5757\u4e2d\uff0c\u8fd9\u79cd\u60c5\u51b5\u7565\u6709\u6539\u53d8\u3002\u5982\u679c\u60a8\u786e\u5b9e\u9700\u8981\u8bbf\u95ee\u5b83\uff0c\u60a8\u5e94\u8be5\u5b9e\u4f8b\u5316\u4e00\u4e2a AnsibleModule \uff0c\u7136\u540e\u4f7f\u7528 AnsibleModule._syslog_facility \u8bbf\u95ee\u5b83\u3002\u5b83\u4e0d\u518d\u662f\u5b9e\u9645\u7684syslog\u5de5\u5177\uff0c\u73b0\u5728\u662fsyslog\u5de5\u5177\u7684\u540d\u79f0\u3002","title":"Module Replacer framework"},{"location":"dev/modules/module-architecture/#ansiballz-framework","text":"Ansiballz\u6846\u67b6\u5728Ansible 2.1\u4e2d\u91c7\u7528\uff0c\u5e76\u7528\u4e8e\u6240\u6709\u65b0\u578bPython\u6a21\u5757\u3002 \u4e0e Module Replacer \u4e0d\u540c\uff0cAnsiballz\u5728 ansible/module_utils \u4e2d\u4f7f\u7528\u771f\u5b9e\u7684\u5bfc\u5165Python\u5bf9\u8c61\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u5bf9\u6a21\u5757\u8fdb\u884c\u9884\u5904\u7406\u3002 \u5b83\u901a\u8fc7\u6784\u9020\u4e00\u4e2azip\u6587\u4ef6\u6765\u505a\u5230\u8fd9\u4e00\u70b9-\u5305\u62ec\u6a21\u5757\u6587\u4ef6\uff0c\u6a21\u5757\u5bfc\u5165\u7684 ansible/module_utils \u4e2d\u7684\u6587\u4ef6\u4ee5\u53ca\u4e00\u4e9b\u4f20\u9012\u6a21\u5757\u53c2\u6570\u7684\u6837\u677f\u6587\u4ef6\u3002 \u7136\u540e\uff0c\u5bf9zipfile\u8fdb\u884cBase64\u7f16\u7801\uff0c\u7136\u540e\u5c06\u5176\u5305\u88c5\u5728\u4e00\u4e2a\u5c0f\u7684Python\u811a\u672c\u4e2d\uff0c\u8be5\u811a\u672c\u4f1a\u89e3\u7801Base64\u7f16\u7801\uff0c\u5e76\u5c06zipfile\u653e\u5165\u53d7\u7ba1\u8282\u70b9\u4e0a\u7684temp\u76ee\u5f55\u4e2d\u3002 \u7136\u540e\uff0c\u5b83\u4ec5\u4ecezip\u6587\u4ef6\u4e2d\u63d0\u53d6Ansible\u6a21\u5757\u811a\u672c\uff0c\u5e76\u5c06\u5176\u4e5f\u653e\u7f6e\u5728\u4e34\u65f6\u76ee\u5f55\u4e2d\u3002 \u7136\u540e\uff0c\u5b83\u5c06 PYTHONPATH \u8bbe\u7f6e\u4e3a\u5728zip\u6587\u4ef6\u4e2d\u67e5\u627ePython\u6a21\u5757\uff0c\u5e76\u5c06Ansible\u6a21\u5757\u4f5c\u4e3a\u7279\u6b8a\u540d\u79f0 __main__ \u5bfc\u5165\u3002 \u5c06\u5176\u5bfc\u5165\u4e3a __main__ \u4f1a\u4f7fPython\u8ba4\u4e3a\u5b83\u6b63\u5728\u6267\u884c\u811a\u672c\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u5730\u5bfc\u5165\u6a21\u5757\u3002 \u8fd9\u6837\uff0cAnsible\u53ef\u4ee5\u5728\u8fdc\u7a0b\u8ba1\u7b97\u673a\u4e0a\u7684Python\u5355\u4e2a\u526f\u672c\u4e2d\u8fd0\u884c\u5305\u88c5\u8fc7\u7684\u811a\u672c\u548c\u6a21\u5757\u4ee3\u7801\u3002 \u5728Ansiballz\u4e2d\uff0c\u4ece ansible.module_utils \u5305\u4e2d\u5bfc\u5165\u7684\u4efb\u4f55Python\u6a21\u5757\u90fd\u4f1a\u89e6\u53d1\u5c06\u8be5Python\u6587\u4ef6\u5305\u542b\u5230zipfile\u4e2d\u3002\u6a21\u5757\u4e2d #<<INCLUDE_ANSIBLE_MODULE_COMMON>> \u7684\u5b9e\u4f8b\u7531 ansible.module_utils.basic import * \u8f6c\u6362\u800c\u6765\u3002\u7136\u540e\uff0c ansible/module-utils/basic.py \u4e5f\u5305\u542b\u5728zipfile\u4e2d\u3002 \u81ea\u8eab\u5c06\u626b\u63cf module_utils \u4e2d\u5305\u542b\u7684\u6587\u4ef6\uff0c\u5e76\u4ece module_utils \u4e2d\u5bfc\u5165\u5176\u4ed6Python\u6a21\u5757\uff0c\u4ee5\u4fbf\u5c06\u5176\u5305\u542b\u5728zip\u6587\u4ef6\u4e2d\u3002","title":"Ansiballz framework"},{"location":"dev/modules/module-architecture/#_4","text":"\u4e24\u4e2a\u6846\u67b6\u901a\u8fc7\u4e0d\u540c\u7684\u65b9\u5f0f\u4f20\u9012\u53c2\u6570\uff1a \u5728Module Replacer\u6846\u67b6\u4e2d\uff0c\u6a21\u5757\u53c2\u6570\u88ab\u8f6c\u6362\u6210json\u5316\u7684\u5b57\u7b26\u4e32\uff0c\u5e76\u88ab\u66ff\u6362\u5230\u7ec4\u5408\u7684\u6a21\u5757\u6587\u4ef6\u4e2d\u3002 \u5728Ansiballz\u6846\u67b6\u4e2d\uff0cjson\u5316\u7684\u5b57\u7b26\u4e32\u662fzipfile\u7684\u4e00\u90e8\u5206\u3002\u5c31\u5728\u5305\u88c5\u5668\u811a\u672c\u5c06Ansible\u6a21\u5757\u4f5c\u4e3a\u4e3b\u6a21\u5757\u5bfc\u5165\u4e4b\u524d\uff0c\u5b83\u7528\u53d8\u91cf\u503c\u5bf9\u79c1\u6709\u7684 _ANSIBLE_ARGS \u53d8\u91cf basic.py \u8fdb\u884c\u4e86monkey-patch\u3002\u5f53 ansible.module_utils.basic.AnsibleModule \u5b9e\u4f8b\u5316\u65f6 \uff0c \u5b83\u5c06\u89e3\u6790\u6b64\u5b57\u7b26\u4e32\u5e76\u5c06args\u653e\u5165 AnsibleModule.params \u4e2d\uff0c\u6a21\u5757\u7684\u5176\u4ed6\u4ee3\u7801\u53ef\u4ee5\u5728\u5176\u4e2d\u8bbf\u95ee\u5b83\u3002","title":"\u53c2\u6570\u4f20\u9012"},{"location":"dev/modules/module-architecture/#_5","text":"\u9664\u4e86\u7528\u6237\u5728playbook\u4e2d\u6307\u5b9a\u7684\u53c2\u6570\u5916\uff0cModule Replacer\u6846\u67b6\u548cAnsiballz\u6846\u67b6\u90fd\u5411\u6a21\u5757\u53d1\u9001\u989d\u5916\u7684\u53c2\u6570\u3002\u8fd9\u4e9b\u989d\u5916\u7684\u53c2\u6570\u662f\u5e2e\u52a9\u5b9e\u73b0\u5168\u5c40Ansible\u7279\u6027\u7684\u5185\u90e8\u53c2\u6570\u3002\u6a21\u5757\u901a\u5e38\u4e0d\u9700\u8981\u660e\u786e\u5730\u77e5\u9053\u8fd9\u4e9b\uff0c\u56e0\u4e3a\u529f\u80fd\u662f\u5728ansible\u5b9e\u73b0\u7684\u3002\u6a21\u5757\u8dd1\u9f99\u5957\u3002\u57fa\u672c\u7684\uff0c\u4f46\u67d0\u4e9b\u529f\u80fd\u9700\u8981\u4ece\u6a21\u5757\u7684\u652f\u6301\uff0c\u6240\u4ee5\u4e86\u89e3\u4ed6\u4eec\u4e5f\u662f\u6709\u5e2e\u52a9\u5f00\u53d1\u7684\u3002 \u6b64\u5904\u5217\u51fa\u7684\u5185\u90e8\u53c2\u6570\u662f\u5168\u5c40\u7684\u3002 \u5982\u679c\u9700\u8981\u5728\u81ea\u5b9a\u4e49\u6a21\u5757\u4e2d\u6dfb\u52a0\u672c\u5730\u5185\u90e8\u53c2\u6570\uff0c\u8bf7\u4e3a\u8be5\u7279\u5b9a\u6a21\u5757\u521b\u5efa\u4e00\u4e2aaction\u63d2\u4ef6-\u6709\u5173\u793a\u4f8b\uff0c\u8bf7\u53c2\u89c1copy action\u63d2\u4ef6\u4e2d\u7684 _original_basename \u3002","title":"\u5185\u90e8\u53c2\u6570"},{"location":"dev/modules/module-architecture/#_ansible_no_log","text":"\u5e03\u5c14\u503c\u3002 \u6bcf\u5f53task\u6216paly\u4e2d\u7684\u53c2\u6570\u6307\u5b9ano_log\u65f6\uff0c\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3aTrue\u3002 \u4efb\u4f55\u8c03\u7528 AnsibleModule.log() \u7684\u6a21\u5757\u90fd\u4f1a\u81ea\u52a8\u5904\u7406\u6b64\u95ee\u9898\u3002 \u5982\u679c\u6a21\u5757\u5b9e\u73b0\u81ea\u5df1\u7684\u65e5\u5fd7\u8bb0\u5f55\uff0c\u5219\u9700\u8981\u68c0\u67e5\u8be5\u503c\u3002 \u8981\u8bbf\u95ee\u6a21\u5757\uff0c\u8bf7\u5b9e\u4f8b\u5316 AnsibleModule \uff0c\u7136\u540e\u68c0\u67e5 AnsibleModule.no_log \u7684\u503c\u3002","title":"_ansible_no_log"},{"location":"dev/modules/module-architecture/#_ansible_debug","text":"\u5e03\u5c14\u503c\u3002 \u6253\u5f00\u6216\u5173\u95ed\u66f4\u8be6\u7ec6\u7684\u65e5\u5fd7\u8bb0\u5f55\uff0c\u5e76\u6253\u5f00\u6a21\u5757\u6267\u884c\u7684\u5916\u90e8\u547d\u4ee4\u7684\u65e5\u5fd7\u8bb0\u5f55\u3002 \u5982\u679c\u6a21\u5757\u4f7f\u7528 AnsibleModule.debug() \u800c\u4e0d\u662f AnsibleModule.log() \uff0c\u5219\u4ec5\u5728 _ansible_debug \u8bbe\u7f6e\u4e3aTrue\u65f6\u624d\u8bb0\u5f55\u6d88\u606f\u3002 \u8981\u8fdb\u884c\u8bbe\u7f6e\uff0c\u8bf7\u5728ansible.cfg\u4e2d\u6dfb\u52a0 debug: true \u6216\u8bbe\u7f6e\u73af\u5883\u53d8\u91cfANSIBLE_DEBUG\u3002 \u8981\u8bbf\u95ee\u6a21\u5757\uff0c\u8bf7\u5b9e\u4f8b\u5316 AnsibleModule \u5e76\u8bbf\u95ee AnsibleModule._debug \u3002","title":"_ansible_debug"},{"location":"dev/modules/module-architecture/#_ansible_diff","text":"\u5e03\u5c14\u503c\u3002 \u5982\u679c\u6a21\u5757\u652f\u6301\uff0c\u5219\u544a\u8bc9\u6a21\u5757\u663e\u793a\u8981\u5bf9\u6a21\u677f\u6587\u4ef6\u8fdb\u884c\u7684\u66f4\u6539\u7684\u7edf\u4e00\u5dee\u5f02\u3002 \u8981\u8fdb\u884c\u8bbe\u7f6e\uff0c\u8bf7\u4f20\u9012 --diff \u547d\u4ee4\u884c\u9009\u9879\u3002 \u8981\u8bbf\u95ee\u6a21\u5757\uff0c\u8bf7\u5b9e\u4f8b\u5316 AnsibleModule \u5e76\u8bbf\u95ee AnsibleModule._diff \u3002","title":"_ansible_diff"},{"location":"dev/modules/module-architecture/#_ansible_verbosity","text":"\u672a\u4f7f\u7528\u7684\u3002\u6b64\u503c\u53ef\u7528\u4e8e\u5bf9\u65e5\u5fd7\u8fdb\u884c\u66f4\u7ec6\u7c92\u5ea6\u7684\u63a7\u5236\u3002","title":"_ansible_verbosity"},{"location":"dev/modules/module-architecture/#_ansible_selinux_special_fs","text":"\u5217\u8868\u3002 \u5177\u6709\u7279\u6b8aSELinux\u4e0a\u4e0b\u6587\u7684\u6587\u4ef6\u7cfb\u7edf\u7684\u540d\u79f0\u3002 AnsibleModule\u65b9\u6cd5\u4f7f\u7528\u5b83\u4eec\uff0c\u8be5\u65b9\u6cd5\u5bf9\u6587\u4ef6\u8fdb\u884c\u64cd\u4f5c\uff08\u66f4\u6539\u5c5e\u6027\uff0c\u79fb\u52a8\u548c\u590d\u5236\uff09\u3002 \u8981\u8fdb\u884c\u8bbe\u7f6e\uff0c\u8bf7\u5728ansible.cfg\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u7528\u9017\u53f7\u5206\u9694\u7684\u6587\u4ef6\u7cfb\u7edf\u540d\u79f0\u5b57\u7b26\u4e32\uff1a # ansible.cfg [selinux] special_context_filesystems = nfs,vboxsf,fuse,ramfs,vfat \u5927\u591a\u6570\u6a21\u5757\u53ef\u4ee5\u4f7f\u7528\u5185\u7f6e\u7684AnsibleModule\u65b9\u6cd5\u6765\u5904\u7406\u6587\u4ef6\u3002 \u8981\u8bbf\u95ee\u9700\u8981\u4e86\u89e3\u8fd9\u4e9b\u7279\u6b8a\u4e0a\u4e0b\u6587\u6587\u4ef6\u7cfb\u7edf\u7684\u6a21\u5757\uff0c\u8bf7\u5b9e\u4f8b\u5316 AnsibleModule \u5e76\u68c0\u67e5 AnsibleModule._selinux_special_fs \u4e2d\u7684\u5217\u8868\u3002 \u5728 Module Replacer \u6846\u67b6\u4e2d\uff0c\u5c06\u66ff\u6362 ansible.module_utils.basic.SELINUX_SPECIAL_FS , \u5728Module Replacer\u4e2d\uff0c\u5b83\u662f\u4e00\u4e2a\u7528\u9017\u53f7\u5206\u9694\u7684\u6587\u4ef6\u7cfb\u7edf\u540d\u79f0\u5b57\u7b26\u4e32\u3002 \u5728Ansiballz\u4e0b\u662f\u4e00\u4e2a\u5b9e\u9645\u5217\u8868\u3002","title":"_ansible_selinux_special_fs"},{"location":"dev/modules/module-architecture/#_ansible_syslog_facility","text":"\u6b64\u53c2\u6570\u63a7\u5236Ansible\u6a21\u5757\u767b\u5f55\u5230\u54ea\u4e2asyslog\u5de5\u5177\u3002 \u8981\u8fdb\u884c\u8bbe\u7f6e\uff0c\u8bf7\u66f4\u6539ansible.cfg\u4e2d\u7684 syslog_facility \u503c\u3002 \u5927\u591a\u6570\u6a21\u5757\u5e94\u8be5\u53ea\u4f7f\u7528 AnsibleModule.log() \uff0c\u7136\u540e\u518d\u5229\u7528\u5b83\u3002 \u5982\u679c\u6a21\u5757\u5fc5\u987b\u81ea\u5df1\u4f7f\u7528\u5b83\uff0c\u5219\u5e94\u5b9e\u4f8b\u5316 AnsibleModule \uff0c\u7136\u540e\u4ece AnsibleModule._syslog_facility \u68c0\u7d22syslog\u5de5\u5177\u7684\u540d\u79f0\u3002 Ansiballz\u4ee3\u7801\u6bd4\u65e7\u7684Module Replacer\u6846\u67b6\u4ee3\u7801\u66f4\u7b80\u6d01\uff1a # Old module_replacer way import syslog syslog . openlog ( NAME , 0 , syslog . LOG_USER ) # New Ansiballz way import syslog facility_name = module . _syslog_facility facility = getattr ( syslog , facility_name , syslog . LOG_USER ) syslog . openlog ( NAME , 0 , facility )","title":"_ansible_syslog_facility"},{"location":"dev/modules/module-architecture/#_ansible_version","text":"\u6b64\u53c2\u6570\u4f20\u9012\u8fd0\u884c\u8be5\u6a21\u5757\u7684Ansible\u7248\u672c\u3002 \u8981\u8bbf\u95ee\u5b83\uff0c\u6a21\u5757\u5e94\u5b9e\u4f8b\u5316 AnsibleModule \uff0c\u7136\u540e\u4ece AnsibleModule.ansible_version \u68c0\u7d22\u5b83\u3002 \u8fd9\u5c06\u66ff\u6362Module Replacer \u6846\u67b6\u4e2d\u7684 ansible.module_utils.basic.ANSIBLE_VERSION \u3002","title":"_ansible_version"},{"location":"dev/modules/module-architecture/#_6","text":"\u5728\u6a21\u5757\u6267\u884c\u7ed3\u675f\u65f6\uff0c\u5b83\u5c06\u8981\u8fd4\u56de\u7684\u6570\u636e\u683c\u5f0f\u5316\u4e3aJSON\u5b57\u7b26\u4e32\uff0c\u5e76\u5c06\u8be5\u5b57\u7b26\u4e32\u6253\u5370\u5230\u5176\u6807\u51c6\u8f93\u51fa\u3002 normal action\u63d2\u4ef6\u63a5\u6536JSON\u5b57\u7b26\u4e32\uff0c\u5c06\u5176\u89e3\u6790\u4e3aPython\u5b57\u5178\uff0c\u7136\u540e\u5c06\u5176\u8fd4\u56de\u7ed9\u6267\u884c\u7a0b\u5e8f\u3002 \u5982\u679cAnsible\u6a21\u677f\u5316\u6bcf\u4e2a\u5b57\u7b26\u4e32\u8fd4\u56de\u503c\uff0c\u5219\u5f88\u5bb9\u6613\u53d7\u5230\u6709\u6743\u8bbf\u95ee\u53d7\u7ba1\u8282\u70b9\u7684\u7528\u6237\u7684\u653b\u51fb\u3002 \u5982\u679c\u4e0d\u9053\u5fb7\u7684\u7528\u6237\u5c06\u6076\u610f\u4ee3\u7801\u4f2a\u88c5\u6210Ansible\u8fd4\u56de\u503c\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u5728\u63a7\u5236\u5668\u4e0a\u5c06\u8fd9\u4e9b\u5b57\u7b26\u4e32\u6a21\u677f\u5316\uff0c\u5219Ansible\u53ef\u4ee5\u6267\u884c\u4efb\u610f\u4ee3\u7801\u3002 \u4e3a\u4e86\u9632\u6b62\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff0cAnsible\u5c06\u8fd4\u56de\u6570\u636e\u4e2d\u7684\u6240\u6709\u5b57\u7b26\u4e32\u6807\u8bb0\u4e3a\u201cUnsafe\u201d\uff0c\u9010\u5b57\u53d1\u5c04\u5b57\u7b26\u4e32\u4e2d\u7684\u4efb\u4f55Jinja2\u6a21\u677f\uff0c\u800c\u4e0d\u662fJinja2\u5bf9\u5176\u8fdb\u884c\u6269\u5c55\u3002 \u901a\u8fc7 ActionPlugin._execute_module() \u8c03\u7528\u6a21\u5757\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u5c06\u7531 normal action\u63d2\u4ef6\u81ea\u52a8\u6807\u8bb0\u4e3a\u201cUnsafe\u201d\u3002 \u5982\u679c\u53e6\u4e00\u4e2aaction\u63d2\u4ef6\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u4ece\u6a21\u5757\u68c0\u7d22\u4fe1\u606f\uff0c\u5219\u5b83\u5fc5\u987b\u81ea\u5df1\u5c06\u5176\u8fd4\u56de\u6570\u636e\u6807\u8bb0\u4e3a\u201cUnsafe\u201d\u3002 \u5982\u679caction\u63d2\u4ef6\u672a\u80fd\u5c06\u5176\u7ed3\u679c\u6807\u8bb0\u4e3a\u201c\u4e0dUnsafe\u201d\uff0c\u5219Ansible\u5728\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u6267\u884c\u7a0b\u5e8f\u65f6\u4f1a\u518d\u6b21\u5ba1\u6838\u7ed3\u679c\uff0c\u5c06\u6240\u6709\u5b57\u7b26\u4e32\u6807\u8bb0\u4e3a\u201cUnsafe\u201d\u3002 normal action\u63d2\u4ef6\u4ee5\u7ed3\u679c\u6570\u636e\u4f5c\u4e3a\u53c2\u6570\u6765\u4fdd\u62a4\u81ea\u5df1\u548c\u5b83\u8c03\u7528\u7684\u4efb\u4f55\u5176\u4ed6\u4ee3\u7801\u3002 \u6267\u884c\u7a0b\u5e8f\u4e2d\u7684\u68c0\u67e5\u53ef\u4fdd\u62a4\u6240\u6709\u5176\u4ed6action\u63d2\u4ef6\u7684\u8f93\u51fa\uff0c\u4ece\u800c\u786e\u4fdd\u7531Ansible\u8fd0\u884c\u7684\u540e\u7eed\u4efb\u52a1\u4e5f\u4e0d\u4f1a\u4ece\u8fd9\u4e9b\u7ed3\u679c\u4e2d\u83b7\u53d6\u4efb\u4f55\u6a21\u677f\u3002","title":"\u6a21\u5757\u8fd4\u56de\u503c\u548c\u4e0d\u5b89\u5168\u5b57\u7b26\u4e32"},{"location":"dev/modules/module-architecture/#_7","text":"","title":"\u7279\u6b8a\u4e8b\u9879"},{"location":"dev/modules/module-architecture/#pipelining","text":"Ansible\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u4e4b\u4e00\u5c06\u6a21\u5757\u4f20\u8f93\u5230\u8fdc\u7a0b\u8ba1\u7b97\u673a\uff1a \u5b83\u53ef\u4ee5\u5c06\u6a21\u5757\u5199\u5230\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u7684\u4e34\u65f6\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u4f7f\u7528\u4e0e\u8fdc\u7a0b\u4e3b\u673a\u7684\u7b2c\u4e8c\u4e2a\u8fde\u63a5\u6765\u4f7f\u7528\u6a21\u5757\u6240\u9700\u7684\u89e3\u91ca\u5668\u6267\u884c\u5b83 \u6216\u8005\uff0c\u5b83\u4e5f\u53ef\u4ee5\u4f7f\u7528Pipelining\u6765\u6267\u884c\u6a21\u5757\uff0c\u5c06\u6a21\u5757\u5bfc\u5165\u8fdc\u7a0b\u89e3\u91ca\u5668\u7684stdin\u4e2d\u3002 \u76ee\u524d\uff0cPipelining\u4ec5\u9002\u7528\u4e8e\u7528Python\u7f16\u5199\u7684\u6a21\u5757\uff0c\u56e0\u4e3aAnsible\u53ea\u77e5\u9053Python\u652f\u6301\u8fd9\u79cd\u64cd\u4f5c\u6a21\u5f0f\u3002 \u652f\u6301Pipelining\u610f\u5473\u7740\uff0c\u6a21\u5757\u6709\u6548\u8f7d\u8377\u901a\u8fc7\u6709\u7ebf\u53d1\u9001\u4e4b\u524d\u91c7\u7528\u7684\u4efb\u4f55\u683c\u5f0f\uff0c\u90fd\u5fc5\u987b\u7531Python\u901a\u8fc7stdin\u6267\u884c\u3002","title":"Pipelining"},{"location":"dev/modules/module-architecture/#stdin","text":"\u9009\u62e9\u901a\u8fc7stdin\u4f20\u9012\u53c2\u6570\u7684\u539f\u56e0\u5982\u4e0b\uff1a \u4e0e ANSIBLE_PIPELINING \u7ed3\u5408\u4f7f\u7528\u65f6\uff0c\u53ef\u4ee5\u9632\u6b62\u6a21\u5757\u7684\u53c2\u6570\u4e34\u65f6\u4fdd\u5b58\u5230\u8fdc\u7a0b\u8ba1\u7b97\u673a\u7684\u78c1\u76d8\u4e0a\u3002 \u8fd9\u4f7f\u5f97\u8fdc\u7a0b\u8ba1\u7b97\u673a\u4e0a\u7684\u6076\u610f\u7528\u6237\u66f4\u96be\uff08\u4f46\u5e76\u975e\u4e0d\u53ef\u80fd\uff09\u7a83\u53d6\u81ea\u53d8\u91cf\u4e2d\u53ef\u80fd\u5b58\u5728\u7684\u4efb\u4f55\u654f\u611f\u4fe1\u606f\u3002 \u547d\u4ee4\u884c\u53c2\u6570\u662f\u4e0d\u5b89\u5168\u7684\uff0c\u56e0\u4e3a\u5927\u591a\u6570\u7cfb\u7edf\u5141\u8bb8\u975e\u7279\u6743\u7528\u6237\u8bfb\u53d6\u8fdb\u7a0b\u7684\u5b8c\u6574\u547d\u4ee4\u884c\u3002 \u73af\u5883\u53d8\u91cf\u901a\u5e38\u6bd4\u547d\u4ee4\u884c\u66f4\u5b89\u5168\uff0c\u4f46\u662f\u4e00\u4e9b\u7cfb\u7edf\u9650\u5236\u73af\u5883\u7684\u603b\u4f53\u5927\u5c0f\u3002\u5982\u679c\u8fbe\u5230\u8fd9\u4e2a\u9650\u5236\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u53c2\u6570\u622a\u65ad\u3002","title":"\u4e3a\u4ec0\u4e48\u5728stdin\u4f20\u9012\u53c2\u6570?"},{"location":"dev/modules/module-architecture/#ansiblemodule","text":"","title":"AnsibleModule"},{"location":"dev/modules/module-architecture/#_8","text":"\u63d0\u4f9b\u7ed9 AnsibleModule \u7684 arguments_spec \u5b9a\u4e49\u4e86\u6a21\u5757\u652f\u6301\u7684\u53c2\u6570\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u7c7b\u578b\uff0c\u9ed8\u8ba4\u503c\u548c\u66f4\u591a\u5185\u5bb9\u3002 module = AnsibleModule ( argument_spec = dict ( top_level = dict ( type = 'dict' , options = dict ( second_level = dict ( default = True , type = 'bool' , ) ) ) )) \u53c2\u6570\u7684\u9009\u9879","title":"\u53c2\u6570"},{"location":"dev/modules/module-architecture/#type","text":"type\u5141\u8bb8\u60a8\u5b9a\u4e49\u4e3a\u53c2\u6570\u63a5\u53d7\u7684\u503c\u7684\u7c7b\u578b\u3002\u7c7b\u578b\u7684\u9ed8\u8ba4\u503c\u662fstr\u3002\u53ef\u80fd\u7684\u503c\u662f str list dict bool int float path raw jsonarg json bytes bits raw \u7c7b\u578b\uff0c\u4e0d\u6267\u884c\u4efb\u4f55\u7c7b\u578b\u9a8c\u8bc1\u6216\u7c7b\u578b\u5927\u5c0f\u5199\uff0c\u5e76\u7ef4\u62a4\u4f20\u9012\u503c\u7684\u7c7b\u578b\u3002","title":"type"},{"location":"dev/modules/module-architecture/#elements","text":"\u5f53 type ='list' \u65f6\uff0celements\u4e0etype\u7ed3\u5408\u4f7f\u7528\u3002 \u7136\u540e\u53ef\u4ee5\u5c06elements\u5b9a\u4e49\u4e3a elements ='int' \u6216\u4efb\u4f55\u5176\u4ed6\u7c7b\u578b\uff0c\u6307\u793a\u6307\u5b9a\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u5e94\u8be5\u5c5e\u4e8e\u8be5\u7c7b\u578b\u3002","title":"elements"},{"location":"dev/modules/module-architecture/#default","text":"default \u9009\u9879\u5141\u8bb8\u5728\u4e0d\u5411\u6a21\u5757\u63d0\u4f9b\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u4e3a\u573a\u666f\u7684\u53c2\u6570\u8bbe\u7f6e\u9ed8\u8ba4\u503c\u3002\u672a\u6307\u5b9a\u65f6\uff0c\u9ed8\u8ba4\u503c\u4e3aNone\u3002","title":"default"},{"location":"dev/modules/module-architecture/#fallback","text":"fallback \u63a5\u53d7\u4e00\u4e2a\u5143\u7ec4\uff0c\u5176\u4e2d\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u53ef\u8c03\u7528\u7684\uff08\u51fd\u6570\uff09\uff0c\u5c06\u7528\u4e8e\u57fa\u4e8e\u7b2c\u4e8c\u4e2a\u53c2\u6570\u6267\u884c\u67e5\u627e\u3002 \u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u53ef\u8c03\u7528\u5bf9\u8c61\u63a5\u53d7\u7684\u503c\u7684\u5217\u8868\u3002 \u6700\u5e38\u7528\u7684\u53ef\u8c03\u7528\u65b9\u6cd5\u662f env_fallback \uff0c\u5f53\u4e0d\u63d0\u4f9b\u53c2\u6570\u65f6\uff0c\u5b83\u5c06\u5141\u8bb8\u53c2\u6570\u6709\u9009\u62e9\u5730\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u3002 username = dict ( fallback = ( env_fallback , [ 'ANSIBLE_NET_USERNAME' ]))","title":"fallback"},{"location":"dev/modules/module-architecture/#choices","text":"options\u63a5\u53d7\u53c2\u6570\u5c06\u63a5\u53d7\u7684choices\u5217\u8868\u3002\u9009\u62e9\u7684\u7c7b\u578b\u5e94\u8be5\u4e0e\u7c7b\u578b\u5339\u914d\u3002","title":"choices"},{"location":"dev/modules/module-architecture/#required","text":"required\u63a5\u53d7\u4e00\u4e2a\u5e03\u5c14\u503c\uff0cTrue\u6216False\u8868\u793a\u8be5\u53c2\u6570\u662f\u5fc5\u9700\u7684\u3002 \u8fd9\u4e0d\u5e94\u4e0e\u9ed8\u8ba4\u503c\u7ed3\u5408\u4f7f\u7528\u3002","title":"required"},{"location":"dev/modules/module-architecture/#no_log","text":"no_log\u63a5\u53d7\u5e03\u5c14\u503c\uff08True\u6216False\uff09\uff0c\u8be5\u5e03\u5c14\u503c\u660e\u786e\u6307\u793a\u53c2\u6570\u503c\u662f\u5426\u5e94\u5728\u65e5\u5fd7\u548c\u8f93\u51fa\u4e2d\u5c4f\u853d\u3002","title":"no_log"},{"location":"dev/modules/module-architecture/#aliases","text":"aliases\u63a5\u53d7\u53c2\u6570\u7684\u66ff\u4ee3\u53c2\u6570\u540d\u79f0\u7684\u5217\u8868\uff0c\u4f8b\u5982\u53c2\u6570\u4e3a name \u4f46\u6a21\u5757\u63a5\u53d7 aliases=['pkg'] \u7684\u60c5\u51b5\uff0c\u4ee5\u5141\u8bb8pkg\u4e0e name \u4e92\u6362","title":"aliases"},{"location":"dev/modules/module-architecture/#options","text":"options\u5b9e\u73b0\u4e86\u521b\u5efa\u5b50\u9009\u9879\u7684\u529f\u80fd\uff0c \u672c\u8282\u7684\u793a\u4f8b\u6f14\u793a\u4e86\u9009\u9879\u7684\u4f7f\u7528\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7c7b\u578b\u6216\u5143\u7d20\u5e94\u8be5\u662fdict\u3002","title":"options"},{"location":"dev/modules/module-architecture/#apply_defaults","text":"apply defaults\u4e0eoptions\u4e00\u8d77\u5de5\u4f5c\uff0c\u5e76\u5141\u8bb8\u5e94\u7528\u5b50\u9009\u9879\u7684\u9ed8\u8ba4\u503c\uff0c\u5373\u4f7f\u5728\u6ca1\u6709\u63d0\u4f9b\u9876\u7ea7\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\u4e5f\u662f\u5982\u6b64\u3002","title":"apply_defaults"},{"location":"dev/modules/module-architecture/#removed_in_version","text":"remove_in_version \u6307\u660e\u5c06\u5728\u54ea\u4e2aAnsible\u7248\u672c\u4e2d\u5220\u9664\u4e0d\u63a8\u8350\u4f7f\u7528\u7684\u53c2\u6570\u3002","title":"removed_in_version"},{"location":"dev/modules/module-doc/","text":"\u6dfb\u52a0module\u7684\u6587\u6863\u8bf4\u660e \u00b6 \u6240\u6709\u6a21\u5757\u90fd\u9700\u6309\u4ee5\u4e0b\u987a\u5e8f\u5b9a\u4e49\u4ee5\u4e0b\u90e8\u5206\uff1a shebang ANSIBLE_METADATA DOCUMENTATION EXAMPLES RETURNS Python imports \u5b9a\u4e49 shebang \u00b6 \u8fd9\u91cc\u4ee5python\u8bed\u8a00\u4e3a\u4f8b\uff0c\u5b9a\u4e49python\u89e3\u91ca\u5668\u8def\u5f84\u548c\u7f16\u7801\uff0c\u53e6\u5916\u8bb8\u53ef\u4fe1\u606f\u4e5f\u8981\u6dfb\u52a0\u8fdb\u6765\u3002 #!/usr/bin/python # -*- coding: utf-8 -*- # Copyright: (c) 2018, Terry Jones <terry.jones@example.org> # GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt) \u5b9a\u4e49ANSIBLE_METADATA \u00b6 \u8be5\u53d8\u91cf\u63cf\u8ff0\u6709\u5173\u5176\u4ed6\u5de5\u5177\u4f7f\u7528\u7684\u6a21\u5757\u7684\u4fe1\u606f ANSIBLE_METADATA = { 'metadata_version' : '1.0' , 'status' : [ 'preview' ], 'supported_by' : 'community' } metadata_version \u662fansible\u5143\u6570\u636e( ANSIBLE_METADATA )\u7684\u7248\u672c supported_by \u6307\u7684\u662f\u8c01\u652f\u6301\u8fd9\u4e2a\u6a21\u5757\uff0c\u9ed8\u8ba4\u503c community , \u5176\u4ed6\u7684\u53ef\u9009\u503ccore, network, certified status \u5b57\u7b26\u4e32\u5217\u8868\uff0c\u63cf\u8ff0\u6a21\u5757\u7a33\u5b9a\u7684\u7a0b\u5ea6\u3002\u53ef\u9009\u503cstableinterface(\u7a33\u5b9a),preview(\u9884\u89c8\uff0c\u53ef\u80fd\u4e0d\u7a33\u5b9a)\uff0cdeprecated(\u5f03\u7528)\uff0cremoved(\u5220\u9664\u72b6\u6001\uff0c\u53ea\u4fdd\u7559\u4e0d\u4f7f\u7528) \u5b9a\u4e49DOCUMENTATION \u00b6 \u8be5\u53d8\u91cf\u63cf\u8ff0\u6a21\u5757\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u53c2\u6570\uff0c\u4f5c\u8005\u548c\u5176\u4ed6\u4fe1\u606f\u3002 DOCUMENTATION = ''' --- module: remote_copy short_description: Copy a file on the remote host version_added: \"2.9\" description: - The remote_copy module copies a file on the remote host from a given source to a provided destination. options: source: description: - Path to a file on the source file on the remote host required: true dest: description: - Path to the destination on the remote host for the copy required: true author: - \"Lework\" ''' module \u6a21\u5757\u540d\u79f0\uff0c\u5fc5\u987b\u4e0e\u6587\u4ef6\u540d\u79f0\u4e00\u81f4\uff0c\u4f46\u6ca1\u6709\u6269\u5c55\u540d .py short_description \u7b80\u77ed\u63cf\u8ff0 version_added \u6a21\u5757\u5728ansible\u54ea\u4e2a\u7248\u672c\u6dfb\u52a0\u7684 description \u8be6\u7ec6\u63cf\u8ff0 options \u6a21\u5757\u7684\u9009\u9879 option-name \u9009\u9879\u540d\u79f0 description \u63cf\u8ff0 required \u662f\u5426\u5fc5\u987b default \u9ed8\u8ba4\u503c choices \u63a5\u53d7\u7684\u503c\u5217\u8868 type \u503c\u7c7b\u578b elements list\u5143\u7d20\u7684\u6570\u636e\u7c7b\u578b aliases \u9009\u9879\u522b\u540d version_added \u5728ansible\u54ea\u4e2a\u7248\u672c\u6dfb\u52a0\u7684 suboptions \u5982\u679c\u6b64\u9009\u9879\u91c7\u7528\u5b57\u5178\u6216\u5b57\u5178\u5217\u8868\uff0c\u5219\u53ef\u4ee5\u5728\u6b64\u5904\u5b9a\u4e49\u7ed3\u6784\u3002 author \u6a21\u5757\u7684\u4f5c\u8005\u540d\u79f0 deprecated \u5f03\u7528\u6807\u8bc6 requirements \u4f9d\u8d56\u5217\u8868 seealso \u5bf9\u5176\u4ed6\u6a21\u5757\u7684\u5f15\u7528 notes \u5176\u4ed6\u4fe1\u606f \u5b9a\u4e49EXAMPLES \u00b6 \u8be5\u53d8\u91cf\u7528\u6765\u63cf\u8ff0\u6a21\u5757\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u793a\u4f8b\u4f7f\u7528 \u4f7f\u7528yaml\u683c\u5f0f\u7684\u4f7f\u7528\u793a\u4f8b\u3002 EXAMPLES = ''' # Example from Ansible Playbooks - name: backup a config file remote_copy: source: /tmp/foo dest: /tmp/bar ''' \u5b9a\u4e49RETURN \u00b6 \u8be5\u53d8\u91cf\u7528\u6765\u63cf\u8ff0\u6a21\u5757\u7684\u8fd4\u56de\u6570\u636e\u4fe1\u606f \u6dfb\u52a0\u53c2\u6570source\u548cdest\u8fd4\u56de\u4fe1\u606f RETURN = ''' source: description: Path to a file on the source file on the remote host type: str returned: success sample: \"/path/to/file.name\" dest: description: Path to the destination on the remote host for the copy type: string returned: success sample: \"/path/to/destination.file\" ''' \u5b57\u7b26\u4e32\u7684\u683c\u5f0f\u4e3ayaml\u683c\u5f0f\uff0c\u5982\u679c\u6a21\u5757\u6ca1\u6709\u8fd4\u56de\u503c\u5219\u5e94\u8be5 RETURN = r''' # ''' \u8fd4\u56de return name: \u8fd4\u56de\u7684\u53c2\u6570\u540d\u79f0 description \u53c2\u6570\u63cf\u8ff0 returned \u662f\u6210\u529f(success)\u8fd4\u56de\u8fd8\u662f\u603b\u8981(always)\u8fd4\u56de type \u6570\u636e\u7c7b\u578b elements \u5982\u679ctype ='list'\uff0c\u5219\u6307\u5b9a\u5217\u8868\u5143\u7d20\u7684\u6570\u636e\u7c7b\u578b\u3002 sample \u503c\u793a\u4f8b version_added \u5728ansible\u54ea\u4e2a\u7248\u672c\u6dfb\u52a0\u7684 contains \u53ef\u9009\u7684\u3002 \u8981\u63cf\u8ff0\u5d4c\u5957\u7684\u8fd4\u56de\u503c Python impots \u00b6 \u4f7f\u7528 AnsibleModule \u6765\u6784\u5efaansible\u6a21\u5757 from module_utils.basic import AnsibleModule \u663e\u793a\u6a21\u5757\u5e2e\u52a9\u4fe1\u606f \u00b6 \u53ef\u4ee5\u901a\u8fc7 ansible-doc \u6765\u67e5\u770b\u8fd9\u4e9b\u5e2e\u52a9\u4fe1\u606f \u663e\u793a\u5168\u90e8\u4fe1\u606f # ansible-doc -M /etc/ansible/library/ remote_copy > REMOTE_COPY ( /etc/ansible/library/remote_copy.py ) The remote_copy module copies a file on the remote host from a given source to a provided destination. * This module is maintained by The Ansible Community OPTIONS (= is mandatory ) : = dest Path to the destination on the remote host for the copy = source Path to a file on the source file on the remote host AUTHOR: Lework METADATA: status: - preview supported_by: community EXAMPLES: # Example from Ansible Playbooks - name: backup a config file remote_copy: source: /tmp/foo dest: /tmp/bar RETURN VALUES: source: description: Path to a file on the source file on the remote host type: str returned: success sample: \"/path/to/file.name\" dest: description: Path to the destination on the remote host for the copy type: string returned: success sample: \"/path/to/destination.file\" \u663e\u793a\u7b80\u77ed\u4fe1\u606f # ansible-doc -M /etc/ansible/library/ remote_copy -s \u6a21\u5757\u6587\u6863\u4e2d\u7684\u94fe\u63a5 \u00b6 \u60a8\u53ef\u4ee5\u4ece\u6a21\u5757\u6587\u6863\u94fe\u63a5\u5230\u5176\u4ed6\u6a21\u5757\u6587\u6863\uff0c\u5728docs.ansible.com\u4e0a\u53ef\u4ee5\u8d85\u94fe\u63a5\u5230\u5176\u4ed6\u8d44\u6e90\u4ee5\u53caInternet\u4e0a\u5176\u4ed6\u8d44\u6e90\u3002 \u8fd9\u4e9b\u94fe\u63a5\u7684\u6b63\u786e\u683c\u5f0f\u662f\uff1a \u51fd\u6570 \u63cf\u8ff0 \u4f8b\u5b50 L() \u683c\u5f0f\u5316\u5e26\u6709\u6807\u9898\u7684\u94fe\u63a5 L(IOS Platform Options guide,../network/user_guide/platform_ios.html) U() \u683c\u5f0f\u5316url Required if I(state=present) I() \u683c\u5f0f\u5316\u9009\u9879\u540d\u79f0 Mutually exclusive with I(project_src) and I(files M() \u683c\u5f0f\u5316\u6a21\u5757\u540d\u79f0 See also M(win_copy) or M(win_template). C() \u683c\u5f0f\u5316\u6587\u4ef6\u548c\u9009\u9879\u503c Or if not set the environment variable C(ACME_PASSWORD) will be used. Documentation \u52a0\u8f7d\u5916\u90e8\u7684\u6587\u6863 \u00b6 \u67d0\u4e9b\u7c7b\u522b\u7684\u6a21\u5757\u6709\u5171\u540c\u7684\u6587\u6863\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528docs_fragments\u5171\u4eab\u51fa\u6765\u3002 \u6240\u6709\u7684docs_fragments\u90fd\u53ef\u4ee5\u5728lib/ansible/utils/module_docs_fragments/ \u76ee\u5f55\u4e0b\u627e\u5230 \u5728 Documentation \u5b57\u7b26\u4e32\u4e2d\u6dfb\u52a0\u4e0b\u5217\u5b57\u6bb5\uff0c\u5c31\u53ef\u4ee5\u6dfb\u52a0\u5916\u90e8\u7684\u6587\u6863\u4fe1\u606f extends_documentation_fragment: - files - validate \u793a\u4f8b: example_fragment.py class ModuleDocFragment ( object ): # Standard documentation DOCUMENTATION = r ''' options: # options here ''' # Additional section OTHER = r ''' options: # other options here '''","title":"module \u7684\u5e2e\u52a9\u6587\u6863"},{"location":"dev/modules/module-doc/#module","text":"\u6240\u6709\u6a21\u5757\u90fd\u9700\u6309\u4ee5\u4e0b\u987a\u5e8f\u5b9a\u4e49\u4ee5\u4e0b\u90e8\u5206\uff1a shebang ANSIBLE_METADATA DOCUMENTATION EXAMPLES RETURNS Python imports","title":"\u6dfb\u52a0module\u7684\u6587\u6863\u8bf4\u660e"},{"location":"dev/modules/module-doc/#shebang","text":"\u8fd9\u91cc\u4ee5python\u8bed\u8a00\u4e3a\u4f8b\uff0c\u5b9a\u4e49python\u89e3\u91ca\u5668\u8def\u5f84\u548c\u7f16\u7801\uff0c\u53e6\u5916\u8bb8\u53ef\u4fe1\u606f\u4e5f\u8981\u6dfb\u52a0\u8fdb\u6765\u3002 #!/usr/bin/python # -*- coding: utf-8 -*- # Copyright: (c) 2018, Terry Jones <terry.jones@example.org> # GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)","title":"\u5b9a\u4e49 shebang"},{"location":"dev/modules/module-doc/#ansible_metadata","text":"\u8be5\u53d8\u91cf\u63cf\u8ff0\u6709\u5173\u5176\u4ed6\u5de5\u5177\u4f7f\u7528\u7684\u6a21\u5757\u7684\u4fe1\u606f ANSIBLE_METADATA = { 'metadata_version' : '1.0' , 'status' : [ 'preview' ], 'supported_by' : 'community' } metadata_version \u662fansible\u5143\u6570\u636e( ANSIBLE_METADATA )\u7684\u7248\u672c supported_by \u6307\u7684\u662f\u8c01\u652f\u6301\u8fd9\u4e2a\u6a21\u5757\uff0c\u9ed8\u8ba4\u503c community , \u5176\u4ed6\u7684\u53ef\u9009\u503ccore, network, certified status \u5b57\u7b26\u4e32\u5217\u8868\uff0c\u63cf\u8ff0\u6a21\u5757\u7a33\u5b9a\u7684\u7a0b\u5ea6\u3002\u53ef\u9009\u503cstableinterface(\u7a33\u5b9a),preview(\u9884\u89c8\uff0c\u53ef\u80fd\u4e0d\u7a33\u5b9a)\uff0cdeprecated(\u5f03\u7528)\uff0cremoved(\u5220\u9664\u72b6\u6001\uff0c\u53ea\u4fdd\u7559\u4e0d\u4f7f\u7528)","title":"\u5b9a\u4e49ANSIBLE_METADATA"},{"location":"dev/modules/module-doc/#documentation","text":"\u8be5\u53d8\u91cf\u63cf\u8ff0\u6a21\u5757\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u53c2\u6570\uff0c\u4f5c\u8005\u548c\u5176\u4ed6\u4fe1\u606f\u3002 DOCUMENTATION = ''' --- module: remote_copy short_description: Copy a file on the remote host version_added: \"2.9\" description: - The remote_copy module copies a file on the remote host from a given source to a provided destination. options: source: description: - Path to a file on the source file on the remote host required: true dest: description: - Path to the destination on the remote host for the copy required: true author: - \"Lework\" ''' module \u6a21\u5757\u540d\u79f0\uff0c\u5fc5\u987b\u4e0e\u6587\u4ef6\u540d\u79f0\u4e00\u81f4\uff0c\u4f46\u6ca1\u6709\u6269\u5c55\u540d .py short_description \u7b80\u77ed\u63cf\u8ff0 version_added \u6a21\u5757\u5728ansible\u54ea\u4e2a\u7248\u672c\u6dfb\u52a0\u7684 description \u8be6\u7ec6\u63cf\u8ff0 options \u6a21\u5757\u7684\u9009\u9879 option-name \u9009\u9879\u540d\u79f0 description \u63cf\u8ff0 required \u662f\u5426\u5fc5\u987b default \u9ed8\u8ba4\u503c choices \u63a5\u53d7\u7684\u503c\u5217\u8868 type \u503c\u7c7b\u578b elements list\u5143\u7d20\u7684\u6570\u636e\u7c7b\u578b aliases \u9009\u9879\u522b\u540d version_added \u5728ansible\u54ea\u4e2a\u7248\u672c\u6dfb\u52a0\u7684 suboptions \u5982\u679c\u6b64\u9009\u9879\u91c7\u7528\u5b57\u5178\u6216\u5b57\u5178\u5217\u8868\uff0c\u5219\u53ef\u4ee5\u5728\u6b64\u5904\u5b9a\u4e49\u7ed3\u6784\u3002 author \u6a21\u5757\u7684\u4f5c\u8005\u540d\u79f0 deprecated \u5f03\u7528\u6807\u8bc6 requirements \u4f9d\u8d56\u5217\u8868 seealso \u5bf9\u5176\u4ed6\u6a21\u5757\u7684\u5f15\u7528 notes \u5176\u4ed6\u4fe1\u606f","title":"\u5b9a\u4e49DOCUMENTATION"},{"location":"dev/modules/module-doc/#examples","text":"\u8be5\u53d8\u91cf\u7528\u6765\u63cf\u8ff0\u6a21\u5757\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u793a\u4f8b\u4f7f\u7528 \u4f7f\u7528yaml\u683c\u5f0f\u7684\u4f7f\u7528\u793a\u4f8b\u3002 EXAMPLES = ''' # Example from Ansible Playbooks - name: backup a config file remote_copy: source: /tmp/foo dest: /tmp/bar '''","title":"\u5b9a\u4e49EXAMPLES"},{"location":"dev/modules/module-doc/#return","text":"\u8be5\u53d8\u91cf\u7528\u6765\u63cf\u8ff0\u6a21\u5757\u7684\u8fd4\u56de\u6570\u636e\u4fe1\u606f \u6dfb\u52a0\u53c2\u6570source\u548cdest\u8fd4\u56de\u4fe1\u606f RETURN = ''' source: description: Path to a file on the source file on the remote host type: str returned: success sample: \"/path/to/file.name\" dest: description: Path to the destination on the remote host for the copy type: string returned: success sample: \"/path/to/destination.file\" ''' \u5b57\u7b26\u4e32\u7684\u683c\u5f0f\u4e3ayaml\u683c\u5f0f\uff0c\u5982\u679c\u6a21\u5757\u6ca1\u6709\u8fd4\u56de\u503c\u5219\u5e94\u8be5 RETURN = r''' # ''' \u8fd4\u56de return name: \u8fd4\u56de\u7684\u53c2\u6570\u540d\u79f0 description \u53c2\u6570\u63cf\u8ff0 returned \u662f\u6210\u529f(success)\u8fd4\u56de\u8fd8\u662f\u603b\u8981(always)\u8fd4\u56de type \u6570\u636e\u7c7b\u578b elements \u5982\u679ctype ='list'\uff0c\u5219\u6307\u5b9a\u5217\u8868\u5143\u7d20\u7684\u6570\u636e\u7c7b\u578b\u3002 sample \u503c\u793a\u4f8b version_added \u5728ansible\u54ea\u4e2a\u7248\u672c\u6dfb\u52a0\u7684 contains \u53ef\u9009\u7684\u3002 \u8981\u63cf\u8ff0\u5d4c\u5957\u7684\u8fd4\u56de\u503c","title":"\u5b9a\u4e49RETURN"},{"location":"dev/modules/module-doc/#python-impots","text":"\u4f7f\u7528 AnsibleModule \u6765\u6784\u5efaansible\u6a21\u5757 from module_utils.basic import AnsibleModule","title":"Python impots"},{"location":"dev/modules/module-doc/#_1","text":"\u53ef\u4ee5\u901a\u8fc7 ansible-doc \u6765\u67e5\u770b\u8fd9\u4e9b\u5e2e\u52a9\u4fe1\u606f \u663e\u793a\u5168\u90e8\u4fe1\u606f # ansible-doc -M /etc/ansible/library/ remote_copy > REMOTE_COPY ( /etc/ansible/library/remote_copy.py ) The remote_copy module copies a file on the remote host from a given source to a provided destination. * This module is maintained by The Ansible Community OPTIONS (= is mandatory ) : = dest Path to the destination on the remote host for the copy = source Path to a file on the source file on the remote host AUTHOR: Lework METADATA: status: - preview supported_by: community EXAMPLES: # Example from Ansible Playbooks - name: backup a config file remote_copy: source: /tmp/foo dest: /tmp/bar RETURN VALUES: source: description: Path to a file on the source file on the remote host type: str returned: success sample: \"/path/to/file.name\" dest: description: Path to the destination on the remote host for the copy type: string returned: success sample: \"/path/to/destination.file\" \u663e\u793a\u7b80\u77ed\u4fe1\u606f # ansible-doc -M /etc/ansible/library/ remote_copy -s","title":"\u663e\u793a\u6a21\u5757\u5e2e\u52a9\u4fe1\u606f"},{"location":"dev/modules/module-doc/#_2","text":"\u60a8\u53ef\u4ee5\u4ece\u6a21\u5757\u6587\u6863\u94fe\u63a5\u5230\u5176\u4ed6\u6a21\u5757\u6587\u6863\uff0c\u5728docs.ansible.com\u4e0a\u53ef\u4ee5\u8d85\u94fe\u63a5\u5230\u5176\u4ed6\u8d44\u6e90\u4ee5\u53caInternet\u4e0a\u5176\u4ed6\u8d44\u6e90\u3002 \u8fd9\u4e9b\u94fe\u63a5\u7684\u6b63\u786e\u683c\u5f0f\u662f\uff1a \u51fd\u6570 \u63cf\u8ff0 \u4f8b\u5b50 L() \u683c\u5f0f\u5316\u5e26\u6709\u6807\u9898\u7684\u94fe\u63a5 L(IOS Platform Options guide,../network/user_guide/platform_ios.html) U() \u683c\u5f0f\u5316url Required if I(state=present) I() \u683c\u5f0f\u5316\u9009\u9879\u540d\u79f0 Mutually exclusive with I(project_src) and I(files M() \u683c\u5f0f\u5316\u6a21\u5757\u540d\u79f0 See also M(win_copy) or M(win_template). C() \u683c\u5f0f\u5316\u6587\u4ef6\u548c\u9009\u9879\u503c Or if not set the environment variable C(ACME_PASSWORD) will be used.","title":"\u6a21\u5757\u6587\u6863\u4e2d\u7684\u94fe\u63a5"},{"location":"dev/modules/module-doc/#documentation_1","text":"\u67d0\u4e9b\u7c7b\u522b\u7684\u6a21\u5757\u6709\u5171\u540c\u7684\u6587\u6863\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528docs_fragments\u5171\u4eab\u51fa\u6765\u3002 \u6240\u6709\u7684docs_fragments\u90fd\u53ef\u4ee5\u5728lib/ansible/utils/module_docs_fragments/ \u76ee\u5f55\u4e0b\u627e\u5230 \u5728 Documentation \u5b57\u7b26\u4e32\u4e2d\u6dfb\u52a0\u4e0b\u5217\u5b57\u6bb5\uff0c\u5c31\u53ef\u4ee5\u6dfb\u52a0\u5916\u90e8\u7684\u6587\u6863\u4fe1\u606f extends_documentation_fragment: - files - validate \u793a\u4f8b: example_fragment.py class ModuleDocFragment ( object ): # Standard documentation DOCUMENTATION = r ''' options: # options here ''' # Additional section OTHER = r ''' options: # other options here '''","title":"Documentation \u52a0\u8f7d\u5916\u90e8\u7684\u6587\u6863"},{"location":"dev/modules/module-docker-facts/","text":"docker_facts \u6a21\u5757 \u00b6 \u53ea\u8fd4\u56defacts\u6570\u636e\u7684\u6a21\u5757 \u529f\u80fd\u5b9e\u73b0 \u00b6 \u83b7\u53d6\u8fdc\u7a0b\u4e3b\u673a\u7684docker\u4fe1\u606f\uff0c\u5e76\u5c06\u5176\u6ce8\u518c\u5230facts\u6570\u636e\u4e2d\u3002 \u521b\u5efamodule \u00b6 \u672c\u4f8b\u4f7f\u7528shell\u811a\u672c file: library/docker_facts.sh #!/bin/bash ANSIBLE_METADATA = \"{'metadata_version': '1.0', 'status': ['preview'], 'supported_by': 'community'}\" DOCUMENTATION = \" --- module: docker_facts short_description: Get docker facts data version_added: '2.9' description: - Get docker facts data on remote host. author: - 'Lework' \" EXAMPLES = \" # Example from Ansible Playbooks - name: get docker facts docker_facts: \" RETURN = \" ansible_facts: description: docker facts type: dict returned: always \" set -e cat <<EOF { \"ansible_facts\": { \"docker_server_version\": \"$(docker version -f '{{.Server.Version}}')\", \"docker_client_version\": \"$(docker version -f '{{.Client.Version}}')\", \"docker_info\": $(curl -s --unix-socket /var/run/docker.sock http://:/info), \"docker_version\": $(curl -s --unix-socket /var/run/docker.sock http://:/version), \"docker_containers\": $(curl -s --unix-socket /var/run/docker.sock http://:/containers/json?all=true), \"docker_images\": $(curl -s --unix-socket /var/run/docker.sock http://:/images/json) }, \"changed\": false } EOF exit 0 \u8fd0\u884cmodule \u00b6 \u672c\u5730\u8fd0\u884c\u6d4b\u8bd5 \u00b6 # chmod +x library/docker_facts.sh # ./library/docker_facts.sh { \"ansible_facts\" : { \"docker_server_version\" : \"18.09.6\" , \"docker_client_version\" : \"18.09.6\" , \"docker_info\" : { \"ID\" : \"7SAH:IRUL:HLJO:O5N4:32CG:HGCK:MHR7:OJHS:6UBH:NM6I:KVFY:BOKL\" , \"Containers\" :2, \"ContainersRunning\" :0, \"ContainersPaused\" :0, \"ContainersStopped\" :2, \"Images\" :2, \"Driver\" : \"overlay2\" , \"DriverStatus\" : [[ \"Backing Filesystem\" , \"xfs\" ] , [ \"Supports d_type\" , \"true\" ] , [ \"Native Overlay Diff\" , \"true\" ]] , \"SystemStatus\" :null, \"Plugins\" : { \"Volume\" : [ \"local\" ] , \"Network\" : [ \"bridge\" , \"host\" , \"macvlan\" , \"null\" , \"overlay\" ] , \"Authorization\" :null, \"Log\" : [ \"awslogs\" , \"fluentd\" , \"gcplogs\" , \"gelf\" , \"journald\" , \"json-file\" , \"local\" , \"logentries\" , \"splunk\" , \"syslog\" ]} , \"MemoryLimit\" :true, \"SwapLimit\" :true, \"KernelMemory\" :true, \"CpuCfsPeriod\" :true, \"CpuCfsQuota\" :true, \"CPUShares\" :true, \"CPUSet\" :true, \"IPv4Forwarding\" :true, \"BridgeNfIptables\" :false, \"BridgeNfIp6tables\" :false, \"Debug\" :false, \"NFd\" :22, \"OomKillDisable\" :true, \"NGoroutines\" :37, \"SystemTime\" : \"2020-04-13T12:11:06.689886761+08:00\" , \"LoggingDriver\" : \"json-file\" , \"CgroupDriver\" : \"cgroupfs\" , \"NEventsListener\" :0, \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"OperatingSystem\" : \"CentOS Linux 7 (Core)\" , \"OSType\" : \"linux\" , \"Architecture\" : \"x86_64\" , \"IndexServerAddress\" : \"https://index.docker.io/v1/\" , \"RegistryConfig\" : { \"AllowNondistributableArtifactsCIDRs\" : [] , \"AllowNondistributableArtifactsHostnames\" : [] , \"InsecureRegistryCIDRs\" : [ \"127.0.0.0/8\" ] , \"IndexConfigs\" : { \"docker.io\" : { \"Name\" : \"docker.io\" , \"Mirrors\" : [ \"http://dockerhub.azk8s.cn/\" ] , \"Secure\" :true, \"Official\" :true }} , \"Mirrors\" : [ \"http://dockerhub.azk8s.cn/\" ]} , \"NCPU\" :1, \"MemTotal\" :1007276032, \"GenericResources\" :null, \"DockerRootDir\" : \"/var/lib/docker\" , \"HttpProxy\" : \"\" , \"HttpsProxy\" : \"\" , \"NoProxy\" : \"\" , \"Name\" : \"node130\" , \"Labels\" : [] , \"ExperimentalBuild\" :false, \"ServerVersion\" : \"18.09.6\" , \"ClusterStore\" : \"\" , \"ClusterAdvertise\" : \"\" , \"Runtimes\" : { \"runc\" : { \"path\" : \"runc\" }} , \"DefaultRuntime\" : \"runc\" , \"Swarm\" : { \"NodeID\" : \"\" , \"NodeAddr\" : \"\" , \"LocalNodeState\" : \"inactive\" , \"ControlAvailable\" :false, \"Error\" : \"\" , \"RemoteManagers\" :null } , \"LiveRestoreEnabled\" :true, \"Isolation\" : \"\" , \"InitBinary\" : \"docker-init\" , \"ContainerdCommit\" : { \"ID\" : \"bb71b10fd8f58240ca47fbb579b9d1028eea7c84\" , \"Expected\" : \"bb71b10fd8f58240ca47fbb579b9d1028eea7c84\" } , \"RuncCommit\" : { \"ID\" : \"2b18fe1d885ee5083ef9f0838fee39b62d653e30\" , \"Expected\" : \"2b18fe1d885ee5083ef9f0838fee39b62d653e30\" } , \"InitCommit\" : { \"ID\" : \"fec3683\" , \"Expected\" : \"fec3683\" } , \"SecurityOptions\" : [ \"name=seccomp,profile=default\" ] , \"ProductLicense\" : \"Community Engine\" , \"Warnings\" : [ \"WARNING: bridge-nf-call-iptables is disabled\" , \"WARNING: bridge-nf-call-ip6tables is disabled\" ]} , \"docker_version\" : { \"Platform\" : { \"Name\" : \"Docker Engine - Community\" } , \"Components\" : [{ \"Name\" : \"Engine\" , \"Version\" : \"18.09.6\" , \"Details\" : { \"ApiVersion\" : \"1.39\" , \"Arch\" : \"amd64\" , \"BuildTime\" : \"2019-05-04T02:02:43.000000000+00:00\" , \"Experimental\" : \"false\" , \"GitCommit\" : \"481bc77\" , \"GoVersion\" : \"go1.10.8\" , \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"MinAPIVersion\" : \"1.12\" , \"Os\" : \"linux\" }}] , \"Version\" : \"18.09.6\" , \"ApiVersion\" : \"1.39\" , \"MinAPIVersion\" : \"1.12\" , \"GitCommit\" : \"481bc77\" , \"GoVersion\" : \"go1.10.8\" , \"Os\" : \"linux\" , \"Arch\" : \"amd64\" , \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"BuildTime\" : \"2019-05-04T02:02:43.000000000+00:00\" } , \"docker_containers\" : [{ \"Id\" : \"cb323ddf4982cd46d8b89a4c7a349ba515c183d2b3364b3edd5687ce34f78ad0\" , \"Names\" : [ \"/keen_jackson\" ] , \"Image\" : \"ubuntu:latest\" , \"ImageID\" : \"sha256:4e5021d210f65ebe915670c7089120120bc0a303b90208592851708c1b8c04bd\" , \"Command\" : \"bash\" , \"Created\" :1586312956, \"Ports\" : [] , \"Labels\" : {} , \"State\" : \"exited\" , \"Status\" : \"Exited (255) 13 minutes ago\" , \"HostConfig\" : { \"NetworkMode\" : \"default\" } , \"NetworkSettings\" : { \"Networks\" : { \"bridge\" : { \"IPAMConfig\" :null, \"Links\" :null, \"Aliases\" :null, \"NetworkID\" : \"82382b47b631f9c295d2ba2f9456b90d9d17a65eefae08da916c321dd6504167\" , \"EndpointID\" : \"ece9b5d82c6e5ae16a23159dd8ffc0f87b6e77808418c47c70ea72c1d81496b4\" , \"Gateway\" : \"172.17.0.1\" , \"IPAddress\" : \"172.17.0.3\" , \"IPPrefixLen\" :16, \"IPv6Gateway\" : \"\" , \"GlobalIPv6Address\" : \"\" , \"GlobalIPv6PrefixLen\" :0, \"MacAddress\" : \"02:42:ac:11:00:03\" , \"DriverOpts\" :null }}} , \"Mounts\" : []} , { \"Id\" : \"f51ab9f8490bae100763c5b7b1eb2e3470efec5b2fa025864d46e0045d913835\" , \"Names\" : [ \"/jolly_leavitt\" ] , \"Image\" : \"dlang2/dmd-ubuntu\" , \"ImageID\" : \"sha256:452334c0b9a959c88a2e6dac05f8bb26d3ea9da3757e52c4eb9314c023c6802d\" , \"Command\" : \"bash\" , \"Created\" :1586227101, \"Ports\" : [] , \"Labels\" : {} , \"State\" : \"exited\" , \"Status\" : \"Exited (255) 13 minutes ago\" , \"HostConfig\" : { \"NetworkMode\" : \"default\" } , \"NetworkSettings\" : { \"Networks\" : { \"bridge\" : { \"IPAMConfig\" :null, \"Links\" :null, \"Aliases\" :null, \"NetworkID\" : \"82382b47b631f9c295d2ba2f9456b90d9d17a65eefae08da916c321dd6504167\" , \"EndpointID\" : \"7898339e7a463a489ae19e994680f1e33808680745a8dfa6eab24f25a6fc0349\" , \"Gateway\" : \"172.17.0.1\" , \"IPAddress\" : \"172.17.0.2\" , \"IPPrefixLen\" :16, \"IPv6Gateway\" : \"\" , \"GlobalIPv6Address\" : \"\" , \"GlobalIPv6PrefixLen\" :0, \"MacAddress\" : \"02:42:ac:11:00:02\" , \"DriverOpts\" :null }}} , \"Mounts\" : [{ \"Type\" : \"bind\" , \"Source\" : \"/root/dub\" , \"Destination\" : \"/tmp\" , \"Mode\" : \"\" , \"RW\" :true, \"Propagation\" : \"rprivate\" }]}] , \"docker_images\" : [{ \"Containers\" :-1, \"Created\" :1586186041, \"Id\" : \"sha256:452334c0b9a959c88a2e6dac05f8bb26d3ea9da3757e52c4eb9314c023c6802d\" , \"Labels\" :null, \"ParentId\" : \"\" , \"RepoDigests\" : [ \"dlang2/dmd-ubuntu@sha256:acd64e92240f7987ae10cd9f6ab8b0bdff4ffe10605cb29c1a48305e9d2c0e68\" ] , \"RepoTags\" : [ \"dlang2/dmd-ubuntu:latest\" ] , \"SharedSize\" :-1, \"Size\" :866485017, \"VirtualSize\" :866485017 } , { \"Containers\" :-1, \"Created\" :1584732022, \"Id\" : \"sha256:4e5021d210f65ebe915670c7089120120bc0a303b90208592851708c1b8c04bd\" , \"Labels\" :null, \"ParentId\" : \"\" , \"RepoDigests\" : [ \"ubuntu@sha256:bec5a2727be7fff3d308193cfde3491f8fba1a2ba392b7546b43a051853a341d\" ] , \"RepoTags\" : [ \"ubuntu:latest\" ] , \"SharedSize\" :-1, \"Size\" :64205678, \"VirtualSize\" :64205678 }] } , \"changed\" : false } \u4ee5json\u683c\u5f0f\u8f93\u51fadocker\u4fe1\u606f\u3002 ansible \u8fd0\u884c \u00b6 # ansible localhost -M /etc/ansible/library -m docker_facts localhost | SUCCESS = > { \"ansible_facts\" : { \"docker_client_version\" : \"18.09.6\" , \"docker_containers\" : [ { \"Command\" : \"bash\" , \"Created\" : 1586312956 , \"HostConfig\" : { \"NetworkMode\" : \"default\" } , \"Id\" : \"cb323ddf4982cd46d8b89a4c7a349ba515c183d2b3364b3edd5687ce34f78ad0\" , \"Image\" : \"ubuntu:latest\" , \"ImageID\" : \"sha256:4e5021d210f65ebe915670c7089120120bc0a303b90208592851708c1b8c04bd\" , \"Labels\" : {} , \"Mounts\" : [] , \"Names\" : [ \"/keen_jackson\" ] , \"NetworkSettings\" : { \"Networks\" : { \"bridge\" : { \"Aliases\" : null, \"DriverOpts\" : null, \"EndpointID\" : \"ece9b5d82c6e5ae16a23159dd8ffc0f87b6e77808418c47c70ea72c1d81496b4\" , \"Gateway\" : \"172.17.0.1\" , \"GlobalIPv6Address\" : \"\" , \"GlobalIPv6PrefixLen\" : 0 , \"IPAMConfig\" : null, \"IPAddress\" : \"172.17.0.3\" , \"IPPrefixLen\" : 16 , \"IPv6Gateway\" : \"\" , \"Links\" : null, \"MacAddress\" : \"02:42:ac:11:00:03\" , \"NetworkID\" : \"82382b47b631f9c295d2ba2f9456b90d9d17a65eefae08da916c321dd6504167\" } } } , \"Ports\" : [] , \"State\" : \"exited\" , \"Status\" : \"Exited (255) 9 minutes ago\" } , { \"Command\" : \"bash\" , \"Created\" : 1586227101 , \"HostConfig\" : { \"NetworkMode\" : \"default\" } , \"Id\" : \"f51ab9f8490bae100763c5b7b1eb2e3470efec5b2fa025864d46e0045d913835\" , \"Image\" : \"dlang2/dmd-ubuntu\" , \"ImageID\" : \"sha256:452334c0b9a959c88a2e6dac05f8bb26d3ea9da3757e52c4eb9314c023c6802d\" , \"Labels\" : {} , \"Mounts\" : [ { \"Destination\" : \"/tmp\" , \"Mode\" : \"\" , \"Propagation\" : \"rprivate\" , \"RW\" : true, \"Source\" : \"/root/dub\" , \"Type\" : \"bind\" } ] , \"Names\" : [ \"/jolly_leavitt\" ] , \"NetworkSettings\" : { \"Networks\" : { \"bridge\" : { \"Aliases\" : null, \"DriverOpts\" : null, \"EndpointID\" : \"7898339e7a463a489ae19e994680f1e33808680745a8dfa6eab24f25a6fc0349\" , \"Gateway\" : \"172.17.0.1\" , \"GlobalIPv6Address\" : \"\" , \"GlobalIPv6PrefixLen\" : 0 , \"IPAMConfig\" : null, \"IPAddress\" : \"172.17.0.2\" , \"IPPrefixLen\" : 16 , \"IPv6Gateway\" : \"\" , \"Links\" : null, \"MacAddress\" : \"02:42:ac:11:00:02\" , \"NetworkID\" : \"82382b47b631f9c295d2ba2f9456b90d9d17a65eefae08da916c321dd6504167\" } } } , \"Ports\" : [] , \"State\" : \"exited\" , \"Status\" : \"Exited (255) 9 minutes ago\" } ] , \"docker_images\" : [ { \"Containers\" : -1, \"Created\" : 1586186041 , \"Id\" : \"sha256:452334c0b9a959c88a2e6dac05f8bb26d3ea9da3757e52c4eb9314c023c6802d\" , \"Labels\" : null, \"ParentId\" : \"\" , \"RepoDigests\" : [ \"dlang2/dmd-ubuntu@sha256:acd64e92240f7987ae10cd9f6ab8b0bdff4ffe10605cb29c1a48305e9d2c0e68\" ] , \"RepoTags\" : [ \"dlang2/dmd-ubuntu:latest\" ] , \"SharedSize\" : -1, \"Size\" : 866485017 , \"VirtualSize\" : 866485017 } , { \"Containers\" : -1, \"Created\" : 1584732022 , \"Id\" : \"sha256:4e5021d210f65ebe915670c7089120120bc0a303b90208592851708c1b8c04bd\" , \"Labels\" : null, \"ParentId\" : \"\" , \"RepoDigests\" : [ \"ubuntu@sha256:bec5a2727be7fff3d308193cfde3491f8fba1a2ba392b7546b43a051853a341d\" ] , \"RepoTags\" : [ \"ubuntu:latest\" ] , \"SharedSize\" : -1, \"Size\" : 64205678 , \"VirtualSize\" : 64205678 } ] , \"docker_info\" : { \"Architecture\" : \"x86_64\" , \"BridgeNfIp6tables\" : false, \"BridgeNfIptables\" : false, \"CPUSet\" : true, \"CPUShares\" : true, \"CgroupDriver\" : \"cgroupfs\" , \"ClusterAdvertise\" : \"\" , \"ClusterStore\" : \"\" , \"ContainerdCommit\" : { \"Expected\" : \"bb71b10fd8f58240ca47fbb579b9d1028eea7c84\" , \"ID\" : \"bb71b10fd8f58240ca47fbb579b9d1028eea7c84\" } , \"Containers\" : 2 , \"ContainersPaused\" : 0 , \"ContainersRunning\" : 0 , \"ContainersStopped\" : 2 , \"CpuCfsPeriod\" : true, \"CpuCfsQuota\" : true, \"Debug\" : false, \"DefaultRuntime\" : \"runc\" , \"DockerRootDir\" : \"/var/lib/docker\" , \"Driver\" : \"overlay2\" , \"DriverStatus\" : [ [ \"Backing Filesystem\" , \"xfs\" ] , [ \"Supports d_type\" , \"true\" ] , [ \"Native Overlay Diff\" , \"true\" ] ] , \"ExperimentalBuild\" : false, \"GenericResources\" : null, \"HttpProxy\" : \"\" , \"HttpsProxy\" : \"\" , \"ID\" : \"7SAH:IRUL:HLJO:O5N4:32CG:HGCK:MHR7:OJHS:6UBH:NM6I:KVFY:BOKL\" , \"IPv4Forwarding\" : true, \"Images\" : 2 , \"IndexServerAddress\" : \"https://index.docker.io/v1/\" , \"InitBinary\" : \"docker-init\" , \"InitCommit\" : { \"Expected\" : \"fec3683\" , \"ID\" : \"fec3683\" } , \"Isolation\" : \"\" , \"KernelMemory\" : true, \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"Labels\" : [] , \"LiveRestoreEnabled\" : true, \"LoggingDriver\" : \"json-file\" , \"MemTotal\" : 1007276032 , \"MemoryLimit\" : true, \"NCPU\" : 1 , \"NEventsListener\" : 0 , \"NFd\" : 22 , \"NGoroutines\" : 37 , \"Name\" : \"node130\" , \"NoProxy\" : \"\" , \"OSType\" : \"linux\" , \"OomKillDisable\" : true, \"OperatingSystem\" : \"CentOS Linux 7 (Core)\" , \"Plugins\" : { \"Authorization\" : null, \"Log\" : [ \"awslogs\" , \"fluentd\" , \"gcplogs\" , \"gelf\" , \"journald\" , \"json-file\" , \"local\" , \"logentries\" , \"splunk\" , \"syslog\" ] , \"Network\" : [ \"bridge\" , \"host\" , \"macvlan\" , \"null\" , \"overlay\" ] , \"Volume\" : [ \"local\" ] } , \"ProductLicense\" : \"Community Engine\" , \"RegistryConfig\" : { \"AllowNondistributableArtifactsCIDRs\" : [] , \"AllowNondistributableArtifactsHostnames\" : [] , \"IndexConfigs\" : { \"docker.io\" : { \"Mirrors\" : [ \"http://dockerhub.azk8s.cn/\" ] , \"Name\" : \"docker.io\" , \"Official\" : true, \"Secure\" : true } } , \"InsecureRegistryCIDRs\" : [ \"127.0.0.0/8\" ] , \"Mirrors\" : [ \"http://dockerhub.azk8s.cn/\" ] } , \"RuncCommit\" : { \"Expected\" : \"2b18fe1d885ee5083ef9f0838fee39b62d653e30\" , \"ID\" : \"2b18fe1d885ee5083ef9f0838fee39b62d653e30\" } , \"Runtimes\" : { \"runc\" : { \"path\" : \"runc\" } } , \"SecurityOptions\" : [ \"name=seccomp,profile=default\" ] , \"ServerVersion\" : \"18.09.6\" , \"SwapLimit\" : true, \"Swarm\" : { \"ControlAvailable\" : false, \"Error\" : \"\" , \"LocalNodeState\" : \"inactive\" , \"NodeAddr\" : \"\" , \"NodeID\" : \"\" , \"RemoteManagers\" : null } , \"SystemStatus\" : null, \"SystemTime\" : \"2020-04-13T12:07:10.426882075+08:00\" , \"Warnings\" : [ \"WARNING: bridge-nf-call-iptables is disabled\" , \"WARNING: bridge-nf-call-ip6tables is disabled\" ] } , \"docker_server_version\" : \"18.09.6\" , \"docker_version\" : { \"ApiVersion\" : \"1.39\" , \"Arch\" : \"amd64\" , \"BuildTime\" : \"2019-05-04T02:02:43.000000000+00:00\" , \"Components\" : [ { \"Details\" : { \"ApiVersion\" : \"1.39\" , \"Arch\" : \"amd64\" , \"BuildTime\" : \"2019-05-04T02:02:43.000000000+00:00\" , \"Experimental\" : \"false\" , \"GitCommit\" : \"481bc77\" , \"GoVersion\" : \"go1.10.8\" , \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"MinAPIVersion\" : \"1.12\" , \"Os\" : \"linux\" } , \"Name\" : \"Engine\" , \"Version\" : \"18.09.6\" } ] , \"GitCommit\" : \"481bc77\" , \"GoVersion\" : \"go1.10.8\" , \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"MinAPIVersion\" : \"1.12\" , \"Os\" : \"linux\" , \"Platform\" : { \"Name\" : \"Docker Engine - Community\" } , \"Version\" : \"18.09.6\" } } , \"changed\" : false } playbook \u8fd0\u884c \u00b6 playbook \u5185\u5bb9 --- - hosts : localhost gather_facts : no tasks : - name : get docker facts docker_facts : - name : show facts debug : var=ansible_facts.docker_version playbook \u8fd0\u884c # ansible-playbook test.yml PLAY [ localhost ] ********************************************************************************************************************* TASK [ get docker facts ] ************************************************************************************************************** ok: [ localhost ] TASK [ show facts ] ******************************************************************************************************************** ok: [ localhost ] = > { \"ansible_facts.docker_version\" : { \"ApiVersion\" : \"1.39\" , \"Arch\" : \"amd64\" , \"BuildTime\" : \"2019-05-04T02:02:43.000000000+00:00\" , \"Components\" : [ { \"Details\" : { \"ApiVersion\" : \"1.39\" , \"Arch\" : \"amd64\" , \"BuildTime\" : \"2019-05-04T02:02:43.000000000+00:00\" , \"Experimental\" : \"false\" , \"GitCommit\" : \"481bc77\" , \"GoVersion\" : \"go1.10.8\" , \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"MinAPIVersion\" : \"1.12\" , \"Os\" : \"linux\" } , \"Name\" : \"Engine\" , \"Version\" : \"18.09.6\" } ] , \"GitCommit\" : \"481bc77\" , \"GoVersion\" : \"go1.10.8\" , \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"MinAPIVersion\" : \"1.12\" , \"Os\" : \"linux\" , \"Platform\" : { \"Name\" : \"Docker Engine - Community\" } , \"Version\" : \"18.09.6\" } } PLAY RECAP *************************************************************************************************************************** localhost : ok = 2 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0","title":"module \u793a\u4f8b: docker_facts"},{"location":"dev/modules/module-docker-facts/#docker_facts","text":"\u53ea\u8fd4\u56defacts\u6570\u636e\u7684\u6a21\u5757","title":"docker_facts \u6a21\u5757"},{"location":"dev/modules/module-docker-facts/#_1","text":"\u83b7\u53d6\u8fdc\u7a0b\u4e3b\u673a\u7684docker\u4fe1\u606f\uff0c\u5e76\u5c06\u5176\u6ce8\u518c\u5230facts\u6570\u636e\u4e2d\u3002","title":"\u529f\u80fd\u5b9e\u73b0"},{"location":"dev/modules/module-docker-facts/#module","text":"\u672c\u4f8b\u4f7f\u7528shell\u811a\u672c file: library/docker_facts.sh #!/bin/bash ANSIBLE_METADATA = \"{'metadata_version': '1.0', 'status': ['preview'], 'supported_by': 'community'}\" DOCUMENTATION = \" --- module: docker_facts short_description: Get docker facts data version_added: '2.9' description: - Get docker facts data on remote host. author: - 'Lework' \" EXAMPLES = \" # Example from Ansible Playbooks - name: get docker facts docker_facts: \" RETURN = \" ansible_facts: description: docker facts type: dict returned: always \" set -e cat <<EOF { \"ansible_facts\": { \"docker_server_version\": \"$(docker version -f '{{.Server.Version}}')\", \"docker_client_version\": \"$(docker version -f '{{.Client.Version}}')\", \"docker_info\": $(curl -s --unix-socket /var/run/docker.sock http://:/info), \"docker_version\": $(curl -s --unix-socket /var/run/docker.sock http://:/version), \"docker_containers\": $(curl -s --unix-socket /var/run/docker.sock http://:/containers/json?all=true), \"docker_images\": $(curl -s --unix-socket /var/run/docker.sock http://:/images/json) }, \"changed\": false } EOF exit 0","title":"\u521b\u5efamodule"},{"location":"dev/modules/module-docker-facts/#module_1","text":"","title":"\u8fd0\u884cmodule"},{"location":"dev/modules/module-docker-facts/#_2","text":"# chmod +x library/docker_facts.sh # ./library/docker_facts.sh { \"ansible_facts\" : { \"docker_server_version\" : \"18.09.6\" , \"docker_client_version\" : \"18.09.6\" , \"docker_info\" : { \"ID\" : \"7SAH:IRUL:HLJO:O5N4:32CG:HGCK:MHR7:OJHS:6UBH:NM6I:KVFY:BOKL\" , \"Containers\" :2, \"ContainersRunning\" :0, \"ContainersPaused\" :0, \"ContainersStopped\" :2, \"Images\" :2, \"Driver\" : \"overlay2\" , \"DriverStatus\" : [[ \"Backing Filesystem\" , \"xfs\" ] , [ \"Supports d_type\" , \"true\" ] , [ \"Native Overlay Diff\" , \"true\" ]] , \"SystemStatus\" :null, \"Plugins\" : { \"Volume\" : [ \"local\" ] , \"Network\" : [ \"bridge\" , \"host\" , \"macvlan\" , \"null\" , \"overlay\" ] , \"Authorization\" :null, \"Log\" : [ \"awslogs\" , \"fluentd\" , \"gcplogs\" , \"gelf\" , \"journald\" , \"json-file\" , \"local\" , \"logentries\" , \"splunk\" , \"syslog\" ]} , \"MemoryLimit\" :true, \"SwapLimit\" :true, \"KernelMemory\" :true, \"CpuCfsPeriod\" :true, \"CpuCfsQuota\" :true, \"CPUShares\" :true, \"CPUSet\" :true, \"IPv4Forwarding\" :true, \"BridgeNfIptables\" :false, \"BridgeNfIp6tables\" :false, \"Debug\" :false, \"NFd\" :22, \"OomKillDisable\" :true, \"NGoroutines\" :37, \"SystemTime\" : \"2020-04-13T12:11:06.689886761+08:00\" , \"LoggingDriver\" : \"json-file\" , \"CgroupDriver\" : \"cgroupfs\" , \"NEventsListener\" :0, \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"OperatingSystem\" : \"CentOS Linux 7 (Core)\" , \"OSType\" : \"linux\" , \"Architecture\" : \"x86_64\" , \"IndexServerAddress\" : \"https://index.docker.io/v1/\" , \"RegistryConfig\" : { \"AllowNondistributableArtifactsCIDRs\" : [] , \"AllowNondistributableArtifactsHostnames\" : [] , \"InsecureRegistryCIDRs\" : [ \"127.0.0.0/8\" ] , \"IndexConfigs\" : { \"docker.io\" : { \"Name\" : \"docker.io\" , \"Mirrors\" : [ \"http://dockerhub.azk8s.cn/\" ] , \"Secure\" :true, \"Official\" :true }} , \"Mirrors\" : [ \"http://dockerhub.azk8s.cn/\" ]} , \"NCPU\" :1, \"MemTotal\" :1007276032, \"GenericResources\" :null, \"DockerRootDir\" : \"/var/lib/docker\" , \"HttpProxy\" : \"\" , \"HttpsProxy\" : \"\" , \"NoProxy\" : \"\" , \"Name\" : \"node130\" , \"Labels\" : [] , \"ExperimentalBuild\" :false, \"ServerVersion\" : \"18.09.6\" , \"ClusterStore\" : \"\" , \"ClusterAdvertise\" : \"\" , \"Runtimes\" : { \"runc\" : { \"path\" : \"runc\" }} , \"DefaultRuntime\" : \"runc\" , \"Swarm\" : { \"NodeID\" : \"\" , \"NodeAddr\" : \"\" , \"LocalNodeState\" : \"inactive\" , \"ControlAvailable\" :false, \"Error\" : \"\" , \"RemoteManagers\" :null } , \"LiveRestoreEnabled\" :true, \"Isolation\" : \"\" , \"InitBinary\" : \"docker-init\" , \"ContainerdCommit\" : { \"ID\" : \"bb71b10fd8f58240ca47fbb579b9d1028eea7c84\" , \"Expected\" : \"bb71b10fd8f58240ca47fbb579b9d1028eea7c84\" } , \"RuncCommit\" : { \"ID\" : \"2b18fe1d885ee5083ef9f0838fee39b62d653e30\" , \"Expected\" : \"2b18fe1d885ee5083ef9f0838fee39b62d653e30\" } , \"InitCommit\" : { \"ID\" : \"fec3683\" , \"Expected\" : \"fec3683\" } , \"SecurityOptions\" : [ \"name=seccomp,profile=default\" ] , \"ProductLicense\" : \"Community Engine\" , \"Warnings\" : [ \"WARNING: bridge-nf-call-iptables is disabled\" , \"WARNING: bridge-nf-call-ip6tables is disabled\" ]} , \"docker_version\" : { \"Platform\" : { \"Name\" : \"Docker Engine - Community\" } , \"Components\" : [{ \"Name\" : \"Engine\" , \"Version\" : \"18.09.6\" , \"Details\" : { \"ApiVersion\" : \"1.39\" , \"Arch\" : \"amd64\" , \"BuildTime\" : \"2019-05-04T02:02:43.000000000+00:00\" , \"Experimental\" : \"false\" , \"GitCommit\" : \"481bc77\" , \"GoVersion\" : \"go1.10.8\" , \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"MinAPIVersion\" : \"1.12\" , \"Os\" : \"linux\" }}] , \"Version\" : \"18.09.6\" , \"ApiVersion\" : \"1.39\" , \"MinAPIVersion\" : \"1.12\" , \"GitCommit\" : \"481bc77\" , \"GoVersion\" : \"go1.10.8\" , \"Os\" : \"linux\" , \"Arch\" : \"amd64\" , \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"BuildTime\" : \"2019-05-04T02:02:43.000000000+00:00\" } , \"docker_containers\" : [{ \"Id\" : \"cb323ddf4982cd46d8b89a4c7a349ba515c183d2b3364b3edd5687ce34f78ad0\" , \"Names\" : [ \"/keen_jackson\" ] , \"Image\" : \"ubuntu:latest\" , \"ImageID\" : \"sha256:4e5021d210f65ebe915670c7089120120bc0a303b90208592851708c1b8c04bd\" , \"Command\" : \"bash\" , \"Created\" :1586312956, \"Ports\" : [] , \"Labels\" : {} , \"State\" : \"exited\" , \"Status\" : \"Exited (255) 13 minutes ago\" , \"HostConfig\" : { \"NetworkMode\" : \"default\" } , \"NetworkSettings\" : { \"Networks\" : { \"bridge\" : { \"IPAMConfig\" :null, \"Links\" :null, \"Aliases\" :null, \"NetworkID\" : \"82382b47b631f9c295d2ba2f9456b90d9d17a65eefae08da916c321dd6504167\" , \"EndpointID\" : \"ece9b5d82c6e5ae16a23159dd8ffc0f87b6e77808418c47c70ea72c1d81496b4\" , \"Gateway\" : \"172.17.0.1\" , \"IPAddress\" : \"172.17.0.3\" , \"IPPrefixLen\" :16, \"IPv6Gateway\" : \"\" , \"GlobalIPv6Address\" : \"\" , \"GlobalIPv6PrefixLen\" :0, \"MacAddress\" : \"02:42:ac:11:00:03\" , \"DriverOpts\" :null }}} , \"Mounts\" : []} , { \"Id\" : \"f51ab9f8490bae100763c5b7b1eb2e3470efec5b2fa025864d46e0045d913835\" , \"Names\" : [ \"/jolly_leavitt\" ] , \"Image\" : \"dlang2/dmd-ubuntu\" , \"ImageID\" : \"sha256:452334c0b9a959c88a2e6dac05f8bb26d3ea9da3757e52c4eb9314c023c6802d\" , \"Command\" : \"bash\" , \"Created\" :1586227101, \"Ports\" : [] , \"Labels\" : {} , \"State\" : \"exited\" , \"Status\" : \"Exited (255) 13 minutes ago\" , \"HostConfig\" : { \"NetworkMode\" : \"default\" } , \"NetworkSettings\" : { \"Networks\" : { \"bridge\" : { \"IPAMConfig\" :null, \"Links\" :null, \"Aliases\" :null, \"NetworkID\" : \"82382b47b631f9c295d2ba2f9456b90d9d17a65eefae08da916c321dd6504167\" , \"EndpointID\" : \"7898339e7a463a489ae19e994680f1e33808680745a8dfa6eab24f25a6fc0349\" , \"Gateway\" : \"172.17.0.1\" , \"IPAddress\" : \"172.17.0.2\" , \"IPPrefixLen\" :16, \"IPv6Gateway\" : \"\" , \"GlobalIPv6Address\" : \"\" , \"GlobalIPv6PrefixLen\" :0, \"MacAddress\" : \"02:42:ac:11:00:02\" , \"DriverOpts\" :null }}} , \"Mounts\" : [{ \"Type\" : \"bind\" , \"Source\" : \"/root/dub\" , \"Destination\" : \"/tmp\" , \"Mode\" : \"\" , \"RW\" :true, \"Propagation\" : \"rprivate\" }]}] , \"docker_images\" : [{ \"Containers\" :-1, \"Created\" :1586186041, \"Id\" : \"sha256:452334c0b9a959c88a2e6dac05f8bb26d3ea9da3757e52c4eb9314c023c6802d\" , \"Labels\" :null, \"ParentId\" : \"\" , \"RepoDigests\" : [ \"dlang2/dmd-ubuntu@sha256:acd64e92240f7987ae10cd9f6ab8b0bdff4ffe10605cb29c1a48305e9d2c0e68\" ] , \"RepoTags\" : [ \"dlang2/dmd-ubuntu:latest\" ] , \"SharedSize\" :-1, \"Size\" :866485017, \"VirtualSize\" :866485017 } , { \"Containers\" :-1, \"Created\" :1584732022, \"Id\" : \"sha256:4e5021d210f65ebe915670c7089120120bc0a303b90208592851708c1b8c04bd\" , \"Labels\" :null, \"ParentId\" : \"\" , \"RepoDigests\" : [ \"ubuntu@sha256:bec5a2727be7fff3d308193cfde3491f8fba1a2ba392b7546b43a051853a341d\" ] , \"RepoTags\" : [ \"ubuntu:latest\" ] , \"SharedSize\" :-1, \"Size\" :64205678, \"VirtualSize\" :64205678 }] } , \"changed\" : false } \u4ee5json\u683c\u5f0f\u8f93\u51fadocker\u4fe1\u606f\u3002","title":"\u672c\u5730\u8fd0\u884c\u6d4b\u8bd5"},{"location":"dev/modules/module-docker-facts/#ansible","text":"# ansible localhost -M /etc/ansible/library -m docker_facts localhost | SUCCESS = > { \"ansible_facts\" : { \"docker_client_version\" : \"18.09.6\" , \"docker_containers\" : [ { \"Command\" : \"bash\" , \"Created\" : 1586312956 , \"HostConfig\" : { \"NetworkMode\" : \"default\" } , \"Id\" : \"cb323ddf4982cd46d8b89a4c7a349ba515c183d2b3364b3edd5687ce34f78ad0\" , \"Image\" : \"ubuntu:latest\" , \"ImageID\" : \"sha256:4e5021d210f65ebe915670c7089120120bc0a303b90208592851708c1b8c04bd\" , \"Labels\" : {} , \"Mounts\" : [] , \"Names\" : [ \"/keen_jackson\" ] , \"NetworkSettings\" : { \"Networks\" : { \"bridge\" : { \"Aliases\" : null, \"DriverOpts\" : null, \"EndpointID\" : \"ece9b5d82c6e5ae16a23159dd8ffc0f87b6e77808418c47c70ea72c1d81496b4\" , \"Gateway\" : \"172.17.0.1\" , \"GlobalIPv6Address\" : \"\" , \"GlobalIPv6PrefixLen\" : 0 , \"IPAMConfig\" : null, \"IPAddress\" : \"172.17.0.3\" , \"IPPrefixLen\" : 16 , \"IPv6Gateway\" : \"\" , \"Links\" : null, \"MacAddress\" : \"02:42:ac:11:00:03\" , \"NetworkID\" : \"82382b47b631f9c295d2ba2f9456b90d9d17a65eefae08da916c321dd6504167\" } } } , \"Ports\" : [] , \"State\" : \"exited\" , \"Status\" : \"Exited (255) 9 minutes ago\" } , { \"Command\" : \"bash\" , \"Created\" : 1586227101 , \"HostConfig\" : { \"NetworkMode\" : \"default\" } , \"Id\" : \"f51ab9f8490bae100763c5b7b1eb2e3470efec5b2fa025864d46e0045d913835\" , \"Image\" : \"dlang2/dmd-ubuntu\" , \"ImageID\" : \"sha256:452334c0b9a959c88a2e6dac05f8bb26d3ea9da3757e52c4eb9314c023c6802d\" , \"Labels\" : {} , \"Mounts\" : [ { \"Destination\" : \"/tmp\" , \"Mode\" : \"\" , \"Propagation\" : \"rprivate\" , \"RW\" : true, \"Source\" : \"/root/dub\" , \"Type\" : \"bind\" } ] , \"Names\" : [ \"/jolly_leavitt\" ] , \"NetworkSettings\" : { \"Networks\" : { \"bridge\" : { \"Aliases\" : null, \"DriverOpts\" : null, \"EndpointID\" : \"7898339e7a463a489ae19e994680f1e33808680745a8dfa6eab24f25a6fc0349\" , \"Gateway\" : \"172.17.0.1\" , \"GlobalIPv6Address\" : \"\" , \"GlobalIPv6PrefixLen\" : 0 , \"IPAMConfig\" : null, \"IPAddress\" : \"172.17.0.2\" , \"IPPrefixLen\" : 16 , \"IPv6Gateway\" : \"\" , \"Links\" : null, \"MacAddress\" : \"02:42:ac:11:00:02\" , \"NetworkID\" : \"82382b47b631f9c295d2ba2f9456b90d9d17a65eefae08da916c321dd6504167\" } } } , \"Ports\" : [] , \"State\" : \"exited\" , \"Status\" : \"Exited (255) 9 minutes ago\" } ] , \"docker_images\" : [ { \"Containers\" : -1, \"Created\" : 1586186041 , \"Id\" : \"sha256:452334c0b9a959c88a2e6dac05f8bb26d3ea9da3757e52c4eb9314c023c6802d\" , \"Labels\" : null, \"ParentId\" : \"\" , \"RepoDigests\" : [ \"dlang2/dmd-ubuntu@sha256:acd64e92240f7987ae10cd9f6ab8b0bdff4ffe10605cb29c1a48305e9d2c0e68\" ] , \"RepoTags\" : [ \"dlang2/dmd-ubuntu:latest\" ] , \"SharedSize\" : -1, \"Size\" : 866485017 , \"VirtualSize\" : 866485017 } , { \"Containers\" : -1, \"Created\" : 1584732022 , \"Id\" : \"sha256:4e5021d210f65ebe915670c7089120120bc0a303b90208592851708c1b8c04bd\" , \"Labels\" : null, \"ParentId\" : \"\" , \"RepoDigests\" : [ \"ubuntu@sha256:bec5a2727be7fff3d308193cfde3491f8fba1a2ba392b7546b43a051853a341d\" ] , \"RepoTags\" : [ \"ubuntu:latest\" ] , \"SharedSize\" : -1, \"Size\" : 64205678 , \"VirtualSize\" : 64205678 } ] , \"docker_info\" : { \"Architecture\" : \"x86_64\" , \"BridgeNfIp6tables\" : false, \"BridgeNfIptables\" : false, \"CPUSet\" : true, \"CPUShares\" : true, \"CgroupDriver\" : \"cgroupfs\" , \"ClusterAdvertise\" : \"\" , \"ClusterStore\" : \"\" , \"ContainerdCommit\" : { \"Expected\" : \"bb71b10fd8f58240ca47fbb579b9d1028eea7c84\" , \"ID\" : \"bb71b10fd8f58240ca47fbb579b9d1028eea7c84\" } , \"Containers\" : 2 , \"ContainersPaused\" : 0 , \"ContainersRunning\" : 0 , \"ContainersStopped\" : 2 , \"CpuCfsPeriod\" : true, \"CpuCfsQuota\" : true, \"Debug\" : false, \"DefaultRuntime\" : \"runc\" , \"DockerRootDir\" : \"/var/lib/docker\" , \"Driver\" : \"overlay2\" , \"DriverStatus\" : [ [ \"Backing Filesystem\" , \"xfs\" ] , [ \"Supports d_type\" , \"true\" ] , [ \"Native Overlay Diff\" , \"true\" ] ] , \"ExperimentalBuild\" : false, \"GenericResources\" : null, \"HttpProxy\" : \"\" , \"HttpsProxy\" : \"\" , \"ID\" : \"7SAH:IRUL:HLJO:O5N4:32CG:HGCK:MHR7:OJHS:6UBH:NM6I:KVFY:BOKL\" , \"IPv4Forwarding\" : true, \"Images\" : 2 , \"IndexServerAddress\" : \"https://index.docker.io/v1/\" , \"InitBinary\" : \"docker-init\" , \"InitCommit\" : { \"Expected\" : \"fec3683\" , \"ID\" : \"fec3683\" } , \"Isolation\" : \"\" , \"KernelMemory\" : true, \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"Labels\" : [] , \"LiveRestoreEnabled\" : true, \"LoggingDriver\" : \"json-file\" , \"MemTotal\" : 1007276032 , \"MemoryLimit\" : true, \"NCPU\" : 1 , \"NEventsListener\" : 0 , \"NFd\" : 22 , \"NGoroutines\" : 37 , \"Name\" : \"node130\" , \"NoProxy\" : \"\" , \"OSType\" : \"linux\" , \"OomKillDisable\" : true, \"OperatingSystem\" : \"CentOS Linux 7 (Core)\" , \"Plugins\" : { \"Authorization\" : null, \"Log\" : [ \"awslogs\" , \"fluentd\" , \"gcplogs\" , \"gelf\" , \"journald\" , \"json-file\" , \"local\" , \"logentries\" , \"splunk\" , \"syslog\" ] , \"Network\" : [ \"bridge\" , \"host\" , \"macvlan\" , \"null\" , \"overlay\" ] , \"Volume\" : [ \"local\" ] } , \"ProductLicense\" : \"Community Engine\" , \"RegistryConfig\" : { \"AllowNondistributableArtifactsCIDRs\" : [] , \"AllowNondistributableArtifactsHostnames\" : [] , \"IndexConfigs\" : { \"docker.io\" : { \"Mirrors\" : [ \"http://dockerhub.azk8s.cn/\" ] , \"Name\" : \"docker.io\" , \"Official\" : true, \"Secure\" : true } } , \"InsecureRegistryCIDRs\" : [ \"127.0.0.0/8\" ] , \"Mirrors\" : [ \"http://dockerhub.azk8s.cn/\" ] } , \"RuncCommit\" : { \"Expected\" : \"2b18fe1d885ee5083ef9f0838fee39b62d653e30\" , \"ID\" : \"2b18fe1d885ee5083ef9f0838fee39b62d653e30\" } , \"Runtimes\" : { \"runc\" : { \"path\" : \"runc\" } } , \"SecurityOptions\" : [ \"name=seccomp,profile=default\" ] , \"ServerVersion\" : \"18.09.6\" , \"SwapLimit\" : true, \"Swarm\" : { \"ControlAvailable\" : false, \"Error\" : \"\" , \"LocalNodeState\" : \"inactive\" , \"NodeAddr\" : \"\" , \"NodeID\" : \"\" , \"RemoteManagers\" : null } , \"SystemStatus\" : null, \"SystemTime\" : \"2020-04-13T12:07:10.426882075+08:00\" , \"Warnings\" : [ \"WARNING: bridge-nf-call-iptables is disabled\" , \"WARNING: bridge-nf-call-ip6tables is disabled\" ] } , \"docker_server_version\" : \"18.09.6\" , \"docker_version\" : { \"ApiVersion\" : \"1.39\" , \"Arch\" : \"amd64\" , \"BuildTime\" : \"2019-05-04T02:02:43.000000000+00:00\" , \"Components\" : [ { \"Details\" : { \"ApiVersion\" : \"1.39\" , \"Arch\" : \"amd64\" , \"BuildTime\" : \"2019-05-04T02:02:43.000000000+00:00\" , \"Experimental\" : \"false\" , \"GitCommit\" : \"481bc77\" , \"GoVersion\" : \"go1.10.8\" , \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"MinAPIVersion\" : \"1.12\" , \"Os\" : \"linux\" } , \"Name\" : \"Engine\" , \"Version\" : \"18.09.6\" } ] , \"GitCommit\" : \"481bc77\" , \"GoVersion\" : \"go1.10.8\" , \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"MinAPIVersion\" : \"1.12\" , \"Os\" : \"linux\" , \"Platform\" : { \"Name\" : \"Docker Engine - Community\" } , \"Version\" : \"18.09.6\" } } , \"changed\" : false }","title":"ansible \u8fd0\u884c"},{"location":"dev/modules/module-docker-facts/#playbook","text":"playbook \u5185\u5bb9 --- - hosts : localhost gather_facts : no tasks : - name : get docker facts docker_facts : - name : show facts debug : var=ansible_facts.docker_version playbook \u8fd0\u884c # ansible-playbook test.yml PLAY [ localhost ] ********************************************************************************************************************* TASK [ get docker facts ] ************************************************************************************************************** ok: [ localhost ] TASK [ show facts ] ******************************************************************************************************************** ok: [ localhost ] = > { \"ansible_facts.docker_version\" : { \"ApiVersion\" : \"1.39\" , \"Arch\" : \"amd64\" , \"BuildTime\" : \"2019-05-04T02:02:43.000000000+00:00\" , \"Components\" : [ { \"Details\" : { \"ApiVersion\" : \"1.39\" , \"Arch\" : \"amd64\" , \"BuildTime\" : \"2019-05-04T02:02:43.000000000+00:00\" , \"Experimental\" : \"false\" , \"GitCommit\" : \"481bc77\" , \"GoVersion\" : \"go1.10.8\" , \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"MinAPIVersion\" : \"1.12\" , \"Os\" : \"linux\" } , \"Name\" : \"Engine\" , \"Version\" : \"18.09.6\" } ] , \"GitCommit\" : \"481bc77\" , \"GoVersion\" : \"go1.10.8\" , \"KernelVersion\" : \"5.1.11-1.el7.elrepo.x86_64\" , \"MinAPIVersion\" : \"1.12\" , \"Os\" : \"linux\" , \"Platform\" : { \"Name\" : \"Docker Engine - Community\" } , \"Version\" : \"18.09.6\" } } PLAY RECAP *************************************************************************************************************************** localhost : ok = 2 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0","title":"playbook \u8fd0\u884c"},{"location":"dev/modules/module-outher-dev/","text":"\u5176\u4ed6\u8bed\u8a00\u5f00\u53d1module \u00b6 Ansible\u662f\u7531 python \u8bed\u8a00\u5f00\u53d1\u7684\uff0c\u4f46\u5176\u652f\u6301\u7684\u6a21\u5757\u53ef\u4ee5\u662f\u4efb\u4f55\u8bed\u8a00\uff0c\u53ea\u8981\u6a21\u5757\u4ee3\u7801\u53ef\u4ee5\u5728\u8fdc\u7a0b\u6267\u884c\u5373\u53ef\u3002\u6bd4\u5982bash\u811a\u672c\u9700\u8981 bash \u89e3\u91ca\u5668\u6267\u884c\u3002 bash\u8bed\u8a00 \u00b6 \u4f7f\u7528bash\u8bed\u8a00\u5f00\u53d1module \u529f\u80fd\u5b9e\u73b0 \u00b6 \u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u3002 \u521b\u5efamodule \u00b6 # cd /etc/ansible/library/ # cat touch.sh #!/bin/sh ANSIBLE_METADATA = \"{'metadata_version': '1.0', 'status': ['preview'], 'supported_by': 'community'}\" DOCUMENTATION = \" --- module: touch short_description: Touch a file on the remote host version_added: '2.9' description: - The touch module touch a file on the remote host. options: file: description: - Path to a file on the remote host required: true author: - 'Lework' \" EXAMPLES = \" # Example from Ansible Playbooks - name: touch file touch: file: /tmp/foo \" RETURN = \" path: description: Path to a file on the remote host type: string returned: success sample: \" /path/to/file.name \" \" args_file = $1 [ ! -f \" $args_file \" ] && echo -n '{\"failed\": true, \"msg\": \"missing required arguments: file\"}' && exit 1 args_result = $( cat $args_file | gawk -F 'file=' '{print $2}' | gawk -F ' ' '{print $1}' ) [ ! -n \" $args_result \" ] && echo -n \"{\\\"failed\\\": true, \\\"msg\\\": \\\"file () is absent, cannot continue\\\", \\\"file\\\": \\\" $args_result \\\"}\" && exit 1 touch $args_result && echo -n \"{\\\"changed\\\": true, \\\"rc\\\": $? ,\\\"file\\\": \\\" $args_result \\\"}\" || echo -n \"{\\\"failed\\\": true, \\\"rc\\\": $? , \\\"file\\\": \\\" $args_result \\\"}\" exit $? \u8fd4\u56de\u503c\u4e00\u5b9a\u662fjson dumps\u7684\u5b57\u7b26\u4e32\u3002 \u672c\u5730\u6d4b\u8bd5 \u00b6 ansible\u7684\u53c2\u6570\u90fd\u4f1a\u88ab\u5199\u5165\u4e00\u4e2a\u540d\u4e3a args \u7684\u6587\u4ef6\uff0c\u4ee3\u7801\u4e2d\u7684 $1 \u53d8\u91cf\u5c31\u662f\u8fd9\u4e2a\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u8bfb\u53d6\u8fd9\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u5c31\u80fd\u83b7\u53d6file\u53c2\u6570\u7684\u503c\u3002 # cat args file = /tmp/foo # sh touch.sh args { \"changed\" : true, \"rc\" : 0 , \"file\" : \"/tmp/foo\" } \u6267\u884cplaybook \u00b6 # cat test_touch.yml --- - name: test remote_copy module hosts: 192 .168.77.130 gather_facts: false tasks: - name: touch file touch: file = /tmp/foo vars: ansible_sh_interpreter: /bin/sh ansible_sh_interpreter \u6307\u5b9a\u6267\u884c\u6a21\u5757\u7684\u53ef\u6267\u884c\u6587\u4ef6 \u6267\u884c\u7ed3\u679c # ansible-playbook test_touch.yml PLAY [ test remote_copy module ] ***************************************************************************************** TASK [ touch file ] ***************************************************************************************** changed: [ 192 .168.77.130 ] PLAY RECAP ***************************************************************************************** 192 .168.77.130 : ok = 1 changed = 1 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u6267\u884cansible \u00b6 # ansible 192.168.77.130 -M /etc/ansible/library/ -m touch -a \"file=/tmp/a\" -e \"ansible_sh_interpreter=/bin/sh\" 192 .168.77.130 | CHANGED = > { \"changed\" : true, \"file\" : \"/tmp/a\" , \"rc\" : 0 }","title":"module \u793a\u4f8b: \u5176\u4ed6\u8bed\u8a00\u5f00\u53d1"},{"location":"dev/modules/module-outher-dev/#module","text":"Ansible\u662f\u7531 python \u8bed\u8a00\u5f00\u53d1\u7684\uff0c\u4f46\u5176\u652f\u6301\u7684\u6a21\u5757\u53ef\u4ee5\u662f\u4efb\u4f55\u8bed\u8a00\uff0c\u53ea\u8981\u6a21\u5757\u4ee3\u7801\u53ef\u4ee5\u5728\u8fdc\u7a0b\u6267\u884c\u5373\u53ef\u3002\u6bd4\u5982bash\u811a\u672c\u9700\u8981 bash \u89e3\u91ca\u5668\u6267\u884c\u3002","title":"\u5176\u4ed6\u8bed\u8a00\u5f00\u53d1module"},{"location":"dev/modules/module-outher-dev/#bash","text":"\u4f7f\u7528bash\u8bed\u8a00\u5f00\u53d1module","title":"bash\u8bed\u8a00"},{"location":"dev/modules/module-outher-dev/#_1","text":"\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u3002","title":"\u529f\u80fd\u5b9e\u73b0"},{"location":"dev/modules/module-outher-dev/#module_1","text":"# cd /etc/ansible/library/ # cat touch.sh #!/bin/sh ANSIBLE_METADATA = \"{'metadata_version': '1.0', 'status': ['preview'], 'supported_by': 'community'}\" DOCUMENTATION = \" --- module: touch short_description: Touch a file on the remote host version_added: '2.9' description: - The touch module touch a file on the remote host. options: file: description: - Path to a file on the remote host required: true author: - 'Lework' \" EXAMPLES = \" # Example from Ansible Playbooks - name: touch file touch: file: /tmp/foo \" RETURN = \" path: description: Path to a file on the remote host type: string returned: success sample: \" /path/to/file.name \" \" args_file = $1 [ ! -f \" $args_file \" ] && echo -n '{\"failed\": true, \"msg\": \"missing required arguments: file\"}' && exit 1 args_result = $( cat $args_file | gawk -F 'file=' '{print $2}' | gawk -F ' ' '{print $1}' ) [ ! -n \" $args_result \" ] && echo -n \"{\\\"failed\\\": true, \\\"msg\\\": \\\"file () is absent, cannot continue\\\", \\\"file\\\": \\\" $args_result \\\"}\" && exit 1 touch $args_result && echo -n \"{\\\"changed\\\": true, \\\"rc\\\": $? ,\\\"file\\\": \\\" $args_result \\\"}\" || echo -n \"{\\\"failed\\\": true, \\\"rc\\\": $? , \\\"file\\\": \\\" $args_result \\\"}\" exit $? \u8fd4\u56de\u503c\u4e00\u5b9a\u662fjson dumps\u7684\u5b57\u7b26\u4e32\u3002","title":"\u521b\u5efamodule"},{"location":"dev/modules/module-outher-dev/#_2","text":"ansible\u7684\u53c2\u6570\u90fd\u4f1a\u88ab\u5199\u5165\u4e00\u4e2a\u540d\u4e3a args \u7684\u6587\u4ef6\uff0c\u4ee3\u7801\u4e2d\u7684 $1 \u53d8\u91cf\u5c31\u662f\u8fd9\u4e2a\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u8bfb\u53d6\u8fd9\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u5c31\u80fd\u83b7\u53d6file\u53c2\u6570\u7684\u503c\u3002 # cat args file = /tmp/foo # sh touch.sh args { \"changed\" : true, \"rc\" : 0 , \"file\" : \"/tmp/foo\" }","title":"\u672c\u5730\u6d4b\u8bd5"},{"location":"dev/modules/module-outher-dev/#playbook","text":"# cat test_touch.yml --- - name: test remote_copy module hosts: 192 .168.77.130 gather_facts: false tasks: - name: touch file touch: file = /tmp/foo vars: ansible_sh_interpreter: /bin/sh ansible_sh_interpreter \u6307\u5b9a\u6267\u884c\u6a21\u5757\u7684\u53ef\u6267\u884c\u6587\u4ef6 \u6267\u884c\u7ed3\u679c # ansible-playbook test_touch.yml PLAY [ test remote_copy module ] ***************************************************************************************** TASK [ touch file ] ***************************************************************************************** changed: [ 192 .168.77.130 ] PLAY RECAP ***************************************************************************************** 192 .168.77.130 : ok = 1 changed = 1 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0","title":"\u6267\u884cplaybook"},{"location":"dev/modules/module-outher-dev/#ansible","text":"# ansible 192.168.77.130 -M /etc/ansible/library/ -m touch -a \"file=/tmp/a\" -e \"ansible_sh_interpreter=/bin/sh\" 192 .168.77.130 | CHANGED = > { \"changed\" : true, \"file\" : \"/tmp/a\" , \"rc\" : 0 }","title":"\u6267\u884cansible"},{"location":"dev/modules/module-return/","text":"\u6a21\u5757\u8fd4\u56de\u503c \u00b6 Ansible\u6a21\u5757\u901a\u5e38\u8fd4\u56de\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u5176\u6570\u636e\u53ef\u4ee5\u6ce8\u518c\u4e3a\u53d8\u91cf\uff0c\u6216\u7531Ansible\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u3002 \u901a\u7528\u8fd4\u56de\u503c \u00b6 \u6240\u6709\u6a21\u5757\u901a\u7528\u7684\u8fd4\u56de\u503c \u540d\u79f0 \u7c7b\u578b \u8bf4\u660e backup_file str \u5bf9\u4e8e\u4e00\u4e9bmodules\u4f7f\u7528\u4e86backup\u53d8\u91cf\uff0c\u8fd4\u56de\u5907\u4efd\u7684\u6587\u4ef6\u8def\u5f84 changed bool \u8868\u793a\u4efb\u52a1\u662f\u5426\u5fc5\u987b\u8fdb\u884c\u66f4\u6539\u3002 failed bool \u8868\u793a\u4efb\u52a1\u662f\u5426\u5931\u8d25\u3002 invocation dict \u6709\u5173\u5982\u4f55\u8c03\u7528\u6a21\u5757\u7684\u4fe1\u606f\u3002 msg str \u5b58\u50a8\u901a\u7528\u6d88\u606f\u7684\u5b57\u7b26\u4e32 rc int \u547d\u4ee4\u884c\u7a0b\u5e8f\u7684\u8fd4\u56de\u7801 results dict \u5982\u679c\u8be5\u952e\u5b58\u5728\uff0c\u5219\u8868\u793a\u8be5\u4efb\u52a1\u5b58\u5728\u5faa\u73af\uff0c\u5e76\u4e14\u5b83\u5305\u542b\u6bcf\u4e2a\u9879\u76ee\u7684\u6a21\u5757\u201cresults\u201d\u7684\u5217\u8868\u3002 skipped bool \u8868\u793a\u8be5\u4efb\u52a1\u662f\u5426\u88ab\u8df3\u8fc7 stderr str \u547d\u4ee4\u884c\u7a0b\u5e8f\u7684\u9519\u8bef\u8f93\u51fa stderr_lines list \u5b83\u5c06stderr\u5b57\u7b26\u4e32\u6309\u884c\u5206\u5272\u5b58\u50a8\u5728\u5217\u8868\u4e2d stdout str \u547d\u4ee4\u884c\u7a0b\u5e8f\u7684\u6807\u51c6\u8f93\u51fa stdout_lines list \u5b83\u5c06stdout\u5b57\u7b26\u4e32\u6309\u884c\u5206\u5272\u5b58\u50a8\u5728\u5217\u8868\u4e2d \u5185\u90e8\u4f7f\u7528 \u00b6 \u8fd9\u4e9b\u503c\u662fansible\u5185\u90e8\u5b9a\u4e49\u7684,\u6a21\u5757\u53ef\u4ee5\u4f7f\u7528\uff0c\u4f46\u4e0d\u80fd\u7528\u4f5c\u6ce8\u518c\u53d8\u91cf\u3002 \u540d\u79f0 \u7c7b\u578b \u8bf4\u660e ansible_facts dict \u8be5key\u5e94\u5305\u542b\u4e00\u4e2a\u5b57\u5178\uff0c\u9644\u52a0\u5230\u5206\u914d\u7ed9\u4e3b\u673a\u7684fact\u3002 \u8fd9\u4e9b\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\uff0c\u4e0d\u9700\u8981\u4f7f\u7528\u6ce8\u518c\u7684\u53d8\u91cf\u3002 exception dict \u8be5key\u5305\u542b\u7531\u6a21\u5757\u4e2d\u7684\u5f02\u5e38\u5f15\u8d77\u7684\u8ffd\u6eaf\u4fe1\u606f\u3002 \u5b83\u53ea\u80fd\u4ee5\u9ad8\u5ea6\u8be6\u7ec6\u7a0b\u5ea6\u663e\u793a\uff08-vvv\uff09\u3002 warnings list \u6b64\u952e\u5305\u542b\u5c06\u663e\u793a\u7ed9\u7528\u6237\u7684\u5b57\u7b26\u4e32\u5217\u8868\u3002 deprecations dict \u8fd4\u56demsg\u548cversion\u7684\u5b57\u5178\u5217\u8868","title":"module \u7684\u8fd4\u56de\u503c"},{"location":"dev/modules/module-return/#_1","text":"Ansible\u6a21\u5757\u901a\u5e38\u8fd4\u56de\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u5176\u6570\u636e\u53ef\u4ee5\u6ce8\u518c\u4e3a\u53d8\u91cf\uff0c\u6216\u7531Ansible\u8f93\u51fa\u5230\u63a7\u5236\u53f0\u3002","title":"\u6a21\u5757\u8fd4\u56de\u503c"},{"location":"dev/modules/module-return/#_2","text":"\u6240\u6709\u6a21\u5757\u901a\u7528\u7684\u8fd4\u56de\u503c \u540d\u79f0 \u7c7b\u578b \u8bf4\u660e backup_file str \u5bf9\u4e8e\u4e00\u4e9bmodules\u4f7f\u7528\u4e86backup\u53d8\u91cf\uff0c\u8fd4\u56de\u5907\u4efd\u7684\u6587\u4ef6\u8def\u5f84 changed bool \u8868\u793a\u4efb\u52a1\u662f\u5426\u5fc5\u987b\u8fdb\u884c\u66f4\u6539\u3002 failed bool \u8868\u793a\u4efb\u52a1\u662f\u5426\u5931\u8d25\u3002 invocation dict \u6709\u5173\u5982\u4f55\u8c03\u7528\u6a21\u5757\u7684\u4fe1\u606f\u3002 msg str \u5b58\u50a8\u901a\u7528\u6d88\u606f\u7684\u5b57\u7b26\u4e32 rc int \u547d\u4ee4\u884c\u7a0b\u5e8f\u7684\u8fd4\u56de\u7801 results dict \u5982\u679c\u8be5\u952e\u5b58\u5728\uff0c\u5219\u8868\u793a\u8be5\u4efb\u52a1\u5b58\u5728\u5faa\u73af\uff0c\u5e76\u4e14\u5b83\u5305\u542b\u6bcf\u4e2a\u9879\u76ee\u7684\u6a21\u5757\u201cresults\u201d\u7684\u5217\u8868\u3002 skipped bool \u8868\u793a\u8be5\u4efb\u52a1\u662f\u5426\u88ab\u8df3\u8fc7 stderr str \u547d\u4ee4\u884c\u7a0b\u5e8f\u7684\u9519\u8bef\u8f93\u51fa stderr_lines list \u5b83\u5c06stderr\u5b57\u7b26\u4e32\u6309\u884c\u5206\u5272\u5b58\u50a8\u5728\u5217\u8868\u4e2d stdout str \u547d\u4ee4\u884c\u7a0b\u5e8f\u7684\u6807\u51c6\u8f93\u51fa stdout_lines list \u5b83\u5c06stdout\u5b57\u7b26\u4e32\u6309\u884c\u5206\u5272\u5b58\u50a8\u5728\u5217\u8868\u4e2d","title":"\u901a\u7528\u8fd4\u56de\u503c"},{"location":"dev/modules/module-return/#_3","text":"\u8fd9\u4e9b\u503c\u662fansible\u5185\u90e8\u5b9a\u4e49\u7684,\u6a21\u5757\u53ef\u4ee5\u4f7f\u7528\uff0c\u4f46\u4e0d\u80fd\u7528\u4f5c\u6ce8\u518c\u53d8\u91cf\u3002 \u540d\u79f0 \u7c7b\u578b \u8bf4\u660e ansible_facts dict \u8be5key\u5e94\u5305\u542b\u4e00\u4e2a\u5b57\u5178\uff0c\u9644\u52a0\u5230\u5206\u914d\u7ed9\u4e3b\u673a\u7684fact\u3002 \u8fd9\u4e9b\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\uff0c\u4e0d\u9700\u8981\u4f7f\u7528\u6ce8\u518c\u7684\u53d8\u91cf\u3002 exception dict \u8be5key\u5305\u542b\u7531\u6a21\u5757\u4e2d\u7684\u5f02\u5e38\u5f15\u8d77\u7684\u8ffd\u6eaf\u4fe1\u606f\u3002 \u5b83\u53ea\u80fd\u4ee5\u9ad8\u5ea6\u8be6\u7ec6\u7a0b\u5ea6\u663e\u793a\uff08-vvv\uff09\u3002 warnings list \u6b64\u952e\u5305\u542b\u5c06\u663e\u793a\u7ed9\u7528\u6237\u7684\u5b57\u7b26\u4e32\u5217\u8868\u3002 deprecations dict \u8fd4\u56demsg\u548cversion\u7684\u5b57\u5178\u5217\u8868","title":"\u5185\u90e8\u4f7f\u7528"},{"location":"dev/modules/module-shell-dir/","text":"\u4f7f\u7528 Shell \u811a\u672c\u64cd\u4f5c\u76ee\u5f55 \u00b6 \u9700\u6c42 \u00b6 \u521b\u5efa\u6216\u5220\u9664\u76ee\u5f55\u3002 \u6a21\u5757\u4f7f\u7528\u4ee5\u4e0b\u53c2\u6570\u3002 \u53c2\u6570 \u8bf4\u660e name \u76ee\u5f55\u540d path \u521b\u5efa\u76ee\u5f55\u7684\u8def\u5f84 state present\u521b\u5efa\uff0cabsent\u5220\u9664 \u7f16\u5199 module \u00b6 #!/bin/bash # # This code is ansible module example using bash. function exit_json () { if [ -n \" $2 \" ] ; then json_structure = \" { \\\"changed\\\": $1 , $2 } \" else json_structure = \" { \\\"changed\\\": $1 } \" fi echo $json_structure exit 0 } function fail_json () { json_structure = \" { \\\"failed\\\": \" true \", \\\"msg\\\": \\\" $1 \\\" } \" echo $json_structure exit 1 } function main () { # arg parse arg_flag = 0 for arg in $( cat $1 ) ; do echo $arg | grep -E ',|\\[|\\]' > /dev/null 2 > & 1 if [ $? -eq 0 ] ; then arg2 = \" $arg2$arg \" arg_flag = 1 continue fi if [ $arg_flag -eq 0 ] ; then key = ` echo $arg | cut -d '=' -f 1 ` value = ` echo $arg | cut -d '=' -f 2 ` declare \"module_arg_ $key = $value \" arg_flag = 0 else key = ` echo $arg2 | cut -d '=' -f 1 ` value = ` echo $arg2 | cut -d '=' -f 2 ` declare \"module_arg_ $key = $value \" arg_flag = 0 fi done # parameters name = $module_arg_name path = $module_arg_path state = $module_arg_state # When state is present if [ $state == \"present\" -a -n \" $name \" -a -n \" $path \" ] ; then if [ -d $path ] ; then if [ -d \" $path / $name \" ] ; then exit_json \"false\" else result = ` mkdir \" $path / $name \" 2 > & 1 ` if [ -n \" $result \" ] ; then fail_json \"`echo -n $result `\" else exit_json \"true\" \"\\\"directory_path\\\": \\\" $path / $name \\\"\" fi fi else fail_json \"Error: not found $module_arg_path \" fi fi # When state is absent if [ $state == \"absent\" -a -n \" $name \" -a -n \" $path \" ] ; then if [ -d \" $path / $name \" ] ; then rm -rf \" $path / $name \" 2 > & 1 > /dev/null if [ -d \" $path / $name \" ] ; then fail_json \"Error: failed delete folder $path / $name \" fi exit_json \"true\" \"\\\"directory_path\\\": \\\" $path / $name \\\"\" else exit_json \"false\" fi fi fail_json \"Required parameters include: name, path, state\" } main $1 ansible \u914d\u7f6e \u00b6 \u5728 /etc/ansible/ansible.cfg \u4e2d\u6307\u5b9a\u6a21\u5757\u76ee\u5f55 [defaults] library = /etc/ansible/library/ \u6267\u884c ad-hoc \u00b6 # ansible localhost -m dir -a \"name=test path=/tmp state=present\" localhost | CHANGED = > { \"changed\" : true, \"directory_path\" : \"/tmp/test\" } # file /tmp/test /tmp/test: directory # ansible localhost -m dir -a \"name=test path=/tmp state=absent\" localhost | CHANGED = > { \"changed\" : true, \"directory_path\" : \"/tmp/test\" } # file /tmp/test /tmp/test: cannot open ( No such file or directory ) \u6267\u884c playbook \u00b6 --- - name : Directory operation playbook hosts : localhost gather_facts : no tasks : - dir : name : test path : /tmp state : present - dir : name : test2 path : /tmp state : absent \u6267\u884c\u7ed3\u679c # ansible-playbook test_dir.yml PLAY [ Directory operation playbook ] ******************************************************************************************************************* TASK [ dir ] ******************************************************************************************************************************************** changed: [ localhost ] TASK [ dir ] ******************************************************************************************************************************************** ok: [ localhost ] PLAY RECAP ******************************************************************************************************************************************** localhost : ok = 2 changed = 1 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 # file /tmp/test /tmp/test: directory # file /tmp/test2 /tmp/test2: cannot open ( No such file or directory )","title":"module \u793a\u4f8b: dir"},{"location":"dev/modules/module-shell-dir/#shell","text":"","title":"\u4f7f\u7528 Shell \u811a\u672c\u64cd\u4f5c\u76ee\u5f55"},{"location":"dev/modules/module-shell-dir/#_1","text":"\u521b\u5efa\u6216\u5220\u9664\u76ee\u5f55\u3002 \u6a21\u5757\u4f7f\u7528\u4ee5\u4e0b\u53c2\u6570\u3002 \u53c2\u6570 \u8bf4\u660e name \u76ee\u5f55\u540d path \u521b\u5efa\u76ee\u5f55\u7684\u8def\u5f84 state present\u521b\u5efa\uff0cabsent\u5220\u9664","title":"\u9700\u6c42"},{"location":"dev/modules/module-shell-dir/#module","text":"#!/bin/bash # # This code is ansible module example using bash. function exit_json () { if [ -n \" $2 \" ] ; then json_structure = \" { \\\"changed\\\": $1 , $2 } \" else json_structure = \" { \\\"changed\\\": $1 } \" fi echo $json_structure exit 0 } function fail_json () { json_structure = \" { \\\"failed\\\": \" true \", \\\"msg\\\": \\\" $1 \\\" } \" echo $json_structure exit 1 } function main () { # arg parse arg_flag = 0 for arg in $( cat $1 ) ; do echo $arg | grep -E ',|\\[|\\]' > /dev/null 2 > & 1 if [ $? -eq 0 ] ; then arg2 = \" $arg2$arg \" arg_flag = 1 continue fi if [ $arg_flag -eq 0 ] ; then key = ` echo $arg | cut -d '=' -f 1 ` value = ` echo $arg | cut -d '=' -f 2 ` declare \"module_arg_ $key = $value \" arg_flag = 0 else key = ` echo $arg2 | cut -d '=' -f 1 ` value = ` echo $arg2 | cut -d '=' -f 2 ` declare \"module_arg_ $key = $value \" arg_flag = 0 fi done # parameters name = $module_arg_name path = $module_arg_path state = $module_arg_state # When state is present if [ $state == \"present\" -a -n \" $name \" -a -n \" $path \" ] ; then if [ -d $path ] ; then if [ -d \" $path / $name \" ] ; then exit_json \"false\" else result = ` mkdir \" $path / $name \" 2 > & 1 ` if [ -n \" $result \" ] ; then fail_json \"`echo -n $result `\" else exit_json \"true\" \"\\\"directory_path\\\": \\\" $path / $name \\\"\" fi fi else fail_json \"Error: not found $module_arg_path \" fi fi # When state is absent if [ $state == \"absent\" -a -n \" $name \" -a -n \" $path \" ] ; then if [ -d \" $path / $name \" ] ; then rm -rf \" $path / $name \" 2 > & 1 > /dev/null if [ -d \" $path / $name \" ] ; then fail_json \"Error: failed delete folder $path / $name \" fi exit_json \"true\" \"\\\"directory_path\\\": \\\" $path / $name \\\"\" else exit_json \"false\" fi fi fail_json \"Required parameters include: name, path, state\" } main $1","title":"\u7f16\u5199 module"},{"location":"dev/modules/module-shell-dir/#ansible","text":"\u5728 /etc/ansible/ansible.cfg \u4e2d\u6307\u5b9a\u6a21\u5757\u76ee\u5f55 [defaults] library = /etc/ansible/library/","title":"ansible \u914d\u7f6e"},{"location":"dev/modules/module-shell-dir/#ad-hoc","text":"# ansible localhost -m dir -a \"name=test path=/tmp state=present\" localhost | CHANGED = > { \"changed\" : true, \"directory_path\" : \"/tmp/test\" } # file /tmp/test /tmp/test: directory # ansible localhost -m dir -a \"name=test path=/tmp state=absent\" localhost | CHANGED = > { \"changed\" : true, \"directory_path\" : \"/tmp/test\" } # file /tmp/test /tmp/test: cannot open ( No such file or directory )","title":"\u6267\u884c ad-hoc"},{"location":"dev/modules/module-shell-dir/#playbook","text":"--- - name : Directory operation playbook hosts : localhost gather_facts : no tasks : - dir : name : test path : /tmp state : present - dir : name : test2 path : /tmp state : absent \u6267\u884c\u7ed3\u679c # ansible-playbook test_dir.yml PLAY [ Directory operation playbook ] ******************************************************************************************************************* TASK [ dir ] ******************************************************************************************************************************************** changed: [ localhost ] TASK [ dir ] ******************************************************************************************************************************************** ok: [ localhost ] PLAY RECAP ******************************************************************************************************************************************** localhost : ok = 2 changed = 1 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 # file /tmp/test /tmp/test: directory # file /tmp/test2 /tmp/test2: cannot open ( No such file or directory )","title":"\u6267\u884c playbook"},{"location":"dev/modules/module-utilities/","text":"\u6a21\u5757\u5de5\u5177\u7c7b \u00b6 Ansible\u63d0\u4f9b\u4e86\u8bb8\u591a\u6a21\u5757\u5b9e\u7528\u7c7b\uff0c\u6216\u4ee3\u7801\u7247\u6bb5\u6765\u5e2e\u52a9\u4f60\u5728Python\u4e2d\u5feb\u901f\u6784\u5efaansible\u6a21\u5757\u3002 \u8fd9\u4e9b\u6a21\u5757\u5de5\u5177\u7c7b\u9ed8\u8ba4\u5b58\u653e\u5728 /usr/lib/python2.7/site-packages/ansible/module_utils/ \u4e2d\uff0c basic.py \u6a21\u5757\u7c7b\u662fansible\u6a21\u5757\u7684\u4e3b\u8981\u5165\u53e3\uff0c\u5e38\u89c1\u7684\u5de5\u5177\u7c7b\u662f AnsibleModule \u3002 AnsibleModule \u00b6 \u60f3\u8981\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u4f7f\u7528 from ansible.module_utils.basic import AnsibleModule \u547d\u4ee4\u5bfc\u5165\u5373\u53ef\u3002 class ansible . module_utils . basic . AnsibleModule ( argument_spec , bypass_checks = False , no_log = False , check_invalid_arguments = None , mutually_exclusive = None , required_together = None , required_one_of = None , add_file_common_args = False , supports_check_mode = False , required_if = None , required_by = None ) \u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u53ef\u4ee5\u5728Python\u4e2d\u5feb\u901f\u6784\u5efaansible\u6a21\u5757\u7684\u901a\u7528\u4ee3\u7801(\u5c3d\u7ba1\u60a8\u53ef\u4ee5\u7528\u4efb\u4f55\u53ef\u4ee5\u8fd4\u56deJSON\u7684\u4e1c\u897f\u6765\u7f16\u5199\u6a21\u5757)\u3002 add_path_info ( kwargs ) \u5bf9\u4e8e\u6587\u4ef6\u7ed3\u679c\uff0c\u8bf7\u5728\u8fd4\u56de\u8def\u5f84\u4e2d\u6dfb\u52a0\u6709\u5173\u6587\u4ef6\u8def\u5f84\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u4ee5\u8865\u5145\u6709\u5173\u6587\u4ef6\u7684\u4fe1\u606f\u3002 atomic_move ( src , dest , unsafe_writes=False ) \u539f\u5b50\u6027\u7684\u79fb\u52a8\u6587\u4ef6 backup_local ( fn ) \u5bf9\u6307\u5b9a\u6587\u4ef6\u8fdb\u884c\u5e26\u65e5\u671f\u6807\u8bb0\u7684\u5907\u4efd\uff0c\u6210\u529f\u6216\u5931\u8d25\u65f6\u8fd4\u56deTrue\u6216False boolean ( arg ) \u5c06\u53c2\u6570\u8f6c\u6362\u4e3a\u5e03\u5c14\u503c digest_from_file ( filename , algorithm ) \u8fd4\u56de\u672c\u5730\u6587\u4ef6\u7684\u5341\u516d\u8fdb\u5236\u6458\u8981\u4ee5\u83b7\u53d6\u7531\u540d\u79f0\u6307\u5b9a\u7684digest_method\uff1b\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56deNone\u3002 exit_json ( **kwargs ) \u4ee5json\u6570\u636e\u7684\u5f62\u5f0f\u4ece\u6a21\u5757\u8fd4\u56de fail_json ( **kwargs ) \u4ee5json\u6570\u636e\u7684\u5f62\u5f0f\u4ece\u6a21\u5757\u8fd4\u56de\uff0c\u5e76\u5e26\u6709\u9519\u8bef\u4fe1\u606f\u3002 get_bin_path ( arg , required=False , opt_dirs=None ) \u67e5\u627e\u7cfb\u7edf\u4e2d\u7684\u53ef\u6267\u884c\u6587\u4ef6\u7684\u8def\u5f84\u3002 is_executable ( path ) \u5224\u65ad\u7ed9\u5b9a\u7684\u8def\u5f84\u662f\u5426\u53ef\u6267\u884c is_special_selinux_path ( path ) \u5982\u679c\u7ed9\u5b9a\u7684\u8def\u5f84\u4f4d\u4e8eNFS\u6216\u5176\u4ed6\u7279\u6b8a\u7684fs\u6302\u8f7d\u70b9\u4e0a\uff0c\u5219\u8fd4\u56de\u4e00\u4e2a\u5305\u542b(True, selinux\u4e0a\u4e0b\u6587)\u7684\u5143\u7ec4\uff0c\u5426\u5219\u8fd4\u56de\u5c06\u4e3a(False, None)\u3002 load_file_common_arguments ( params ) \u5c01\u88c5\u4e86file\u6a21\u5757\u7684\u5e38\u89c1\u9009\u9879,\u4ee5\u4fbf\u53ef\u4ee5\u591a\u6b21\u5229\u7528\u3002 md5 ( filename ) \u4f7f\u7528 digest_from_file() \u8fd4\u56de\u672c\u5730\u6587\u4ef6\u7684MD5\u6458\u8981 preserved_copy ( src , dest ) \u590d\u5236\u4e00\u4e2a\u6587\u4ef6,\u4fdd\u7559\u6240\u6709\u6743\u9650 run_command ( args , check_rc=False , close_fds=True , executable=None , data=None , binary_data=False , path_prefix=None , cwd=None , use_unsafe_shell=False , prompt_regex=None , environ_update=None , umask=None , encoding='utf-8' , errors='surrogate_or_strict' , expand_user_and_vars=True , pass_fds=None , before_communicate_callback=None ) \u6267\u884c\u4e00\u4e2a\u547d\u4ee4,\u8fd4\u56derc\u3001stdout\u548cstderr\u3002 sha1 ( filename ) \u4f7f\u7528 digest_from_file() \u8fd4\u56de\u672c\u5730\u6587\u4ef6\u7684SHA1\u6458\u8981\u3002 sha256 ( filename ) \u4f7f\u7528 digest_from_file() \u8fd4\u56de\u672c\u5730\u6587\u4ef6\u7684SHA256\u6458\u8981\u3002 \u66f4\u591a\u5185\u5bb9\u89c1 basic \u6587\u4ef6\uff1a /usr/lib/python2.7/site-packages/ansible/module_utils/basic.py Basic \u00b6 \u60f3\u8981\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u4f7f\u7528 import ansible.module_utils.basic \u547d\u4ee4\u5bfc\u5165\u5373\u53ef\u3002 ansible.module_utils.basic.AnsibleFallbackNotFound \u5f02\u5e38 ansible.module_utils.basic.env_fallback ( *args , **kwargs ) \u4ece\u73af\u5883\u4e2d\u52a0\u8f7d\u503c ansible.module_utils.basic.heuristic_log_sanitize ( data , no_log_values=None ) \u4ece\u65e5\u5fd7\u6d88\u606f\u4e2d\u5220\u9664\u7c7b\u4f3c\u5bc6\u7801\u7684\u5b57\u7b26\u4e32 ansible.module_utils.basic.remove_values ( value , no_log_strings ) \u4ece value \u4e2d\u5220\u9664 no_log_strings \u5b57\u7b26\u4e32\u4e2d\u7684\u5b57\u7b26\u4e32 \u66f4\u591a\u5185\u5bb9\u89c1 basic \u6587\u4ef6\uff1a /usr/lib/python2.7/site-packages/ansible/module_utils/basic.py module \u5de5\u5177\u7c7b\u7684\u547d\u540d\u548c\u67e5\u627e \u00b6 \u901a\u5e38\uff0c\u60a8\u4ece\u540d\u79f0\u6216\u4f4d\u7f6e\u5c31\u53ef\u4ee5\u77e5\u9053\u6a21\u5757\u5de5\u5177\u7c7b\u7684\u529f\u80fd\u3002 lib/ansible/module_utils/urls.py \u5305\u542b\u7528\u4e8e\u89e3\u6790URL\u7684\u5171\u4eab\u4ee3\u7801 lib/ansible/module_utils/storage/emc/ \u5305\u542b\u4e0eEMC\u76f8\u5173\u7684\u5171\u4eab\u4ee3\u7801 lib/ansible/modules/storage/emc/ \u5305\u542b\u4e0eEMC\u76f8\u5173\u7684\u6a21\u5757 \u81ea\u5b9a\u4e49\u7684\u6a21\u5757\u7a0b\u5e8f\u9075\u5faa\u6b64\u6a21\u5f0f\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u67e5\u627e\u548c\u4f7f\u7528\u3002 \u5176\u4ed6\u5de5\u5177\u7c7b \u00b6 api.py - Supports generic API modules basic.py - General definitions and helper utilities for Ansible modules common/dict_transformations.py - Helper functions for dictionary transformations common/file.py - Helper functions for working with files common/text/ - Helper functions for converting and formatting text. common/parameters.py - Helper functions for dealing with module parameters common/sys_info.py - Functions for getting distribution and platform information common/validation.py - Helper functions for validating module parameters against a module argument spec facts/ - Directory of utilities for modules that return facts. See PR 23012 for more information ismount.py - Single helper function that fixes os.path.ismount json_utils.py - Utilities for filtering unrelated output around module JSON output, like leading and trailing lines known_hosts.py - utilities for working with known_hosts file network/common/config.py - Configuration utility functions for use by networking modules network/common/netconf.py - Definitions and helper functions for modules that use Netconf transport network/common/parsing.py - Definitions and helper functions for Network modules network/common/network.py - Functions for running commands on networking devices network/common/utils.py - Defines commands and comparison operators and other utilises for use in networking modules powershell/ - Directory of definitions and helper functions for Windows PowerShell modules pycompat24.py - Exception workaround for Python 2.4 service.py - Utilities to enable modules to work with Linux services (placeholder, not in use) shell.py - Functions to allow modules to create shells and work with shell commands six/__init__.py - Bundled copy of the Six Python library to aid in writing code compatible with both Python 2 and Python 3 splitter.py - String splitting and manipulation utilities for working with Jinja2 templates urls.py - Utilities for working with http and https requests","title":"module \u5de5\u5177\u7c7b"},{"location":"dev/modules/module-utilities/#_1","text":"Ansible\u63d0\u4f9b\u4e86\u8bb8\u591a\u6a21\u5757\u5b9e\u7528\u7c7b\uff0c\u6216\u4ee3\u7801\u7247\u6bb5\u6765\u5e2e\u52a9\u4f60\u5728Python\u4e2d\u5feb\u901f\u6784\u5efaansible\u6a21\u5757\u3002 \u8fd9\u4e9b\u6a21\u5757\u5de5\u5177\u7c7b\u9ed8\u8ba4\u5b58\u653e\u5728 /usr/lib/python2.7/site-packages/ansible/module_utils/ \u4e2d\uff0c basic.py \u6a21\u5757\u7c7b\u662fansible\u6a21\u5757\u7684\u4e3b\u8981\u5165\u53e3\uff0c\u5e38\u89c1\u7684\u5de5\u5177\u7c7b\u662f AnsibleModule \u3002","title":"\u6a21\u5757\u5de5\u5177\u7c7b"},{"location":"dev/modules/module-utilities/#ansiblemodule","text":"\u60f3\u8981\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u4f7f\u7528 from ansible.module_utils.basic import AnsibleModule \u547d\u4ee4\u5bfc\u5165\u5373\u53ef\u3002 class ansible . module_utils . basic . AnsibleModule ( argument_spec , bypass_checks = False , no_log = False , check_invalid_arguments = None , mutually_exclusive = None , required_together = None , required_one_of = None , add_file_common_args = False , supports_check_mode = False , required_if = None , required_by = None ) \u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u53ef\u4ee5\u5728Python\u4e2d\u5feb\u901f\u6784\u5efaansible\u6a21\u5757\u7684\u901a\u7528\u4ee3\u7801(\u5c3d\u7ba1\u60a8\u53ef\u4ee5\u7528\u4efb\u4f55\u53ef\u4ee5\u8fd4\u56deJSON\u7684\u4e1c\u897f\u6765\u7f16\u5199\u6a21\u5757)\u3002 add_path_info ( kwargs ) \u5bf9\u4e8e\u6587\u4ef6\u7ed3\u679c\uff0c\u8bf7\u5728\u8fd4\u56de\u8def\u5f84\u4e2d\u6dfb\u52a0\u6709\u5173\u6587\u4ef6\u8def\u5f84\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u4ee5\u8865\u5145\u6709\u5173\u6587\u4ef6\u7684\u4fe1\u606f\u3002 atomic_move ( src , dest , unsafe_writes=False ) \u539f\u5b50\u6027\u7684\u79fb\u52a8\u6587\u4ef6 backup_local ( fn ) \u5bf9\u6307\u5b9a\u6587\u4ef6\u8fdb\u884c\u5e26\u65e5\u671f\u6807\u8bb0\u7684\u5907\u4efd\uff0c\u6210\u529f\u6216\u5931\u8d25\u65f6\u8fd4\u56deTrue\u6216False boolean ( arg ) \u5c06\u53c2\u6570\u8f6c\u6362\u4e3a\u5e03\u5c14\u503c digest_from_file ( filename , algorithm ) \u8fd4\u56de\u672c\u5730\u6587\u4ef6\u7684\u5341\u516d\u8fdb\u5236\u6458\u8981\u4ee5\u83b7\u53d6\u7531\u540d\u79f0\u6307\u5b9a\u7684digest_method\uff1b\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56deNone\u3002 exit_json ( **kwargs ) \u4ee5json\u6570\u636e\u7684\u5f62\u5f0f\u4ece\u6a21\u5757\u8fd4\u56de fail_json ( **kwargs ) \u4ee5json\u6570\u636e\u7684\u5f62\u5f0f\u4ece\u6a21\u5757\u8fd4\u56de\uff0c\u5e76\u5e26\u6709\u9519\u8bef\u4fe1\u606f\u3002 get_bin_path ( arg , required=False , opt_dirs=None ) \u67e5\u627e\u7cfb\u7edf\u4e2d\u7684\u53ef\u6267\u884c\u6587\u4ef6\u7684\u8def\u5f84\u3002 is_executable ( path ) \u5224\u65ad\u7ed9\u5b9a\u7684\u8def\u5f84\u662f\u5426\u53ef\u6267\u884c is_special_selinux_path ( path ) \u5982\u679c\u7ed9\u5b9a\u7684\u8def\u5f84\u4f4d\u4e8eNFS\u6216\u5176\u4ed6\u7279\u6b8a\u7684fs\u6302\u8f7d\u70b9\u4e0a\uff0c\u5219\u8fd4\u56de\u4e00\u4e2a\u5305\u542b(True, selinux\u4e0a\u4e0b\u6587)\u7684\u5143\u7ec4\uff0c\u5426\u5219\u8fd4\u56de\u5c06\u4e3a(False, None)\u3002 load_file_common_arguments ( params ) \u5c01\u88c5\u4e86file\u6a21\u5757\u7684\u5e38\u89c1\u9009\u9879,\u4ee5\u4fbf\u53ef\u4ee5\u591a\u6b21\u5229\u7528\u3002 md5 ( filename ) \u4f7f\u7528 digest_from_file() \u8fd4\u56de\u672c\u5730\u6587\u4ef6\u7684MD5\u6458\u8981 preserved_copy ( src , dest ) \u590d\u5236\u4e00\u4e2a\u6587\u4ef6,\u4fdd\u7559\u6240\u6709\u6743\u9650 run_command ( args , check_rc=False , close_fds=True , executable=None , data=None , binary_data=False , path_prefix=None , cwd=None , use_unsafe_shell=False , prompt_regex=None , environ_update=None , umask=None , encoding='utf-8' , errors='surrogate_or_strict' , expand_user_and_vars=True , pass_fds=None , before_communicate_callback=None ) \u6267\u884c\u4e00\u4e2a\u547d\u4ee4,\u8fd4\u56derc\u3001stdout\u548cstderr\u3002 sha1 ( filename ) \u4f7f\u7528 digest_from_file() \u8fd4\u56de\u672c\u5730\u6587\u4ef6\u7684SHA1\u6458\u8981\u3002 sha256 ( filename ) \u4f7f\u7528 digest_from_file() \u8fd4\u56de\u672c\u5730\u6587\u4ef6\u7684SHA256\u6458\u8981\u3002 \u66f4\u591a\u5185\u5bb9\u89c1 basic \u6587\u4ef6\uff1a /usr/lib/python2.7/site-packages/ansible/module_utils/basic.py","title":"AnsibleModule"},{"location":"dev/modules/module-utilities/#basic","text":"\u60f3\u8981\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u4f7f\u7528 import ansible.module_utils.basic \u547d\u4ee4\u5bfc\u5165\u5373\u53ef\u3002 ansible.module_utils.basic.AnsibleFallbackNotFound \u5f02\u5e38 ansible.module_utils.basic.env_fallback ( *args , **kwargs ) \u4ece\u73af\u5883\u4e2d\u52a0\u8f7d\u503c ansible.module_utils.basic.heuristic_log_sanitize ( data , no_log_values=None ) \u4ece\u65e5\u5fd7\u6d88\u606f\u4e2d\u5220\u9664\u7c7b\u4f3c\u5bc6\u7801\u7684\u5b57\u7b26\u4e32 ansible.module_utils.basic.remove_values ( value , no_log_strings ) \u4ece value \u4e2d\u5220\u9664 no_log_strings \u5b57\u7b26\u4e32\u4e2d\u7684\u5b57\u7b26\u4e32 \u66f4\u591a\u5185\u5bb9\u89c1 basic \u6587\u4ef6\uff1a /usr/lib/python2.7/site-packages/ansible/module_utils/basic.py","title":"Basic"},{"location":"dev/modules/module-utilities/#module","text":"\u901a\u5e38\uff0c\u60a8\u4ece\u540d\u79f0\u6216\u4f4d\u7f6e\u5c31\u53ef\u4ee5\u77e5\u9053\u6a21\u5757\u5de5\u5177\u7c7b\u7684\u529f\u80fd\u3002 lib/ansible/module_utils/urls.py \u5305\u542b\u7528\u4e8e\u89e3\u6790URL\u7684\u5171\u4eab\u4ee3\u7801 lib/ansible/module_utils/storage/emc/ \u5305\u542b\u4e0eEMC\u76f8\u5173\u7684\u5171\u4eab\u4ee3\u7801 lib/ansible/modules/storage/emc/ \u5305\u542b\u4e0eEMC\u76f8\u5173\u7684\u6a21\u5757 \u81ea\u5b9a\u4e49\u7684\u6a21\u5757\u7a0b\u5e8f\u9075\u5faa\u6b64\u6a21\u5f0f\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u67e5\u627e\u548c\u4f7f\u7528\u3002","title":"module \u5de5\u5177\u7c7b\u7684\u547d\u540d\u548c\u67e5\u627e"},{"location":"dev/modules/module-utilities/#_2","text":"api.py - Supports generic API modules basic.py - General definitions and helper utilities for Ansible modules common/dict_transformations.py - Helper functions for dictionary transformations common/file.py - Helper functions for working with files common/text/ - Helper functions for converting and formatting text. common/parameters.py - Helper functions for dealing with module parameters common/sys_info.py - Functions for getting distribution and platform information common/validation.py - Helper functions for validating module parameters against a module argument spec facts/ - Directory of utilities for modules that return facts. See PR 23012 for more information ismount.py - Single helper function that fixes os.path.ismount json_utils.py - Utilities for filtering unrelated output around module JSON output, like leading and trailing lines known_hosts.py - utilities for working with known_hosts file network/common/config.py - Configuration utility functions for use by networking modules network/common/netconf.py - Definitions and helper functions for modules that use Netconf transport network/common/parsing.py - Definitions and helper functions for Network modules network/common/network.py - Functions for running commands on networking devices network/common/utils.py - Defines commands and comparison operators and other utilises for use in networking modules powershell/ - Directory of definitions and helper functions for Windows PowerShell modules pycompat24.py - Exception workaround for Python 2.4 service.py - Utilities to enable modules to work with Linux services (placeholder, not in use) shell.py - Functions to allow modules to create shells and work with shell commands six/__init__.py - Bundled copy of the Six Python library to aid in writing code compatible with both Python 2 and Python 3 splitter.py - String splitting and manipulation utilities for working with Jinja2 templates urls.py - Utilities for working with http and https requests","title":"\u5176\u4ed6\u5de5\u5177\u7c7b"},{"location":"dev/modules/module-wechat/","text":"wechat \u6a21\u5757 \u00b6 \u9700\u6c42 \u00b6 \u5f53ansible\u6267\u884c\u5b8c\u4efb\u52a1\u65f6\uff0c\u901a\u8fc7\u4f01\u4e1a\u5fae\u4fe1\u901a\u77e5\u5230\u7528\u6237\u3002 \u5b9e\u73b0 \u00b6 \u4f7f\u7528ansible\u7684 fetch_url \u83b7\u53d6\u4f01\u4e1a\u5fae\u4fe1\u63a5\u53e3\u7684token\uff0c\u7136\u540e\u5411\u53d1\u9001\u6d88\u606f\u7684\u63a5\u53e3post\u6211\u4eec\u51c6\u5907\u597d\u7684\u6570\u636e\u3002 \u4ee3\u7801 \u00b6 File: lib/ansible/modules/notification/wechat.py #!/usr/bin/python # -*- coding: utf-8 -*- # # Copyright: lework # GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt) from __future__ import absolute_import , division , print_function __metaclass__ = type ANSIBLE_METADATA = { 'metadata_version' : '1.1' , 'status' : [ 'stableinterface' ], 'supported_by' : 'community' } DOCUMENTATION = ''' --- module: wechat version_added: \"2.9\" short_description: Send a message to Wechat. description: - Send a message to Wechat. options: corpid: description: - Business id. required: true type: str secret: description: - application secret. required: true type: str agentid: description: - application id. required: true type: str touser: description: - Member ID list (message recipient, multiple recipients separated by '|', up to 1000). - \"Special case: Specify @all to send to all members of the enterprise application.\" - When toparty, touser, totag is empty, the default value is @all. type: str toparty: description: - A list of department IDs. Multiple recipients are separated by '|' and support up to 100. Ignore this parameter when touser is @all type: str totag: description: - A list of tag IDs, separated by '|' and supported by up to 100. Ignore this parameter when touser is @all type: str msg: description: - The message body. required: true type: str author: - lework (@lework) ''' EXAMPLES = ''' # Send all users. - wechat: corpid: \"123\" secret: \"456\" agentid: \"100001\" msg: Ansible task finished # Send a user. - wechat: corpid: \"123\" secret: \"456\" agentid: \"100001\" touser: \"LeWork\" msg: Ansible task finished # Send multiple user. - wechat: corpid: \"123\" secret: \"456\" agentid: \"100001\" touser: \"LeWork|Lework1|Lework2\" msg: Ansible task finished # Send a department. - wechat: corpid: \"123\" secret: \"456\" agentid: \"100001\" toparty: \"10\" msg: Ansible task finished ''' RETURN = \"\"\" msg: description: The message you attempted to send returned: success,failure type: str sample: \"Ansible task finished\" touser: description: send user id returned: success type: str sample: \"ZhangSan\" toparty: description: send department id returned: success type: str sample: \"10\" totag: description: send tag id returned: success type: str sample: \"dev\" wechat_error: description: Error message gotten from Wechat API returned: failure type: str sample: \"Bad Request: message text is empty\" \"\"\" # =========================================== # WeChat module specific support methods. # import json import traceback from ansible.module_utils.basic import AnsibleModule from ansible.module_utils._text import to_native from ansible.module_utils.urls import fetch_url class WeChat ( object ): def __init__ ( self , module , corpid , secret , agentid ): self . module = module self . url = 'https://qyapi.weixin.qq.com' self . corpid = corpid self . secret = secret self . agentid = agentid self . token = '' self . msg = '' if self . module . check_mode : module . exit_json ( changed = False ) self . access_token () def access_token ( self ): \"\"\" get access_token :return: \"\"\" url_arg = '/cgi-bin/gettoken?corpid= {id} &corpsecret= {crt} ' . format ( id = self . corpid , crt = self . secret ) url = self . url + url_arg response , info = fetch_url ( self . module , url = url ) text = response . read () try : self . token = json . loads ( text )[ 'access_token' ] except Exception as e : raise Exception ( \"Invalid corpid or corpsecret, api result: %s \" % text ) def messages ( self , msg , touser , toparty , totag ): \"\"\" Message body :param msg: message info :param touser: user id :param toparty: department id :param totag: tag id :return: \"\"\" values = { \"msgtype\" : 'text' , \"agentid\" : self . agentid , \"text\" : { 'content' : msg }, \"safe\" : 0 } if touser : values [ 'touser' ] = touser if toparty : values [ 'toparty' ] = toparty if toparty : values [ 'totag' ] = totag self . msg = json . dumps ( values ) def send_message ( self , msg , touser = None , toparty = None , totag = None ): \"\"\" send message :param msg: message info :param touser: user id :param toparty: department id :param totag: tag id :return: \"\"\" self . messages ( msg , touser , toparty , totag ) send_url = ' {url} /cgi-bin/message/send?access_token= {token} ' . format ( url = self . url , token = self . token ) response , info = fetch_url ( self . module , url = send_url , data = self . msg , method = 'POST' ) text = json . loads ( response . read ()) if text [ 'invaliduser' ] != '' : raise Exception ( \"invalid user: %s \" % text [ 'invaliduser' ]) def main (): module = AnsibleModule ( argument_spec = dict ( corpid = dict ( required = True , no_log = True ), secret = dict ( required = True , no_log = True ), agentid = dict ( required = True ,), msg = dict ( required = True ,), touser = dict (), toparty = dict (), totag = dict (), ), supports_check_mode = True ) corpid = module . params [ \"corpid\" ] secret = module . params [ \"secret\" ] agentid = module . params [ \"agentid\" ] msg = module . params [ \"msg\" ] touser = module . params [ \"touser\" ] toparty = module . params [ \"toparty\" ] totag = module . params [ \"totag\" ] try : if not touser and not toparty and not totag : touser = \"@all\" wechat = WeChat ( module , corpid , secret , agentid ) wechat . send_message ( msg , touser , toparty , totag ) except Exception as e : module . fail_json ( msg = \"unable to send msg: %s \" % msg , wechat_error = to_native ( e ), exception = traceback . format_exc ()) changed = True module . exit_json ( changed = changed , touser = touser , toparty = toparty , totag = totag , msg = msg ) if __name__ == '__main__' : main () \u6d4b\u8bd5 \u00b6 --- - hosts : localhost gather_facts : false tasks : - name : test1 debug : msg : demo - name : notice wechat : corpid : \"111111111111111\" secret : \"222222222222\" agentid : \"123\" touser : \"ZhangSan\" #toparty: \"10\" msg : Ansible task finished \u5176\u4e2dwehcat\u7684\u53c2\u6570\u8981\u8bbe\u7f6e\u6210\u81ea\u5df1\u7684 corpid: \u4f01\u4e1aid secret: \u5e94\u7528\u79d8\u94a5 agentid: \u5e94\u7528id touser: \u7528\u6237id toparty: \u90e8\u95e8id totag: \u6807\u7b7eid msg: \u53d1\u9001\u7684\u6d88\u606f \u53c2\u6570\u8be6\u7ec6\u8bf4\u660e\uff0c\u8bf7\u770b \u5fae\u4fe1\u5f00\u53d1\u6587\u6863","title":"module \u793a\u4f8b: wechat"},{"location":"dev/modules/module-wechat/#wechat","text":"","title":"wechat \u6a21\u5757"},{"location":"dev/modules/module-wechat/#_1","text":"\u5f53ansible\u6267\u884c\u5b8c\u4efb\u52a1\u65f6\uff0c\u901a\u8fc7\u4f01\u4e1a\u5fae\u4fe1\u901a\u77e5\u5230\u7528\u6237\u3002","title":"\u9700\u6c42"},{"location":"dev/modules/module-wechat/#_2","text":"\u4f7f\u7528ansible\u7684 fetch_url \u83b7\u53d6\u4f01\u4e1a\u5fae\u4fe1\u63a5\u53e3\u7684token\uff0c\u7136\u540e\u5411\u53d1\u9001\u6d88\u606f\u7684\u63a5\u53e3post\u6211\u4eec\u51c6\u5907\u597d\u7684\u6570\u636e\u3002","title":"\u5b9e\u73b0"},{"location":"dev/modules/module-wechat/#_3","text":"File: lib/ansible/modules/notification/wechat.py #!/usr/bin/python # -*- coding: utf-8 -*- # # Copyright: lework # GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt) from __future__ import absolute_import , division , print_function __metaclass__ = type ANSIBLE_METADATA = { 'metadata_version' : '1.1' , 'status' : [ 'stableinterface' ], 'supported_by' : 'community' } DOCUMENTATION = ''' --- module: wechat version_added: \"2.9\" short_description: Send a message to Wechat. description: - Send a message to Wechat. options: corpid: description: - Business id. required: true type: str secret: description: - application secret. required: true type: str agentid: description: - application id. required: true type: str touser: description: - Member ID list (message recipient, multiple recipients separated by '|', up to 1000). - \"Special case: Specify @all to send to all members of the enterprise application.\" - When toparty, touser, totag is empty, the default value is @all. type: str toparty: description: - A list of department IDs. Multiple recipients are separated by '|' and support up to 100. Ignore this parameter when touser is @all type: str totag: description: - A list of tag IDs, separated by '|' and supported by up to 100. Ignore this parameter when touser is @all type: str msg: description: - The message body. required: true type: str author: - lework (@lework) ''' EXAMPLES = ''' # Send all users. - wechat: corpid: \"123\" secret: \"456\" agentid: \"100001\" msg: Ansible task finished # Send a user. - wechat: corpid: \"123\" secret: \"456\" agentid: \"100001\" touser: \"LeWork\" msg: Ansible task finished # Send multiple user. - wechat: corpid: \"123\" secret: \"456\" agentid: \"100001\" touser: \"LeWork|Lework1|Lework2\" msg: Ansible task finished # Send a department. - wechat: corpid: \"123\" secret: \"456\" agentid: \"100001\" toparty: \"10\" msg: Ansible task finished ''' RETURN = \"\"\" msg: description: The message you attempted to send returned: success,failure type: str sample: \"Ansible task finished\" touser: description: send user id returned: success type: str sample: \"ZhangSan\" toparty: description: send department id returned: success type: str sample: \"10\" totag: description: send tag id returned: success type: str sample: \"dev\" wechat_error: description: Error message gotten from Wechat API returned: failure type: str sample: \"Bad Request: message text is empty\" \"\"\" # =========================================== # WeChat module specific support methods. # import json import traceback from ansible.module_utils.basic import AnsibleModule from ansible.module_utils._text import to_native from ansible.module_utils.urls import fetch_url class WeChat ( object ): def __init__ ( self , module , corpid , secret , agentid ): self . module = module self . url = 'https://qyapi.weixin.qq.com' self . corpid = corpid self . secret = secret self . agentid = agentid self . token = '' self . msg = '' if self . module . check_mode : module . exit_json ( changed = False ) self . access_token () def access_token ( self ): \"\"\" get access_token :return: \"\"\" url_arg = '/cgi-bin/gettoken?corpid= {id} &corpsecret= {crt} ' . format ( id = self . corpid , crt = self . secret ) url = self . url + url_arg response , info = fetch_url ( self . module , url = url ) text = response . read () try : self . token = json . loads ( text )[ 'access_token' ] except Exception as e : raise Exception ( \"Invalid corpid or corpsecret, api result: %s \" % text ) def messages ( self , msg , touser , toparty , totag ): \"\"\" Message body :param msg: message info :param touser: user id :param toparty: department id :param totag: tag id :return: \"\"\" values = { \"msgtype\" : 'text' , \"agentid\" : self . agentid , \"text\" : { 'content' : msg }, \"safe\" : 0 } if touser : values [ 'touser' ] = touser if toparty : values [ 'toparty' ] = toparty if toparty : values [ 'totag' ] = totag self . msg = json . dumps ( values ) def send_message ( self , msg , touser = None , toparty = None , totag = None ): \"\"\" send message :param msg: message info :param touser: user id :param toparty: department id :param totag: tag id :return: \"\"\" self . messages ( msg , touser , toparty , totag ) send_url = ' {url} /cgi-bin/message/send?access_token= {token} ' . format ( url = self . url , token = self . token ) response , info = fetch_url ( self . module , url = send_url , data = self . msg , method = 'POST' ) text = json . loads ( response . read ()) if text [ 'invaliduser' ] != '' : raise Exception ( \"invalid user: %s \" % text [ 'invaliduser' ]) def main (): module = AnsibleModule ( argument_spec = dict ( corpid = dict ( required = True , no_log = True ), secret = dict ( required = True , no_log = True ), agentid = dict ( required = True ,), msg = dict ( required = True ,), touser = dict (), toparty = dict (), totag = dict (), ), supports_check_mode = True ) corpid = module . params [ \"corpid\" ] secret = module . params [ \"secret\" ] agentid = module . params [ \"agentid\" ] msg = module . params [ \"msg\" ] touser = module . params [ \"touser\" ] toparty = module . params [ \"toparty\" ] totag = module . params [ \"totag\" ] try : if not touser and not toparty and not totag : touser = \"@all\" wechat = WeChat ( module , corpid , secret , agentid ) wechat . send_message ( msg , touser , toparty , totag ) except Exception as e : module . fail_json ( msg = \"unable to send msg: %s \" % msg , wechat_error = to_native ( e ), exception = traceback . format_exc ()) changed = True module . exit_json ( changed = changed , touser = touser , toparty = toparty , totag = totag , msg = msg ) if __name__ == '__main__' : main ()","title":"\u4ee3\u7801"},{"location":"dev/modules/module-wechat/#_4","text":"--- - hosts : localhost gather_facts : false tasks : - name : test1 debug : msg : demo - name : notice wechat : corpid : \"111111111111111\" secret : \"222222222222\" agentid : \"123\" touser : \"ZhangSan\" #toparty: \"10\" msg : Ansible task finished \u5176\u4e2dwehcat\u7684\u53c2\u6570\u8981\u8bbe\u7f6e\u6210\u81ea\u5df1\u7684 corpid: \u4f01\u4e1aid secret: \u5e94\u7528\u79d8\u94a5 agentid: \u5e94\u7528id touser: \u7528\u6237id toparty: \u90e8\u95e8id totag: \u6807\u7b7eid msg: \u53d1\u9001\u7684\u6d88\u606f \u53c2\u6570\u8be6\u7ec6\u8bf4\u660e\uff0c\u8bf7\u770b \u5fae\u4fe1\u5f00\u53d1\u6587\u6863","title":"\u6d4b\u8bd5"},{"location":"dev/modules/remote_copy/","text":"remote_copy \u6a21\u5757 \u00b6 \u901a\u8fc7\u8fd9\u4e2a\u7b80\u5355\u7684\u81ea\u5b9a\u4e49\u6a21\u5757\uff0c\u6765\u4e86\u89e3\u4e0bansible\u7684\u6a21\u5757\u662f\u600e\u4e48\u7f16\u5199\u7684\u3002 \u9700\u6c42 \u00b6 \u8be5\u6a21\u5757\u7684\u76ee\u7684\u662f\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u5c06\u8fdc\u7a0b\u6e90\u6587\u4ef6\u590d\u5236\u5230\u8fdc\u7a0b\u76ee\u6807\u6587\u4ef6 \u521b\u5efa\u6a21\u5757 \u00b6 \u5c06\u8fd9\u4e2a\u6a21\u5757\u653e\u5728 library \u76ee\u5f55\u4e0b\uff0c\u547d\u540d\u4e3a remote_copy.py \u53ef\u4ee5\u4f7f\u7528 ANSIBLE_LIBRARY \u73af\u5883\u53d8\u91cf\u6765\u6307\u5b9a\u6a21\u5757\u7684\u5b58\u653e\u4f4d\u7f6e\u3002\u4e5f\u53ef\u4ee5\u5728playbook\u5f53\u524d\u76ee\u5f55\u4e0b\u521b\u5efalibrary\u76ee\u5f55\u3002 # mkdir /etc/ansible/library # ls remote_copy.py \u5728\u6587\u4ef6\u5934\u90e8\u52a0\u5165\u4e0b\u5217\u8bed\u53e5\uff0c\u8868\u793a\u8be5\u6a21\u5757\u4f7f\u7528python\u8fd0\u884c #!/usr/bin/python # -*- coding: utf-8 -*- # Copyright: (c) 2020, lework # GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt) \u5bfc\u5165\u6211\u4eec\u6240\u9700\u8981\u7684\u5e93 import os import shutil from ansible.module_utils.basic import AnsibleModule \u521b\u5efa\u6a21\u5757\u7684\u5165\u53e3\uff0c\u5e76\u4f7f\u7528AnsibleModule\u7c7b\u4e2d\u7684argument_spec\u6765\u63a5\u53d7\u53c2\u6570 def main (): module_args = dict ( source = dict ( required = True , type = 'str' ), dest = dict ( required = True , type = 'str' ) ) module = AnsibleModule ( argument_spec = module_args ) ) \u5728\u6211\u4eec\u7684\u6a21\u5757\u4e2d\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f source \uff0c\u7528\u6765\u5b9a\u4e49\u6e90\u6587\u4ef6;\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f dest \uff0c\u7528\u6765\u5b9a\u4e49\u76ee\u7684\u5730\u3002\u8fd9\u4e24\u4e2a\u53c2\u6570\u88ab\u6807\u8bb0\u4e3a\u5fc5\u987b\u5b9a\u4e49\u7684\u3002\u7c7b\u578b\u662f\u5b57\u7b26\u4e32\u3002 \u5b9a\u4e49\u6a21\u5757\u7684\u8fd4\u56de\u53c2\u6570 result = dict ( changed = False , source = '' , dest = '' ) \u6a21\u5757\u8fd4\u56de\u7684\u4e0d\u4ec5\u4ec5\u662f\u81ea\u5b9a\u4e49\u7684\uff0c\u8fd8\u4f1a\u8fd4\u56de\u901a\u7528\u7684\u6570\u636e\uff0c\u8be6\u7ec6\u89c1 \u6a21\u5757\u8fd4\u56de\u503c \u4f7f\u7528shutil.copy\u62f7\u8d1d\u6587\u4ef6 if not os.path.isfile(module.params['source']): module.fail_json(msg='The source '+ module.params['source'] +' file was not found', **result) try: shutil.copy(module.params['source'], module.params['dest']) except Exception as e: module.fail_json(msg=e, **result) Tips module.fail_json \u505c\u6b62\u6267\u884c\u5e76\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\u3002 \u62f7\u8d1d\u5b8c\u6210\u540e\uff0c\u9000\u51fa\u6267\u884c\u5e76\u8fd4\u56dejson\u6570\u636e module . exit_json ( ** result ) \u6b64\u547d\u4ee4\u5c06\u9000\u51fa\u6a21\u5757\u6267\u884c \u6700\u540e\uff0c\u544a\u8bc9\u7a0b\u5e8f\u4f7f\u7528main()\u6765\u6267\u884c\u6a21\u5757 if __name__ == '__main__' : main () \u73b0\u5728\u6211\u4eec\u7684\u6a21\u5757\u662f\u53ef\u4ee5\u8fd0\u884c\u7684\u4e86\u3002 \u672c\u5730\u6267\u884c\uff0c\u6d4b\u8bd5\u4e0b\u6a21\u5757\u8fd0\u884c \u6307\u5b9a\u6a21\u5757\u53c2\u6570 // args.json { \"ANSIBLE_MODULE_ARGS\" : { \"source\" : \"/tmp/a\" , \"dest\" : \"/tmp/b\" } } \u6267\u884c\u6a21\u5757 # python remote_copy.py args.json { \"source\" : \"\" , \"dest\" : \"\" , \"changed\" : false, \"failed\" : true, \"invocation\" : { \"module_args\" : { \"dest\" : \"/tmp/b\" , \"source\" : \"/tmp/a\" }} , \"msg\" : \"The source /tmp/a file was not found\" } \u53ef\u4ee5\u770b\u5230msg\u4fe1\u606f\u63d0\u793asource\u6587\u4ef6\u4e0d\u5b58\u5728\uff0cfalse\u72b6\u6001\u4e3a failed \u8868\u660e\u6a21\u5757\u6267\u884c\u5931\u8d25 \u521b\u5efa\u6e90\u6587\u4ef6\u5e76\u6267\u884c\u6a21\u5757 # touch /tmp/a # python remote_copy.py args.json { \"invocation\" : { \"module_args\" : { \"dest\" : \"/tmp/b\" , \"source\" : \"/tmp/a\" }} , \"changed\" : true } \u6a21\u5757\u8fd0\u884c\u6b63\u5e38 \u4e0b\u9762\u5c06\u4f7f\u7528\u4e00\u4e2aplaybook\u6765\u6d4b\u8bd5\u6211\u4eec\u7684remote_copy - name : test remote_copy module hosts : node1 gather_facts : false tasks : - name : ensure foo file : path=/tmp/foo state=touch - name : do a remote copy remote_copy : source=/tmp/foo dest=/tmp/bar \u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u4e86\u4e00\u4e2a\u4efb\u52a1\uff0c\u6765\u4f7f\u6e90\u6587\u4ef6\u4e00\u76f4\u5b58\u5728\u3002 # ansible-playbook test_remote_copy.yml PLAY [ test remote_copy module ] ************************************************************************************** TASK [ ensure foo ] ************************************************************************************** changed: [ 192 .168.77.130 ] TASK [ do a remote copy ] ************************************************************************************** changed: [ 192 .168.77.130 ] PLAY RECAP ************************************************************************************** 192 .168.77.130 : ok = 2 changed = 2 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u4f7f\u7528ansible\u547d\u4ee4\u6267\u884c\u6a21\u5757 # ansible 192.168.77.130 -M /etc/ansible/library/ -m remote_copy -a 'source=/tmp/foo dest=/tmp/bar' 192 .168.77.130 | CHANGED = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : true, \"dest\" : \"/tmp/bar\" , \"gid\" : 0 , \"group\" : \"root\" , \"mode\" : \"0644\" , \"owner\" : \"root\" , \"size\" : 0 , \"source\" : \"/tmp/foo\" , \"state\" : \"file\" , \"uid\" : 0 } ansible \u547d\u4ee4\u4f7f\u7528-M\u6765\u6307\u5b9a\u6a21\u5757\u76ee\u5f55\uff0c\u8fd4\u56de\u6570\u636e\u4e2d\u9664\u4e86\u6211\u4eec\u5b9a\u4e49\u7684\uff0c\u8fd8\u6709\u4e9bansible\u5b9a\u4e49\u7684\u6570\u636e\u3002 \u63d0\u4f9b fact \u6570\u636e \u00b6 \u4e0e\u4f5c\u4e3a\u6a21\u5757\u9000\u51fa\u7684\u4e00\u90e8\u5206\u8fd4\u56de\u7684\u6570\u636e\u7c7b\u4f3c\uff0c\u6a21\u5757\u4e5f\u53ef\u4ee5\u76f4\u63a5\u521b\u5efafact\u6570\u636e\uff0c\u901a\u8fc7\u540d\u4e3aansible_facts\u952e\u8fd4\u56de\u6570\u636e\u5230\u4e3b\u673a\u3002\u65e0\u9700\u4e3a\u4efb\u52a1register\u4e00\u4e2a\u53d8\u91cf\u6765\u83b7\u53d6\u6570\u503c\u3002 remote_facts = { 'rc_source' : module . params [ 'source' ], 'rc_dest' : module . params [ 'dest' ] } result [ 'ansible_facts' ] = remote_facts module . exit_json ( ** result ) \u6ce8\u610f\uff1a module.exit_json \u4e2d\u9700\u5e26\u4e0aremote_facts\u8fd4\u56de \u5728playbook\u4e2d\u6dfb\u52a0\u67e5\u770bfact\u7684\u4efb\u52a1 - name : show a fact debug : var=rc_dest \u8fd0\u884cplaybook\u67e5\u770b\u8fd4\u56de\u7684\u6570\u636e ansible-playbook test_remote_copy.yml PLAY [ test remote_copy module ] ***************************************************************************************** TASK [ ensure foo ] ***************************************************************************************** changed: [ 192 .168.77.130 ] TASK [ do a remote copy ] ***************************************************************************************** changed: [ 192 .168.77.130 ] TASK [ show a fact ] ***************************************************************************************** ok: [ 192 .168.77.130 ] = > { \"rc_dest\" : \"/tmp/bar\" } PLAY RECAP ***************************************************************************************** 192 .168.77.130 : ok = 3 changed = 2 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u6307\u5b9a\u68c0\u67e5\u6a21\u5f0f \u00b6 \u6a21\u5757\u53ef\u4ee5\u9009\u62e9\u652f\u6301\u68c0\u67e5\u6a21\u5f0f http://docs.ansible.com/ansible/playbooks_checkmode.html \u3002 \u5982\u679c\u7528\u6237\u5728\u68c0\u67e5\u6a21\u5f0f\u4e0b\u8fd0\u884c\u53ef\u6267\u884c\u5b89\u5168\u6027\uff0c\u5219\u6a21\u5757\u5e94\u8be5\u5c1d\u8bd5\u9884\u6d4b\u548c\u62a5\u544a\u662f\u5426\u53d1\u751f\u66f4\u6539\uff0c\u4f46\u5b9e\u9645\u4e0a\u4e0d\u4f1a\u8fdb\u884c\u4efb\u4f55\u66f4\u6539\uff08\u4e0d\u652f\u6301\u68c0\u67e5\u6a21\u5f0f\u7684\u6a21\u5757\u4e5f\u4e0d\u4f1a\u91c7\u53d6\u4efb\u4f55\u52a8\u4f5c\uff0c\u4f46\u53ea\u662f\u4e0d\u4f1a\u62a5\u544a\u5176\u53ef\u80fd\u7684\u66f4\u6539\uff09\u3002 \u5bf9\u4e8e\u60a8\u7684\u6a21\u5757\u652f\u6301\u68c0\u67e5\u6a21\u5f0f\uff0c\u60a8\u5fc5\u987b\u5728\u5b9e\u4f8b\u5316AnsibleModule\u5bf9\u8c61\u65f6\u4f20\u9012 supports_check_mode = True \u3002 \u5f53\u542f\u7528\u68c0\u67e5\u6a21\u5f0f\u65f6\uff0cAnsibleModule.check_mode\u5c5e\u6027\u5c06\u8ba1\u7b97\u4e3aTrue\u3002 \u4f8b\u5982\uff1a module = AnsibleModule ( argument_spec = module_args , supports_check_mode = True ) if module . check_mode : module . exit_json ( ** result ) \u5728\u8fdb\u884c\u68c0\u67e5\u6a21\u5f0f\u7684\u65f6\u5019\uff0c\u4e0d\u6267\u884c\u62f7\u8d1d\u52a8\u4f5c\uff0c\u770b\u4e0b\u5217\u8fd0\u884c\u72b6\u6001\u3002 # ansible-playbook test_remote_copy.yml -C PLAY [ test remote_copy module ] ***************************************************************************************** TASK [ ensure foo ] ***************************************************************************************** ok: [ 192 .168.77.130 ] TASK [ do a remote copy ] ***************************************************************************************** ok: [ 192 .168.77.130 ] TASK [ show a fact ] ***************************************************************************************** ok: [ 192 .168.77.130 ] = > { \"rc_dest\" : \"/tmp/bar\" } PLAY RECAP ***************************************************************************************** 192 .168.77.130 : ok = 3 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 # ansible 192.168.77.130 -m shell -a 'ls /tmp/bar' 192 .168.77.130 | FAILED | rc = 2 >> ls: \u65e0\u6cd5\u8bbf\u95ee/tmp/bar: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55non-zero return code \u53ef\u4ee5\u770b\u5230\uff0c\u518d\u68c0\u67e5\u6a21\u5f0f\u4e0b\uff0c\u6a21\u5757\u6ca1\u6709\u6267\u884c\u62f7\u8d1d\u64cd\u4f5c\u3002 \u5b9a\u4e49\u5e2e\u52a9\u4fe1\u606f \u00b6 \u5355\u5355\u662f\u4ee3\u7801\u8fd0\u884c\u8fd8\u4e0d\u591f\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u4e3a\u6a21\u5757\u6dfb\u52a0\u4e00\u4e9b\u8bf4\u660e\u4fe1\u606f\uff0c\u4ee5\u52a9\u4e8e\u5176\u4ed6\u4eba\u4f7f\u7528\u6a21\u5757\u3002 \u5b9a\u4e49ANSIBLE_METADATA \u00b6 \u4f7f\u7528 ANSIBLE_METADATA \u53d8\u91cf\u63cf\u8ff0\u6709\u5173\u5176\u4ed6\u5de5\u5177\u4f7f\u7528\u7684\u6a21\u5757\u7684\u4fe1\u606f\uff0c \u5728\u6587\u4ef6\u7684\u5934\u90e8\u5b9a\u4e49\u3002 ANSIBLE_METADATA = { 'metadata_version' : '1.0' , 'status' : [ 'preview' ], 'supported_by' : 'community' } \u5b9a\u4e49DOCUMENTATION \u00b6 \u63a5\u7740 ANSIBLE_METADATA \uff0c\u5b9a\u4e49 DOCUMENTATION \u53d8\u91cf\u63cf\u8ff0\u6a21\u5757\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u53c2\u6570\uff0c\u4f5c\u8005\u548c\u8bb8\u53ef\u4fe1\u606f\u3002 DOCUMENTATION = ''' --- module: remote_copy short_description: Copy a file on the remote host version_added: \"2.9\" description: - The remote_copy module copies a file on the remote host from a given source to a provided destination. options: source: description: - Path to a file on the source file on the remote host required: true dest: description: - Path to the destination on the remote host for the copy required: true author: - \"Lework\" ''' \u5b9a\u4e49EXAMPLES \u00b6 \u63a5\u7740 DOCUMENTATION , \u4f7f\u7528 EXAMPLES \u53d8\u91cf\u7528\u6765\u63cf\u8ff0\u6a21\u5757\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u793a\u4f8b\u4f7f\u7528 EXAMPLES = ''' # Example from Ansible Playbooks - name: backup a config file remote_copy: source: /tmp/foo dest: /tmp/bar ''' \u5b9a\u4e49RETURN \u00b6 \u4f7f\u7528 RETURN \u53d8\u91cf\u7528\u6765\u63cf\u8ff0\u6a21\u5757\u7684\u8fd4\u56de\u6570\u636e\u4fe1\u606f RETURN = ''' source: description: Path to a file on the source file on the remote host type: str returned: success sample: \"/path/to/file.name\" dest: description: Path to the destination on the remote host for the copy type: string returned: success sample: \"/path/to/destination.file\" ''' \u67e5\u770b\u5e2e\u52a9 \u00b6 # ansible-doc -M /etc/ansible/library/ remote_copy > REMOTE_COPY ( /etc/ansible/library/remote_copy.py ) The remote_copy module copies a file on the remote host from a given source to a provided destination. * This module is maintained by The Ansible Community OPTIONS (= is mandatory ) : = dest Path to the destination on the remote host for the copy = source Path to a file on the source file on the remote host AUTHOR: Lework METADATA: status: - preview supported_by: community EXAMPLES: # Example from Ansible Playbooks - name: backup a config file remote_copy: source: /tmp/foo dest: /tmp/bar RETURN VALUES: source: description: Path to a file on the source file on the remote host type: str returned: success sample: \"/path/to/file.name\" dest: description: Path to the destination on the remote host for the copy type: string returned: success sample: \"/path/to/destination.file\" \u6a21\u5757\u6587\u4ef6 \u00b6 #!/usr/bin/python # -*- coding: utf-8 -*- # Copyright: (c) 2020, lework # GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt) ANSIBLE_METADATA = { 'metadata_version' : '1.0' , 'status' : [ 'preview' ], 'supported_by' : 'community' } DOCUMENTATION = ''' --- module: remote_copy short_description: Copy a file on the remote host version_added: \"2.9\" description: - The remote_copy module copies a file on the remote host from a given source to a provided destination. options: source: description: - Path to a file on the source file on the remote host required: true dest: description: - Path to the destination on the remote host for the copy required: true author: - \"Lework\" ''' EXAMPLES = ''' # Example from Ansible Playbooks - name: backup a config file remote_copy: source: /tmp/foo dest: /tmp/bar ''' RETURN = ''' source: description: Path to a file on the source file on the remote host type: str returned: success sample: \"/path/to/file.name\" dest: description: Path to the destination on the remote host for the copy type: string returned: success sample: \"/path/to/destination.file\" ''' import os import shutil from ansible.module_utils.basic import AnsibleModule def main (): module_args = dict ( source = dict ( required = True , type = 'str' ), dest = dict ( required = True , type = 'str' ) ) result = dict ( changed = False , source = '' , dest = '' ) module = AnsibleModule ( argument_spec = module_args , supports_check_mode = True ) if module . check_mode : module . exit_json ( ** result ) if not os . path . isfile ( module . params [ 'source' ]): module . fail_json ( msg = 'The ' + module . params [ 'source' ] + ' file was not found' , ** result ) try : shutil . copy ( module . params [ 'source' ], module . params [ 'dest' ]) except Exception as e : module . fail_json ( msg = e , ** result ) result [ 'source' ] = module . params [ 'source' ] result [ 'dest' ] = module . params [ 'dest' ] if os . path . isfile ( module . params [ 'dest' ]): result [ 'changed' ] = True remote_facts = { 'rc_source' : module . params [ 'source' ], 'rc_dest' : module . params [ 'dest' ] } result [ 'ansible_facts' ] = remote_facts module . exit_json ( ** result ) if __name__ == '__main__' : main () \u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u6a21\u5757\u4f7f\u7528\uff0c","title":"\u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684module"},{"location":"dev/modules/remote_copy/#remote_copy","text":"\u901a\u8fc7\u8fd9\u4e2a\u7b80\u5355\u7684\u81ea\u5b9a\u4e49\u6a21\u5757\uff0c\u6765\u4e86\u89e3\u4e0bansible\u7684\u6a21\u5757\u662f\u600e\u4e48\u7f16\u5199\u7684\u3002","title":"remote_copy \u6a21\u5757"},{"location":"dev/modules/remote_copy/#_1","text":"\u8be5\u6a21\u5757\u7684\u76ee\u7684\u662f\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u5c06\u8fdc\u7a0b\u6e90\u6587\u4ef6\u590d\u5236\u5230\u8fdc\u7a0b\u76ee\u6807\u6587\u4ef6","title":"\u9700\u6c42"},{"location":"dev/modules/remote_copy/#_2","text":"\u5c06\u8fd9\u4e2a\u6a21\u5757\u653e\u5728 library \u76ee\u5f55\u4e0b\uff0c\u547d\u540d\u4e3a remote_copy.py \u53ef\u4ee5\u4f7f\u7528 ANSIBLE_LIBRARY \u73af\u5883\u53d8\u91cf\u6765\u6307\u5b9a\u6a21\u5757\u7684\u5b58\u653e\u4f4d\u7f6e\u3002\u4e5f\u53ef\u4ee5\u5728playbook\u5f53\u524d\u76ee\u5f55\u4e0b\u521b\u5efalibrary\u76ee\u5f55\u3002 # mkdir /etc/ansible/library # ls remote_copy.py \u5728\u6587\u4ef6\u5934\u90e8\u52a0\u5165\u4e0b\u5217\u8bed\u53e5\uff0c\u8868\u793a\u8be5\u6a21\u5757\u4f7f\u7528python\u8fd0\u884c #!/usr/bin/python # -*- coding: utf-8 -*- # Copyright: (c) 2020, lework # GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt) \u5bfc\u5165\u6211\u4eec\u6240\u9700\u8981\u7684\u5e93 import os import shutil from ansible.module_utils.basic import AnsibleModule \u521b\u5efa\u6a21\u5757\u7684\u5165\u53e3\uff0c\u5e76\u4f7f\u7528AnsibleModule\u7c7b\u4e2d\u7684argument_spec\u6765\u63a5\u53d7\u53c2\u6570 def main (): module_args = dict ( source = dict ( required = True , type = 'str' ), dest = dict ( required = True , type = 'str' ) ) module = AnsibleModule ( argument_spec = module_args ) ) \u5728\u6211\u4eec\u7684\u6a21\u5757\u4e2d\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f source \uff0c\u7528\u6765\u5b9a\u4e49\u6e90\u6587\u4ef6;\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f dest \uff0c\u7528\u6765\u5b9a\u4e49\u76ee\u7684\u5730\u3002\u8fd9\u4e24\u4e2a\u53c2\u6570\u88ab\u6807\u8bb0\u4e3a\u5fc5\u987b\u5b9a\u4e49\u7684\u3002\u7c7b\u578b\u662f\u5b57\u7b26\u4e32\u3002 \u5b9a\u4e49\u6a21\u5757\u7684\u8fd4\u56de\u53c2\u6570 result = dict ( changed = False , source = '' , dest = '' ) \u6a21\u5757\u8fd4\u56de\u7684\u4e0d\u4ec5\u4ec5\u662f\u81ea\u5b9a\u4e49\u7684\uff0c\u8fd8\u4f1a\u8fd4\u56de\u901a\u7528\u7684\u6570\u636e\uff0c\u8be6\u7ec6\u89c1 \u6a21\u5757\u8fd4\u56de\u503c \u4f7f\u7528shutil.copy\u62f7\u8d1d\u6587\u4ef6 if not os.path.isfile(module.params['source']): module.fail_json(msg='The source '+ module.params['source'] +' file was not found', **result) try: shutil.copy(module.params['source'], module.params['dest']) except Exception as e: module.fail_json(msg=e, **result) Tips module.fail_json \u505c\u6b62\u6267\u884c\u5e76\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\u3002 \u62f7\u8d1d\u5b8c\u6210\u540e\uff0c\u9000\u51fa\u6267\u884c\u5e76\u8fd4\u56dejson\u6570\u636e module . exit_json ( ** result ) \u6b64\u547d\u4ee4\u5c06\u9000\u51fa\u6a21\u5757\u6267\u884c \u6700\u540e\uff0c\u544a\u8bc9\u7a0b\u5e8f\u4f7f\u7528main()\u6765\u6267\u884c\u6a21\u5757 if __name__ == '__main__' : main () \u73b0\u5728\u6211\u4eec\u7684\u6a21\u5757\u662f\u53ef\u4ee5\u8fd0\u884c\u7684\u4e86\u3002 \u672c\u5730\u6267\u884c\uff0c\u6d4b\u8bd5\u4e0b\u6a21\u5757\u8fd0\u884c \u6307\u5b9a\u6a21\u5757\u53c2\u6570 // args.json { \"ANSIBLE_MODULE_ARGS\" : { \"source\" : \"/tmp/a\" , \"dest\" : \"/tmp/b\" } } \u6267\u884c\u6a21\u5757 # python remote_copy.py args.json { \"source\" : \"\" , \"dest\" : \"\" , \"changed\" : false, \"failed\" : true, \"invocation\" : { \"module_args\" : { \"dest\" : \"/tmp/b\" , \"source\" : \"/tmp/a\" }} , \"msg\" : \"The source /tmp/a file was not found\" } \u53ef\u4ee5\u770b\u5230msg\u4fe1\u606f\u63d0\u793asource\u6587\u4ef6\u4e0d\u5b58\u5728\uff0cfalse\u72b6\u6001\u4e3a failed \u8868\u660e\u6a21\u5757\u6267\u884c\u5931\u8d25 \u521b\u5efa\u6e90\u6587\u4ef6\u5e76\u6267\u884c\u6a21\u5757 # touch /tmp/a # python remote_copy.py args.json { \"invocation\" : { \"module_args\" : { \"dest\" : \"/tmp/b\" , \"source\" : \"/tmp/a\" }} , \"changed\" : true } \u6a21\u5757\u8fd0\u884c\u6b63\u5e38 \u4e0b\u9762\u5c06\u4f7f\u7528\u4e00\u4e2aplaybook\u6765\u6d4b\u8bd5\u6211\u4eec\u7684remote_copy - name : test remote_copy module hosts : node1 gather_facts : false tasks : - name : ensure foo file : path=/tmp/foo state=touch - name : do a remote copy remote_copy : source=/tmp/foo dest=/tmp/bar \u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u4e86\u4e00\u4e2a\u4efb\u52a1\uff0c\u6765\u4f7f\u6e90\u6587\u4ef6\u4e00\u76f4\u5b58\u5728\u3002 # ansible-playbook test_remote_copy.yml PLAY [ test remote_copy module ] ************************************************************************************** TASK [ ensure foo ] ************************************************************************************** changed: [ 192 .168.77.130 ] TASK [ do a remote copy ] ************************************************************************************** changed: [ 192 .168.77.130 ] PLAY RECAP ************************************************************************************** 192 .168.77.130 : ok = 2 changed = 2 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u4f7f\u7528ansible\u547d\u4ee4\u6267\u884c\u6a21\u5757 # ansible 192.168.77.130 -M /etc/ansible/library/ -m remote_copy -a 'source=/tmp/foo dest=/tmp/bar' 192 .168.77.130 | CHANGED = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : true, \"dest\" : \"/tmp/bar\" , \"gid\" : 0 , \"group\" : \"root\" , \"mode\" : \"0644\" , \"owner\" : \"root\" , \"size\" : 0 , \"source\" : \"/tmp/foo\" , \"state\" : \"file\" , \"uid\" : 0 } ansible \u547d\u4ee4\u4f7f\u7528-M\u6765\u6307\u5b9a\u6a21\u5757\u76ee\u5f55\uff0c\u8fd4\u56de\u6570\u636e\u4e2d\u9664\u4e86\u6211\u4eec\u5b9a\u4e49\u7684\uff0c\u8fd8\u6709\u4e9bansible\u5b9a\u4e49\u7684\u6570\u636e\u3002","title":"\u521b\u5efa\u6a21\u5757"},{"location":"dev/modules/remote_copy/#fact","text":"\u4e0e\u4f5c\u4e3a\u6a21\u5757\u9000\u51fa\u7684\u4e00\u90e8\u5206\u8fd4\u56de\u7684\u6570\u636e\u7c7b\u4f3c\uff0c\u6a21\u5757\u4e5f\u53ef\u4ee5\u76f4\u63a5\u521b\u5efafact\u6570\u636e\uff0c\u901a\u8fc7\u540d\u4e3aansible_facts\u952e\u8fd4\u56de\u6570\u636e\u5230\u4e3b\u673a\u3002\u65e0\u9700\u4e3a\u4efb\u52a1register\u4e00\u4e2a\u53d8\u91cf\u6765\u83b7\u53d6\u6570\u503c\u3002 remote_facts = { 'rc_source' : module . params [ 'source' ], 'rc_dest' : module . params [ 'dest' ] } result [ 'ansible_facts' ] = remote_facts module . exit_json ( ** result ) \u6ce8\u610f\uff1a module.exit_json \u4e2d\u9700\u5e26\u4e0aremote_facts\u8fd4\u56de \u5728playbook\u4e2d\u6dfb\u52a0\u67e5\u770bfact\u7684\u4efb\u52a1 - name : show a fact debug : var=rc_dest \u8fd0\u884cplaybook\u67e5\u770b\u8fd4\u56de\u7684\u6570\u636e ansible-playbook test_remote_copy.yml PLAY [ test remote_copy module ] ***************************************************************************************** TASK [ ensure foo ] ***************************************************************************************** changed: [ 192 .168.77.130 ] TASK [ do a remote copy ] ***************************************************************************************** changed: [ 192 .168.77.130 ] TASK [ show a fact ] ***************************************************************************************** ok: [ 192 .168.77.130 ] = > { \"rc_dest\" : \"/tmp/bar\" } PLAY RECAP ***************************************************************************************** 192 .168.77.130 : ok = 3 changed = 2 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0","title":"\u63d0\u4f9b fact \u6570\u636e"},{"location":"dev/modules/remote_copy/#_3","text":"\u6a21\u5757\u53ef\u4ee5\u9009\u62e9\u652f\u6301\u68c0\u67e5\u6a21\u5f0f http://docs.ansible.com/ansible/playbooks_checkmode.html \u3002 \u5982\u679c\u7528\u6237\u5728\u68c0\u67e5\u6a21\u5f0f\u4e0b\u8fd0\u884c\u53ef\u6267\u884c\u5b89\u5168\u6027\uff0c\u5219\u6a21\u5757\u5e94\u8be5\u5c1d\u8bd5\u9884\u6d4b\u548c\u62a5\u544a\u662f\u5426\u53d1\u751f\u66f4\u6539\uff0c\u4f46\u5b9e\u9645\u4e0a\u4e0d\u4f1a\u8fdb\u884c\u4efb\u4f55\u66f4\u6539\uff08\u4e0d\u652f\u6301\u68c0\u67e5\u6a21\u5f0f\u7684\u6a21\u5757\u4e5f\u4e0d\u4f1a\u91c7\u53d6\u4efb\u4f55\u52a8\u4f5c\uff0c\u4f46\u53ea\u662f\u4e0d\u4f1a\u62a5\u544a\u5176\u53ef\u80fd\u7684\u66f4\u6539\uff09\u3002 \u5bf9\u4e8e\u60a8\u7684\u6a21\u5757\u652f\u6301\u68c0\u67e5\u6a21\u5f0f\uff0c\u60a8\u5fc5\u987b\u5728\u5b9e\u4f8b\u5316AnsibleModule\u5bf9\u8c61\u65f6\u4f20\u9012 supports_check_mode = True \u3002 \u5f53\u542f\u7528\u68c0\u67e5\u6a21\u5f0f\u65f6\uff0cAnsibleModule.check_mode\u5c5e\u6027\u5c06\u8ba1\u7b97\u4e3aTrue\u3002 \u4f8b\u5982\uff1a module = AnsibleModule ( argument_spec = module_args , supports_check_mode = True ) if module . check_mode : module . exit_json ( ** result ) \u5728\u8fdb\u884c\u68c0\u67e5\u6a21\u5f0f\u7684\u65f6\u5019\uff0c\u4e0d\u6267\u884c\u62f7\u8d1d\u52a8\u4f5c\uff0c\u770b\u4e0b\u5217\u8fd0\u884c\u72b6\u6001\u3002 # ansible-playbook test_remote_copy.yml -C PLAY [ test remote_copy module ] ***************************************************************************************** TASK [ ensure foo ] ***************************************************************************************** ok: [ 192 .168.77.130 ] TASK [ do a remote copy ] ***************************************************************************************** ok: [ 192 .168.77.130 ] TASK [ show a fact ] ***************************************************************************************** ok: [ 192 .168.77.130 ] = > { \"rc_dest\" : \"/tmp/bar\" } PLAY RECAP ***************************************************************************************** 192 .168.77.130 : ok = 3 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 # ansible 192.168.77.130 -m shell -a 'ls /tmp/bar' 192 .168.77.130 | FAILED | rc = 2 >> ls: \u65e0\u6cd5\u8bbf\u95ee/tmp/bar: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55non-zero return code \u53ef\u4ee5\u770b\u5230\uff0c\u518d\u68c0\u67e5\u6a21\u5f0f\u4e0b\uff0c\u6a21\u5757\u6ca1\u6709\u6267\u884c\u62f7\u8d1d\u64cd\u4f5c\u3002","title":"\u6307\u5b9a\u68c0\u67e5\u6a21\u5f0f"},{"location":"dev/modules/remote_copy/#_4","text":"\u5355\u5355\u662f\u4ee3\u7801\u8fd0\u884c\u8fd8\u4e0d\u591f\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u4e3a\u6a21\u5757\u6dfb\u52a0\u4e00\u4e9b\u8bf4\u660e\u4fe1\u606f\uff0c\u4ee5\u52a9\u4e8e\u5176\u4ed6\u4eba\u4f7f\u7528\u6a21\u5757\u3002","title":"\u5b9a\u4e49\u5e2e\u52a9\u4fe1\u606f"},{"location":"dev/modules/remote_copy/#ansible_metadata","text":"\u4f7f\u7528 ANSIBLE_METADATA \u53d8\u91cf\u63cf\u8ff0\u6709\u5173\u5176\u4ed6\u5de5\u5177\u4f7f\u7528\u7684\u6a21\u5757\u7684\u4fe1\u606f\uff0c \u5728\u6587\u4ef6\u7684\u5934\u90e8\u5b9a\u4e49\u3002 ANSIBLE_METADATA = { 'metadata_version' : '1.0' , 'status' : [ 'preview' ], 'supported_by' : 'community' }","title":"\u5b9a\u4e49ANSIBLE_METADATA"},{"location":"dev/modules/remote_copy/#documentation","text":"\u63a5\u7740 ANSIBLE_METADATA \uff0c\u5b9a\u4e49 DOCUMENTATION \u53d8\u91cf\u63cf\u8ff0\u6a21\u5757\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u53c2\u6570\uff0c\u4f5c\u8005\u548c\u8bb8\u53ef\u4fe1\u606f\u3002 DOCUMENTATION = ''' --- module: remote_copy short_description: Copy a file on the remote host version_added: \"2.9\" description: - The remote_copy module copies a file on the remote host from a given source to a provided destination. options: source: description: - Path to a file on the source file on the remote host required: true dest: description: - Path to the destination on the remote host for the copy required: true author: - \"Lework\" '''","title":"\u5b9a\u4e49DOCUMENTATION"},{"location":"dev/modules/remote_copy/#examples","text":"\u63a5\u7740 DOCUMENTATION , \u4f7f\u7528 EXAMPLES \u53d8\u91cf\u7528\u6765\u63cf\u8ff0\u6a21\u5757\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u793a\u4f8b\u4f7f\u7528 EXAMPLES = ''' # Example from Ansible Playbooks - name: backup a config file remote_copy: source: /tmp/foo dest: /tmp/bar '''","title":"\u5b9a\u4e49EXAMPLES"},{"location":"dev/modules/remote_copy/#return","text":"\u4f7f\u7528 RETURN \u53d8\u91cf\u7528\u6765\u63cf\u8ff0\u6a21\u5757\u7684\u8fd4\u56de\u6570\u636e\u4fe1\u606f RETURN = ''' source: description: Path to a file on the source file on the remote host type: str returned: success sample: \"/path/to/file.name\" dest: description: Path to the destination on the remote host for the copy type: string returned: success sample: \"/path/to/destination.file\" '''","title":"\u5b9a\u4e49RETURN"},{"location":"dev/modules/remote_copy/#_5","text":"# ansible-doc -M /etc/ansible/library/ remote_copy > REMOTE_COPY ( /etc/ansible/library/remote_copy.py ) The remote_copy module copies a file on the remote host from a given source to a provided destination. * This module is maintained by The Ansible Community OPTIONS (= is mandatory ) : = dest Path to the destination on the remote host for the copy = source Path to a file on the source file on the remote host AUTHOR: Lework METADATA: status: - preview supported_by: community EXAMPLES: # Example from Ansible Playbooks - name: backup a config file remote_copy: source: /tmp/foo dest: /tmp/bar RETURN VALUES: source: description: Path to a file on the source file on the remote host type: str returned: success sample: \"/path/to/file.name\" dest: description: Path to the destination on the remote host for the copy type: string returned: success sample: \"/path/to/destination.file\"","title":"\u67e5\u770b\u5e2e\u52a9"},{"location":"dev/modules/remote_copy/#_6","text":"#!/usr/bin/python # -*- coding: utf-8 -*- # Copyright: (c) 2020, lework # GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt) ANSIBLE_METADATA = { 'metadata_version' : '1.0' , 'status' : [ 'preview' ], 'supported_by' : 'community' } DOCUMENTATION = ''' --- module: remote_copy short_description: Copy a file on the remote host version_added: \"2.9\" description: - The remote_copy module copies a file on the remote host from a given source to a provided destination. options: source: description: - Path to a file on the source file on the remote host required: true dest: description: - Path to the destination on the remote host for the copy required: true author: - \"Lework\" ''' EXAMPLES = ''' # Example from Ansible Playbooks - name: backup a config file remote_copy: source: /tmp/foo dest: /tmp/bar ''' RETURN = ''' source: description: Path to a file on the source file on the remote host type: str returned: success sample: \"/path/to/file.name\" dest: description: Path to the destination on the remote host for the copy type: string returned: success sample: \"/path/to/destination.file\" ''' import os import shutil from ansible.module_utils.basic import AnsibleModule def main (): module_args = dict ( source = dict ( required = True , type = 'str' ), dest = dict ( required = True , type = 'str' ) ) result = dict ( changed = False , source = '' , dest = '' ) module = AnsibleModule ( argument_spec = module_args , supports_check_mode = True ) if module . check_mode : module . exit_json ( ** result ) if not os . path . isfile ( module . params [ 'source' ]): module . fail_json ( msg = 'The ' + module . params [ 'source' ] + ' file was not found' , ** result ) try : shutil . copy ( module . params [ 'source' ], module . params [ 'dest' ]) except Exception as e : module . fail_json ( msg = e , ** result ) result [ 'source' ] = module . params [ 'source' ] result [ 'dest' ] = module . params [ 'dest' ] if os . path . isfile ( module . params [ 'dest' ]): result [ 'changed' ] = True remote_facts = { 'rc_source' : module . params [ 'source' ], 'rc_dest' : module . params [ 'dest' ] } result [ 'ansible_facts' ] = remote_facts module . exit_json ( ** result ) if __name__ == '__main__' : main () \u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u6a21\u5757\u4f7f\u7528\uff0c","title":"\u6a21\u5757\u6587\u4ef6"},{"location":"dev/plugins/","text":"Plugins \u00b6 \u63d2\u4ef6\u53ef\u4ee5\u88ab\u6240\u6709\u6a21\u5757\u4f7f\u7528\uff0c\u8fd9\u4f7fAnsible\u7684\u6838\u5fc3\u529f\u80fd\u5f97\u5230\u4e86\u6709\u6548\u6269\u5c55\u3002\u60a8\u4e5f\u53ef\u4ee5\u7f16\u5199\u81ea\u5df1\u7684\u63d2\u4ef6\uff0c\u6240\u6709\u63d2\u4ef6\u90fd\u5fc5\u987b\u6ee1\u8db3\u4ee5\u4e0b\uff1a \u4f7f\u7528Python\u8bed\u8a00\u7f16\u5199 \u53ef\u4ee5\u629b\u51fa\u5f02\u5e38 \u8fd4\u56deunicode\u7c7b\u578b\u7684\u5b57\u7b26\u4e32 \u7b26\u5408Ansible\u7684\u914d\u7f6e\u548c\u6587\u6863\u6807\u51c6 \u4f7f\u7528Python\u7f16\u5199\u63d2\u4ef6 \u00b6 \u60a8\u5fc5\u987b\u4f7f\u7528Python\u8bed\u8a00\u6765\u7f16\u5199\u63d2\u4ef6\uff0c\u8fd9\u6837\u63d2\u4ef6\u624d\u80fd\u7531 PluginLoader \u52a0\u8f7d\u5e76\u4f5c\u4e3a\u4efb\u4f55\u6a21\u5757\u90fd\u53ef\u4ee5\u4f7f\u7528\u7684Python\u5bf9\u8c61\u8fd4\u56de\u3002 \u7531\u4e8e\u60a8\u7684\u63d2\u4ef6\u5c06\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u6267\u884c\uff0c\u56e0\u6b64\u60a8\u5fc5\u987b\u4f7f\u7528\u517c\u5bb9\u7248\u672c\u7684Python\u5f62\u5f0f\u6765\u7f16\u5199\u5b83\u3002 \u629b\u51fa\u5f02\u5e38 \u00b6 \u5728\u63d2\u4ef6\u6267\u884c\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u9519\u8bef\u65f6\uff0c\u60a8\u5e94\u8be5\u7531 AnsibleError() \u6216\u7c7b\u4f3c\u7684\u7c7b\u8fd4\u56de\u9519\u8bef\u7684\u63cf\u8ff0\u6d88\u606f\u3002 \u5c06\u5176\u4ed6\u5f02\u5e38\u5305\u88c5\u5230\u9519\u8bef\u6d88\u606f\u4e2d\u65f6\uff0c\u5e94\u59cb\u7ec8\u4f7f\u7528Ansible\u51fd\u6570 to_native \u6765\u786e\u4fdd\u8de8Python\u7248\u672c\u7684\u5b57\u7b26\u4e32\u517c\u5bb9\u6027\uff1a from ansible.module_utils._text import to_native try : cause_an_exception () except Exception as e : raise AnsibleError ( 'Something happened, this was original exception: %s ' % to_native ( e )) \u67e5\u770b AnsibleError objects \u5b57\u7b26\u4e32\u7f16\u7801 \u00b6 \u63d2\u4ef6\u8fd4\u56de\u7684\u6240\u6709\u5b57\u7b26\u4e32\u5fc5\u987b\u8f6c\u6362\u4e3aPython\u7684 unicode \u7c7b\u578b\u3002 \u8f6c\u6362\u4e3a unicode \u53ef\u786e\u4fdd\u8fd9\u4e9b\u5b57\u7b26\u4e32\u53ef\u4ee5\u901a\u8fc7 Jinja2 \u6a21\u677f\u4f7f\u7528\u3002 \u8f6c\u6362\u5b57\u7b26\u4e32\u793a\u4f8b\uff1a from ansible.module_utils._text import to_text result_string = to_text ( result_string ) \u63d2\u4ef6\u6587\u6863 \u00b6 DOCUMENTATION \u53d8\u91cf\u8bb0\u5f55\u7740\u63d2\u4ef6\u7684\u5e2e\u52a9\u4fe1\u606f DOCUMENTATION = ''' callback: test type: stdout short_description: test callback version_added: historical description: - test callback description options: remote_addr: description: - Address default: inventory_hostname vars: - name: ansible_host type: str ''' \u8981\u8bbf\u95ee\u63d2\u4ef6\u4e2d\u7684\u914d\u7f6e\u8bbe\u7f6e\uff0c\u8bf7\u4f7f\u7528 self.get_option(<option_name>) \u3002 \u5bf9\u4e8e\u5927\u591a\u6570\u63d2\u4ef6\u7c7b\u578b\uff0c\u63a7\u5236\u5668\u4f1a\u9884\u5148\u586b\u5145\u8bbe\u7f6e\u3002 \u5982\u679c\u9700\u8981\u663e\u5f0f\u586b\u5145\u8bbe\u7f6e\uff0c\u8bf7\u4f7f\u7528 self.set_options() \u8c03\u7528\u3002 \u63d2\u4ef6\u7c7b\u578b \u00b6 Action \u00b6 Action\u63d2\u4ef6\u5141\u8bb8\u60a8\u5728\u63a7\u5236\u8282\u70b9\u5904\u7406\u7684\u6570\u636e\u4e0e\u8fdc\u7a0b\u6267\u884c\u7684\u6a21\u5757\u529f\u80fd\u96c6\u6210\u5728\u4e00\u8d77\u3002 \u8981\u521b\u5efaaction\u63d2\u4ef6\uff0c\u8bf7\u4f7f\u7528 Base(ActionBase) \u7c7b\u4f5c\u4e3a\u7236\u7c7b\u521b\u5efa\u4e00\u4e2a\u65b0\u7c7b\uff1a from ansible.plugins.action import ActionBase class ActionModule ( ActionBase ): pass \u7136\u540e\uff0c\u4f7f\u7528 _execute_module \u65b9\u6cd5\u8c03\u7528\u539f\u59cb\u6a21\u5757\u6765\u6267\u884c\u6a21\u5757\u4ee3\u7801\u3002\u6210\u529f\u6267\u884c\u6a21\u5757\u540e\uff0c\u53ef\u4ee5\u4fee\u6539\u6a21\u5757\u8fd4\u56de\u7684\u6570\u636e\u3002 module_return = self . _execute_module ( module_name = '<NAME_OF_MODULE>' , module_args = module_args , task_vars = task_vars , tmp = tmp ) \u4f8b\u5982\uff0c\u5982\u679c\u60a8\u60f3\u68c0\u67e5Ansible\u63a7\u5236\u8282\u70b9\u4e0e\u76ee\u6807\u8ba1\u7b97\u673a\u4e4b\u95f4\u7684\u65f6\u95f4\u5dee\uff0c\u5219\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2aaction\u63d2\u4ef6\u6765\u68c0\u67e5\u672c\u5730\u65f6\u95f4\u5e76\u5c06\u5176\u4e0esetup\u6a21\u5757\u7684\u8fd4\u56de\u6570\u636e\u8fdb\u884c\u6bd4\u8f83\uff1a #!/usr/bin/python # Make coding more python3-ish, this is required for contributions to Ansible from __future__ import ( absolute_import , division , print_function ) __metaclass__ = type from ansible.plugins.action import ActionBase from datetime import datetime class ActionModule ( ActionBase ): def run ( self , tmp = None , task_vars = None ): super ( ActionModule , self ) . run ( tmp , task_vars ) module_args = self . _task . args . copy () module_return = self . _execute_module ( module_name = 'setup' , module_args = module_args , task_vars = task_vars , tmp = tmp ) ret = dict () remote_date = None if not module_return . get ( 'failed' ): for key , value in module_return [ 'ansible_facts' ] . items (): if key == 'ansible_date_time' : remote_date = value [ 'iso8601' ] if remote_date : remote_date_obj = datetime . strptime ( remote_date , '%Y-%m- %d T%H:%M:%SZ' ) time_delta = datetime . now () - remote_date_obj ret [ 'delta_seconds' ] = time_delta . seconds ret [ 'delta_days' ] = time_delta . days ret [ 'delta_microseconds' ] = time_delta . microseconds return dict ( ansible_facts = dict ( ret )) \u8be5\u4ee3\u7801\u68c0\u67e5\u63a7\u5236\u8282\u70b9\u4e0a\u7684\u65f6\u95f4\uff0c\u4f7f\u7528setup\u6a21\u5757\u6355\u83b7\u8fdc\u7a0b\u8ba1\u7b97\u673a\u7684\u65e5\u671f\u548c\u65f6\u95f4\uff0c\u5e76\u8ba1\u7b97\u6355\u83b7\u7684\u65f6\u95f4\u4e0e\u672c\u5730\u65f6\u95f4\u4e4b\u95f4\u7684\u65f6\u5dee\uff0c\u4ee5\u5929\uff0c\u79d2\u548c\u5fae\u79d2\u4e3a\u5355\u4f4d\u8fd4\u56de\u65f6\u95f4\u589e\u91cf\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \uff0c \u672c\u5730\u5b89\u88c5\u7684\u5b58\u5728 /usr/lib/python2.7/site-packages/ansible/plugins/action/ \u76ee\u5f55\u4e2d Cache \u00b6 cache \u63d2\u4ef6\u7528\u4e8e\u5b58\u50a8\u7531 inventory \u63d2\u4ef6\u641c\u96c6\u5230\u7684 fact \u6570\u636e\u3002\u96c6\u5408\u4e2d\u7684cache\u63d2\u4ef6\u76ee\u524d\u53ea\u652f\u6301 fact \u7f13\u5b58\u3002 \u4f7f\u7528 cache_loader \u5bfc\u5165 cache \u63d2\u4ef6\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u4f7f\u7528 self.set_options() \u548c self.get_option(<option_name>) \u3002 \u5982\u679c\u76f4\u63a5\u5728\u4ee3\u7801\u5e93\u4e2d\u5bfc\u5165 cache \u63d2\u4ef6\uff0c\u5219\u53ea\u80fd\u901a\u8fc7 ansible.constants \u8bbf\u95ee\u9009\u9879\uff0c\u5e76\u4e14\u4f1a\u7834\u574f cache \u63d2\u4ef6\u4f9binventory \u63d2\u4ef6\u4f7f\u7528\u7684\u529f\u80fd\u3002 from ansible.plugins.loader import cache_loader [ ... ] plugin = cache_loader . get ( 'custom_cache' , ** cache_kwargs ) cache \u63d2\u4ef6\u6709\u4e24\u4e2a\u57fa\u7c7b\uff0c\u7528\u4e8e\u6570\u636e\u5e93\u652f\u6301\u7684\u7f13\u5b58\u7684 BaseCacheModule \u548c\u7528\u4e8e\u6587\u4ef6\u652f\u6301\u7684\u7f13\u5b58\u7684 BaseCacheFileModule \u3002 \u8981\u521b\u5efa cache \u63d2\u4ef6\uff0c\u9996\u5148\u8981\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u9002\u5f53\u57fa\u7c7b\u7684\u65b0 CacheModule \u7c7b\u3002 \u5982\u679c\u60a8\u4f7f\u7528 __init__ \u65b9\u6cd5\u521b\u5efa\u63d2\u4ef6\uff0c\u5219\u5e94\u4f7f\u7528\u63d0\u4f9b\u7684\u6240\u6709args\u548ckwargs\u521d\u59cb\u5316\u57fa\u7c7b\uff0c\u4ee5\u4e0e inventory \u63d2\u4ef6\u7f13\u5b58\u9009\u9879\u517c\u5bb9\u3002 \u57fa\u7c7b\u8c03\u7528 self.set_options(direct=kwargs) \u3002 \u5728\u8c03\u7528\u57fa\u7c7b __init__ \u65b9\u6cd5\u540e\uff0c\u5e94\u4f7f\u7528 self.get_option(<option_name>) \u8bbf\u95ee\u7f13\u5b58\u9009\u9879\u3002 \u65b0\u7684cache\u63d2\u4ef6\u5e94\u91c7\u7528 _uri \uff0c _prefix \u548c _timeout \u9009\u9879\uff0c\u4ee5\u4e0e\u73b0\u6709\u7684cache\u63d2\u4ef6\u4fdd\u6301\u4e00\u81f4\u3002 from ansible.plugins.cache import BaseCacheModule class CacheModule ( BaseCacheModule ): def __init__ ( self , * args , ** kwargs ): super ( CacheModule , self ) . __init__ ( * args , ** kwargs ) self . _connection = self . get_option ( '_uri' ) self . _prefix = self . get_option ( '_prefix' ) self . _timeout = self . get_option ( '_timeout' ) \u5982\u679c\u4f7f\u7528 BaseCacheModule \u57fa\u7c7b\u521b\u5efa\u63d2\u4ef6\uff0c\u5219\u5fc5\u987b\u5b9e\u73b0 get \uff0c contains \uff0c keys \uff0c set \uff0c delete \uff0c flush \u548c copy \u65b9\u6cd5\u3002 contains \u65b9\u6cd5\u5e94\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u8be5\u503c\u6307\u793a\u5bc6\u94a5\u662f\u5426\u5b58\u5728\u5e76\u4e14\u5c1a\u672a\u8fc7\u671f\u3002 \u4e0e\u57fa\u4e8e\u6587\u4ef6\u7684\u7f13\u5b58\u4e0d\u540c\uff0c\u5982\u679c\u7f13\u5b58\u8fc7\u671f\uff0c\u5219 get \u65b9\u6cd5\u4e0d\u4f1a\u5f15\u53d1KeyError\u3002 \u5982\u679c\u4f7f\u7528 BaseFileCacheModule \u57fa\u7c7b\u521b\u5efa\u63d2\u4ef6\uff0c\u5219\u5fc5\u987b\u5b9e\u73b0\u4ece\u57fa\u7c7b\u65b9\u6cd5 get \u548c set \u8c03\u7528\u7684 _load \u548c _dump \u65b9\u6cd5\u3002 \u5982\u679c\u60a8\u7684cache\u63d2\u4ef6\u5b58\u50a8JSON\uff0c\u8bf7\u5728 _dump \u6216 set \u65b9\u6cd5\u4e2d\u4f7f\u7528 AnsibleJSONEncoder \uff0c\u5728 _load \u6216 get \u65b9\u6cd5\u4e2d\u4f7f\u7528 AnsibleJSONDecoder \u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t cache \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/cache \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002 Callback \u00b6 callback \u63d2\u4ef6\u53ef\u4ee5\u5728\u4e8b\u4ef6\u6267\u884c\u7684\u65f6\u5019\u589e\u52a0\u65b0\u884c\u4e3a\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ccallback \u63d2\u4ef6\u5728\u547d\u4ee4\u884c\u7a0b\u5e8f\u6267\u884c\u65f6\uff0c\u8f93\u51fa\u5927\u91cf\u7684\u4fe1\u606f\uff0c\u6bd4\u5982\u6267\u884c\u7684\u4efb\u52a1\u540d\u79f0\uff0c\u6267\u884c\u65f6\u95f4\uff0c\u4efb\u52a1\u7ed3\u679c\u7b49\u7b49\u4fe1\u606f\u3002 \u8981\u521b\u5efa\u56de\u8c03\u63d2\u4ef6\uff0c\u8bf7\u4f7f\u7528Base\uff08Callbacks\uff09\u7c7b\u4f5c\u4e3a\u7236\u7c7b\u521b\u5efa\u4e00\u4e2a\u65b0\u7c7b\uff1a from ansible.plugins.callback import CallbackBase class CallbackModule ( CallbackBase ): pass \u5728\u65b0\u7c7b\u4e2d\uff0c\u9700\u8981\u8986\u76d6CallbackBase\u4e2d\u7684\u7279\u5b9a\u65b9\u6cd5\u624d\u80fd\u5728\u4e8b\u4ef6\u6267\u884c\u7684\u65f6\u5019\u6267\u884c\u5bf9\u5e94\u7684\u65b9\u6cd5\uff0c\u5b8c\u6574\u5217\u8868\u89c1 lib/ansible/plugins/callback/__init__.py def v2_on_any(self,*args,**kwargs): def v2_runner_on_failed(self,result,ignore_errors=False): def v2_runner_on_ok(self,result): def v2_runner_on_skipped(self,result): def v2_runner_on_unreachable(self,result): def v2_runner_on_async_poll(self,result): def v2_runner_on_async_ok(self,result): def v2_runner_on_async_failed(self,result): def v2_playbook_on_start(self,playbook): def v2_playbook_on_notify(self,handler,host): def v2_playbook_on_no_hosts_matched(self): def v2_playbook_on_no_hosts_remaining(self): def v2_playbook_on_task_start(self,task,is_conditional): def v2_playbook_on_cleanup_task_start(self,task): def v2_playbook_on_handler_task_start(self,task): def v2_playbook_on_vars_prompt(self,varname,private=True,prompt=None,encrypt=None,confirm=False,salt_size=None,salt=None,def ault=None,unsafe=None): def v2_playbook_on_vars_prompt(self,varname,private=True,prompt=None,encrypt=None,confirm=False,salt_size=None,salt=None,def ault=None,unsafe=None): self.playbook_on_vars_prompt(varname,private,prompt,encrypt,confirm,salt_size,salt,def ault,unsafe) def v2_playbook_on_import_for_host(self,result,imported_file): def v2_playbook_on_not_import_for_host(self,result,missing_file): def v2_playbook_on_play_start(self,play): def v2_playbook_on_stats(self,stats): def v2_on_file_diff(self,result): def v2_playbook_on_include(self,included_file): def v2_runner_item_on_ok(self,result): def v2_runner_item_on_failed(self,result): def v2_runner_item_on_skipped(self,result): def v2_runner_retry(self,result): def v2_runner_on_start(self,host,task): \u7279\u5b9a\u65b9\u6cd5\u7684result\u503c print ( result . _task ) # \u8f93\u51fa\u4efb\u52a1\u540d print ( result . _host ) # \u8f93\u51fa\u4e3b\u673a\u540d print ( result . _result ) # \u8f93\u51fa\u4efb\u52a1\u6267\u884c\u7684\u7ed3\u679c print ( result . is_changed ) # \u662f\u5426\u66f4\u6539 print ( result . is_failed ) # \u662f\u5426\u5931\u8d25 \u4ee5\u4e0b\u662fAnsible\u8ba1\u65f6\u5668\u63d2\u4ef6\u7684\u793a\u4f8b\uff0c\u4f46\u5e26\u6709\u4e00\u4e2a\u9644\u52a0\u9009\u9879\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728Ansible 2.4\u7248\u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\u914d\u7f6e\u4f7f\u7528\uff1a # Make coding more python3-ish, this is required for contributions to Ansible from __future__ import ( absolute_import , division , print_function ) __metaclass__ = type # not only visible to ansible-doc, it also 'declares' the options the plugin requires and how to configure them. DOCUMENTATION = ''' callback: timer callback_type: aggregate requirements: - whitelist in configuration short_description: Adds time to play stats version_added: \"2.0\" description: - This callback just adds total play duration to the play stats. options: format_string: description: format of the string shown to user at play end ini: - section: callback_timer key: format_string env: - name: ANSIBLE_CALLBACK_TIMER_FORMAT default: \"Playbook run took %s days, %s hours, %s minutes, %s seconds\" ''' from datetime import datetime from ansible.plugins.callback import CallbackBase class CallbackModule ( CallbackBase ): \"\"\" This callback module tells you how long your plays ran for. \"\"\" CALLBACK_VERSION = 2.0 CALLBACK_TYPE = 'aggregate' CALLBACK_NAME = 'namespace.collection_name.timer' # only needed if you ship it and don't want to enable by default CALLBACK_NEEDS_WHITELIST = True def __init__ ( self ): # make sure the expected objects are present, calling the base's __init__ super ( CallbackModule , self ) . __init__ () # start the timer when the plugin is loaded, the first play should start a few milliseconds after. self . start_time = datetime . now () def _days_hours_minutes_seconds ( self , runtime ): ''' internal helper method for this callback ''' minutes = ( runtime . seconds // 60 ) % 60 r_seconds = runtime . seconds - ( minutes * 60 ) return runtime . days , runtime . seconds // 3600 , minutes , r_seconds # this is only event we care about for display, when the play shows its summary stats; the rest are ignored by the base class def v2_playbook_on_stats ( self , stats ): end_time = datetime . now () runtime = end_time - self . start_time # Shows the usage of a config option declared in the DOCUMENTATION variable. Ansible will have set it when it loads the plugin. # Also note the use of the display object to print to screen. This is available to all callbacks, and you should use this over printing yourself self . _display . display ( self . _plugin_options [ 'format_string' ] % ( self . _days_hours_minutes_seconds ( runtime ))) callback\u8bf4\u660e\u4fe1\u606f CALLBACK_VERSION = 2.0 \u63d2\u4ef6\u7248\u672c CALLBACK_TYPE = 'aggregate' \u63d2\u4ef6\u7c7b\u578b\uff0c\u5982\u679c\u662f'stdout'\u65f6\uff0c\u53ea\u4f1a\u52a0\u8f7d\u4e00\u4e2a\u8fd9\u6837\u7684\u56de\u8c03\u63d2\u4ef6 CALLBACK_NAME = 'namespace.collection_name.timer' \u63d2\u4ef6\u540d\u79f0\uff0c\u9700\u4e0e\u6587\u4ef6\u540d\u79f0\u4e00\u81f4\u3002 CALLBACK_NEEDS_WHITELIST = True \u63d2\u4ef6\u662f\u5426\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u914d\u7f6ewhitelist\u3002\u4e3atrue\u662f\uff0cansible\u68c0\u67e5ansible.cfg\u6587\u4ef6\u4e2d\u7684callback_whitelist\u662f\u5426\u6709\u63d2\u4ef6\u540d\u79f0\uff0c\u6709\u5219\u6267\u884c\uff0c\u65e0\u5219\u8df3\u8fc7\u3002 \u8bf7\u6ce8\u610f\uff0cAnsible 2.0\u7248\u53ca\u66f4\u9ad8\u7248\u672c\u7684\u63d2\u4ef6\u9700\u8981 CALLBACK_VERSION \u548c CALLBACK_NAME \u5b9a\u4e49\u624d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002ansible\u53ea\u52a0\u8f7d\u4e00\u4e2a CALLBACK_TYPE=stdout \u7684callback\u63d2\u4ef6\uff0c\u5982\u679c\u60f3\u6267\u884c\u591a\u4e2acallback\u63d2\u4ef6\u9700\u8bbe\u7f6e\u5176\u4ed6\u7c7b\u578b\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t callback \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/callback \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002 Connection \u00b6 ansible\u901a\u8fc7\u4f7f\u7528connection\u63d2\u4ef6\u6765\u8fde\u63a5\u8fdc\u7a0b\u7cfb\u7edf\uff0c\u4ee5\u4fbf\u5b83\u53ef\u4ee5\u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u6267\u884c\u4efb\u52a1\u3002Ansible\u9644\u5e26\u4e86\u8bb8\u591aconnection\u63d2\u4ef6\uff0c\u4f46\u6bcf\u4e2a\u4e3b\u673a\u4e00\u6b21\u53ea\u80fd\u4f7f\u7528\u4e00\u4e2a\u3002\u6700\u5e38\u7528\u7684connection\u63d2\u4ef6\u662f paramiko SSH\uff0c\u672c\u673assh\u547d\u4ee4\u548c local connection\u7c7b\u578b\u3002 \u53ef\u4ee5\u901a\u8fc7\u5728task\u4e0a\u914d\u7f6e connection \u5173\u952e\u5b57\u6765\u9009\u62e9\u7528\u54ea\u79cd\u65b9\u5f0f\u8fde\u63a5\u8fdc\u7a0b\u7cfb\u7edf\u3002 Ansible 2.1\u7248\u5f15\u5165\u4e86 smart connection\u63d2\u4ef6\u3002 smart connection\u7c7b\u578b\u5141\u8bb8Ansible\u6839\u636e\u7cfb\u7edf\u529f\u80fd\u81ea\u52a8\u9009\u62e9 paramiko \u6216 openssh connection\u63d2\u4ef6\uff0c\u5982\u679cOpenSSH\u652f\u6301ControlPersist\uff0c\u5219\u9009\u62e9 ssh connection\u63d2\u4ef6\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t connection \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/connection \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002 Filter \u00b6 filter\u63d2\u4ef6\u5141\u8bb8\u4f60\u5728 playbook \u548c Jinja2 \u6a21\u7248\u5185\u64cd\u4f5c\u6570\u636e\uff0cansible\u4f7f\u7528filter plugin\u6765\u6269\u5c55jinja2\u6a21\u7248\u7684\u529f\u80fd\u3002Ansible\u9644\u5e26\u7684\u5927\u591a\u6570\u8fc7\u6ee4\u5668\u63d2\u4ef6\u90fd\u4f4d\u4e8e core.py \u4e2d\u3002 filter\u63d2\u4ef6\u53ef\u4ee5\u4e0d\u914d\u7f6e DOCUMENTATION \u6765\u8bf4\u660e\u63d2\u4ef6\u9009\u9879\u548c\u5e2e\u52a9\u4fe1\u606f\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/filter \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002 Inventory \u00b6 \u5728Ansible 2.4\u7248\u672c\u4e2d\u6dfb\u52a0\u4e86inventory\u63d2\u4ef6\uff0cinventory\u63d2\u4ef6\u7528\u4e8e\u89e3\u6790\u52a8\u6001\u8d44\u6e90\u7684\u4e3b\u673a\u6e05\u5355\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t inventory \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/inventory \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002 Lookup \u00b6 \u7528\u4e8e\u4ece\u5916\u90e8\u6570\u636e\u4e2d\u63d0\u53d6\u6570\u636e\u5e76\u8fd4\u56de\u5230\u53d8\u91cf\u6216\u53c2\u6570\u4e2d\u3002\u6bd4\u5982\u5faa\u73af with_* \u7684\u7528\u6cd5\u3002 \u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u67e5\u627e\u63d2\u4ef6\u5b9e\u73b0\uff0c\u6b64\u67e5\u627e\u5c06\u6587\u672c\u6587\u4ef6\u7684\u5185\u5bb9\u4f5c\u4e3a\u53d8\u91cf\u8fd4\u56de # python 3 headers, required if submitting to Ansible from __future__ import ( absolute_import , division , print_function ) __metaclass__ = type DOCUMENTATION = \"\"\" lookup: file author: Daniel Hokka Zakrisson <daniel@hozac.com> version_added: \"0.9\" short_description: read file contents description: - This lookup returns the contents from a file on the Ansible controller's file system. options: _terms: description: path(s) of files to read required: True notes: - if read in variable context, the file can be interpreted as YAML if the content is valid to the parser. - this lookup does not understand globing --- use the fileglob lookup instead. \"\"\" from ansible.errors import AnsibleError , AnsibleParserError from ansible.plugins.lookup import LookupBase from ansible.utils.display import Display display = Display () class LookupModule ( LookupBase ): def run ( self , terms , variables = None , ** kwargs ): # lookups in general are expected to both take a list as input and output a list # this is done so they work with the looping construct 'with_'. ret = [] for term in terms : display . debug ( \"File lookup term: %s \" % term ) # Find the file in the expected search path, using a class method # that implements the 'expected' search path for Ansible plugins. lookupfile = self . find_file_in_search_path ( variables , 'files' , term ) # Don't use print or your own logging, the display class # takes care of it in a unified way. display . vvvv ( u \"File lookup using %s as file\" % lookupfile ) try : if lookupfile : contents , show_data = self . _loader . _get_file_contents ( lookupfile ) ret . append ( contents . rstrip ()) else : # Always use ansible error classes to throw 'final' exceptions, # so the Ansible engine will know how to deal with them. # The Parser error indicates invalid options passed raise AnsibleParserError () except AnsibleParserError : raise AnsibleError ( \"could not locate file in lookup: %s \" % term ) return ret \u4f7f\u7528\u63d2\u4ef6 --- - hosts : all vars : contents : \"{{ lookup('namespace.collection_name.file', '/etc/foo.txt') }}\" tasks : - debug : msg : the value of foo.txt is {{ contents }} as seen today {{ lookup('pipe', 'date +\"%Y-%m-%d\"') }} \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t lookup \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/lookup \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002 Shell \u00b6 \u5f88\u50cfconnection\u63d2\u4ef6\uff0cansible\u4f7f\u7528shell\u63d2\u4ef6\u5728shell\u73af\u5883\u4e2d\u6267\u884c\uff0c\u76ee\u524d\u652f\u6301\u7684shell\u6709csh\uff0cfish\uff0cpowershell\uff0csh\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t shell \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/shell \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002 Strategy \u00b6 \u63a7\u5236\u4efb\u52a1\u6267\u884c\u6d41\u7a0b\uff0c \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t strategy \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/strategy \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002 Terminal \u00b6 \u7528\u6765\u8fde\u63a5cli\u7684\u786c\u4ef6\u8bbe\u5907\uff0c\u50cf\u4ea4\u6362\u673a\uff0c\u8def\u7531\u5668\uff0c\u9632\u706b\u5899\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/terminal \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002 Test \u00b6 \u7528\u4e8e\u9a8c\u8bc1\u6570\u636e\uff0c\u5c5e\u4e8ejinja2\u7684\u529f\u80fd\u3002\u53ef\u7528\u4e8e\u6761\u4ef6\u6307\u4ee4\uff0c\u4f8b\u5982 when: \u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/test \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002 Vars \u00b6 Vars\u63d2\u4ef6\u5c06\u989d\u5916\u7684\u53d8\u91cf\u6570\u636e\u6ce8\u5165\u5230\u8fd0\u884c\u7684\u4e3b\u673a\u4e2d\uff0c\u800c\u8fd9\u4e9b\u8fd0\u884c\u4e0d\u662f\u6765\u81ea\u5e93\u5b58\u6e90\u3001\u5267\u672c\u6216\u547d\u4ee4\u884c\u3002\u5982 host_vars \u548c group_vars \u90fd\u662f\u6709vars\u63d2\u4ef6\u6765\u5b8c\u6210\u7684\u3002\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t vars \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/vars \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002 \u81ea\u5b9a\u4e49\u7684\u63d2\u4ef6\u5b58\u653e\u4f4d\u7f6e \u00b6 \u5728 ansible.cfg \u914d\u7f6e\u7684\u63d2\u4ef6\u76ee\u5f55\u3002 [defaults] # set plugin path directories here, separate with colons action_plugins = /usr/share/ansible/plugins/action become_plugins = /usr/share/ansible/plugins/become cache_plugins = /usr/share/ansible/plugins/cache callback_plugins = /usr/share/ansible/plugins/callback connection_plugins = /usr/share/ansible/plugins/connection lookup_plugins = /usr/share/ansible/plugins/lookup inventory_plugins = /usr/share/ansible/plugins/inventory vars_plugins = /usr/share/ansible/plugins/vars filter_plugins = /usr/share/ansible/plugins/filter test_plugins = /usr/share/ansible/plugins/test terminal_plugins = /usr/share/ansible/plugins/terminal strategy_plugins = /usr/share/ansible/plugins/strategy \u5728\u73af\u5883\u53d8\u91cf\u4e2d\u6307\u5b9a\u63d2\u4ef6\u76ee\u5f55\u3002 ANSIBLE_ACTION_PLUGINS ANSIBLE_CACHE_PLUGINS ANSIBLE_CALLBACK_PLUGINS ANSIBLE_CONNECTION_PLUGINS ANSIBLE_FILTER_PLUGINS ANSIBLE_INVENTORY_PLUGINS ANSIBLE_LOOKUP_PLUGIN ANSIBLE_SHELL_PLUGINS ANSIBLE_STRATEGY_PLUGINS ANSIBLE_TEST_PLUGINS ANSIBLE_VARS_PLUGINS \u653e\u7f6e\u4ee5\u4e0b\u76ee\u5f55\uff0c\u53ef\u4f7fansible\u81ea\u52a8\u52a0\u8f7d\u63d2\u4ef6 ~/.ansible/plugins/ \u76ee\u5f55\u4e2d\u7684\u63d2\u4ef6, \u6bd4\u5982 ~/.ansible/plugins/callback \u76ee\u5f55\u4e2d\uff0c\u4f1a\u81ea\u52a8\u52a0\u8f7dcallback\u63d2\u4ef6 /usr/share/ansible/plugins/ \u76ee\u5f55\u4e2d\u7684\u63d2\u4ef6\uff0c\u6bd4\u5982 /usr/share/ansible/plugins/callback \u76ee\u5f55\u4e2d\uff0c\u4f1a\u81ea\u52a8\u52a0\u8f7dcallback\u63d2\u4ef6 \u5f53\u60a8\u7684Playbook\u540c\u76ee\u5f55\u4e0b\u6216\u89d2\u8272\u4e2d\u6709\u4ee5\u4e0b\u5b50\u6587\u4ef6\u5939\u4e4b\u4e00\u65f6\uff0c\u63d2\u4ef6\u4f1a\u81ea\u52a8\u52a0\u8f7d\uff1a action_plugins cache_plugins callback_plugins connection_plugins filter_plugins inventory_plugins lookup_plugins shell_plugins strategy_plugins test_plugins vars_plugins","title":"Plugin \u5f00\u53d1\u8bf4\u660e"},{"location":"dev/plugins/#plugins","text":"\u63d2\u4ef6\u53ef\u4ee5\u88ab\u6240\u6709\u6a21\u5757\u4f7f\u7528\uff0c\u8fd9\u4f7fAnsible\u7684\u6838\u5fc3\u529f\u80fd\u5f97\u5230\u4e86\u6709\u6548\u6269\u5c55\u3002\u60a8\u4e5f\u53ef\u4ee5\u7f16\u5199\u81ea\u5df1\u7684\u63d2\u4ef6\uff0c\u6240\u6709\u63d2\u4ef6\u90fd\u5fc5\u987b\u6ee1\u8db3\u4ee5\u4e0b\uff1a \u4f7f\u7528Python\u8bed\u8a00\u7f16\u5199 \u53ef\u4ee5\u629b\u51fa\u5f02\u5e38 \u8fd4\u56deunicode\u7c7b\u578b\u7684\u5b57\u7b26\u4e32 \u7b26\u5408Ansible\u7684\u914d\u7f6e\u548c\u6587\u6863\u6807\u51c6","title":"Plugins"},{"location":"dev/plugins/#python","text":"\u60a8\u5fc5\u987b\u4f7f\u7528Python\u8bed\u8a00\u6765\u7f16\u5199\u63d2\u4ef6\uff0c\u8fd9\u6837\u63d2\u4ef6\u624d\u80fd\u7531 PluginLoader \u52a0\u8f7d\u5e76\u4f5c\u4e3a\u4efb\u4f55\u6a21\u5757\u90fd\u53ef\u4ee5\u4f7f\u7528\u7684Python\u5bf9\u8c61\u8fd4\u56de\u3002 \u7531\u4e8e\u60a8\u7684\u63d2\u4ef6\u5c06\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u6267\u884c\uff0c\u56e0\u6b64\u60a8\u5fc5\u987b\u4f7f\u7528\u517c\u5bb9\u7248\u672c\u7684Python\u5f62\u5f0f\u6765\u7f16\u5199\u5b83\u3002","title":"\u4f7f\u7528Python\u7f16\u5199\u63d2\u4ef6"},{"location":"dev/plugins/#_1","text":"\u5728\u63d2\u4ef6\u6267\u884c\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u9519\u8bef\u65f6\uff0c\u60a8\u5e94\u8be5\u7531 AnsibleError() \u6216\u7c7b\u4f3c\u7684\u7c7b\u8fd4\u56de\u9519\u8bef\u7684\u63cf\u8ff0\u6d88\u606f\u3002 \u5c06\u5176\u4ed6\u5f02\u5e38\u5305\u88c5\u5230\u9519\u8bef\u6d88\u606f\u4e2d\u65f6\uff0c\u5e94\u59cb\u7ec8\u4f7f\u7528Ansible\u51fd\u6570 to_native \u6765\u786e\u4fdd\u8de8Python\u7248\u672c\u7684\u5b57\u7b26\u4e32\u517c\u5bb9\u6027\uff1a from ansible.module_utils._text import to_native try : cause_an_exception () except Exception as e : raise AnsibleError ( 'Something happened, this was original exception: %s ' % to_native ( e )) \u67e5\u770b AnsibleError objects","title":"\u629b\u51fa\u5f02\u5e38"},{"location":"dev/plugins/#_2","text":"\u63d2\u4ef6\u8fd4\u56de\u7684\u6240\u6709\u5b57\u7b26\u4e32\u5fc5\u987b\u8f6c\u6362\u4e3aPython\u7684 unicode \u7c7b\u578b\u3002 \u8f6c\u6362\u4e3a unicode \u53ef\u786e\u4fdd\u8fd9\u4e9b\u5b57\u7b26\u4e32\u53ef\u4ee5\u901a\u8fc7 Jinja2 \u6a21\u677f\u4f7f\u7528\u3002 \u8f6c\u6362\u5b57\u7b26\u4e32\u793a\u4f8b\uff1a from ansible.module_utils._text import to_text result_string = to_text ( result_string )","title":"\u5b57\u7b26\u4e32\u7f16\u7801"},{"location":"dev/plugins/#_3","text":"DOCUMENTATION \u53d8\u91cf\u8bb0\u5f55\u7740\u63d2\u4ef6\u7684\u5e2e\u52a9\u4fe1\u606f DOCUMENTATION = ''' callback: test type: stdout short_description: test callback version_added: historical description: - test callback description options: remote_addr: description: - Address default: inventory_hostname vars: - name: ansible_host type: str ''' \u8981\u8bbf\u95ee\u63d2\u4ef6\u4e2d\u7684\u914d\u7f6e\u8bbe\u7f6e\uff0c\u8bf7\u4f7f\u7528 self.get_option(<option_name>) \u3002 \u5bf9\u4e8e\u5927\u591a\u6570\u63d2\u4ef6\u7c7b\u578b\uff0c\u63a7\u5236\u5668\u4f1a\u9884\u5148\u586b\u5145\u8bbe\u7f6e\u3002 \u5982\u679c\u9700\u8981\u663e\u5f0f\u586b\u5145\u8bbe\u7f6e\uff0c\u8bf7\u4f7f\u7528 self.set_options() \u8c03\u7528\u3002","title":"\u63d2\u4ef6\u6587\u6863"},{"location":"dev/plugins/#_4","text":"","title":"\u63d2\u4ef6\u7c7b\u578b"},{"location":"dev/plugins/#action","text":"Action\u63d2\u4ef6\u5141\u8bb8\u60a8\u5728\u63a7\u5236\u8282\u70b9\u5904\u7406\u7684\u6570\u636e\u4e0e\u8fdc\u7a0b\u6267\u884c\u7684\u6a21\u5757\u529f\u80fd\u96c6\u6210\u5728\u4e00\u8d77\u3002 \u8981\u521b\u5efaaction\u63d2\u4ef6\uff0c\u8bf7\u4f7f\u7528 Base(ActionBase) \u7c7b\u4f5c\u4e3a\u7236\u7c7b\u521b\u5efa\u4e00\u4e2a\u65b0\u7c7b\uff1a from ansible.plugins.action import ActionBase class ActionModule ( ActionBase ): pass \u7136\u540e\uff0c\u4f7f\u7528 _execute_module \u65b9\u6cd5\u8c03\u7528\u539f\u59cb\u6a21\u5757\u6765\u6267\u884c\u6a21\u5757\u4ee3\u7801\u3002\u6210\u529f\u6267\u884c\u6a21\u5757\u540e\uff0c\u53ef\u4ee5\u4fee\u6539\u6a21\u5757\u8fd4\u56de\u7684\u6570\u636e\u3002 module_return = self . _execute_module ( module_name = '<NAME_OF_MODULE>' , module_args = module_args , task_vars = task_vars , tmp = tmp ) \u4f8b\u5982\uff0c\u5982\u679c\u60a8\u60f3\u68c0\u67e5Ansible\u63a7\u5236\u8282\u70b9\u4e0e\u76ee\u6807\u8ba1\u7b97\u673a\u4e4b\u95f4\u7684\u65f6\u95f4\u5dee\uff0c\u5219\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2aaction\u63d2\u4ef6\u6765\u68c0\u67e5\u672c\u5730\u65f6\u95f4\u5e76\u5c06\u5176\u4e0esetup\u6a21\u5757\u7684\u8fd4\u56de\u6570\u636e\u8fdb\u884c\u6bd4\u8f83\uff1a #!/usr/bin/python # Make coding more python3-ish, this is required for contributions to Ansible from __future__ import ( absolute_import , division , print_function ) __metaclass__ = type from ansible.plugins.action import ActionBase from datetime import datetime class ActionModule ( ActionBase ): def run ( self , tmp = None , task_vars = None ): super ( ActionModule , self ) . run ( tmp , task_vars ) module_args = self . _task . args . copy () module_return = self . _execute_module ( module_name = 'setup' , module_args = module_args , task_vars = task_vars , tmp = tmp ) ret = dict () remote_date = None if not module_return . get ( 'failed' ): for key , value in module_return [ 'ansible_facts' ] . items (): if key == 'ansible_date_time' : remote_date = value [ 'iso8601' ] if remote_date : remote_date_obj = datetime . strptime ( remote_date , '%Y-%m- %d T%H:%M:%SZ' ) time_delta = datetime . now () - remote_date_obj ret [ 'delta_seconds' ] = time_delta . seconds ret [ 'delta_days' ] = time_delta . days ret [ 'delta_microseconds' ] = time_delta . microseconds return dict ( ansible_facts = dict ( ret )) \u8be5\u4ee3\u7801\u68c0\u67e5\u63a7\u5236\u8282\u70b9\u4e0a\u7684\u65f6\u95f4\uff0c\u4f7f\u7528setup\u6a21\u5757\u6355\u83b7\u8fdc\u7a0b\u8ba1\u7b97\u673a\u7684\u65e5\u671f\u548c\u65f6\u95f4\uff0c\u5e76\u8ba1\u7b97\u6355\u83b7\u7684\u65f6\u95f4\u4e0e\u672c\u5730\u65f6\u95f4\u4e4b\u95f4\u7684\u65f6\u5dee\uff0c\u4ee5\u5929\uff0c\u79d2\u548c\u5fae\u79d2\u4e3a\u5355\u4f4d\u8fd4\u56de\u65f6\u95f4\u589e\u91cf\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \uff0c \u672c\u5730\u5b89\u88c5\u7684\u5b58\u5728 /usr/lib/python2.7/site-packages/ansible/plugins/action/ \u76ee\u5f55\u4e2d","title":"Action"},{"location":"dev/plugins/#cache","text":"cache \u63d2\u4ef6\u7528\u4e8e\u5b58\u50a8\u7531 inventory \u63d2\u4ef6\u641c\u96c6\u5230\u7684 fact \u6570\u636e\u3002\u96c6\u5408\u4e2d\u7684cache\u63d2\u4ef6\u76ee\u524d\u53ea\u652f\u6301 fact \u7f13\u5b58\u3002 \u4f7f\u7528 cache_loader \u5bfc\u5165 cache \u63d2\u4ef6\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u4f7f\u7528 self.set_options() \u548c self.get_option(<option_name>) \u3002 \u5982\u679c\u76f4\u63a5\u5728\u4ee3\u7801\u5e93\u4e2d\u5bfc\u5165 cache \u63d2\u4ef6\uff0c\u5219\u53ea\u80fd\u901a\u8fc7 ansible.constants \u8bbf\u95ee\u9009\u9879\uff0c\u5e76\u4e14\u4f1a\u7834\u574f cache \u63d2\u4ef6\u4f9binventory \u63d2\u4ef6\u4f7f\u7528\u7684\u529f\u80fd\u3002 from ansible.plugins.loader import cache_loader [ ... ] plugin = cache_loader . get ( 'custom_cache' , ** cache_kwargs ) cache \u63d2\u4ef6\u6709\u4e24\u4e2a\u57fa\u7c7b\uff0c\u7528\u4e8e\u6570\u636e\u5e93\u652f\u6301\u7684\u7f13\u5b58\u7684 BaseCacheModule \u548c\u7528\u4e8e\u6587\u4ef6\u652f\u6301\u7684\u7f13\u5b58\u7684 BaseCacheFileModule \u3002 \u8981\u521b\u5efa cache \u63d2\u4ef6\uff0c\u9996\u5148\u8981\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u9002\u5f53\u57fa\u7c7b\u7684\u65b0 CacheModule \u7c7b\u3002 \u5982\u679c\u60a8\u4f7f\u7528 __init__ \u65b9\u6cd5\u521b\u5efa\u63d2\u4ef6\uff0c\u5219\u5e94\u4f7f\u7528\u63d0\u4f9b\u7684\u6240\u6709args\u548ckwargs\u521d\u59cb\u5316\u57fa\u7c7b\uff0c\u4ee5\u4e0e inventory \u63d2\u4ef6\u7f13\u5b58\u9009\u9879\u517c\u5bb9\u3002 \u57fa\u7c7b\u8c03\u7528 self.set_options(direct=kwargs) \u3002 \u5728\u8c03\u7528\u57fa\u7c7b __init__ \u65b9\u6cd5\u540e\uff0c\u5e94\u4f7f\u7528 self.get_option(<option_name>) \u8bbf\u95ee\u7f13\u5b58\u9009\u9879\u3002 \u65b0\u7684cache\u63d2\u4ef6\u5e94\u91c7\u7528 _uri \uff0c _prefix \u548c _timeout \u9009\u9879\uff0c\u4ee5\u4e0e\u73b0\u6709\u7684cache\u63d2\u4ef6\u4fdd\u6301\u4e00\u81f4\u3002 from ansible.plugins.cache import BaseCacheModule class CacheModule ( BaseCacheModule ): def __init__ ( self , * args , ** kwargs ): super ( CacheModule , self ) . __init__ ( * args , ** kwargs ) self . _connection = self . get_option ( '_uri' ) self . _prefix = self . get_option ( '_prefix' ) self . _timeout = self . get_option ( '_timeout' ) \u5982\u679c\u4f7f\u7528 BaseCacheModule \u57fa\u7c7b\u521b\u5efa\u63d2\u4ef6\uff0c\u5219\u5fc5\u987b\u5b9e\u73b0 get \uff0c contains \uff0c keys \uff0c set \uff0c delete \uff0c flush \u548c copy \u65b9\u6cd5\u3002 contains \u65b9\u6cd5\u5e94\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u8be5\u503c\u6307\u793a\u5bc6\u94a5\u662f\u5426\u5b58\u5728\u5e76\u4e14\u5c1a\u672a\u8fc7\u671f\u3002 \u4e0e\u57fa\u4e8e\u6587\u4ef6\u7684\u7f13\u5b58\u4e0d\u540c\uff0c\u5982\u679c\u7f13\u5b58\u8fc7\u671f\uff0c\u5219 get \u65b9\u6cd5\u4e0d\u4f1a\u5f15\u53d1KeyError\u3002 \u5982\u679c\u4f7f\u7528 BaseFileCacheModule \u57fa\u7c7b\u521b\u5efa\u63d2\u4ef6\uff0c\u5219\u5fc5\u987b\u5b9e\u73b0\u4ece\u57fa\u7c7b\u65b9\u6cd5 get \u548c set \u8c03\u7528\u7684 _load \u548c _dump \u65b9\u6cd5\u3002 \u5982\u679c\u60a8\u7684cache\u63d2\u4ef6\u5b58\u50a8JSON\uff0c\u8bf7\u5728 _dump \u6216 set \u65b9\u6cd5\u4e2d\u4f7f\u7528 AnsibleJSONEncoder \uff0c\u5728 _load \u6216 get \u65b9\u6cd5\u4e2d\u4f7f\u7528 AnsibleJSONDecoder \u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t cache \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/cache \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002","title":"Cache"},{"location":"dev/plugins/#callback","text":"callback \u63d2\u4ef6\u53ef\u4ee5\u5728\u4e8b\u4ef6\u6267\u884c\u7684\u65f6\u5019\u589e\u52a0\u65b0\u884c\u4e3a\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ccallback \u63d2\u4ef6\u5728\u547d\u4ee4\u884c\u7a0b\u5e8f\u6267\u884c\u65f6\uff0c\u8f93\u51fa\u5927\u91cf\u7684\u4fe1\u606f\uff0c\u6bd4\u5982\u6267\u884c\u7684\u4efb\u52a1\u540d\u79f0\uff0c\u6267\u884c\u65f6\u95f4\uff0c\u4efb\u52a1\u7ed3\u679c\u7b49\u7b49\u4fe1\u606f\u3002 \u8981\u521b\u5efa\u56de\u8c03\u63d2\u4ef6\uff0c\u8bf7\u4f7f\u7528Base\uff08Callbacks\uff09\u7c7b\u4f5c\u4e3a\u7236\u7c7b\u521b\u5efa\u4e00\u4e2a\u65b0\u7c7b\uff1a from ansible.plugins.callback import CallbackBase class CallbackModule ( CallbackBase ): pass \u5728\u65b0\u7c7b\u4e2d\uff0c\u9700\u8981\u8986\u76d6CallbackBase\u4e2d\u7684\u7279\u5b9a\u65b9\u6cd5\u624d\u80fd\u5728\u4e8b\u4ef6\u6267\u884c\u7684\u65f6\u5019\u6267\u884c\u5bf9\u5e94\u7684\u65b9\u6cd5\uff0c\u5b8c\u6574\u5217\u8868\u89c1 lib/ansible/plugins/callback/__init__.py def v2_on_any(self,*args,**kwargs): def v2_runner_on_failed(self,result,ignore_errors=False): def v2_runner_on_ok(self,result): def v2_runner_on_skipped(self,result): def v2_runner_on_unreachable(self,result): def v2_runner_on_async_poll(self,result): def v2_runner_on_async_ok(self,result): def v2_runner_on_async_failed(self,result): def v2_playbook_on_start(self,playbook): def v2_playbook_on_notify(self,handler,host): def v2_playbook_on_no_hosts_matched(self): def v2_playbook_on_no_hosts_remaining(self): def v2_playbook_on_task_start(self,task,is_conditional): def v2_playbook_on_cleanup_task_start(self,task): def v2_playbook_on_handler_task_start(self,task): def v2_playbook_on_vars_prompt(self,varname,private=True,prompt=None,encrypt=None,confirm=False,salt_size=None,salt=None,def ault=None,unsafe=None): def v2_playbook_on_vars_prompt(self,varname,private=True,prompt=None,encrypt=None,confirm=False,salt_size=None,salt=None,def ault=None,unsafe=None): self.playbook_on_vars_prompt(varname,private,prompt,encrypt,confirm,salt_size,salt,def ault,unsafe) def v2_playbook_on_import_for_host(self,result,imported_file): def v2_playbook_on_not_import_for_host(self,result,missing_file): def v2_playbook_on_play_start(self,play): def v2_playbook_on_stats(self,stats): def v2_on_file_diff(self,result): def v2_playbook_on_include(self,included_file): def v2_runner_item_on_ok(self,result): def v2_runner_item_on_failed(self,result): def v2_runner_item_on_skipped(self,result): def v2_runner_retry(self,result): def v2_runner_on_start(self,host,task): \u7279\u5b9a\u65b9\u6cd5\u7684result\u503c print ( result . _task ) # \u8f93\u51fa\u4efb\u52a1\u540d print ( result . _host ) # \u8f93\u51fa\u4e3b\u673a\u540d print ( result . _result ) # \u8f93\u51fa\u4efb\u52a1\u6267\u884c\u7684\u7ed3\u679c print ( result . is_changed ) # \u662f\u5426\u66f4\u6539 print ( result . is_failed ) # \u662f\u5426\u5931\u8d25 \u4ee5\u4e0b\u662fAnsible\u8ba1\u65f6\u5668\u63d2\u4ef6\u7684\u793a\u4f8b\uff0c\u4f46\u5e26\u6709\u4e00\u4e2a\u9644\u52a0\u9009\u9879\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728Ansible 2.4\u7248\u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\u914d\u7f6e\u4f7f\u7528\uff1a # Make coding more python3-ish, this is required for contributions to Ansible from __future__ import ( absolute_import , division , print_function ) __metaclass__ = type # not only visible to ansible-doc, it also 'declares' the options the plugin requires and how to configure them. DOCUMENTATION = ''' callback: timer callback_type: aggregate requirements: - whitelist in configuration short_description: Adds time to play stats version_added: \"2.0\" description: - This callback just adds total play duration to the play stats. options: format_string: description: format of the string shown to user at play end ini: - section: callback_timer key: format_string env: - name: ANSIBLE_CALLBACK_TIMER_FORMAT default: \"Playbook run took %s days, %s hours, %s minutes, %s seconds\" ''' from datetime import datetime from ansible.plugins.callback import CallbackBase class CallbackModule ( CallbackBase ): \"\"\" This callback module tells you how long your plays ran for. \"\"\" CALLBACK_VERSION = 2.0 CALLBACK_TYPE = 'aggregate' CALLBACK_NAME = 'namespace.collection_name.timer' # only needed if you ship it and don't want to enable by default CALLBACK_NEEDS_WHITELIST = True def __init__ ( self ): # make sure the expected objects are present, calling the base's __init__ super ( CallbackModule , self ) . __init__ () # start the timer when the plugin is loaded, the first play should start a few milliseconds after. self . start_time = datetime . now () def _days_hours_minutes_seconds ( self , runtime ): ''' internal helper method for this callback ''' minutes = ( runtime . seconds // 60 ) % 60 r_seconds = runtime . seconds - ( minutes * 60 ) return runtime . days , runtime . seconds // 3600 , minutes , r_seconds # this is only event we care about for display, when the play shows its summary stats; the rest are ignored by the base class def v2_playbook_on_stats ( self , stats ): end_time = datetime . now () runtime = end_time - self . start_time # Shows the usage of a config option declared in the DOCUMENTATION variable. Ansible will have set it when it loads the plugin. # Also note the use of the display object to print to screen. This is available to all callbacks, and you should use this over printing yourself self . _display . display ( self . _plugin_options [ 'format_string' ] % ( self . _days_hours_minutes_seconds ( runtime ))) callback\u8bf4\u660e\u4fe1\u606f CALLBACK_VERSION = 2.0 \u63d2\u4ef6\u7248\u672c CALLBACK_TYPE = 'aggregate' \u63d2\u4ef6\u7c7b\u578b\uff0c\u5982\u679c\u662f'stdout'\u65f6\uff0c\u53ea\u4f1a\u52a0\u8f7d\u4e00\u4e2a\u8fd9\u6837\u7684\u56de\u8c03\u63d2\u4ef6 CALLBACK_NAME = 'namespace.collection_name.timer' \u63d2\u4ef6\u540d\u79f0\uff0c\u9700\u4e0e\u6587\u4ef6\u540d\u79f0\u4e00\u81f4\u3002 CALLBACK_NEEDS_WHITELIST = True \u63d2\u4ef6\u662f\u5426\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u914d\u7f6ewhitelist\u3002\u4e3atrue\u662f\uff0cansible\u68c0\u67e5ansible.cfg\u6587\u4ef6\u4e2d\u7684callback_whitelist\u662f\u5426\u6709\u63d2\u4ef6\u540d\u79f0\uff0c\u6709\u5219\u6267\u884c\uff0c\u65e0\u5219\u8df3\u8fc7\u3002 \u8bf7\u6ce8\u610f\uff0cAnsible 2.0\u7248\u53ca\u66f4\u9ad8\u7248\u672c\u7684\u63d2\u4ef6\u9700\u8981 CALLBACK_VERSION \u548c CALLBACK_NAME \u5b9a\u4e49\u624d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002ansible\u53ea\u52a0\u8f7d\u4e00\u4e2a CALLBACK_TYPE=stdout \u7684callback\u63d2\u4ef6\uff0c\u5982\u679c\u60f3\u6267\u884c\u591a\u4e2acallback\u63d2\u4ef6\u9700\u8bbe\u7f6e\u5176\u4ed6\u7c7b\u578b\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t callback \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/callback \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002","title":"Callback"},{"location":"dev/plugins/#connection","text":"ansible\u901a\u8fc7\u4f7f\u7528connection\u63d2\u4ef6\u6765\u8fde\u63a5\u8fdc\u7a0b\u7cfb\u7edf\uff0c\u4ee5\u4fbf\u5b83\u53ef\u4ee5\u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u6267\u884c\u4efb\u52a1\u3002Ansible\u9644\u5e26\u4e86\u8bb8\u591aconnection\u63d2\u4ef6\uff0c\u4f46\u6bcf\u4e2a\u4e3b\u673a\u4e00\u6b21\u53ea\u80fd\u4f7f\u7528\u4e00\u4e2a\u3002\u6700\u5e38\u7528\u7684connection\u63d2\u4ef6\u662f paramiko SSH\uff0c\u672c\u673assh\u547d\u4ee4\u548c local connection\u7c7b\u578b\u3002 \u53ef\u4ee5\u901a\u8fc7\u5728task\u4e0a\u914d\u7f6e connection \u5173\u952e\u5b57\u6765\u9009\u62e9\u7528\u54ea\u79cd\u65b9\u5f0f\u8fde\u63a5\u8fdc\u7a0b\u7cfb\u7edf\u3002 Ansible 2.1\u7248\u5f15\u5165\u4e86 smart connection\u63d2\u4ef6\u3002 smart connection\u7c7b\u578b\u5141\u8bb8Ansible\u6839\u636e\u7cfb\u7edf\u529f\u80fd\u81ea\u52a8\u9009\u62e9 paramiko \u6216 openssh connection\u63d2\u4ef6\uff0c\u5982\u679cOpenSSH\u652f\u6301ControlPersist\uff0c\u5219\u9009\u62e9 ssh connection\u63d2\u4ef6\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t connection \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/connection \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002","title":"Connection"},{"location":"dev/plugins/#filter","text":"filter\u63d2\u4ef6\u5141\u8bb8\u4f60\u5728 playbook \u548c Jinja2 \u6a21\u7248\u5185\u64cd\u4f5c\u6570\u636e\uff0cansible\u4f7f\u7528filter plugin\u6765\u6269\u5c55jinja2\u6a21\u7248\u7684\u529f\u80fd\u3002Ansible\u9644\u5e26\u7684\u5927\u591a\u6570\u8fc7\u6ee4\u5668\u63d2\u4ef6\u90fd\u4f4d\u4e8e core.py \u4e2d\u3002 filter\u63d2\u4ef6\u53ef\u4ee5\u4e0d\u914d\u7f6e DOCUMENTATION \u6765\u8bf4\u660e\u63d2\u4ef6\u9009\u9879\u548c\u5e2e\u52a9\u4fe1\u606f\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/filter \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002","title":"Filter"},{"location":"dev/plugins/#inventory","text":"\u5728Ansible 2.4\u7248\u672c\u4e2d\u6dfb\u52a0\u4e86inventory\u63d2\u4ef6\uff0cinventory\u63d2\u4ef6\u7528\u4e8e\u89e3\u6790\u52a8\u6001\u8d44\u6e90\u7684\u4e3b\u673a\u6e05\u5355\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t inventory \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/inventory \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002","title":"Inventory"},{"location":"dev/plugins/#lookup","text":"\u7528\u4e8e\u4ece\u5916\u90e8\u6570\u636e\u4e2d\u63d0\u53d6\u6570\u636e\u5e76\u8fd4\u56de\u5230\u53d8\u91cf\u6216\u53c2\u6570\u4e2d\u3002\u6bd4\u5982\u5faa\u73af with_* \u7684\u7528\u6cd5\u3002 \u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u67e5\u627e\u63d2\u4ef6\u5b9e\u73b0\uff0c\u6b64\u67e5\u627e\u5c06\u6587\u672c\u6587\u4ef6\u7684\u5185\u5bb9\u4f5c\u4e3a\u53d8\u91cf\u8fd4\u56de # python 3 headers, required if submitting to Ansible from __future__ import ( absolute_import , division , print_function ) __metaclass__ = type DOCUMENTATION = \"\"\" lookup: file author: Daniel Hokka Zakrisson <daniel@hozac.com> version_added: \"0.9\" short_description: read file contents description: - This lookup returns the contents from a file on the Ansible controller's file system. options: _terms: description: path(s) of files to read required: True notes: - if read in variable context, the file can be interpreted as YAML if the content is valid to the parser. - this lookup does not understand globing --- use the fileglob lookup instead. \"\"\" from ansible.errors import AnsibleError , AnsibleParserError from ansible.plugins.lookup import LookupBase from ansible.utils.display import Display display = Display () class LookupModule ( LookupBase ): def run ( self , terms , variables = None , ** kwargs ): # lookups in general are expected to both take a list as input and output a list # this is done so they work with the looping construct 'with_'. ret = [] for term in terms : display . debug ( \"File lookup term: %s \" % term ) # Find the file in the expected search path, using a class method # that implements the 'expected' search path for Ansible plugins. lookupfile = self . find_file_in_search_path ( variables , 'files' , term ) # Don't use print or your own logging, the display class # takes care of it in a unified way. display . vvvv ( u \"File lookup using %s as file\" % lookupfile ) try : if lookupfile : contents , show_data = self . _loader . _get_file_contents ( lookupfile ) ret . append ( contents . rstrip ()) else : # Always use ansible error classes to throw 'final' exceptions, # so the Ansible engine will know how to deal with them. # The Parser error indicates invalid options passed raise AnsibleParserError () except AnsibleParserError : raise AnsibleError ( \"could not locate file in lookup: %s \" % term ) return ret \u4f7f\u7528\u63d2\u4ef6 --- - hosts : all vars : contents : \"{{ lookup('namespace.collection_name.file', '/etc/foo.txt') }}\" tasks : - debug : msg : the value of foo.txt is {{ contents }} as seen today {{ lookup('pipe', 'date +\"%Y-%m-%d\"') }} \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t lookup \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/lookup \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002","title":"Lookup"},{"location":"dev/plugins/#shell","text":"\u5f88\u50cfconnection\u63d2\u4ef6\uff0cansible\u4f7f\u7528shell\u63d2\u4ef6\u5728shell\u73af\u5883\u4e2d\u6267\u884c\uff0c\u76ee\u524d\u652f\u6301\u7684shell\u6709csh\uff0cfish\uff0cpowershell\uff0csh\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t shell \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/shell \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002","title":"Shell"},{"location":"dev/plugins/#strategy","text":"\u63a7\u5236\u4efb\u52a1\u6267\u884c\u6d41\u7a0b\uff0c \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t strategy \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/strategy \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002","title":"Strategy"},{"location":"dev/plugins/#terminal","text":"\u7528\u6765\u8fde\u63a5cli\u7684\u786c\u4ef6\u8bbe\u5907\uff0c\u50cf\u4ea4\u6362\u673a\uff0c\u8def\u7531\u5668\uff0c\u9632\u706b\u5899\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/terminal \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002","title":"Terminal"},{"location":"dev/plugins/#test","text":"\u7528\u4e8e\u9a8c\u8bc1\u6570\u636e\uff0c\u5c5e\u4e8ejinja2\u7684\u529f\u80fd\u3002\u53ef\u7528\u4e8e\u6761\u4ef6\u6307\u4ee4\uff0c\u4f8b\u5982 when: \u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/test \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002","title":"Test"},{"location":"dev/plugins/#vars","text":"Vars\u63d2\u4ef6\u5c06\u989d\u5916\u7684\u53d8\u91cf\u6570\u636e\u6ce8\u5165\u5230\u8fd0\u884c\u7684\u4e3b\u673a\u4e2d\uff0c\u800c\u8fd9\u4e9b\u8fd0\u884c\u4e0d\u662f\u6765\u81ea\u5e93\u5b58\u6e90\u3001\u5267\u672c\u6216\u547d\u4ee4\u884c\u3002\u5982 host_vars \u548c group_vars \u90fd\u662f\u6709vars\u63d2\u4ef6\u6765\u5b8c\u6210\u7684\u3002\u3002 \u83b7\u53d6\u53ef\u7528\u7684\u63d2\u4ef6\u5217\u8868 ansible-doc -l -t vars \u5b98\u65b9\u63d0\u4f9b\u7684\u63d2\u4ef6\u6587\u4ef6\u53ef\u4ee5\u5728 Ansible Core \u6216\u672c\u5730\u5b89\u88c5\u7684 /usr/lib/python2.7/site-packages/ansible/plugins/vars \u76ee\u5f55\u4e2d\u627e\u7684\u5230\u3002","title":"Vars"},{"location":"dev/plugins/#_5","text":"\u5728 ansible.cfg \u914d\u7f6e\u7684\u63d2\u4ef6\u76ee\u5f55\u3002 [defaults] # set plugin path directories here, separate with colons action_plugins = /usr/share/ansible/plugins/action become_plugins = /usr/share/ansible/plugins/become cache_plugins = /usr/share/ansible/plugins/cache callback_plugins = /usr/share/ansible/plugins/callback connection_plugins = /usr/share/ansible/plugins/connection lookup_plugins = /usr/share/ansible/plugins/lookup inventory_plugins = /usr/share/ansible/plugins/inventory vars_plugins = /usr/share/ansible/plugins/vars filter_plugins = /usr/share/ansible/plugins/filter test_plugins = /usr/share/ansible/plugins/test terminal_plugins = /usr/share/ansible/plugins/terminal strategy_plugins = /usr/share/ansible/plugins/strategy \u5728\u73af\u5883\u53d8\u91cf\u4e2d\u6307\u5b9a\u63d2\u4ef6\u76ee\u5f55\u3002 ANSIBLE_ACTION_PLUGINS ANSIBLE_CACHE_PLUGINS ANSIBLE_CALLBACK_PLUGINS ANSIBLE_CONNECTION_PLUGINS ANSIBLE_FILTER_PLUGINS ANSIBLE_INVENTORY_PLUGINS ANSIBLE_LOOKUP_PLUGIN ANSIBLE_SHELL_PLUGINS ANSIBLE_STRATEGY_PLUGINS ANSIBLE_TEST_PLUGINS ANSIBLE_VARS_PLUGINS \u653e\u7f6e\u4ee5\u4e0b\u76ee\u5f55\uff0c\u53ef\u4f7fansible\u81ea\u52a8\u52a0\u8f7d\u63d2\u4ef6 ~/.ansible/plugins/ \u76ee\u5f55\u4e2d\u7684\u63d2\u4ef6, \u6bd4\u5982 ~/.ansible/plugins/callback \u76ee\u5f55\u4e2d\uff0c\u4f1a\u81ea\u52a8\u52a0\u8f7dcallback\u63d2\u4ef6 /usr/share/ansible/plugins/ \u76ee\u5f55\u4e2d\u7684\u63d2\u4ef6\uff0c\u6bd4\u5982 /usr/share/ansible/plugins/callback \u76ee\u5f55\u4e2d\uff0c\u4f1a\u81ea\u52a8\u52a0\u8f7dcallback\u63d2\u4ef6 \u5f53\u60a8\u7684Playbook\u540c\u76ee\u5f55\u4e0b\u6216\u89d2\u8272\u4e2d\u6709\u4ee5\u4e0b\u5b50\u6587\u4ef6\u5939\u4e4b\u4e00\u65f6\uff0c\u63d2\u4ef6\u4f1a\u81ea\u52a8\u52a0\u8f7d\uff1a action_plugins cache_plugins callback_plugins connection_plugins filter_plugins inventory_plugins lookup_plugins shell_plugins strategy_plugins test_plugins vars_plugins","title":"\u81ea\u5b9a\u4e49\u7684\u63d2\u4ef6\u5b58\u653e\u4f4d\u7f6e"},{"location":"dev/plugins/Action-hello/","text":"action plugins: hello \u00b6 \u9700\u6c42 \u00b6 \u7f16\u5199\u4e00\u4e2ahello\u63d2\u4ef6 \u7f16\u5199\u63d2\u4ef6 \u00b6 \u6587\u4ef6\u8def\u5f84 action_plugins/hello.py #!/usr/bin/env python from ansible.plugins.action import ActionBase class ActionModule ( ActionBase ) : def run ( self, tmp = None, task_vars = None ) : if task_vars is None: task_vars = dict () result = super ( ActionModule, self ) .run ( tmp, task_vars ) args = self._task.args.copy () if 'name' not in args: # \u8bbe\u7f6e\u6a21\u5757\u9ed8\u8ba4\u53c2\u6570 args [ 'name' ] = 'Tom' result.update ( self._execute_module ( module_args = args, task_vars = task_vars ) , _ansible_verbose_always = True ) # \u6267\u884c\u6a21\u5757\u5e76\u66f4\u65b0\u6a21\u5757\u8fd4\u56de\u6570\u636e,\u4e0d\u6307\u5b9amodule_name\u65f6\uff0c\u9ed8\u8ba4\u4f7f\u7528action \u540d\u79f0 return result # \u8fd4\u56de\u5b57\u5178\u4fe1\u606f \u7f16\u5199\u6a21\u5757 \u00b6 \u6587\u4ef6\u8def\u5f84: library/hello.py #!/usr/bin/env python ANSIBLE_METADATA = { 'metadata_version' : '1.0' , 'status' : [ 'preview' ], 'supported_by' : 'community' } DOCUMENTATION = ''' --- module: hello version_added: \"0.1\" short_description: Hello module description: - Module to say hello. options: name: description: - Name to greet. default: False ''' EXAMPLES = ''' - action: hello name='tom' - hello: name: tom ''' from ansible.module_utils.basic import AnsibleModule def main (): argument_spec = dict ( name = dict ( required = True , type = 'str' ), ) module = AnsibleModule ( argument_spec = argument_spec ) result = { \"changed\" : False , \"rc\" : 0 } name = module . params . get ( 'name' ) if name : result [ 'msg' ] = \"Hello %s !\" % name else : result [ 'failed' ] = True result [ 'msg' ] = \"Empty name is invalid\" result [ 'rc' ] = 1 if result . get ( 'failed' ): module . fail_json ( ** result ) else : module . exit_json ( ** result ) if __name__ == '__main__' : main () \u6267\u884c playbook \u00b6 # cat test_action.yml --- - hosts : 192.168.77.130 gather_facts : no tasks : - action : hello name='bob' - hello : - hello : name : '' \u6267\u884c\u7ed3\u679c # ansible-playbook test_action.yml PLAY [ 192 .168.77.130 ] ************************************************************************************* TASK [ hello ] ************************************************************************************* ok: [ 192 .168.77.130 ] = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"msg\" : \"Hello bob!\" , \"rc\" : 0 } TASK [ hello ] ************************************************************************************* ok: [ 192 .168.77.130 ] = > { \"changed\" : false, \"msg\" : \"Hello Tom!\" , \"rc\" : 0 } TASK [ hello ] ************************************************************************************* fatal: [ 192 .168.77.130 ] : FAILED! = > { \"changed\" : false, \"msg\" : \"Empty name is invalid\" , \"rc\" : 1 } PLAY RECAP ************************************************************************************* 192 .168.77.130 : ok = 2 changed = 0 unreachable = 0 failed = 1 skipped = 0 rescued = 0 ignored = 0 \u6267\u884c ad-hoc \u00b6 \u914d\u7f6e ansible.cfg ,\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684\u63d2\u4ef6\u76ee\u5f55 [defaults] library = /etc/ansible/library action_plugins = /etc/ansible/action_plugins # ansible 192.168.77.130 -m hello 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"msg\" : \"Hello Tom!\" , \"rc\" : 0 } # ansible 192.168.77.130 -m hello -a \"name=bob\" 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"msg\" : \"Hello bob!\" , \"rc\" : 0 } # ansible 192.168.77.130 -m hello -a \"name=\" 192 .168.77.130 | FAILED! = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"msg\" : \"Empty name is invalid\" , \"rc\" : 1 }","title":"Action \u793a\u4f8b: hello"},{"location":"dev/plugins/Action-hello/#action-plugins-hello","text":"","title":"action plugins: hello"},{"location":"dev/plugins/Action-hello/#_1","text":"\u7f16\u5199\u4e00\u4e2ahello\u63d2\u4ef6","title":"\u9700\u6c42"},{"location":"dev/plugins/Action-hello/#_2","text":"\u6587\u4ef6\u8def\u5f84 action_plugins/hello.py #!/usr/bin/env python from ansible.plugins.action import ActionBase class ActionModule ( ActionBase ) : def run ( self, tmp = None, task_vars = None ) : if task_vars is None: task_vars = dict () result = super ( ActionModule, self ) .run ( tmp, task_vars ) args = self._task.args.copy () if 'name' not in args: # \u8bbe\u7f6e\u6a21\u5757\u9ed8\u8ba4\u53c2\u6570 args [ 'name' ] = 'Tom' result.update ( self._execute_module ( module_args = args, task_vars = task_vars ) , _ansible_verbose_always = True ) # \u6267\u884c\u6a21\u5757\u5e76\u66f4\u65b0\u6a21\u5757\u8fd4\u56de\u6570\u636e,\u4e0d\u6307\u5b9amodule_name\u65f6\uff0c\u9ed8\u8ba4\u4f7f\u7528action \u540d\u79f0 return result # \u8fd4\u56de\u5b57\u5178\u4fe1\u606f","title":"\u7f16\u5199\u63d2\u4ef6"},{"location":"dev/plugins/Action-hello/#_3","text":"\u6587\u4ef6\u8def\u5f84: library/hello.py #!/usr/bin/env python ANSIBLE_METADATA = { 'metadata_version' : '1.0' , 'status' : [ 'preview' ], 'supported_by' : 'community' } DOCUMENTATION = ''' --- module: hello version_added: \"0.1\" short_description: Hello module description: - Module to say hello. options: name: description: - Name to greet. default: False ''' EXAMPLES = ''' - action: hello name='tom' - hello: name: tom ''' from ansible.module_utils.basic import AnsibleModule def main (): argument_spec = dict ( name = dict ( required = True , type = 'str' ), ) module = AnsibleModule ( argument_spec = argument_spec ) result = { \"changed\" : False , \"rc\" : 0 } name = module . params . get ( 'name' ) if name : result [ 'msg' ] = \"Hello %s !\" % name else : result [ 'failed' ] = True result [ 'msg' ] = \"Empty name is invalid\" result [ 'rc' ] = 1 if result . get ( 'failed' ): module . fail_json ( ** result ) else : module . exit_json ( ** result ) if __name__ == '__main__' : main ()","title":"\u7f16\u5199\u6a21\u5757"},{"location":"dev/plugins/Action-hello/#playbook","text":"# cat test_action.yml --- - hosts : 192.168.77.130 gather_facts : no tasks : - action : hello name='bob' - hello : - hello : name : '' \u6267\u884c\u7ed3\u679c # ansible-playbook test_action.yml PLAY [ 192 .168.77.130 ] ************************************************************************************* TASK [ hello ] ************************************************************************************* ok: [ 192 .168.77.130 ] = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"msg\" : \"Hello bob!\" , \"rc\" : 0 } TASK [ hello ] ************************************************************************************* ok: [ 192 .168.77.130 ] = > { \"changed\" : false, \"msg\" : \"Hello Tom!\" , \"rc\" : 0 } TASK [ hello ] ************************************************************************************* fatal: [ 192 .168.77.130 ] : FAILED! = > { \"changed\" : false, \"msg\" : \"Empty name is invalid\" , \"rc\" : 1 } PLAY RECAP ************************************************************************************* 192 .168.77.130 : ok = 2 changed = 0 unreachable = 0 failed = 1 skipped = 0 rescued = 0 ignored = 0","title":"\u6267\u884c playbook"},{"location":"dev/plugins/Action-hello/#ad-hoc","text":"\u914d\u7f6e ansible.cfg ,\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684\u63d2\u4ef6\u76ee\u5f55 [defaults] library = /etc/ansible/library action_plugins = /etc/ansible/action_plugins # ansible 192.168.77.130 -m hello 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"msg\" : \"Hello Tom!\" , \"rc\" : 0 } # ansible 192.168.77.130 -m hello -a \"name=bob\" 192 .168.77.130 | SUCCESS = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"msg\" : \"Hello bob!\" , \"rc\" : 0 } # ansible 192.168.77.130 -m hello -a \"name=\" 192 .168.77.130 | FAILED! = > { \"ansible_facts\" : { \"discovered_interpreter_python\" : \"/usr/bin/python\" } , \"changed\" : false, \"msg\" : \"Empty name is invalid\" , \"rc\" : 1 }","title":"\u6267\u884c ad-hoc"},{"location":"dev/plugins/Callback-BlackHole/","text":"callback plugins: BlackHole \u00b6 \u9700\u6c42 \u00b6 \u6267\u884c\u547d\u4ee4\u65f6\uff0c\u4ec0\u4e48\u90fd\u4e0d\u663e\u793a\u3002\u628a\u56de\u663e\u5185\u5bb9\u4e22\u5230\u9ed1\u6d1e\u53bb\u3002 \u7f16\u5199\u63d2\u4ef6 \u00b6 \u5728 /etc/ansible/callback_plugins \u76ee\u5f55\u4e2d\u521b\u5efa BlackHole.py \u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a # Make coding more python3-ish, this is required for contributions to Ansible from __future__ import ( absolute_import , division , print_function ) __metaclass__ = type from ansible.plugins.callback import CallbackBase class CallbackModule ( CallbackBase ): ''' Magic black hole, nothing will show up. ''' CALLBACK_VERSION = 2.0 CALLBACK_TYPE = 'stdout' CALLBACK_NAME = 'BlackHole' # only needed if you ship it and don't want to enable by default CALLBACK_NEEDS_WHITELIST = True def v2_on_any ( self , * args , ** kwargs ): pass def v2_runner_on_failed ( self , result , ignore_errors = False ): pass def v2_runner_on_ok ( self , result ): pass def v2_runner_on_skipped ( self , result ): pass def v2_runner_on_unreachable ( self , result ): pass def v2_runner_on_async_poll ( self , result ): pass def v2_runner_on_async_ok ( self , result ): pass def v2_runner_on_async_failed ( self , result ): pass def v2_playbook_on_start ( self , playbook ): pass def v2_playbook_on_notify ( self , handler , host ): pass def v2_playbook_on_no_hosts_matched ( self ): pass def v2_playbook_on_no_hosts_remaining ( self ): pass def v2_playbook_on_task_start ( self , task , is_conditional ): pass def v2_playbook_on_cleanup_task_start ( self , task ): pass def v2_playbook_on_handler_task_start ( self , task ): pass def v2_playbook_on_vars_prompt ( self , varname , private = True , prompt = None , encrypt = None , confirm = False , salt_size = None , salt = None , ault = None , unsafe = None ): pass def v2_playbook_on_import_for_host ( self , result , imported_file ): pass def v2_playbook_on_not_import_for_host ( self , result , missing_file ): pass def v2_playbook_on_play_start ( self , play ): pass def v2_playbook_on_stats ( self , stats ): pass def v2_on_file_diff ( self , result ): pass def v2_playbook_on_include ( self , included_file ): pass def v2_runner_item_on_ok ( self , result ): pass def v2_runner_item_on_failed ( self , result ): pass def v2_runner_item_on_skipped ( self , result ): pass def v2_runner_retry ( self , result ): pass def v2_runner_on_start ( self , host , task ): pass \u5c06callback\u6240\u6709\u7684v2\u56de\u8c03\u65b9\u6cd5\u90fd\u91cd\u5199\uff0c\u5e76\u4e14\u4e0d\u505a\u4efb\u4f55\u5904\u7406 \u914d\u7f6e ansible.cfg \u00b6 [defaults] callback_plugins = /etc/ansible/callback_plugins # \u63d2\u4ef6\u76ee\u5f55 stdout_callback = BlackHole # stdout \u63d2\u4ef6 callback_whitelist = BlackHole # callback \u63d2\u4ef6\u767d\u540d\u5355 \u6267\u884c playbook \u00b6 # cat test.yml --- - hosts: localhost tasks: - debug: msg = \"hello\" # ansible-playbook test_BlackHole.yml # ansible-playbook test_BlackHole.yml -vvvv ansible-playbook 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible-playbook python version = 2 .7.5 ( default, Aug 7 2019 , 00 :51:29 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] Using /etc/ansible/ansible.cfg as config file setting up inventory plugins host_list declined parsing /etc/ansible/hosts as it did not pass its verify_file () method script declined parsing /etc/ansible/hosts as it did not pass its verify_file () method auto declined parsing /etc/ansible/hosts as it did not pass its verify_file () method Parsed /etc/ansible/hosts inventory source with ini plugin Loading callback plugin BlackHole of type stdout, v2.0 from /etc/ansible/callback_plugins/BlackHole.py 1 plays in test_BlackHole.yml Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/setup.py Pipelining is enabled. < 127 .0.0.1> ESTABLISH LOCAL CONNECTION FOR USER: root < 127 .0.0.1> EXEC /bin/sh -c '/usr/bin/python2 && sleep 0' META: ran handlers META: ran handlers META: ran handlers \u662f\u4e0d\u662f\u5f88\u795e\u5947\u5440\uff01playbook \u8f93\u51fa\u4fe1\u606f\u90fd\u6ca1\u4e86\u3002 \u6267\u884c ad-hoc \u547d\u4ee4 \u00b6 ansible ad-hoc \u547d\u4ee4\u9ed8\u8ba4\u4f7f\u7528 minimal callback\u63d2\u4ef6\uff0c\u5982\u679c\u8981\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684callback\u63d2\u4ef6\u65f6\uff0c\u9700\u8981\u6dfb\u52a0 bin_ansible_callbacks \u53c2\u6570\u624d\u80fd\u4f7f\u7528\u3002 \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0 [defaults] bin_ansible_callbacks = True \u6216\u8005\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u5f00\u542f export ANSIBLE_LOAD_CALLBACK_PLUGINS = 1 # ansible localhost -m ping # ansible localhost -m ping -vvvv ansible 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible python version = 2 .7.5 ( default, Aug 7 2019 , 00 :51:29 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] Using /etc/ansible/ansible.cfg as config file setting up inventory plugins host_list declined parsing /etc/ansible/hosts as it did not pass its verify_file () method script declined parsing /etc/ansible/hosts as it did not pass its verify_file () method auto declined parsing /etc/ansible/hosts as it did not pass its verify_file () method Parsed /etc/ansible/hosts inventory source with ini plugin Loading callback plugin BlackHole of type stdout, v2.0 from /etc/ansible/callback_plugins/BlackHole.pyc META: ran handlers Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/ping.py Pipelining is enabled. < 127 .0.0.1> ESTABLISH LOCAL CONNECTION FOR USER: root < 127 .0.0.1> EXEC /bin/sh -c '/usr/bin/python2 && sleep 0' META: ran handlers META: ran handlers ad-hoc \u7684\u6267\u884c\u8f93\u51fa\u4e5f\u6ca1\u4e86\uff0c\u5168\u90e8\u4e22\u5165\u9ed1\u6d1e\u5566\u3002","title":"Callback \u793a\u4f8b: BlackHole"},{"location":"dev/plugins/Callback-BlackHole/#callback-plugins-blackhole","text":"","title":"callback plugins: BlackHole"},{"location":"dev/plugins/Callback-BlackHole/#_1","text":"\u6267\u884c\u547d\u4ee4\u65f6\uff0c\u4ec0\u4e48\u90fd\u4e0d\u663e\u793a\u3002\u628a\u56de\u663e\u5185\u5bb9\u4e22\u5230\u9ed1\u6d1e\u53bb\u3002","title":"\u9700\u6c42"},{"location":"dev/plugins/Callback-BlackHole/#_2","text":"\u5728 /etc/ansible/callback_plugins \u76ee\u5f55\u4e2d\u521b\u5efa BlackHole.py \u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a # Make coding more python3-ish, this is required for contributions to Ansible from __future__ import ( absolute_import , division , print_function ) __metaclass__ = type from ansible.plugins.callback import CallbackBase class CallbackModule ( CallbackBase ): ''' Magic black hole, nothing will show up. ''' CALLBACK_VERSION = 2.0 CALLBACK_TYPE = 'stdout' CALLBACK_NAME = 'BlackHole' # only needed if you ship it and don't want to enable by default CALLBACK_NEEDS_WHITELIST = True def v2_on_any ( self , * args , ** kwargs ): pass def v2_runner_on_failed ( self , result , ignore_errors = False ): pass def v2_runner_on_ok ( self , result ): pass def v2_runner_on_skipped ( self , result ): pass def v2_runner_on_unreachable ( self , result ): pass def v2_runner_on_async_poll ( self , result ): pass def v2_runner_on_async_ok ( self , result ): pass def v2_runner_on_async_failed ( self , result ): pass def v2_playbook_on_start ( self , playbook ): pass def v2_playbook_on_notify ( self , handler , host ): pass def v2_playbook_on_no_hosts_matched ( self ): pass def v2_playbook_on_no_hosts_remaining ( self ): pass def v2_playbook_on_task_start ( self , task , is_conditional ): pass def v2_playbook_on_cleanup_task_start ( self , task ): pass def v2_playbook_on_handler_task_start ( self , task ): pass def v2_playbook_on_vars_prompt ( self , varname , private = True , prompt = None , encrypt = None , confirm = False , salt_size = None , salt = None , ault = None , unsafe = None ): pass def v2_playbook_on_import_for_host ( self , result , imported_file ): pass def v2_playbook_on_not_import_for_host ( self , result , missing_file ): pass def v2_playbook_on_play_start ( self , play ): pass def v2_playbook_on_stats ( self , stats ): pass def v2_on_file_diff ( self , result ): pass def v2_playbook_on_include ( self , included_file ): pass def v2_runner_item_on_ok ( self , result ): pass def v2_runner_item_on_failed ( self , result ): pass def v2_runner_item_on_skipped ( self , result ): pass def v2_runner_retry ( self , result ): pass def v2_runner_on_start ( self , host , task ): pass \u5c06callback\u6240\u6709\u7684v2\u56de\u8c03\u65b9\u6cd5\u90fd\u91cd\u5199\uff0c\u5e76\u4e14\u4e0d\u505a\u4efb\u4f55\u5904\u7406","title":"\u7f16\u5199\u63d2\u4ef6"},{"location":"dev/plugins/Callback-BlackHole/#ansiblecfg","text":"[defaults] callback_plugins = /etc/ansible/callback_plugins # \u63d2\u4ef6\u76ee\u5f55 stdout_callback = BlackHole # stdout \u63d2\u4ef6 callback_whitelist = BlackHole # callback \u63d2\u4ef6\u767d\u540d\u5355","title":"\u914d\u7f6e ansible.cfg"},{"location":"dev/plugins/Callback-BlackHole/#playbook","text":"# cat test.yml --- - hosts: localhost tasks: - debug: msg = \"hello\" # ansible-playbook test_BlackHole.yml # ansible-playbook test_BlackHole.yml -vvvv ansible-playbook 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible-playbook python version = 2 .7.5 ( default, Aug 7 2019 , 00 :51:29 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] Using /etc/ansible/ansible.cfg as config file setting up inventory plugins host_list declined parsing /etc/ansible/hosts as it did not pass its verify_file () method script declined parsing /etc/ansible/hosts as it did not pass its verify_file () method auto declined parsing /etc/ansible/hosts as it did not pass its verify_file () method Parsed /etc/ansible/hosts inventory source with ini plugin Loading callback plugin BlackHole of type stdout, v2.0 from /etc/ansible/callback_plugins/BlackHole.py 1 plays in test_BlackHole.yml Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/setup.py Pipelining is enabled. < 127 .0.0.1> ESTABLISH LOCAL CONNECTION FOR USER: root < 127 .0.0.1> EXEC /bin/sh -c '/usr/bin/python2 && sleep 0' META: ran handlers META: ran handlers META: ran handlers \u662f\u4e0d\u662f\u5f88\u795e\u5947\u5440\uff01playbook \u8f93\u51fa\u4fe1\u606f\u90fd\u6ca1\u4e86\u3002","title":"\u6267\u884c playbook"},{"location":"dev/plugins/Callback-BlackHole/#ad-hoc","text":"ansible ad-hoc \u547d\u4ee4\u9ed8\u8ba4\u4f7f\u7528 minimal callback\u63d2\u4ef6\uff0c\u5982\u679c\u8981\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684callback\u63d2\u4ef6\u65f6\uff0c\u9700\u8981\u6dfb\u52a0 bin_ansible_callbacks \u53c2\u6570\u624d\u80fd\u4f7f\u7528\u3002 \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0 [defaults] bin_ansible_callbacks = True \u6216\u8005\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u5f00\u542f export ANSIBLE_LOAD_CALLBACK_PLUGINS = 1 # ansible localhost -m ping # ansible localhost -m ping -vvvv ansible 2 .9.6 config file = /etc/ansible/ansible.cfg configured module search path = [ u '/root/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible python version = 2 .7.5 ( default, Aug 7 2019 , 00 :51:29 ) [ GCC 4 .8.5 20150623 ( Red Hat 4 .8.5-39 )] Using /etc/ansible/ansible.cfg as config file setting up inventory plugins host_list declined parsing /etc/ansible/hosts as it did not pass its verify_file () method script declined parsing /etc/ansible/hosts as it did not pass its verify_file () method auto declined parsing /etc/ansible/hosts as it did not pass its verify_file () method Parsed /etc/ansible/hosts inventory source with ini plugin Loading callback plugin BlackHole of type stdout, v2.0 from /etc/ansible/callback_plugins/BlackHole.pyc META: ran handlers Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/ping.py Pipelining is enabled. < 127 .0.0.1> ESTABLISH LOCAL CONNECTION FOR USER: root < 127 .0.0.1> EXEC /bin/sh -c '/usr/bin/python2 && sleep 0' META: ran handlers META: ran handlers ad-hoc \u7684\u6267\u884c\u8f93\u51fa\u4e5f\u6ca1\u4e86\uff0c\u5168\u90e8\u4e22\u5165\u9ed1\u6d1e\u5566\u3002","title":"\u6267\u884c ad-hoc \u547d\u4ee4"},{"location":"dev/plugins/Filter-split/","text":"filter plugins: split \u00b6 \u9700\u6c42 \u00b6 \u5b9e\u73b0python\u7684\u5b57\u7b26\u4e32\u5206\u5272 \u5b9e\u73b0re\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5206\u5272 Filter \u7c7b \u00b6 class FilterModule ( object ): ''' A filter to split a string into a list. ''' def filters ( self ): return { 'filter_name' : filter_function , } \u6240\u6709\u7684filter\u7c7b\u90fd\u662f\u4e0a\u8bc9\u6784\u9020 filter_name \u662f Ansible Jinja2 filter\u7684name\u3002 filter_function(string) \u662f\u5904\u7406\u5b57\u7b26\u7684\u65b9\u6cd5, \u5982 {{ 'test' | filter_name }} \uff0c test\u5b57\u7b26\u4e32\u4f1a\u4f20\u9012\u7ed9string\u3002 \u7f16\u5199\u63d2\u4ef6 \u00b6 # cat filter_plugins/split.py import re def split_string ( string , seperator = None , maxsplit =- 1 ): try : return string . split ( seperator , maxsplit ) except : return list ( string ) def split_regex ( string , seperator_pattern ): try : return re . split ( seperator_pattern , string ) except : return list ( string ) class FilterModule ( object ): ''' A filter to split a string into a list. ''' def filters ( self ): return { 'split' : split_string , 'split_regex' : split_regex , } \u8fd0\u884c playbook \u00b6 # cat split.yml - hosts: localhost gather_facts: no tasks: - debug: msg ={{ 'a b c' | split }} - debug: msg ={{ '1c2c3' | split ( 'c' ) }} - debug: msg ={{ 'dev.example.com' | split_regex ( '\\.' ) }} # ansible-playbook split.yml PLAY [ localhost ] ***************************************************************************************** TASK [ debug ] ***************************************************************************************** ok: [ localhost ] = > { \"msg\" : [ \"a\" , \"b\" , \"c\" ] } TASK [ debug ] ***************************************************************************************** ok: [ localhost ] = > { \"msg\" : [ \"1\" , \"2\" , \"3\" ] } TASK [ debug ] ***************************************************************************************** ok: [ localhost ] = > { \"msg\" : [ \"dev\" , \"example\" , \"com\" ] } PLAY RECAP ***************************************************************************************** localhost : ok = 3 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u8fd0\u884c ad-hoc \u547d\u4ee4 \u00b6 \u6267\u884cad-hoc\u547d\u4ee4\u65f6\uff0c\u9700\u8981\u6307\u5b9a\u63d2\u4ef6\u76ee\u5f55\uff0c\u53ef\u4ee5\u5728 anisble.cfg \u4e2d\u6307\u5b9a\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u73af\u5883\u53d8\u91cf \u5728 ansible.cfg \u4e2d\u6307\u5b9a # cat ansible.cfg [defaults] filter_plugins = /etc/ansible/filter_plugins \u6216\u4f7f\u7528\u73af\u5883\u53d8\u91cf export ANSIBLE_FILTER_PLUGINS = /etc/ansible/filter_plugins \u6267\u884c\u547d\u4ee4 # ansible localhost -m debug -a \"msg={{'a b c' | split }}\" localhost | SUCCESS = > { \"msg\" : [ \"a\" , \"b\" , \"c\" ] }","title":"Filter \u793a\u4f8b: split"},{"location":"dev/plugins/Filter-split/#filter-plugins-split","text":"","title":"filter plugins: split"},{"location":"dev/plugins/Filter-split/#_1","text":"\u5b9e\u73b0python\u7684\u5b57\u7b26\u4e32\u5206\u5272 \u5b9e\u73b0re\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5206\u5272","title":"\u9700\u6c42"},{"location":"dev/plugins/Filter-split/#filter","text":"class FilterModule ( object ): ''' A filter to split a string into a list. ''' def filters ( self ): return { 'filter_name' : filter_function , } \u6240\u6709\u7684filter\u7c7b\u90fd\u662f\u4e0a\u8bc9\u6784\u9020 filter_name \u662f Ansible Jinja2 filter\u7684name\u3002 filter_function(string) \u662f\u5904\u7406\u5b57\u7b26\u7684\u65b9\u6cd5, \u5982 {{ 'test' | filter_name }} \uff0c test\u5b57\u7b26\u4e32\u4f1a\u4f20\u9012\u7ed9string\u3002","title":"Filter \u7c7b"},{"location":"dev/plugins/Filter-split/#_2","text":"# cat filter_plugins/split.py import re def split_string ( string , seperator = None , maxsplit =- 1 ): try : return string . split ( seperator , maxsplit ) except : return list ( string ) def split_regex ( string , seperator_pattern ): try : return re . split ( seperator_pattern , string ) except : return list ( string ) class FilterModule ( object ): ''' A filter to split a string into a list. ''' def filters ( self ): return { 'split' : split_string , 'split_regex' : split_regex , }","title":"\u7f16\u5199\u63d2\u4ef6"},{"location":"dev/plugins/Filter-split/#playbook","text":"# cat split.yml - hosts: localhost gather_facts: no tasks: - debug: msg ={{ 'a b c' | split }} - debug: msg ={{ '1c2c3' | split ( 'c' ) }} - debug: msg ={{ 'dev.example.com' | split_regex ( '\\.' ) }} # ansible-playbook split.yml PLAY [ localhost ] ***************************************************************************************** TASK [ debug ] ***************************************************************************************** ok: [ localhost ] = > { \"msg\" : [ \"a\" , \"b\" , \"c\" ] } TASK [ debug ] ***************************************************************************************** ok: [ localhost ] = > { \"msg\" : [ \"1\" , \"2\" , \"3\" ] } TASK [ debug ] ***************************************************************************************** ok: [ localhost ] = > { \"msg\" : [ \"dev\" , \"example\" , \"com\" ] } PLAY RECAP ***************************************************************************************** localhost : ok = 3 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0","title":"\u8fd0\u884c playbook"},{"location":"dev/plugins/Filter-split/#ad-hoc","text":"\u6267\u884cad-hoc\u547d\u4ee4\u65f6\uff0c\u9700\u8981\u6307\u5b9a\u63d2\u4ef6\u76ee\u5f55\uff0c\u53ef\u4ee5\u5728 anisble.cfg \u4e2d\u6307\u5b9a\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u73af\u5883\u53d8\u91cf \u5728 ansible.cfg \u4e2d\u6307\u5b9a # cat ansible.cfg [defaults] filter_plugins = /etc/ansible/filter_plugins \u6216\u4f7f\u7528\u73af\u5883\u53d8\u91cf export ANSIBLE_FILTER_PLUGINS = /etc/ansible/filter_plugins \u6267\u884c\u547d\u4ee4 # ansible localhost -m debug -a \"msg={{'a b c' | split }}\" localhost | SUCCESS = > { \"msg\" : [ \"a\" , \"b\" , \"c\" ] }","title":"\u8fd0\u884c ad-hoc \u547d\u4ee4"},{"location":"dev/plugins/Inventory-csv/","text":"inventory plugins: my_csv_plugin \u00b6 \u9700\u6c42 \u00b6 \u4f7f\u7528 csv \u6587\u4ef6\u4f5c\u4e3a\u52a8\u6001\u4e3b\u673a\u6e90\uff0c\u4e3aansible\u63d0\u4f9b\u52a8\u6001\u4e3b\u673a\u652f\u6301 csv\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b: Hostname,IP,Location,Type,OS i_nginx01,10.1.1.1,IDC,Gateway,Ubuntu i_web01,10.1.1.2,IDC,Service,Centos i_web02,10.1.1.3,IDC,Service,Centos a_nginx01,10.2.1.1,Aliyun,Gateway,Ubuntu a_web01,10.2.1.2,Aliyun,Service,Centos a_web02,10.2.1.3,Aliyun,Service,Centos \u7f16\u5199\u63d2\u4ef6 \u00b6 \u7f16\u5199\u81ea\u5b9a\u4e49\u6e05\u5355\u63d2\u4ef6\u5206\u4e3a\u4e24\u90e8\u5206\uff1a \u4e00\u4e2aYAML\u6587\u4ef6\uff0c\u5176\u4e2d\u63cf\u8ff0\u4e86\u4f7f\u7528\u54ea\u4e2a\u63d2\u4ef6\uff0c\u4ee5\u53ca\u63d2\u4ef6\u7684\u53c2\u6570 # csv_inventory.yaml --- plugin : my_csv_plugin # \u63d2\u4ef6\u540d\u79f0 path_to_inventory : csv_inventory # csv\u6587\u4ef6\u76ee\u5f55 csv_file : myinventory.csv # csv\u6587\u4ef6\u540d\u79f0 Python\u63d2\u4ef6\u6587\u4ef6\uff0cansible\u8981\u6c42\u63d2\u4ef6\u5fc5\u987b\u4f7f\u7528python\u8bed\u8a00\u7f16\u5199 #my_csv_plugin.py from __future__ import ( absolute_import , division , print_function ) __metaclass__ = type DOCUMENTATION = r ''' name: my_csv_plugin plugin_type: inventory short_description: Returns Ansible inventory from CSV description: Returns Ansible inventory from CSV options: plugin: description: Name of the plugin required: true choices: ['my_csv_plugin'] path_to_inventory: description: Directory location of the CSV inventory required: true csv_file: description: File name of the CSV inventory file required: true ''' from ansible.plugins.inventory import BaseInventoryPlugin from ansible.errors import AnsibleError , AnsibleParserError class InventoryModule ( BaseInventoryPlugin ): NAME = 'my_csv_plugin' def verify_file ( self , path ): '''\u9a8c\u8bc1yaml\u6587\u4ef6\u540d\u79f0\uff0c\u53ea\u6709\u7b26\u5408\u7684\u6587\u4ef6\u624d\u4f1a\u88ab\u89e3\u6790''' pass def parse ( self , inventory , loader , path , cache ): '''\u4ece\u6570\u636e\u6e90\u8fd4\u56de\u52a8\u6001\u4e3b\u673a\u4fe1\u606f ''' pass \u6ce8\u610f\u4e8b\u9879 DOCUMENTATION \u662f\u63d2\u4ef6\u7684\u5fc5\u987b\u90e8\u5206\uff0c\u5176\u4e2d\u63cf\u8ff0\u4e86\u63d2\u4ef6\u7684\u4fe1\u606f\u548c\u9009\u9879\uff0c\u8fd9\u91cc\u7684\u9009\u9879\u8ddf csv_inventory.yaml \u6587\u4ef6\u4e2d\u7684\u9009\u9879\u662f\u4e00\u81f4\u7684\u3002 \u63d2\u4ef6\u7684\u540d\u79f0 NAME \u8981\u4e0e\u811a\u672c\u6587\u4ef6\u7684\u540d\u79f0(\u53bb\u9664 .py \u540e\u7f00)\u4e00\u81f4 \u5b9e\u73b0 verify_file \u65b9\u6cd5 \u00b6 \u5728\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\uff0c\u9a8c\u8bc1 YAML \u6587\u4ef6\u540d\u79f0\u7684\u5408\u6cd5\u6027,\u4e5f\u5c31\u662f\u53ea\u6709\u6307\u5b9a\u7684YAML\u6587\u4ef6\u540d\u79f0\u624d\u80fd\u88ab\u63d2\u4ef6\u89e3\u6790 # Update the verify_file method def verify_file ( self, path ) : '''Return true/false if this is a valid file for this plugin to consume ''' valid = False if super ( InventoryModule, self ) .verify_file ( path ) : #base class verifies that file exists #and is readable by current user if path.endswith (( 'csv_inventory.yaml' , 'csv_inventory.yml' )) : valid = True return valid \u5b9e\u73b0 parse \u65b9\u6cd5 \u00b6 \u5728\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\uff0c\u6211\u4eec\u8981\u89e3\u6790 YAML \u6587\u4ef6\u4e2d\u7684\u9009\u9879\uff0c\u6839\u636e\u9009\u9879\u83b7\u53d6\u52a8\u6001\u4e3b\u673a\u6e90\u6570\u636e\uff0c\u7136\u540e\u89e3\u6790\u6210\u56fa\u5b9a\u7684\u7ed3\u6784\u4f53\u8fd4\u56de \u89e3\u6790yaml\u6587\u4ef6 def parse ( self , inventory , loader , path , cache ): '''Return dynamic inventory from source ''' super ( InventoryModule , self ) . parse ( inventory , loader , path , cache ) # Read the inventory YAML file self . _read_config_data ( path ) try : # Store the options from the YAML file self . plugin = self . get_option ( 'plugin' ) self . inv_dir = self . get_option ( 'path_to_inventory' ) self . inv_file = self . get_option ( 'csv_file' ) except Exception as e : raise AnsibleParserError ( 'All correct options required: {} ' . format ( e )) # Call our internal helper to populate the dynamic inventory self . _populate () \u4f7f\u7528 self._populate() \u6784\u5efa\u52a8\u6001\u4e3b\u673a \u5c06csv\u6587\u4ef6\u8f6c\u4e3ajson\u7ed3\u6784\u4f53 def _get_structured_inventory ( self , inventory_file ): #Initialize a dict inventory_data = {} #Read the CSV and add it to the dictionary try : with open ( inventory_file , 'r' ) as fh : csvdict = csv . DictReader ( fh ) for rows in csvdict : hostname = rows [ 'Hostname' ] inventory_data [ hostname ] = rows except Exception as e : raise AnsibleParserError ( 'Parsing file error: {} ' . format ( e )) return inventory_data def _populate ( self ): '''Return the hosts and groups''' self . inventory_file = self . inv_dir + '/' + self . inv_file self . myinventory = self . _get_structured_inventory ( self . inventory_file ) \u6dfb\u52a0\u4e3b\u673a\u7ec4 \u7ee7\u7eed\u5728 _populate(self) \u51fd\u6570\u4e2d\u64cd\u4f5c\uff0c\u8fd9\u91cc\u6211\u4eec\u589e\u52a0\u4e863\u4e2a\u7c7b\u522b\u7684\u4e3b\u673a\u7ec4 def _populate ( self ): '''Return the hosts and groups''' self . inventory_file = self . inv_dir + '/' + self . inv_file self . myinventory = self . _get_structured_inventory ( self . inventory_file ) #Create the location, type and os groups locations = [] types = [] oss = [] for data in self . myinventory . values (): if not data [ 'Location' ] in locations : locations . append ( data [ 'Location' ]) if not data [ 'Type' ] in types : types . append ( data [ 'Type' ]) if not data [ 'OS' ] in oss : oss . append ( data [ 'OS' ]) for location in locations : self . inventory . add_group ( location ) for type in types : self . inventory . add_group ( type ) for os in oss : self . inventory . add_group ( os ) #Add the hosts to the groups for hostname , data in self . myinventory . items (): self . inventory . add_host ( host = hostname , group = data [ 'Location' ]) self . inventory . add_host ( host = hostname , group = data [ 'Type' ]) self . inventory . add_host ( host = hostname , group = data [ 'OS' ]) \u6dfb\u52a0\u4e3b\u673a\u53d8\u91cf def _populate ( self ): '''Return the hosts and groups''' self . inventory_file = self . inv_dir + '/' + self . inv_file self . myinventory = self . _get_structured_inventory ( self . inventory_file ) #Create the location, type and os groups locations = [] types = [] oss = [] for data in self . myinventory . values (): if not data [ 'Location' ] in locations : locations . append ( data [ 'Location' ]) if not data [ 'Type' ] in types : types . append ( data [ 'Type' ]) if not data [ 'OS' ] in oss : oss . append ( data [ 'OS' ]) for location in locations : self . inventory . add_group ( location ) for type in types : self . inventory . add_group ( type ) for os in oss : self . inventory . add_group ( os ) #Add the hosts to the groups for hostname , data in self . myinventory . items (): self . inventory . add_host ( host = hostname , group = data [ 'Location' ]) self . inventory . add_host ( host = hostname , group = data [ 'Type' ]) self . inventory . add_host ( host = hostname , group = data [ 'OS' ]) self . inventory . set_variable ( hostname , 'ansible_host' , data [ 'IP' ]) self . inventory . set_variable ( hostname , 'ansible_os' , data [ 'OS' ]) \u811a\u672c\u793a\u4f8b \u00b6 my_csv_plugin.py from __future__ import ( absolute_import , division , print_function ) __metaclass__ = type DOCUMENTATION = r ''' name: my_csv_plugin plugin_type: inventory short_description: Returns Ansible inventory from CSV description: Returns Ansible inventory from CSV options: plugin: description: Name of the plugin required: true choices: ['my_csv_plugin'] path_to_inventory: description: Directory location of the CSV inventory required: true csv_file: description: File name of the CSV inventory file required: true ''' from ansible.plugins.inventory import BaseInventoryPlugin from ansible.errors import AnsibleError , AnsibleParserError import csv class InventoryModule ( BaseInventoryPlugin ): NAME = 'my_csv_plugin' def verify_file ( self , path ): '''Return true/false if this is possibly a valid file for this plugin to consume ''' valid = False if super ( InventoryModule , self ) . verify_file ( path ): # base class verifies that file exists and is readable by current # user if path . endswith (( 'csv_inventory.yaml' , 'csv_inventory.yml' )): valid = True return valid def _get_structured_inventory ( self , inventory_file ): #Initialize a dict inventory_data = {} #Read the CSV and add it to the dictionary try : with open ( inventory_file , 'r' ) as fh : csvdict = csv . DictReader ( fh ) for rows in csvdict : hostname = rows [ 'Hostname' ] inventory_data [ hostname ] = rows except Exception as e : raise AnsibleParserError ( 'Parsing file error: {} ' . format ( e )) return inventory_data def _populate ( self ): '''Return the hosts and groups''' self . inventory_file = self . inv_dir + '/' + self . inv_file self . myinventory = self . _get_structured_inventory ( self . inventory_file ) #Create the location, type and os groups locations = [] types = [] oss = [] for data in self . myinventory . values (): if not data [ 'Location' ] in locations : locations . append ( data [ 'Location' ]) if not data [ 'Type' ] in types : types . append ( data [ 'Type' ]) if not data [ 'OS' ] in oss : oss . append ( data [ 'OS' ]) for location in locations : self . inventory . add_group ( location ) for type in types : self . inventory . add_group ( type ) for os in oss : self . inventory . add_group ( os ) #Add the hosts to the groups for hostname , data in self . myinventory . items (): self . inventory . add_host ( host = hostname , group = data [ 'Location' ]) self . inventory . add_host ( host = hostname , group = data [ 'Type' ]) self . inventory . add_host ( host = hostname , group = data [ 'OS' ]) self . inventory . set_variable ( hostname , 'ansible_host' , data [ 'IP' ]) self . inventory . set_variable ( hostname , 'ansible_os' , data [ 'OS' ]) def parse ( self , inventory , loader , path , cache ): '''Return dynamic inventory from source ''' super ( InventoryModule , self ) . parse ( inventory , loader , path , cache ) # Read the inventory YAML file self . _read_config_data ( path ) try : # Store the options from the YAML file self . plugin = self . get_option ( 'plugin' ) self . inv_dir = self . get_option ( 'path_to_inventory' ) self . inv_file = self . get_option ( 'csv_file' ) except Exception as e : raise AnsibleParserError ( 'All correct options required: {} ' . format ( e )) # Call our internal helper to populate the dynamic inventory self . _populate () \u914d\u7f6e ansible.cfg \u00b6 [defaults] inventory_plugins = /etc/ansible/plugins/inventory # \u5b58\u50a8\u63d2\u4ef6\u7684\u76ee\u5f55 [inventory] enable_plugins = host_list, script, yaml, ini, toml, my_csv_plugin # \u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684\u63d2\u4ef6 host_list, script, yaml, ini, toml \u8fd9\u4e9b\u90fd\u662fansible\u9ed8\u8ba4\u7684\u63d2\u4ef6 \u5f53\u524d\u7684\u76ee\u5f55\u7ed3\u6784 # tree . . \u251c\u2500\u2500 ansible.cfg \u251c\u2500\u2500 csv_inventory \u2502 \u2514\u2500\u2500 myinventory.csv \u251c\u2500\u2500 hosts \u251c\u2500\u2500 plugins \u2502 \u2514\u2500\u2500 inventory \u2502 \u2514\u2500\u2500 my_csv_plugin.py \u2514\u2500\u2500 csv_inventory.yaml \u67e5\u770b\u4e3b\u673a\u4fe1\u606f \u00b6 \u901a\u8fc7 ansible-inventory \u53ef\u4ee5\u67e5\u770b\u52a8\u6001\u4e3b\u673a\u7684\u4fe1\u606f \u4ee5\u56fe\u8868\u7684\u5f62\u5f0f\u8fd4\u56de\u4e3b\u673a\u4fe1\u606f # ansible-inventory -i csv_inventory.yaml --graph @all: | --@Aliyun: | | --a_nginx01 | | --a_web01 | | --a_web02 | --@Centos: | | --a_web01 | | --a_web02 | | --i_web01 | | --i_web02 | --@Gateway: | | --a_nginx01 | | --i_nginx01 | --@IDC: | | --i_nginx01 | | --i_web01 | | --i_web02 | --@Service: | | --a_web01 | | --a_web02 | | --i_web01 | | --i_web02 | --@Ubuntu: | | --a_nginx01 | | --i_nginx01 | --@ungrouped: \u4ee5json\u7ed3\u6784\u7684\u5f62\u5f0f\u8fd4\u56de # ansible-inventory -i csv_inventory.yaml --list { \"Aliyun\" : { \"hosts\" : [ \"a_nginx01\" , \"a_web01\" , \"a_web02\" ] } , \"Centos\" : { \"hosts\" : [ \"a_web01\" , \"a_web02\" , \"i_web01\" , \"i_web02\" ] } , \"Gateway\" : { \"hosts\" : [ \"a_nginx01\" , \"i_nginx01\" ] } , \"IDC\" : { \"hosts\" : [ \"i_nginx01\" , \"i_web01\" , \"i_web02\" ] } , \"Service\" : { \"hosts\" : [ \"a_web01\" , \"a_web02\" , \"i_web01\" , \"i_web02\" ] } , \"Ubuntu\" : { \"hosts\" : [ \"a_nginx01\" , \"i_nginx01\" ] } , \"_meta\" : { \"hostvars\" : { \"a_nginx01\" : { \"ansible_host\" : \"10.2.1.1\" , \"ansible_os\" : \"Ubuntu\" } , \"a_web01\" : { \"ansible_host\" : \"10.2.1.2\" , \"ansible_os\" : \"Centos\" } , \"a_web02\" : { \"ansible_host\" : \"10.2.1.3\" , \"ansible_os\" : \"Centos\" } , \"i_nginx01\" : { \"ansible_host\" : \"10.1.1.1\" , \"ansible_os\" : \"Ubuntu\" } , \"i_web01\" : { \"ansible_host\" : \"10.1.1.2\" , \"ansible_os\" : \"Centos\" } , \"i_web02\" : { \"ansible_host\" : \"10.1.1.3\" , \"ansible_os\" : \"Centos\" } } } , \"all\" : { \"children\" : [ \"Aliyun\" , \"Centos\" , \"Gateway\" , \"IDC\" , \"Service\" , \"Ubuntu\" , \"ungrouped\" ] } } \u8fd4\u56de\u7684\u6570\u636e\u662f\u4e0d\u662f\u8ddf\u811a\u672c\u4e00\u81f4\u3002 \u6267\u884c ad-hoc \u547d\u4ee4 \u00b6 # ansible -i csv_inventory.yaml all --list-hosts hosts ( 6 ) : i_web01 i_web02 a_web01 a_web02 i_nginx01 a_nginx01 # ansible -i csv_inventory.yaml all -m ping i_web02 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } i_nginx01 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } i_web01 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } a_web02 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } a_web01 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } a_nginx01 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } \u6267\u884c playbook \u00b6 cat /etc/ansible/test.yml --- - hosts: all gather_facts: no tasks: - name: display var debug: msg: \"The mgmt IP is {{ ansible_host }} and platorm is {{ ansible_os }}\" # ansible-playbook -i csv_inventory.yaml test.yml PLAY [ all ] ***************************************************************************************** TASK [ display var ] ***************************************************************************************** ok: [ i_web01 ] = > { \"msg\" : \"The mgmt IP is 10.1.1.2 and platorm is Centos\" } ok: [ i_web02 ] = > { \"msg\" : \"The mgmt IP is 10.1.1.3 and platorm is Centos\" } ok: [ a_web01 ] = > { \"msg\" : \"The mgmt IP is 10.2.1.2 and platorm is Centos\" } ok: [ a_web02 ] = > { \"msg\" : \"The mgmt IP is 10.2.1.3 and platorm is Centos\" } ok: [ i_nginx01 ] = > { \"msg\" : \"The mgmt IP is 10.1.1.1 and platorm is Ubuntu\" } ok: [ a_nginx01 ] = > { \"msg\" : \"The mgmt IP is 10.2.1.1 and platorm is Ubuntu\" } PLAY RECAP ***************************************************************************************** a_nginx01 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 a_web01 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 a_web02 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 i_nginx01 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 i_web01 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 i_web02 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0","title":"Inventory \u793a\u4f8b: csv"},{"location":"dev/plugins/Inventory-csv/#inventory-plugins-my_csv_plugin","text":"","title":"inventory plugins: my_csv_plugin"},{"location":"dev/plugins/Inventory-csv/#_1","text":"\u4f7f\u7528 csv \u6587\u4ef6\u4f5c\u4e3a\u52a8\u6001\u4e3b\u673a\u6e90\uff0c\u4e3aansible\u63d0\u4f9b\u52a8\u6001\u4e3b\u673a\u652f\u6301 csv\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b: Hostname,IP,Location,Type,OS i_nginx01,10.1.1.1,IDC,Gateway,Ubuntu i_web01,10.1.1.2,IDC,Service,Centos i_web02,10.1.1.3,IDC,Service,Centos a_nginx01,10.2.1.1,Aliyun,Gateway,Ubuntu a_web01,10.2.1.2,Aliyun,Service,Centos a_web02,10.2.1.3,Aliyun,Service,Centos","title":"\u9700\u6c42"},{"location":"dev/plugins/Inventory-csv/#_2","text":"\u7f16\u5199\u81ea\u5b9a\u4e49\u6e05\u5355\u63d2\u4ef6\u5206\u4e3a\u4e24\u90e8\u5206\uff1a \u4e00\u4e2aYAML\u6587\u4ef6\uff0c\u5176\u4e2d\u63cf\u8ff0\u4e86\u4f7f\u7528\u54ea\u4e2a\u63d2\u4ef6\uff0c\u4ee5\u53ca\u63d2\u4ef6\u7684\u53c2\u6570 # csv_inventory.yaml --- plugin : my_csv_plugin # \u63d2\u4ef6\u540d\u79f0 path_to_inventory : csv_inventory # csv\u6587\u4ef6\u76ee\u5f55 csv_file : myinventory.csv # csv\u6587\u4ef6\u540d\u79f0 Python\u63d2\u4ef6\u6587\u4ef6\uff0cansible\u8981\u6c42\u63d2\u4ef6\u5fc5\u987b\u4f7f\u7528python\u8bed\u8a00\u7f16\u5199 #my_csv_plugin.py from __future__ import ( absolute_import , division , print_function ) __metaclass__ = type DOCUMENTATION = r ''' name: my_csv_plugin plugin_type: inventory short_description: Returns Ansible inventory from CSV description: Returns Ansible inventory from CSV options: plugin: description: Name of the plugin required: true choices: ['my_csv_plugin'] path_to_inventory: description: Directory location of the CSV inventory required: true csv_file: description: File name of the CSV inventory file required: true ''' from ansible.plugins.inventory import BaseInventoryPlugin from ansible.errors import AnsibleError , AnsibleParserError class InventoryModule ( BaseInventoryPlugin ): NAME = 'my_csv_plugin' def verify_file ( self , path ): '''\u9a8c\u8bc1yaml\u6587\u4ef6\u540d\u79f0\uff0c\u53ea\u6709\u7b26\u5408\u7684\u6587\u4ef6\u624d\u4f1a\u88ab\u89e3\u6790''' pass def parse ( self , inventory , loader , path , cache ): '''\u4ece\u6570\u636e\u6e90\u8fd4\u56de\u52a8\u6001\u4e3b\u673a\u4fe1\u606f ''' pass \u6ce8\u610f\u4e8b\u9879 DOCUMENTATION \u662f\u63d2\u4ef6\u7684\u5fc5\u987b\u90e8\u5206\uff0c\u5176\u4e2d\u63cf\u8ff0\u4e86\u63d2\u4ef6\u7684\u4fe1\u606f\u548c\u9009\u9879\uff0c\u8fd9\u91cc\u7684\u9009\u9879\u8ddf csv_inventory.yaml \u6587\u4ef6\u4e2d\u7684\u9009\u9879\u662f\u4e00\u81f4\u7684\u3002 \u63d2\u4ef6\u7684\u540d\u79f0 NAME \u8981\u4e0e\u811a\u672c\u6587\u4ef6\u7684\u540d\u79f0(\u53bb\u9664 .py \u540e\u7f00)\u4e00\u81f4","title":"\u7f16\u5199\u63d2\u4ef6"},{"location":"dev/plugins/Inventory-csv/#verify_file","text":"\u5728\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\uff0c\u9a8c\u8bc1 YAML \u6587\u4ef6\u540d\u79f0\u7684\u5408\u6cd5\u6027,\u4e5f\u5c31\u662f\u53ea\u6709\u6307\u5b9a\u7684YAML\u6587\u4ef6\u540d\u79f0\u624d\u80fd\u88ab\u63d2\u4ef6\u89e3\u6790 # Update the verify_file method def verify_file ( self, path ) : '''Return true/false if this is a valid file for this plugin to consume ''' valid = False if super ( InventoryModule, self ) .verify_file ( path ) : #base class verifies that file exists #and is readable by current user if path.endswith (( 'csv_inventory.yaml' , 'csv_inventory.yml' )) : valid = True return valid","title":"\u5b9e\u73b0verify_file\u65b9\u6cd5"},{"location":"dev/plugins/Inventory-csv/#parse","text":"\u5728\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\uff0c\u6211\u4eec\u8981\u89e3\u6790 YAML \u6587\u4ef6\u4e2d\u7684\u9009\u9879\uff0c\u6839\u636e\u9009\u9879\u83b7\u53d6\u52a8\u6001\u4e3b\u673a\u6e90\u6570\u636e\uff0c\u7136\u540e\u89e3\u6790\u6210\u56fa\u5b9a\u7684\u7ed3\u6784\u4f53\u8fd4\u56de \u89e3\u6790yaml\u6587\u4ef6 def parse ( self , inventory , loader , path , cache ): '''Return dynamic inventory from source ''' super ( InventoryModule , self ) . parse ( inventory , loader , path , cache ) # Read the inventory YAML file self . _read_config_data ( path ) try : # Store the options from the YAML file self . plugin = self . get_option ( 'plugin' ) self . inv_dir = self . get_option ( 'path_to_inventory' ) self . inv_file = self . get_option ( 'csv_file' ) except Exception as e : raise AnsibleParserError ( 'All correct options required: {} ' . format ( e )) # Call our internal helper to populate the dynamic inventory self . _populate () \u4f7f\u7528 self._populate() \u6784\u5efa\u52a8\u6001\u4e3b\u673a \u5c06csv\u6587\u4ef6\u8f6c\u4e3ajson\u7ed3\u6784\u4f53 def _get_structured_inventory ( self , inventory_file ): #Initialize a dict inventory_data = {} #Read the CSV and add it to the dictionary try : with open ( inventory_file , 'r' ) as fh : csvdict = csv . DictReader ( fh ) for rows in csvdict : hostname = rows [ 'Hostname' ] inventory_data [ hostname ] = rows except Exception as e : raise AnsibleParserError ( 'Parsing file error: {} ' . format ( e )) return inventory_data def _populate ( self ): '''Return the hosts and groups''' self . inventory_file = self . inv_dir + '/' + self . inv_file self . myinventory = self . _get_structured_inventory ( self . inventory_file ) \u6dfb\u52a0\u4e3b\u673a\u7ec4 \u7ee7\u7eed\u5728 _populate(self) \u51fd\u6570\u4e2d\u64cd\u4f5c\uff0c\u8fd9\u91cc\u6211\u4eec\u589e\u52a0\u4e863\u4e2a\u7c7b\u522b\u7684\u4e3b\u673a\u7ec4 def _populate ( self ): '''Return the hosts and groups''' self . inventory_file = self . inv_dir + '/' + self . inv_file self . myinventory = self . _get_structured_inventory ( self . inventory_file ) #Create the location, type and os groups locations = [] types = [] oss = [] for data in self . myinventory . values (): if not data [ 'Location' ] in locations : locations . append ( data [ 'Location' ]) if not data [ 'Type' ] in types : types . append ( data [ 'Type' ]) if not data [ 'OS' ] in oss : oss . append ( data [ 'OS' ]) for location in locations : self . inventory . add_group ( location ) for type in types : self . inventory . add_group ( type ) for os in oss : self . inventory . add_group ( os ) #Add the hosts to the groups for hostname , data in self . myinventory . items (): self . inventory . add_host ( host = hostname , group = data [ 'Location' ]) self . inventory . add_host ( host = hostname , group = data [ 'Type' ]) self . inventory . add_host ( host = hostname , group = data [ 'OS' ]) \u6dfb\u52a0\u4e3b\u673a\u53d8\u91cf def _populate ( self ): '''Return the hosts and groups''' self . inventory_file = self . inv_dir + '/' + self . inv_file self . myinventory = self . _get_structured_inventory ( self . inventory_file ) #Create the location, type and os groups locations = [] types = [] oss = [] for data in self . myinventory . values (): if not data [ 'Location' ] in locations : locations . append ( data [ 'Location' ]) if not data [ 'Type' ] in types : types . append ( data [ 'Type' ]) if not data [ 'OS' ] in oss : oss . append ( data [ 'OS' ]) for location in locations : self . inventory . add_group ( location ) for type in types : self . inventory . add_group ( type ) for os in oss : self . inventory . add_group ( os ) #Add the hosts to the groups for hostname , data in self . myinventory . items (): self . inventory . add_host ( host = hostname , group = data [ 'Location' ]) self . inventory . add_host ( host = hostname , group = data [ 'Type' ]) self . inventory . add_host ( host = hostname , group = data [ 'OS' ]) self . inventory . set_variable ( hostname , 'ansible_host' , data [ 'IP' ]) self . inventory . set_variable ( hostname , 'ansible_os' , data [ 'OS' ])","title":"\u5b9e\u73b0parse\u65b9\u6cd5"},{"location":"dev/plugins/Inventory-csv/#_3","text":"my_csv_plugin.py from __future__ import ( absolute_import , division , print_function ) __metaclass__ = type DOCUMENTATION = r ''' name: my_csv_plugin plugin_type: inventory short_description: Returns Ansible inventory from CSV description: Returns Ansible inventory from CSV options: plugin: description: Name of the plugin required: true choices: ['my_csv_plugin'] path_to_inventory: description: Directory location of the CSV inventory required: true csv_file: description: File name of the CSV inventory file required: true ''' from ansible.plugins.inventory import BaseInventoryPlugin from ansible.errors import AnsibleError , AnsibleParserError import csv class InventoryModule ( BaseInventoryPlugin ): NAME = 'my_csv_plugin' def verify_file ( self , path ): '''Return true/false if this is possibly a valid file for this plugin to consume ''' valid = False if super ( InventoryModule , self ) . verify_file ( path ): # base class verifies that file exists and is readable by current # user if path . endswith (( 'csv_inventory.yaml' , 'csv_inventory.yml' )): valid = True return valid def _get_structured_inventory ( self , inventory_file ): #Initialize a dict inventory_data = {} #Read the CSV and add it to the dictionary try : with open ( inventory_file , 'r' ) as fh : csvdict = csv . DictReader ( fh ) for rows in csvdict : hostname = rows [ 'Hostname' ] inventory_data [ hostname ] = rows except Exception as e : raise AnsibleParserError ( 'Parsing file error: {} ' . format ( e )) return inventory_data def _populate ( self ): '''Return the hosts and groups''' self . inventory_file = self . inv_dir + '/' + self . inv_file self . myinventory = self . _get_structured_inventory ( self . inventory_file ) #Create the location, type and os groups locations = [] types = [] oss = [] for data in self . myinventory . values (): if not data [ 'Location' ] in locations : locations . append ( data [ 'Location' ]) if not data [ 'Type' ] in types : types . append ( data [ 'Type' ]) if not data [ 'OS' ] in oss : oss . append ( data [ 'OS' ]) for location in locations : self . inventory . add_group ( location ) for type in types : self . inventory . add_group ( type ) for os in oss : self . inventory . add_group ( os ) #Add the hosts to the groups for hostname , data in self . myinventory . items (): self . inventory . add_host ( host = hostname , group = data [ 'Location' ]) self . inventory . add_host ( host = hostname , group = data [ 'Type' ]) self . inventory . add_host ( host = hostname , group = data [ 'OS' ]) self . inventory . set_variable ( hostname , 'ansible_host' , data [ 'IP' ]) self . inventory . set_variable ( hostname , 'ansible_os' , data [ 'OS' ]) def parse ( self , inventory , loader , path , cache ): '''Return dynamic inventory from source ''' super ( InventoryModule , self ) . parse ( inventory , loader , path , cache ) # Read the inventory YAML file self . _read_config_data ( path ) try : # Store the options from the YAML file self . plugin = self . get_option ( 'plugin' ) self . inv_dir = self . get_option ( 'path_to_inventory' ) self . inv_file = self . get_option ( 'csv_file' ) except Exception as e : raise AnsibleParserError ( 'All correct options required: {} ' . format ( e )) # Call our internal helper to populate the dynamic inventory self . _populate ()","title":"\u811a\u672c\u793a\u4f8b"},{"location":"dev/plugins/Inventory-csv/#ansiblecfg","text":"[defaults] inventory_plugins = /etc/ansible/plugins/inventory # \u5b58\u50a8\u63d2\u4ef6\u7684\u76ee\u5f55 [inventory] enable_plugins = host_list, script, yaml, ini, toml, my_csv_plugin # \u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684\u63d2\u4ef6 host_list, script, yaml, ini, toml \u8fd9\u4e9b\u90fd\u662fansible\u9ed8\u8ba4\u7684\u63d2\u4ef6 \u5f53\u524d\u7684\u76ee\u5f55\u7ed3\u6784 # tree . . \u251c\u2500\u2500 ansible.cfg \u251c\u2500\u2500 csv_inventory \u2502 \u2514\u2500\u2500 myinventory.csv \u251c\u2500\u2500 hosts \u251c\u2500\u2500 plugins \u2502 \u2514\u2500\u2500 inventory \u2502 \u2514\u2500\u2500 my_csv_plugin.py \u2514\u2500\u2500 csv_inventory.yaml","title":"\u914d\u7f6e ansible.cfg"},{"location":"dev/plugins/Inventory-csv/#_4","text":"\u901a\u8fc7 ansible-inventory \u53ef\u4ee5\u67e5\u770b\u52a8\u6001\u4e3b\u673a\u7684\u4fe1\u606f \u4ee5\u56fe\u8868\u7684\u5f62\u5f0f\u8fd4\u56de\u4e3b\u673a\u4fe1\u606f # ansible-inventory -i csv_inventory.yaml --graph @all: | --@Aliyun: | | --a_nginx01 | | --a_web01 | | --a_web02 | --@Centos: | | --a_web01 | | --a_web02 | | --i_web01 | | --i_web02 | --@Gateway: | | --a_nginx01 | | --i_nginx01 | --@IDC: | | --i_nginx01 | | --i_web01 | | --i_web02 | --@Service: | | --a_web01 | | --a_web02 | | --i_web01 | | --i_web02 | --@Ubuntu: | | --a_nginx01 | | --i_nginx01 | --@ungrouped: \u4ee5json\u7ed3\u6784\u7684\u5f62\u5f0f\u8fd4\u56de # ansible-inventory -i csv_inventory.yaml --list { \"Aliyun\" : { \"hosts\" : [ \"a_nginx01\" , \"a_web01\" , \"a_web02\" ] } , \"Centos\" : { \"hosts\" : [ \"a_web01\" , \"a_web02\" , \"i_web01\" , \"i_web02\" ] } , \"Gateway\" : { \"hosts\" : [ \"a_nginx01\" , \"i_nginx01\" ] } , \"IDC\" : { \"hosts\" : [ \"i_nginx01\" , \"i_web01\" , \"i_web02\" ] } , \"Service\" : { \"hosts\" : [ \"a_web01\" , \"a_web02\" , \"i_web01\" , \"i_web02\" ] } , \"Ubuntu\" : { \"hosts\" : [ \"a_nginx01\" , \"i_nginx01\" ] } , \"_meta\" : { \"hostvars\" : { \"a_nginx01\" : { \"ansible_host\" : \"10.2.1.1\" , \"ansible_os\" : \"Ubuntu\" } , \"a_web01\" : { \"ansible_host\" : \"10.2.1.2\" , \"ansible_os\" : \"Centos\" } , \"a_web02\" : { \"ansible_host\" : \"10.2.1.3\" , \"ansible_os\" : \"Centos\" } , \"i_nginx01\" : { \"ansible_host\" : \"10.1.1.1\" , \"ansible_os\" : \"Ubuntu\" } , \"i_web01\" : { \"ansible_host\" : \"10.1.1.2\" , \"ansible_os\" : \"Centos\" } , \"i_web02\" : { \"ansible_host\" : \"10.1.1.3\" , \"ansible_os\" : \"Centos\" } } } , \"all\" : { \"children\" : [ \"Aliyun\" , \"Centos\" , \"Gateway\" , \"IDC\" , \"Service\" , \"Ubuntu\" , \"ungrouped\" ] } } \u8fd4\u56de\u7684\u6570\u636e\u662f\u4e0d\u662f\u8ddf\u811a\u672c\u4e00\u81f4\u3002","title":"\u67e5\u770b\u4e3b\u673a\u4fe1\u606f"},{"location":"dev/plugins/Inventory-csv/#ad-hoc","text":"# ansible -i csv_inventory.yaml all --list-hosts hosts ( 6 ) : i_web01 i_web02 a_web01 a_web02 i_nginx01 a_nginx01 # ansible -i csv_inventory.yaml all -m ping i_web02 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } i_nginx01 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } i_web01 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } a_web02 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } a_web01 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" } a_nginx01 | SUCCESS = > { \"changed\" : false, \"ping\" : \"pong\" }","title":"\u6267\u884c ad-hoc \u547d\u4ee4"},{"location":"dev/plugins/Inventory-csv/#playbook","text":"cat /etc/ansible/test.yml --- - hosts: all gather_facts: no tasks: - name: display var debug: msg: \"The mgmt IP is {{ ansible_host }} and platorm is {{ ansible_os }}\" # ansible-playbook -i csv_inventory.yaml test.yml PLAY [ all ] ***************************************************************************************** TASK [ display var ] ***************************************************************************************** ok: [ i_web01 ] = > { \"msg\" : \"The mgmt IP is 10.1.1.2 and platorm is Centos\" } ok: [ i_web02 ] = > { \"msg\" : \"The mgmt IP is 10.1.1.3 and platorm is Centos\" } ok: [ a_web01 ] = > { \"msg\" : \"The mgmt IP is 10.2.1.2 and platorm is Centos\" } ok: [ a_web02 ] = > { \"msg\" : \"The mgmt IP is 10.2.1.3 and platorm is Centos\" } ok: [ i_nginx01 ] = > { \"msg\" : \"The mgmt IP is 10.1.1.1 and platorm is Ubuntu\" } ok: [ a_nginx01 ] = > { \"msg\" : \"The mgmt IP is 10.2.1.1 and platorm is Ubuntu\" } PLAY RECAP ***************************************************************************************** a_nginx01 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 a_web01 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 a_web02 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 i_nginx01 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 i_web01 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 i_web02 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0","title":"\u6267\u884c playbook"},{"location":"dev/plugins/Lookup-github-status/","text":"lookup plugins: github_status \u00b6 \u9700\u6c42 \u00b6 \u83b7\u53d6github\u9879\u76ee\u5206\u652f\u7684\u63d0\u4ea4\u72b6\u6001 \u7f16\u5199\u63d2\u4ef6 \u00b6 \u6587\u4ef6\u8def\u5f84 lookup_plugins/github_status.py from __future__ import ( absolute_import, division, print_function ) __metaclass__ = type DOCUMENTATION = \"\"\" lookup: github_status author: lework version_added: historical short_description: return github repository branch status from list description: - this lookup get the commit status of the github repository branch options: _terms: description: list of github repository names branch: description: github repository branch name \"\"\" EXAMPLES = \"\"\" - name: look up github status for ansible debug: msg: \" Current branch status is: {{ lookup ( 'github_status' , 'ansible/ansible' , branch = 'devel' ) }} ! \" \"\"\" RETURN = \"\"\" _raw: description: repository branch state \"\"\" import json from ansible.errors import AnsibleError from ansible.module_utils.urls import open_url from ansible.module_utils._text import to_text from ansible.plugins.lookup import LookupBase from ansible.utils.display import Display display = Display () class LookupModule ( LookupBase ) : def run ( self, terms, variables = None, **kwargs ) : ret = [] for term in terms: display.debug ( \"Github_status lookup term: %s\" % term ) branch = kwargs.get ( 'branch' , 'master' ) display.vv ( \"Github_status lookup get [%s] repository [%s] branch status.\" % ( term, branch )) url = 'https://api.github.com/repos/{}/commits/{}/status' .format ( term, branch ) try: data = json.loads ( open_url ( url ) .read ()) ret.append ( to_text ( data [ 'state' ])) except Exception as e: raise AnsibleError ( \"lookup_plugin.github_status Get %s status error. %s\" % ( term, e )) return ret \u6267\u884c playbook \u00b6 # cat test_lookup.yml --- - name : look up github status for ansible hosts : localhost gather_facts : no tasks : - debug : msg : \"Current branch status is: {{ lookup('github_status', 'ansible/ansible', branch='devel') }}!\" \u6267\u884c\u7ed3\u679c # ansible-playbook test_lookup.yml PLAY [ look up github status for ansible ] ***************************************************************************** TASK [ debug ] ********************************************************************************************************* ok: [ localhost ] = > { \"msg\" : \"Current branch status is: success!\" } PLAY RECAP *********************************************************************************************************** localhost : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u6267\u884c ad-hoc \u00b6 \u914d\u7f6e ansible.cfg ,\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684\u63d2\u4ef6\u76ee\u5f55 [defaults] lookup_plugins = /etc/ansible/lookup_plugins ansible localhost -m debug -a \"msg=\\\"Current branch status is: {{ lookup('github_status', 'ansible/ansible', branch='devel') }}\\\"\" localhost | SUCCESS = > { \"msg\" : \"Current branch status is: success\" }","title":"Lookup \u793a\u4f8b: github_status"},{"location":"dev/plugins/Lookup-github-status/#lookup-plugins-github_status","text":"","title":"lookup plugins: github_status"},{"location":"dev/plugins/Lookup-github-status/#_1","text":"\u83b7\u53d6github\u9879\u76ee\u5206\u652f\u7684\u63d0\u4ea4\u72b6\u6001","title":"\u9700\u6c42"},{"location":"dev/plugins/Lookup-github-status/#_2","text":"\u6587\u4ef6\u8def\u5f84 lookup_plugins/github_status.py from __future__ import ( absolute_import, division, print_function ) __metaclass__ = type DOCUMENTATION = \"\"\" lookup: github_status author: lework version_added: historical short_description: return github repository branch status from list description: - this lookup get the commit status of the github repository branch options: _terms: description: list of github repository names branch: description: github repository branch name \"\"\" EXAMPLES = \"\"\" - name: look up github status for ansible debug: msg: \" Current branch status is: {{ lookup ( 'github_status' , 'ansible/ansible' , branch = 'devel' ) }} ! \" \"\"\" RETURN = \"\"\" _raw: description: repository branch state \"\"\" import json from ansible.errors import AnsibleError from ansible.module_utils.urls import open_url from ansible.module_utils._text import to_text from ansible.plugins.lookup import LookupBase from ansible.utils.display import Display display = Display () class LookupModule ( LookupBase ) : def run ( self, terms, variables = None, **kwargs ) : ret = [] for term in terms: display.debug ( \"Github_status lookup term: %s\" % term ) branch = kwargs.get ( 'branch' , 'master' ) display.vv ( \"Github_status lookup get [%s] repository [%s] branch status.\" % ( term, branch )) url = 'https://api.github.com/repos/{}/commits/{}/status' .format ( term, branch ) try: data = json.loads ( open_url ( url ) .read ()) ret.append ( to_text ( data [ 'state' ])) except Exception as e: raise AnsibleError ( \"lookup_plugin.github_status Get %s status error. %s\" % ( term, e )) return ret","title":"\u7f16\u5199\u63d2\u4ef6"},{"location":"dev/plugins/Lookup-github-status/#playbook","text":"# cat test_lookup.yml --- - name : look up github status for ansible hosts : localhost gather_facts : no tasks : - debug : msg : \"Current branch status is: {{ lookup('github_status', 'ansible/ansible', branch='devel') }}!\" \u6267\u884c\u7ed3\u679c # ansible-playbook test_lookup.yml PLAY [ look up github status for ansible ] ***************************************************************************** TASK [ debug ] ********************************************************************************************************* ok: [ localhost ] = > { \"msg\" : \"Current branch status is: success!\" } PLAY RECAP *********************************************************************************************************** localhost : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0","title":"\u6267\u884c playbook"},{"location":"dev/plugins/Lookup-github-status/#ad-hoc","text":"\u914d\u7f6e ansible.cfg ,\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684\u63d2\u4ef6\u76ee\u5f55 [defaults] lookup_plugins = /etc/ansible/lookup_plugins ansible localhost -m debug -a \"msg=\\\"Current branch status is: {{ lookup('github_status', 'ansible/ansible', branch='devel') }}\\\"\" localhost | SUCCESS = > { \"msg\" : \"Current branch status is: success\" }","title":"\u6267\u884c ad-hoc"},{"location":"dev/plugins/Vars-csv-vars/","text":"vars plugins: csv_vars \u00b6 \u9700\u6c42 \u00b6 \u5c06 csv \u4e2d\u7684\u6570\u636e\u89e3\u6790\u4e3a\u4e3b\u673a\u53d8\u91cf csv \u6587\u4ef6\u793a\u4f8b hostname,gateway,vlan30,vlan40,vlan50,vlan60,vlan70 localhost,192.168.30.254,192.168.30.31,192.168.40.31,192.168.50.31,192.168.60.31,192.168.70.31 \u5c06 csv \u6587\u4ef6\u653e\u5728 inventory \u6216 playbook \u4e0b\u7684 csv_vars \u76ee\u5f55\u4e2d\uff0c\u5c31\u4f1a\u88ab\u81ea\u52a8\u89e3\u6790\u3002 csv \u4e2d\u7684 hostname \u5b57\u6bb5\u8981\u4e0e inventory \u7684\u4e3b\u673a\u540d\u79f0\u4e00\u81f4\u3002 \u7f16\u5199\u63d2\u4ef6 \u00b6 \u6587\u4ef6\u8def\u5f84 vars_plugins/csv_vars.py #!/usr/bin/env python # -*- coding: utf-8 -*- # Copyright 2019 Zijian Guo <guozijian@unitedstack.com>, <guozijn@gmail.com> # # Licensed under the Apache License, Version 2.0 (the \"License\"); # you may not use this file except in compliance with the License. # You may obtain a copy of the License at # # http://www.apache.org/licenses/LICENSE-2.0 # # Unless required by applicable law or agreed to in writing, software # distributed under the License is distributed on an \"AS IS\" BASIS, # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. # See the License for the specific language governing permissions and # limitations under the License. from __future__ import print_function DOCUMENTATION = ''' vars: csv_vars short_description: Parsing vars from csv file description: - Load YAML variable into ansible host corresponding to \"hostname\" in csv_vars/servers.csv file. options: _valid_extensions: default: [\".csv\"] ''' from ansible.errors import AnsibleParserError from ansible.inventory.group import Group from ansible.inventory.host import Host from ansible.module_utils._text import to_bytes from ansible.module_utils._text import to_native from ansible.plugins.vars import BaseVarsPlugin from ansible.utils.vars import combine_vars import csv import os import yaml FOUND = {} def load_from_csv ( file_name ) : with open ( file_name, 'r' ) as csv_data: reader = csv.DictReader ( csv_data ) out = yaml.safe_dump ([ row for row in reader ]) return yaml.safe_load ( out ) class VarsModule ( BaseVarsPlugin ) : def get_vars ( self, loader, path, entities, cache = True ) : '''parses the csv file''' if not isinstance ( entities, list ) : entities = [ entities ] super ( VarsModule, self ) .get_vars ( loader, path, entities ) data = {} for entity in entities: if isinstance ( entity, Host ) : subdir = 'csv_vars' elif isinstance ( entity, Group ) : continue else : raise AnsibleParserError ( \"Supplied entity must be Host or got %s instead\" % ( type ( entity )) ) # avoid 'chroot' type inventory hostnames /path/to/chroot if not entity.name.startswith ( os.path.sep ) : try: found_files = [] # load vars opath = os.path.realpath ( os.path.join ( self._basedir, subdir )) key = '%s.%s' % ( entity.name, opath ) if cache and key in FOUND: found_files = FOUND [ key ] else : b_opath = to_bytes ( opath ) # no need to do much if path does not exist for basedir if os.path.exists ( b_opath ) : if os.path.isdir ( b_opath ) : self._display.debug ( \"\\tprocessing dir %s\" % opath ) found_files = loader.find_vars_files ( opath, 'nodes' , [ '.csv' ] ) FOUND [ key ] = found_files else : self._display.warning ( \"Found %s that is not a directory, \\ skipping: %s\" % ( subdir, opath ) ) for found in found_files: new_data = load_from_csv ( found ) for row_data in new_data: if row_data [ 'hostname' ] == entity.name: data = combine_vars ( data, row_data ) except Exception as e: raise AnsibleParserError ( to_native ( e )) return data \u4ee3\u7801\u6765\u81ea https://github.com/guozijn/csv_vars csv \u6587\u4ef6 \u00b6 \u5c06 csv \u6587\u4ef6\u653e\u5728 inventory \u6216 playbook \u4e0b\u7684 csv_vars \u76ee\u5f55\u4e2d mdkir csv_vars cat << EOF >> csv_vars/nodes.csv hostname,gateway,vlan30,vlan40,vlan50,vlan60,vlan70 192.168.77.130,192.168.30.254,192.168.30.31,192.168.40.31,192.168.50.31,192.168.60.31,192.168.70.31 EOF \u6267\u884c playbook \u00b6 # cat test_vars.yml - hosts : 192.168.77.130 gather_facts : no tasks : - debug : msg : \"{{ lookup('vars', item) }}\" loop : \"{{ hostvars[inventory_hostname].keys() | select('match', '^vlan.*$|gateway') | list }}\" \u6267\u884c\u7ed3\u679c # ansible-playbook test_vars.yml PLAY [ 192 .168.77.130 ] ************************************************************************************************ TASK [ debug ] ********************************************************************************************************* ok: [ 192 .168.77.130 ] = > ( item = gateway ) = > { \"msg\" : \"192.168.30.254\" } ok: [ 192 .168.77.130 ] = > ( item = vlan60 ) = > { \"msg\" : \"192.168.60.31\" } ok: [ 192 .168.77.130 ] = > ( item = vlan30 ) = > { \"msg\" : \"192.168.30.31\" } ok: [ 192 .168.77.130 ] = > ( item = vlan40 ) = > { \"msg\" : \"192.168.40.31\" } ok: [ 192 .168.77.130 ] = > ( item = vlan70 ) = > { \"msg\" : \"192.168.70.31\" } ok: [ 192 .168.77.130 ] = > ( item = vlan50 ) = > { \"msg\" : \"192.168.50.31\" } PLAY RECAP *********************************************************************************************************** 192 .168.77.130 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0 \u6267\u884c ad-hoc \u00b6 \u914d\u7f6e ansible.cfg ,\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684\u63d2\u4ef6\u76ee\u5f55 [defaults] vars_plugins = /etc/ansible/vars_plugins # ansible 192.168.77.130 -m debug -a 'var=gateway' 192 .168.77.130 | SUCCESS = > { \"gateway\" : \"192.168.30.254\" } # ansible 192.168.77.130 -m debug -a 'var=vlan30' 192 .168.77.130 | SUCCESS = > { \"vlan30\" : \"192.168.30.31\" }","title":"Vars \u793a\u4f8b: csv_vars"},{"location":"dev/plugins/Vars-csv-vars/#vars-plugins-csv_vars","text":"","title":"vars plugins: csv_vars"},{"location":"dev/plugins/Vars-csv-vars/#_1","text":"\u5c06 csv \u4e2d\u7684\u6570\u636e\u89e3\u6790\u4e3a\u4e3b\u673a\u53d8\u91cf csv \u6587\u4ef6\u793a\u4f8b hostname,gateway,vlan30,vlan40,vlan50,vlan60,vlan70 localhost,192.168.30.254,192.168.30.31,192.168.40.31,192.168.50.31,192.168.60.31,192.168.70.31 \u5c06 csv \u6587\u4ef6\u653e\u5728 inventory \u6216 playbook \u4e0b\u7684 csv_vars \u76ee\u5f55\u4e2d\uff0c\u5c31\u4f1a\u88ab\u81ea\u52a8\u89e3\u6790\u3002 csv \u4e2d\u7684 hostname \u5b57\u6bb5\u8981\u4e0e inventory \u7684\u4e3b\u673a\u540d\u79f0\u4e00\u81f4\u3002","title":"\u9700\u6c42"},{"location":"dev/plugins/Vars-csv-vars/#_2","text":"\u6587\u4ef6\u8def\u5f84 vars_plugins/csv_vars.py #!/usr/bin/env python # -*- coding: utf-8 -*- # Copyright 2019 Zijian Guo <guozijian@unitedstack.com>, <guozijn@gmail.com> # # Licensed under the Apache License, Version 2.0 (the \"License\"); # you may not use this file except in compliance with the License. # You may obtain a copy of the License at # # http://www.apache.org/licenses/LICENSE-2.0 # # Unless required by applicable law or agreed to in writing, software # distributed under the License is distributed on an \"AS IS\" BASIS, # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. # See the License for the specific language governing permissions and # limitations under the License. from __future__ import print_function DOCUMENTATION = ''' vars: csv_vars short_description: Parsing vars from csv file description: - Load YAML variable into ansible host corresponding to \"hostname\" in csv_vars/servers.csv file. options: _valid_extensions: default: [\".csv\"] ''' from ansible.errors import AnsibleParserError from ansible.inventory.group import Group from ansible.inventory.host import Host from ansible.module_utils._text import to_bytes from ansible.module_utils._text import to_native from ansible.plugins.vars import BaseVarsPlugin from ansible.utils.vars import combine_vars import csv import os import yaml FOUND = {} def load_from_csv ( file_name ) : with open ( file_name, 'r' ) as csv_data: reader = csv.DictReader ( csv_data ) out = yaml.safe_dump ([ row for row in reader ]) return yaml.safe_load ( out ) class VarsModule ( BaseVarsPlugin ) : def get_vars ( self, loader, path, entities, cache = True ) : '''parses the csv file''' if not isinstance ( entities, list ) : entities = [ entities ] super ( VarsModule, self ) .get_vars ( loader, path, entities ) data = {} for entity in entities: if isinstance ( entity, Host ) : subdir = 'csv_vars' elif isinstance ( entity, Group ) : continue else : raise AnsibleParserError ( \"Supplied entity must be Host or got %s instead\" % ( type ( entity )) ) # avoid 'chroot' type inventory hostnames /path/to/chroot if not entity.name.startswith ( os.path.sep ) : try: found_files = [] # load vars opath = os.path.realpath ( os.path.join ( self._basedir, subdir )) key = '%s.%s' % ( entity.name, opath ) if cache and key in FOUND: found_files = FOUND [ key ] else : b_opath = to_bytes ( opath ) # no need to do much if path does not exist for basedir if os.path.exists ( b_opath ) : if os.path.isdir ( b_opath ) : self._display.debug ( \"\\tprocessing dir %s\" % opath ) found_files = loader.find_vars_files ( opath, 'nodes' , [ '.csv' ] ) FOUND [ key ] = found_files else : self._display.warning ( \"Found %s that is not a directory, \\ skipping: %s\" % ( subdir, opath ) ) for found in found_files: new_data = load_from_csv ( found ) for row_data in new_data: if row_data [ 'hostname' ] == entity.name: data = combine_vars ( data, row_data ) except Exception as e: raise AnsibleParserError ( to_native ( e )) return data \u4ee3\u7801\u6765\u81ea https://github.com/guozijn/csv_vars","title":"\u7f16\u5199\u63d2\u4ef6"},{"location":"dev/plugins/Vars-csv-vars/#csv","text":"\u5c06 csv \u6587\u4ef6\u653e\u5728 inventory \u6216 playbook \u4e0b\u7684 csv_vars \u76ee\u5f55\u4e2d mdkir csv_vars cat << EOF >> csv_vars/nodes.csv hostname,gateway,vlan30,vlan40,vlan50,vlan60,vlan70 192.168.77.130,192.168.30.254,192.168.30.31,192.168.40.31,192.168.50.31,192.168.60.31,192.168.70.31 EOF","title":"csv \u6587\u4ef6"},{"location":"dev/plugins/Vars-csv-vars/#playbook","text":"# cat test_vars.yml - hosts : 192.168.77.130 gather_facts : no tasks : - debug : msg : \"{{ lookup('vars', item) }}\" loop : \"{{ hostvars[inventory_hostname].keys() | select('match', '^vlan.*$|gateway') | list }}\" \u6267\u884c\u7ed3\u679c # ansible-playbook test_vars.yml PLAY [ 192 .168.77.130 ] ************************************************************************************************ TASK [ debug ] ********************************************************************************************************* ok: [ 192 .168.77.130 ] = > ( item = gateway ) = > { \"msg\" : \"192.168.30.254\" } ok: [ 192 .168.77.130 ] = > ( item = vlan60 ) = > { \"msg\" : \"192.168.60.31\" } ok: [ 192 .168.77.130 ] = > ( item = vlan30 ) = > { \"msg\" : \"192.168.30.31\" } ok: [ 192 .168.77.130 ] = > ( item = vlan40 ) = > { \"msg\" : \"192.168.40.31\" } ok: [ 192 .168.77.130 ] = > ( item = vlan70 ) = > { \"msg\" : \"192.168.70.31\" } ok: [ 192 .168.77.130 ] = > ( item = vlan50 ) = > { \"msg\" : \"192.168.50.31\" } PLAY RECAP *********************************************************************************************************** 192 .168.77.130 : ok = 1 changed = 0 unreachable = 0 failed = 0 skipped = 0 rescued = 0 ignored = 0","title":"\u6267\u884c playbook"},{"location":"dev/plugins/Vars-csv-vars/#ad-hoc","text":"\u914d\u7f6e ansible.cfg ,\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684\u63d2\u4ef6\u76ee\u5f55 [defaults] vars_plugins = /etc/ansible/vars_plugins # ansible 192.168.77.130 -m debug -a 'var=gateway' 192 .168.77.130 | SUCCESS = > { \"gateway\" : \"192.168.30.254\" } # ansible 192.168.77.130 -m debug -a 'var=vlan30' 192 .168.77.130 | SUCCESS = > { \"vlan30\" : \"192.168.30.31\" }","title":"\u6267\u884c ad-hoc"},{"location":"roles/","text":"Ansible roles \u600e\u4e48\u7528\uff1f \u00b6 \u672c\u6587\u4ecb\u7ecd\u600e\u4e48\u4f7f\u7528\u672c\u4eba\u7f16\u5199\u7684ansible role\u3002 \u7cfb\u7edf\u73af\u5883 \u00b6 os: Centos 6.7 X64 python: 2.6.6 \u5b89\u88c5ansible\u548cgit \u00b6 [ root@node ~ ] # yum install -y ansible git [ root@node ~ ] # ansible --version ansible 2 .2.1.0 config file = /etc/ansible/ansible.cfg configured module search path = Default w/o overrides \u8bbe\u7f6eansible \u00b6 \u5173\u95ed\u4e3b\u673assh known_hosts\u68c0\u67e5 \u914d\u7f6e\u6587\u4ef6\uff1a/etc/ansible/ansible.cfg 59 host_key_checking = False \u4f7f\u7528git \u514b\u9686ansible role \u00b6 [ root@node roles ] # git clone https://github.com/lework/Ansible-roles.git /etc/ansible/roles/ Initialized empty Git repository in /etc/ansible/roles/.git/ remote: Counting objects: 165 , done . remote: Compressing objects: 100 % ( 95 /95 ) , done . remote: Total 165 ( delta 37 ) , reused 152 ( delta 24 ) , pack-reused 0 Receiving objects: 100 % ( 165 /165 ) , 26 .01 KiB | 19 KiB/s, done . Resolving deltas: 100 % ( 37 /37 ) , done . [ root@node roles ] # ll /etc/ansible/roles/ \u603b\u7528\u91cf 36 drwxr-xr-x 5 root root 4096 3\u6708 11 11 :54 iptables drwxr-xr-x 5 root root 4096 3\u6708 11 11 :54 java drwxr-xr-x 4 root root 4096 3\u6708 11 11 :54 mvn drwxr-xr-x 5 root root 4096 3\u6708 11 11 :54 nodejs drwxr-xr-x 5 root root 4096 3\u6708 11 11 :54 os-init drwxr-xr-x 5 root root 4096 3\u6708 11 11 :54 python2.7 drwxr-xr-x 4 root root 4096 3\u6708 11 11 :54 repo-epel drwxr-xr-x 4 root root 4096 3\u6708 11 11 :54 ruby drwxr-xr-x 5 root root 4096 3\u6708 11 11 :54 supervisor [ root@node roles ] # \u6dfb\u52a0\u4e3b\u673a\u6e05\u5355 \u00b6 \u8fd9\u91cc\u4ee5192.168.77.130\u4e3b\u673a\u4e3a\u4f8b\uff0c\u5e76\u5c06\u5176\u8bbe\u4e3anode2\u7ec4\u5185\u3002 #/etc/ansible/hosts [node2] 192.168.77.130 ansible_ssh_pass=123456 \u67e5\u770brole\u7684README.md\u6587\u6863 \u00b6 # Ansible Role: python2.7 Centos 6.7\u7248\u672c\u4e2d\u7684python2.6\u5347\u7ea7\u52302.7 ## \u8981\u6c42 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 ## \u6d4b\u8bd5\u73af\u5883 ansible `2.2.1.0` os `Centos 6.7 X64` ## \u89d2\u8272\u53d8\u91cf software_files_path: \"/opt/software/\" software_install_path: \"/usr/local\" python_version: \"2.7.13\" python_file: \"Python-{{ python_version }}.tgz\" python_file_path: \"{{ software_files_path }}/{{ python_file }}\" python_file_url: \"http://www.python.org/ftp/python/{{ python_version }}/Python-{{ python_version }}.tgz\" pip_source_url: \"https://pypi.tuna.tsinghua.edu.cn/simple\" change_pip_source: true ## \u4f9d\u8d56 \u6ca1\u6709 ## github\u5730\u5740 https://github.com/lework/Ansible-roles/tree/master/python2.7 ## Example Playbook - hosts: servers roles: - python2.7 - hosts: server roles: - { role: python2.7, python_version: \"2.7.13\"} \u4e0a\u8bc9\u8bf4\u660e\u4e86\u6b64role\u5728\u54ea\u4e2a\u73af\u5883\u4e0b\u6b63\u5e38\u8fd0\u884c\uff0c\u5176\u4ed6\u73af\u5883\u6682\u4e0d\u4fdd\u8bc1\u8fd0\u884c\u6210\u529f\u3002 \u53ef\u4ee5\u81ea\u5b9a\u4e49\u89d2\u8272\u53d8\u91cf\uff0c\u8fbe\u5230\u81ea\u5df1\u60f3\u8981\u7684\u7ed3\u679c\u3002\u6bd4\u5982\u60f3\u8981\u5b89\u88c5python2.7.12\u7684\u7248\u672c\uff0c\u53ef\u4ee5\u5728playbook\u4e2d\u5b9a\u4e49 python_version: \"2.7.12\" ,\u5c31\u53ef\u4ee5\u5b89\u88c52.7.12\u7248\u672c\u7684python\u4e86\u3002 \u5982\u679c\u6587\u7ae0\u4e2d\u6709\u4f9d\u8d56\uff0c\u5fc5\u987b\u5148\u5b89\u88c5\u4f9d\u8d56\uff0c\u624d\u80fd\u8fd0\u884c\u6b64role\u3002 \u5728\u7f16\u5199Playbook\u65f6\u4e5f\u53ef\u4ee5\u53c2\u8003\u4e0a\u5217\u7684Playbook\u4f8b\u5b50\u3002 \u7f16\u5199playbook \u00b6 \u8fd9\u91cc\u4ee5 python2.7 \u89d2\u8272\u4e3a\u4f8b\uff0c\u5c06\u4e3anode2\u7ec4\u5185\u7684\u6240\u6709\u4e3b\u673a\u5b89\u88c5python2.7\u670d\u52a1\u3002 \u67e5\u770b python2.7 \u4f7f\u7528\u5e2e\u52a9\uff0c\u6839\u636e\u81ea\u8eab\u60c5\u51b5\u8bbe\u7f6e\u76f8\u5e94\u7684\u53d8\u91cf\uff0c\u8fd9\u91cc\u8bbe\u7f6epython\u7684\u7248\u672c\u4e3a2.7.14\u3002 \u6587\u4ef6\u8def\u5f84\uff1a/etc/ansible/python2.7.yml --- - hosts: node2 roles: - { role: python2.7, python_version: \"2.7.14\"} \u6267\u884cplaybook \u00b6 [ root@node ansible ] # ansible-playbook python2.7.yml PLAY [ node2 ] ******************************************************************* TASK [ setup ] ******************************************************************* ok: [ 192 .168.77.130 ] TASK [ python2.7 : Copy python file to agent. ] ********************************** ok: [ 192 .168.77.130 ] TASK [ python2.7 : Create software files . ] ************************************* ok: [ 192 .168.77.130 ] TASK [ python2.7 : Download python file. ] *************************************** changed: [ 192 .168.77.130 ] TASK [ python2.7 : Check if python remote soft link is already configured. ] ***** ok: [ 192 .168.77.130 ] TASK [ python2.7 : Check if python remote soft old link is already configured. ] * ok: [ 192 .168.77.130 ] TASK [ python2.7 : Ensure packages are installed. ] ****************************** ok: [ 192 .168.77.130 ] = > ( item =[ u 'zlib' , u 'zlib-devel' , u 'openssl' , u 'openssl-devel' , u 'python-devel' , u 'gcc' ]) TASK [ python2.7 : Copy python file to agent. ] ********************************** changed: [ 192 .168.77.130 ] TASK [ python2.7 : Build python. ] *********************************************** changed: [ 192 .168.77.130 ] TASK [ python2.7 : Move python old version and Create python dir soft link. ] **** changed: [ 192 .168.77.130 ] TASK [ python2.7 : Replace file python env path. ] ******************************* changed: [ 192 .168.77.130 ] = > ( item = /usr/sbin/iotop ) changed: [ 192 .168.77.130 ] = > ( item = /usr/bin/yum ) TASK [ python2.7 : Check if pip is already configured. ] ************************* ok: [ 192 .168.77.130 ] TASK [ python2.7 : Install python2.7 pip. ] ************************************** changed: [ 192 .168.77.130 ] [ WARNING ] : Consider using get_url or uri module rather than running curl TASK [ python2.7 : Create pip config dir. ] ************************************** changed: [ 192 .168.77.130 ] TASK [ python2.7 : Change pip source. ] ****************************************** changed: [ 192 .168.77.130 ] PLAY RECAP ********************************************************************* 192 .168.77.130 : ok = 15 changed = 8 unreachable = 0 failed = 0 \u67e5\u770b\u4e3b\u673a\u662f\u5426\u5b89\u88c5\u4e86python2.7\u7248\u672c \u00b6 \u4f7f\u7528ad-hoc\u65b9\u5f0f\u67e5\u770b [ root@node ansible ] # ansible node2 -m shell -a 'python -V' 192 .168.77.130 | SUCCESS | rc = 0 >> Python 2 .7.12 \u5728\u4e3b\u673a\u4e0a\u67e5\u770b [ root@node2 ~ ] # python -V Python 2 .7.12 \u81f3\u6b64\uff0cansible role\u600e\u4e48\u4f7f\u7528\u5927\u5bb6\u90fd\u660e\u767d\u4e86\u628a\u3002\u5982\u679c\u6709\u7591\u95ee\u7684\u8bdd\uff0c\u6b22\u8fce\u5927\u5bb6\u6765QQ\u7fa4\u3010425931784 \u5df2\u6ee1\u5458\u3011\u3010756527917\u3011\u4ea4\u6d41 \u66f4\u591aAnsible role\u8d44\u6e90 \u00b6 https://galaxy.ansible.com/ https://github.com/ansible/ansible-examples https://github.com/geerlingguy https://github.com/debops","title":"Ansible roles \u600e\u4e48\u7528\uff1f"},{"location":"roles/#ansible-roles","text":"\u672c\u6587\u4ecb\u7ecd\u600e\u4e48\u4f7f\u7528\u672c\u4eba\u7f16\u5199\u7684ansible role\u3002","title":"Ansible roles \u600e\u4e48\u7528\uff1f"},{"location":"roles/#_1","text":"os: Centos 6.7 X64 python: 2.6.6","title":"\u7cfb\u7edf\u73af\u5883"},{"location":"roles/#ansiblegit","text":"[ root@node ~ ] # yum install -y ansible git [ root@node ~ ] # ansible --version ansible 2 .2.1.0 config file = /etc/ansible/ansible.cfg configured module search path = Default w/o overrides","title":"\u5b89\u88c5ansible\u548cgit"},{"location":"roles/#ansible","text":"\u5173\u95ed\u4e3b\u673assh known_hosts\u68c0\u67e5 \u914d\u7f6e\u6587\u4ef6\uff1a/etc/ansible/ansible.cfg 59 host_key_checking = False","title":"\u8bbe\u7f6eansible"},{"location":"roles/#git-ansible-role","text":"[ root@node roles ] # git clone https://github.com/lework/Ansible-roles.git /etc/ansible/roles/ Initialized empty Git repository in /etc/ansible/roles/.git/ remote: Counting objects: 165 , done . remote: Compressing objects: 100 % ( 95 /95 ) , done . remote: Total 165 ( delta 37 ) , reused 152 ( delta 24 ) , pack-reused 0 Receiving objects: 100 % ( 165 /165 ) , 26 .01 KiB | 19 KiB/s, done . Resolving deltas: 100 % ( 37 /37 ) , done . [ root@node roles ] # ll /etc/ansible/roles/ \u603b\u7528\u91cf 36 drwxr-xr-x 5 root root 4096 3\u6708 11 11 :54 iptables drwxr-xr-x 5 root root 4096 3\u6708 11 11 :54 java drwxr-xr-x 4 root root 4096 3\u6708 11 11 :54 mvn drwxr-xr-x 5 root root 4096 3\u6708 11 11 :54 nodejs drwxr-xr-x 5 root root 4096 3\u6708 11 11 :54 os-init drwxr-xr-x 5 root root 4096 3\u6708 11 11 :54 python2.7 drwxr-xr-x 4 root root 4096 3\u6708 11 11 :54 repo-epel drwxr-xr-x 4 root root 4096 3\u6708 11 11 :54 ruby drwxr-xr-x 5 root root 4096 3\u6708 11 11 :54 supervisor [ root@node roles ] #","title":"\u4f7f\u7528git \u514b\u9686ansible role"},{"location":"roles/#_2","text":"\u8fd9\u91cc\u4ee5192.168.77.130\u4e3b\u673a\u4e3a\u4f8b\uff0c\u5e76\u5c06\u5176\u8bbe\u4e3anode2\u7ec4\u5185\u3002 #/etc/ansible/hosts [node2] 192.168.77.130 ansible_ssh_pass=123456","title":"\u6dfb\u52a0\u4e3b\u673a\u6e05\u5355"},{"location":"roles/#rolereadmemd","text":"# Ansible Role: python2.7 Centos 6.7\u7248\u672c\u4e2d\u7684python2.6\u5347\u7ea7\u52302.7 ## \u8981\u6c42 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 ## \u6d4b\u8bd5\u73af\u5883 ansible `2.2.1.0` os `Centos 6.7 X64` ## \u89d2\u8272\u53d8\u91cf software_files_path: \"/opt/software/\" software_install_path: \"/usr/local\" python_version: \"2.7.13\" python_file: \"Python-{{ python_version }}.tgz\" python_file_path: \"{{ software_files_path }}/{{ python_file }}\" python_file_url: \"http://www.python.org/ftp/python/{{ python_version }}/Python-{{ python_version }}.tgz\" pip_source_url: \"https://pypi.tuna.tsinghua.edu.cn/simple\" change_pip_source: true ## \u4f9d\u8d56 \u6ca1\u6709 ## github\u5730\u5740 https://github.com/lework/Ansible-roles/tree/master/python2.7 ## Example Playbook - hosts: servers roles: - python2.7 - hosts: server roles: - { role: python2.7, python_version: \"2.7.13\"} \u4e0a\u8bc9\u8bf4\u660e\u4e86\u6b64role\u5728\u54ea\u4e2a\u73af\u5883\u4e0b\u6b63\u5e38\u8fd0\u884c\uff0c\u5176\u4ed6\u73af\u5883\u6682\u4e0d\u4fdd\u8bc1\u8fd0\u884c\u6210\u529f\u3002 \u53ef\u4ee5\u81ea\u5b9a\u4e49\u89d2\u8272\u53d8\u91cf\uff0c\u8fbe\u5230\u81ea\u5df1\u60f3\u8981\u7684\u7ed3\u679c\u3002\u6bd4\u5982\u60f3\u8981\u5b89\u88c5python2.7.12\u7684\u7248\u672c\uff0c\u53ef\u4ee5\u5728playbook\u4e2d\u5b9a\u4e49 python_version: \"2.7.12\" ,\u5c31\u53ef\u4ee5\u5b89\u88c52.7.12\u7248\u672c\u7684python\u4e86\u3002 \u5982\u679c\u6587\u7ae0\u4e2d\u6709\u4f9d\u8d56\uff0c\u5fc5\u987b\u5148\u5b89\u88c5\u4f9d\u8d56\uff0c\u624d\u80fd\u8fd0\u884c\u6b64role\u3002 \u5728\u7f16\u5199Playbook\u65f6\u4e5f\u53ef\u4ee5\u53c2\u8003\u4e0a\u5217\u7684Playbook\u4f8b\u5b50\u3002","title":"\u67e5\u770brole\u7684README.md\u6587\u6863"},{"location":"roles/#playbook","text":"\u8fd9\u91cc\u4ee5 python2.7 \u89d2\u8272\u4e3a\u4f8b\uff0c\u5c06\u4e3anode2\u7ec4\u5185\u7684\u6240\u6709\u4e3b\u673a\u5b89\u88c5python2.7\u670d\u52a1\u3002 \u67e5\u770b python2.7 \u4f7f\u7528\u5e2e\u52a9\uff0c\u6839\u636e\u81ea\u8eab\u60c5\u51b5\u8bbe\u7f6e\u76f8\u5e94\u7684\u53d8\u91cf\uff0c\u8fd9\u91cc\u8bbe\u7f6epython\u7684\u7248\u672c\u4e3a2.7.14\u3002 \u6587\u4ef6\u8def\u5f84\uff1a/etc/ansible/python2.7.yml --- - hosts: node2 roles: - { role: python2.7, python_version: \"2.7.14\"}","title":"\u7f16\u5199playbook"},{"location":"roles/#playbook_1","text":"[ root@node ansible ] # ansible-playbook python2.7.yml PLAY [ node2 ] ******************************************************************* TASK [ setup ] ******************************************************************* ok: [ 192 .168.77.130 ] TASK [ python2.7 : Copy python file to agent. ] ********************************** ok: [ 192 .168.77.130 ] TASK [ python2.7 : Create software files . ] ************************************* ok: [ 192 .168.77.130 ] TASK [ python2.7 : Download python file. ] *************************************** changed: [ 192 .168.77.130 ] TASK [ python2.7 : Check if python remote soft link is already configured. ] ***** ok: [ 192 .168.77.130 ] TASK [ python2.7 : Check if python remote soft old link is already configured. ] * ok: [ 192 .168.77.130 ] TASK [ python2.7 : Ensure packages are installed. ] ****************************** ok: [ 192 .168.77.130 ] = > ( item =[ u 'zlib' , u 'zlib-devel' , u 'openssl' , u 'openssl-devel' , u 'python-devel' , u 'gcc' ]) TASK [ python2.7 : Copy python file to agent. ] ********************************** changed: [ 192 .168.77.130 ] TASK [ python2.7 : Build python. ] *********************************************** changed: [ 192 .168.77.130 ] TASK [ python2.7 : Move python old version and Create python dir soft link. ] **** changed: [ 192 .168.77.130 ] TASK [ python2.7 : Replace file python env path. ] ******************************* changed: [ 192 .168.77.130 ] = > ( item = /usr/sbin/iotop ) changed: [ 192 .168.77.130 ] = > ( item = /usr/bin/yum ) TASK [ python2.7 : Check if pip is already configured. ] ************************* ok: [ 192 .168.77.130 ] TASK [ python2.7 : Install python2.7 pip. ] ************************************** changed: [ 192 .168.77.130 ] [ WARNING ] : Consider using get_url or uri module rather than running curl TASK [ python2.7 : Create pip config dir. ] ************************************** changed: [ 192 .168.77.130 ] TASK [ python2.7 : Change pip source. ] ****************************************** changed: [ 192 .168.77.130 ] PLAY RECAP ********************************************************************* 192 .168.77.130 : ok = 15 changed = 8 unreachable = 0 failed = 0","title":"\u6267\u884cplaybook"},{"location":"roles/#python27","text":"\u4f7f\u7528ad-hoc\u65b9\u5f0f\u67e5\u770b [ root@node ansible ] # ansible node2 -m shell -a 'python -V' 192 .168.77.130 | SUCCESS | rc = 0 >> Python 2 .7.12 \u5728\u4e3b\u673a\u4e0a\u67e5\u770b [ root@node2 ~ ] # python -V Python 2 .7.12 \u81f3\u6b64\uff0cansible role\u600e\u4e48\u4f7f\u7528\u5927\u5bb6\u90fd\u660e\u767d\u4e86\u628a\u3002\u5982\u679c\u6709\u7591\u95ee\u7684\u8bdd\uff0c\u6b22\u8fce\u5927\u5bb6\u6765QQ\u7fa4\u3010425931784 \u5df2\u6ee1\u5458\u3011\u3010756527917\u3011\u4ea4\u6d41","title":"\u67e5\u770b\u4e3b\u673a\u662f\u5426\u5b89\u88c5\u4e86python2.7\u7248\u672c"},{"location":"roles/#ansible-role","text":"https://galaxy.ansible.com/ https://github.com/ansible/ansible-examples https://github.com/geerlingguy https://github.com/debops","title":"\u66f4\u591aAnsible role\u8d44\u6e90"},{"location":"roles/auth/kerberos-client/","text":"Ansible Role: kerberos client \u00b6 \u5b89\u88c5kerberos client\u670d\u52a1 \u4ecb\u7ecd \u00b6 Kerberos\uff1a\u7f51\u7edc\u8ba4\u8bc1\u534f\u8bae \uff08Kerberos: Network Authentication Protocol\uff09 Kerberos \u662f\u4e00\u79cd\u7f51\u7edc\u8ba4\u8bc1\u534f\u8bae\uff0c\u5176\u8bbe\u8ba1\u76ee\u6807\u662f\u901a\u8fc7\u5bc6\u94a5\u7cfb\u7edf\u4e3a\u5ba2\u6237\u673a/ \u670d\u52a1\u5668\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u5f3a\u5927\u7684\u8ba4\u8bc1\u670d\u52a1\u3002\u8be5\u8ba4\u8bc1\u8fc7\u7a0b\u7684\u5b9e\u73b0\u4e0d\u4f9d\u8d56\u4e8e\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u7684\u8ba4\u8bc1\uff0c\u65e0\u9700\u57fa\u4e8e\u4e3b\u673a\u5730\u5740\u7684\u4fe1\u4efb\uff0c\u4e0d\u8981\u6c42\u7f51\u7edc\u4e0a\u6240\u6709\u4e3b\u673a\u7684\u7269\u7406\u5b89\u5168\uff0c\u5e76\u5047\u5b9a\u7f51\u7edc\u4e0a\u4f20\u9001\u7684\u6570\u636e\u5305\u53ef\u4ee5\u88ab\u4efb\u610f\u5730\u8bfb\u53d6\u3001\u4fee\u6539\u548c\u63d2\u5165\u6570\u636e\u3002\u5728\u4ee5\u4e0a\u60c5\u51b5\u4e0b\uff0c Kerberos \u4f5c\u4e3a\u4e00\u79cd\u53ef\u4fe1\u4efb\u7684\u7b2c\u4e09\u65b9\u8ba4\u8bc1\u670d\u52a1\uff0c\u662f\u901a\u8fc7\u4f20\u7edf\u7684\u5bc6\u7801\u6280\u672f\uff08\u5982\uff1a\u5171\u4eab\u5bc6\u94a5\uff09\u6267\u884c\u8ba4\u8bc1\u670d\u52a1\u7684\u3002 \u5b98\u65b9\u5730\u5740\uff1a http://web.mit.edu/kerberos/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://web.mit.edu/~kerberos/krb5-devel/doc/index.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 kerberos_realm_name: EXAMPLE.COM # Kerberos realms kerberos_kdc_hostname: kerberos # kerberos server \u4e3b\u673a\u540d kerberos_kdc_ipaddress: 127.0.0.1 # kerberos server \u4e3b\u673a\u5730\u5740 kerberos_admin_hostname: \"{{ kerberos_kdc_hostname }}\" # kerneros administration server \u4e3b\u673a\u540d kerberos_admin_hostname: \"{{ kerberos_kdc_ipaddress }}\" # kerneros administration server \u4e3b\u673a\u5730\u5740 kerberos_dns_lookup_realm: \"false\" # \u662f\u5426\u901a\u8fc7dns\u67e5\u8be2realm kerberos_dns_lookup_kdc: \"false\" # \u662f\u5426\u901a\u8fc7dns\u67e5\u8be2kdc kerberos_ticket_lifetime: \"24h\" # \u51ed\u8bc1\u751f\u6548\u7684\u65f6\u9650 kerberos_renew_lifetime: \"7d\" # \u51ed\u8bc1\u6700\u957f\u53ef\u4ee5\u88ab\u5ef6\u671f\u7684\u65f6\u9650 kerberos_forwardable: \"true\" # \u83b7\u53d6\u51ed\u8bc1 \u4f9d\u8d56 \u00b6 None github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/kerberos-client Example Playbook \u00b6 - hosts: node2 vars: kerberos_realm_name: \"KERBEROSTEST.COM\" kerberos_kdc_hostname: \"node1\" kerberos_kdc_ipaddress: \"192.168.77.129\" roles: - kerberos-client \u4f7f\u7528 \u00b6 \u767b\u5f55kdc admin Server kadmin \u5728\u7ba1\u7406\u5458\u72b6\u6001\u4e0b\u4f7f\u7528\u589e\u5220\u6539\u67e5 addprinc \u589e\u52a0\u7528\u6237 delprinc \u5220\u9664\u7528\u6237 modprinc \u4fee\u6539\u7528\u6237 listprincs \u67e5\u770b\u7528\u6237 \u751f\u6210keytab kadmin:xst -k /xxx/xxx/kerberos.keytab hdfs/hadoop \u67e5\u770b\u5f53\u524d\u7684\u8ba4\u8bc1\u7528\u6237 klist \u8ba4\u8bc1\u7528\u6237 kinit -kt /xx/xx/kerberos.keytab hdfs/hadoop1 \u5220\u9664\u5f53\u524d\u7684\u8ba4\u8bc1\u7f13\u5b58 kdestory \u66f4\u65b0ticket kinit -R \u4fee\u6539renewlife modprinc -maxrenewlife 1week krbtgt/HADOOP.COM@HADOOP.COM","title":"kerberos-client"},{"location":"roles/auth/kerberos-client/#ansible-role-kerberos-client","text":"\u5b89\u88c5kerberos client\u670d\u52a1","title":"Ansible Role: kerberos client"},{"location":"roles/auth/kerberos-client/#_1","text":"Kerberos\uff1a\u7f51\u7edc\u8ba4\u8bc1\u534f\u8bae \uff08Kerberos: Network Authentication Protocol\uff09 Kerberos \u662f\u4e00\u79cd\u7f51\u7edc\u8ba4\u8bc1\u534f\u8bae\uff0c\u5176\u8bbe\u8ba1\u76ee\u6807\u662f\u901a\u8fc7\u5bc6\u94a5\u7cfb\u7edf\u4e3a\u5ba2\u6237\u673a/ \u670d\u52a1\u5668\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u5f3a\u5927\u7684\u8ba4\u8bc1\u670d\u52a1\u3002\u8be5\u8ba4\u8bc1\u8fc7\u7a0b\u7684\u5b9e\u73b0\u4e0d\u4f9d\u8d56\u4e8e\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u7684\u8ba4\u8bc1\uff0c\u65e0\u9700\u57fa\u4e8e\u4e3b\u673a\u5730\u5740\u7684\u4fe1\u4efb\uff0c\u4e0d\u8981\u6c42\u7f51\u7edc\u4e0a\u6240\u6709\u4e3b\u673a\u7684\u7269\u7406\u5b89\u5168\uff0c\u5e76\u5047\u5b9a\u7f51\u7edc\u4e0a\u4f20\u9001\u7684\u6570\u636e\u5305\u53ef\u4ee5\u88ab\u4efb\u610f\u5730\u8bfb\u53d6\u3001\u4fee\u6539\u548c\u63d2\u5165\u6570\u636e\u3002\u5728\u4ee5\u4e0a\u60c5\u51b5\u4e0b\uff0c Kerberos \u4f5c\u4e3a\u4e00\u79cd\u53ef\u4fe1\u4efb\u7684\u7b2c\u4e09\u65b9\u8ba4\u8bc1\u670d\u52a1\uff0c\u662f\u901a\u8fc7\u4f20\u7edf\u7684\u5bc6\u7801\u6280\u672f\uff08\u5982\uff1a\u5171\u4eab\u5bc6\u94a5\uff09\u6267\u884c\u8ba4\u8bc1\u670d\u52a1\u7684\u3002 \u5b98\u65b9\u5730\u5740\uff1a http://web.mit.edu/kerberos/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://web.mit.edu/~kerberos/krb5-devel/doc/index.html","title":"\u4ecb\u7ecd"},{"location":"roles/auth/kerberos-client/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/auth/kerberos-client/#_3","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/auth/kerberos-client/#_4","text":"kerberos_realm_name: EXAMPLE.COM # Kerberos realms kerberos_kdc_hostname: kerberos # kerberos server \u4e3b\u673a\u540d kerberos_kdc_ipaddress: 127.0.0.1 # kerberos server \u4e3b\u673a\u5730\u5740 kerberos_admin_hostname: \"{{ kerberos_kdc_hostname }}\" # kerneros administration server \u4e3b\u673a\u540d kerberos_admin_hostname: \"{{ kerberos_kdc_ipaddress }}\" # kerneros administration server \u4e3b\u673a\u5730\u5740 kerberos_dns_lookup_realm: \"false\" # \u662f\u5426\u901a\u8fc7dns\u67e5\u8be2realm kerberos_dns_lookup_kdc: \"false\" # \u662f\u5426\u901a\u8fc7dns\u67e5\u8be2kdc kerberos_ticket_lifetime: \"24h\" # \u51ed\u8bc1\u751f\u6548\u7684\u65f6\u9650 kerberos_renew_lifetime: \"7d\" # \u51ed\u8bc1\u6700\u957f\u53ef\u4ee5\u88ab\u5ef6\u671f\u7684\u65f6\u9650 kerberos_forwardable: \"true\" # \u83b7\u53d6\u51ed\u8bc1","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/auth/kerberos-client/#_5","text":"None","title":"\u4f9d\u8d56"},{"location":"roles/auth/kerberos-client/#github","text":"https://github.com/lework/Ansible-roles/tree/master/kerberos-client","title":"github\u5730\u5740"},{"location":"roles/auth/kerberos-client/#example-playbook","text":"- hosts: node2 vars: kerberos_realm_name: \"KERBEROSTEST.COM\" kerberos_kdc_hostname: \"node1\" kerberos_kdc_ipaddress: \"192.168.77.129\" roles: - kerberos-client","title":"Example Playbook"},{"location":"roles/auth/kerberos-client/#_6","text":"\u767b\u5f55kdc admin Server kadmin \u5728\u7ba1\u7406\u5458\u72b6\u6001\u4e0b\u4f7f\u7528\u589e\u5220\u6539\u67e5 addprinc \u589e\u52a0\u7528\u6237 delprinc \u5220\u9664\u7528\u6237 modprinc \u4fee\u6539\u7528\u6237 listprincs \u67e5\u770b\u7528\u6237 \u751f\u6210keytab kadmin:xst -k /xxx/xxx/kerberos.keytab hdfs/hadoop \u67e5\u770b\u5f53\u524d\u7684\u8ba4\u8bc1\u7528\u6237 klist \u8ba4\u8bc1\u7528\u6237 kinit -kt /xx/xx/kerberos.keytab hdfs/hadoop1 \u5220\u9664\u5f53\u524d\u7684\u8ba4\u8bc1\u7f13\u5b58 kdestory \u66f4\u65b0ticket kinit -R \u4fee\u6539renewlife modprinc -maxrenewlife 1week krbtgt/HADOOP.COM@HADOOP.COM","title":"\u4f7f\u7528"},{"location":"roles/auth/kerberos-server/","text":"Ansible Role: kerberos server \u00b6 \u5b89\u88c5kerberos server\u670d\u52a1 \u4ecb\u7ecd \u00b6 Kerberos\uff1a\u7f51\u7edc\u8ba4\u8bc1\u534f\u8bae \uff08Kerberos: Network Authentication Protocol\uff09 Kerberos \u662f\u4e00\u79cd\u7f51\u7edc\u8ba4\u8bc1\u534f\u8bae\uff0c\u5176\u8bbe\u8ba1\u76ee\u6807\u662f\u901a\u8fc7\u5bc6\u94a5\u7cfb\u7edf\u4e3a\u5ba2\u6237\u673a/ \u670d\u52a1\u5668\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u5f3a\u5927\u7684\u8ba4\u8bc1\u670d\u52a1\u3002\u8be5\u8ba4\u8bc1\u8fc7\u7a0b\u7684\u5b9e\u73b0\u4e0d\u4f9d\u8d56\u4e8e\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u7684\u8ba4\u8bc1\uff0c\u65e0\u9700\u57fa\u4e8e\u4e3b\u673a\u5730\u5740\u7684\u4fe1\u4efb\uff0c\u4e0d\u8981\u6c42\u7f51\u7edc\u4e0a\u6240\u6709\u4e3b\u673a\u7684\u7269\u7406\u5b89\u5168\uff0c\u5e76\u5047\u5b9a\u7f51\u7edc\u4e0a\u4f20\u9001\u7684\u6570\u636e\u5305\u53ef\u4ee5\u88ab\u4efb\u610f\u5730\u8bfb\u53d6\u3001\u4fee\u6539\u548c\u63d2\u5165\u6570\u636e\u3002\u5728\u4ee5\u4e0a\u60c5\u51b5\u4e0b\uff0c Kerberos \u4f5c\u4e3a\u4e00\u79cd\u53ef\u4fe1\u4efb\u7684\u7b2c\u4e09\u65b9\u8ba4\u8bc1\u670d\u52a1\uff0c\u662f\u901a\u8fc7\u4f20\u7edf\u7684\u5bc6\u7801\u6280\u672f\uff08\u5982\uff1a\u5171\u4eab\u5bc6\u94a5\uff09\u6267\u884c\u8ba4\u8bc1\u670d\u52a1\u7684\u3002 \u5b98\u65b9\u5730\u5740\uff1a http://web.mit.edu/kerberos/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://web.mit.edu/~kerberos/krb5-devel/doc/index.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 kerberos_realm_name: EXAMPLE.COM # Kerberos realms kerberos_kdc_port: 88 # kdc\u76d1\u542c\u7684\u7aef\u53e3 kerberos_master_db_pass: 123456 # kerberos \u6570\u636e\u5e93\u7684\u5bc6\u7801 kerberos_kadmin_pass: 123456 # kerberos admin\u7528\u6237\u7684\u5bc6\u7801 kerberos_kadmin_user: root # kerberos admin\u7528\u6237\u540d kerberos_users: [] # \u8981\u6dfb\u52a0\u7684 kerberos \u7528\u6237\u4fe1\u606f # kerberos_users: [{user: 'user1', pass: 'pass1'},] \u4f9d\u8d56 \u00b6 None github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/kerberos-server Example Playbook \u00b6 - hosts: node1 vars: kerberos_realm_name: \"KERBEROSTEST.COM\" kerberos_kadmin_user: \"root\" kerberos_kadmin_pass: \"foobar\" kerberos_users: - { user: 'user1', pass: 'pass1'} roles: - kerberos-server \u7aef\u53e3 \u00b6 krb5kdc\uff1a 88 kadmind\uff1a 749 464 \u4f7f\u7528 \u00b6 \u767b\u5f55kdc admin server kadmin.local \u5728\u7ba1\u7406\u5458\u72b6\u6001\u4e0b\u4f7f\u7528\u589e\u5220\u6539\u67e5 addprinc \u589e\u52a0\u7528\u6237 delprinc \u5220\u9664\u7528\u6237 modprinc \u4fee\u6539\u7528\u6237 listprincs \u67e5\u770b\u7528\u6237 \u751f\u6210keytab kadmin:xst -k /xxx/xxx/kerberos.keytab hdfs/hadoop \u67e5\u770b\u5f53\u524d\u7684\u8ba4\u8bc1\u7528\u6237 klist \u8ba4\u8bc1\u7528\u6237 kinit -kt /xx/xx/kerberos.keytab hdfs/hadoop1 \u5220\u9664\u5f53\u524d\u7684\u8ba4\u8bc1\u7f13\u5b58 kdestory \u66f4\u65b0ticket kinit -R \u4fee\u6539renewlife modprinc -maxrenewlife 1week krbtgt/HADOOP.COM@HADOOP.COM","title":"kerberos-server"},{"location":"roles/auth/kerberos-server/#ansible-role-kerberos-server","text":"\u5b89\u88c5kerberos server\u670d\u52a1","title":"Ansible Role: kerberos server"},{"location":"roles/auth/kerberos-server/#_1","text":"Kerberos\uff1a\u7f51\u7edc\u8ba4\u8bc1\u534f\u8bae \uff08Kerberos: Network Authentication Protocol\uff09 Kerberos \u662f\u4e00\u79cd\u7f51\u7edc\u8ba4\u8bc1\u534f\u8bae\uff0c\u5176\u8bbe\u8ba1\u76ee\u6807\u662f\u901a\u8fc7\u5bc6\u94a5\u7cfb\u7edf\u4e3a\u5ba2\u6237\u673a/ \u670d\u52a1\u5668\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u5f3a\u5927\u7684\u8ba4\u8bc1\u670d\u52a1\u3002\u8be5\u8ba4\u8bc1\u8fc7\u7a0b\u7684\u5b9e\u73b0\u4e0d\u4f9d\u8d56\u4e8e\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u7684\u8ba4\u8bc1\uff0c\u65e0\u9700\u57fa\u4e8e\u4e3b\u673a\u5730\u5740\u7684\u4fe1\u4efb\uff0c\u4e0d\u8981\u6c42\u7f51\u7edc\u4e0a\u6240\u6709\u4e3b\u673a\u7684\u7269\u7406\u5b89\u5168\uff0c\u5e76\u5047\u5b9a\u7f51\u7edc\u4e0a\u4f20\u9001\u7684\u6570\u636e\u5305\u53ef\u4ee5\u88ab\u4efb\u610f\u5730\u8bfb\u53d6\u3001\u4fee\u6539\u548c\u63d2\u5165\u6570\u636e\u3002\u5728\u4ee5\u4e0a\u60c5\u51b5\u4e0b\uff0c Kerberos \u4f5c\u4e3a\u4e00\u79cd\u53ef\u4fe1\u4efb\u7684\u7b2c\u4e09\u65b9\u8ba4\u8bc1\u670d\u52a1\uff0c\u662f\u901a\u8fc7\u4f20\u7edf\u7684\u5bc6\u7801\u6280\u672f\uff08\u5982\uff1a\u5171\u4eab\u5bc6\u94a5\uff09\u6267\u884c\u8ba4\u8bc1\u670d\u52a1\u7684\u3002 \u5b98\u65b9\u5730\u5740\uff1a http://web.mit.edu/kerberos/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://web.mit.edu/~kerberos/krb5-devel/doc/index.html","title":"\u4ecb\u7ecd"},{"location":"roles/auth/kerberos-server/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/auth/kerberos-server/#_3","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/auth/kerberos-server/#_4","text":"kerberos_realm_name: EXAMPLE.COM # Kerberos realms kerberos_kdc_port: 88 # kdc\u76d1\u542c\u7684\u7aef\u53e3 kerberos_master_db_pass: 123456 # kerberos \u6570\u636e\u5e93\u7684\u5bc6\u7801 kerberos_kadmin_pass: 123456 # kerberos admin\u7528\u6237\u7684\u5bc6\u7801 kerberos_kadmin_user: root # kerberos admin\u7528\u6237\u540d kerberos_users: [] # \u8981\u6dfb\u52a0\u7684 kerberos \u7528\u6237\u4fe1\u606f # kerberos_users: [{user: 'user1', pass: 'pass1'},]","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/auth/kerberos-server/#_5","text":"None","title":"\u4f9d\u8d56"},{"location":"roles/auth/kerberos-server/#github","text":"https://github.com/lework/Ansible-roles/tree/master/kerberos-server","title":"github\u5730\u5740"},{"location":"roles/auth/kerberos-server/#example-playbook","text":"- hosts: node1 vars: kerberos_realm_name: \"KERBEROSTEST.COM\" kerberos_kadmin_user: \"root\" kerberos_kadmin_pass: \"foobar\" kerberos_users: - { user: 'user1', pass: 'pass1'} roles: - kerberos-server","title":"Example Playbook"},{"location":"roles/auth/kerberos-server/#_6","text":"krb5kdc\uff1a 88 kadmind\uff1a 749 464","title":"\u7aef\u53e3"},{"location":"roles/auth/kerberos-server/#_7","text":"\u767b\u5f55kdc admin server kadmin.local \u5728\u7ba1\u7406\u5458\u72b6\u6001\u4e0b\u4f7f\u7528\u589e\u5220\u6539\u67e5 addprinc \u589e\u52a0\u7528\u6237 delprinc \u5220\u9664\u7528\u6237 modprinc \u4fee\u6539\u7528\u6237 listprincs \u67e5\u770b\u7528\u6237 \u751f\u6210keytab kadmin:xst -k /xxx/xxx/kerberos.keytab hdfs/hadoop \u67e5\u770b\u5f53\u524d\u7684\u8ba4\u8bc1\u7528\u6237 klist \u8ba4\u8bc1\u7528\u6237 kinit -kt /xx/xx/kerberos.keytab hdfs/hadoop1 \u5220\u9664\u5f53\u524d\u7684\u8ba4\u8bc1\u7f13\u5b58 kdestory \u66f4\u65b0ticket kinit -R \u4fee\u6539renewlife modprinc -maxrenewlife 1week krbtgt/HADOOP.COM@HADOOP.COM","title":"\u4f7f\u7528"},{"location":"roles/auth/openldap/","text":"Ansible Role: openldap \u00b6 \u5b89\u88c5openldap\u670d\u52a1 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.8.1 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 openldap_packages: - openldap - compat-openldap - openldap-clients - openldap-servers - openldap-servers-sql - openldap-devel - migrationtools - rsyslog openldap_dc: \"dc=lework,dc=com\" openldap_passwd: 123456 openldap_log: /var/log/slapd.log \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/openldap Example Playbook \u00b6 # \u9ed8\u8ba4\u5b89\u88c5 --- - hosts: 192.168.77.131 roles: - openldap # \u6307\u5b9adc\u548c\u5bc6\u7801 --- - hosts: 192.168.77.131 vars: - openldap_dc: dc=lework,dc=local - openldap_passwd: abcdefg roles: - openldap","title":"openldap"},{"location":"roles/auth/openldap/#ansible-role-openldap","text":"\u5b89\u88c5openldap\u670d\u52a1","title":"Ansible Role: openldap"},{"location":"roles/auth/openldap/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/auth/openldap/#_2","text":"ansible 2.8.1 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/auth/openldap/#_3","text":"openldap_packages: - openldap - compat-openldap - openldap-clients - openldap-servers - openldap-servers-sql - openldap-devel - migrationtools - rsyslog openldap_dc: \"dc=lework,dc=com\" openldap_passwd: 123456 openldap_log: /var/log/slapd.log","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/auth/openldap/#_4","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/auth/openldap/#github","text":"https://github.com/lework/Ansible-roles/tree/master/openldap","title":"github\u5730\u5740"},{"location":"roles/auth/openldap/#example-playbook","text":"# \u9ed8\u8ba4\u5b89\u88c5 --- - hosts: 192.168.77.131 roles: - openldap # \u6307\u5b9adc\u548c\u5bc6\u7801 --- - hosts: 192.168.77.131 vars: - openldap_dc: dc=lework,dc=local - openldap_passwd: abcdefg roles: - openldap","title":"Example Playbook"},{"location":"roles/bigdata/airflow/","text":"Ansible Role: airflow \u00b6 \u5b89\u88c5airflow \u4ecb\u7ecd \u00b6 Airflow \u88ab Airbnb \u5185\u90e8\u7528\u6765\u521b\u5efa\u3001\u76d1\u63a7\u548c\u8c03\u6574\u6570\u636e\u7ba1\u9053\u3002\u4efb\u4f55\u5de5\u4f5c\u6d41\u90fd\u53ef\u4ee5\u5728\u8fd9\u4e2a\u4f7f\u7528 Python \u7f16\u5199\u7684\u5e73\u53f0\u4e0a\u8fd0\u884c\uff08\u76ee\u524d\u52a0\u5165 Apache \u57fa\u91d1\u4f1a\u5b75\u5316\u5668\uff09\u3002 Airflow \u5141\u8bb8\u5de5\u4f5c\u6d41\u5f00\u53d1\u4eba\u5458\u8f7b\u677e\u521b\u5efa\u3001\u7ef4\u62a4\u548c\u5468\u671f\u6027\u5730\u8c03\u5ea6\u8fd0\u884c\u5de5\u4f5c\u6d41\uff08\u5373\u6709\u5411\u65e0\u73af\u56fe\u6216\u6210\u4e3aDAGs\uff09\u7684\u5de5\u5177\u3002\u5728Airbnb\u4e2d\uff0c\u8fd9\u4e9b\u5de5\u4f5c\u6d41\u5305\u62ec\u4e86\u5982\u6570\u636e\u5b58\u50a8\u3001\u589e\u957f\u5206\u6790\u3001Email\u53d1\u9001\u3001A/B\u6d4b\u8bd5\u7b49\u7b49\u8fd9\u4e9b\u8de8\u8d8a\u591a\u90e8\u95e8\u7684\u7528\u4f8b\u3002\u8fd9\u4e2a\u5e73\u53f0\u62e5\u6709\u548c Hive\u3001Presto\u3001MySQL\u3001HDFS\u3001Postgres\u548cS3\u4ea4\u4e92\u7684\u80fd\u529b\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u94a9\u5b50\u4f7f\u5f97\u7cfb\u7edf\u62e5\u6709\u5f88\u597d\u5730\u6269\u5c55\u6027\u3002\u9664\u4e86\u4e00\u4e2a\u547d\u4ee4\u884c\u754c\u9762\uff0c\u8be5\u5de5\u5177\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a \u57fa\u4e8eWeb\u7684\u7528\u6237\u754c\u9762\u8ba9\u60a8\u53ef\u4ee5\u53ef\u89c6\u5316\u7ba1\u9053\u7684\u4f9d\u8d56\u5173\u7cfb\u3001\u76d1\u63a7\u8fdb\u5ea6\u3001\u89e6\u53d1\u4efb\u52a1\u7b49\u3002 github\u5730\u5740\uff1a https://github.com/apache/incubator-airflow \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://airflow.incubator.apache.org/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 airflow_home: \"/airflow\" airflow_tmpdir: \"/tmp/airflow\" airflow_bin: \"/usr/local/bin/airflow\" airflow_user: \"airflow\" airflow_extra: [hive,hdfs,jdbc,mysql,async,postgres,rabbitmq,qds,password,ldap] airflow_db: \"airflow\" mysql_host: \"\" mysql_port: \"\" mysql_user: \"\" mysql_password: \"\" create_db: true change_utctime: true airflow_port: 8080 env: \"HOME=/home/{{ airflow_user }},AIRFLOW_HOME={{ airflow_home }},TMPDIR={{ airflow_tmpdir }}\" \u4f9d\u8d56 \u00b6 python2.7 supervisor github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/airflow Example Playbook \u00b6 - hosts: node1 vars: airflow_home: '/airflow' mysql_host: 192.168.77.128 mysql_port: 3306 mysql_user: root mysql_password: 123456 supervisor_name: airflow airflow_port: 8081 supervisor_program: - { name: 'webserver', command: '/usr/local/bin/airflow webserver', user: 'airflow' } - { name: 'scheduler', command: '/usr/local/bin/airflow scheduler', user: 'airflow' } roles: - { role: python2.7 } - { role: airflow } - { role: supervisor }","title":"airflow"},{"location":"roles/bigdata/airflow/#ansible-role-airflow","text":"\u5b89\u88c5airflow","title":"Ansible Role: airflow"},{"location":"roles/bigdata/airflow/#_1","text":"Airflow \u88ab Airbnb \u5185\u90e8\u7528\u6765\u521b\u5efa\u3001\u76d1\u63a7\u548c\u8c03\u6574\u6570\u636e\u7ba1\u9053\u3002\u4efb\u4f55\u5de5\u4f5c\u6d41\u90fd\u53ef\u4ee5\u5728\u8fd9\u4e2a\u4f7f\u7528 Python \u7f16\u5199\u7684\u5e73\u53f0\u4e0a\u8fd0\u884c\uff08\u76ee\u524d\u52a0\u5165 Apache \u57fa\u91d1\u4f1a\u5b75\u5316\u5668\uff09\u3002 Airflow \u5141\u8bb8\u5de5\u4f5c\u6d41\u5f00\u53d1\u4eba\u5458\u8f7b\u677e\u521b\u5efa\u3001\u7ef4\u62a4\u548c\u5468\u671f\u6027\u5730\u8c03\u5ea6\u8fd0\u884c\u5de5\u4f5c\u6d41\uff08\u5373\u6709\u5411\u65e0\u73af\u56fe\u6216\u6210\u4e3aDAGs\uff09\u7684\u5de5\u5177\u3002\u5728Airbnb\u4e2d\uff0c\u8fd9\u4e9b\u5de5\u4f5c\u6d41\u5305\u62ec\u4e86\u5982\u6570\u636e\u5b58\u50a8\u3001\u589e\u957f\u5206\u6790\u3001Email\u53d1\u9001\u3001A/B\u6d4b\u8bd5\u7b49\u7b49\u8fd9\u4e9b\u8de8\u8d8a\u591a\u90e8\u95e8\u7684\u7528\u4f8b\u3002\u8fd9\u4e2a\u5e73\u53f0\u62e5\u6709\u548c Hive\u3001Presto\u3001MySQL\u3001HDFS\u3001Postgres\u548cS3\u4ea4\u4e92\u7684\u80fd\u529b\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u94a9\u5b50\u4f7f\u5f97\u7cfb\u7edf\u62e5\u6709\u5f88\u597d\u5730\u6269\u5c55\u6027\u3002\u9664\u4e86\u4e00\u4e2a\u547d\u4ee4\u884c\u754c\u9762\uff0c\u8be5\u5de5\u5177\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a \u57fa\u4e8eWeb\u7684\u7528\u6237\u754c\u9762\u8ba9\u60a8\u53ef\u4ee5\u53ef\u89c6\u5316\u7ba1\u9053\u7684\u4f9d\u8d56\u5173\u7cfb\u3001\u76d1\u63a7\u8fdb\u5ea6\u3001\u89e6\u53d1\u4efb\u52a1\u7b49\u3002 github\u5730\u5740\uff1a https://github.com/apache/incubator-airflow \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://airflow.incubator.apache.org/","title":"\u4ecb\u7ecd"},{"location":"roles/bigdata/airflow/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/bigdata/airflow/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/bigdata/airflow/#_4","text":"airflow_home: \"/airflow\" airflow_tmpdir: \"/tmp/airflow\" airflow_bin: \"/usr/local/bin/airflow\" airflow_user: \"airflow\" airflow_extra: [hive,hdfs,jdbc,mysql,async,postgres,rabbitmq,qds,password,ldap] airflow_db: \"airflow\" mysql_host: \"\" mysql_port: \"\" mysql_user: \"\" mysql_password: \"\" create_db: true change_utctime: true airflow_port: 8080 env: \"HOME=/home/{{ airflow_user }},AIRFLOW_HOME={{ airflow_home }},TMPDIR={{ airflow_tmpdir }}\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/bigdata/airflow/#_5","text":"python2.7 supervisor","title":"\u4f9d\u8d56"},{"location":"roles/bigdata/airflow/#github","text":"https://github.com/lework/Ansible-roles/tree/master/airflow","title":"github\u5730\u5740"},{"location":"roles/bigdata/airflow/#example-playbook","text":"- hosts: node1 vars: airflow_home: '/airflow' mysql_host: 192.168.77.128 mysql_port: 3306 mysql_user: root mysql_password: 123456 supervisor_name: airflow airflow_port: 8081 supervisor_program: - { name: 'webserver', command: '/usr/local/bin/airflow webserver', user: 'airflow' } - { name: 'scheduler', command: '/usr/local/bin/airflow scheduler', user: 'airflow' } roles: - { role: python2.7 } - { role: airflow } - { role: supervisor }","title":"Example Playbook"},{"location":"roles/bigdata/cdh5-agent/","text":"Ansible Role: cdh5 agent \u00b6 \u5b89\u88c5cdh5 agent \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" cdh5_version: \"5.11.0\" cdh5_rpms_url: \"http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/{{ cdh5_version }}/RPMS/x86_64\" cdh5_cm_daemons: \"cloudera-manager-daemons-5.11.0-1.cm5110.p0.101.el6.x86_64.rpm\" cdh5_cm_daemons_url: \"{{ cdh5_rpms_url }}/{{ cdh5_cm_daemons }}\" cdh5_cm_agent: \"cloudera-manager-agent-5.11.0-1.cm5110.p0.101.el6.x86_64.rpm\" cdh5_cm_agent_url: \"{{ cdh5_rpms_url }}/{{ cdh5_cm_agent }}\" cdh5_server_host: 'localhost' \u4f9d\u8d56 \u00b6 cdh5-pre github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/cdh5-agent Example Playbook \u00b6 - hosts: cdh5-agent vars: - cdh5_server_host: '192.168.77.129' roles: - { role: cdh5-agent } \u4f7f\u7528 \u00b6 # service cloudera-scm-agent Usage: cloudera-scm-agent {start|stop|restart|clean_start|hard_stop|hard_restart|clean_restart|status|condrestart}","title":"cdh5-agent"},{"location":"roles/bigdata/cdh5-agent/#ansible-role-cdh5-agent","text":"\u5b89\u88c5cdh5 agent","title":"Ansible Role: cdh5 agent"},{"location":"roles/bigdata/cdh5-agent/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/bigdata/cdh5-agent/#_2","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/bigdata/cdh5-agent/#_3","text":"software_files_path: \"/opt/software\" cdh5_version: \"5.11.0\" cdh5_rpms_url: \"http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/{{ cdh5_version }}/RPMS/x86_64\" cdh5_cm_daemons: \"cloudera-manager-daemons-5.11.0-1.cm5110.p0.101.el6.x86_64.rpm\" cdh5_cm_daemons_url: \"{{ cdh5_rpms_url }}/{{ cdh5_cm_daemons }}\" cdh5_cm_agent: \"cloudera-manager-agent-5.11.0-1.cm5110.p0.101.el6.x86_64.rpm\" cdh5_cm_agent_url: \"{{ cdh5_rpms_url }}/{{ cdh5_cm_agent }}\" cdh5_server_host: 'localhost'","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/bigdata/cdh5-agent/#_4","text":"cdh5-pre","title":"\u4f9d\u8d56"},{"location":"roles/bigdata/cdh5-agent/#github","text":"https://github.com/lework/Ansible-roles/tree/master/cdh5-agent","title":"github\u5730\u5740"},{"location":"roles/bigdata/cdh5-agent/#example-playbook","text":"- hosts: cdh5-agent vars: - cdh5_server_host: '192.168.77.129' roles: - { role: cdh5-agent }","title":"Example Playbook"},{"location":"roles/bigdata/cdh5-agent/#_5","text":"# service cloudera-scm-agent Usage: cloudera-scm-agent {start|stop|restart|clean_start|hard_stop|hard_restart|clean_restart|status|condrestart}","title":"\u4f7f\u7528"},{"location":"roles/bigdata/cdh5-pre/","text":"Ansible Role: cdh5 pre \u00b6 \u5b89\u88c5cdh5\u65f6\u9700\u8981\u505a\u7684\u9884\u5904\u7406\u64cd\u4f5c. \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" cdh5_version: \"5.11.0\" cdh5_rpms_url: \"http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/{{ cdh5_version }}/RPMS/x86_64\" cdh5_jdk: \"oracle-j2sdk1.7-1.7.0+update67-1.x86_64.rpm\" cdh5_file_path: \"{{ software_files_path }}/{{ cdh5_jdk }}\" cdh5_jdk_url: \"{{ cdh5_rpms_url }}/{{ cdh5_jdk }}\" cdh5_java_home: \"/usr/java/jdk1.7.0_67-cloudera\" jdbc_version: \"5.1.40\" jdbc_file: \"mysql-connector-java-{{ jdbc_version }}.tar.gz\" jdbc_file_path: \"{{ software_files_path }}/{{ jdbc_file }}\" jdbc_jar_file: \"mysql-connector-java-{{ jdbc_version}}/mysql-connector-java-{{ jdbc_version }}-bin.jar\" jdbc_file_url: \"http://101.96.10.44/dev.mysql.com/get/Downloads/Connector-J/{{ jdbc_file }}\" \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/cdh5-pre Example Playbook \u00b6 - hosts: cdh5-all vars: - ipnames: '192.168.77.129': 'master' '192.168.77.130': 'node1' '192.168.77.131': 'node2' roles: - { role: cdh5-pre }","title":"cdh5-pre"},{"location":"roles/bigdata/cdh5-pre/#ansible-role-cdh5-pre","text":"\u5b89\u88c5cdh5\u65f6\u9700\u8981\u505a\u7684\u9884\u5904\u7406\u64cd\u4f5c.","title":"Ansible Role: cdh5 pre"},{"location":"roles/bigdata/cdh5-pre/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/bigdata/cdh5-pre/#_2","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/bigdata/cdh5-pre/#_3","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" cdh5_version: \"5.11.0\" cdh5_rpms_url: \"http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/{{ cdh5_version }}/RPMS/x86_64\" cdh5_jdk: \"oracle-j2sdk1.7-1.7.0+update67-1.x86_64.rpm\" cdh5_file_path: \"{{ software_files_path }}/{{ cdh5_jdk }}\" cdh5_jdk_url: \"{{ cdh5_rpms_url }}/{{ cdh5_jdk }}\" cdh5_java_home: \"/usr/java/jdk1.7.0_67-cloudera\" jdbc_version: \"5.1.40\" jdbc_file: \"mysql-connector-java-{{ jdbc_version }}.tar.gz\" jdbc_file_path: \"{{ software_files_path }}/{{ jdbc_file }}\" jdbc_jar_file: \"mysql-connector-java-{{ jdbc_version}}/mysql-connector-java-{{ jdbc_version }}-bin.jar\" jdbc_file_url: \"http://101.96.10.44/dev.mysql.com/get/Downloads/Connector-J/{{ jdbc_file }}\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/bigdata/cdh5-pre/#_4","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/bigdata/cdh5-pre/#github","text":"https://github.com/lework/Ansible-roles/tree/master/cdh5-pre","title":"github\u5730\u5740"},{"location":"roles/bigdata/cdh5-pre/#example-playbook","text":"- hosts: cdh5-all vars: - ipnames: '192.168.77.129': 'master' '192.168.77.130': 'node1' '192.168.77.131': 'node2' roles: - { role: cdh5-pre }","title":"Example Playbook"},{"location":"roles/bigdata/cdh5-server/","text":"Ansible Role: cdh5 server \u00b6 \u53ea\u5b89\u88c5cdh5 server\u670d\u52a1\uff0c\u4e0d\u5b89\u88c5hadoop\u96c6\u7fa4\u3002 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" cdh5_version: \"5.11.0\" cdh5_rpms_url: \"http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/{{ cdh5_version }}/RPMS/x86_64\" cdh5_cm_daemons: \"cloudera-manager-daemons-5.11.0-1.cm5110.p0.101.el6.x86_64.rpm\" cdh5_cm_daemons_url: \"{{ cdh5_rpms_url }}/{{ cdh5_cm_daemons }}\" cdh5_cm_server: \"cloudera-manager-server-5.11.0-1.cm5110.p0.101.el6.x86_64.rpm\" cdh5_cm_server_url: \"{{ cdh5_rpms_url }}/{{ cdh5_cm_server }}\" cdh5_parcels_url: \"http://archive.cloudera.com/cdh5/parcels/{{ cdh5_version }}\" cdh5_parcels_cdh: \"CDH-5.11.0-1.cdh5.11.0.p0.34-el6.parcel\" cdh5_parcels_cdh_url: \"{{ cdh5_parcels_url }}/{{ cdh5_parcels_cdh }}\" cdh5_parcels_cdh_sha: \"CDH-5.11.0-1.cdh5.11.0.p0.34-el6.parcel.sha1\" cdh5_parcels_cdh_sha_url: \"{{ cdh5_parcels_url }}/{{ cdh5_parcels_cdh_sha }}\" cdh5_parcels_manifest: \"manifest.json\" cdh5_parcels_manifest_url: \"{{ cdh5_parcels_url }}/{{ cdh5_parcels_manifest }}\" jdbc_version: \"5.1.40\" jdbc_file: \"mysql-connector-java-{{ jdbc_version }}.tar.gz\" jdbc_file_path: \"{{ software_files_path }}/{{ jdbc_file }}\" jdbc_jar_file: \"mysql-connector-java-{{ jdbc_version}}/mysql-connector-java-{{ jdbc_version }}-bin.jar\" jdbc_file_url: \"http://101.96.10.44/dev.mysql.com/get/Downloads/Connector-J/{{ jdbc_file }}\" cmf_db_host: \"{{ mysql_host | default('localhost') }}\" cmf_db_port: \"{{ mysql_port | default('3306') }}\" cmf_db_name: 'cmf' cmf_db_user: 'cmf' cmf_db_pass: '123456' hive_db_name: 'hive' hive_db_user: 'hive' hive_db_pass: '123456' amon_db_name: 'amon' amon_db_user: 'amon' amon_db_pass: '123456' hue_db_name: 'hue' hue_db_user: 'hue' hue_db_pass: '123456' oozie_db_name: 'oozie' oozie_db_user: 'oozie' oozie_db_pass: '123456' \u4f9d\u8d56 \u00b6 cdh5-pre cdh5-agent github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/cdh5-server Example Playbook \u00b6 - hosts: cdh5-server vars: - mysql_host: 192.168.77.129 - mysql_user: root - mysql_password: 123456 - mysql_binlog_format: 'MiXED' roles: - { role: mysql } - { role: cdh5-server } \u4f7f\u7528 \u00b6 \u547d\u4ee4\u4f7f\u7528 # service cloudera-scm-server Usage: cloudera-scm-server {start|force_start|stop|restart|status|condrestart} web \u4f7f\u7528 http://master:7180/cmf/login \u9ed8\u8ba4\u7528\u6237\u540d/\u5bc6\u7801: admin/admin \u7136\u540e\u8ddf\u7740web\u9875\u9762\u4e00\u6b65\u4e00\u6b65\u7684\u90e8\u7f72hadoop\u96c6\u7fa4","title":"cdh5-server"},{"location":"roles/bigdata/cdh5-server/#ansible-role-cdh5-server","text":"\u53ea\u5b89\u88c5cdh5 server\u670d\u52a1\uff0c\u4e0d\u5b89\u88c5hadoop\u96c6\u7fa4\u3002","title":"Ansible Role: cdh5 server"},{"location":"roles/bigdata/cdh5-server/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/bigdata/cdh5-server/#_2","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/bigdata/cdh5-server/#_3","text":"software_files_path: \"/opt/software\" cdh5_version: \"5.11.0\" cdh5_rpms_url: \"http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/{{ cdh5_version }}/RPMS/x86_64\" cdh5_cm_daemons: \"cloudera-manager-daemons-5.11.0-1.cm5110.p0.101.el6.x86_64.rpm\" cdh5_cm_daemons_url: \"{{ cdh5_rpms_url }}/{{ cdh5_cm_daemons }}\" cdh5_cm_server: \"cloudera-manager-server-5.11.0-1.cm5110.p0.101.el6.x86_64.rpm\" cdh5_cm_server_url: \"{{ cdh5_rpms_url }}/{{ cdh5_cm_server }}\" cdh5_parcels_url: \"http://archive.cloudera.com/cdh5/parcels/{{ cdh5_version }}\" cdh5_parcels_cdh: \"CDH-5.11.0-1.cdh5.11.0.p0.34-el6.parcel\" cdh5_parcels_cdh_url: \"{{ cdh5_parcels_url }}/{{ cdh5_parcels_cdh }}\" cdh5_parcels_cdh_sha: \"CDH-5.11.0-1.cdh5.11.0.p0.34-el6.parcel.sha1\" cdh5_parcels_cdh_sha_url: \"{{ cdh5_parcels_url }}/{{ cdh5_parcels_cdh_sha }}\" cdh5_parcels_manifest: \"manifest.json\" cdh5_parcels_manifest_url: \"{{ cdh5_parcels_url }}/{{ cdh5_parcels_manifest }}\" jdbc_version: \"5.1.40\" jdbc_file: \"mysql-connector-java-{{ jdbc_version }}.tar.gz\" jdbc_file_path: \"{{ software_files_path }}/{{ jdbc_file }}\" jdbc_jar_file: \"mysql-connector-java-{{ jdbc_version}}/mysql-connector-java-{{ jdbc_version }}-bin.jar\" jdbc_file_url: \"http://101.96.10.44/dev.mysql.com/get/Downloads/Connector-J/{{ jdbc_file }}\" cmf_db_host: \"{{ mysql_host | default('localhost') }}\" cmf_db_port: \"{{ mysql_port | default('3306') }}\" cmf_db_name: 'cmf' cmf_db_user: 'cmf' cmf_db_pass: '123456' hive_db_name: 'hive' hive_db_user: 'hive' hive_db_pass: '123456' amon_db_name: 'amon' amon_db_user: 'amon' amon_db_pass: '123456' hue_db_name: 'hue' hue_db_user: 'hue' hue_db_pass: '123456' oozie_db_name: 'oozie' oozie_db_user: 'oozie' oozie_db_pass: '123456'","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/bigdata/cdh5-server/#_4","text":"cdh5-pre cdh5-agent","title":"\u4f9d\u8d56"},{"location":"roles/bigdata/cdh5-server/#github","text":"https://github.com/lework/Ansible-roles/tree/master/cdh5-server","title":"github\u5730\u5740"},{"location":"roles/bigdata/cdh5-server/#example-playbook","text":"- hosts: cdh5-server vars: - mysql_host: 192.168.77.129 - mysql_user: root - mysql_password: 123456 - mysql_binlog_format: 'MiXED' roles: - { role: mysql } - { role: cdh5-server }","title":"Example Playbook"},{"location":"roles/bigdata/cdh5-server/#_5","text":"\u547d\u4ee4\u4f7f\u7528 # service cloudera-scm-server Usage: cloudera-scm-server {start|force_start|stop|restart|status|condrestart} web \u4f7f\u7528 http://master:7180/cmf/login \u9ed8\u8ba4\u7528\u6237\u540d/\u5bc6\u7801: admin/admin \u7136\u540e\u8ddf\u7740web\u9875\u9762\u4e00\u6b65\u4e00\u6b65\u7684\u90e8\u7f72hadoop\u96c6\u7fa4","title":"\u4f7f\u7528"},{"location":"roles/bigdata/hadoop-standalone/","text":"Ansible Role: hadoop-standalone \u00b6 \u4ee5standalone\u65b9\u5f0f\u5b89\u88c5hadoop \u4ecb\u7ecd \u00b6 Hadoop\u662f\u4e00\u4e2a\u7531Apache\u57fa\u91d1\u4f1a\u6240\u5f00\u53d1\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u57fa\u7840\u67b6\u6784\u3002 \u7528\u6237\u53ef\u4ee5\u5728\u4e0d\u4e86\u89e3\u5206\u5e03\u5f0f\u5e95\u5c42\u7ec6\u8282\u7684\u60c5\u51b5\u4e0b\uff0c\u5f00\u53d1\u5206\u5e03\u5f0f\u7a0b\u5e8f\u3002\u5145\u5206\u5229\u7528\u96c6\u7fa4\u7684\u5a01\u529b\u8fdb\u884c\u9ad8\u901f\u8fd0\u7b97\u548c\u5b58\u50a8\u3002 \u5b98\u65b9\u5730\u5740\uff1a http://hadoop.apache.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://hadoop.apache.org/docs/r2.7.3 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" hadoop_standalone_version: \"2.7.3\" hadoop_standalone_file: \"hadoop-{{ hadoop_standalone_version }}.tar.gz\" hadoop_standalone_file_path: \"{{ software_files_path }}/{{ hadoop_standalone_file }}\" hadoop_standalone_file_url: \"https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-{{ hadoop_standalone_version }}/{{ hadoop_standalone_file }}\" hadoop_standalone_user: \"hadoop\" hadoop_standalone_home: \"{{ software_install_path }}/hadoop-{{ hadoop_standalone_version }}\" \u4f9d\u8d56 \u00b6 java github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/hadoop-standalone Example Playbook \u00b6 - hosts: node1 roles: - { role: hadoop-standalone }","title":"hadoop-standalone"},{"location":"roles/bigdata/hadoop-standalone/#ansible-role-hadoop-standalone","text":"\u4ee5standalone\u65b9\u5f0f\u5b89\u88c5hadoop","title":"Ansible Role: hadoop-standalone"},{"location":"roles/bigdata/hadoop-standalone/#_1","text":"Hadoop\u662f\u4e00\u4e2a\u7531Apache\u57fa\u91d1\u4f1a\u6240\u5f00\u53d1\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u57fa\u7840\u67b6\u6784\u3002 \u7528\u6237\u53ef\u4ee5\u5728\u4e0d\u4e86\u89e3\u5206\u5e03\u5f0f\u5e95\u5c42\u7ec6\u8282\u7684\u60c5\u51b5\u4e0b\uff0c\u5f00\u53d1\u5206\u5e03\u5f0f\u7a0b\u5e8f\u3002\u5145\u5206\u5229\u7528\u96c6\u7fa4\u7684\u5a01\u529b\u8fdb\u884c\u9ad8\u901f\u8fd0\u7b97\u548c\u5b58\u50a8\u3002 \u5b98\u65b9\u5730\u5740\uff1a http://hadoop.apache.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://hadoop.apache.org/docs/r2.7.3","title":"\u4ecb\u7ecd"},{"location":"roles/bigdata/hadoop-standalone/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/bigdata/hadoop-standalone/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/bigdata/hadoop-standalone/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" hadoop_standalone_version: \"2.7.3\" hadoop_standalone_file: \"hadoop-{{ hadoop_standalone_version }}.tar.gz\" hadoop_standalone_file_path: \"{{ software_files_path }}/{{ hadoop_standalone_file }}\" hadoop_standalone_file_url: \"https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-{{ hadoop_standalone_version }}/{{ hadoop_standalone_file }}\" hadoop_standalone_user: \"hadoop\" hadoop_standalone_home: \"{{ software_install_path }}/hadoop-{{ hadoop_standalone_version }}\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/bigdata/hadoop-standalone/#_5","text":"java","title":"\u4f9d\u8d56"},{"location":"roles/bigdata/hadoop-standalone/#github","text":"https://github.com/lework/Ansible-roles/tree/master/hadoop-standalone","title":"github\u5730\u5740"},{"location":"roles/bigdata/hadoop-standalone/#example-playbook","text":"- hosts: node1 roles: - { role: hadoop-standalone }","title":"Example Playbook"},{"location":"roles/bigdata/superset/","text":"Ansible Role: superset \u00b6 \u5b89\u88c5superset \u4ecb\u7ecd \u00b6 Superset\uff08Caravel\uff09\u662f\u7531Airbnb\uff08\u77e5\u540d\u5728\u7ebf\u623f\u5c4b\u77ed\u79df\u516c\u53f8\uff09\u5f00\u6e90\u7684\u6570\u636e\u5206\u6790\u4e0e\u53ef\u89c6\u5316\u5e73\u53f0\uff08\u66fe\u7528\u540dCaravel\u3001Panoramix\uff09\uff0c\u8be5\u5de5\u5177\u4e3b\u8981\u7279\u70b9\u662f\u53ef\u81ea\u52a9\u5206\u6790\u3001\u81ea\u5b9a\u4e49\u4eea\u8868\u76d8\u3001\u5206\u6790\u7ed3\u679c\u53ef\u89c6\u5316\uff08\u5bfc\u51fa\uff09\u3001\u7528\u6237/\u89d2\u8272\u6743\u9650\u63a7\u5236\uff0c\u8fd8\u96c6\u6210\u4e86\u4e00\u4e2aSQL\u7f16\u8f91\u5668\uff0c\u53ef\u4ee5\u8fdb\u884cSQL\u7f16\u8f91\u67e5\u8be2\u7b49\u3002 Superset\uff08Caravel\uff09\u6838\u5fc3\u529f\u80fd\uff1a 1.\u5feb\u901f\u521b\u5efa\u6570\u636e\u53ef\u89c6\u5316\u4e92\u52a8\u4eea\u8868\u76d8 2.\u4e30\u5bcc\u7684\u53ef\u89c6\u5316\u56fe\u8868\u6a21\u677f\uff0c\u7075\u6d3b\u53ef\u6269\u5c55 3.\u7ec6\u7c92\u5ea6\u9ad8\u53ef\u6269\u5c55\u6027\u7684\u5b89\u5168\u8bbf\u95ee\u6a21\u578b\uff0c\u652f\u6301\u4e3b\u8981\u7684\u8ba4\u8bc1\u4f9b\u5e94\u5546\uff08\u6570\u636e\u5e93\u3001OpenID\u3001LDAP\u3001OAuth \u7b49\uff09 4.\u7b80\u6d01\u7684\u8bed\u4e49\u5c42\uff0c\u53ef\u4ee5\u63a7\u5236\u6570\u636e\u8d44\u6e90\u5728 UI \u7684\u5c55\u73b0\u65b9\u5f0f 5.\u4e0e Druid\uff08\u5176\u5b9e\u5b83\u8c8c\u4f3c\u5c31\u662f\u4e3a\u4e86druid\u800c\u751f\u7684\uff09\u6df1\u5ea6\u96c6\u6210\uff0c\u53ef\u4ee5\u5feb\u901f\u89e3\u6790\u5927\u89c4\u6a21\u6570\u636e\u96c6 6.\u5feb\u901f\u7684\u901a\u8fc7\u914d\u7f6e\u88c5\u8f7d\u4eea\u8868\u76d8\u7b49 github\u5730\u5740\uff1a https://github.com/airbnb/superset \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://airbnb.io/superset/installation.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 superset_bin: \"/usr/local/bin/superset\" superset_user: \"superset\" superset_db: \"superset\" superset_app: \"superset\" superset_username: \"admin\" superset_firstname: \"admin\" superset_lastname: \"admin\" superset_email: \"admin@example.com\" superset_password: \"123456\" mysql_host: \"\" mysql_port: \"\" mysql_user: \"\" mysql_password: \"\" create_db: true superset_port: 8080 env: \"HOME=/home/{{ superset_user }}\" \u4f9d\u8d56 \u00b6 python2.7 supervisor github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/superset Example Playbook \u00b6 - hosts: node1 vars: superset_home: '/superset' mysql_host: 192.168.77.128 mysql_port: 3306 mysql_user: root mysql_password: 123456 supervisor_name: superset supervisor_program: - { name: 'superset', command: '/usr/local/bin/superset runserver', user: 'superset' } roles: - { role: python2.7 } - { role: superset } - { role: supervisor } \u7ba1\u7406 \u00b6 \u4f7f\u7528supervisor\u542f\u52a8superset /usr/local/bin/supervisord -c /etc/supervisor/conf/superset.conf \u542f\u52a8superset\u7a0b\u5e8f service superset start \u5173\u95edsuperset\u7a0b\u5e8f service superset stop \u5173\u95edsupervisor service superset shutdown","title":"superset"},{"location":"roles/bigdata/superset/#ansible-role-superset","text":"\u5b89\u88c5superset","title":"Ansible Role: superset"},{"location":"roles/bigdata/superset/#_1","text":"Superset\uff08Caravel\uff09\u662f\u7531Airbnb\uff08\u77e5\u540d\u5728\u7ebf\u623f\u5c4b\u77ed\u79df\u516c\u53f8\uff09\u5f00\u6e90\u7684\u6570\u636e\u5206\u6790\u4e0e\u53ef\u89c6\u5316\u5e73\u53f0\uff08\u66fe\u7528\u540dCaravel\u3001Panoramix\uff09\uff0c\u8be5\u5de5\u5177\u4e3b\u8981\u7279\u70b9\u662f\u53ef\u81ea\u52a9\u5206\u6790\u3001\u81ea\u5b9a\u4e49\u4eea\u8868\u76d8\u3001\u5206\u6790\u7ed3\u679c\u53ef\u89c6\u5316\uff08\u5bfc\u51fa\uff09\u3001\u7528\u6237/\u89d2\u8272\u6743\u9650\u63a7\u5236\uff0c\u8fd8\u96c6\u6210\u4e86\u4e00\u4e2aSQL\u7f16\u8f91\u5668\uff0c\u53ef\u4ee5\u8fdb\u884cSQL\u7f16\u8f91\u67e5\u8be2\u7b49\u3002 Superset\uff08Caravel\uff09\u6838\u5fc3\u529f\u80fd\uff1a 1.\u5feb\u901f\u521b\u5efa\u6570\u636e\u53ef\u89c6\u5316\u4e92\u52a8\u4eea\u8868\u76d8 2.\u4e30\u5bcc\u7684\u53ef\u89c6\u5316\u56fe\u8868\u6a21\u677f\uff0c\u7075\u6d3b\u53ef\u6269\u5c55 3.\u7ec6\u7c92\u5ea6\u9ad8\u53ef\u6269\u5c55\u6027\u7684\u5b89\u5168\u8bbf\u95ee\u6a21\u578b\uff0c\u652f\u6301\u4e3b\u8981\u7684\u8ba4\u8bc1\u4f9b\u5e94\u5546\uff08\u6570\u636e\u5e93\u3001OpenID\u3001LDAP\u3001OAuth \u7b49\uff09 4.\u7b80\u6d01\u7684\u8bed\u4e49\u5c42\uff0c\u53ef\u4ee5\u63a7\u5236\u6570\u636e\u8d44\u6e90\u5728 UI \u7684\u5c55\u73b0\u65b9\u5f0f 5.\u4e0e Druid\uff08\u5176\u5b9e\u5b83\u8c8c\u4f3c\u5c31\u662f\u4e3a\u4e86druid\u800c\u751f\u7684\uff09\u6df1\u5ea6\u96c6\u6210\uff0c\u53ef\u4ee5\u5feb\u901f\u89e3\u6790\u5927\u89c4\u6a21\u6570\u636e\u96c6 6.\u5feb\u901f\u7684\u901a\u8fc7\u914d\u7f6e\u88c5\u8f7d\u4eea\u8868\u76d8\u7b49 github\u5730\u5740\uff1a https://github.com/airbnb/superset \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://airbnb.io/superset/installation.html","title":"\u4ecb\u7ecd"},{"location":"roles/bigdata/superset/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/bigdata/superset/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/bigdata/superset/#_4","text":"superset_bin: \"/usr/local/bin/superset\" superset_user: \"superset\" superset_db: \"superset\" superset_app: \"superset\" superset_username: \"admin\" superset_firstname: \"admin\" superset_lastname: \"admin\" superset_email: \"admin@example.com\" superset_password: \"123456\" mysql_host: \"\" mysql_port: \"\" mysql_user: \"\" mysql_password: \"\" create_db: true superset_port: 8080 env: \"HOME=/home/{{ superset_user }}\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/bigdata/superset/#_5","text":"python2.7 supervisor","title":"\u4f9d\u8d56"},{"location":"roles/bigdata/superset/#github","text":"https://github.com/lework/Ansible-roles/tree/master/superset","title":"github\u5730\u5740"},{"location":"roles/bigdata/superset/#example-playbook","text":"- hosts: node1 vars: superset_home: '/superset' mysql_host: 192.168.77.128 mysql_port: 3306 mysql_user: root mysql_password: 123456 supervisor_name: superset supervisor_program: - { name: 'superset', command: '/usr/local/bin/superset runserver', user: 'superset' } roles: - { role: python2.7 } - { role: superset } - { role: supervisor }","title":"Example Playbook"},{"location":"roles/bigdata/superset/#_6","text":"\u4f7f\u7528supervisor\u542f\u52a8superset /usr/local/bin/supervisord -c /etc/supervisor/conf/superset.conf \u542f\u52a8superset\u7a0b\u5e8f service superset start \u5173\u95edsuperset\u7a0b\u5e8f service superset stop \u5173\u95edsupervisor service superset shutdown","title":"\u7ba1\u7406"},{"location":"roles/ci/deploy-image/","text":"Ansible Role: deploy-image \u00b6 \u90e8\u7f72docker image \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.5.3 os Centos 7.4.1708 X64 docker 18.03.1-ce \u89d2\u8272\u53d8\u91cf \u00b6 # \u4ee3\u7801\u6587\u4ef6 deploy_service_file: \"\" # \u4ee3\u7801\u8def\u5f84 deploy_service_path: \"\" # \u5e94\u7528\u7684\u7aef\u53e3 deploy_service_port: \"\" # \u7b49\u5f85\u591a\u5c11\u79d2\u68c0\u6d4b\u7aef\u53e3 deploy_service_port_delay: 1 # \u68c0\u6d4b\u7aef\u53e3\u8d85\u65f6\u65f6\u95f4 deploy_service_port_timeout: 90 # image\u7684\u540d\u79f0 deploy_image_name: \"\" # image\u7684tag deploy_image_tag: \"{{ deploy_image_name }}:latest\" # image\u7684Dockerfile deploy_image_dockerfile: \"\" # \u7f51\u7edc deploy_container_network: \"default\" # container\u7684\u540d\u79f0 deploy_container_name: \"{{ deploy_image_name }}\" # container\u7684\u4e3b\u673a\u540d deploy_container_hostname: \"{{ deploy_image_name }}\" # container\u7aef\u53e3\u7ed1\u5b9a deploy_container_publish: - \"{{ deploy_service_port}}:{{ deploy_service_port}}\" # container\u76ee\u5f55\u7ed1\u5b9a deploy_container_volume: - \"/tmp/:/tmp/\" # container \u73af\u5883\u53d8\u91cf deploy_container_env: [] # container ip deploy_container_ip: \"\" deploy_docker_bin: \"/usr/bin/docker\" # image\u7f16\u8bd1\u811a\u672c deploy_image_build: > {{ deploy_docker_bin }} build --no-cache --build-arg APP_FILE={{ deploy_service_file }} --build-arg SERVER_PORT={{ deploy_service_port }} -f {{ deploy_image_dockerfile}} -t {{ deploy_image_tag }} {{ deploy_service_path }} # image\u4e0a\u4f20\u811a\u672c deploy_image_push: > {{ deploy_docker_bin }} push {{ deploy_image_tag }} # image\u62c9\u53d6\u811a\u672c deploy_image_pull: > {{ deploy_docker_bin }} pull {{ deploy_image_tag }} # container\u5173\u95ed\u547d\u4ee4 deploy_container_stop: > {{ deploy_docker_bin }} stop {{ deploy_container_name }} && {{ deploy_docker_bin }} rm {{ deploy_container_name }} || echo error # container\u8fd0\u884c\u547d\u4ee4 deploy_container_run: > {{ deploy_docker_bin }} run -tid --net {{ deploy_container_network }} --name {{ deploy_container_name }} -h {{ deploy_container_hostname }} {% for p in deploy_container_publish %}-p {{ p }} {% endfor %} {% for v in deploy_container_volume %}-v {{ v }} {% endfor %} {% if deploy_container_ip %}--ip {{ deploy_container_ip }}{% endif %} --restart=always {{ deploy_image_tag }} # \u6e05\u9664\u65e0\u7528\u7684\u955c\u50cf deploy_clear: true deploy_clear_run: > {{ deploy_docker_bin }} rmi --force $({{ deploy_docker_bin }} images | grep 'none' | awk '{print $3}') # \u9a8c\u8bc1uri deploy_verify_uri: \"\" deploy_verify_url: \"http://127.0.0.1:{{ deploy_service_port }}{{ deploy_verify_uri }}\" # \u662f\u5426\u56de\u6eda deploy_rollback: false \u4f9d\u8d56 \u00b6 docker docker hub github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/deploy-image Example Playbook \u00b6 # \u53d1\u5e03image - hosts: docker3 serial: \"50%\" gather_facts: false vars: - deploy_service_file: \"test.war\" - deploy_service_path: \"/data/jenkins/workspace/test/dist/\" - deploy_service_port: 26381 - deploy_image_name: \"test\" - deploy_image_tag: \"127.0.0.1/docker3/test:master\" - deploy_image_dockerfile: \"/opt/images/Dockerfile_tomcat7\" - deploy_container_network: \"test\" - deploy_container_publish: - \"26381:26381\" - deploy_container_volume: - \"/tmp/:/tmp/\" - \"/var/log/test:/usr/local/tomcat/logs\" roles: - deploy-image # \u56de\u6edaimage - hosts: docker3 serial: \"50%\" gather_facts: false vars: - deploy_rollback: true - deploy_service_port: 26381 - deploy_image_name: \"test\" - deploy_image_tag: \"127.0.0.1/docker3/test:v1.0\" - deploy_container_network: \"test\" - deploy_container_publish: - \"26381:26381\" - deploy_container_volume: - \"/tmp:/tmp\" - \"/var/log/test:/usr/local/tomcat/logs\" roles: - deploy-image","title":"deploy-image"},{"location":"roles/ci/deploy-image/#ansible-role-deploy-image","text":"\u90e8\u7f72docker image","title":"Ansible Role: deploy-image"},{"location":"roles/ci/deploy-image/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/ci/deploy-image/#_2","text":"ansible 2.5.3 os Centos 7.4.1708 X64 docker 18.03.1-ce","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/ci/deploy-image/#_3","text":"# \u4ee3\u7801\u6587\u4ef6 deploy_service_file: \"\" # \u4ee3\u7801\u8def\u5f84 deploy_service_path: \"\" # \u5e94\u7528\u7684\u7aef\u53e3 deploy_service_port: \"\" # \u7b49\u5f85\u591a\u5c11\u79d2\u68c0\u6d4b\u7aef\u53e3 deploy_service_port_delay: 1 # \u68c0\u6d4b\u7aef\u53e3\u8d85\u65f6\u65f6\u95f4 deploy_service_port_timeout: 90 # image\u7684\u540d\u79f0 deploy_image_name: \"\" # image\u7684tag deploy_image_tag: \"{{ deploy_image_name }}:latest\" # image\u7684Dockerfile deploy_image_dockerfile: \"\" # \u7f51\u7edc deploy_container_network: \"default\" # container\u7684\u540d\u79f0 deploy_container_name: \"{{ deploy_image_name }}\" # container\u7684\u4e3b\u673a\u540d deploy_container_hostname: \"{{ deploy_image_name }}\" # container\u7aef\u53e3\u7ed1\u5b9a deploy_container_publish: - \"{{ deploy_service_port}}:{{ deploy_service_port}}\" # container\u76ee\u5f55\u7ed1\u5b9a deploy_container_volume: - \"/tmp/:/tmp/\" # container \u73af\u5883\u53d8\u91cf deploy_container_env: [] # container ip deploy_container_ip: \"\" deploy_docker_bin: \"/usr/bin/docker\" # image\u7f16\u8bd1\u811a\u672c deploy_image_build: > {{ deploy_docker_bin }} build --no-cache --build-arg APP_FILE={{ deploy_service_file }} --build-arg SERVER_PORT={{ deploy_service_port }} -f {{ deploy_image_dockerfile}} -t {{ deploy_image_tag }} {{ deploy_service_path }} # image\u4e0a\u4f20\u811a\u672c deploy_image_push: > {{ deploy_docker_bin }} push {{ deploy_image_tag }} # image\u62c9\u53d6\u811a\u672c deploy_image_pull: > {{ deploy_docker_bin }} pull {{ deploy_image_tag }} # container\u5173\u95ed\u547d\u4ee4 deploy_container_stop: > {{ deploy_docker_bin }} stop {{ deploy_container_name }} && {{ deploy_docker_bin }} rm {{ deploy_container_name }} || echo error # container\u8fd0\u884c\u547d\u4ee4 deploy_container_run: > {{ deploy_docker_bin }} run -tid --net {{ deploy_container_network }} --name {{ deploy_container_name }} -h {{ deploy_container_hostname }} {% for p in deploy_container_publish %}-p {{ p }} {% endfor %} {% for v in deploy_container_volume %}-v {{ v }} {% endfor %} {% if deploy_container_ip %}--ip {{ deploy_container_ip }}{% endif %} --restart=always {{ deploy_image_tag }} # \u6e05\u9664\u65e0\u7528\u7684\u955c\u50cf deploy_clear: true deploy_clear_run: > {{ deploy_docker_bin }} rmi --force $({{ deploy_docker_bin }} images | grep 'none' | awk '{print $3}') # \u9a8c\u8bc1uri deploy_verify_uri: \"\" deploy_verify_url: \"http://127.0.0.1:{{ deploy_service_port }}{{ deploy_verify_uri }}\" # \u662f\u5426\u56de\u6eda deploy_rollback: false","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/ci/deploy-image/#_4","text":"docker docker hub","title":"\u4f9d\u8d56"},{"location":"roles/ci/deploy-image/#github","text":"https://github.com/lework/Ansible-roles/tree/master/deploy-image","title":"github\u5730\u5740"},{"location":"roles/ci/deploy-image/#example-playbook","text":"# \u53d1\u5e03image - hosts: docker3 serial: \"50%\" gather_facts: false vars: - deploy_service_file: \"test.war\" - deploy_service_path: \"/data/jenkins/workspace/test/dist/\" - deploy_service_port: 26381 - deploy_image_name: \"test\" - deploy_image_tag: \"127.0.0.1/docker3/test:master\" - deploy_image_dockerfile: \"/opt/images/Dockerfile_tomcat7\" - deploy_container_network: \"test\" - deploy_container_publish: - \"26381:26381\" - deploy_container_volume: - \"/tmp/:/tmp/\" - \"/var/log/test:/usr/local/tomcat/logs\" roles: - deploy-image # \u56de\u6edaimage - hosts: docker3 serial: \"50%\" gather_facts: false vars: - deploy_rollback: true - deploy_service_port: 26381 - deploy_image_name: \"test\" - deploy_image_tag: \"127.0.0.1/docker3/test:v1.0\" - deploy_container_network: \"test\" - deploy_container_publish: - \"26381:26381\" - deploy_container_volume: - \"/tmp:/tmp\" - \"/var/log/test:/usr/local/tomcat/logs\" roles: - deploy-image","title":"Example Playbook"},{"location":"roles/ci/deploy-static/","text":"Ansible Role: deploy-static \u00b6 \u90e8\u7f72\u9759\u6001\u6587\u4ef6,\u5982web\u9875\u9762\u3001php\u5e94\u7528 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.5.1 os Centos 7.2.1511 X64 \u89d2\u8272\u53d8\u91cf \u00b6 # \u53d1\u5e03\u7684\u4ee3\u7801\u6587\u4ef6\uff0c\u5305\u542b\u7edd\u5bf9\u8def\u5f84\uff0c\u5982:/tmp/test.jar deploy_file: \"\" # \u53d1\u5e03\u670d\u52a1\u540d\u79f0 deploy_service: \"\" # \u53d1\u5e03\u6587\u4ef6\u7684\u7528\u6237 deploy_service_user: \"\" # \u53d1\u5e03\u670d\u52a1\u7684\u5bb6\u76ee\u5f55 deploy_service_workpath: \"/Microservices/{{ deploy_service }}\" # \u4e34\u65f6\u76ee\u5f55 deploy_file_path: \"/packages\" # \u4e0a\u7ebf\u4ee3\u7801\u7684\u5b58\u50a8\u76ee\u5f55 deploy_code_online_path: \"{{ deploy_file_path }}/online/{{ deploy_service }}\" # \u5f53\u524d\u4ee3\u7801(\u4e5f\u5c31\u662f\u4e0a\u4e00\u7248\u672c\u7684\u4ee3\u7801)\u7684\u5b58\u50a8\u76ee\u5f55 deploy_code_previous_path: \"{{ deploy_file_path }}/previous/{{ deploy_service }}\" # \u5386\u53f2\u4ee3\u7801\u5b58\u50a8\u76ee\u5f55 deploy_code_history_path: \"{{ deploy_file_path }}/history/{{ deploy_service }}\" # \u662f\u5426\u56de\u6eda deploy_rollback: false # \u68c0\u67e5uri deploy_verify_uri: \"\" \u4f9d\u8d56 \u00b6 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/deploy-static Example Playbook \u00b6 # \u53d1\u5e03\u4ee3\u7801 - hosts: node1 vars: - deploy_file: /tmp/web.tar.gz - deploy_service: web - deploy_service_user: apache - deploy_verify_uri: \"/index.html\" roles: - deploy-static # \u56de\u6eda\u4ee3\u7801\uff0c\u53ea\u80fd\u56de\u6eda\u4e0a\u4e00\u6b21\u7ebf\u4e0a\u4ee3\u7801\uff0c\u5e94\u7528\u4e8e\u5f53\u524d\u53d1\u5e03\u7a0b\u5e8f\u6709\u95ee\u9898\u56de\u6eda\u6b63\u5e38\u7248\u672c\u573a\u666f\u3002 - hosts: node1 vars: - deploy_rollback: true - deploy_service: web - deploy_service_user: apache - deploy_verify_uri: \"/index.html\" roles: - deploy-static","title":"deploy-static"},{"location":"roles/ci/deploy-static/#ansible-role-deploy-static","text":"\u90e8\u7f72\u9759\u6001\u6587\u4ef6,\u5982web\u9875\u9762\u3001php\u5e94\u7528","title":"Ansible Role: deploy-static"},{"location":"roles/ci/deploy-static/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/ci/deploy-static/#_2","text":"ansible 2.5.1 os Centos 7.2.1511 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/ci/deploy-static/#_3","text":"# \u53d1\u5e03\u7684\u4ee3\u7801\u6587\u4ef6\uff0c\u5305\u542b\u7edd\u5bf9\u8def\u5f84\uff0c\u5982:/tmp/test.jar deploy_file: \"\" # \u53d1\u5e03\u670d\u52a1\u540d\u79f0 deploy_service: \"\" # \u53d1\u5e03\u6587\u4ef6\u7684\u7528\u6237 deploy_service_user: \"\" # \u53d1\u5e03\u670d\u52a1\u7684\u5bb6\u76ee\u5f55 deploy_service_workpath: \"/Microservices/{{ deploy_service }}\" # \u4e34\u65f6\u76ee\u5f55 deploy_file_path: \"/packages\" # \u4e0a\u7ebf\u4ee3\u7801\u7684\u5b58\u50a8\u76ee\u5f55 deploy_code_online_path: \"{{ deploy_file_path }}/online/{{ deploy_service }}\" # \u5f53\u524d\u4ee3\u7801(\u4e5f\u5c31\u662f\u4e0a\u4e00\u7248\u672c\u7684\u4ee3\u7801)\u7684\u5b58\u50a8\u76ee\u5f55 deploy_code_previous_path: \"{{ deploy_file_path }}/previous/{{ deploy_service }}\" # \u5386\u53f2\u4ee3\u7801\u5b58\u50a8\u76ee\u5f55 deploy_code_history_path: \"{{ deploy_file_path }}/history/{{ deploy_service }}\" # \u662f\u5426\u56de\u6eda deploy_rollback: false # \u68c0\u67e5uri deploy_verify_uri: \"\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/ci/deploy-static/#_4","text":"","title":"\u4f9d\u8d56"},{"location":"roles/ci/deploy-static/#github","text":"https://github.com/lework/Ansible-roles/tree/master/deploy-static","title":"github\u5730\u5740"},{"location":"roles/ci/deploy-static/#example-playbook","text":"# \u53d1\u5e03\u4ee3\u7801 - hosts: node1 vars: - deploy_file: /tmp/web.tar.gz - deploy_service: web - deploy_service_user: apache - deploy_verify_uri: \"/index.html\" roles: - deploy-static # \u56de\u6eda\u4ee3\u7801\uff0c\u53ea\u80fd\u56de\u6eda\u4e0a\u4e00\u6b21\u7ebf\u4e0a\u4ee3\u7801\uff0c\u5e94\u7528\u4e8e\u5f53\u524d\u53d1\u5e03\u7a0b\u5e8f\u6709\u95ee\u9898\u56de\u6eda\u6b63\u5e38\u7248\u672c\u573a\u666f\u3002 - hosts: node1 vars: - deploy_rollback: true - deploy_service: web - deploy_service_user: apache - deploy_verify_uri: \"/index.html\" roles: - deploy-static","title":"Example Playbook"},{"location":"roles/ci/deploy-supervisor/","text":"Ansible Role: deploy-supervisor \u00b6 \u90e8\u7f72spring boot \u5e94\u7528, spring boot\u7531supervisor\u7ba1\u7406 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.5.1 os Centos 7.2.1511 X64 python 2.7.5 supervisor 3.3.4 \u89d2\u8272\u53d8\u91cf \u00b6 # \u53d1\u5e03\u7684\u4ee3\u7801\u6587\u4ef6\uff0c\u5305\u542b\u7edd\u5bf9\u8def\u5f84\uff0c\u5982:/tmp/test.jar deploy_file: \"\" # supervisor\u5e94\u7528\u7684\u7aef\u53e3 deploy_service_port: \"\" # \u7b49\u5f85\u591a\u5c11\u79d2\u68c0\u6d4b\u7aef\u53e3 deploy_service_port_delay: 1 # \u68c0\u6d4b\u7aef\u53e3\u8d85\u65f6\u65f6\u95f4 deploy_service_port_timeout: 90 # supervisor\u5e94\u7528\u7684\u540d\u79f0 deploy_service_name: \"\" # \u670d\u52a1\u6587\u4ef6 deploy_service_file: \"\" # \u53d1\u5e03\u670d\u52a1\u7528\u6237 deploy_service_user: \"spring\" # \u53d1\u5e03\u670d\u52a1\u7684\u5bb6\u76ee\u5f55 deploy_service_workpath: \"/Microservices\" # supervisorctl \u7ba1\u7406\u7a0b\u5e8f deploy_service_start_script: \"/usr/bin/supervisorctl\" # \u9a8c\u8bc1uri deploy_verify_uri: \"\" deploy_verify_url: \"http://127.0.0.1:{{ deploy_service_port }}{{ deploy_verify_uri }}\" # \u4e34\u65f6\u76ee\u5f55 deploy_file_path: \"/packages\" # \u4e0a\u7ebf\u4ee3\u7801\u7684\u5b58\u50a8\u76ee\u5f55 deploy_code_online_path: \"{{ deploy_file_path }}/online\" # \u5f53\u524d\u4ee3\u7801(\u4e5f\u5c31\u662f\u4e0a\u4e00\u7248\u672c\u7684\u4ee3\u7801)\u7684\u5b58\u50a8\u76ee\u5f55 deploy_code_previous_path: \"{{ deploy_file_path }}/previous\" # \u5386\u53f2\u4ee3\u7801\u5b58\u50a8\u76ee\u5f55 deploy_code_history_path: \"{{ deploy_file_path }}/history\" # \u662f\u5426\u56de\u6eda deploy_rollback: false \u4f9d\u8d56 \u00b6 supervisor {{ deploy_service_name }}\u7684\u503c \u5e94\u4e3asupervisor\u5e94\u7528\u540d\u79f0 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/deploy-supervisor Example Playbook \u00b6 # \u53d1\u5e03\u4ee3\u7801 - hosts: node1 vars: - deploy_file: /opt/test.jar - deploy_service_name: test_spingboot - deploy_service_port: 8084 - deploy_verify_uri: \"/\" roles: - deploy-supervisor # \u56de\u6eda\u4ee3\u7801\uff0c\u53ea\u80fd\u56de\u6eda\u4e0a\u4e00\u6b21\u7ebf\u4e0a\u4ee3\u7801\uff0c\u5e94\u7528\u4e8e\u5f53\u524d\u53d1\u5e03\u7a0b\u5e8f\u6709\u95ee\u9898\u56de\u6eda\u6b63\u5e38\u7248\u672c\u573a\u666f\u3002 - hosts: node1 vars: - deploy_rollback: true - deploy_service_file: test.jar - deploy_service_name: test_spingboot - deploy_service_port: 8084 - deploy_verify_uri: \"/\" roles: - deploy-supervisor","title":"deploy-supervisor"},{"location":"roles/ci/deploy-supervisor/#ansible-role-deploy-supervisor","text":"\u90e8\u7f72spring boot \u5e94\u7528, spring boot\u7531supervisor\u7ba1\u7406","title":"Ansible Role: deploy-supervisor"},{"location":"roles/ci/deploy-supervisor/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/ci/deploy-supervisor/#_2","text":"ansible 2.5.1 os Centos 7.2.1511 X64 python 2.7.5 supervisor 3.3.4","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/ci/deploy-supervisor/#_3","text":"# \u53d1\u5e03\u7684\u4ee3\u7801\u6587\u4ef6\uff0c\u5305\u542b\u7edd\u5bf9\u8def\u5f84\uff0c\u5982:/tmp/test.jar deploy_file: \"\" # supervisor\u5e94\u7528\u7684\u7aef\u53e3 deploy_service_port: \"\" # \u7b49\u5f85\u591a\u5c11\u79d2\u68c0\u6d4b\u7aef\u53e3 deploy_service_port_delay: 1 # \u68c0\u6d4b\u7aef\u53e3\u8d85\u65f6\u65f6\u95f4 deploy_service_port_timeout: 90 # supervisor\u5e94\u7528\u7684\u540d\u79f0 deploy_service_name: \"\" # \u670d\u52a1\u6587\u4ef6 deploy_service_file: \"\" # \u53d1\u5e03\u670d\u52a1\u7528\u6237 deploy_service_user: \"spring\" # \u53d1\u5e03\u670d\u52a1\u7684\u5bb6\u76ee\u5f55 deploy_service_workpath: \"/Microservices\" # supervisorctl \u7ba1\u7406\u7a0b\u5e8f deploy_service_start_script: \"/usr/bin/supervisorctl\" # \u9a8c\u8bc1uri deploy_verify_uri: \"\" deploy_verify_url: \"http://127.0.0.1:{{ deploy_service_port }}{{ deploy_verify_uri }}\" # \u4e34\u65f6\u76ee\u5f55 deploy_file_path: \"/packages\" # \u4e0a\u7ebf\u4ee3\u7801\u7684\u5b58\u50a8\u76ee\u5f55 deploy_code_online_path: \"{{ deploy_file_path }}/online\" # \u5f53\u524d\u4ee3\u7801(\u4e5f\u5c31\u662f\u4e0a\u4e00\u7248\u672c\u7684\u4ee3\u7801)\u7684\u5b58\u50a8\u76ee\u5f55 deploy_code_previous_path: \"{{ deploy_file_path }}/previous\" # \u5386\u53f2\u4ee3\u7801\u5b58\u50a8\u76ee\u5f55 deploy_code_history_path: \"{{ deploy_file_path }}/history\" # \u662f\u5426\u56de\u6eda deploy_rollback: false","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/ci/deploy-supervisor/#_4","text":"supervisor {{ deploy_service_name }}\u7684\u503c \u5e94\u4e3asupervisor\u5e94\u7528\u540d\u79f0","title":"\u4f9d\u8d56"},{"location":"roles/ci/deploy-supervisor/#github","text":"https://github.com/lework/Ansible-roles/tree/master/deploy-supervisor","title":"github\u5730\u5740"},{"location":"roles/ci/deploy-supervisor/#example-playbook","text":"# \u53d1\u5e03\u4ee3\u7801 - hosts: node1 vars: - deploy_file: /opt/test.jar - deploy_service_name: test_spingboot - deploy_service_port: 8084 - deploy_verify_uri: \"/\" roles: - deploy-supervisor # \u56de\u6eda\u4ee3\u7801\uff0c\u53ea\u80fd\u56de\u6eda\u4e0a\u4e00\u6b21\u7ebf\u4e0a\u4ee3\u7801\uff0c\u5e94\u7528\u4e8e\u5f53\u524d\u53d1\u5e03\u7a0b\u5e8f\u6709\u95ee\u9898\u56de\u6eda\u6b63\u5e38\u7248\u672c\u573a\u666f\u3002 - hosts: node1 vars: - deploy_rollback: true - deploy_service_file: test.jar - deploy_service_name: test_spingboot - deploy_service_port: 8084 - deploy_verify_uri: \"/\" roles: - deploy-supervisor","title":"Example Playbook"},{"location":"roles/ci/deploy-tomcat/","text":"Ansible Role: deploy-tomcat \u00b6 \u90e8\u7f72war\u5305\u81f3tomcat\u5bb9\u5668 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 # \u53d1\u5e03\u7684\u4ee3\u7801\u6587\u4ef6\uff0c\u5305\u542b\u7edd\u5bf9\u8def\u5f84\uff0c\u5982:/tmp/test.war deploy_file: \"\" # tomcat\u670d\u52a1\u7684\u7aef\u53e3 deploy_service_port: \"8080\" # tomcat\u670d\u52a1\u7528\u6237 deploy_service_user: \"tomcat\" # tomcat\u670d\u52a1\u7684\u540d\u79f0 deploy_service_name: \"tomcat{% if deploy_service_port != 8080 %}{{ deploy_service_port }}{% endif %}\" # \u53d1\u5e03\u670d\u52a1\u7684\u5bb6\u76ee\u5f55 deploy_file_workpath: \"/usr/local/{{ deploy_service_name }}/webapps/ROOT\" # \u542f\u52a8\u811a\u672c deploy_service_start_script: \"/etc/init.d/{{ deploy_service_name }}\" # \u4e34\u65f6\u76ee\u5f55 deploy_file_path: \"/packages\" # \u4e0a\u7ebf\u4ee3\u7801\u7684\u5b58\u50a8\u76ee\u5f55 deploy_new_path: \"{{ deploy_file_path }}/online/{{ deploy_service_name }}\" # \u5f53\u524d\u4ee3\u7801(\u4e5f\u5c31\u662f\u4e0a\u4e00\u7248\u672c\u7684\u4ee3\u7801)\u7684\u5b58\u50a8\u76ee\u5f55 deploy_pre_path: \"{{ deploy_file_path }}/previous/{{ deploy_service_name }}\" # \u5386\u53f2\u4ee3\u7801\u5b58\u50a8\u76ee\u5f55 deploy_old_path: \"{{ deploy_file_path }}/history/{{ deploy_service_name }}\" # \u662f\u5426\u56de\u6eda deploy_rollback: false # \u9a8c\u8bc1uri deploy_verify_uri: \"\" deploy_verify_url: \"http://127.0.0.1:{{ deploy_service_port }}{{ deploy_verify_uri }}\" \u4f9d\u8d56 \u00b6 tomcat github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/deploy-tomcat Example Playbook \u00b6 # \u53d1\u5e03\u4ee3\u7801 - hosts: node1 roles: - role: { role: deploy-tomcat, deploy_port: 8071, deploy_file\uff1a/root/tomcat_*_test.war } # \u56de\u6eda\u4ee3\u7801 - hosts: node1 roles: - role: { role: deploy-tomcat, deploy_rollback: true }","title":"deploy-tomcat"},{"location":"roles/ci/deploy-tomcat/#ansible-role-deploy-tomcat","text":"\u90e8\u7f72war\u5305\u81f3tomcat\u5bb9\u5668","title":"Ansible Role: deploy-tomcat"},{"location":"roles/ci/deploy-tomcat/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/ci/deploy-tomcat/#_2","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/ci/deploy-tomcat/#_3","text":"# \u53d1\u5e03\u7684\u4ee3\u7801\u6587\u4ef6\uff0c\u5305\u542b\u7edd\u5bf9\u8def\u5f84\uff0c\u5982:/tmp/test.war deploy_file: \"\" # tomcat\u670d\u52a1\u7684\u7aef\u53e3 deploy_service_port: \"8080\" # tomcat\u670d\u52a1\u7528\u6237 deploy_service_user: \"tomcat\" # tomcat\u670d\u52a1\u7684\u540d\u79f0 deploy_service_name: \"tomcat{% if deploy_service_port != 8080 %}{{ deploy_service_port }}{% endif %}\" # \u53d1\u5e03\u670d\u52a1\u7684\u5bb6\u76ee\u5f55 deploy_file_workpath: \"/usr/local/{{ deploy_service_name }}/webapps/ROOT\" # \u542f\u52a8\u811a\u672c deploy_service_start_script: \"/etc/init.d/{{ deploy_service_name }}\" # \u4e34\u65f6\u76ee\u5f55 deploy_file_path: \"/packages\" # \u4e0a\u7ebf\u4ee3\u7801\u7684\u5b58\u50a8\u76ee\u5f55 deploy_new_path: \"{{ deploy_file_path }}/online/{{ deploy_service_name }}\" # \u5f53\u524d\u4ee3\u7801(\u4e5f\u5c31\u662f\u4e0a\u4e00\u7248\u672c\u7684\u4ee3\u7801)\u7684\u5b58\u50a8\u76ee\u5f55 deploy_pre_path: \"{{ deploy_file_path }}/previous/{{ deploy_service_name }}\" # \u5386\u53f2\u4ee3\u7801\u5b58\u50a8\u76ee\u5f55 deploy_old_path: \"{{ deploy_file_path }}/history/{{ deploy_service_name }}\" # \u662f\u5426\u56de\u6eda deploy_rollback: false # \u9a8c\u8bc1uri deploy_verify_uri: \"\" deploy_verify_url: \"http://127.0.0.1:{{ deploy_service_port }}{{ deploy_verify_uri }}\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/ci/deploy-tomcat/#_4","text":"tomcat","title":"\u4f9d\u8d56"},{"location":"roles/ci/deploy-tomcat/#github","text":"https://github.com/lework/Ansible-roles/tree/master/deploy-tomcat","title":"github\u5730\u5740"},{"location":"roles/ci/deploy-tomcat/#example-playbook","text":"# \u53d1\u5e03\u4ee3\u7801 - hosts: node1 roles: - role: { role: deploy-tomcat, deploy_port: 8071, deploy_file\uff1a/root/tomcat_*_test.war } # \u56de\u6eda\u4ee3\u7801 - hosts: node1 roles: - role: { role: deploy-tomcat, deploy_rollback: true }","title":"Example Playbook"},{"location":"roles/ci/jenkins/","text":"Ansible Role: Jenkins CI \u00b6 \u5b89\u88c5Jenkins CI \u4ecb\u7ecd \u00b6 Jenkins \u662f\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u63d0\u4f9b\u4e86\u4e00\u79cd\u6613\u4e8e\u4f7f\u7528\u7684\u6301\u7eed\u96c6\u6210\u7cfb\u7edf\uff0c\u4f7f\u5f00\u53d1\u8005\u4ece\u7e41\u6742\u7684\u96c6\u6210\u4e2d\u89e3\u8131\u51fa\u6765\uff0c\u4e13\u6ce8\u4e8e\u66f4\u4e3a\u91cd\u8981\u7684\u4e1a\u52a1\u903b\u8f91\u5b9e\u73b0\u4e0a\u3002\u540c\u65f6 Jenkins \u80fd\u5b9e\u65bd\u76d1\u63a7\u96c6\u6210\u4e2d\u5b58\u5728\u7684\u9519\u8bef\uff0c\u63d0\u4f9b\u8be6\u7ec6\u7684\u65e5\u5fd7\u6587\u4ef6\u548c\u63d0\u9192\u529f\u80fd\uff0c\u8fd8\u80fd\u7528\u56fe\u8868\u7684\u5f62\u5f0f\u5f62\u8c61\u5730\u5c55\u793a\u9879\u76ee\u6784\u5efa\u7684\u8d8b\u52bf\u548c\u7a33\u5b9a\u6027\u3002 \u5b98\u65b9\uff1a https://jenkins.io/ github: https://github.com/jenkinsci/jenkins \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u5728Debian\u548cRHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 7, Debian 9, Debian 10 \u89d2\u8272\u53d8\u91cf \u00b6 \u9ed8\u8ba4\u53d8\u91cf software_files_path : \"/opt/software\" jenkins_version : \"2.223\" jenkins_home : /var/lib/jenkins jenkins_hostname : localhost jenkins_http_port : 8080 jenkins_jar_location : \"{{ jenkins_home }}/jenkins-cli.jar\" jenkins_url_prefix : \"\" jenkins_java_options : \"-Djenkins.install.runSetupWizard=false\" jenkins_admin_username : admin jenkins_admin_password : admin jenkins_updates_url : \"https://cdn.jsdelivr.net/gh/lework/jenkins-update-center/updates/tencent/update-center.json\" jenkins_init_changes : - option : \"JENKINS_ARGS\" value : \"--prefix={{ jenkins_url_prefix }}\" - option : \"{{ jenkins_java_options_env_var }}\" value : \"{{ jenkins_java_options }}\" jenkins_plugins_recommended : - ant - msbuild - gradle - maven-plugin - nodejs - antisamy-markup-formatter - build-timeout - cloudbees-folder - credentials-binding - email-ext - git - git-parameter - subversion - ldap - matrix-auth - pam-auth - pipeline-stage-view - ssh-slaves - publish-over-ssh - windows-slaves - timestamper - workflow-aggregator - ws-cleanup - ansible - ansicolor - multiple-scms - role-strategy - show-build-parameters jenkins_plugins_extra : [] Debian \u53d8\u91cf __package : - curl - gnupg - initscripts - libselinux1 - apt-transport-https __repo_file : jenkins.list __repo_path : /etc/apt/sources.list.d/ jenkins_file : \"jenkins_{{ jenkins_version }}_all.deb\" jenkins_packages_url : \"https://mirrors.cloud.tencent.com/jenkins/debian/{{ jenkins_file }}\" jenkins_init_file : /etc/default/jenkins jenkins_http_port_param : HTTP_PORT jenkins_java_options_env_var : JAVA_ARGS RedHat \u53d8\u91cf __package : - curl - libselinux-python - initscripts __repo_file : jenkins.repo __repo_path : /etc/yum.repos.d/ jenkins_repo_key_url : https://pkg.jenkins.io/redhat/jenkins.io.key jenkins_file : \"jenkins-{{ jenkins_version }}-1.1.noarch.rpm\" jenkins_packages_url : \"https://mirrors.cloud.tencent.com/jenkins/redhat/{{ jenkins_file }}\" jenkins_init_file : /etc/sysconfig/jenkins jenkins_http_port_param : JENKINS_PORT jenkins_java_options_env_var : JENKINS_JAVA_OPTIONS \u4f9d\u8d56 \u00b6 java (2.53\u4ee5\u4e0a\u7248\u672c\u9700\u89811.8+) github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/jenkins Example Playbook \u00b6 # \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - { role : java , java_version : \"1.8\" } - jenkins # \u6307\u5b9a\u53d8\u91cf - hosts : node1 vars : - jenkins_version : 2.223 - jenkins_admin_password : 123456 - jenkins_http_port\uff1a 8888 - jenkins_plugins_extra\uff1a - display-console-output - ansible roles : - { role : java , java_version : \"1.8\" } - jenkins \u4f7f\u7528 \u00b6 systemctl status jenkins systemctl start jenkins systemctl stop jenkins","title":"jenkins"},{"location":"roles/ci/jenkins/#ansible-role-jenkins-ci","text":"\u5b89\u88c5Jenkins CI","title":"Ansible Role: Jenkins CI"},{"location":"roles/ci/jenkins/#_1","text":"Jenkins \u662f\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u63d0\u4f9b\u4e86\u4e00\u79cd\u6613\u4e8e\u4f7f\u7528\u7684\u6301\u7eed\u96c6\u6210\u7cfb\u7edf\uff0c\u4f7f\u5f00\u53d1\u8005\u4ece\u7e41\u6742\u7684\u96c6\u6210\u4e2d\u89e3\u8131\u51fa\u6765\uff0c\u4e13\u6ce8\u4e8e\u66f4\u4e3a\u91cd\u8981\u7684\u4e1a\u52a1\u903b\u8f91\u5b9e\u73b0\u4e0a\u3002\u540c\u65f6 Jenkins \u80fd\u5b9e\u65bd\u76d1\u63a7\u96c6\u6210\u4e2d\u5b58\u5728\u7684\u9519\u8bef\uff0c\u63d0\u4f9b\u8be6\u7ec6\u7684\u65e5\u5fd7\u6587\u4ef6\u548c\u63d0\u9192\u529f\u80fd\uff0c\u8fd8\u80fd\u7528\u56fe\u8868\u7684\u5f62\u5f0f\u5f62\u8c61\u5730\u5c55\u793a\u9879\u76ee\u6784\u5efa\u7684\u8d8b\u52bf\u548c\u7a33\u5b9a\u6027\u3002 \u5b98\u65b9\uff1a https://jenkins.io/ github: https://github.com/jenkinsci/jenkins","title":"\u4ecb\u7ecd"},{"location":"roles/ci/jenkins/#_2","text":"\u6b64\u89d2\u8272\u5728Debian\u548cRHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/ci/jenkins/#_3","text":"ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 7, Debian 9, Debian 10","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/ci/jenkins/#_4","text":"\u9ed8\u8ba4\u53d8\u91cf software_files_path : \"/opt/software\" jenkins_version : \"2.223\" jenkins_home : /var/lib/jenkins jenkins_hostname : localhost jenkins_http_port : 8080 jenkins_jar_location : \"{{ jenkins_home }}/jenkins-cli.jar\" jenkins_url_prefix : \"\" jenkins_java_options : \"-Djenkins.install.runSetupWizard=false\" jenkins_admin_username : admin jenkins_admin_password : admin jenkins_updates_url : \"https://cdn.jsdelivr.net/gh/lework/jenkins-update-center/updates/tencent/update-center.json\" jenkins_init_changes : - option : \"JENKINS_ARGS\" value : \"--prefix={{ jenkins_url_prefix }}\" - option : \"{{ jenkins_java_options_env_var }}\" value : \"{{ jenkins_java_options }}\" jenkins_plugins_recommended : - ant - msbuild - gradle - maven-plugin - nodejs - antisamy-markup-formatter - build-timeout - cloudbees-folder - credentials-binding - email-ext - git - git-parameter - subversion - ldap - matrix-auth - pam-auth - pipeline-stage-view - ssh-slaves - publish-over-ssh - windows-slaves - timestamper - workflow-aggregator - ws-cleanup - ansible - ansicolor - multiple-scms - role-strategy - show-build-parameters jenkins_plugins_extra : [] Debian \u53d8\u91cf __package : - curl - gnupg - initscripts - libselinux1 - apt-transport-https __repo_file : jenkins.list __repo_path : /etc/apt/sources.list.d/ jenkins_file : \"jenkins_{{ jenkins_version }}_all.deb\" jenkins_packages_url : \"https://mirrors.cloud.tencent.com/jenkins/debian/{{ jenkins_file }}\" jenkins_init_file : /etc/default/jenkins jenkins_http_port_param : HTTP_PORT jenkins_java_options_env_var : JAVA_ARGS RedHat \u53d8\u91cf __package : - curl - libselinux-python - initscripts __repo_file : jenkins.repo __repo_path : /etc/yum.repos.d/ jenkins_repo_key_url : https://pkg.jenkins.io/redhat/jenkins.io.key jenkins_file : \"jenkins-{{ jenkins_version }}-1.1.noarch.rpm\" jenkins_packages_url : \"https://mirrors.cloud.tencent.com/jenkins/redhat/{{ jenkins_file }}\" jenkins_init_file : /etc/sysconfig/jenkins jenkins_http_port_param : JENKINS_PORT jenkins_java_options_env_var : JENKINS_JAVA_OPTIONS","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/ci/jenkins/#_5","text":"java (2.53\u4ee5\u4e0a\u7248\u672c\u9700\u89811.8+)","title":"\u4f9d\u8d56"},{"location":"roles/ci/jenkins/#github","text":"https://github.com/lework/Ansible-roles/tree/master/jenkins","title":"github\u5730\u5740"},{"location":"roles/ci/jenkins/#example-playbook","text":"# \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - { role : java , java_version : \"1.8\" } - jenkins # \u6307\u5b9a\u53d8\u91cf - hosts : node1 vars : - jenkins_version : 2.223 - jenkins_admin_password : 123456 - jenkins_http_port\uff1a 8888 - jenkins_plugins_extra\uff1a - display-console-output - ansible roles : - { role : java , java_version : \"1.8\" } - jenkins","title":"Example Playbook"},{"location":"roles/ci/jenkins/#_6","text":"systemctl status jenkins systemctl start jenkins systemctl stop jenkins","title":"\u4f7f\u7528"},{"location":"roles/ci/nexus/","text":"Ansible Role: nexus \u00b6 \u5b89\u88c5nexus \u4ecb\u7ecd \u00b6 Sonatype Nexus\u662f\u4e16\u754c\u9886\u5148\u7684\u4ed3\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u5728\u4e16\u754c\u8303\u56f4\u5185Nexus OSS\uff0cNexus Pro\u6216Nexus Pro CLM\u5c06\u8fd150000\u6b21\u5b89\u88c5\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://www.sonatype.com/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://books.sonatype.com/nexus-book/index.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible\u4e3b\u673a ansible: `2.3.1.0` os: `Centos 7.2 X64` python: `2.7.5` ansible\u7ba1\u7406\u4e3b\u673a os: `Centos 6.7 X64, Centos 7.2 X64` \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" nexus_version: \"3.4.0-02\" nexus_file: \"nexus-{{ nexus_version }}-unix.tar.gz\" nexus_file_path: \"{{ software_files_path }}/{{ nexus_file }}\" nexus_file_url: \"https://sonatype-download.global.ssl.fastly.net/nexus/3/{{ nexus_file }\" nexus_user: 'nexus' nexus_group: 'nexus' nexus_port: 8081 nexus_workspace: \"{{ software_install_path }}/nexus\" java_home: \"{{ ansible_env.JAVA_HOME | default('/usr/java/jdk1.8.0_144') }}\" \u4f9d\u8d56 \u00b6 jdk 1.8 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/nexus Example Playbook \u00b6 #\u9ed8\u8ba4\u5b89\u88c5nexus - hosts: node1 vars: - java_version: \"1.8\" roles: - java - nexus # \u6307\u5b9a\u7aef\u53e3 - hosts: node1 vars: - java_version: \"1.8\" - nexus_port: 28081 roles: - java - nexus \u4f7f\u7528 \u00b6 # centos6 /etc/init.d/nexus Usage: /etc/init.d/nexus {start|stop|reload|configtest|status|force-reload|upgrade|restart|reopen_logs} # centos7 systemctl status nexus systemctl start nexus systemctl stop nexus # web login admin/admin123","title":"nexus"},{"location":"roles/ci/nexus/#ansible-role-nexus","text":"\u5b89\u88c5nexus","title":"Ansible Role: nexus"},{"location":"roles/ci/nexus/#_1","text":"Sonatype Nexus\u662f\u4e16\u754c\u9886\u5148\u7684\u4ed3\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u5728\u4e16\u754c\u8303\u56f4\u5185Nexus OSS\uff0cNexus Pro\u6216Nexus Pro CLM\u5c06\u8fd150000\u6b21\u5b89\u88c5\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://www.sonatype.com/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://books.sonatype.com/nexus-book/index.html","title":"\u4ecb\u7ecd"},{"location":"roles/ci/nexus/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/ci/nexus/#_3","text":"ansible\u4e3b\u673a ansible: `2.3.1.0` os: `Centos 7.2 X64` python: `2.7.5` ansible\u7ba1\u7406\u4e3b\u673a os: `Centos 6.7 X64, Centos 7.2 X64`","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/ci/nexus/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" nexus_version: \"3.4.0-02\" nexus_file: \"nexus-{{ nexus_version }}-unix.tar.gz\" nexus_file_path: \"{{ software_files_path }}/{{ nexus_file }}\" nexus_file_url: \"https://sonatype-download.global.ssl.fastly.net/nexus/3/{{ nexus_file }\" nexus_user: 'nexus' nexus_group: 'nexus' nexus_port: 8081 nexus_workspace: \"{{ software_install_path }}/nexus\" java_home: \"{{ ansible_env.JAVA_HOME | default('/usr/java/jdk1.8.0_144') }}\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/ci/nexus/#_5","text":"jdk 1.8","title":"\u4f9d\u8d56"},{"location":"roles/ci/nexus/#github","text":"https://github.com/lework/Ansible-roles/tree/master/nexus","title":"github\u5730\u5740"},{"location":"roles/ci/nexus/#example-playbook","text":"#\u9ed8\u8ba4\u5b89\u88c5nexus - hosts: node1 vars: - java_version: \"1.8\" roles: - java - nexus # \u6307\u5b9a\u7aef\u53e3 - hosts: node1 vars: - java_version: \"1.8\" - nexus_port: 28081 roles: - java - nexus","title":"Example Playbook"},{"location":"roles/ci/nexus/#_6","text":"# centos6 /etc/init.d/nexus Usage: /etc/init.d/nexus {start|stop|reload|configtest|status|force-reload|upgrade|restart|reopen_logs} # centos7 systemctl status nexus systemctl start nexus systemctl stop nexus # web login admin/admin123","title":"\u4f7f\u7528"},{"location":"roles/container/docker-compose/","text":"Ansible Role: docker-compose \u00b6 \u5b89\u88c5docker-compose \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64 docker 17.12.0-ce \u89d2\u8272\u53d8\u91cf \u00b6 docker_compose_version: \"1.19.0\" docker_compose_url: \"https://github.com/docker/compose/releases/download/{{ docker_compose_version }}/docker-compose-Linux-x86_64\" docker_exec_path: \"/usr/local/bin/docker-compose\" \u4f9d\u8d56 \u00b6 docker github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/docker-compose Example Playbook \u00b6 - hosts: node1 roles: - docker-compose \u4f7f\u7528 \u00b6 docker-compose --help","title":"docker-compose"},{"location":"roles/container/docker-compose/#ansible-role-docker-compose","text":"\u5b89\u88c5docker-compose","title":"Ansible Role: docker-compose"},{"location":"roles/container/docker-compose/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/container/docker-compose/#_2","text":"ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64 docker 17.12.0-ce","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/container/docker-compose/#_3","text":"docker_compose_version: \"1.19.0\" docker_compose_url: \"https://github.com/docker/compose/releases/download/{{ docker_compose_version }}/docker-compose-Linux-x86_64\" docker_exec_path: \"/usr/local/bin/docker-compose\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/container/docker-compose/#_4","text":"docker","title":"\u4f9d\u8d56"},{"location":"roles/container/docker-compose/#github","text":"https://github.com/lework/Ansible-roles/tree/master/docker-compose","title":"github\u5730\u5740"},{"location":"roles/container/docker-compose/#example-playbook","text":"- hosts: node1 roles: - docker-compose","title":"Example Playbook"},{"location":"roles/container/docker-compose/#_5","text":"docker-compose --help","title":"\u4f7f\u7528"},{"location":"roles/container/docker-swarm/","text":"Ansible Role:docker-swarm \u00b6 \u5b89\u88c5docker-swarm\u96c6\u7fa4 \u4ecb\u7ecd \u00b6 swarm\u662fDocker\u516c\u53f8\u57282014\u5e7412\u6708\u521d\u53d1\u5e03\u7684\u4e00\u5957\u8f83\u4e3a\u7b80\u5355\u7684\u5de5\u5177\uff0c\u7528\u6765\u7ba1\u7406Docker\u96c6\u7fa4\uff0c\u5b83\u5c06\u4e00\u7fa4Docker\u5bbf\u4e3b\u673a\u53d8\u6210\u4e00\u4e2a\u5355\u4e00\u7684\u865a\u62df\u7684\u4e3b\u673a\u3002 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 swarm_advertise_addr: \"{{ ansible_default_ipv4.address }}\" swarm_node: 'master' # (master, node) swarm_master: \"\" # ip address \u4f9d\u8d56 \u00b6 centos 7.3 \u4ee5\u4e0a\u7248\u672c docker github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/docker-swarm Example Playbook \u00b6 \u90e8\u7f72\u96c6\u7fa4 - hosts: node4 roles: - docker - docker-swarm - hosts: node5 roles: - docker - {role: docker-swarm, swarm_node: 'node', swarm_master: '192.168.77.133'} \u4f7f\u7528 \u00b6 docker node ls","title":"docker-swarm"},{"location":"roles/container/docker-swarm/#ansible-roledocker-swarm","text":"\u5b89\u88c5docker-swarm\u96c6\u7fa4","title":"Ansible Role:docker-swarm"},{"location":"roles/container/docker-swarm/#_1","text":"swarm\u662fDocker\u516c\u53f8\u57282014\u5e7412\u6708\u521d\u53d1\u5e03\u7684\u4e00\u5957\u8f83\u4e3a\u7b80\u5355\u7684\u5de5\u5177\uff0c\u7528\u6765\u7ba1\u7406Docker\u96c6\u7fa4\uff0c\u5b83\u5c06\u4e00\u7fa4Docker\u5bbf\u4e3b\u673a\u53d8\u6210\u4e00\u4e2a\u5355\u4e00\u7684\u865a\u62df\u7684\u4e3b\u673a\u3002","title":"\u4ecb\u7ecd"},{"location":"roles/container/docker-swarm/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/container/docker-swarm/#_3","text":"ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/container/docker-swarm/#_4","text":"swarm_advertise_addr: \"{{ ansible_default_ipv4.address }}\" swarm_node: 'master' # (master, node) swarm_master: \"\" # ip address","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/container/docker-swarm/#_5","text":"centos 7.3 \u4ee5\u4e0a\u7248\u672c docker","title":"\u4f9d\u8d56"},{"location":"roles/container/docker-swarm/#github","text":"https://github.com/lework/Ansible-roles/tree/master/docker-swarm","title":"github\u5730\u5740"},{"location":"roles/container/docker-swarm/#example-playbook","text":"\u90e8\u7f72\u96c6\u7fa4 - hosts: node4 roles: - docker - docker-swarm - hosts: node5 roles: - docker - {role: docker-swarm, swarm_node: 'node', swarm_master: '192.168.77.133'}","title":"Example Playbook"},{"location":"roles/container/docker-swarm/#_6","text":"docker node ls","title":"\u4f7f\u7528"},{"location":"roles/container/docker/","text":"Ansible Role: docker \u00b6 \u5b89\u88c5docker \u4ecb\u7ecd \u00b6 Docker \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5e94\u7528\u5bb9\u5668\u5f15\u64ce\uff0c\u8ba9\u5f00\u53d1\u8005\u53ef\u4ee5\u6253\u5305\u4ed6\u4eec\u7684\u5e94\u7528\u4ee5\u53ca\u4f9d\u8d56\u5305\u5230\u4e00\u4e2a\u53ef\u79fb\u690d\u7684\u5bb9\u5668\u4e2d\uff0c\u7136\u540e\u53d1\u5e03\u5230\u4efb\u4f55\u6d41\u884c\u7684 Linux \u673a\u5668\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u865a\u62df\u5316\u3002\u5bb9\u5668\u662f\u5b8c\u5168\u4f7f\u7528\u6c99\u7bb1\u673a\u5236\uff0c\u76f8\u4e92\u4e4b\u95f4\u4e0d\u4f1a\u6709\u4efb\u4f55\u63a5\u53e3\u3002 \u5b98\u7f51: https://www.docker.com/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 docker_repo: \"https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo\" docker_old: - docker - docker-common - docker-selinux - docker-engine docker_packages: - lvm2 - yum-utils - device-mapper-persistent-data docker_start: true docker_registry_mirrors: [\"https://docker.mirrors.ustc.edu.cn/\", \"https://registry.docker-cn.com\"] docker_insecure_registries: [] \u4f9d\u8d56 \u00b6 centos 7.3 \u4ee5\u4e0a\u7248\u672c github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/docker Example Playbook \u00b6 - hosts: node1 roles: - docker \u4f7f\u7528 \u00b6 systemctl start docker systemctl stop docker systemctl status docker","title":"docker"},{"location":"roles/container/docker/#ansible-role-docker","text":"\u5b89\u88c5docker","title":"Ansible Role: docker"},{"location":"roles/container/docker/#_1","text":"Docker \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5e94\u7528\u5bb9\u5668\u5f15\u64ce\uff0c\u8ba9\u5f00\u53d1\u8005\u53ef\u4ee5\u6253\u5305\u4ed6\u4eec\u7684\u5e94\u7528\u4ee5\u53ca\u4f9d\u8d56\u5305\u5230\u4e00\u4e2a\u53ef\u79fb\u690d\u7684\u5bb9\u5668\u4e2d\uff0c\u7136\u540e\u53d1\u5e03\u5230\u4efb\u4f55\u6d41\u884c\u7684 Linux \u673a\u5668\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u865a\u62df\u5316\u3002\u5bb9\u5668\u662f\u5b8c\u5168\u4f7f\u7528\u6c99\u7bb1\u673a\u5236\uff0c\u76f8\u4e92\u4e4b\u95f4\u4e0d\u4f1a\u6709\u4efb\u4f55\u63a5\u53e3\u3002 \u5b98\u7f51: https://www.docker.com/","title":"\u4ecb\u7ecd"},{"location":"roles/container/docker/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/container/docker/#_3","text":"ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/container/docker/#_4","text":"docker_repo: \"https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo\" docker_old: - docker - docker-common - docker-selinux - docker-engine docker_packages: - lvm2 - yum-utils - device-mapper-persistent-data docker_start: true docker_registry_mirrors: [\"https://docker.mirrors.ustc.edu.cn/\", \"https://registry.docker-cn.com\"] docker_insecure_registries: []","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/container/docker/#_5","text":"centos 7.3 \u4ee5\u4e0a\u7248\u672c","title":"\u4f9d\u8d56"},{"location":"roles/container/docker/#github","text":"https://github.com/lework/Ansible-roles/tree/master/docker","title":"github\u5730\u5740"},{"location":"roles/container/docker/#example-playbook","text":"- hosts: node1 roles: - docker","title":"Example Playbook"},{"location":"roles/container/docker/#_6","text":"systemctl start docker systemctl stop docker systemctl status docker","title":"\u4f7f\u7528"},{"location":"roles/container/harbor/","text":"Ansible Role: harbor \u00b6 \u5b89\u88c5harbor \u4ecb\u7ecd \u00b6 Harbor\u662f\u4e00\u4e2a\u7528\u4e8e\u5b58\u50a8\u548c\u5206\u53d1Docker\u955c\u50cf\u7684\u4f01\u4e1a\u7ea7Registry\u670d\u52a1\u5668,\u901a\u8fc7\u6dfb\u52a0\u4e00\u4e9b\u4f01\u4e1a\u5fc5\u9700\u7684\u529f\u80fd\u7279\u6027,\u4f8b\u5982\u5b89\u5168\u3001\u6807\u8bc6\u548c\u7ba1\u7406\u7b49,\u6269\u5c55\u4e86\u5f00\u6e90Docker Distribution\u3002\u4f5c\u4e3a\u4e00\u4e2a\u4f01\u4e1a\u7ea7\u79c1\u6709Registry\u670d\u52a1\u5668,Harbor\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u6027\u80fd\u548c\u5b89\u5168\u3002\u63d0\u5347\u7528\u6237\u4f7f\u7528Registry\u6784\u5efa\u548c\u8fd0\u884c\u73af\u5883\u4f20\u8f93\u955c\u50cf\u7684\u6548\u7387\u3002Harbor\u652f\u6301\u5b89\u88c5\u5728\u591a\u4e2aRegistry\u8282\u70b9\u7684\u955c\u50cf\u8d44\u6e90\u590d\u5236,\u955c\u50cf\u5168\u90e8\u4fdd\u5b58\u5728\u79c1\u6709Registry\u4e2d, \u786e\u4fdd\u6570\u636e\u548c\u77e5\u8bc6\u4ea7\u6743\u5728\u516c\u53f8\u5185\u90e8\u7f51\u7edc\u4e2d\u7ba1\u63a7\u3002\u53e6\u5916,Harbor\u4e5f\u63d0\u4f9b\u4e86\u9ad8\u7ea7\u7684\u5b89\u5168\u7279\u6027,\u8bf8\u5982\u7528\u6237\u7ba1\u7406,\u8bbf\u95ee\u63a7\u5236\u548c\u6d3b\u52a8\u5ba1\u8ba1\u7b49\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://goharbor.io/ github: https://github.com/goharbor/harbor \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.6.13 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" harbor_file: \"harbor-offline-installer-v1.7.4.tgz\" harbor_file_path: \"{{ software_files_path }}/{{ harbor_file }}\" harbor_file_url: \"https://storage.googleapis.com/harbor-releases/release-1.7.0/{{ harbor_file }}\" harbor_home: \"/harbor_data\" harbor_hostname: \"reg.mydomain.com\" harbor_ui_url_protocol: https harbor_max_job_workers: 10 harbor_ssl_home: \"{{ harbor_home}}/cert\" harbor_ssl_cert: \"{{ harbor_ssl_home }}/server.crt\" harbor_ssl_cert_key: \"{{ harbor_ssl_home }}/server.key\" harbor_secretkey_path: \"{{ harbor_home }}\" harbor_https_proxy: https://docker.mirrors.ustc.edu.cn/ harbor_email_server: smtp.mydomain.com harbor_email_server_port: 25 harbor_email_username: sample_admin@mydomain.com harbor_email_password: abc harbor_email_from: admin <sample_admin@mydomain.com> harbor_email_ssl: false harbor_email_insecure: false harbor_admin_password: Harbor12345 harbor_openssl: \"openssl req -sha256 -x509 -days 3650 -nodes -newkey rsa:4096 -subj '/C=CN/ST=ShangHai/L=ShangHai/O=harbor/OU=harbor/CN={{ harbor_hostname }}' -keyout {{ harbor_ssl_cert_key }} -out {{ harbor_ssl_cert }}\" harbor_client: false harbor_client_user: \"\" harbor_client_pass: \"\" \u4f9d\u8d56 \u00b6 docker docker-compose github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/harbor Example Playbook \u00b6 \u5b89\u88c5harbor\uff1a - hosts: 192.168.77.133 vars: - harbor_home: \"/harbor_data\" - harbor_hostname: \"192.168.77.133\" - harbor_ui_url_protocol: https - harbor_email_server: smtp.exmail.com - harbor_email_server_port: 465 - harbor_email_username: harbor@mydomain.com - harbor_email_password: abc - harbor_email_from: harbor <harbor@mydomain.com> - harbor_email_ssl: true roles: - harbor \u914d\u7f6eharbor\u5ba2\u6237\u7aef: - hosts: 192.168.77.133 vars: - harbor_client: true - harbor_client_user: admin - harbor_client_pass: Harbor12345 - harbor_hostname: \"192.168.77.133\" roles: - harbor","title":"harbor"},{"location":"roles/container/harbor/#ansible-role-harbor","text":"\u5b89\u88c5harbor","title":"Ansible Role: harbor"},{"location":"roles/container/harbor/#_1","text":"Harbor\u662f\u4e00\u4e2a\u7528\u4e8e\u5b58\u50a8\u548c\u5206\u53d1Docker\u955c\u50cf\u7684\u4f01\u4e1a\u7ea7Registry\u670d\u52a1\u5668,\u901a\u8fc7\u6dfb\u52a0\u4e00\u4e9b\u4f01\u4e1a\u5fc5\u9700\u7684\u529f\u80fd\u7279\u6027,\u4f8b\u5982\u5b89\u5168\u3001\u6807\u8bc6\u548c\u7ba1\u7406\u7b49,\u6269\u5c55\u4e86\u5f00\u6e90Docker Distribution\u3002\u4f5c\u4e3a\u4e00\u4e2a\u4f01\u4e1a\u7ea7\u79c1\u6709Registry\u670d\u52a1\u5668,Harbor\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u6027\u80fd\u548c\u5b89\u5168\u3002\u63d0\u5347\u7528\u6237\u4f7f\u7528Registry\u6784\u5efa\u548c\u8fd0\u884c\u73af\u5883\u4f20\u8f93\u955c\u50cf\u7684\u6548\u7387\u3002Harbor\u652f\u6301\u5b89\u88c5\u5728\u591a\u4e2aRegistry\u8282\u70b9\u7684\u955c\u50cf\u8d44\u6e90\u590d\u5236,\u955c\u50cf\u5168\u90e8\u4fdd\u5b58\u5728\u79c1\u6709Registry\u4e2d, \u786e\u4fdd\u6570\u636e\u548c\u77e5\u8bc6\u4ea7\u6743\u5728\u516c\u53f8\u5185\u90e8\u7f51\u7edc\u4e2d\u7ba1\u63a7\u3002\u53e6\u5916,Harbor\u4e5f\u63d0\u4f9b\u4e86\u9ad8\u7ea7\u7684\u5b89\u5168\u7279\u6027,\u8bf8\u5982\u7528\u6237\u7ba1\u7406,\u8bbf\u95ee\u63a7\u5236\u548c\u6d3b\u52a8\u5ba1\u8ba1\u7b49\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://goharbor.io/ github: https://github.com/goharbor/harbor","title":"\u4ecb\u7ecd"},{"location":"roles/container/harbor/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/container/harbor/#_3","text":"ansible 2.6.13 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/container/harbor/#_4","text":"software_files_path: \"/opt/software\" harbor_file: \"harbor-offline-installer-v1.7.4.tgz\" harbor_file_path: \"{{ software_files_path }}/{{ harbor_file }}\" harbor_file_url: \"https://storage.googleapis.com/harbor-releases/release-1.7.0/{{ harbor_file }}\" harbor_home: \"/harbor_data\" harbor_hostname: \"reg.mydomain.com\" harbor_ui_url_protocol: https harbor_max_job_workers: 10 harbor_ssl_home: \"{{ harbor_home}}/cert\" harbor_ssl_cert: \"{{ harbor_ssl_home }}/server.crt\" harbor_ssl_cert_key: \"{{ harbor_ssl_home }}/server.key\" harbor_secretkey_path: \"{{ harbor_home }}\" harbor_https_proxy: https://docker.mirrors.ustc.edu.cn/ harbor_email_server: smtp.mydomain.com harbor_email_server_port: 25 harbor_email_username: sample_admin@mydomain.com harbor_email_password: abc harbor_email_from: admin <sample_admin@mydomain.com> harbor_email_ssl: false harbor_email_insecure: false harbor_admin_password: Harbor12345 harbor_openssl: \"openssl req -sha256 -x509 -days 3650 -nodes -newkey rsa:4096 -subj '/C=CN/ST=ShangHai/L=ShangHai/O=harbor/OU=harbor/CN={{ harbor_hostname }}' -keyout {{ harbor_ssl_cert_key }} -out {{ harbor_ssl_cert }}\" harbor_client: false harbor_client_user: \"\" harbor_client_pass: \"\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/container/harbor/#_5","text":"docker docker-compose","title":"\u4f9d\u8d56"},{"location":"roles/container/harbor/#github","text":"https://github.com/lework/Ansible-roles/tree/master/harbor","title":"github\u5730\u5740"},{"location":"roles/container/harbor/#example-playbook","text":"\u5b89\u88c5harbor\uff1a - hosts: 192.168.77.133 vars: - harbor_home: \"/harbor_data\" - harbor_hostname: \"192.168.77.133\" - harbor_ui_url_protocol: https - harbor_email_server: smtp.exmail.com - harbor_email_server_port: 465 - harbor_email_username: harbor@mydomain.com - harbor_email_password: abc - harbor_email_from: harbor <harbor@mydomain.com> - harbor_email_ssl: true roles: - harbor \u914d\u7f6eharbor\u5ba2\u6237\u7aef: - hosts: 192.168.77.133 vars: - harbor_client: true - harbor_client_user: admin - harbor_client_pass: Harbor12345 - harbor_hostname: \"192.168.77.133\" roles: - harbor","title":"Example Playbook"},{"location":"roles/container/kubernetes-bin/","text":"Ansible Role: kubernetes-bin \u00b6 \u4ee5hyperkube\u4e8c\u8fdb\u5236\u65b9\u5f0f\u5b89\u88c5kubernetes 1.14.3 ha \u96c6\u7fa4\u3002 \u4ecb\u7ecd \u00b6 Kubernetes\u662f\u4e00\u4e2a\u5f00\u6e90\u7cfb\u7edf\uff0c\u7528\u4e8e\u81ea\u52a8\u5316\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\u7684\u90e8\u7f72\uff0c\u6269\u5c55\u548c\u7ba1\u7406\u3002 \u5b98\u7f51: https://kubernetes.io/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u5185\u5b58\u5927\u4e8e2G, 4G\u6700\u597d\u4e86\u3002 CPU\u5927\u4e8e2\u6838, 4\u6838\u6700\u597d\u4e86\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.8.1 python 2.7.5 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_install_path: '/usr/local/bin' kubernetes_node_packages: - socat - openssl - curl kubernetes_ipvsadm_packages: - ipvsadm - ipset - sysstat - conntrack - libseccomp kubernetes_min_ram: 1500 kubernetes_tmp_path: \"/tmp/ansibe.fetch\" kubernetes_etcd_conf_path: '/etc/etcd' kubernetes_etcd_ssl_path: '{{ kubernetes_etcd_conf_path }}/ssl' kubernetes_etcd_data_path: \"/var/lib/etcd\" kubernetes_haproxy_conf_path: \"/etc/haproxy\" kubernetes_images_path: \"/opt/kubernetes/images\" kubernetes_log_path: \"/var/log/kubernetes\" kubernetes_conf_path: \"/etc/kubernetes\" kubernetes_addons_conf_path: \"{{ kubernetes_conf_path }}/addons\" kubernetes_pki_path: \"{{ kubernetes_conf_path }}/pki\" kubernetes_manifests_path: \"{{ kubernetes_conf_path }}/manifests\" kubernetes_apiserver_vip: \"127.0.0.1\" kubernetes_apiserver_port: \"6443\" kubernetes_cluster_ip: \"10.96.0.1\" kubernetes_cluster_dns: \"10.96.0.10\" kubernetes_cluster_domain: \"cluster.local\" kubernetes_cluster_ip_range: \"10.96.0.0/12\" kubernetes_cluster_cidr: \"10.244.0.0/16\" kubernetes_ingress_ip: \"\" kubernetes_external_dns_ip: \"\" kubernetes_haproxy_status_port: \"9090\" kubernetes_haproxy_admin_passwd: \"admin123\" # kubernetes kubernetes_pause_image: \"k8s.gcr.io/pause-amd64:3.1\" # kubernetes dashboard kubernetes_dashboard_image: \"k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1\" # Kubernetes network kubernetes_calico_node_image: \"calico/node:v3.7.3\" kubernetes_calico_cni_image: \"calico/cni:v3.7.3\" kubernetes_calico_ctl_image: \"calico/ctl:v3.7.3\" kubernetes_calico_kube_controllers_image: \"calico/kube-controllers:v3.7.3\" # dns kubernetes_coredns_image: \"coredns/coredns:1.5.0\" kubernetes_coredns_etcd_image: \"quay.io/coreos/etcd:v3.3.13\" kubernetes_external_dns_image: \"registry.opensource.zalan.do/teapot/external-dns:v0.5.14\" # Ingress controller kubernetes_nginx_ingress_controller_image: \"quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.24.1\" kubernetes_default_http_backend_image: \"registry.cn-hangzhou.aliyuncs.com/google_containers/defaultbackend:1.4\" # Kubernetes monitoring kubernetes_metrics_server_image: \"k8s.gcr.io/metrics-server-amd64:v0.3.3\" kubernetes_kube_state_metrics_image: \"k8s.gcr.io/kube-state-metrics:v1.6.0\" kubernetes_addon_resizer_image: \"k8s.gcr.io/addon-resizer:1.8.5\" kubernetes_grafana_image: \"grafana/grafana:6.2.4\" kubernetes_prometheus_node_exporter_image: \"prom/node-exporter:v0.18.1\" kubernetes_prometheus_operator_image: \"quay.io/coreos/prometheus-operator:v0.31.0\" kubernetes_prometheus_configmap_reload_image: \"quay.io/coreos/configmap-reload:v0.0.1\" kubernetes_prometheus_config_reloader_image: \"quay.io/coreos/prometheus-config-reloader:v0.31.0\" # weavescope kubernetes_weavescope_image: \"docker.io/weaveworks/scope:1.11.2\" # Kubernetes logging kubernetes_master: false kubernetes_node: false kubernetes_addons: false kubernetes_dashboard: true kubernetes_metrics_server: true kubernetes_external_dns: true kubernetes_prometheus: true kubernetes_weavescope: true kubernetes_helm: true \u4f9d\u8d56 \u00b6 centos 7.3 \u4ee5\u4e0a\u7248\u672c \u6240\u9700\u7684\u6587\u4ef6\u4e0b\u8f7d\u94fe\u63a5\uff1a https://pan.baidu.com/s/1eBPPI6kDxvbynH43--ly5g \u5bc6\u7801\uff1a y39z \u5c06\u6587\u4ef6\u89e3\u538b\u5230role\u7684files\u76ee\u5f55\u4e2d # yum -y install p7zip # 7za x k8s-v1.14.3.7za -r -o/opt/ # cp -rf v1.14.3/* /etc/ansible/roles/kubernetes-bin/files/ github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/kubernetes-bin Example Playbook \u00b6 \u8bf7\u6ce8\u610f, \u4e3b\u673a\u540d\u79f0\u8bf7\u7528\u5c0f\u5199\u5b57\u6bcd, \u5927\u5199\u5b57\u6bcd\u4f1a\u51fa\u73b0\u627e\u4e0d\u5230\u4e3b\u673a\u7684\u95ee\u9898\u3002 # cat /etc/ansibe/hosts [k8s_master] 192.168.77.130 192.168.77.131 192.168.77.132 [k8s_node] 192.168.77.133 192.168.77.134 [k8s_cluster:children] k8s_master k8s_node [k8s_cluster:vars] ansible_ssh_pass=123456 # cat /etc/ansible/k8s.yml --- # \u521d\u59cb\u5316\u8282\u70b9 - hosts: k8s_cluster serial: \"100%\" any_errors_fatal: true vars: - ipnames: '192.168.77.130': 'k8s-m1' '192.168.77.131': 'k8s-m2' '192.168.77.132': 'k8s-m3' '192.168.77.133': 'k8s-n1' '192.168.77.134': 'k8s-n2' roles: - hostnames - { role: ssh-keys, ssh_keys_host: '192.168.77.130' } - repo-epel - ntp - docker - update-kernel # \u5b89\u88c5master\u8282\u70b9 - hosts: k8s_master any_errors_fatal: true vars: - kubernetes_master: true roles: - kubernetes-bin # \u5b89\u88c5node\u8282\u70b9 - hosts: k8s_node any_errors_fatal: true vars: - kubernetes_node: true roles: - kubernetes-bin # \u5b89\u88c5addons\u7ec4\u4ef6 - hosts: k8s_master any_errors_fatal: true vars: - kubernetes_addons: true - kubernetes_ingress_ip: 192.168.77.140 - kubernetes_external_dns_ip: 192.168.77.141 roles: - kubernetes-bin \u8fd0\u884c\u65e5\u5fd7 \u00b6 \u8be6\u7ec6\u5b89\u88c5\u8bf4\u660e \u4f7f\u7528ansible\u6765\u505akubernetes 1.14.3\u96c6\u7fa4\u9ad8\u53ef\u7528\u7684\u4e00\u952e\u90e8\u7f72 \u5b89\u88c5\u5b8c\u96c6\u7fa4\u540e, \u6700\u597d\u91cd\u542f\u96c6\u7fa4\u89c2\u5bdf\u4e0b\u5065\u58ee\u6027\u3002 \u68c0\u67e5\u96c6\u7fa4\u72b6\u6001 \u00b6 kubectl get cs kubectl get csr kubectl get nodes kubectl get ns kubectl get all --all-namespaces = true helm version etcdctl member list kubectl -n kube-system exec calicoctl -- calicoctl get node -o wide ipvsadm -Ln \u67e5\u770baddons\u8bbf\u95ee\u4fe1\u606f \u00b6 \u5728\u7b2c\u4e00\u53f0master\u670d\u52a1\u5668\u4e0a cat ~/k8s-addons-access.md ## secret dashboard_secret: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZC1hZG1pbi10b2tlbi1kZ3p4ayIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZC1hZG1pbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImY1NDgwMzQ0LWE0OGYtMTFlOS05MzU3LTAwMGMyOTg4MDFjMCIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTprdWJlcm5ldGVzLWRhc2hib2FyZC1hZG1pbiJ9.wKXs_K633Y-EtfGCPRQjMVsklzpuO7NshhCwgTasmrRpB1MP48kx5pa2D6Mqg6BAv40AGFGdq6m6EK6Beuj-E7brGvvdg3h6P2nDUKBUxEq6dXwBDyNTRiGaI-QmSJHjn8yt59gl7rdgCWrrL_B5bo-umsjV3jKk4tIOMX7RgdqSB6sDkgPoILiC9cNOKl3JIfqH3dXwYHJwJylS2dwvxCbMFpNZtXhCKGP_lciaU0ESr3OGK03-kHCUmWyisX-WnwBbCYvmNIArwhYD8QwHOXU9PI4i2DF48Fg6TAxMFsOpnJd3AvzWCIdaRVmfvQdNTYMEZmkA04oFyPGI_Q9c_g ## host bing 192 .168.77.140 kubernetes-dashboard.k8s.local 192 .168.77.140 alertmanager.monitoring.k8s.local 192 .168.77.140 grafana.monitoring.k8s.local 192 .168.77.140 prometheus.monitoring.k8s.local 192 .168.77.140 scope.weave.k8s.local ## http access https://kubernetes-dashboard.k8s.local http://alertmanager.monitoring.k8s.local http://grafana.monitoring.k8s.local http://prometheus.monitoring.k8s.local http://scope.weave.k8s.local ## DNS TCP 192 .168.77.141 UDP 192 .168.77.141 dig @192.168.77.141 A scope.weave.k8s.local +noall +answer","title":"kubernetes-bin"},{"location":"roles/container/kubernetes-bin/#ansible-role-kubernetes-bin","text":"\u4ee5hyperkube\u4e8c\u8fdb\u5236\u65b9\u5f0f\u5b89\u88c5kubernetes 1.14.3 ha \u96c6\u7fa4\u3002","title":"Ansible Role: kubernetes-bin"},{"location":"roles/container/kubernetes-bin/#_1","text":"Kubernetes\u662f\u4e00\u4e2a\u5f00\u6e90\u7cfb\u7edf\uff0c\u7528\u4e8e\u81ea\u52a8\u5316\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\u7684\u90e8\u7f72\uff0c\u6269\u5c55\u548c\u7ba1\u7406\u3002 \u5b98\u7f51: https://kubernetes.io/","title":"\u4ecb\u7ecd"},{"location":"roles/container/kubernetes-bin/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u5185\u5b58\u5927\u4e8e2G, 4G\u6700\u597d\u4e86\u3002 CPU\u5927\u4e8e2\u6838, 4\u6838\u6700\u597d\u4e86\u3002","title":"\u8981\u6c42"},{"location":"roles/container/kubernetes-bin/#_3","text":"ansible 2.8.1 python 2.7.5 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/container/kubernetes-bin/#_4","text":"software_install_path: '/usr/local/bin' kubernetes_node_packages: - socat - openssl - curl kubernetes_ipvsadm_packages: - ipvsadm - ipset - sysstat - conntrack - libseccomp kubernetes_min_ram: 1500 kubernetes_tmp_path: \"/tmp/ansibe.fetch\" kubernetes_etcd_conf_path: '/etc/etcd' kubernetes_etcd_ssl_path: '{{ kubernetes_etcd_conf_path }}/ssl' kubernetes_etcd_data_path: \"/var/lib/etcd\" kubernetes_haproxy_conf_path: \"/etc/haproxy\" kubernetes_images_path: \"/opt/kubernetes/images\" kubernetes_log_path: \"/var/log/kubernetes\" kubernetes_conf_path: \"/etc/kubernetes\" kubernetes_addons_conf_path: \"{{ kubernetes_conf_path }}/addons\" kubernetes_pki_path: \"{{ kubernetes_conf_path }}/pki\" kubernetes_manifests_path: \"{{ kubernetes_conf_path }}/manifests\" kubernetes_apiserver_vip: \"127.0.0.1\" kubernetes_apiserver_port: \"6443\" kubernetes_cluster_ip: \"10.96.0.1\" kubernetes_cluster_dns: \"10.96.0.10\" kubernetes_cluster_domain: \"cluster.local\" kubernetes_cluster_ip_range: \"10.96.0.0/12\" kubernetes_cluster_cidr: \"10.244.0.0/16\" kubernetes_ingress_ip: \"\" kubernetes_external_dns_ip: \"\" kubernetes_haproxy_status_port: \"9090\" kubernetes_haproxy_admin_passwd: \"admin123\" # kubernetes kubernetes_pause_image: \"k8s.gcr.io/pause-amd64:3.1\" # kubernetes dashboard kubernetes_dashboard_image: \"k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1\" # Kubernetes network kubernetes_calico_node_image: \"calico/node:v3.7.3\" kubernetes_calico_cni_image: \"calico/cni:v3.7.3\" kubernetes_calico_ctl_image: \"calico/ctl:v3.7.3\" kubernetes_calico_kube_controllers_image: \"calico/kube-controllers:v3.7.3\" # dns kubernetes_coredns_image: \"coredns/coredns:1.5.0\" kubernetes_coredns_etcd_image: \"quay.io/coreos/etcd:v3.3.13\" kubernetes_external_dns_image: \"registry.opensource.zalan.do/teapot/external-dns:v0.5.14\" # Ingress controller kubernetes_nginx_ingress_controller_image: \"quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.24.1\" kubernetes_default_http_backend_image: \"registry.cn-hangzhou.aliyuncs.com/google_containers/defaultbackend:1.4\" # Kubernetes monitoring kubernetes_metrics_server_image: \"k8s.gcr.io/metrics-server-amd64:v0.3.3\" kubernetes_kube_state_metrics_image: \"k8s.gcr.io/kube-state-metrics:v1.6.0\" kubernetes_addon_resizer_image: \"k8s.gcr.io/addon-resizer:1.8.5\" kubernetes_grafana_image: \"grafana/grafana:6.2.4\" kubernetes_prometheus_node_exporter_image: \"prom/node-exporter:v0.18.1\" kubernetes_prometheus_operator_image: \"quay.io/coreos/prometheus-operator:v0.31.0\" kubernetes_prometheus_configmap_reload_image: \"quay.io/coreos/configmap-reload:v0.0.1\" kubernetes_prometheus_config_reloader_image: \"quay.io/coreos/prometheus-config-reloader:v0.31.0\" # weavescope kubernetes_weavescope_image: \"docker.io/weaveworks/scope:1.11.2\" # Kubernetes logging kubernetes_master: false kubernetes_node: false kubernetes_addons: false kubernetes_dashboard: true kubernetes_metrics_server: true kubernetes_external_dns: true kubernetes_prometheus: true kubernetes_weavescope: true kubernetes_helm: true","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/container/kubernetes-bin/#_5","text":"centos 7.3 \u4ee5\u4e0a\u7248\u672c \u6240\u9700\u7684\u6587\u4ef6\u4e0b\u8f7d\u94fe\u63a5\uff1a https://pan.baidu.com/s/1eBPPI6kDxvbynH43--ly5g \u5bc6\u7801\uff1a y39z \u5c06\u6587\u4ef6\u89e3\u538b\u5230role\u7684files\u76ee\u5f55\u4e2d # yum -y install p7zip # 7za x k8s-v1.14.3.7za -r -o/opt/ # cp -rf v1.14.3/* /etc/ansible/roles/kubernetes-bin/files/","title":"\u4f9d\u8d56"},{"location":"roles/container/kubernetes-bin/#github","text":"https://github.com/lework/Ansible-roles/tree/master/kubernetes-bin","title":"github\u5730\u5740"},{"location":"roles/container/kubernetes-bin/#example-playbook","text":"\u8bf7\u6ce8\u610f, \u4e3b\u673a\u540d\u79f0\u8bf7\u7528\u5c0f\u5199\u5b57\u6bcd, \u5927\u5199\u5b57\u6bcd\u4f1a\u51fa\u73b0\u627e\u4e0d\u5230\u4e3b\u673a\u7684\u95ee\u9898\u3002 # cat /etc/ansibe/hosts [k8s_master] 192.168.77.130 192.168.77.131 192.168.77.132 [k8s_node] 192.168.77.133 192.168.77.134 [k8s_cluster:children] k8s_master k8s_node [k8s_cluster:vars] ansible_ssh_pass=123456 # cat /etc/ansible/k8s.yml --- # \u521d\u59cb\u5316\u8282\u70b9 - hosts: k8s_cluster serial: \"100%\" any_errors_fatal: true vars: - ipnames: '192.168.77.130': 'k8s-m1' '192.168.77.131': 'k8s-m2' '192.168.77.132': 'k8s-m3' '192.168.77.133': 'k8s-n1' '192.168.77.134': 'k8s-n2' roles: - hostnames - { role: ssh-keys, ssh_keys_host: '192.168.77.130' } - repo-epel - ntp - docker - update-kernel # \u5b89\u88c5master\u8282\u70b9 - hosts: k8s_master any_errors_fatal: true vars: - kubernetes_master: true roles: - kubernetes-bin # \u5b89\u88c5node\u8282\u70b9 - hosts: k8s_node any_errors_fatal: true vars: - kubernetes_node: true roles: - kubernetes-bin # \u5b89\u88c5addons\u7ec4\u4ef6 - hosts: k8s_master any_errors_fatal: true vars: - kubernetes_addons: true - kubernetes_ingress_ip: 192.168.77.140 - kubernetes_external_dns_ip: 192.168.77.141 roles: - kubernetes-bin","title":"Example Playbook"},{"location":"roles/container/kubernetes-bin/#_6","text":"\u8be6\u7ec6\u5b89\u88c5\u8bf4\u660e \u4f7f\u7528ansible\u6765\u505akubernetes 1.14.3\u96c6\u7fa4\u9ad8\u53ef\u7528\u7684\u4e00\u952e\u90e8\u7f72 \u5b89\u88c5\u5b8c\u96c6\u7fa4\u540e, \u6700\u597d\u91cd\u542f\u96c6\u7fa4\u89c2\u5bdf\u4e0b\u5065\u58ee\u6027\u3002","title":"\u8fd0\u884c\u65e5\u5fd7"},{"location":"roles/container/kubernetes-bin/#_7","text":"kubectl get cs kubectl get csr kubectl get nodes kubectl get ns kubectl get all --all-namespaces = true helm version etcdctl member list kubectl -n kube-system exec calicoctl -- calicoctl get node -o wide ipvsadm -Ln","title":"\u68c0\u67e5\u96c6\u7fa4\u72b6\u6001"},{"location":"roles/container/kubernetes-bin/#addons","text":"\u5728\u7b2c\u4e00\u53f0master\u670d\u52a1\u5668\u4e0a cat ~/k8s-addons-access.md ## secret dashboard_secret: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZC1hZG1pbi10b2tlbi1kZ3p4ayIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJrdWJlcm5ldGVzLWRhc2hib2FyZC1hZG1pbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImY1NDgwMzQ0LWE0OGYtMTFlOS05MzU3LTAwMGMyOTg4MDFjMCIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTprdWJlcm5ldGVzLWRhc2hib2FyZC1hZG1pbiJ9.wKXs_K633Y-EtfGCPRQjMVsklzpuO7NshhCwgTasmrRpB1MP48kx5pa2D6Mqg6BAv40AGFGdq6m6EK6Beuj-E7brGvvdg3h6P2nDUKBUxEq6dXwBDyNTRiGaI-QmSJHjn8yt59gl7rdgCWrrL_B5bo-umsjV3jKk4tIOMX7RgdqSB6sDkgPoILiC9cNOKl3JIfqH3dXwYHJwJylS2dwvxCbMFpNZtXhCKGP_lciaU0ESr3OGK03-kHCUmWyisX-WnwBbCYvmNIArwhYD8QwHOXU9PI4i2DF48Fg6TAxMFsOpnJd3AvzWCIdaRVmfvQdNTYMEZmkA04oFyPGI_Q9c_g ## host bing 192 .168.77.140 kubernetes-dashboard.k8s.local 192 .168.77.140 alertmanager.monitoring.k8s.local 192 .168.77.140 grafana.monitoring.k8s.local 192 .168.77.140 prometheus.monitoring.k8s.local 192 .168.77.140 scope.weave.k8s.local ## http access https://kubernetes-dashboard.k8s.local http://alertmanager.monitoring.k8s.local http://grafana.monitoring.k8s.local http://prometheus.monitoring.k8s.local http://scope.weave.k8s.local ## DNS TCP 192 .168.77.141 UDP 192 .168.77.141 dig @192.168.77.141 A scope.weave.k8s.local +noall +answer","title":"\u67e5\u770baddons\u8bbf\u95ee\u4fe1\u606f"},{"location":"roles/container/kubernetes/","text":"Ansible Role: kubernetes \u00b6 \u4ee5Static Pods\u65b9\u5f0f\u5b89\u88c5kubernetes 1.10.3 ha \u96c6\u7fa4\u3002 \u4ecb\u7ecd \u00b6 Kubernetes\u662f\u4e00\u4e2a\u5f00\u6e90\u7cfb\u7edf\uff0c\u7528\u4e8e\u81ea\u52a8\u5316\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\u7684\u90e8\u7f72\uff0c\u6269\u5c55\u548c\u7ba1\u7406\u3002 \u5b98\u7f51: https://kubernetes.io/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u5185\u5b58\u5927\u4e8e4G, 8G\u6700\u597d\u4e86\u3002 CPU\u5927\u4e8e4\u6838, 8\u6838\u6700\u597d\u4e86\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.5.2 python 2.7.5 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_install_path: '/usr/local' kubernetes_bin_path: '{{ software_install_path }}/kubernetes/bin' kubernetes_cni_bin_path: '{{ software_install_path }}/cni/bin' kubernetes_cfssl_bin_path: '{{ software_install_path }}/cfssl/bin' kubernetes_helm_bin_path: '{{ software_install_path }}/helm/bin' kubernetes_calic_bin_path: '{{ software_install_path }}/calic/bin' kubernetes_node_packages: - socat - openssl kubernetes_min_ram: 1800 kubernetes_tmp_path: \"/tmp/ansibe.fetch\" kubernetes_etcd_conf_path: '/etc/etcd' kubernetes_etcd_ssl_path: '{{ kubernetes_etcd_conf_path }}/ssl' kubernetes_etcd_data_path: \"/var/lib/etcd\" kubernetes_cni_conf_path: \"/etc/cni/net.d\" kubernetes_haproxy_conf_path: \"/etc/haproxy\" kubernetes_images_path: \"/opt/software/kubernetes/images\" kubernetes_log_path: \"/var/log/kubernetes\" kubernetes_conf_path: \"/etc/kubernetes\" kubernetes_addons_conf_path: \"{{ kubernetes_conf_path }}/addons\" kubernetes_pki_path: \"{{ kubernetes_conf_path }}/pki\" kubernetes_manifests_path: \"{{ kubernetes_conf_path }}/manifests\" kubernetes_kubelet_service_path: \"/etc/systemd/system/kubelet.service.d\" kubernetes_kubelet_data_path: \"/var/lib/kubelet\" kubernetes_apiserver_vip: \"\" kubernetes_apiserver_port: \"6443\" kubernetes_cluster_ip: \"10.96.0.1\" kubernetes_cluster_dns: \"10.96.0.10\" kubernetes_cluster_domain: \"cluster.local\" kubernetes_cluster_ip_rang: \"10.96.0.0/12\" kubernetes_cluster_cidr: \"10.244.0.0/16\" kubernetes_dashboard_port: \"443\" kubernetes_haproxy_status_port: \"9090\" kubernetes_haproxy_admin_passwd: \"admin123\" # Kubernetes ingress: nginx,traefik kubernetes_ingress_controller: \"nginx\" # Kubernetes master kubernetes_apiserver_image: \"gcr.io/google_containers/kube-apiserver-amd64:v1.10.3\" kubernetes_controller_image: \"gcr.io/google_containers/kube-controller-manager-amd64:v1.10.3\" kubernetes_scheduler_image: \"gcr.io/google_containers/kube-scheduler-amd64:v1.10.3\" kubernetes_etcd_image: \"gcr.io/google_containers/etcd-amd64:3.1.13\" kubernetes_keepalived_image: \"lework/keepalived:v1.3.9\" kubernetes_haproxy_image: \"haproxy:1.8.9-alpine\" # Kube-proxy kubernetes_kube_proxy_image: \"gcr.io/google_containers/kube-proxy-amd64:v1.10.3\" # kubernetes dashboard kubernetes_dashboard_image: \"gcr.io/google_containers/kubernetes-dashboard-amd64:v1.8.3\" # Kubernetes network kubernetes_calico_node_image: \"quay.io/calico/node:v3.1.2\" kubernetes_calico_cni_image: \"quay.io/calico/cni:v2.0.5\" kubernetes_calico_kube_controllers_image: \"quay.io/calico/kube-controllers:v2.0.4\" # Ingress controller kubernetes_nginx_ingress_controller_image: \"quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.15.0\" kubernetes_default_http_backend_image: \"gcr.io/google_containers/defaultbackend:1.4\" kubernetes_traefik_ingress_controller_image: \"traefik:v1.6.2-alpine\" # Kube-dns kubernetes_kube_dns_image: \"gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.10\" kubernetes_kube_dns_dnsmasq_image: \"gcr.io/google_containers/k8s-dns-dnsmasq-nanny-amd64:1.14.10\" kubernetes_kube_dns_sidecar_image: \"gcr.io/google_containers/k8s-dns-sidecar-amd64:1.14.10\" # Kubernetes monitor kubernetes_heapster_image: \"gcr.io/google_containers/heapster-amd64:v1.5.3\" kubernetes_heapster_addon_resizer_image: \"gcr.io/google_containers/addon-resizer:1.8.1\" kubernetes_heapster_influxdb_image: \"gcr.io/google_containers/heapster-influxdb-amd64:v1.3.3\" kubernetes_heapster_grafana_image: \"gcr.io/google_containers/heapster-grafana-amd64:v4.4.3\" # Kubernetes logging kubernetes_alpine_image: \"alpine:3.7\" kubernetes_elasticsearch_image: \"gcr.io/google-containers/elasticsearch:v6.2.4\" kubernetes_fluentd_image: \"gcr.io/google-containers/fluentd-elasticsearch:v2.1.0\" kubernetes_kibana_image: \"docker.elastic.co/kibana/kibana-oss:6.2.4\" kubernetes_logging: true kubernetes_monitor: true kubernetes_master: false kubernetes_node: false kubernetes_addons: false kubernetes_ntpd: true kubernetes_node_init: true \u4f9d\u8d56 \u00b6 centos 7.3 \u4ee5\u4e0a\u7248\u672c \u6240\u9700\u7684\u6587\u4ef6\u4e0b\u8f7d\u94fe\u63a5\uff1a https://pan.baidu.com/s/1BNMJLEVzCE8pvegtT7xjyQ \u5bc6\u7801\uff1a qm4k # yum -y install unzip # unzip kubernetes-files.zip -d /etc/ansible/roles/kubernetes/files/ github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/kubernetes Example Playbook \u00b6 \u8bf7\u6ce8\u610f, \u4e3b\u673a\u540d\u79f0\u8bf7\u7528\u5c0f\u5199\u5b57\u6bcd, \u5927\u5199\u5b57\u6bcd\u4f1a\u51fa\u73b0\u627e\u4e0d\u5230\u4e3b\u673a\u7684\u95ee\u9898\u3002 # /etc/ansibe/hosts [k8s-master] 192.168.77.133 192.168.77.134 192.168.77.135 [k8s-node] 192.168.77.136 192.168.77.137 192.168.77.138 [k8s-cluster:children] k8s-master k8s-node [k8s-cluster:vars] ansible_ssh_pass=123456 --- # \u521d\u59cb\u5316\u96c6\u7fa4, \u914d\u7f6e\u4e3b\u673a\u540d\uff0c\u914d\u7f6eepel\u6e90\uff0c\u5b89\u88c5docker - hosts: k8s-cluster serial: \"100%\" any_errors_fatal: true vars: - ipnames: '192.168.77.133': 'k8s-m1' '192.168.77.134': 'k8s-m2' '192.168.77.135': 'k8s-m3' '192.168.77.136': 'k8s-n1' '192.168.77.137': 'k8s-n2' '192.168.77.138': 'k8s-n3' roles: - hostnames - repo-epel - docker # \u5b89\u88c5master\u8282\u70b9 - hosts: k8s-master any_errors_fatal: true vars: - kubernetes_master: true - kubernetes_apiserver_vip: 192.168.77.140 roles: - kubernetes # \u5b89\u88c5node\u8282\u70b9 - hosts: k8s-node any_errors_fatal: true vars: - kubernetes_node: true - kubernetes_apiserver_vip: 192.168.77.140 roles: - kubernetes # \u5b89\u88c5addons\u5e94\u7528 - hosts: k8s-master any_errors_fatal: true vars: - kubernetes_addons: true - kubernetes_ingress_controller: nginx - kubernetes_apiserver_vip: 192.168.77.140 roles: - kubernetes \u8fd0\u884c\u65e5\u5fd7 \u00b6 \u5b89\u88c5\u5b8c\u96c6\u7fa4\u540e, \u6700\u597d\u91cd\u542f\u96c6\u7fa4\u89c2\u5bdf\u4e0b\u5065\u58ee\u6027\u3002 \u68c0\u67e5\u96c6\u7fa4\u72b6\u6001 \u00b6 kubectl get cs kubectl get csr kubectl get nodes kubectl get all --all-namespaces = true kubectl -n kube-system logs -f kube-scheduler-k8s-m2 kubectl -n kube-system get po -o wide -l k8s-app = kube-proxy kubectl -n kube-system get po -l k8s-app = kube-dns kubectl -n kube-system get po -l k8s-app = calico-node -o wide calicoctl node status kubectl -n kube-system get po,svc -l k8s-app = kubernetes-dashboard kubectl -n kube-system get po,svc | grep -E 'monitoring|heapster|influxdb' kubectl -n ingress-nginx get pods kubectl -n kube-system get po -l app = helm helm version \u67e5\u770baddons\u8bbf\u95ee\u4fe1\u606f \u00b6 \u5728\u7b2c\u4e00\u53f0master\u670d\u52a1\u5668\u4e0a cat ~/k8s_addons_access dashboard_url: https://{{kubernetes_apiserver_vip}}:{{ kubernetes_apiserver_port }}/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login grafana_url: https://{{kubernetes_apiserver_vip}}:{{ kubernetes_apiserver_port }}/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy/ elasticsearch_url: https://{{kubernetes_apiserver_vip}}:{{ kubernetes_apiserver_port }}/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/ kibana_url: https://{{kubernetes_apiserver_vip}}:{{ kubernetes_apiserver_port }}/api/v1/namespaces/kube-system/services/kibana-logging/proxy/","title":"kubernetes"},{"location":"roles/container/kubernetes/#ansible-role-kubernetes","text":"\u4ee5Static Pods\u65b9\u5f0f\u5b89\u88c5kubernetes 1.10.3 ha \u96c6\u7fa4\u3002","title":"Ansible Role: kubernetes"},{"location":"roles/container/kubernetes/#_1","text":"Kubernetes\u662f\u4e00\u4e2a\u5f00\u6e90\u7cfb\u7edf\uff0c\u7528\u4e8e\u81ea\u52a8\u5316\u5bb9\u5668\u5316\u5e94\u7528\u7a0b\u5e8f\u7684\u90e8\u7f72\uff0c\u6269\u5c55\u548c\u7ba1\u7406\u3002 \u5b98\u7f51: https://kubernetes.io/","title":"\u4ecb\u7ecd"},{"location":"roles/container/kubernetes/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u5185\u5b58\u5927\u4e8e4G, 8G\u6700\u597d\u4e86\u3002 CPU\u5927\u4e8e4\u6838, 8\u6838\u6700\u597d\u4e86\u3002","title":"\u8981\u6c42"},{"location":"roles/container/kubernetes/#_3","text":"ansible 2.5.2 python 2.7.5 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/container/kubernetes/#_4","text":"software_install_path: '/usr/local' kubernetes_bin_path: '{{ software_install_path }}/kubernetes/bin' kubernetes_cni_bin_path: '{{ software_install_path }}/cni/bin' kubernetes_cfssl_bin_path: '{{ software_install_path }}/cfssl/bin' kubernetes_helm_bin_path: '{{ software_install_path }}/helm/bin' kubernetes_calic_bin_path: '{{ software_install_path }}/calic/bin' kubernetes_node_packages: - socat - openssl kubernetes_min_ram: 1800 kubernetes_tmp_path: \"/tmp/ansibe.fetch\" kubernetes_etcd_conf_path: '/etc/etcd' kubernetes_etcd_ssl_path: '{{ kubernetes_etcd_conf_path }}/ssl' kubernetes_etcd_data_path: \"/var/lib/etcd\" kubernetes_cni_conf_path: \"/etc/cni/net.d\" kubernetes_haproxy_conf_path: \"/etc/haproxy\" kubernetes_images_path: \"/opt/software/kubernetes/images\" kubernetes_log_path: \"/var/log/kubernetes\" kubernetes_conf_path: \"/etc/kubernetes\" kubernetes_addons_conf_path: \"{{ kubernetes_conf_path }}/addons\" kubernetes_pki_path: \"{{ kubernetes_conf_path }}/pki\" kubernetes_manifests_path: \"{{ kubernetes_conf_path }}/manifests\" kubernetes_kubelet_service_path: \"/etc/systemd/system/kubelet.service.d\" kubernetes_kubelet_data_path: \"/var/lib/kubelet\" kubernetes_apiserver_vip: \"\" kubernetes_apiserver_port: \"6443\" kubernetes_cluster_ip: \"10.96.0.1\" kubernetes_cluster_dns: \"10.96.0.10\" kubernetes_cluster_domain: \"cluster.local\" kubernetes_cluster_ip_rang: \"10.96.0.0/12\" kubernetes_cluster_cidr: \"10.244.0.0/16\" kubernetes_dashboard_port: \"443\" kubernetes_haproxy_status_port: \"9090\" kubernetes_haproxy_admin_passwd: \"admin123\" # Kubernetes ingress: nginx,traefik kubernetes_ingress_controller: \"nginx\" # Kubernetes master kubernetes_apiserver_image: \"gcr.io/google_containers/kube-apiserver-amd64:v1.10.3\" kubernetes_controller_image: \"gcr.io/google_containers/kube-controller-manager-amd64:v1.10.3\" kubernetes_scheduler_image: \"gcr.io/google_containers/kube-scheduler-amd64:v1.10.3\" kubernetes_etcd_image: \"gcr.io/google_containers/etcd-amd64:3.1.13\" kubernetes_keepalived_image: \"lework/keepalived:v1.3.9\" kubernetes_haproxy_image: \"haproxy:1.8.9-alpine\" # Kube-proxy kubernetes_kube_proxy_image: \"gcr.io/google_containers/kube-proxy-amd64:v1.10.3\" # kubernetes dashboard kubernetes_dashboard_image: \"gcr.io/google_containers/kubernetes-dashboard-amd64:v1.8.3\" # Kubernetes network kubernetes_calico_node_image: \"quay.io/calico/node:v3.1.2\" kubernetes_calico_cni_image: \"quay.io/calico/cni:v2.0.5\" kubernetes_calico_kube_controllers_image: \"quay.io/calico/kube-controllers:v2.0.4\" # Ingress controller kubernetes_nginx_ingress_controller_image: \"quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.15.0\" kubernetes_default_http_backend_image: \"gcr.io/google_containers/defaultbackend:1.4\" kubernetes_traefik_ingress_controller_image: \"traefik:v1.6.2-alpine\" # Kube-dns kubernetes_kube_dns_image: \"gcr.io/google_containers/k8s-dns-kube-dns-amd64:1.14.10\" kubernetes_kube_dns_dnsmasq_image: \"gcr.io/google_containers/k8s-dns-dnsmasq-nanny-amd64:1.14.10\" kubernetes_kube_dns_sidecar_image: \"gcr.io/google_containers/k8s-dns-sidecar-amd64:1.14.10\" # Kubernetes monitor kubernetes_heapster_image: \"gcr.io/google_containers/heapster-amd64:v1.5.3\" kubernetes_heapster_addon_resizer_image: \"gcr.io/google_containers/addon-resizer:1.8.1\" kubernetes_heapster_influxdb_image: \"gcr.io/google_containers/heapster-influxdb-amd64:v1.3.3\" kubernetes_heapster_grafana_image: \"gcr.io/google_containers/heapster-grafana-amd64:v4.4.3\" # Kubernetes logging kubernetes_alpine_image: \"alpine:3.7\" kubernetes_elasticsearch_image: \"gcr.io/google-containers/elasticsearch:v6.2.4\" kubernetes_fluentd_image: \"gcr.io/google-containers/fluentd-elasticsearch:v2.1.0\" kubernetes_kibana_image: \"docker.elastic.co/kibana/kibana-oss:6.2.4\" kubernetes_logging: true kubernetes_monitor: true kubernetes_master: false kubernetes_node: false kubernetes_addons: false kubernetes_ntpd: true kubernetes_node_init: true","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/container/kubernetes/#_5","text":"centos 7.3 \u4ee5\u4e0a\u7248\u672c \u6240\u9700\u7684\u6587\u4ef6\u4e0b\u8f7d\u94fe\u63a5\uff1a https://pan.baidu.com/s/1BNMJLEVzCE8pvegtT7xjyQ \u5bc6\u7801\uff1a qm4k # yum -y install unzip # unzip kubernetes-files.zip -d /etc/ansible/roles/kubernetes/files/","title":"\u4f9d\u8d56"},{"location":"roles/container/kubernetes/#github","text":"https://github.com/lework/Ansible-roles/tree/master/kubernetes","title":"github\u5730\u5740"},{"location":"roles/container/kubernetes/#example-playbook","text":"\u8bf7\u6ce8\u610f, \u4e3b\u673a\u540d\u79f0\u8bf7\u7528\u5c0f\u5199\u5b57\u6bcd, \u5927\u5199\u5b57\u6bcd\u4f1a\u51fa\u73b0\u627e\u4e0d\u5230\u4e3b\u673a\u7684\u95ee\u9898\u3002 # /etc/ansibe/hosts [k8s-master] 192.168.77.133 192.168.77.134 192.168.77.135 [k8s-node] 192.168.77.136 192.168.77.137 192.168.77.138 [k8s-cluster:children] k8s-master k8s-node [k8s-cluster:vars] ansible_ssh_pass=123456 --- # \u521d\u59cb\u5316\u96c6\u7fa4, \u914d\u7f6e\u4e3b\u673a\u540d\uff0c\u914d\u7f6eepel\u6e90\uff0c\u5b89\u88c5docker - hosts: k8s-cluster serial: \"100%\" any_errors_fatal: true vars: - ipnames: '192.168.77.133': 'k8s-m1' '192.168.77.134': 'k8s-m2' '192.168.77.135': 'k8s-m3' '192.168.77.136': 'k8s-n1' '192.168.77.137': 'k8s-n2' '192.168.77.138': 'k8s-n3' roles: - hostnames - repo-epel - docker # \u5b89\u88c5master\u8282\u70b9 - hosts: k8s-master any_errors_fatal: true vars: - kubernetes_master: true - kubernetes_apiserver_vip: 192.168.77.140 roles: - kubernetes # \u5b89\u88c5node\u8282\u70b9 - hosts: k8s-node any_errors_fatal: true vars: - kubernetes_node: true - kubernetes_apiserver_vip: 192.168.77.140 roles: - kubernetes # \u5b89\u88c5addons\u5e94\u7528 - hosts: k8s-master any_errors_fatal: true vars: - kubernetes_addons: true - kubernetes_ingress_controller: nginx - kubernetes_apiserver_vip: 192.168.77.140 roles: - kubernetes","title":"Example Playbook"},{"location":"roles/container/kubernetes/#_6","text":"\u5b89\u88c5\u5b8c\u96c6\u7fa4\u540e, \u6700\u597d\u91cd\u542f\u96c6\u7fa4\u89c2\u5bdf\u4e0b\u5065\u58ee\u6027\u3002","title":"\u8fd0\u884c\u65e5\u5fd7"},{"location":"roles/container/kubernetes/#_7","text":"kubectl get cs kubectl get csr kubectl get nodes kubectl get all --all-namespaces = true kubectl -n kube-system logs -f kube-scheduler-k8s-m2 kubectl -n kube-system get po -o wide -l k8s-app = kube-proxy kubectl -n kube-system get po -l k8s-app = kube-dns kubectl -n kube-system get po -l k8s-app = calico-node -o wide calicoctl node status kubectl -n kube-system get po,svc -l k8s-app = kubernetes-dashboard kubectl -n kube-system get po,svc | grep -E 'monitoring|heapster|influxdb' kubectl -n ingress-nginx get pods kubectl -n kube-system get po -l app = helm helm version","title":"\u68c0\u67e5\u96c6\u7fa4\u72b6\u6001"},{"location":"roles/container/kubernetes/#addons","text":"\u5728\u7b2c\u4e00\u53f0master\u670d\u52a1\u5668\u4e0a cat ~/k8s_addons_access dashboard_url: https://{{kubernetes_apiserver_vip}}:{{ kubernetes_apiserver_port }}/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login grafana_url: https://{{kubernetes_apiserver_vip}}:{{ kubernetes_apiserver_port }}/api/v1/namespaces/kube-system/services/monitoring-grafana/proxy/ elasticsearch_url: https://{{kubernetes_apiserver_vip}}:{{ kubernetes_apiserver_port }}/api/v1/namespaces/kube-system/services/elasticsearch-logging/proxy/ kibana_url: https://{{kubernetes_apiserver_vip}}:{{ kubernetes_apiserver_port }}/api/v1/namespaces/kube-system/services/kibana-logging/proxy/","title":"\u67e5\u770baddons\u8bbf\u95ee\u4fe1\u606f"},{"location":"roles/container/shipyard/","text":"Ansible Role:shipyard \u00b6 \u5b89\u88c5shipyard \u4ecb\u7ecd \u00b6 \u7b80\u5316\u5bf9\u6a2a\u8de8\u591a\u4e2a\u4e3b\u673a\u7684Docker\u5bb9\u5668\u96c6\u7fa4\u8fdb\u884c\u7ba1\u7406, \u76ee\u524d\u4f5c\u8005\u5df2\u4e0d\u518d\u7ef4\u62a4 github: https://github.com/shipyard/shipyard \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 shipyard_lang: 'cn' # (cn, en) shipyard_action: 'deploy' # (deploy, upgrade, node, remove) shipyard_port: 8080 shipyard_proxy_port: 2375 shipyard_discover: '' # etcd://node:4001 \u4f9d\u8d56 \u00b6 centos 7.3 \u4ee5\u4e0a\u7248\u672c docker github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/shipyard Example Playbook \u00b6 \u90e8\u7f72\u5355\u8282\u70b9 - hosts: node4 roles: - docker - shipyard \u90e8\u7f72\u591a\u8282\u70b9 - hosts: node4 roles: - docker - shipyard - hosts: node5 roles: - docker - {role: shipyard, shipyard_action: 'node', shipyard_discover: 'etcd://192.168.77.133:4001'} \u4f7f\u7528 \u00b6 docker ps -a","title":"shipyard"},{"location":"roles/container/shipyard/#ansible-roleshipyard","text":"\u5b89\u88c5shipyard","title":"Ansible Role:shipyard"},{"location":"roles/container/shipyard/#_1","text":"\u7b80\u5316\u5bf9\u6a2a\u8de8\u591a\u4e2a\u4e3b\u673a\u7684Docker\u5bb9\u5668\u96c6\u7fa4\u8fdb\u884c\u7ba1\u7406, \u76ee\u524d\u4f5c\u8005\u5df2\u4e0d\u518d\u7ef4\u62a4 github: https://github.com/shipyard/shipyard","title":"\u4ecb\u7ecd"},{"location":"roles/container/shipyard/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/container/shipyard/#_3","text":"ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/container/shipyard/#_4","text":"shipyard_lang: 'cn' # (cn, en) shipyard_action: 'deploy' # (deploy, upgrade, node, remove) shipyard_port: 8080 shipyard_proxy_port: 2375 shipyard_discover: '' # etcd://node:4001","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/container/shipyard/#_5","text":"centos 7.3 \u4ee5\u4e0a\u7248\u672c docker","title":"\u4f9d\u8d56"},{"location":"roles/container/shipyard/#github","text":"https://github.com/lework/Ansible-roles/tree/master/shipyard","title":"github\u5730\u5740"},{"location":"roles/container/shipyard/#example-playbook","text":"\u90e8\u7f72\u5355\u8282\u70b9 - hosts: node4 roles: - docker - shipyard \u90e8\u7f72\u591a\u8282\u70b9 - hosts: node4 roles: - docker - shipyard - hosts: node5 roles: - docker - {role: shipyard, shipyard_action: 'node', shipyard_discover: 'etcd://192.168.77.133:4001'}","title":"Example Playbook"},{"location":"roles/container/shipyard/#_6","text":"docker ps -a","title":"\u4f7f\u7528"},{"location":"roles/database/codis/","text":"Ansible Role: Codis \u00b6 \u5b89\u88c5Codis\u96c6\u7fa4 \u4ecb\u7ecd \u00b6 Codis \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f Redis \u89e3\u51b3\u65b9\u6848, \u5bf9\u4e8e\u4e0a\u5c42\u7684\u5e94\u7528\u6765\u8bf4, \u8fde\u63a5\u5230 Codis Proxy \u548c\u8fde\u63a5\u539f\u751f\u7684 Redis Server \u6ca1\u6709\u663e\u8457\u533a\u522b (\u4e0d\u652f\u6301\u7684\u547d\u4ee4\u5217\u8868), \u4e0a\u5c42\u5e94\u7528\u53ef\u4ee5\u50cf\u4f7f\u7528\u5355\u673a\u7684 Redis \u4e00\u6837\u4f7f\u7528, Codis \u5e95\u5c42\u4f1a\u5904\u7406\u8bf7\u6c42\u7684\u8f6c\u53d1, \u4e0d\u505c\u673a\u7684\u6570\u636e\u8fc1\u79fb\u7b49\u5de5\u4f5c, \u6240\u6709\u540e\u8fb9\u7684\u4e00\u5207\u4e8b\u60c5, \u5bf9\u4e8e\u524d\u9762\u7684\u5ba2\u6237\u7aef\u6765\u8bf4\u662f\u900f\u660e\u7684, \u53ef\u4ee5\u7b80\u5355\u7684\u8ba4\u4e3a\u540e\u8fb9\u8fde\u63a5\u7684\u662f\u4e00\u4e2a\u5185\u5b58\u65e0\u9650\u5927\u7684 Redis \u670d\u52a1\u3002 github\u5730\u5740\uff1a https://github.com/CodisLabs/codis \u4f7f\u7528\u6587\u6863\uff1a https://github.com/CodisLabs/codis/blob/release3.2/doc/tutorial_zh.md \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" codis_version: \"3.1.3\" codis_file: \"codis-{{ codis_version }}.tar.gz\" codis_file_path: \"{{ software_files_path }}/{{ codis_file }}\" codis_file_url: \"https://github.com/CodisLabs/codis/archive/{{ codis_version }}.tar.gz\" codis_basedir: \"{{ software_install_path }}/codis\" codis_conf_path: \"{{ codis_basedir }}/conf\" codis_bin_path: \"{{ codis_basedir }}/bin\" codis_server: false codis_server_port: 6379 codis_server_daemon: \"codis-server{{ codis_server_port }}\" codis_server_requirepass: 'rtest' codis_server_masterauth: 'rtest' codis_server_sentinel_port: '' codis_server_sentinel_quorum: 2 codis_server_sentinel_daemon: \"codis-server-sentinel{{ codis_server_sentinel_port }}\" codis_server_sentinel_monitor_name: 'master1' codis_server_sentinel_addr: '' codis_server_master_host: \"{{ ansible_default_ipv4.address }}\" codis_server_master_port: \"6379\" codis_data_path: \"/codis_data\" codis_gopath: \"{{ codis_data_path }}/gopath\" codis_labs_path: \"{{ codis_gopath }}/src/github.com/CodisLabs\" codis_server_data_path: \"{{ codis_data_path}}/codis-server_{{ codis_server_port }}\" codis_server_logs_path: \"{{ codis_data_path}}/logs/codis-server\" codis_pid_path: \"{{ codis_data_path }}/pid\" codis_loglevel: \"WARN\" codis_bind_address: \"0.0.0.0\" codis_ncpu: 1 codis_product_name: \"codis-demo\" codis_coordinator_name: \"zookeeper\" codis_admin_prot: 11080 codis_admin_addr: \"0.0.0.0:{{ codis_admin_prot }}\" codis_fe: false codis_fe_port: 8080 codis_fe_listen: \"0.0.0.0:{{ codis_fe_port }}\" codis_fe_logs_path: \"{{ codis_data_path}}/logs/fe\" codis_ha: false codis_ha_logs_path: \"{{ codis_data_path}}/logs/ha\" codis_admin: false codis_dashboard: false codis_dashboard_port: 18080 codis_dashboard_addr: \"0.0.0.0:{{ codis_codis_dashboard_port_prot }}\" codis_dashboard_logs_path: \"{{ codis_data_path}}/logs/dashboard\" codis_proxy: false codis_proxy_port: 19000 codis_proxy_addr: \"0.0.0.0:{{ codis_proxy_port }}\" codis_proxy_logs_path: \"{{ codis_data_path}}/logs/proxy\" install: true zookeeper_hosts: [] codis_groups: [] codis_group_master_server: [] codis_group_slave_server: [] codis_proxy_addrs: [] \u4f9d\u8d56 \u00b6 go zookeeper github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/codis Example Playbook \u00b6 \u90e8\u7f72\u96c6\u7fa4 IP \u4e3b\u673a\u540d \u90e8\u7f72\u7a0b\u5e8f 192.168.77.129 node1 zookeeper codis-group codis-proxy sentinel codis-dashboard codis-fe codis-ha 192.168.77.130 node2 zookeeper codis-group codis-proxy sentinel 192.168.77.131 node3 zookeeper codis-group codis-proxy sentinel - hosts: 192.168.77.129 192.168.77.130 192.168.77.131 vars: - codis_version: \"3.1.5\" - zookeeper_hosts: - {'host': 192.168.77.129, 'id': 1} - {'host': 192.168.77.130, 'id': 2} - {'host': 192.168.77.131, 'id': 3} roles: - { role: zookeeper } - { role: codis, codis_server: true, codis_server_port: 6379, codis_server_sentinel_port: 26379} - { role: codis, install: false, codis_server: true, codis_server_port: 6380, codis_server_sentinel_port: 26380 } - { role: codis, install: false, codis_proxy: true } - hosts: 192.168.77.129 vars: - zookeeper_hosts: - {'host': 192.168.77.129, 'id': 1} - {'host': 192.168.77.130, 'id': 2} - {'host': 192.168.77.131, 'id': 3} - codis_dashboard_addr: 192.168.77.129:18080 - codis_groups: [1,2,3] - codis_group_master_server: - {'gid': 1, 'addr': '192.168.77.129:6379'} - {'gid': 2, 'addr': '192.168.77.130:6379'} - {'gid': 3, 'addr': '192.168.77.131:6379'} - codis_group_slave_server: - {'gid': 1, 'addr': '192.168.77.129:6380'} - {'gid': 2, 'addr': '192.168.77.130:6380'} - {'gid': 3, 'addr': '192.168.77.131:6380'} - codis_proxy_addrs: - 192.168.77.129:11080 - 192.168.77.130:11080 - 192.168.77.131:11080 - codis_server_sentinel_addr: - 192.168.77.129:26379 - 192.168.77.129:26380 - 192.168.77.130:26379 - 192.168.77.130:26380 - 192.168.77.131:26379 - 192.168.77.131:26380 roles: - { role: codis, install: false, codis_dashboard: true } - { role: codis, install: false, codis_fe: true } - { role: codis, install: false, codis_admin: true } - { role: codis, install: false, codis_ha: true } \u5b89\u88c5sentinel - hosts: 192.168.77.129 vars: - codis_server_master_host: 192.168.77.129 - codis_server_master_port: 6379 - codis_server_sentinel_addr: - 192.168.77.129\uff1a26381 roles: - { role: codis, install: false, codis_server_sentinel_port: 26381} - { role: codis, install: false, codis_admin: true }","title":"codis"},{"location":"roles/database/codis/#ansible-role-codis","text":"\u5b89\u88c5Codis\u96c6\u7fa4","title":"Ansible Role: Codis"},{"location":"roles/database/codis/#_1","text":"Codis \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f Redis \u89e3\u51b3\u65b9\u6848, \u5bf9\u4e8e\u4e0a\u5c42\u7684\u5e94\u7528\u6765\u8bf4, \u8fde\u63a5\u5230 Codis Proxy \u548c\u8fde\u63a5\u539f\u751f\u7684 Redis Server \u6ca1\u6709\u663e\u8457\u533a\u522b (\u4e0d\u652f\u6301\u7684\u547d\u4ee4\u5217\u8868), \u4e0a\u5c42\u5e94\u7528\u53ef\u4ee5\u50cf\u4f7f\u7528\u5355\u673a\u7684 Redis \u4e00\u6837\u4f7f\u7528, Codis \u5e95\u5c42\u4f1a\u5904\u7406\u8bf7\u6c42\u7684\u8f6c\u53d1, \u4e0d\u505c\u673a\u7684\u6570\u636e\u8fc1\u79fb\u7b49\u5de5\u4f5c, \u6240\u6709\u540e\u8fb9\u7684\u4e00\u5207\u4e8b\u60c5, \u5bf9\u4e8e\u524d\u9762\u7684\u5ba2\u6237\u7aef\u6765\u8bf4\u662f\u900f\u660e\u7684, \u53ef\u4ee5\u7b80\u5355\u7684\u8ba4\u4e3a\u540e\u8fb9\u8fde\u63a5\u7684\u662f\u4e00\u4e2a\u5185\u5b58\u65e0\u9650\u5927\u7684 Redis \u670d\u52a1\u3002 github\u5730\u5740\uff1a https://github.com/CodisLabs/codis \u4f7f\u7528\u6587\u6863\uff1a https://github.com/CodisLabs/codis/blob/release3.2/doc/tutorial_zh.md","title":"\u4ecb\u7ecd"},{"location":"roles/database/codis/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/database/codis/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/database/codis/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" codis_version: \"3.1.3\" codis_file: \"codis-{{ codis_version }}.tar.gz\" codis_file_path: \"{{ software_files_path }}/{{ codis_file }}\" codis_file_url: \"https://github.com/CodisLabs/codis/archive/{{ codis_version }}.tar.gz\" codis_basedir: \"{{ software_install_path }}/codis\" codis_conf_path: \"{{ codis_basedir }}/conf\" codis_bin_path: \"{{ codis_basedir }}/bin\" codis_server: false codis_server_port: 6379 codis_server_daemon: \"codis-server{{ codis_server_port }}\" codis_server_requirepass: 'rtest' codis_server_masterauth: 'rtest' codis_server_sentinel_port: '' codis_server_sentinel_quorum: 2 codis_server_sentinel_daemon: \"codis-server-sentinel{{ codis_server_sentinel_port }}\" codis_server_sentinel_monitor_name: 'master1' codis_server_sentinel_addr: '' codis_server_master_host: \"{{ ansible_default_ipv4.address }}\" codis_server_master_port: \"6379\" codis_data_path: \"/codis_data\" codis_gopath: \"{{ codis_data_path }}/gopath\" codis_labs_path: \"{{ codis_gopath }}/src/github.com/CodisLabs\" codis_server_data_path: \"{{ codis_data_path}}/codis-server_{{ codis_server_port }}\" codis_server_logs_path: \"{{ codis_data_path}}/logs/codis-server\" codis_pid_path: \"{{ codis_data_path }}/pid\" codis_loglevel: \"WARN\" codis_bind_address: \"0.0.0.0\" codis_ncpu: 1 codis_product_name: \"codis-demo\" codis_coordinator_name: \"zookeeper\" codis_admin_prot: 11080 codis_admin_addr: \"0.0.0.0:{{ codis_admin_prot }}\" codis_fe: false codis_fe_port: 8080 codis_fe_listen: \"0.0.0.0:{{ codis_fe_port }}\" codis_fe_logs_path: \"{{ codis_data_path}}/logs/fe\" codis_ha: false codis_ha_logs_path: \"{{ codis_data_path}}/logs/ha\" codis_admin: false codis_dashboard: false codis_dashboard_port: 18080 codis_dashboard_addr: \"0.0.0.0:{{ codis_codis_dashboard_port_prot }}\" codis_dashboard_logs_path: \"{{ codis_data_path}}/logs/dashboard\" codis_proxy: false codis_proxy_port: 19000 codis_proxy_addr: \"0.0.0.0:{{ codis_proxy_port }}\" codis_proxy_logs_path: \"{{ codis_data_path}}/logs/proxy\" install: true zookeeper_hosts: [] codis_groups: [] codis_group_master_server: [] codis_group_slave_server: [] codis_proxy_addrs: []","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/database/codis/#_5","text":"go zookeeper","title":"\u4f9d\u8d56"},{"location":"roles/database/codis/#github","text":"https://github.com/lework/Ansible-roles/tree/master/codis","title":"github\u5730\u5740"},{"location":"roles/database/codis/#example-playbook","text":"\u90e8\u7f72\u96c6\u7fa4 IP \u4e3b\u673a\u540d \u90e8\u7f72\u7a0b\u5e8f 192.168.77.129 node1 zookeeper codis-group codis-proxy sentinel codis-dashboard codis-fe codis-ha 192.168.77.130 node2 zookeeper codis-group codis-proxy sentinel 192.168.77.131 node3 zookeeper codis-group codis-proxy sentinel - hosts: 192.168.77.129 192.168.77.130 192.168.77.131 vars: - codis_version: \"3.1.5\" - zookeeper_hosts: - {'host': 192.168.77.129, 'id': 1} - {'host': 192.168.77.130, 'id': 2} - {'host': 192.168.77.131, 'id': 3} roles: - { role: zookeeper } - { role: codis, codis_server: true, codis_server_port: 6379, codis_server_sentinel_port: 26379} - { role: codis, install: false, codis_server: true, codis_server_port: 6380, codis_server_sentinel_port: 26380 } - { role: codis, install: false, codis_proxy: true } - hosts: 192.168.77.129 vars: - zookeeper_hosts: - {'host': 192.168.77.129, 'id': 1} - {'host': 192.168.77.130, 'id': 2} - {'host': 192.168.77.131, 'id': 3} - codis_dashboard_addr: 192.168.77.129:18080 - codis_groups: [1,2,3] - codis_group_master_server: - {'gid': 1, 'addr': '192.168.77.129:6379'} - {'gid': 2, 'addr': '192.168.77.130:6379'} - {'gid': 3, 'addr': '192.168.77.131:6379'} - codis_group_slave_server: - {'gid': 1, 'addr': '192.168.77.129:6380'} - {'gid': 2, 'addr': '192.168.77.130:6380'} - {'gid': 3, 'addr': '192.168.77.131:6380'} - codis_proxy_addrs: - 192.168.77.129:11080 - 192.168.77.130:11080 - 192.168.77.131:11080 - codis_server_sentinel_addr: - 192.168.77.129:26379 - 192.168.77.129:26380 - 192.168.77.130:26379 - 192.168.77.130:26380 - 192.168.77.131:26379 - 192.168.77.131:26380 roles: - { role: codis, install: false, codis_dashboard: true } - { role: codis, install: false, codis_fe: true } - { role: codis, install: false, codis_admin: true } - { role: codis, install: false, codis_ha: true } \u5b89\u88c5sentinel - hosts: 192.168.77.129 vars: - codis_server_master_host: 192.168.77.129 - codis_server_master_port: 6379 - codis_server_sentinel_addr: - 192.168.77.129\uff1a26381 roles: - { role: codis, install: false, codis_server_sentinel_port: 26381} - { role: codis, install: false, codis_admin: true }","title":"Example Playbook"},{"location":"roles/database/memcached/","text":"Ansible Role: Memcached \u00b6 \u5b89\u88c5Memcached \u4ecb\u7ecd \u00b6 Memcached \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684\u5206\u5e03\u5f0f\u5185\u5b58\u5bf9\u8c61\u7f13\u5b58\u7cfb\u7edf\uff0c\u7528\u4e8e\u52a8\u6001Web\u5e94\u7528\u4ee5\u51cf\u8f7b\u6570\u636e\u5e93\u8d1f\u8f7d\u3002\u5b83\u901a\u8fc7\u5728\u5185\u5b58\u4e2d\u7f13\u5b58\u6570\u636e\u548c\u5bf9\u8c61\u6765\u51cf\u5c11\u8bfb\u53d6\u6570\u636e\u5e93\u7684\u6b21\u6570\uff0c\u4ece\u800c\u63d0\u9ad8\u52a8\u6001\u3001\u6570\u636e\u5e93\u9a71\u52a8\u7f51\u7ad9\u7684\u901f\u5ea6\u3002Memcached\u57fa\u4e8e\u4e00\u4e2a\u5b58\u50a8\u952e/\u503c\u5bf9\u7684hashmap\u3002\u5176\u5b88\u62a4\u8fdb\u7a0b\uff08daemon \uff09\u662f\u7528C\u5199\u7684\uff0c\u4f46\u662f\u5ba2\u6237\u7aef\u53ef\u4ee5\u7528\u4efb\u4f55\u8bed\u8a00\u6765\u7f16\u5199\uff0c\u5e76\u901a\u8fc7memcached\u534f\u8bae\u4e0e\u5b88\u62a4\u8fdb\u7a0b\u901a\u4fe1\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a http://memcached.org/ github\u5730\u5740\uff1a https://github.com/memcached/memcached \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" memcached_version: \"1.4.33\" memcached_file: \"memcached-{{ memcached_version }}.tar.gz\" memcached_file_path: \"{{ software_files_path }}/{{ memcached_file }}\" memcached_file_url: \"http://memcached.org/files/memcached-{{ memcached_version }}.tar.gz\" memcached_listen_ip: 0.0.0.0 memcached_daemon: \"memcached{{ memcached_port | default('') }}\" memcached_cachesize: 64 memcached_maxconn: 1024 memcached_log_file: /var/log/memcached{{ memcached_port | default('') }}.log memcached_log_verbosity: \"-vv\" memcached_options: \"-l {{ memcached_listen_ip }} {{ memcached_log_verbosity }} 2>> {{ memcached_log_file }}\" \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/memcached Example Playbook \u00b6 \u5b89\u88c5memcached\uff0c\u9ed8\u8ba4\u7aef\u53e311211 - hosts: node1 roles: - { role: memcached } \u6307\u5b9a\u7aef\u53e3 - hosts: node1 roles: - { role: memcached, memcached_port: 11222 }","title":"memcached"},{"location":"roles/database/memcached/#ansible-role-memcached","text":"\u5b89\u88c5Memcached","title":"Ansible Role: Memcached"},{"location":"roles/database/memcached/#_1","text":"Memcached \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684\u5206\u5e03\u5f0f\u5185\u5b58\u5bf9\u8c61\u7f13\u5b58\u7cfb\u7edf\uff0c\u7528\u4e8e\u52a8\u6001Web\u5e94\u7528\u4ee5\u51cf\u8f7b\u6570\u636e\u5e93\u8d1f\u8f7d\u3002\u5b83\u901a\u8fc7\u5728\u5185\u5b58\u4e2d\u7f13\u5b58\u6570\u636e\u548c\u5bf9\u8c61\u6765\u51cf\u5c11\u8bfb\u53d6\u6570\u636e\u5e93\u7684\u6b21\u6570\uff0c\u4ece\u800c\u63d0\u9ad8\u52a8\u6001\u3001\u6570\u636e\u5e93\u9a71\u52a8\u7f51\u7ad9\u7684\u901f\u5ea6\u3002Memcached\u57fa\u4e8e\u4e00\u4e2a\u5b58\u50a8\u952e/\u503c\u5bf9\u7684hashmap\u3002\u5176\u5b88\u62a4\u8fdb\u7a0b\uff08daemon \uff09\u662f\u7528C\u5199\u7684\uff0c\u4f46\u662f\u5ba2\u6237\u7aef\u53ef\u4ee5\u7528\u4efb\u4f55\u8bed\u8a00\u6765\u7f16\u5199\uff0c\u5e76\u901a\u8fc7memcached\u534f\u8bae\u4e0e\u5b88\u62a4\u8fdb\u7a0b\u901a\u4fe1\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a http://memcached.org/ github\u5730\u5740\uff1a https://github.com/memcached/memcached","title":"\u4ecb\u7ecd"},{"location":"roles/database/memcached/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/database/memcached/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/database/memcached/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" memcached_version: \"1.4.33\" memcached_file: \"memcached-{{ memcached_version }}.tar.gz\" memcached_file_path: \"{{ software_files_path }}/{{ memcached_file }}\" memcached_file_url: \"http://memcached.org/files/memcached-{{ memcached_version }}.tar.gz\" memcached_listen_ip: 0.0.0.0 memcached_daemon: \"memcached{{ memcached_port | default('') }}\" memcached_cachesize: 64 memcached_maxconn: 1024 memcached_log_file: /var/log/memcached{{ memcached_port | default('') }}.log memcached_log_verbosity: \"-vv\" memcached_options: \"-l {{ memcached_listen_ip }} {{ memcached_log_verbosity }} 2>> {{ memcached_log_file }}\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/database/memcached/#_5","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/database/memcached/#github","text":"https://github.com/lework/Ansible-roles/tree/master/memcached","title":"github\u5730\u5740"},{"location":"roles/database/memcached/#example-playbook","text":"\u5b89\u88c5memcached\uff0c\u9ed8\u8ba4\u7aef\u53e311211 - hosts: node1 roles: - { role: memcached } \u6307\u5b9a\u7aef\u53e3 - hosts: node1 roles: - { role: memcached, memcached_port: 11222 }","title":"Example Playbook"},{"location":"roles/database/mongodb/","text":"Ansible Role: Mongodb \u00b6 \u5b89\u88c5Mongodb \u4ecb\u7ecd \u00b6 MongoDB\u662f\u4e00\u4e2a\u57fa\u4e8e\u5206\u5e03\u5f0f\u6587\u4ef6\u5b58\u50a8\u7684\u6570\u636e\u5e93\u3002\u7531C++\u8bed\u8a00\u7f16\u5199\u3002\u65e8\u5728\u4e3aWEB\u5e94\u7528\u63d0\u4f9b\u53ef\u6269\u5c55\u7684\u9ad8\u6027\u80fd\u6570\u636e\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\u3002 \u5728\u9ad8\u8d1f\u8f7d\u7684\u60c5\u51b5\u4e0b\uff0c\u6dfb\u52a0\u66f4\u591a\u7684\u8282\u70b9\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u670d\u52a1\u5668\u6027\u80fd\u3002 MongoDB \u65e8\u5728\u4e3aWEB\u5e94\u7528\u63d0\u4f9b\u53ef\u6269\u5c55\u7684\u9ad8\u6027\u80fd\u6570\u636e\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\u3002 MongoDB \u5c06\u6570\u636e\u5b58\u50a8\u4e3a\u4e00\u4e2a\u6587\u6863\uff0c\u6570\u636e\u7ed3\u6784\u7531\u952e\u503c(key=>value)\u5bf9\u7ec4\u6210\u3002MongoDB \u6587\u6863\u7c7b\u4f3c\u4e8e JSON \u5bf9\u8c61\u3002\u5b57\u6bb5\u503c\u53ef\u4ee5\u5305\u542b\u5176\u4ed6\u6587\u6863\uff0c\u6570\u7ec4\u53ca\u6587\u6863\u6570\u7ec4\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://www.mongodb.com/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://docs.mongodb.com/manual/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" mongodb_version: \"3.2.4\" mongodb_file: \"mongodb-linux-x86_64-rhel62-{{ mongodb_version }}.tgz\" mongodb_file_path: \"{{ software_files_path }}/{{ mongodb_file }}\" mongodb_file_url: \"http://downloads.mongodb.org/linux/mongodb-linux-x86_64-rhel62-{{ mongodb_version }}.tgz\" mongodb_data_path: \"/mongodb_data\" #mongodb_port: 27017 mongodb_daemon: \"mongodb{{ mongodb_port | default('') }}\" mongodb_dir_path: \"{{ mongodb_data_path }}/{{mongodb_port | default('27017') }}\" mongodb_conf: \"{{ mongodb_dir_path }}/mongod.conf\" mongodb_user: \"mongodb\" mongodb_dbpath: \"{{ mongodb_dir_path }}/data\" mongodb_logpath: \"{{ mongodb_dir_path }}/logs/mongod.log\" mongodb_pidfilepath: \"{{ mongodb_dir_path }}/mongod.pid\" mongodb_fork: true mongodb_logappend: true mongodb_directoryperdb: true mongodb_auth: false mongodb_rest: false # \u4e3b\u4ece\u67b6\u6784\u914d\u7f6e mongodb_master: false mongodb_slave: false mongodb_master_source: '' # \u526f\u672c\u96c6\u914d\u7f6e mongodb_replSet: false mongodb_replSet_exec: false mongodb_members: {} \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/mongodb Example Playbook \u00b6 \u5b89\u88c5\u5355\u4e2amongodb, \u9ed8\u8ba4\u7aef\u53e327017 - hosts: node1 roles: - { role: mongodb} \u6307\u5b9a\u7aef\u53e3\u53f7\uff0c\u5e76\u5f00\u542fweb - hosts: node1 roles: - { role: mongodb, mongodb_port: 27018, mongodb_rest: true} \u4e3b\u4ece\u540c\u6b65 - hosts: node1 roles: - { role: mongodb, mongodb_port: 27020, mongodb_master: true} - { role: mongodb, mongodb_port: 27021, mongodb_slave: true, mongodb_master_source: '192.168.77.129:27020'} \u5b89\u88c5\u96c6\u7fa4 - hosts: node1 vars: - mongodb_replSet: 'test_rep' - mongodb_members: { '0': \"192.168.77.129:27031\", '1': \"192.168.77.129:27032\" } roles: - { role: mongodb, mongodb_port: 27031} - { role: mongodb, mongodb_port: 27032, mongodb_replSet_exec: true}","title":"mongodb"},{"location":"roles/database/mongodb/#ansible-role-mongodb","text":"\u5b89\u88c5Mongodb","title":"Ansible Role: Mongodb"},{"location":"roles/database/mongodb/#_1","text":"MongoDB\u662f\u4e00\u4e2a\u57fa\u4e8e\u5206\u5e03\u5f0f\u6587\u4ef6\u5b58\u50a8\u7684\u6570\u636e\u5e93\u3002\u7531C++\u8bed\u8a00\u7f16\u5199\u3002\u65e8\u5728\u4e3aWEB\u5e94\u7528\u63d0\u4f9b\u53ef\u6269\u5c55\u7684\u9ad8\u6027\u80fd\u6570\u636e\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\u3002 \u5728\u9ad8\u8d1f\u8f7d\u7684\u60c5\u51b5\u4e0b\uff0c\u6dfb\u52a0\u66f4\u591a\u7684\u8282\u70b9\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u670d\u52a1\u5668\u6027\u80fd\u3002 MongoDB \u65e8\u5728\u4e3aWEB\u5e94\u7528\u63d0\u4f9b\u53ef\u6269\u5c55\u7684\u9ad8\u6027\u80fd\u6570\u636e\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\u3002 MongoDB \u5c06\u6570\u636e\u5b58\u50a8\u4e3a\u4e00\u4e2a\u6587\u6863\uff0c\u6570\u636e\u7ed3\u6784\u7531\u952e\u503c(key=>value)\u5bf9\u7ec4\u6210\u3002MongoDB \u6587\u6863\u7c7b\u4f3c\u4e8e JSON \u5bf9\u8c61\u3002\u5b57\u6bb5\u503c\u53ef\u4ee5\u5305\u542b\u5176\u4ed6\u6587\u6863\uff0c\u6570\u7ec4\u53ca\u6587\u6863\u6570\u7ec4\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://www.mongodb.com/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://docs.mongodb.com/manual/","title":"\u4ecb\u7ecd"},{"location":"roles/database/mongodb/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/database/mongodb/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/database/mongodb/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" mongodb_version: \"3.2.4\" mongodb_file: \"mongodb-linux-x86_64-rhel62-{{ mongodb_version }}.tgz\" mongodb_file_path: \"{{ software_files_path }}/{{ mongodb_file }}\" mongodb_file_url: \"http://downloads.mongodb.org/linux/mongodb-linux-x86_64-rhel62-{{ mongodb_version }}.tgz\" mongodb_data_path: \"/mongodb_data\" #mongodb_port: 27017 mongodb_daemon: \"mongodb{{ mongodb_port | default('') }}\" mongodb_dir_path: \"{{ mongodb_data_path }}/{{mongodb_port | default('27017') }}\" mongodb_conf: \"{{ mongodb_dir_path }}/mongod.conf\" mongodb_user: \"mongodb\" mongodb_dbpath: \"{{ mongodb_dir_path }}/data\" mongodb_logpath: \"{{ mongodb_dir_path }}/logs/mongod.log\" mongodb_pidfilepath: \"{{ mongodb_dir_path }}/mongod.pid\" mongodb_fork: true mongodb_logappend: true mongodb_directoryperdb: true mongodb_auth: false mongodb_rest: false # \u4e3b\u4ece\u67b6\u6784\u914d\u7f6e mongodb_master: false mongodb_slave: false mongodb_master_source: '' # \u526f\u672c\u96c6\u914d\u7f6e mongodb_replSet: false mongodb_replSet_exec: false mongodb_members: {}","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/database/mongodb/#_5","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/database/mongodb/#github","text":"https://github.com/lework/Ansible-roles/tree/master/mongodb","title":"github\u5730\u5740"},{"location":"roles/database/mongodb/#example-playbook","text":"\u5b89\u88c5\u5355\u4e2amongodb, \u9ed8\u8ba4\u7aef\u53e327017 - hosts: node1 roles: - { role: mongodb} \u6307\u5b9a\u7aef\u53e3\u53f7\uff0c\u5e76\u5f00\u542fweb - hosts: node1 roles: - { role: mongodb, mongodb_port: 27018, mongodb_rest: true} \u4e3b\u4ece\u540c\u6b65 - hosts: node1 roles: - { role: mongodb, mongodb_port: 27020, mongodb_master: true} - { role: mongodb, mongodb_port: 27021, mongodb_slave: true, mongodb_master_source: '192.168.77.129:27020'} \u5b89\u88c5\u96c6\u7fa4 - hosts: node1 vars: - mongodb_replSet: 'test_rep' - mongodb_members: { '0': \"192.168.77.129:27031\", '1': \"192.168.77.129:27032\" } roles: - { role: mongodb, mongodb_port: 27031} - { role: mongodb, mongodb_port: 27032, mongodb_replSet_exec: true}","title":"Example Playbook"},{"location":"roles/database/mycat/","text":"Ansible Role: mycat \u00b6 \u5b89\u88c5mycat \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" mycat_version: \"1.6\" mycat_file: \"Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gz\" mycat_file_path: \"{{ software_files_path }}/{{ mycat_file }}\" mycat_file_url: \"http://dl.mycat.io/1.6-RELEASE/Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gz\" mycat_conf_path: \"{{ software_install_path }}/mycat/conf\" \u4f9d\u8d56 \u00b6 java github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/mycat Example Playbook \u00b6 - hosts: servers roles: - mycat","title":"mycat"},{"location":"roles/database/mycat/#ansible-role-mycat","text":"\u5b89\u88c5mycat","title":"Ansible Role: mycat"},{"location":"roles/database/mycat/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/database/mycat/#_2","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/database/mycat/#_3","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" mycat_version: \"1.6\" mycat_file: \"Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gz\" mycat_file_path: \"{{ software_files_path }}/{{ mycat_file }}\" mycat_file_url: \"http://dl.mycat.io/1.6-RELEASE/Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gz\" mycat_conf_path: \"{{ software_install_path }}/mycat/conf\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/database/mycat/#_4","text":"java","title":"\u4f9d\u8d56"},{"location":"roles/database/mycat/#github","text":"https://github.com/lework/Ansible-roles/tree/master/mycat","title":"github\u5730\u5740"},{"location":"roles/database/mycat/#example-playbook","text":"- hosts: servers roles: - mycat","title":"Example Playbook"},{"location":"roles/database/mysql/","text":"Ansible Role: Mysql \u00b6 \u5b89\u88c5mysql \u4ecb\u7ecd \u00b6 MySQL\u662f\u4e00\u4e2a\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u7531\u745e\u5178MySQL AB \u516c\u53f8\u5f00\u53d1\uff0c\u76ee\u524d\u5c5e\u4e8e Oracle \u65d7\u4e0b\u4ea7\u54c1\u3002MySQL \u662f\u6700\u6d41\u884c\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u4e4b\u4e00\uff0c\u5728 WEB \u5e94\u7528\u65b9\u9762\uff0cMySQL\u662f\u6700\u597d\u7684 RDBMS (Relational Database Management System\uff0c\u5173\u7cfb\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf) \u5e94\u7528\u8f6f\u4ef6\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.mysql.com/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://dev.mysql.com/doc/refman/5.6/en/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.4.2.0 os Centos 7.2 X64 python 2.7.5 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" mysql_version: \"5.6.39\" mysql_file: \"mysql-{{ mysql_version }}.tar.gz\" mysql_file_path: \"{{ software_files_path }}/{{ mysql_file }}\" mysql_file_url: \"https://cdn.mysql.com/Downloads/MySQL-5.6/mysql-{{ mysql_version }}.tar.gz\" mysql_dirname: \"mysql-{{ mysql_version }}\" mysql_port: \"3306\" mysql_user: \"root\" mysql_password: \"123456\" mysql_datahome: \"/mysql_data\" mysql_basedir: \"{{ software_install_path }}/mysql\" mysql_portdir: \"{{ mysql_datahome }}/{{ mysql_port }}\" mysql_datadir: \"{{ mysql_datahome }}/{{ mysql_port }}/data\" mysql_cnf : \"{{ mysql_datahome }}/{{ mysql_port }}/my.cnf\" mysql_sock : \"{{ mysql_datahome }}/{{ mysql_port }}/mysql.sock\" mysql_startsh : \"{{ mysql_datahome }}/{{ mysql_port }}/mysql{{ mysql_port }}.sh\" mysql_install_from_source: false mysql_source_configure_command: > /usr/bin/cmake -DCMAKE_INSTALL_PREFIX={{ software_install_path }}/mysql-{{ mysql_version }} -DMYSQL_UNIX_ADDR={{ mysql_sock }} -DDEFAULT_CHARSET=utf8mb4 -DDEFAULT_COLLATION=utf8mb4_unicode_ci -DWITH_EXTRA_CHARSETS:STRING=all -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_MEMORY_STORAGE_ENGINE=1 -DWITH_PARTITION_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DENABLED_LOCAL_INFILE=1 -DMYSQL_DATADIR={{ mysql_datadir }} -DMYSQL_USER=mysql -DMYSQL_TCP_PORT={{ mysql_port }} -DWITH_SSL=system mysql_replication_user: {name: 'rep', password: '123456'} mysql_replication_master: '' mysql_replication_master_port: \"3306\" mysql_replication_role: '' mysql_auto_increment_offset: '' mysql_binlog_format: \"STATEMENT\" \u4f9d\u8d56 \u00b6 gcc cmake github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/mysql Example Playbook \u00b6 \u4f7f\u7528bin\u6587\u4ef6\u5b89\u88c5(\u5df2\u7f16\u8bd1\u597d\u7684mysql\uff0c\u6587\u4ef6/opt/software/mysql-5.6.10-bin.tar.gz)\uff1a - hosts: node1 roles: - { role: mysql } \u6e90\u7801\u5b89\u88c5\uff1a - hosts: node1 roles: - { role: mysql , mysql_install_from_source: true } \u4e3b\u4ece\u5b89\u88c5\uff1a - hosts: node1 roles: - { role: mysql, mysql_replication_role: 'master'} - { role: mysql, mysql_port: 3307, mysql_replication_role: 'slave', mysql_replication_master: '192.168.77.129'} \u4e92\u4e3a\u4e3b\u5907\u5b89\u88c5\uff1a - hosts: node1 roles: - { role: mysql, mysql_port: 3306, mysql_replication_role: 'master', auto_increment_offset: 1} - { role: mysql, mysql_port: 3307, mysql_replication_role: 'slave', mysql_replication_master: '192.168.77.129', auto_increment_offset: 2} - { role: mysql, mysql_port: 3307, mysql_replication_role: 'master' } - { role: mysql, mysql_port: 3306, mysql_replication_role: 'slave', mysql_replication_master: '192.168.77.129', mysql_replication_master_port: 3307} \u4f7f\u7528 \u00b6 \u542f\u52a8\u547d\u4ee4\uff1a/mysql_data/3306/mysql3306.sh start \u5173\u95ed\u547d\u4ee4\uff1a/mysql_data/3306/mysql3306.sh stop","title":"mysql"},{"location":"roles/database/mysql/#ansible-role-mysql","text":"\u5b89\u88c5mysql","title":"Ansible Role: Mysql"},{"location":"roles/database/mysql/#_1","text":"MySQL\u662f\u4e00\u4e2a\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u7531\u745e\u5178MySQL AB \u516c\u53f8\u5f00\u53d1\uff0c\u76ee\u524d\u5c5e\u4e8e Oracle \u65d7\u4e0b\u4ea7\u54c1\u3002MySQL \u662f\u6700\u6d41\u884c\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u4e4b\u4e00\uff0c\u5728 WEB \u5e94\u7528\u65b9\u9762\uff0cMySQL\u662f\u6700\u597d\u7684 RDBMS (Relational Database Management System\uff0c\u5173\u7cfb\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf) \u5e94\u7528\u8f6f\u4ef6\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.mysql.com/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://dev.mysql.com/doc/refman/5.6/en/","title":"\u4ecb\u7ecd"},{"location":"roles/database/mysql/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/database/mysql/#_3","text":"ansible 2.4.2.0 os Centos 7.2 X64 python 2.7.5","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/database/mysql/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" mysql_version: \"5.6.39\" mysql_file: \"mysql-{{ mysql_version }}.tar.gz\" mysql_file_path: \"{{ software_files_path }}/{{ mysql_file }}\" mysql_file_url: \"https://cdn.mysql.com/Downloads/MySQL-5.6/mysql-{{ mysql_version }}.tar.gz\" mysql_dirname: \"mysql-{{ mysql_version }}\" mysql_port: \"3306\" mysql_user: \"root\" mysql_password: \"123456\" mysql_datahome: \"/mysql_data\" mysql_basedir: \"{{ software_install_path }}/mysql\" mysql_portdir: \"{{ mysql_datahome }}/{{ mysql_port }}\" mysql_datadir: \"{{ mysql_datahome }}/{{ mysql_port }}/data\" mysql_cnf : \"{{ mysql_datahome }}/{{ mysql_port }}/my.cnf\" mysql_sock : \"{{ mysql_datahome }}/{{ mysql_port }}/mysql.sock\" mysql_startsh : \"{{ mysql_datahome }}/{{ mysql_port }}/mysql{{ mysql_port }}.sh\" mysql_install_from_source: false mysql_source_configure_command: > /usr/bin/cmake -DCMAKE_INSTALL_PREFIX={{ software_install_path }}/mysql-{{ mysql_version }} -DMYSQL_UNIX_ADDR={{ mysql_sock }} -DDEFAULT_CHARSET=utf8mb4 -DDEFAULT_COLLATION=utf8mb4_unicode_ci -DWITH_EXTRA_CHARSETS:STRING=all -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_MEMORY_STORAGE_ENGINE=1 -DWITH_PARTITION_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DENABLED_LOCAL_INFILE=1 -DMYSQL_DATADIR={{ mysql_datadir }} -DMYSQL_USER=mysql -DMYSQL_TCP_PORT={{ mysql_port }} -DWITH_SSL=system mysql_replication_user: {name: 'rep', password: '123456'} mysql_replication_master: '' mysql_replication_master_port: \"3306\" mysql_replication_role: '' mysql_auto_increment_offset: '' mysql_binlog_format: \"STATEMENT\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/database/mysql/#_5","text":"gcc cmake","title":"\u4f9d\u8d56"},{"location":"roles/database/mysql/#github","text":"https://github.com/lework/Ansible-roles/tree/master/mysql","title":"github\u5730\u5740"},{"location":"roles/database/mysql/#example-playbook","text":"\u4f7f\u7528bin\u6587\u4ef6\u5b89\u88c5(\u5df2\u7f16\u8bd1\u597d\u7684mysql\uff0c\u6587\u4ef6/opt/software/mysql-5.6.10-bin.tar.gz)\uff1a - hosts: node1 roles: - { role: mysql } \u6e90\u7801\u5b89\u88c5\uff1a - hosts: node1 roles: - { role: mysql , mysql_install_from_source: true } \u4e3b\u4ece\u5b89\u88c5\uff1a - hosts: node1 roles: - { role: mysql, mysql_replication_role: 'master'} - { role: mysql, mysql_port: 3307, mysql_replication_role: 'slave', mysql_replication_master: '192.168.77.129'} \u4e92\u4e3a\u4e3b\u5907\u5b89\u88c5\uff1a - hosts: node1 roles: - { role: mysql, mysql_port: 3306, mysql_replication_role: 'master', auto_increment_offset: 1} - { role: mysql, mysql_port: 3307, mysql_replication_role: 'slave', mysql_replication_master: '192.168.77.129', auto_increment_offset: 2} - { role: mysql, mysql_port: 3307, mysql_replication_role: 'master' } - { role: mysql, mysql_port: 3306, mysql_replication_role: 'slave', mysql_replication_master: '192.168.77.129', mysql_replication_master_port: 3307}","title":"Example Playbook"},{"location":"roles/database/mysql/#_6","text":"\u542f\u52a8\u547d\u4ee4\uff1a/mysql_data/3306/mysql3306.sh start \u5173\u95ed\u547d\u4ee4\uff1a/mysql_data/3306/mysql3306.sh stop","title":"\u4f7f\u7528"},{"location":"roles/database/mysql57/","text":"Ansible Role: Mysql 5.7 \u00b6 \u5b89\u88c5mysql 5.7 \u4ecb\u7ecd \u00b6 MySQL\u662f\u4e00\u4e2a\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u7531\u745e\u5178MySQL AB \u516c\u53f8\u5f00\u53d1\uff0c\u76ee\u524d\u5c5e\u4e8e Oracle \u65d7\u4e0b\u4ea7\u54c1\u3002MySQL \u662f\u6700\u6d41\u884c\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u4e4b\u4e00\uff0c\u5728 WEB \u5e94\u7528\u65b9\u9762\uff0cMySQL\u662f\u6700\u597d\u7684 RDBMS (Relational Database Management System\uff0c\u5173\u7cfb\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf) \u5e94\u7528\u8f6f\u4ef6\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.mysql.com/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://dev.mysql.com/doc/refman/5.7/en/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.4.2.0 os Centos 7.2 X64 python 2.7.5 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" mysql57_version: \"5.7.20\" mysql57_file: \"mysql-boost-{{ mysql57_version }}.tar.gz\" mysql57_bin_file: \"mysql-boost-{{ mysql57_version }}-bin.tar.gz\" mysql57_file_path: \"{{ software_files_path }}/{{ mysql57_file }}\" mysql57_file_url: \"https://cdn.mysql.com/Downloads/MySQL-5.7/{{ mysql57_file }}\" mysql57_dirname: \"mysql-{{ mysql57_version }}\" mysql57_port: \"3306\" mysql57_user: \"root\" mysql57_password: \"123456\" mysql57_datahome: \"/mysql_data\" mysql57_basedir: \"{{ software_install_path }}/mysql-{{ mysql57_version }}\" mysql57_portdir: \"{{ mysql57_datahome }}/{{ mysql57_port }}\" mysql57_datadir: \"{{ mysql57_portdir }}/data\" mysql57_cnf : \"{{ mysql57_portdir }}/my.cnf\" mysql57_sock : \"{{ mysql57_portdir }}/mysql.sock\" mysql57_servicename : \"mysql{{ mysql57_port }}\" mysql57_install_from_source: false mysql57_source_configure_command: > /usr/bin/cmake -DCMAKE_INSTALL_PREFIX={{ mysql57_basedir }} -DMYSQL_DATADIR={{ mysql57_datadir }} -DSYSCONFDIR={{ mysql57_portdir }} -DMYSQL_USER=mysql -DMYSQL_TCP_PORT={{ mysql57_port }} -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_ARCHIVE_STORAGE_ENGINE=1 -DWITH_MEMORY_STORAGE_ENGINE=1 -DWITH_PARTITION_STORAGE_ENGINE=1 -DWITH_INNODB_MEMCACHED=1 -DMYSQL_UNIX_ADDR={{ mysql57_sock }} -DWITH_SSL=system -DWITH_ZLIB=system -DENABLED_LOCAL_INFILE=1 -DENABLE_DOWNLOADS=1 -DWITH_READLINE=1 -DENABLED_LOCAL_INFILE=1 -DEXTRA_CHARSETS=all -DDEFAULT_CHARSET=utf8mb4 -DDEFAULT_COLLATION=utf8mb4_general_ci -DWITH_BOOST=boost mysql57_innodb_buffer_pool_size: \"512M\" mysql57_replication_user: {name: 'rep', password: '123456'} mysql57_replication_master: \"127.0.0.1\" mysql57_replication_master_port: \"3306\" mysql57_replication_role: \"\" mysql57_auto_increment_offset: \"1\" mysql57_auto_increment_increment: \"1\" mysql57_replication_mode: \"gtid\" mysql57_binlog_format: \"ROW\" mysql57_replication_channel: {} mysql57_replication_ga: false mysql57_replication_ga_first: false mysql57_replication_ga_single: false mysql57_group_replication_start_on_boot: \"off\" mysql57_group_replication_group_name: \"aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa\" mysql57_group_recation_local_address: \"127.0.0.1:24901\" mysql57_group_replication_group_seeds: \"127.0.0.1:24901,127.0.0.1:24902,127.0.0.1:24903\" \u4f9d\u8d56 \u00b6 gcc cmake boost github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/mysql57 Example Playbook \u00b6 \u9ed8\u8ba4\u5b89\u88c5, \u4f7f\u7528bin\u6587\u4ef6(\u5df2\u7f16\u8bd1\u597d\u7684mysql),\u6587\u4ef6/opt/software/mysql-boost-5.7.20-bin.tar.gz)\uff1a - hosts: node2 roles: - mysql57 \u6e90\u7801\u7f16\u8bd1\u5b89\u88c5 - hosts: node2 roles: - { role: mysql57, mysql57_install_from_source: true } \u6307\u5b9a\u7aef\u53e3 - hosts: node2 roles: - { role: mysql57, mysql57_port: \"3307\" } \u9ed8\u8ba4\u4f7f\u7528gitd\u65b9\u5f0f\u914d\u7f6e\u4e3b\u4ece - hosts: node2 roles: - { role: mysql57, mysql57_replication_role: 'master'} - { role: mysql57, mysql57_port: 3307, mysql57_replication_role: 'slave', mysql57_replication_master: '192.168.77.130'} \u91c7\u7528file\u65b9\u5f0f\u914d\u7f6e\u4e3b\u4ece - hosts: node2 vars: - mysql57_replication_mode: 'file' # \u6307\u5b9abinlog\u65b9\u5f0f\u4e3afile pos roles: - { role: mysql57, mysql57_replication_role: 'master'} - { role: mysql57, mysql57_port: 3307, mysql57_replication_role: 'slave', mysql57_replication_master: '192.168.77.130'} \u4e3b\u4e3b\u914d\u7f6e - hosts: node2 roles: - role: 'mysql57' mysql57_port: '3306' mysql57_replication_role: 'master' mysql57_replication_user: {name: 'rep_3306', password: '123456'} - role: 'mysql57' mysql57_port: '3307' mysql57_replication_role: 'master' mysql57_replication_user: {name: 'rep_3307', password: '123456'} - role: 'mysql57' mysql57_port: '3306' mysql57_auto_increment_offset: '1' mysql57_auto_increment_increment: '2' mysql57_replication_role: 'slave' # \u6307\u5b9a\u4e3aslave\u89d2\u8272 mysql57_replication_master: '192.168.77.130' mysql57_replication_master_port: '3307' mysql57_replication_user: {name: 'rep_3307', password: '123456'} - role: 'mysql57' mysql57_port: '3307' mysql57_auto_increment_offset: '2' mysql57_auto_increment_increment: '2' mysql57_replication_role: 'slave' mysql57_replication_master: '192.168.77.130' mysql57_replication_master_port: '3306' mysql57_replication_user: {name: 'rep_3306', password: '123456'} \u591a\u6e90\u590d\u5236 - hosts: node2 roles: - role: 'mysql57' mysql57_port: '3306' mysql57_binlog_format: 'mixed' mysql57_auto_increment_offset: '1' mysql57_auto_increment_increment: '2' mysql57_replication_role: 'master' mysql57_replication_user: {name: 'rep_3306', password: '123456'} - role: 'mysql57' mysql57_port: '3307' mysql57_binlog_format: 'mixed' mysql57_auto_increment_offset: '2' mysql57_auto_increment_increment: '2' mysql57_replication_role: 'master' mysql57_replication_user: {name: 'rep_3307', password: '123456'} - role: 'mysql57' mysql57_port: '3308' mysql57_replication_role: 'slave' mysql57_replication_channel: # \u6307\u5b9a\u901a\u9053\u94fe\u63a5 - master_host: \"192.168.77.130\" master_port: \"3306\" master_user: \"rep_3306\" master_password: \"123456\" - master_host: \"192.168.77.130\" master_port: \"3307\" master_user: \"rep_3307\" master_password: \"123456\" \u7ec4\u590d\u5236 - hosts: node2 vars: - mysql57_replication_ga: true # \u5f00\u542f\u7ec4\u590d\u5236 - mysql57_replication_role: 'master' # \u6307\u5b9a\u4e3amaster\u89d2\u8272 - mysql57_group_replication_group_name: \"aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa\" # \u6307\u5b9a\u7ec4\u540d - mysql57_group_replication_group_seeds: \"192.168.77.130:24901,192.168.77.130:24902,192.168.77.130:24903\" # \u6307\u5b9a\u7ec4\u5185\u7684\u6210\u5458 - mysql57_replication_user: {name: 'rep', password: '123456'} # \u6307\u5b9a\u7528\u4e8e\u590d\u5236\u7684\u8d26\u53f7 - ipnames: # \u6307\u5b9aip\u548c\u4e3b\u673a\u540d\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u8fd9\u91cc\u4f7f\u7528\u5355\u673a\u591a\u5b9e\u4f8b\u3002 '192.168.77.130': 'node2' roles: - role: 'mysql57' mysql57_port: '3306' mysql57_group_recation_local_address: \"192.168.77.130:24901\" # \u6307\u5b9a\u7ec4\u76d1\u542c\u5730\u5740 mysql57_replication_ga_first: true # \u6307\u5b9a\u7ec4\u5185\u7b2c\u4e00\u6210\u5458 - role: 'mysql57' mysql57_port: '3307' mysql57_group_recation_local_address: \"192.168.77.130:24902\" - role: 'mysql57' mysql57_port: '3308' mysql57_group_recation_local_address: \"192.168.77.130:24903\" \u4f7f\u7528 \u00b6 \u542f\u52a8\u547d\u4ee4\uff1a systemctl start mysql3306 \u5173\u95ed\u547d\u4ee4\uff1a systemctl stop mysql3306 \u91cd\u542f\u547d\u4ee4\uff1a systemctl restart mysql3306","title":"mysql57"},{"location":"roles/database/mysql57/#ansible-role-mysql-57","text":"\u5b89\u88c5mysql 5.7","title":"Ansible Role: Mysql 5.7"},{"location":"roles/database/mysql57/#_1","text":"MySQL\u662f\u4e00\u4e2a\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u7531\u745e\u5178MySQL AB \u516c\u53f8\u5f00\u53d1\uff0c\u76ee\u524d\u5c5e\u4e8e Oracle \u65d7\u4e0b\u4ea7\u54c1\u3002MySQL \u662f\u6700\u6d41\u884c\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\u4e4b\u4e00\uff0c\u5728 WEB \u5e94\u7528\u65b9\u9762\uff0cMySQL\u662f\u6700\u597d\u7684 RDBMS (Relational Database Management System\uff0c\u5173\u7cfb\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf) \u5e94\u7528\u8f6f\u4ef6\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.mysql.com/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://dev.mysql.com/doc/refman/5.7/en/","title":"\u4ecb\u7ecd"},{"location":"roles/database/mysql57/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/database/mysql57/#_3","text":"ansible 2.4.2.0 os Centos 7.2 X64 python 2.7.5","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/database/mysql57/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" mysql57_version: \"5.7.20\" mysql57_file: \"mysql-boost-{{ mysql57_version }}.tar.gz\" mysql57_bin_file: \"mysql-boost-{{ mysql57_version }}-bin.tar.gz\" mysql57_file_path: \"{{ software_files_path }}/{{ mysql57_file }}\" mysql57_file_url: \"https://cdn.mysql.com/Downloads/MySQL-5.7/{{ mysql57_file }}\" mysql57_dirname: \"mysql-{{ mysql57_version }}\" mysql57_port: \"3306\" mysql57_user: \"root\" mysql57_password: \"123456\" mysql57_datahome: \"/mysql_data\" mysql57_basedir: \"{{ software_install_path }}/mysql-{{ mysql57_version }}\" mysql57_portdir: \"{{ mysql57_datahome }}/{{ mysql57_port }}\" mysql57_datadir: \"{{ mysql57_portdir }}/data\" mysql57_cnf : \"{{ mysql57_portdir }}/my.cnf\" mysql57_sock : \"{{ mysql57_portdir }}/mysql.sock\" mysql57_servicename : \"mysql{{ mysql57_port }}\" mysql57_install_from_source: false mysql57_source_configure_command: > /usr/bin/cmake -DCMAKE_INSTALL_PREFIX={{ mysql57_basedir }} -DMYSQL_DATADIR={{ mysql57_datadir }} -DSYSCONFDIR={{ mysql57_portdir }} -DMYSQL_USER=mysql -DMYSQL_TCP_PORT={{ mysql57_port }} -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_ARCHIVE_STORAGE_ENGINE=1 -DWITH_MEMORY_STORAGE_ENGINE=1 -DWITH_PARTITION_STORAGE_ENGINE=1 -DWITH_INNODB_MEMCACHED=1 -DMYSQL_UNIX_ADDR={{ mysql57_sock }} -DWITH_SSL=system -DWITH_ZLIB=system -DENABLED_LOCAL_INFILE=1 -DENABLE_DOWNLOADS=1 -DWITH_READLINE=1 -DENABLED_LOCAL_INFILE=1 -DEXTRA_CHARSETS=all -DDEFAULT_CHARSET=utf8mb4 -DDEFAULT_COLLATION=utf8mb4_general_ci -DWITH_BOOST=boost mysql57_innodb_buffer_pool_size: \"512M\" mysql57_replication_user: {name: 'rep', password: '123456'} mysql57_replication_master: \"127.0.0.1\" mysql57_replication_master_port: \"3306\" mysql57_replication_role: \"\" mysql57_auto_increment_offset: \"1\" mysql57_auto_increment_increment: \"1\" mysql57_replication_mode: \"gtid\" mysql57_binlog_format: \"ROW\" mysql57_replication_channel: {} mysql57_replication_ga: false mysql57_replication_ga_first: false mysql57_replication_ga_single: false mysql57_group_replication_start_on_boot: \"off\" mysql57_group_replication_group_name: \"aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa\" mysql57_group_recation_local_address: \"127.0.0.1:24901\" mysql57_group_replication_group_seeds: \"127.0.0.1:24901,127.0.0.1:24902,127.0.0.1:24903\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/database/mysql57/#_5","text":"gcc cmake boost","title":"\u4f9d\u8d56"},{"location":"roles/database/mysql57/#github","text":"https://github.com/lework/Ansible-roles/tree/master/mysql57","title":"github\u5730\u5740"},{"location":"roles/database/mysql57/#example-playbook","text":"\u9ed8\u8ba4\u5b89\u88c5, \u4f7f\u7528bin\u6587\u4ef6(\u5df2\u7f16\u8bd1\u597d\u7684mysql),\u6587\u4ef6/opt/software/mysql-boost-5.7.20-bin.tar.gz)\uff1a - hosts: node2 roles: - mysql57 \u6e90\u7801\u7f16\u8bd1\u5b89\u88c5 - hosts: node2 roles: - { role: mysql57, mysql57_install_from_source: true } \u6307\u5b9a\u7aef\u53e3 - hosts: node2 roles: - { role: mysql57, mysql57_port: \"3307\" } \u9ed8\u8ba4\u4f7f\u7528gitd\u65b9\u5f0f\u914d\u7f6e\u4e3b\u4ece - hosts: node2 roles: - { role: mysql57, mysql57_replication_role: 'master'} - { role: mysql57, mysql57_port: 3307, mysql57_replication_role: 'slave', mysql57_replication_master: '192.168.77.130'} \u91c7\u7528file\u65b9\u5f0f\u914d\u7f6e\u4e3b\u4ece - hosts: node2 vars: - mysql57_replication_mode: 'file' # \u6307\u5b9abinlog\u65b9\u5f0f\u4e3afile pos roles: - { role: mysql57, mysql57_replication_role: 'master'} - { role: mysql57, mysql57_port: 3307, mysql57_replication_role: 'slave', mysql57_replication_master: '192.168.77.130'} \u4e3b\u4e3b\u914d\u7f6e - hosts: node2 roles: - role: 'mysql57' mysql57_port: '3306' mysql57_replication_role: 'master' mysql57_replication_user: {name: 'rep_3306', password: '123456'} - role: 'mysql57' mysql57_port: '3307' mysql57_replication_role: 'master' mysql57_replication_user: {name: 'rep_3307', password: '123456'} - role: 'mysql57' mysql57_port: '3306' mysql57_auto_increment_offset: '1' mysql57_auto_increment_increment: '2' mysql57_replication_role: 'slave' # \u6307\u5b9a\u4e3aslave\u89d2\u8272 mysql57_replication_master: '192.168.77.130' mysql57_replication_master_port: '3307' mysql57_replication_user: {name: 'rep_3307', password: '123456'} - role: 'mysql57' mysql57_port: '3307' mysql57_auto_increment_offset: '2' mysql57_auto_increment_increment: '2' mysql57_replication_role: 'slave' mysql57_replication_master: '192.168.77.130' mysql57_replication_master_port: '3306' mysql57_replication_user: {name: 'rep_3306', password: '123456'} \u591a\u6e90\u590d\u5236 - hosts: node2 roles: - role: 'mysql57' mysql57_port: '3306' mysql57_binlog_format: 'mixed' mysql57_auto_increment_offset: '1' mysql57_auto_increment_increment: '2' mysql57_replication_role: 'master' mysql57_replication_user: {name: 'rep_3306', password: '123456'} - role: 'mysql57' mysql57_port: '3307' mysql57_binlog_format: 'mixed' mysql57_auto_increment_offset: '2' mysql57_auto_increment_increment: '2' mysql57_replication_role: 'master' mysql57_replication_user: {name: 'rep_3307', password: '123456'} - role: 'mysql57' mysql57_port: '3308' mysql57_replication_role: 'slave' mysql57_replication_channel: # \u6307\u5b9a\u901a\u9053\u94fe\u63a5 - master_host: \"192.168.77.130\" master_port: \"3306\" master_user: \"rep_3306\" master_password: \"123456\" - master_host: \"192.168.77.130\" master_port: \"3307\" master_user: \"rep_3307\" master_password: \"123456\" \u7ec4\u590d\u5236 - hosts: node2 vars: - mysql57_replication_ga: true # \u5f00\u542f\u7ec4\u590d\u5236 - mysql57_replication_role: 'master' # \u6307\u5b9a\u4e3amaster\u89d2\u8272 - mysql57_group_replication_group_name: \"aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa\" # \u6307\u5b9a\u7ec4\u540d - mysql57_group_replication_group_seeds: \"192.168.77.130:24901,192.168.77.130:24902,192.168.77.130:24903\" # \u6307\u5b9a\u7ec4\u5185\u7684\u6210\u5458 - mysql57_replication_user: {name: 'rep', password: '123456'} # \u6307\u5b9a\u7528\u4e8e\u590d\u5236\u7684\u8d26\u53f7 - ipnames: # \u6307\u5b9aip\u548c\u4e3b\u673a\u540d\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u8fd9\u91cc\u4f7f\u7528\u5355\u673a\u591a\u5b9e\u4f8b\u3002 '192.168.77.130': 'node2' roles: - role: 'mysql57' mysql57_port: '3306' mysql57_group_recation_local_address: \"192.168.77.130:24901\" # \u6307\u5b9a\u7ec4\u76d1\u542c\u5730\u5740 mysql57_replication_ga_first: true # \u6307\u5b9a\u7ec4\u5185\u7b2c\u4e00\u6210\u5458 - role: 'mysql57' mysql57_port: '3307' mysql57_group_recation_local_address: \"192.168.77.130:24902\" - role: 'mysql57' mysql57_port: '3308' mysql57_group_recation_local_address: \"192.168.77.130:24903\"","title":"Example Playbook"},{"location":"roles/database/mysql57/#_6","text":"\u542f\u52a8\u547d\u4ee4\uff1a systemctl start mysql3306 \u5173\u95ed\u547d\u4ee4\uff1a systemctl stop mysql3306 \u91cd\u542f\u547d\u4ee4\uff1a systemctl restart mysql3306","title":"\u4f7f\u7528"},{"location":"roles/database/redis/","text":"Ansible Role: Redis \u00b6 \u5b89\u88c5redis \u4ecb\u7ecd \u00b6 redis\uff08Remote Dictionary Server\uff09\u662f\u4e00\u4e2akey-value\u5b58\u50a8\u7cfb\u7edf\u3002\u548cMemcached\u7c7b\u4f3c\uff0c\u5b83\u652f\u6301\u5b58\u50a8\u7684value\u7c7b\u578b\u76f8\u5bf9\u66f4\u591a\uff0c\u5305\u62ecstring(\u5b57\u7b26\u4e32)\u3001list(\u94fe\u8868)\u3001set(\u96c6\u5408)\u3001zset(sorted set --\u6709\u5e8f\u96c6\u5408)\u548chash\uff08\u54c8\u5e0c\u7c7b\u578b\uff09\u3002\u8fd9\u4e9b\u6570\u636e\u7c7b\u578b\u90fd\u652f\u6301push/pop\u3001add/remove\u53ca\u53d6\u4ea4\u96c6\u5e76\u96c6\u548c\u5dee\u96c6\u53ca\u66f4\u4e30\u5bcc\u7684\u64cd\u4f5c\uff0c\u800c\u4e14\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027\u7684\u3002\u5728\u6b64\u57fa\u7840\u4e0a\uff0credis\u652f\u6301\u5404\u79cd\u4e0d\u540c\u65b9\u5f0f\u7684\u6392\u5e8f\u3002\u4e0ememcached\u4e00\u6837\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6548\u7387\uff0c\u6570\u636e\u90fd\u662f\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\u3002\u533a\u522b\u7684\u662fredis\u4f1a\u5468\u671f\u6027\u7684\u628a\u66f4\u65b0\u7684\u6570\u636e\u5199\u5165\u78c1\u76d8\u6216\u8005\u628a\u4fee\u6539\u64cd\u4f5c\u5199\u5165\u8ffd\u52a0\u7684\u8bb0\u5f55\u6587\u4ef6\uff0c\u5e76\u4e14\u5728\u6b64\u57fa\u7840\u4e0a\u5b9e\u73b0\u4e86master-slave(\u4e3b\u4ece)\u540c\u6b65\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://redis.io/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://redis.io/documentation \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.4.2.0 os Centos 7.2 X64 python 2.7.5 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" redis_version: \"3.2.11\" redis_file: \"redis-{{ redis_version }}.tar.gz\" redis_file_path: \"{{ software_files_path }}/{{ redis_file }}\" redis_file_url: \"http://download.redis.io/releases/redis-{{ redis_version }}.tar.gz\" redis_data_path: \"/redis_data\" # redis_port: 6379 redis_daemon: \"redis{{ redis_port | default('') }}\" redis_dir_path: \"{{ redis_data_path }}/{{redis_port | default('6379')}}\" redis_timeout: 0 redis_user: redis redis_loglevel: \"notice\" redis_logfile: \"{{ redis_dir_path }}/redis-server.log\" redis_pidfile: \"{{ redis_dir_path }}/redis.pid\" redis_databases: 16 redis_rdbcompression: \"yes\" redis_dbfilename: dump.rdb redis_dbdir: \"{{ redis_dir_path }}/data\" redis_maxmemory: \"1000mb\" redis_requirepass: '' redis_slave: false redis_cluster: false redis_cluster_replicas: '' # redis_cluster_replicas: '1 127.0.0.1:6481 127.0.0.1:6482 127.0.0.1:6483 127.0.0.1:6484 127.0.0.1:6485 127.0.0.1:6486' # 1 \u8868\u793a \u81ea\u52a8\u4e3a\u6bcf\u4e00\u4e2amaster\u8282\u70b9\u5206\u914d\u4e00\u4e2aslave\u8282\u70b9, \u4e0a\u9762\u67096\u4e2a\u8282\u70b9,\u7a0b\u5e8f\u4f1a\u6309\u7167\u4e00\u5b9a\u89c4\u5219\u751f\u6210 3\u4e2amaster(\u4e3b)3\u4e2aslave(\u4ece) redis_masterauth: '' redis_master_host: '' redis_master_port: '' redis_sentinel_port: '' redis_sentinel_quorum: '2' redis_sentinel_daemon: \"redis-sentinel{{ redis_sentinel_port | default('') }}\" redis_rename_command: true \u4f9d\u8d56 \u00b6 java ruby github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/redis Example Playbook \u00b6 \u5355\u5b9e\u4f8b\u5b89\u88c5 - hosts: node1 roles: - { role: redis } \u4e3b\u4ece\u914d\u7f6e - hosts: node1 vars: - redis_master_host: '127.0.0.1' - redis_master_port: '6380' roles: - { role: redis, redis_port: 6380} - { role: redis, redis_port: 6381, redis_slave: true} - { role: redis, redis_port: 6382, redis_slave: true} \u54e8\u5175\u6a21\u5f0f - hosts: node1 vars: - redis_master_host: '127.0.0.1' - redis_master_port: '6383' roles: - { role: redis, redis_port: 6383, redis_sentinel_port: 26383} - { role: redis, redis_port: 6384, redis_sentinel_port: 26384, redis_slave: true} - { role: redis, redis_port: 6385, redis_sentinel_port: 26385, redis_slave: true} \u4f2a\u96c6\u7fa4\u6a21\u5f0f - hosts: node1 vars: - redis_cluster: true - redis_requirepass: '123456' roles: - { role: redis, redis_port: 6481} - { role: redis, redis_port: 6482} - { role: redis, redis_port: 6483} - { role: redis, redis_port: 6484} - { role: redis, redis_port: 6485} - { role: redis, redis_port: 6486, redis_cluster_replicas: '1 127.0.0.1:6481 127.0.0.1:6482 127.0.0.1:6483 127.0.0.1:6484 127.0.0.1:6485 127.0.0.1:6486'} \u96c6\u7fa4\u5206\u5e03\u5f0f\u6a21\u5f0f - hosts: node1 vars: - redis_cluster: true - redis_requirepass: '123456' roles: - { role: redis, redis_port: 7000} - { role: redis, redis_port: 7003} - hosts: node2 vars: - redis_cluster: true - redis_requirepass: '123456' roles: - { role: redis, redis_port: 7001} - { role: redis, redis_port: 7004} - hosts: node3 vars: - redis_cluster: true - redis_requirepass: '123456' roles: - { role: redis, redis_port: 7002} - { role: redis, redis_port: 7005, redis_cluster_replicas: '1 172.19.204.246:7000 172.19.204.245:7001 172.19.204.244:7002 172.19.204.246:7003 172.19.204.245:7004 172.19.204.244:7005'}","title":"redis"},{"location":"roles/database/redis/#ansible-role-redis","text":"\u5b89\u88c5redis","title":"Ansible Role: Redis"},{"location":"roles/database/redis/#_1","text":"redis\uff08Remote Dictionary Server\uff09\u662f\u4e00\u4e2akey-value\u5b58\u50a8\u7cfb\u7edf\u3002\u548cMemcached\u7c7b\u4f3c\uff0c\u5b83\u652f\u6301\u5b58\u50a8\u7684value\u7c7b\u578b\u76f8\u5bf9\u66f4\u591a\uff0c\u5305\u62ecstring(\u5b57\u7b26\u4e32)\u3001list(\u94fe\u8868)\u3001set(\u96c6\u5408)\u3001zset(sorted set --\u6709\u5e8f\u96c6\u5408)\u548chash\uff08\u54c8\u5e0c\u7c7b\u578b\uff09\u3002\u8fd9\u4e9b\u6570\u636e\u7c7b\u578b\u90fd\u652f\u6301push/pop\u3001add/remove\u53ca\u53d6\u4ea4\u96c6\u5e76\u96c6\u548c\u5dee\u96c6\u53ca\u66f4\u4e30\u5bcc\u7684\u64cd\u4f5c\uff0c\u800c\u4e14\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027\u7684\u3002\u5728\u6b64\u57fa\u7840\u4e0a\uff0credis\u652f\u6301\u5404\u79cd\u4e0d\u540c\u65b9\u5f0f\u7684\u6392\u5e8f\u3002\u4e0ememcached\u4e00\u6837\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6548\u7387\uff0c\u6570\u636e\u90fd\u662f\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\u3002\u533a\u522b\u7684\u662fredis\u4f1a\u5468\u671f\u6027\u7684\u628a\u66f4\u65b0\u7684\u6570\u636e\u5199\u5165\u78c1\u76d8\u6216\u8005\u628a\u4fee\u6539\u64cd\u4f5c\u5199\u5165\u8ffd\u52a0\u7684\u8bb0\u5f55\u6587\u4ef6\uff0c\u5e76\u4e14\u5728\u6b64\u57fa\u7840\u4e0a\u5b9e\u73b0\u4e86master-slave(\u4e3b\u4ece)\u540c\u6b65\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://redis.io/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://redis.io/documentation","title":"\u4ecb\u7ecd"},{"location":"roles/database/redis/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/database/redis/#_3","text":"ansible 2.4.2.0 os Centos 7.2 X64 python 2.7.5","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/database/redis/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" redis_version: \"3.2.11\" redis_file: \"redis-{{ redis_version }}.tar.gz\" redis_file_path: \"{{ software_files_path }}/{{ redis_file }}\" redis_file_url: \"http://download.redis.io/releases/redis-{{ redis_version }}.tar.gz\" redis_data_path: \"/redis_data\" # redis_port: 6379 redis_daemon: \"redis{{ redis_port | default('') }}\" redis_dir_path: \"{{ redis_data_path }}/{{redis_port | default('6379')}}\" redis_timeout: 0 redis_user: redis redis_loglevel: \"notice\" redis_logfile: \"{{ redis_dir_path }}/redis-server.log\" redis_pidfile: \"{{ redis_dir_path }}/redis.pid\" redis_databases: 16 redis_rdbcompression: \"yes\" redis_dbfilename: dump.rdb redis_dbdir: \"{{ redis_dir_path }}/data\" redis_maxmemory: \"1000mb\" redis_requirepass: '' redis_slave: false redis_cluster: false redis_cluster_replicas: '' # redis_cluster_replicas: '1 127.0.0.1:6481 127.0.0.1:6482 127.0.0.1:6483 127.0.0.1:6484 127.0.0.1:6485 127.0.0.1:6486' # 1 \u8868\u793a \u81ea\u52a8\u4e3a\u6bcf\u4e00\u4e2amaster\u8282\u70b9\u5206\u914d\u4e00\u4e2aslave\u8282\u70b9, \u4e0a\u9762\u67096\u4e2a\u8282\u70b9,\u7a0b\u5e8f\u4f1a\u6309\u7167\u4e00\u5b9a\u89c4\u5219\u751f\u6210 3\u4e2amaster(\u4e3b)3\u4e2aslave(\u4ece) redis_masterauth: '' redis_master_host: '' redis_master_port: '' redis_sentinel_port: '' redis_sentinel_quorum: '2' redis_sentinel_daemon: \"redis-sentinel{{ redis_sentinel_port | default('') }}\" redis_rename_command: true","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/database/redis/#_5","text":"java ruby","title":"\u4f9d\u8d56"},{"location":"roles/database/redis/#github","text":"https://github.com/lework/Ansible-roles/tree/master/redis","title":"github\u5730\u5740"},{"location":"roles/database/redis/#example-playbook","text":"\u5355\u5b9e\u4f8b\u5b89\u88c5 - hosts: node1 roles: - { role: redis } \u4e3b\u4ece\u914d\u7f6e - hosts: node1 vars: - redis_master_host: '127.0.0.1' - redis_master_port: '6380' roles: - { role: redis, redis_port: 6380} - { role: redis, redis_port: 6381, redis_slave: true} - { role: redis, redis_port: 6382, redis_slave: true} \u54e8\u5175\u6a21\u5f0f - hosts: node1 vars: - redis_master_host: '127.0.0.1' - redis_master_port: '6383' roles: - { role: redis, redis_port: 6383, redis_sentinel_port: 26383} - { role: redis, redis_port: 6384, redis_sentinel_port: 26384, redis_slave: true} - { role: redis, redis_port: 6385, redis_sentinel_port: 26385, redis_slave: true} \u4f2a\u96c6\u7fa4\u6a21\u5f0f - hosts: node1 vars: - redis_cluster: true - redis_requirepass: '123456' roles: - { role: redis, redis_port: 6481} - { role: redis, redis_port: 6482} - { role: redis, redis_port: 6483} - { role: redis, redis_port: 6484} - { role: redis, redis_port: 6485} - { role: redis, redis_port: 6486, redis_cluster_replicas: '1 127.0.0.1:6481 127.0.0.1:6482 127.0.0.1:6483 127.0.0.1:6484 127.0.0.1:6485 127.0.0.1:6486'} \u96c6\u7fa4\u5206\u5e03\u5f0f\u6a21\u5f0f - hosts: node1 vars: - redis_cluster: true - redis_requirepass: '123456' roles: - { role: redis, redis_port: 7000} - { role: redis, redis_port: 7003} - hosts: node2 vars: - redis_cluster: true - redis_requirepass: '123456' roles: - { role: redis, redis_port: 7001} - { role: redis, redis_port: 7004} - hosts: node3 vars: - redis_cluster: true - redis_requirepass: '123456' roles: - { role: redis, redis_port: 7002} - { role: redis, redis_port: 7005, redis_cluster_replicas: '1 172.19.204.246:7000 172.19.204.245:7001 172.19.204.244:7002 172.19.204.246:7003 172.19.204.245:7004 172.19.204.244:7005'}","title":"Example Playbook"},{"location":"roles/database/redis5/","text":"Ansible Role: redis5 \u00b6 \u5b89\u88c5 redis \u4ecb\u7ecd \u00b6 Redis\u662f\u4e00\u4e2a\u4f7f\u7528ANSI C\u7f16\u5199\u7684\u5f00\u6e90\u3001\u652f\u6301\u7f51\u7edc\u3001\u57fa\u4e8e\u5185\u5b58\u3001\u53ef\u9009\u6301\u4e45\u6027\u7684\u952e\u503c\u5bf9\u5b58\u50a8\u6570\u636e\u5e93\u3002\u4ece2015\u5e746\u6708\u5f00\u59cb\uff0cRedis\u7684\u5f00\u53d1\u7531Redis Labs\u8d5e\u52a9\uff0c\u800c2013\u5e745\u6708\u81f32015\u5e746\u6708\u671f\u95f4\uff0c\u5176\u5f00\u53d1\u7531Pivotal\u8d5e\u52a9\u3002\u57282013\u5e745\u6708\u4e4b\u524d\uff0c\u5176\u5f00\u53d1\u7531VMware\u8d5e\u52a9\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://redis.io/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://redis.io/documentation Github: https://github.com/antirez/redis-io \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u5728Debian\u548cRHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 7, Debian 9 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path : \"/opt/software\" software_install_path : \"/usr/local\" redis_version : \"5.0.7\" redis_file : \"redis-{{ redis_version }}.tar.gz\" redis_file_path : \"{{ software_files_path }}/{{ redis_file }}\" redis_file_url : \" http://download.redis.io/releases/{{ redis_file }}\" redis_user : redis redis_group : redis redis_port : 6379 redis_daemon : \"redis{{ redis_port | default('') }}\" redis_data_path : \"/data/redis\" redis_dir_path : \"{{ redis_data_path }}/{{redis_port | default('6379')}}\" redis_dbdir : \"{{ redis_dir_path }}/data\" redis_logdir : \"{{ redis_dir_path }}/log\" redis_confdir : \"{{ redis_dir_path }}/conf\" redis_log_file : \"{{ redis_logdir }}/redis.log\" redis_conf_file : \"{{ redis_confdir }}/redis.conf\" # redis\u914d\u7f6e redis_bind_interface : 0.0.0.0 redis_timeout : 0 redis_loglevel : notice redis_databases : 16 redis_maxmemory : 1024MB redis_maxmemory_policy : volatile-ttl redis_maxclients : 6000 redis_requirepass : '' redis_appendonly : 'yes' redis_save : - \"\" # - 900 1 # - 300 10 # - 60 10000 redis_rdbcompression : \"yes\" redis_dbfilename : dump.rdb # \u4ece\u670d\u52a1\u5668\u914d\u7f6e redis_slave : false redis_master_host : '' redis_master_port : '' # \u96c6\u7fa4\u914d\u7f6e redis_cluster : false redis_masterauth : '' redis_cluster_replicas : '' # redis_cluster_replicas: '127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7010 127.0.0.1:7011 127.0.0.1:7012 --cluster-replicas 1 -a 123456' # \u4e0a\u9762\u67096\u4e2a\u8282\u70b9,\u7a0b\u5e8f\u4f1a\u6309\u7167\u4e00\u5b9a\u89c4\u5219\u751f\u6210 3\u4e2amaster(\u4e3b)3\u4e2aslave(\u4ece) # \u54e8\u5175\u914d\u7f6e redis_sentinel : false redis_sentinel_daemon : \"redis-sentinel{{ redis_port | default('') }}\" redis_sentinel_log_file : \"{{ redis_logdir }}/sentinel.log\" redis_sentinel_conf_file : \"{{ redis_confdir }}/sentinel.conf\" redis_sentinel_monitors : - name : mymaster ip : 127.0.0.1 port : 6379 quorum : 2 masterauth : 123456 redis_rename_prefix : LE redis_rename_commands : - FLUSHDB - FLUSHALL - KEYS - SAVE - RENAME # - PEXPIRE # - DEL # - CONFIG # - SHUTDOWN # - BGREWRITEAOF # - BGSAVE # - SPOP # - SREM # - DEBUG # \u524d\u7f00\u52a0\u4e2aLE\uff0c\u91cd\u547d\u540d\u540e\u53d8\u6210LEFLUSHDB redis_disabled_commands : [] # - FLUSHDB # - FLUSHALL # - KEYS \u4f9d\u8d56 \u00b6 \u65e0 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/redis5 Example Playbook \u00b6 # \u9ed8\u8ba4\u5b89\u88c5 - hosts : 192.168.77.140 roles : - redis5 # \u5b9a\u4e49\u7aef\u53e3\u548c\u5bc6\u7801 - hosts : 192.168.77.140 vars : - redis_port : 7000 - redis_requirepass : 123456 roles : - redis5 # \u590d\u5236\u7ec4 - hosts : 192.168.77.140 vars : - redis_master_host : '127.0.0.1' - redis_master_port : '6380' - redis_requirepass : '123456' - redis_masterauth : '123456' roles : - { role : redis5 , redis_port : 6380 } - { role : redis5 , redis_port : 6381 , redis_slave : true } - { role : redis5 , redis_port : 6382 , redis_slave : true } # \u54e8\u5175\u6a21\u5f0f - hosts : 192.168.77.140 vars : - redis_master_host : '192.168.77.140' - redis_master_port : '6380' - redis_requirepass : '123456' - redis_masterauth : '123456' - redis_sentinel_monitors : - name : mymaster ip : 192.168.77.140 port : 6380 quorum : 2 masterauth : '123456' roles : - { role : redis5 , redis_port : 6380 } - { role : redis5 , redis_port : 6381 , redis_slave : true } - { role : redis5 , redis_port : 6382 , redis_slave : true } - { role : redis5 , redis_port : 16380 , redis_sentinel : true } - { role : redis5 , redis_port : 16381 , redis_sentinel : true } - { role : redis5 , redis_port : 16382 , redis_sentinel : true } # \u96c6\u7fa4\u6a21\u5f0f - hosts : 192.168.77.140 vars : - redis_cluster : true - redis_requirepass : '123456' - redis_masterauth : '123456' roles : - { role : redis5 , redis_port : 7000 } - { role : redis5 , redis_port : 7001 } - { role : redis5 , redis_port : 7002 } - { role : redis5 , redis_port : 7010 } - { role : redis5 , redis_port : 7011 } - { role : redis5 , redis_port : 7012 , redis_cluster_replicas : '192.168.77.140:7000 192.168.77.140:7001 192.168.77.140:7002 192.168.77.140:7010 192.168.77.140:7011 192.168.77.140:7012 --cluster-replicas 1 -a 123456 --cluster-yes' } \u4f7f\u7528 \u00b6 # systemd systemctl status redis6380 systemctl start redis6380 systemctl stop redis6380","title":"redis5"},{"location":"roles/database/redis5/#ansible-role-redis5","text":"\u5b89\u88c5 redis","title":"Ansible Role: redis5"},{"location":"roles/database/redis5/#_1","text":"Redis\u662f\u4e00\u4e2a\u4f7f\u7528ANSI C\u7f16\u5199\u7684\u5f00\u6e90\u3001\u652f\u6301\u7f51\u7edc\u3001\u57fa\u4e8e\u5185\u5b58\u3001\u53ef\u9009\u6301\u4e45\u6027\u7684\u952e\u503c\u5bf9\u5b58\u50a8\u6570\u636e\u5e93\u3002\u4ece2015\u5e746\u6708\u5f00\u59cb\uff0cRedis\u7684\u5f00\u53d1\u7531Redis Labs\u8d5e\u52a9\uff0c\u800c2013\u5e745\u6708\u81f32015\u5e746\u6708\u671f\u95f4\uff0c\u5176\u5f00\u53d1\u7531Pivotal\u8d5e\u52a9\u3002\u57282013\u5e745\u6708\u4e4b\u524d\uff0c\u5176\u5f00\u53d1\u7531VMware\u8d5e\u52a9\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://redis.io/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://redis.io/documentation Github: https://github.com/antirez/redis-io","title":"\u4ecb\u7ecd"},{"location":"roles/database/redis5/#_2","text":"\u6b64\u89d2\u8272\u5728Debian\u548cRHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/database/redis5/#_3","text":"ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 7, Debian 9","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/database/redis5/#_4","text":"software_files_path : \"/opt/software\" software_install_path : \"/usr/local\" redis_version : \"5.0.7\" redis_file : \"redis-{{ redis_version }}.tar.gz\" redis_file_path : \"{{ software_files_path }}/{{ redis_file }}\" redis_file_url : \" http://download.redis.io/releases/{{ redis_file }}\" redis_user : redis redis_group : redis redis_port : 6379 redis_daemon : \"redis{{ redis_port | default('') }}\" redis_data_path : \"/data/redis\" redis_dir_path : \"{{ redis_data_path }}/{{redis_port | default('6379')}}\" redis_dbdir : \"{{ redis_dir_path }}/data\" redis_logdir : \"{{ redis_dir_path }}/log\" redis_confdir : \"{{ redis_dir_path }}/conf\" redis_log_file : \"{{ redis_logdir }}/redis.log\" redis_conf_file : \"{{ redis_confdir }}/redis.conf\" # redis\u914d\u7f6e redis_bind_interface : 0.0.0.0 redis_timeout : 0 redis_loglevel : notice redis_databases : 16 redis_maxmemory : 1024MB redis_maxmemory_policy : volatile-ttl redis_maxclients : 6000 redis_requirepass : '' redis_appendonly : 'yes' redis_save : - \"\" # - 900 1 # - 300 10 # - 60 10000 redis_rdbcompression : \"yes\" redis_dbfilename : dump.rdb # \u4ece\u670d\u52a1\u5668\u914d\u7f6e redis_slave : false redis_master_host : '' redis_master_port : '' # \u96c6\u7fa4\u914d\u7f6e redis_cluster : false redis_masterauth : '' redis_cluster_replicas : '' # redis_cluster_replicas: '127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7010 127.0.0.1:7011 127.0.0.1:7012 --cluster-replicas 1 -a 123456' # \u4e0a\u9762\u67096\u4e2a\u8282\u70b9,\u7a0b\u5e8f\u4f1a\u6309\u7167\u4e00\u5b9a\u89c4\u5219\u751f\u6210 3\u4e2amaster(\u4e3b)3\u4e2aslave(\u4ece) # \u54e8\u5175\u914d\u7f6e redis_sentinel : false redis_sentinel_daemon : \"redis-sentinel{{ redis_port | default('') }}\" redis_sentinel_log_file : \"{{ redis_logdir }}/sentinel.log\" redis_sentinel_conf_file : \"{{ redis_confdir }}/sentinel.conf\" redis_sentinel_monitors : - name : mymaster ip : 127.0.0.1 port : 6379 quorum : 2 masterauth : 123456 redis_rename_prefix : LE redis_rename_commands : - FLUSHDB - FLUSHALL - KEYS - SAVE - RENAME # - PEXPIRE # - DEL # - CONFIG # - SHUTDOWN # - BGREWRITEAOF # - BGSAVE # - SPOP # - SREM # - DEBUG # \u524d\u7f00\u52a0\u4e2aLE\uff0c\u91cd\u547d\u540d\u540e\u53d8\u6210LEFLUSHDB redis_disabled_commands : [] # - FLUSHDB # - FLUSHALL # - KEYS","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/database/redis5/#_5","text":"\u65e0","title":"\u4f9d\u8d56"},{"location":"roles/database/redis5/#github","text":"https://github.com/lework/Ansible-roles/tree/master/redis5","title":"github\u5730\u5740"},{"location":"roles/database/redis5/#example-playbook","text":"# \u9ed8\u8ba4\u5b89\u88c5 - hosts : 192.168.77.140 roles : - redis5 # \u5b9a\u4e49\u7aef\u53e3\u548c\u5bc6\u7801 - hosts : 192.168.77.140 vars : - redis_port : 7000 - redis_requirepass : 123456 roles : - redis5 # \u590d\u5236\u7ec4 - hosts : 192.168.77.140 vars : - redis_master_host : '127.0.0.1' - redis_master_port : '6380' - redis_requirepass : '123456' - redis_masterauth : '123456' roles : - { role : redis5 , redis_port : 6380 } - { role : redis5 , redis_port : 6381 , redis_slave : true } - { role : redis5 , redis_port : 6382 , redis_slave : true } # \u54e8\u5175\u6a21\u5f0f - hosts : 192.168.77.140 vars : - redis_master_host : '192.168.77.140' - redis_master_port : '6380' - redis_requirepass : '123456' - redis_masterauth : '123456' - redis_sentinel_monitors : - name : mymaster ip : 192.168.77.140 port : 6380 quorum : 2 masterauth : '123456' roles : - { role : redis5 , redis_port : 6380 } - { role : redis5 , redis_port : 6381 , redis_slave : true } - { role : redis5 , redis_port : 6382 , redis_slave : true } - { role : redis5 , redis_port : 16380 , redis_sentinel : true } - { role : redis5 , redis_port : 16381 , redis_sentinel : true } - { role : redis5 , redis_port : 16382 , redis_sentinel : true } # \u96c6\u7fa4\u6a21\u5f0f - hosts : 192.168.77.140 vars : - redis_cluster : true - redis_requirepass : '123456' - redis_masterauth : '123456' roles : - { role : redis5 , redis_port : 7000 } - { role : redis5 , redis_port : 7001 } - { role : redis5 , redis_port : 7002 } - { role : redis5 , redis_port : 7010 } - { role : redis5 , redis_port : 7011 } - { role : redis5 , redis_port : 7012 , redis_cluster_replicas : '192.168.77.140:7000 192.168.77.140:7001 192.168.77.140:7002 192.168.77.140:7010 192.168.77.140:7011 192.168.77.140:7012 --cluster-replicas 1 -a 123456 --cluster-yes' }","title":"Example Playbook"},{"location":"roles/database/redis5/#_6","text":"# systemd systemctl status redis6380 systemctl start redis6380 systemctl stop redis6380","title":"\u4f7f\u7528"},{"location":"roles/env/ant/","text":"Ansible Role: ant \u00b6 \u6dfb\u52a0ant\u7f16\u8bd1\u73af\u5883 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 ant_version: \"1.10.1\" ant_file: \"apache-ant-{{ ant_version }}-bin.tar.gz\" ant_file_path: \"{{ software_files_path }}/{{ ant_file }}\" ant_install_path: \"{{ software_install_path }}/apache-ant-{{ ant_version }}\" ant_file_url: \"http://mirrors.tuna.tsinghua.edu.cn/apache//ant/binaries/{{ ant_file }}\" ivy_version: \"2.4.0\" ivy_file: \"ivy-{{ ivy_version }}.jar\" ivy_file_path: \"{{ software_files_path }}/{{ ivy_file }}\" ivy_file_url: \"http://repo1.maven.org/maven2/org/apache/ivy/ivy/{{ ivy_version }}/{{ ivy_file }}\" \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/ant Example Playbook \u00b6 - hosts: node1 roles: - ant","title":"ant"},{"location":"roles/env/ant/#ansible-role-ant","text":"\u6dfb\u52a0ant\u7f16\u8bd1\u73af\u5883","title":"Ansible Role: ant"},{"location":"roles/env/ant/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/ant/#_2","text":"ansible 2.3.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/ant/#_3","text":"ant_version: \"1.10.1\" ant_file: \"apache-ant-{{ ant_version }}-bin.tar.gz\" ant_file_path: \"{{ software_files_path }}/{{ ant_file }}\" ant_install_path: \"{{ software_install_path }}/apache-ant-{{ ant_version }}\" ant_file_url: \"http://mirrors.tuna.tsinghua.edu.cn/apache//ant/binaries/{{ ant_file }}\" ivy_version: \"2.4.0\" ivy_file: \"ivy-{{ ivy_version }}.jar\" ivy_file_path: \"{{ software_files_path }}/{{ ivy_file }}\" ivy_file_url: \"http://repo1.maven.org/maven2/org/apache/ivy/ivy/{{ ivy_version }}/{{ ivy_file }}\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/ant/#_4","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/env/ant/#github","text":"https://github.com/lework/Ansible-roles/tree/master/ant","title":"github\u5730\u5740"},{"location":"roles/env/ant/#example-playbook","text":"- hosts: node1 roles: - ant","title":"Example Playbook"},{"location":"roles/env/erlang/","text":"Ansible Role: erlang \u00b6 \u6dfb\u52a0erlang\u73af\u5883 \u4ecb\u7ecd \u00b6 Erlang(['\u0259:l\u00e6\u014b])\u662f\u4e00\u79cd\u901a\u7528\u7684\u9762\u5411\u5e76\u53d1\u7684\u7f16\u7a0b\u8bed\u8a00\uff0c\u5b83\u7531\u745e\u5178\u7535\u4fe1\u8bbe\u5907\u5236\u9020\u5546\u7231\u7acb\u4fe1\u6240\u8f96\u7684CS-Lab\u5f00\u53d1\uff0c\u76ee\u7684\u662f\u521b\u9020\u4e00\u79cd\u53ef\u4ee5\u5e94\u5bf9\u5927\u89c4\u6a21\u5e76\u53d1\u6d3b\u52a8\u7684\u7f16\u7a0b\u8bed\u8a00\u548c\u8fd0\u884c\u73af\u5883\u3002Erlang\u95ee\u4e16\u4e8e1987\u5e74\uff0c\u7ecf\u8fc7\u5341\u5e74\u7684\u53d1\u5c55\uff0c\u4e8e1998\u5e74\u53d1\u5e03\u5f00\u6e90\u7248\u672c\u3002Erlang\u662f\u8fd0\u884c\u4e8e\u865a\u62df\u673a\u7684\u89e3\u91ca\u6027\u8bed\u8a00\uff0c\u4f46\u662f\u73b0\u5728\u4e5f\u5305\u542b\u6709\u4e4c\u666e\u8428\u62c9\u5927\u5b66\u9ad8\u6027\u80fdErlang\u8ba1\u5212\uff08HiPE\uff09\u5f00\u53d1\u7684\u672c\u5730\u4ee3\u7801\u7f16\u8bd1\u5668\uff0c\u81eaR11B-4\u7248\u672c\u5f00\u59cb\uff0cErlang\u4e5f\u5f00\u59cb\u652f\u6301\u811a\u672c\u5f0f\u89e3\u91ca\u5668\u3002\u5728\u7f16\u7a0b\u8303\u578b\u4e0a\uff0cErlang\u5c5e\u4e8e\u591a\u91cd\u8303\u578b\u7f16\u7a0b\u8bed\u8a00\uff0c\u6db5\u76d6\u51fd\u6570\u5f0f\u3001\u5e76\u53d1\u5f0f\u53ca\u5206\u5e03\u5f0f\u3002\u987a\u5e8f\u6267\u884c\u7684Erlang\u662f\u4e00\u4e2a\u53ca\u65e9\u6c42\u503c, \u5355\u6b21\u8d4b\u503c\u548c\u52a8\u6001\u7c7b\u578b\u7684\u51fd\u6570\u5f0f\u7f16\u7a0b\u8bed\u8a00\u3002 \u5b98\u7f51: http://www.erlang.org/ \u5b98\u65b9\u6587\u6863: http://erlang.org/doc/man/erlang.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.9.1 python 2.7.5 os Centos 7.4 X64 Debian 9.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" erlang_version: \"22.2\" erlang_file: \"otp_src_{{ erlang_version }}.tar.gz\" erlang_file_path: \"{{ software_files_path }}/{{ erlang_file }}\" erlang_file_url: \"http://erlang.org/download/{{ erlang_file }}\" erlang_install_source: false \u4f9d\u8d56 \u00b6 gcc github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/erlang Example Playbook \u00b6 # \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - erlang # \u6307\u5b9a\u7248\u672c\u5b89\u88c5 - hosts : node1 roles : - { role : erlang , erlang_version : '22.2' , erlang_install_source : true }","title":"erlang"},{"location":"roles/env/erlang/#ansible-role-erlang","text":"\u6dfb\u52a0erlang\u73af\u5883","title":"Ansible Role: erlang"},{"location":"roles/env/erlang/#_1","text":"Erlang(['\u0259:l\u00e6\u014b])\u662f\u4e00\u79cd\u901a\u7528\u7684\u9762\u5411\u5e76\u53d1\u7684\u7f16\u7a0b\u8bed\u8a00\uff0c\u5b83\u7531\u745e\u5178\u7535\u4fe1\u8bbe\u5907\u5236\u9020\u5546\u7231\u7acb\u4fe1\u6240\u8f96\u7684CS-Lab\u5f00\u53d1\uff0c\u76ee\u7684\u662f\u521b\u9020\u4e00\u79cd\u53ef\u4ee5\u5e94\u5bf9\u5927\u89c4\u6a21\u5e76\u53d1\u6d3b\u52a8\u7684\u7f16\u7a0b\u8bed\u8a00\u548c\u8fd0\u884c\u73af\u5883\u3002Erlang\u95ee\u4e16\u4e8e1987\u5e74\uff0c\u7ecf\u8fc7\u5341\u5e74\u7684\u53d1\u5c55\uff0c\u4e8e1998\u5e74\u53d1\u5e03\u5f00\u6e90\u7248\u672c\u3002Erlang\u662f\u8fd0\u884c\u4e8e\u865a\u62df\u673a\u7684\u89e3\u91ca\u6027\u8bed\u8a00\uff0c\u4f46\u662f\u73b0\u5728\u4e5f\u5305\u542b\u6709\u4e4c\u666e\u8428\u62c9\u5927\u5b66\u9ad8\u6027\u80fdErlang\u8ba1\u5212\uff08HiPE\uff09\u5f00\u53d1\u7684\u672c\u5730\u4ee3\u7801\u7f16\u8bd1\u5668\uff0c\u81eaR11B-4\u7248\u672c\u5f00\u59cb\uff0cErlang\u4e5f\u5f00\u59cb\u652f\u6301\u811a\u672c\u5f0f\u89e3\u91ca\u5668\u3002\u5728\u7f16\u7a0b\u8303\u578b\u4e0a\uff0cErlang\u5c5e\u4e8e\u591a\u91cd\u8303\u578b\u7f16\u7a0b\u8bed\u8a00\uff0c\u6db5\u76d6\u51fd\u6570\u5f0f\u3001\u5e76\u53d1\u5f0f\u53ca\u5206\u5e03\u5f0f\u3002\u987a\u5e8f\u6267\u884c\u7684Erlang\u662f\u4e00\u4e2a\u53ca\u65e9\u6c42\u503c, \u5355\u6b21\u8d4b\u503c\u548c\u52a8\u6001\u7c7b\u578b\u7684\u51fd\u6570\u5f0f\u7f16\u7a0b\u8bed\u8a00\u3002 \u5b98\u7f51: http://www.erlang.org/ \u5b98\u65b9\u6587\u6863: http://erlang.org/doc/man/erlang.html","title":"\u4ecb\u7ecd"},{"location":"roles/env/erlang/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/erlang/#_3","text":"ansible 2.9.1 python 2.7.5 os Centos 7.4 X64 Debian 9.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/erlang/#_4","text":"software_files_path: \"/opt/software\" erlang_version: \"22.2\" erlang_file: \"otp_src_{{ erlang_version }}.tar.gz\" erlang_file_path: \"{{ software_files_path }}/{{ erlang_file }}\" erlang_file_url: \"http://erlang.org/download/{{ erlang_file }}\" erlang_install_source: false","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/erlang/#_5","text":"gcc","title":"\u4f9d\u8d56"},{"location":"roles/env/erlang/#github","text":"https://github.com/lework/Ansible-roles/tree/master/erlang","title":"github\u5730\u5740"},{"location":"roles/env/erlang/#example-playbook","text":"# \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - erlang # \u6307\u5b9a\u7248\u672c\u5b89\u88c5 - hosts : node1 roles : - { role : erlang , erlang_version : '22.2' , erlang_install_source : true }","title":"Example Playbook"},{"location":"roles/env/go/","text":"Ansible Role: go \u00b6 \u6dfb\u52a0go\u5f00\u53d1\u73af\u5883 \u4ecb\u7ecd \u00b6 Go\u662f\u4e00\u79cd\u7f16\u8bd1\u578b\u8bed\u8a00\uff0c\u5b83\u7ed3\u5408\u4e86\u89e3\u91ca\u578b\u8bed\u8a00\u7684\u6e38\u5203\u6709\u4f59\uff0c\u52a8\u6001\u7c7b\u578b\u8bed\u8a00\u7684\u5f00\u53d1\u6548\u7387\uff0c\u4ee5\u53ca\u9759\u6001\u7c7b\u578b\u7684\u5b89\u5168\u6027\u3002\u5b83\u4e5f\u6253\u7b97\u6210\u4e3a\u73b0\u4ee3\u7684\uff0c\u652f\u6301\u7f51\u7edc\u4e0e\u591a\u6838\u8ba1\u7b97\u7684\u8bed\u8a00\u3002\u8981\u6ee1\u8db3\u8fd9\u4e9b\u76ee\u6807\uff0c\u9700\u8981\u89e3\u51b3\u4e00\u4e9b\u8bed\u8a00\u4e0a\u7684\u95ee\u9898\uff1a\u4e00\u4e2a\u5bcc\u6709\u8868\u8fbe\u80fd\u529b\u4f46\u8f7b\u91cf\u7ea7\u7684\u7c7b\u578b\u7cfb\u7edf\uff0c\u5e76\u53d1\u4e0e\u5783\u573e\u56de\u6536\u673a\u5236\uff0c\u4e25\u683c\u7684\u4f9d\u8d56\u89c4\u8303\u7b49\u7b49\u3002\u8fd9\u4e9b\u65e0\u6cd5\u901a\u8fc7\u5e93\u6216\u5de5\u5177\u89e3\u51b3\u597d\uff0c\u56e0\u6b64Go\u4e5f\u5c31\u5e94\u8fd0\u800c\u751f\u4e86\u3002 \u5b98\u7f51: https://golang.org \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" go_version: \"1.10\" go_file: \"go{{ go_version }}.linux-amd64.tar.gz\" go_file_path: \"{{ software_files_path }}/{{ go_file }}\" go_file_url: \"https://studygolang.com/dl/golang/{{ go_file }}\" \u4f9d\u8d56 \u00b6 gcc github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/go Example Playbook \u00b6 - hosts: node1 roles: - go - hosts: node1 roles: - { role: go, go_version: '1.9.4' }","title":"go"},{"location":"roles/env/go/#ansible-role-go","text":"\u6dfb\u52a0go\u5f00\u53d1\u73af\u5883","title":"Ansible Role: go"},{"location":"roles/env/go/#_1","text":"Go\u662f\u4e00\u79cd\u7f16\u8bd1\u578b\u8bed\u8a00\uff0c\u5b83\u7ed3\u5408\u4e86\u89e3\u91ca\u578b\u8bed\u8a00\u7684\u6e38\u5203\u6709\u4f59\uff0c\u52a8\u6001\u7c7b\u578b\u8bed\u8a00\u7684\u5f00\u53d1\u6548\u7387\uff0c\u4ee5\u53ca\u9759\u6001\u7c7b\u578b\u7684\u5b89\u5168\u6027\u3002\u5b83\u4e5f\u6253\u7b97\u6210\u4e3a\u73b0\u4ee3\u7684\uff0c\u652f\u6301\u7f51\u7edc\u4e0e\u591a\u6838\u8ba1\u7b97\u7684\u8bed\u8a00\u3002\u8981\u6ee1\u8db3\u8fd9\u4e9b\u76ee\u6807\uff0c\u9700\u8981\u89e3\u51b3\u4e00\u4e9b\u8bed\u8a00\u4e0a\u7684\u95ee\u9898\uff1a\u4e00\u4e2a\u5bcc\u6709\u8868\u8fbe\u80fd\u529b\u4f46\u8f7b\u91cf\u7ea7\u7684\u7c7b\u578b\u7cfb\u7edf\uff0c\u5e76\u53d1\u4e0e\u5783\u573e\u56de\u6536\u673a\u5236\uff0c\u4e25\u683c\u7684\u4f9d\u8d56\u89c4\u8303\u7b49\u7b49\u3002\u8fd9\u4e9b\u65e0\u6cd5\u901a\u8fc7\u5e93\u6216\u5de5\u5177\u89e3\u51b3\u597d\uff0c\u56e0\u6b64Go\u4e5f\u5c31\u5e94\u8fd0\u800c\u751f\u4e86\u3002 \u5b98\u7f51: https://golang.org","title":"\u4ecb\u7ecd"},{"location":"roles/env/go/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/go/#_3","text":"ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/go/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" go_version: \"1.10\" go_file: \"go{{ go_version }}.linux-amd64.tar.gz\" go_file_path: \"{{ software_files_path }}/{{ go_file }}\" go_file_url: \"https://studygolang.com/dl/golang/{{ go_file }}\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/go/#_5","text":"gcc","title":"\u4f9d\u8d56"},{"location":"roles/env/go/#github","text":"https://github.com/lework/Ansible-roles/tree/master/go","title":"github\u5730\u5740"},{"location":"roles/env/go/#example-playbook","text":"- hosts: node1 roles: - go - hosts: node1 roles: - { role: go, go_version: '1.9.4' }","title":"Example Playbook"},{"location":"roles/env/hostnames/","text":"Ansible Role: hostnames \u00b6 \u914d\u7f6ehosts\u6587\u4ef6\u7684\u4e3b\u673a\u540d\u548cip\u7684\u5bf9\u5e94\u5173\u7cfb\u3002 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.9.1 python 2.7.5 os Centos 7.4 X64 Debian 9.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 hostnames_file: \"/etc/hosts\" ipnames: [] # [{'192.168.77.130': 'node1'}, {'192.168.77.131': 'node2'}, {'192.168.77.132': 'node3'}] # or # '192.168.77.130': 'node1' # '192.168.77.131': 'node2' # '192.168.77.132': 'node3' \u4f9d\u8d56 \u00b6 github\u5730\u5740 \u00b6 https://github.com/kuailemy123/Ansible-roles/tree/master/hostnames Example Playbook \u00b6 # \u6dfb\u52a0ip\u548c\u4e3b\u673a\u540d\u5230/etc/hosts - hosts : node1 roles : - hostnames # \u6dfb\u52a0\u6307\u5b9a\u7684ip\u548c\u4e3b\u673a\u540d\u5230/etc/hosts - hosts : node1 node2 node3 vars : - ipnames : '192.168.77.130' : 'node1' '192.168.77.131' : 'node2' '192.168.77.132' : 'node3' roles : - hostnames","title":"hostnames"},{"location":"roles/env/hostnames/#ansible-role-hostnames","text":"\u914d\u7f6ehosts\u6587\u4ef6\u7684\u4e3b\u673a\u540d\u548cip\u7684\u5bf9\u5e94\u5173\u7cfb\u3002","title":"Ansible Role: hostnames"},{"location":"roles/env/hostnames/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/hostnames/#_2","text":"ansible 2.9.1 python 2.7.5 os Centos 7.4 X64 Debian 9.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/hostnames/#_3","text":"hostnames_file: \"/etc/hosts\" ipnames: [] # [{'192.168.77.130': 'node1'}, {'192.168.77.131': 'node2'}, {'192.168.77.132': 'node3'}] # or # '192.168.77.130': 'node1' # '192.168.77.131': 'node2' # '192.168.77.132': 'node3'","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/hostnames/#_4","text":"","title":"\u4f9d\u8d56"},{"location":"roles/env/hostnames/#github","text":"https://github.com/kuailemy123/Ansible-roles/tree/master/hostnames","title":"github\u5730\u5740"},{"location":"roles/env/hostnames/#example-playbook","text":"# \u6dfb\u52a0ip\u548c\u4e3b\u673a\u540d\u5230/etc/hosts - hosts : node1 roles : - hostnames # \u6dfb\u52a0\u6307\u5b9a\u7684ip\u548c\u4e3b\u673a\u540d\u5230/etc/hosts - hosts : node1 node2 node3 vars : - ipnames : '192.168.77.130' : 'node1' '192.168.77.131' : 'node2' '192.168.77.132' : 'node3' roles : - hostnames","title":"Example Playbook"},{"location":"roles/env/java/","text":"Ansible Role: java \u00b6 \u6dfb\u52a0jdk1.7\u7248\u672c \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" java_version: \"1.7\" java_home: \"/usr/java/jdk1.7.0_80\" java_file: \"jdk-7u80-linux-x64.tar.gz\" java_file_path: \"{{ software_files_path }}/{{ java_file }}\" java_install_path: \"{{ software_install_path }}/jdk1.7.0_80\" java_file_url: \"http://download.oracle.com/otn/java/jdk/7u80-b15/d54c1d3a095b4ff2b6607d096fa80163/jdk-7u80-linux-x64.tar.gz\" \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/java Example Playbook \u00b6 jdk 1.7\u7248\u672c - hosts: node1 roles: - java jdk 1.8\u7248\u672c - hosts: node1 roles: - { role: java ,java_version: \"1.8\" }","title":"java"},{"location":"roles/env/java/#ansible-role-java","text":"\u6dfb\u52a0jdk1.7\u7248\u672c","title":"Ansible Role: java"},{"location":"roles/env/java/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/java/#_2","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/java/#_3","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" java_version: \"1.7\" java_home: \"/usr/java/jdk1.7.0_80\" java_file: \"jdk-7u80-linux-x64.tar.gz\" java_file_path: \"{{ software_files_path }}/{{ java_file }}\" java_install_path: \"{{ software_install_path }}/jdk1.7.0_80\" java_file_url: \"http://download.oracle.com/otn/java/jdk/7u80-b15/d54c1d3a095b4ff2b6607d096fa80163/jdk-7u80-linux-x64.tar.gz\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/java/#_4","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/env/java/#github","text":"https://github.com/lework/Ansible-roles/tree/master/java","title":"github\u5730\u5740"},{"location":"roles/env/java/#example-playbook","text":"jdk 1.7\u7248\u672c - hosts: node1 roles: - java jdk 1.8\u7248\u672c - hosts: node1 roles: - { role: java ,java_version: \"1.8\" }","title":"Example Playbook"},{"location":"roles/env/lua/","text":"Ansible Role: lua \u00b6 \u6dfb\u52a0lua\u8bed\u8a00\u73af\u5883 \u4ecb\u7ecd \u00b6 Lua \u662f\u4e00\u79cd\u8f7b\u91cf\u5c0f\u5de7\u7684\u811a\u672c\u8bed\u8a00\uff0c\u7528\u6807\u51c6C\u8bed\u8a00\u7f16\u5199\u5e76\u4ee5\u6e90\u4ee3\u7801\u5f62\u5f0f\u5f00\u653e\uff0c \u5176\u8bbe\u8ba1\u76ee\u7684\u662f\u4e3a\u4e86\u5d4c\u5165\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u4ece\u800c\u4e3a\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7075\u6d3b\u7684\u6269\u5c55\u548c\u5b9a\u5236\u529f\u80fd\u3002 Lua \u662f\u5df4\u897f\u91cc\u7ea6\u70ed\u5185\u5362\u5929\u4e3b\u6559\u5927\u5b66\uff08Pontifical Catholic University of Rio de Janeiro\uff09\u91cc\u7684\u4e00\u4e2a\u7814\u7a76\u5c0f\u7ec4\uff0c\u7531Roberto Ierusalimschy\u3001Waldemar Celes \u548c Luiz Henrique de Figueiredo\u6240\u7ec4\u6210\u5e76\u4e8e1993\u5e74\u5f00\u53d1\u3002 \u5b98\u7f51: http://www.lua.org/ \u5b98\u65b9\u6587\u6863: http://www.lua.org/docs.html wiki: http://lua-users.org/wiki/ \u7f16\u8bd1\u597d\u7684lua\uff1a http://luabinaries.sourceforge.net/ lua\u8f6f\u4ef6\u5305\u7ba1\u7406\u5668\uff1a https://luarocks.org/ luajit: http://luajit.org/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" lua_version: \"5.3.4\" lua_file: \"lua-{{ lua_version }}.tar.gz\" lua_file_path: \"{{ software_files_path }}/{{ lua_file }}\" lua_file_url: \" http://www.lua.org/ftp/{{ lua_file }}\" lua_luarocks_version: \"2.4.2\" lua_luarocks_file: \"luarocks-{{ lua_luarocks_version }}.tar.gz\" lua_luarocks_file_path: \"{{ software_files_path }}/{{ lua_luarocks_file }}\" lua_luarocks_file_url: \"http://luarocks.github.io/luarocks/releases/{{ lua_luarocks_file }}\" lua_luajit_version: \"2.0.5\" lua_luajit_file: \"LuaJIT-{{ lua_luajit_version }}.tar.gz\" lua_luajit_file_path: \"{{ software_files_path }}/{{ lua_luajit_file }}\" lua_luajit_file_url: \"http://luajit.org/download/{{ lua_luajit_file }}\" lua_install_rocks: [] install_luarocks: true install_luajit: false \u4f9d\u8d56 \u00b6 gcc github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/lua Example Playbook \u00b6 # \u9ed8\u8ba4\u5b89\u88c5lua - hosts: node1 roles: - lua # \u5b89\u88c5\u6307\u5b9a\u7248\u672c\u7684lua - hosts: node1 roles: - { role: lua, lua_version: '5.3.3' } # \u5b89\u88c5luajit - hosts: node1 vars: - install_luajit: true roles: - lua","title":"lua"},{"location":"roles/env/lua/#ansible-role-lua","text":"\u6dfb\u52a0lua\u8bed\u8a00\u73af\u5883","title":"Ansible Role: lua"},{"location":"roles/env/lua/#_1","text":"Lua \u662f\u4e00\u79cd\u8f7b\u91cf\u5c0f\u5de7\u7684\u811a\u672c\u8bed\u8a00\uff0c\u7528\u6807\u51c6C\u8bed\u8a00\u7f16\u5199\u5e76\u4ee5\u6e90\u4ee3\u7801\u5f62\u5f0f\u5f00\u653e\uff0c \u5176\u8bbe\u8ba1\u76ee\u7684\u662f\u4e3a\u4e86\u5d4c\u5165\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u4ece\u800c\u4e3a\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7075\u6d3b\u7684\u6269\u5c55\u548c\u5b9a\u5236\u529f\u80fd\u3002 Lua \u662f\u5df4\u897f\u91cc\u7ea6\u70ed\u5185\u5362\u5929\u4e3b\u6559\u5927\u5b66\uff08Pontifical Catholic University of Rio de Janeiro\uff09\u91cc\u7684\u4e00\u4e2a\u7814\u7a76\u5c0f\u7ec4\uff0c\u7531Roberto Ierusalimschy\u3001Waldemar Celes \u548c Luiz Henrique de Figueiredo\u6240\u7ec4\u6210\u5e76\u4e8e1993\u5e74\u5f00\u53d1\u3002 \u5b98\u7f51: http://www.lua.org/ \u5b98\u65b9\u6587\u6863: http://www.lua.org/docs.html wiki: http://lua-users.org/wiki/ \u7f16\u8bd1\u597d\u7684lua\uff1a http://luabinaries.sourceforge.net/ lua\u8f6f\u4ef6\u5305\u7ba1\u7406\u5668\uff1a https://luarocks.org/ luajit: http://luajit.org/","title":"\u4ecb\u7ecd"},{"location":"roles/env/lua/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/lua/#_3","text":"ansible 2.3.0.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/lua/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" lua_version: \"5.3.4\" lua_file: \"lua-{{ lua_version }}.tar.gz\" lua_file_path: \"{{ software_files_path }}/{{ lua_file }}\" lua_file_url: \" http://www.lua.org/ftp/{{ lua_file }}\" lua_luarocks_version: \"2.4.2\" lua_luarocks_file: \"luarocks-{{ lua_luarocks_version }}.tar.gz\" lua_luarocks_file_path: \"{{ software_files_path }}/{{ lua_luarocks_file }}\" lua_luarocks_file_url: \"http://luarocks.github.io/luarocks/releases/{{ lua_luarocks_file }}\" lua_luajit_version: \"2.0.5\" lua_luajit_file: \"LuaJIT-{{ lua_luajit_version }}.tar.gz\" lua_luajit_file_path: \"{{ software_files_path }}/{{ lua_luajit_file }}\" lua_luajit_file_url: \"http://luajit.org/download/{{ lua_luajit_file }}\" lua_install_rocks: [] install_luarocks: true install_luajit: false","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/lua/#_5","text":"gcc","title":"\u4f9d\u8d56"},{"location":"roles/env/lua/#github","text":"https://github.com/lework/Ansible-roles/tree/master/lua","title":"github\u5730\u5740"},{"location":"roles/env/lua/#example-playbook","text":"# \u9ed8\u8ba4\u5b89\u88c5lua - hosts: node1 roles: - lua # \u5b89\u88c5\u6307\u5b9a\u7248\u672c\u7684lua - hosts: node1 roles: - { role: lua, lua_version: '5.3.3' } # \u5b89\u88c5luajit - hosts: node1 vars: - install_luajit: true roles: - lua","title":"Example Playbook"},{"location":"roles/env/mvn/","text":"Ansible Role: mvn \u00b6 \u6dfb\u52a0mvn\u7f16\u8bd1\u73af\u5883 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" mvn_version: \"3.3.9\" mvn_file: \"apache-maven-{{ mvn_version }}-bin.tar.gz\" mvn_file_path: \"{{ software_files_path }}/{{ mvn_file }}\" mvn_install_path: \"{{ software_install_path }}/apache-maven-{{ mvn_version }}\" mvn_file_url: \"http://mirror.olnevhost.net/pub/apache/maven/maven-3/{{ mvn_version }}/binaries/apache-maven-{{ mvn_version }}-bin.tar.gz\" link_force: false \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/mvn Example Playbook \u00b6 - hosts: servers roles: - mvn - hosts: servers roles: - { role: mvn, mvn_version: '3.2.5' }","title":"mvn"},{"location":"roles/env/mvn/#ansible-role-mvn","text":"\u6dfb\u52a0mvn\u7f16\u8bd1\u73af\u5883","title":"Ansible Role: mvn"},{"location":"roles/env/mvn/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/mvn/#_2","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/mvn/#_3","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" mvn_version: \"3.3.9\" mvn_file: \"apache-maven-{{ mvn_version }}-bin.tar.gz\" mvn_file_path: \"{{ software_files_path }}/{{ mvn_file }}\" mvn_install_path: \"{{ software_install_path }}/apache-maven-{{ mvn_version }}\" mvn_file_url: \"http://mirror.olnevhost.net/pub/apache/maven/maven-3/{{ mvn_version }}/binaries/apache-maven-{{ mvn_version }}-bin.tar.gz\" link_force: false","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/mvn/#_4","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/env/mvn/#github","text":"https://github.com/lework/Ansible-roles/tree/master/mvn","title":"github\u5730\u5740"},{"location":"roles/env/mvn/#example-playbook","text":"- hosts: servers roles: - mvn - hosts: servers roles: - { role: mvn, mvn_version: '3.2.5' }","title":"Example Playbook"},{"location":"roles/env/nodejs/","text":"Ansible Role: nodejs \u00b6 \u5b89\u88c5nodejs \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" nodejs_version: \"6.13.1\" nodejs_file: \"node-v{{ nodejs_version }}-linux-x64.tar.gz\" nodejs_file_path: \"{{ software_files_path }}/{{ nodejs_file }}\" nodejs_file_url: \"http://nodejs.org/dist/v{{ nodejs_version }}/{{ nodejs_file }}\" npm_config_prefix: \"{{ nodejs_install_path }}/nodejs\" npm_registry: \"https://registry.npm.taobao.org\" nodejs_npm_global_packages: - {'name': 'forever'} \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/nodejs Example Playbook \u00b6 - hosts: servers roles: - nodejs - hosts: server roles: - { role: nodejs, nodejs_version: \"0.12.9\", nodejs_npm_global_packages: [{'name':'serve'}]}","title":"nodejs"},{"location":"roles/env/nodejs/#ansible-role-nodejs","text":"\u5b89\u88c5nodejs","title":"Ansible Role: nodejs"},{"location":"roles/env/nodejs/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/nodejs/#_2","text":"ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/nodejs/#_3","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" nodejs_version: \"6.13.1\" nodejs_file: \"node-v{{ nodejs_version }}-linux-x64.tar.gz\" nodejs_file_path: \"{{ software_files_path }}/{{ nodejs_file }}\" nodejs_file_url: \"http://nodejs.org/dist/v{{ nodejs_version }}/{{ nodejs_file }}\" npm_config_prefix: \"{{ nodejs_install_path }}/nodejs\" npm_registry: \"https://registry.npm.taobao.org\" nodejs_npm_global_packages: - {'name': 'forever'}","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/nodejs/#_4","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/env/nodejs/#github","text":"https://github.com/lework/Ansible-roles/tree/master/nodejs","title":"github\u5730\u5740"},{"location":"roles/env/nodejs/#example-playbook","text":"- hosts: servers roles: - nodejs - hosts: server roles: - { role: nodejs, nodejs_version: \"0.12.9\", nodejs_npm_global_packages: [{'name':'serve'}]}","title":"Example Playbook"},{"location":"roles/env/openssh/","text":"Ansible Role: openssh \u00b6 \u5b89\u88c5 openssh \u4ecb\u7ecd \u00b6 OpenSSH\u662f\u4f7f\u7528SSH\u900f\u8fc7\u8ba1\u7b97\u673a\u7f51\u7edc\u52a0\u5bc6\u901a\u4fe1\u7684\u5b9e\u73b0\u3002\u5b83\u662f\u53d6\u4ee3\u7531SSH Communications Security\u6240\u63d0\u4f9b\u7684\u5546\u7528\u7248\u672c\u7684\u5f00\u653e\u6e90\u4ee3\u7801\u65b9\u6848\u3002\u5f53\u524dOpenSSH\u662fOpenBSD\u7684\u5b50\u9879\u76ee\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://www.openssh.com GitHub\uff1a https://github.com/openssl/openssl \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u5728Debian\u548cRHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 6, Centos 7, Debian 9 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path : \"/opt/software\" software_install_path : \"/usr\" openssh_version : \"8.1p1\" openssh_file : \"openssh-{{ openssh_version }}.tar.gz\" openssh_file_path : \"{{ software_files_path }}/{{ openssh_file }}\" openssh_file_url : \"https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/{{ openssh_file }}\" openssh_ssl_dir : /usr/local/openssl openssh_sshd_port : 22 openssh_sshd_use_dns : \"no\" openssh_sshd_permit_root_login : \"yes\" openssh_sshd_password_authentication : \"yes\" \u4f9d\u8d56 \u00b6 openssl github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/openssh Example Playbook \u00b6 # \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - openssl - openssh # \u6307\u5b9a\u7248\u672c - hosts : node1 vars : - openssl_version : \"1.1.1d\" - openssh_version : \"8.1p1\" roles : - openssl - openssh \u4f7f\u7528 \u00b6 ssh -V","title":"openssh"},{"location":"roles/env/openssh/#ansible-role-openssh","text":"\u5b89\u88c5 openssh","title":"Ansible Role: openssh"},{"location":"roles/env/openssh/#_1","text":"OpenSSH\u662f\u4f7f\u7528SSH\u900f\u8fc7\u8ba1\u7b97\u673a\u7f51\u7edc\u52a0\u5bc6\u901a\u4fe1\u7684\u5b9e\u73b0\u3002\u5b83\u662f\u53d6\u4ee3\u7531SSH Communications Security\u6240\u63d0\u4f9b\u7684\u5546\u7528\u7248\u672c\u7684\u5f00\u653e\u6e90\u4ee3\u7801\u65b9\u6848\u3002\u5f53\u524dOpenSSH\u662fOpenBSD\u7684\u5b50\u9879\u76ee\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://www.openssh.com GitHub\uff1a https://github.com/openssl/openssl","title":"\u4ecb\u7ecd"},{"location":"roles/env/openssh/#_2","text":"\u6b64\u89d2\u8272\u5728Debian\u548cRHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/openssh/#_3","text":"ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 6, Centos 7, Debian 9","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/openssh/#_4","text":"software_files_path : \"/opt/software\" software_install_path : \"/usr\" openssh_version : \"8.1p1\" openssh_file : \"openssh-{{ openssh_version }}.tar.gz\" openssh_file_path : \"{{ software_files_path }}/{{ openssh_file }}\" openssh_file_url : \"https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/{{ openssh_file }}\" openssh_ssl_dir : /usr/local/openssl openssh_sshd_port : 22 openssh_sshd_use_dns : \"no\" openssh_sshd_permit_root_login : \"yes\" openssh_sshd_password_authentication : \"yes\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/openssh/#_5","text":"openssl","title":"\u4f9d\u8d56"},{"location":"roles/env/openssh/#github","text":"https://github.com/lework/Ansible-roles/tree/master/openssh","title":"github\u5730\u5740"},{"location":"roles/env/openssh/#example-playbook","text":"# \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - openssl - openssh # \u6307\u5b9a\u7248\u672c - hosts : node1 vars : - openssl_version : \"1.1.1d\" - openssh_version : \"8.1p1\" roles : - openssl - openssh","title":"Example Playbook"},{"location":"roles/env/openssh/#_6","text":"ssh -V","title":"\u4f7f\u7528"},{"location":"roles/env/openssl/","text":"Ansible Role: openssl \u00b6 \u5b89\u88c5 openssl \u4ecb\u7ecd \u00b6 \u5728\u8ba1\u7b97\u673a\u7f51\u7edc\u4e0a\uff0cOpenSSL\u662f\u4e00\u4e2a\u5f00\u653e\u6e90\u4ee3\u7801\u7684\u8f6f\u4ef6\u5e93\u5305\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u5305\u6765\u8fdb\u884c\u5b89\u5168\u901a\u4fe1\uff0c\u907f\u514d\u7a83\u542c\uff0c\u540c\u65f6\u786e\u8ba4\u53e6\u4e00\u7aef\u8fde\u7ebf\u8005\u7684\u8eab\u4efd\u3002\u8fd9\u4e2a\u5305\u5e7f\u6cdb\u88ab\u5e94\u7528\u5728\u4e92\u8054\u7f51\u7684\u7f51\u9875\u670d\u52a1\u5668\u4e0a\u3002 \u5176\u4e3b\u8981\u5e93\u662f\u4ee5C\u8bed\u8a00\u6240\u5199\u6210\uff0c\u5b9e\u73b0\u4e86\u57fa\u672c\u7684\u52a0\u5bc6\u529f\u80fd\uff0c\u5b9e\u73b0\u4e86SSL\u4e0eTLS\u534f\u8bae\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://www.openssl.org GitHub\uff1a https://github.com/openssl/openssl \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u5728Debian\u548cRHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 6, Centos 7, Debian 9 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path : \"/opt/software\" software_install_path : \"/usr/local/openssl\" openssl_version : \"1.1.1d\" openssl_file : \"openssl-{{ openssl_version }}.tar.gz\" openssl_file_path : \"{{ software_files_path }}/{{ openssl_file }}\" openssl_file_url : \"https://www.openssl.org/source/{{ openssl_file }}\" \u4f9d\u8d56 \u00b6 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/openssl Example Playbook \u00b6 # \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - openssl # \u6307\u5b9a\u7248\u672c - hosts : node1 vars : - openssl_version : \"1.1.1d\" roles : - openssl \u4f7f\u7528 \u00b6 openssl version","title":"openssl"},{"location":"roles/env/openssl/#ansible-role-openssl","text":"\u5b89\u88c5 openssl","title":"Ansible Role: openssl"},{"location":"roles/env/openssl/#_1","text":"\u5728\u8ba1\u7b97\u673a\u7f51\u7edc\u4e0a\uff0cOpenSSL\u662f\u4e00\u4e2a\u5f00\u653e\u6e90\u4ee3\u7801\u7684\u8f6f\u4ef6\u5e93\u5305\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u5305\u6765\u8fdb\u884c\u5b89\u5168\u901a\u4fe1\uff0c\u907f\u514d\u7a83\u542c\uff0c\u540c\u65f6\u786e\u8ba4\u53e6\u4e00\u7aef\u8fde\u7ebf\u8005\u7684\u8eab\u4efd\u3002\u8fd9\u4e2a\u5305\u5e7f\u6cdb\u88ab\u5e94\u7528\u5728\u4e92\u8054\u7f51\u7684\u7f51\u9875\u670d\u52a1\u5668\u4e0a\u3002 \u5176\u4e3b\u8981\u5e93\u662f\u4ee5C\u8bed\u8a00\u6240\u5199\u6210\uff0c\u5b9e\u73b0\u4e86\u57fa\u672c\u7684\u52a0\u5bc6\u529f\u80fd\uff0c\u5b9e\u73b0\u4e86SSL\u4e0eTLS\u534f\u8bae\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://www.openssl.org GitHub\uff1a https://github.com/openssl/openssl","title":"\u4ecb\u7ecd"},{"location":"roles/env/openssl/#_2","text":"\u6b64\u89d2\u8272\u5728Debian\u548cRHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/openssl/#_3","text":"ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 6, Centos 7, Debian 9","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/openssl/#_4","text":"software_files_path : \"/opt/software\" software_install_path : \"/usr/local/openssl\" openssl_version : \"1.1.1d\" openssl_file : \"openssl-{{ openssl_version }}.tar.gz\" openssl_file_path : \"{{ software_files_path }}/{{ openssl_file }}\" openssl_file_url : \"https://www.openssl.org/source/{{ openssl_file }}\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/openssl/#_5","text":"","title":"\u4f9d\u8d56"},{"location":"roles/env/openssl/#github","text":"https://github.com/lework/Ansible-roles/tree/master/openssl","title":"github\u5730\u5740"},{"location":"roles/env/openssl/#example-playbook","text":"# \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - openssl # \u6307\u5b9a\u7248\u672c - hosts : node1 vars : - openssl_version : \"1.1.1d\" roles : - openssl","title":"Example Playbook"},{"location":"roles/env/openssl/#_6","text":"openssl version","title":"\u4f7f\u7528"},{"location":"roles/env/os-init/","text":"Ansible Role: OS INIT \u00b6 \u9488\u5bf9 linux \u7cfb\u7edf\u8fdb\u884c\u4e00\u4e9b\u521d\u59cb\u5316\u64cd\u4f5c\u3002 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u5728Debian\u548cRHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 7, Debian 9, Debian 10 \u89d2\u8272\u53d8\u91cf \u00b6 \u65e0 \u521d\u59cb\u5316\u9879\u76ee \u00b6 \u5173\u95ed\u670d\u52a1 \u5173\u95ed\u9632\u706b\u5899 \u5173\u95ed\u7f51\u7edc\u670d\u52a1 \u5173\u95edselinux \u5173\u95edswap \u7cfb\u7edf\u4f18\u5316 \u7cfb\u7edf\u53c2\u6570\u8c03\u6574 \u4fee\u6539\u7cfb\u7edf\u9650\u5236 \u4fee\u6539\u7cfb\u7edf\u4ed3\u5e93\u56fd\u5185\u955c\u50cf \u7cfb\u7edf\u8bbe\u7f6e \u4fee\u6539sshd\u914d\u7f6e vim\u73af\u5883\u8bbe\u7f6e cpu\u8bbe\u7f6e\u4e3a\u6027\u80fd\u6a21\u5f0f \u7cfb\u7edf\u73af\u5883\u8bbe\u7f6e history\u683c\u5f0f\u8bbe\u7f6e \u529f\u80fd\u542f\u7528 \u5b89\u88c5\u57fa\u7840\u8f6f\u4ef6 \u5f00\u542fsystemd journald\u670d\u52a1 \u5f00\u542frc.local\u5f00\u673a\u81ea\u542f\u52a8 \u7cfb\u7edf\u5347\u7ea7 \u5347\u7ea7\u7cfb\u7edf\u5305 \u4f9d\u8d56 \u00b6 \u65e0 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/os-init Example Playbook \u00b6 - hosts : servers roles : - os-init","title":"os-init"},{"location":"roles/env/os-init/#ansible-role-os-init","text":"\u9488\u5bf9 linux \u7cfb\u7edf\u8fdb\u884c\u4e00\u4e9b\u521d\u59cb\u5316\u64cd\u4f5c\u3002","title":"Ansible Role: OS INIT"},{"location":"roles/env/os-init/#_1","text":"\u6b64\u89d2\u8272\u5728Debian\u548cRHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/os-init/#_2","text":"ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 7, Debian 9, Debian 10","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/os-init/#_3","text":"\u65e0","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/os-init/#_4","text":"\u5173\u95ed\u670d\u52a1 \u5173\u95ed\u9632\u706b\u5899 \u5173\u95ed\u7f51\u7edc\u670d\u52a1 \u5173\u95edselinux \u5173\u95edswap \u7cfb\u7edf\u4f18\u5316 \u7cfb\u7edf\u53c2\u6570\u8c03\u6574 \u4fee\u6539\u7cfb\u7edf\u9650\u5236 \u4fee\u6539\u7cfb\u7edf\u4ed3\u5e93\u56fd\u5185\u955c\u50cf \u7cfb\u7edf\u8bbe\u7f6e \u4fee\u6539sshd\u914d\u7f6e vim\u73af\u5883\u8bbe\u7f6e cpu\u8bbe\u7f6e\u4e3a\u6027\u80fd\u6a21\u5f0f \u7cfb\u7edf\u73af\u5883\u8bbe\u7f6e history\u683c\u5f0f\u8bbe\u7f6e \u529f\u80fd\u542f\u7528 \u5b89\u88c5\u57fa\u7840\u8f6f\u4ef6 \u5f00\u542fsystemd journald\u670d\u52a1 \u5f00\u542frc.local\u5f00\u673a\u81ea\u542f\u52a8 \u7cfb\u7edf\u5347\u7ea7 \u5347\u7ea7\u7cfb\u7edf\u5305","title":"\u521d\u59cb\u5316\u9879\u76ee"},{"location":"roles/env/os-init/#_5","text":"\u65e0","title":"\u4f9d\u8d56"},{"location":"roles/env/os-init/#github","text":"https://github.com/lework/Ansible-roles/tree/master/os-init","title":"github\u5730\u5740"},{"location":"roles/env/os-init/#example-playbook","text":"- hosts : servers roles : - os-init","title":"Example Playbook"},{"location":"roles/env/php/","text":"Ansible Role: php \u00b6 \u5b89\u88c5php7\u73af\u5883, \u4f7f\u7528php-fpm\u7ba1\u7406,\u6216\u8005\u4f7f\u7528httpd. \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.5.1 os Centos 7.2.1511 X64 python 2.7.5 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" php_version: \"7.2.1\" php_file: \"php-{{ php_version }}.tar.gz\" php_file_path: \"{{ software_files_path }}/{{ php_file }}\" php_install_path: \"{{ software_install_path }}/php-{{ php_version }}\" php_file_url: \"http://cn2.php.net/distributions/{{ php_file }}\" php_rpm_url: \"https://mirror.webtatic.com/yum/el{{ansible_distribution_major_version}}/webtatic-release.rpm\" php_install_from_source: false php_httpd_enable: false php_user: \"apache\" php_group: \"apache\" php_conf_paths: \"/etc\" php_extension_conf_paths: \"/etc/php.d\" php_fpm_conf_path: \"/etc/fpm\" php_fpm_pool_conf_path: \"/etc/php-fpm.d\" php_apcu_file_url: \"https://github.com/krakjoe/apcu/archive/v5.1.9.tar.gz\" php_apcu_file: \"apcu-5.1.9.tar.gz\" php_apcu_file_path: \"{{ software_files_path }}/{{ php_apcu_file }}\" php_apcu_configure_command: > ./configure --enable-apcu --enable-apcu-mmap --with-php-config={{ php_install_path }}/bin/php-config php_source_configure_command: > ./configure --prefix={{ php_install_path }} --exec-prefix={{ php_install_path }} --bindir={{ php_install_path }}/bin --sbindir={{ php_install_path }}/sbin --includedir={{ php_install_path }}/include --libdir={{ php_install_path }}/lib/php --mandir={{ php_install_path }}/php/man --with-config-file-path={{ php_conf_paths }} --with-config-file-scan-dir={{ php_extension_conf_paths }} --with-mcrypt=/usr/include{% if php_httpd_enable %} --with-apxs2=/usr/bin/apxs{% endif %} --with-mhash --with-openssl --with-mysql-sock=/var/lib/mysql/mysql.sock --with-mysqli=shared,mysqlnd --with-pdo-mysql=shared,mysqlnd --with-pdo-sqlite --with-gd --with-curl --with-iconv --with-gmp --with-pspell --with-zlib --with-xmlrpc --with-gettext --with-curl --with-jpeg-dir --with-freetype-dir --enable-zip --enable-wddx --enable-inline-optimization= --enable-shared --enable-xml --enable-bcmath --enable-shmop --enable-sysvmsg --enable-sysvsem --enable-sysvshm --enable-mbregex --enable-mbstring --enable-ftp --enable-gd-native-ttf --enable-gd-jis-conv --enable-pcntl --enable-pdo --enable-sockets --enable-soap --enable-session --enable-opcache --enable-fpm --enable-mysqlnd --disable-debug --disable-rpath --disable-fileinfo --without-gdbm --without-pear php_enable_php_fpm: true php_fpm_listen: \"127.0.0.1:9000\" php_fpm_listen_allowed_clients: \"127.0.0.1\" php_fpm_pm_max_children: 50 php_fpm_pm_start_servers: 5 php_fpm_pm_min_spare_servers: 5 php_fpm_pm_max_spare_servers: 5 # OpCache settings. php_opcache_zend_extension: \"opcache.so\" php_opcache_enable: \"1\" php_opcache_enable_cli: \"0\" php_opcache_memory_consumption: \"96\" php_opcache_interned_strings_buffer: \"16\" php_opcache_max_accelerated_files: \"4096\" php_opcache_max_wasted_percentage: \"5\" php_opcache_validate_timestamps: \"1\" php_opcache_revalidate_path: \"0\" php_opcache_revalidate_freq: \"2\" php_opcache_max_file_size: \"0\" php_opcache_blacklist_filename: \"\" # APCu settings. php_enable_apcu: true php_apc_shm_size: \"96M\" php_apc_enable_cli: \"0\" php_expose_php: \"On\" php_memory_limit: \"256M\" php_max_execution_time: \"300\" php_max_input_time: \"300\" php_max_input_vars: \"1000\" php_input_nesting_level: \"64\" php_realpath_cache_size: \"32K\" php_file_uploads: \"On\" php_upload_max_filesize: \"64M\" php_max_file_uploads: \"20\" php_post_max_size: \"32M\" php_date_timezone: \"Asia/Shanghai\" php_allow_url_fopen: \"On\" php_sendmail_path: \"/usr/sbin/sendmail -t -i\" php_output_buffering: \"4096\" php_short_open_tag: \"Off\" php_disable_functions: [] php_session_cookie_lifetime: 0 php_session_gc_probability: 1 php_session_gc_divisor: 1000 php_session_gc_maxlifetime: 1440 php_session_save_handler: files php_session_save_path: \"/tmp\" php_error_reporting: \"E_ALL & ~E_DEPRECATED & ~E_STRICT\" php_display_errors: \"Off\" php_display_startup_errors: \"Off\" \u4f9d\u8d56 \u00b6 epel github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/php Example Playbook \u00b6 rpm\u65b9\u5f0f\u5b89\u88c5 - hosts: node1 roles: - php \u6e90\u7801\u65b9\u5f0f\u5b89\u88c5 - hosts: node1 roles: - { role: php, php_install_from_source: true } \u4f7f\u7528httpd\u7ba1\u7406 - hosts: node1 roles: - { role: php, php_httpd_enable: true } \u4f7f\u7528 \u00b6 systemctl start php-fpm systemctl stop php-fpm","title":"php"},{"location":"roles/env/php/#ansible-role-php","text":"\u5b89\u88c5php7\u73af\u5883, \u4f7f\u7528php-fpm\u7ba1\u7406,\u6216\u8005\u4f7f\u7528httpd.","title":"Ansible Role: php"},{"location":"roles/env/php/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/php/#_2","text":"ansible 2.5.1 os Centos 7.2.1511 X64 python 2.7.5","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/php/#_3","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" php_version: \"7.2.1\" php_file: \"php-{{ php_version }}.tar.gz\" php_file_path: \"{{ software_files_path }}/{{ php_file }}\" php_install_path: \"{{ software_install_path }}/php-{{ php_version }}\" php_file_url: \"http://cn2.php.net/distributions/{{ php_file }}\" php_rpm_url: \"https://mirror.webtatic.com/yum/el{{ansible_distribution_major_version}}/webtatic-release.rpm\" php_install_from_source: false php_httpd_enable: false php_user: \"apache\" php_group: \"apache\" php_conf_paths: \"/etc\" php_extension_conf_paths: \"/etc/php.d\" php_fpm_conf_path: \"/etc/fpm\" php_fpm_pool_conf_path: \"/etc/php-fpm.d\" php_apcu_file_url: \"https://github.com/krakjoe/apcu/archive/v5.1.9.tar.gz\" php_apcu_file: \"apcu-5.1.9.tar.gz\" php_apcu_file_path: \"{{ software_files_path }}/{{ php_apcu_file }}\" php_apcu_configure_command: > ./configure --enable-apcu --enable-apcu-mmap --with-php-config={{ php_install_path }}/bin/php-config php_source_configure_command: > ./configure --prefix={{ php_install_path }} --exec-prefix={{ php_install_path }} --bindir={{ php_install_path }}/bin --sbindir={{ php_install_path }}/sbin --includedir={{ php_install_path }}/include --libdir={{ php_install_path }}/lib/php --mandir={{ php_install_path }}/php/man --with-config-file-path={{ php_conf_paths }} --with-config-file-scan-dir={{ php_extension_conf_paths }} --with-mcrypt=/usr/include{% if php_httpd_enable %} --with-apxs2=/usr/bin/apxs{% endif %} --with-mhash --with-openssl --with-mysql-sock=/var/lib/mysql/mysql.sock --with-mysqli=shared,mysqlnd --with-pdo-mysql=shared,mysqlnd --with-pdo-sqlite --with-gd --with-curl --with-iconv --with-gmp --with-pspell --with-zlib --with-xmlrpc --with-gettext --with-curl --with-jpeg-dir --with-freetype-dir --enable-zip --enable-wddx --enable-inline-optimization= --enable-shared --enable-xml --enable-bcmath --enable-shmop --enable-sysvmsg --enable-sysvsem --enable-sysvshm --enable-mbregex --enable-mbstring --enable-ftp --enable-gd-native-ttf --enable-gd-jis-conv --enable-pcntl --enable-pdo --enable-sockets --enable-soap --enable-session --enable-opcache --enable-fpm --enable-mysqlnd --disable-debug --disable-rpath --disable-fileinfo --without-gdbm --without-pear php_enable_php_fpm: true php_fpm_listen: \"127.0.0.1:9000\" php_fpm_listen_allowed_clients: \"127.0.0.1\" php_fpm_pm_max_children: 50 php_fpm_pm_start_servers: 5 php_fpm_pm_min_spare_servers: 5 php_fpm_pm_max_spare_servers: 5 # OpCache settings. php_opcache_zend_extension: \"opcache.so\" php_opcache_enable: \"1\" php_opcache_enable_cli: \"0\" php_opcache_memory_consumption: \"96\" php_opcache_interned_strings_buffer: \"16\" php_opcache_max_accelerated_files: \"4096\" php_opcache_max_wasted_percentage: \"5\" php_opcache_validate_timestamps: \"1\" php_opcache_revalidate_path: \"0\" php_opcache_revalidate_freq: \"2\" php_opcache_max_file_size: \"0\" php_opcache_blacklist_filename: \"\" # APCu settings. php_enable_apcu: true php_apc_shm_size: \"96M\" php_apc_enable_cli: \"0\" php_expose_php: \"On\" php_memory_limit: \"256M\" php_max_execution_time: \"300\" php_max_input_time: \"300\" php_max_input_vars: \"1000\" php_input_nesting_level: \"64\" php_realpath_cache_size: \"32K\" php_file_uploads: \"On\" php_upload_max_filesize: \"64M\" php_max_file_uploads: \"20\" php_post_max_size: \"32M\" php_date_timezone: \"Asia/Shanghai\" php_allow_url_fopen: \"On\" php_sendmail_path: \"/usr/sbin/sendmail -t -i\" php_output_buffering: \"4096\" php_short_open_tag: \"Off\" php_disable_functions: [] php_session_cookie_lifetime: 0 php_session_gc_probability: 1 php_session_gc_divisor: 1000 php_session_gc_maxlifetime: 1440 php_session_save_handler: files php_session_save_path: \"/tmp\" php_error_reporting: \"E_ALL & ~E_DEPRECATED & ~E_STRICT\" php_display_errors: \"Off\" php_display_startup_errors: \"Off\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/php/#_4","text":"epel","title":"\u4f9d\u8d56"},{"location":"roles/env/php/#github","text":"https://github.com/lework/Ansible-roles/tree/master/php","title":"github\u5730\u5740"},{"location":"roles/env/php/#example-playbook","text":"rpm\u65b9\u5f0f\u5b89\u88c5 - hosts: node1 roles: - php \u6e90\u7801\u65b9\u5f0f\u5b89\u88c5 - hosts: node1 roles: - { role: php, php_install_from_source: true } \u4f7f\u7528httpd\u7ba1\u7406 - hosts: node1 roles: - { role: php, php_httpd_enable: true }","title":"Example Playbook"},{"location":"roles/env/php/#_5","text":"systemctl start php-fpm systemctl stop php-fpm","title":"\u4f7f\u7528"},{"location":"roles/env/python2.7/","text":"Ansible Role: python2.7 \u00b6 Centos 6.7\u7248\u672c\u4e2d\u7684python2.6\u5347\u7ea7\u52302.7 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software/\" software_install_path: \"/usr/local\" python_version: \"2.7.13\" python_file: \"Python-{{ python_version }}.tgz\" python_file_path: \"{{ software_files_path }}/{{ python_file }}\" python_file_url: \"http://www.python.org/ftp/python/{{ python_version }}/Python-{{ python_version }}.tgz\" pip_source_url: \"https://pypi.tuna.tsinghua.edu.cn/simple\" change_pip_source: true \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/python2.7 Example Playbook \u00b6 - hosts: servers roles: - python2.7 - hosts: server roles: - { role: python2.7, python_version: \"2.7.13\"}","title":"python2.7"},{"location":"roles/env/python2.7/#ansible-role-python27","text":"Centos 6.7\u7248\u672c\u4e2d\u7684python2.6\u5347\u7ea7\u52302.7","title":"Ansible Role: python2.7"},{"location":"roles/env/python2.7/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/python2.7/#_2","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/python2.7/#_3","text":"software_files_path: \"/opt/software/\" software_install_path: \"/usr/local\" python_version: \"2.7.13\" python_file: \"Python-{{ python_version }}.tgz\" python_file_path: \"{{ software_files_path }}/{{ python_file }}\" python_file_url: \"http://www.python.org/ftp/python/{{ python_version }}/Python-{{ python_version }}.tgz\" pip_source_url: \"https://pypi.tuna.tsinghua.edu.cn/simple\" change_pip_source: true","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/python2.7/#_4","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/env/python2.7/#github","text":"https://github.com/lework/Ansible-roles/tree/master/python2.7","title":"github\u5730\u5740"},{"location":"roles/env/python2.7/#example-playbook","text":"- hosts: servers roles: - python2.7 - hosts: server roles: - { role: python2.7, python_version: \"2.7.13\"}","title":"Example Playbook"},{"location":"roles/env/repo-epel/","text":"Ansible Role: EPEL Repository \u00b6 EPEL\u4f7f\u7528* \u4e2d\u56fd\u79d1\u5b66\u6280\u672f\u5927\u5b66 * \u4f5c\u4e3ayum\u6e90\uff0c\u5e76\u5de5\u4f5c\u5728RHEL/CentOS\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u3002 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 \u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf\u90fd\u653e\u5728 defaults/main.yml \u6587\u4ef6\u4e2d: epel_source_url: \"http://mirrors.ustc.edu.cn\" epel_repo_url: \"{{ epel_source_url }}/epel/epel-release-latest-{{ ansible_distribution_major_version }}.noarch.rpm\" epel_repo_gpg_key_url: \"/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-{{ ansible_distribution_major_version }}\" epel_repofile_path: \"/etc/yum.repos.d/epel.repo\" epel_testing_repofile_path: \"/etc/yum.repos.d/epel-testing.repo\" change_epel: 'True' \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/repo-epel Example Playbook \u00b6 - hosts: servers roles: - repo-epel - host\uff1a servers roles: - {role: repo-epel, epel_source_url: \"https://mirrors.tuna.tsinghua.edu.cn\" }","title":"repo-epel"},{"location":"roles/env/repo-epel/#ansible-role-epel-repository","text":"EPEL\u4f7f\u7528* \u4e2d\u56fd\u79d1\u5b66\u6280\u672f\u5927\u5b66 * \u4f5c\u4e3ayum\u6e90\uff0c\u5e76\u5de5\u4f5c\u5728RHEL/CentOS\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u3002","title":"Ansible Role: EPEL Repository"},{"location":"roles/env/repo-epel/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/repo-epel/#_2","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/repo-epel/#_3","text":"\u89d2\u8272\u9ed8\u8ba4\u53d8\u91cf\u90fd\u653e\u5728 defaults/main.yml \u6587\u4ef6\u4e2d: epel_source_url: \"http://mirrors.ustc.edu.cn\" epel_repo_url: \"{{ epel_source_url }}/epel/epel-release-latest-{{ ansible_distribution_major_version }}.noarch.rpm\" epel_repo_gpg_key_url: \"/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-{{ ansible_distribution_major_version }}\" epel_repofile_path: \"/etc/yum.repos.d/epel.repo\" epel_testing_repofile_path: \"/etc/yum.repos.d/epel-testing.repo\" change_epel: 'True'","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/repo-epel/#_4","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/env/repo-epel/#github","text":"https://github.com/lework/Ansible-roles/tree/master/repo-epel","title":"github\u5730\u5740"},{"location":"roles/env/repo-epel/#example-playbook","text":"- hosts: servers roles: - repo-epel - host\uff1a servers roles: - {role: repo-epel, epel_source_url: \"https://mirrors.tuna.tsinghua.edu.cn\" }","title":"Example Playbook"},{"location":"roles/env/ruby/","text":"Ansible Role: ruby \u00b6 \u5b89\u88c5ruby \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" ruby_install_bundler: true ruby_install_gems: [] ruby_install_gems_user: \"{{ ansible_user }}\" ruby_install_from_source: false ruby_version: 2.3.0 ruby_download_url: \"http://cache.ruby-lang.org/pub/ruby/ruby-{{ ruby_version }}.tar.gz\" ruby_file_path: \"{{ software_files_path }}/ruby-{{ ruby_version }}.tar.gz\" ruby_gem_sources: https://gems.ruby-china.org/ \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/ruby Example Playbook \u00b6 - hosts: servers roles: - ruby - hosts: server roles: - { role: ruby, ruby_install_from_source: true}","title":"ruby"},{"location":"roles/env/ruby/#ansible-role-ruby","text":"\u5b89\u88c5ruby","title":"Ansible Role: ruby"},{"location":"roles/env/ruby/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/ruby/#_2","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/ruby/#_3","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" ruby_install_bundler: true ruby_install_gems: [] ruby_install_gems_user: \"{{ ansible_user }}\" ruby_install_from_source: false ruby_version: 2.3.0 ruby_download_url: \"http://cache.ruby-lang.org/pub/ruby/ruby-{{ ruby_version }}.tar.gz\" ruby_file_path: \"{{ software_files_path }}/ruby-{{ ruby_version }}.tar.gz\" ruby_gem_sources: https://gems.ruby-china.org/","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/ruby/#_4","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/env/ruby/#github","text":"https://github.com/lework/Ansible-roles/tree/master/ruby","title":"github\u5730\u5740"},{"location":"roles/env/ruby/#example-playbook","text":"- hosts: servers roles: - ruby - hosts: server roles: - { role: ruby, ruby_install_from_source: true}","title":"Example Playbook"},{"location":"roles/env/sbt/","text":"Ansible Role: sbt \u00b6 \u6dfb\u52a0Scala\u7f16\u8bd1\u73af\u5883 \u8bf4\u660e \u00b6 SBT = (not so) Simple Build Tool,\u662fscala\u7684\u6784\u5efa\u5de5\u5177\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a http://www.scala-sbt.org/ \u5b98\u65b9\u6587\u6863\uff1a http://www.scala-sbt.org/0.13/docs/zh-cn/index.html github: https://github.com/sbt/sbt \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" sbt_version: \"0.13.15\" sbt_file: \"sbt-{{ sbt_version }}.tgz\" sbt_file_path: \"{{ software_files_path }}/{{ sbt_file }}\" sbt_install_path: \"{{ software_install_path }}/apache-maven-{{ mvn_version }}\" sbt_file_url: \"https://downloads.lightbend.com/sbt/{{ sbt_version }}/{{ sbt_file }}\" sbt_maven: \"http://maven.aliyun.com/nexus/content/groups/public/\" sbt_typesafe: \"http://dl.bintray.com/typesafe/ivy-releases/\" sbt_ivy_plugin: \"http://dl.bintray.com/sbt/sbt-plugin-releases/\" \u4f9d\u8d56 \u00b6 Java 1.6+ github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/sbt Example Playbook \u00b6 - hosts: node1 roles: - sbt - hosts: node1 roles: - { role: sbt, sbt_version: '0.13.15' }","title":"sbt"},{"location":"roles/env/sbt/#ansible-role-sbt","text":"\u6dfb\u52a0Scala\u7f16\u8bd1\u73af\u5883","title":"Ansible Role: sbt"},{"location":"roles/env/sbt/#_1","text":"SBT = (not so) Simple Build Tool,\u662fscala\u7684\u6784\u5efa\u5de5\u5177\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a http://www.scala-sbt.org/ \u5b98\u65b9\u6587\u6863\uff1a http://www.scala-sbt.org/0.13/docs/zh-cn/index.html github: https://github.com/sbt/sbt","title":"\u8bf4\u660e"},{"location":"roles/env/sbt/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/sbt/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/sbt/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" sbt_version: \"0.13.15\" sbt_file: \"sbt-{{ sbt_version }}.tgz\" sbt_file_path: \"{{ software_files_path }}/{{ sbt_file }}\" sbt_install_path: \"{{ software_install_path }}/apache-maven-{{ mvn_version }}\" sbt_file_url: \"https://downloads.lightbend.com/sbt/{{ sbt_version }}/{{ sbt_file }}\" sbt_maven: \"http://maven.aliyun.com/nexus/content/groups/public/\" sbt_typesafe: \"http://dl.bintray.com/typesafe/ivy-releases/\" sbt_ivy_plugin: \"http://dl.bintray.com/sbt/sbt-plugin-releases/\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/sbt/#_5","text":"Java 1.6+","title":"\u4f9d\u8d56"},{"location":"roles/env/sbt/#github","text":"https://github.com/lework/Ansible-roles/tree/master/sbt","title":"github\u5730\u5740"},{"location":"roles/env/sbt/#example-playbook","text":"- hosts: node1 roles: - sbt - hosts: node1 roles: - { role: sbt, sbt_version: '0.13.15' }","title":"Example Playbook"},{"location":"roles/env/ssh-2fa/","text":"Ansible Role: ssh-2fa \u00b6 \u5f00\u542f SSH \u7684\u53cc\u56e0\u5b50\u8ba4\u8bc1\u767b\u5f55 \u4ecb\u7ecd \u00b6 \u4f7f\u7528 Google Authenticator \u6765\u5b9e\u73b0 SSH \u7684\u53cc\u56e0\u5b50\u8ba4\u8bc1\u767b\u5f55 \u5b98\u65b9\u7f51\u7ad9\uff1a https://github.com/google/google-authenticator-libpam \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u5728Debian\u548cRHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 6, Centos 7, Debian 9 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path : \"/opt/software\" google_authenticator_version : \"1.08\" google_authenticator_file : \"google-authenticator-libpam-{{ google_authenticator_version }}.tar.gz\" google_authenticator_file_path : \"{{ software_files_path }}/{{ google_authenticator_file }}\" google_authenticator_file_url : \"https://github.com/google/google-authenticator-libpam/archive/{{ google_authenticator_version }}.tar.gz\" google_authenticator_step_size : 30 google_authenticator_rate_limit : 3 google_authenticator_rate_time : 30 google_authenticator_command : | google-authenticator \\ --time-based \\ --step-size={{ google_authenticator_step_size }} \\ --rate-limit={{ google_authenticator_rate_limit }} \\ --rate-time={{ google_authenticator_rate_time }} \\ --minimal-window \\ --disallow-reuse \\ --force \\ --quiet google_authenticator_user : \"{{ ansible_user_id | d('root')}}\" google_authenticator_pam : /usr/local/lib/security/pam_google_authenticator.so \u4f9d\u8d56 \u00b6 chrony github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/ssh-2fa Example Playbook \u00b6 # \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - chrony - ssh-2fa # \u6307\u5b9a\u8ba4\u8bc1\u7684\u7528\u6237 - hosts : node1 vars : google_authenticator_user : test roles : - chrony - ssh-2fa","title":"ssh-2fa"},{"location":"roles/env/ssh-2fa/#ansible-role-ssh-2fa","text":"\u5f00\u542f SSH \u7684\u53cc\u56e0\u5b50\u8ba4\u8bc1\u767b\u5f55","title":"Ansible Role: ssh-2fa"},{"location":"roles/env/ssh-2fa/#_1","text":"\u4f7f\u7528 Google Authenticator \u6765\u5b9e\u73b0 SSH \u7684\u53cc\u56e0\u5b50\u8ba4\u8bc1\u767b\u5f55 \u5b98\u65b9\u7f51\u7ad9\uff1a https://github.com/google/google-authenticator-libpam","title":"\u4ecb\u7ecd"},{"location":"roles/env/ssh-2fa/#_2","text":"\u6b64\u89d2\u8272\u5728Debian\u548cRHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/ssh-2fa/#_3","text":"ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 6, Centos 7, Debian 9","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/ssh-2fa/#_4","text":"software_files_path : \"/opt/software\" google_authenticator_version : \"1.08\" google_authenticator_file : \"google-authenticator-libpam-{{ google_authenticator_version }}.tar.gz\" google_authenticator_file_path : \"{{ software_files_path }}/{{ google_authenticator_file }}\" google_authenticator_file_url : \"https://github.com/google/google-authenticator-libpam/archive/{{ google_authenticator_version }}.tar.gz\" google_authenticator_step_size : 30 google_authenticator_rate_limit : 3 google_authenticator_rate_time : 30 google_authenticator_command : | google-authenticator \\ --time-based \\ --step-size={{ google_authenticator_step_size }} \\ --rate-limit={{ google_authenticator_rate_limit }} \\ --rate-time={{ google_authenticator_rate_time }} \\ --minimal-window \\ --disallow-reuse \\ --force \\ --quiet google_authenticator_user : \"{{ ansible_user_id | d('root')}}\" google_authenticator_pam : /usr/local/lib/security/pam_google_authenticator.so","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/ssh-2fa/#_5","text":"chrony","title":"\u4f9d\u8d56"},{"location":"roles/env/ssh-2fa/#github","text":"https://github.com/lework/Ansible-roles/tree/master/ssh-2fa","title":"github\u5730\u5740"},{"location":"roles/env/ssh-2fa/#example-playbook","text":"# \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - chrony - ssh-2fa # \u6307\u5b9a\u8ba4\u8bc1\u7684\u7528\u6237 - hosts : node1 vars : google_authenticator_user : test roles : - chrony - ssh-2fa","title":"Example Playbook"},{"location":"roles/env/ssh-keys/","text":"Ansible Role: ssh keys \u00b6 \u5728\u4e3b\u673a\u4e4b\u95f4\u5b9e\u73b0\u514d\u5bc6\u7801\u767b\u5f55\u3002 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.4.2.0 os Centos 6.7 X64 python 2.7.5 \u89d2\u8272\u53d8\u91cf \u00b6 ssh_keys_host \u8bbe\u7f6e\u6307\u5b9a\u4e3b\u673a\u7684ip\u5730\u5740 \u4f9d\u8d56 \u00b6 ssh github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/ssh-keys Example Playbook \u00b6 \u5b9e\u73b0\u5404\u4e3b\u673a\u4e4b\u95f4\u514d\u5bc6\u7801\u767b\u5f55 - hosts: node1 node2 node3 roles: - ssh-keys \u5b9e\u73b0\u6307\u5b9a\u4e3b\u673a(ssh_keys_host)\u514d\u5bc6\u7801\u767b\u5f55\u5176\u4ed6\u4e3b\u673a,\u6307\u5b9a\u4e3b\u673a\u5fc5\u987b\u4e3a\u6b64\u6b21\u6267\u884c\u4e3b\u673a\u4e2d\u7684\u4e00\u4e2a - hosts: node1 node2 node3 roles: - { role: ssh-keys, ssh_keys_host: '192.168.77.129' }","title":"ssh-keys"},{"location":"roles/env/ssh-keys/#ansible-role-ssh-keys","text":"\u5728\u4e3b\u673a\u4e4b\u95f4\u5b9e\u73b0\u514d\u5bc6\u7801\u767b\u5f55\u3002","title":"Ansible Role: ssh keys"},{"location":"roles/env/ssh-keys/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/ssh-keys/#_2","text":"ansible 2.4.2.0 os Centos 6.7 X64 python 2.7.5","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/ssh-keys/#_3","text":"ssh_keys_host \u8bbe\u7f6e\u6307\u5b9a\u4e3b\u673a\u7684ip\u5730\u5740","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/ssh-keys/#_4","text":"ssh","title":"\u4f9d\u8d56"},{"location":"roles/env/ssh-keys/#github","text":"https://github.com/lework/Ansible-roles/tree/master/ssh-keys","title":"github\u5730\u5740"},{"location":"roles/env/ssh-keys/#example-playbook","text":"\u5b9e\u73b0\u5404\u4e3b\u673a\u4e4b\u95f4\u514d\u5bc6\u7801\u767b\u5f55 - hosts: node1 node2 node3 roles: - ssh-keys \u5b9e\u73b0\u6307\u5b9a\u4e3b\u673a(ssh_keys_host)\u514d\u5bc6\u7801\u767b\u5f55\u5176\u4ed6\u4e3b\u673a,\u6307\u5b9a\u4e3b\u673a\u5fc5\u987b\u4e3a\u6b64\u6b21\u6267\u884c\u4e3b\u673a\u4e2d\u7684\u4e00\u4e2a - hosts: node1 node2 node3 roles: - { role: ssh-keys, ssh_keys_host: '192.168.77.129' }","title":"Example Playbook"},{"location":"roles/env/update-kernel/","text":"Ansible Role: update-kernel \u00b6 \u5347\u7ea7centos6,7,8\u5185\u6838 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.8.1 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 update_kernel_repo_rpm: \"\" update_kernel_repo_key: \"https://www.elrepo.org/RPM-GPG-KEY-elrepo.org\" update_kernel_reboot: true \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/update-kernel Example Playbook \u00b6 - hosts: node1 roles: - update-kernel","title":"update-kernel"},{"location":"roles/env/update-kernel/#ansible-role-update-kernel","text":"\u5347\u7ea7centos6,7,8\u5185\u6838","title":"Ansible Role: update-kernel"},{"location":"roles/env/update-kernel/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/env/update-kernel/#_2","text":"ansible 2.8.1 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/env/update-kernel/#_3","text":"update_kernel_repo_rpm: \"\" update_kernel_repo_key: \"https://www.elrepo.org/RPM-GPG-KEY-elrepo.org\" update_kernel_reboot: true","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/env/update-kernel/#_4","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/env/update-kernel/#github","text":"https://github.com/lework/Ansible-roles/tree/master/update-kernel","title":"github\u5730\u5740"},{"location":"roles/env/update-kernel/#example-playbook","text":"- hosts: node1 roles: - update-kernel","title":"Example Playbook"},{"location":"roles/ha/keepalived/","text":"Ansible Role: Keepalived \u00b6 \u5b89\u88c5Keepalived \u4ecb\u7ecd \u00b6 Keepalived\u662f\u4e00\u4e2a\u7528C\u7f16\u5199\u7684\u8def\u7531\u8f6f\u4ef6\u3002\u8be5\u9879\u76ee\u7684\u4e3b\u8981\u76ee\u6807\u662f\u4e3aLinux\u7cfb\u7edf\u548c\u57fa\u4e8eLinux\u7684\u57fa\u7840\u67b6\u6784\u63d0\u4f9b\u7b80\u5355\u800c\u5f3a\u5927\u7684\u8d1f\u8f7d\u5e73\u8861\u548c\u9ad8\u53ef\u7528\u6027\u8bbe\u65bd\u3002\u8d1f\u8f7d\u5e73\u8861\u6846\u67b6\u4f9d\u8d56\u4e8e\u4f17\u6240\u5468\u77e5\u4e14\u5e7f\u6cdb\u4f7f\u7528\u7684Linux\u865a\u62df\u670d\u52a1\u5668\uff08IPVS\uff09\u5185\u6838\u6a21\u5757\uff0c\u63d0\u4f9bLayer4\u8d1f\u8f7d\u5747\u8861\u3002 Keepalived\u5b9e\u73b0\u4e86\u4e00\u7ec4\u68c0\u67e5\u7a0b\u5e8f\uff0c\u4ee5\u6839\u636e\u5176\u5065\u5eb7\u72b6\u51b5\u52a8\u6001\u5730\u548c\u81ea\u9002\u5e94\u5730\u7ef4\u62a4\u548c\u7ba1\u7406\u8d1f\u8f7d\u5e73\u8861\u7684\u670d\u52a1\u5668\u6c60\u3002\u53e6\u4e00\u65b9\u9762\uff0cVRRP\u534f\u8bae\u5b9e\u73b0\u4e86\u9ad8\u53ef\u7528\u6027\u3002 VRRP\u662f\u8def\u7531\u5668\u6545\u969c\u8f6c\u79fb\u7684\u57fa\u7840\u3002\u6b64\u5916\uff0cKeepalived\u4e3aVRRP\u6709\u9650\u72b6\u6001\u673a\u5b9e\u73b0\u4e86\u4e00\u7ec4\u6302\u94a9\uff0c\u63d0\u4f9b\u4f4e\u7ea7\u548c\u9ad8\u901f\u534f\u8bae\u4ea4\u4e92\u3002\u4e3a\u4e86\u63d0\u4f9b\u6700\u5feb\u7684\u7f51\u7edc\u6545\u969c\u68c0\u6d4b\uff0cKeepalived\u5b9e\u73b0\u4e86BFD\u534f\u8bae\u3002 VRRP\u72b6\u6001\u8f6c\u6362\u53ef\u4ee5\u8003\u8651BFD\u63d0\u793a\u6765\u9a71\u52a8\u5feb\u901f\u72b6\u6001\u8f6c\u6362\u3002 Keepalived\u6846\u67b6\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u63d0\u4f9b\u7075\u6d3b\u7684\u57fa\u7840\u67b6\u6784\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://www.keepalived.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.keepalived.org/manpage.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.7.10 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 keepalived_conf: \"/etc/keepalived/keepalived.conf\" keepalived_vrrp_instance: - name: V1_1 state: \"MASTER\" interface: \"eth0\" virtual_router_id: \"26\" priority: \"100\" auth_pass: \"261232\" keepalived_vip: \"192.168.77.140\" extra: | ! vrrp_instance extra conf keepalived_virtual_server: # - virtual_server: \"192.168.200.100 80\" # delay_loop: 6 # lb_algo: wrr # lb_kind: NAT # persistence_timeout: 50 # protocol: TCP # real_server: # - server: \"192.168.201.100 80\" # weight: 1 # tcp_check: # connect_timeout: 10 # nb_get_retry: 3 # delay_before_retry: 3 # connect_port: 80 # extra: | # ! real_server extra conf # extra: | # ! virtual_server extra conf keepalived_conf_extra: \"\" \u4f9d\u8d56 \u00b6 epel github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/keepalived Example Playbook \u00b6 \u5355\u4e3b - hosts: node1 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"MASTER\" vip: \"192.168.77.140\" roles: - { role: keepalived } - hosts: node2 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"BACKUP\" vip: \"192.168.77.140\" roles: - { role: keepalived} \u5355\u4e3b\u5355\u64ad - hosts: node1 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"MASTER\" vip: \"192.168.77.140\" unicast_peer: \"192.168.77.131\" roles: - { role: keepalived } - hosts: node2 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"BACKUP\" vip: \"192.168.77.140\" unicast_peer: \"192.168.77.130\" roles: - { role: keepalived} \u5355\u4e3blvs - hosts: node1 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"MASTER\" vip: \"192.168.77.140\" - keepalived_virtual_server: - virtual_server: \"192.168.77.140 80\" delay_loop: 6 lb_algo: wrr lb_kind: DR persistence_timeout: 50 real_server: - server: \"192.168.77.132 80\" weight: 1 tcp_check: connect_timeout: 10 nb_get_retry: 3 delay_before_retry: 3 connect_port: 80 - server: \"192.168.77.133 80\" weight: 1 tcp_check: connect_timeout: 10 nb_get_retry: 3 delay_before_retry: 3 connect_port: 80 roles: - { role: keepalived } - hosts: node2 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"BACKUP\" vip: \"192.168.77.140\" - keepalived_virtual_server: - virtual_server: \"192.168.77.140 80\" delay_loop: 6 lb_algo: wrr lb_kind: DR persistence_timeout: 50 real_server: - server: \"192.168.77.132 80\" weight: 1 tcp_check: connect_timeout: 10 nb_get_retry: 3 delay_before_retry: 3 connect_port: 80 - server: \"192.168.77.133 80\" weight: 1 tcp_check: connect_timeout: 10 nb_get_retry: 3 delay_before_retry: 3 connect_port: 80 roles: - { role: keepalived} \u53cc\u4e3b - hosts: node1 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"MASTER\" vip: \"192.168.77.140\" - name: V1_2 state: \"BACKUP\" virtual_router_id: \"141\" auth_pass: \"v2hello\" vip: \"192.168.77.141\" roles: - { role: keepalived } - hosts: node2 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"BACKUP\" vip: \"192.168.77.140\" - name: V1_2 state: \"MASTER\" auth_pass: \"v2hello\" virtual_router_id: \"141\" vip: \"192.168.77.141\" roles: - { role: keepalived} \u4f7f\u7528 \u00b6 systemctl start keepalived systemctl stop keepalived systemctl restart keepalived systemctl status keepalived","title":"keepalived"},{"location":"roles/ha/keepalived/#ansible-role-keepalived","text":"\u5b89\u88c5Keepalived","title":"Ansible Role: Keepalived"},{"location":"roles/ha/keepalived/#_1","text":"Keepalived\u662f\u4e00\u4e2a\u7528C\u7f16\u5199\u7684\u8def\u7531\u8f6f\u4ef6\u3002\u8be5\u9879\u76ee\u7684\u4e3b\u8981\u76ee\u6807\u662f\u4e3aLinux\u7cfb\u7edf\u548c\u57fa\u4e8eLinux\u7684\u57fa\u7840\u67b6\u6784\u63d0\u4f9b\u7b80\u5355\u800c\u5f3a\u5927\u7684\u8d1f\u8f7d\u5e73\u8861\u548c\u9ad8\u53ef\u7528\u6027\u8bbe\u65bd\u3002\u8d1f\u8f7d\u5e73\u8861\u6846\u67b6\u4f9d\u8d56\u4e8e\u4f17\u6240\u5468\u77e5\u4e14\u5e7f\u6cdb\u4f7f\u7528\u7684Linux\u865a\u62df\u670d\u52a1\u5668\uff08IPVS\uff09\u5185\u6838\u6a21\u5757\uff0c\u63d0\u4f9bLayer4\u8d1f\u8f7d\u5747\u8861\u3002 Keepalived\u5b9e\u73b0\u4e86\u4e00\u7ec4\u68c0\u67e5\u7a0b\u5e8f\uff0c\u4ee5\u6839\u636e\u5176\u5065\u5eb7\u72b6\u51b5\u52a8\u6001\u5730\u548c\u81ea\u9002\u5e94\u5730\u7ef4\u62a4\u548c\u7ba1\u7406\u8d1f\u8f7d\u5e73\u8861\u7684\u670d\u52a1\u5668\u6c60\u3002\u53e6\u4e00\u65b9\u9762\uff0cVRRP\u534f\u8bae\u5b9e\u73b0\u4e86\u9ad8\u53ef\u7528\u6027\u3002 VRRP\u662f\u8def\u7531\u5668\u6545\u969c\u8f6c\u79fb\u7684\u57fa\u7840\u3002\u6b64\u5916\uff0cKeepalived\u4e3aVRRP\u6709\u9650\u72b6\u6001\u673a\u5b9e\u73b0\u4e86\u4e00\u7ec4\u6302\u94a9\uff0c\u63d0\u4f9b\u4f4e\u7ea7\u548c\u9ad8\u901f\u534f\u8bae\u4ea4\u4e92\u3002\u4e3a\u4e86\u63d0\u4f9b\u6700\u5feb\u7684\u7f51\u7edc\u6545\u969c\u68c0\u6d4b\uff0cKeepalived\u5b9e\u73b0\u4e86BFD\u534f\u8bae\u3002 VRRP\u72b6\u6001\u8f6c\u6362\u53ef\u4ee5\u8003\u8651BFD\u63d0\u793a\u6765\u9a71\u52a8\u5feb\u901f\u72b6\u6001\u8f6c\u6362\u3002 Keepalived\u6846\u67b6\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u63d0\u4f9b\u7075\u6d3b\u7684\u57fa\u7840\u67b6\u6784\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://www.keepalived.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.keepalived.org/manpage.html","title":"\u4ecb\u7ecd"},{"location":"roles/ha/keepalived/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/ha/keepalived/#_3","text":"ansible 2.7.10 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/ha/keepalived/#_4","text":"keepalived_conf: \"/etc/keepalived/keepalived.conf\" keepalived_vrrp_instance: - name: V1_1 state: \"MASTER\" interface: \"eth0\" virtual_router_id: \"26\" priority: \"100\" auth_pass: \"261232\" keepalived_vip: \"192.168.77.140\" extra: | ! vrrp_instance extra conf keepalived_virtual_server: # - virtual_server: \"192.168.200.100 80\" # delay_loop: 6 # lb_algo: wrr # lb_kind: NAT # persistence_timeout: 50 # protocol: TCP # real_server: # - server: \"192.168.201.100 80\" # weight: 1 # tcp_check: # connect_timeout: 10 # nb_get_retry: 3 # delay_before_retry: 3 # connect_port: 80 # extra: | # ! real_server extra conf # extra: | # ! virtual_server extra conf keepalived_conf_extra: \"\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/ha/keepalived/#_5","text":"epel","title":"\u4f9d\u8d56"},{"location":"roles/ha/keepalived/#github","text":"https://github.com/lework/Ansible-roles/tree/master/keepalived","title":"github\u5730\u5740"},{"location":"roles/ha/keepalived/#example-playbook","text":"\u5355\u4e3b - hosts: node1 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"MASTER\" vip: \"192.168.77.140\" roles: - { role: keepalived } - hosts: node2 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"BACKUP\" vip: \"192.168.77.140\" roles: - { role: keepalived} \u5355\u4e3b\u5355\u64ad - hosts: node1 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"MASTER\" vip: \"192.168.77.140\" unicast_peer: \"192.168.77.131\" roles: - { role: keepalived } - hosts: node2 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"BACKUP\" vip: \"192.168.77.140\" unicast_peer: \"192.168.77.130\" roles: - { role: keepalived} \u5355\u4e3blvs - hosts: node1 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"MASTER\" vip: \"192.168.77.140\" - keepalived_virtual_server: - virtual_server: \"192.168.77.140 80\" delay_loop: 6 lb_algo: wrr lb_kind: DR persistence_timeout: 50 real_server: - server: \"192.168.77.132 80\" weight: 1 tcp_check: connect_timeout: 10 nb_get_retry: 3 delay_before_retry: 3 connect_port: 80 - server: \"192.168.77.133 80\" weight: 1 tcp_check: connect_timeout: 10 nb_get_retry: 3 delay_before_retry: 3 connect_port: 80 roles: - { role: keepalived } - hosts: node2 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"BACKUP\" vip: \"192.168.77.140\" - keepalived_virtual_server: - virtual_server: \"192.168.77.140 80\" delay_loop: 6 lb_algo: wrr lb_kind: DR persistence_timeout: 50 real_server: - server: \"192.168.77.132 80\" weight: 1 tcp_check: connect_timeout: 10 nb_get_retry: 3 delay_before_retry: 3 connect_port: 80 - server: \"192.168.77.133 80\" weight: 1 tcp_check: connect_timeout: 10 nb_get_retry: 3 delay_before_retry: 3 connect_port: 80 roles: - { role: keepalived} \u53cc\u4e3b - hosts: node1 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"MASTER\" vip: \"192.168.77.140\" - name: V1_2 state: \"BACKUP\" virtual_router_id: \"141\" auth_pass: \"v2hello\" vip: \"192.168.77.141\" roles: - { role: keepalived } - hosts: node2 vars: - keepalived_vrrp_instance: - name: V1_1 state: \"BACKUP\" vip: \"192.168.77.140\" - name: V1_2 state: \"MASTER\" auth_pass: \"v2hello\" virtual_router_id: \"141\" vip: \"192.168.77.141\" roles: - { role: keepalived}","title":"Example Playbook"},{"location":"roles/ha/keepalived/#_6","text":"systemctl start keepalived systemctl stop keepalived systemctl restart keepalived systemctl status keepalived","title":"\u4f7f\u7528"},{"location":"roles/kv/consul/","text":"Ansible Role: consul \u00b6 \u5b89\u88c5consul \u4ecb\u7ecd \u00b6 consul\u662fHashiCorp\u516c\u53f8\u63a8\u51fa\u7684\u4e00\u6b3e\u5f00\u6e90\u5de5\u5177\uff0c\u7528\u4e8e\u5b9e\u73b0\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u670d\u52a1\u53d1\u73b0\u4e0e\u914d\u7f6e\u3002\u4e0e\u5176\u4ed6\u7c7b\u4f3c\u4ea7\u54c1\u76f8\u6bd4\uff0c\u63d0\u4f9b\u66f4\u201c\u4e00\u7ad9\u5f0f\u201d\u7684\u89e3\u51b3\u65b9\u6848\u3002consul\u5185\u7f6e\u6709KV\u5b58\u50a8\uff0c\u670d\u52a1\u6ce8\u518c/\u53d1\u73b0\uff0c\u5065\u5eb7\u68c0\u67e5\uff0cHTTP+DNS API\uff0cWeb UI\u7b49\u591a\u79cd\u529f\u80fd\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.consul.io/ github: https://github.com/hashicorp/consul \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.consul.io/docs \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" consul_version: \"0.7.5\" consul_file: \"consul_{{ consul_version }}_linux_amd64.zip\" consul_file_path: \"{{ software_files_path }}/{{ consul_file }}\" consul_file_url: \"https://releases.hashicorp.com/consul/{{ consul_version }}/{{ consul_file }}\" consul_user: \"consul\" consul_server_port: 8300 consul_rpc_port: 8400 consul_http_port: 8500 consul_dns_port: 8600 consul_ip_bind: \"{{ ansible_default_ipv4.address }}\" consul_client_bind: \"0.0.0.0\" consul_home: \"/consul_data\" consul_datadir: \"{{ consul_home }}/data\" consul_confdir: \"{{ consul_home }}/conf\" consul_dc: \"dc1\" consul_loglevel: \"INFO\" consul_server: true consul_ui: true consul_nodename: \"{{ ansible_hostname }}\" consul_bootstrap_expect: 1 consul_bootstrap: false consul_dev: false consul_encrypt: false consul_start_join: [] \u4f9d\u8d56 \u00b6 supervisor github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/consul Example Playbook \u00b6 \u5b89\u88c5consul\uff1a - hosts: 192.168.77.129 vars: supervisor_name: consul supervisor_stopsignal: INT supervisor_program: - { name: 'consul', command: 'consul agent -config-file /consul_data/conf/basic_config.json', user: 'consul' } roles: - { role: consul } - { role: python2.7 } - { role: supervisor } \u5206\u5e03\u5f0f\u5b89\u88c5\uff1a \u7aef\u53e3\u9ed8\u8ba4 - hosts: 192.168.77.129 roles: - { role: consul, consul_bootstrap: true } - hosts: 192.168.77.130 192.168.77.131 roles: - { role: consul, consul_bootstrap_expect: false, consul_start_join: [\"192.168.77.129\"]} - hosts: 192.168.77.132 roles: - { role: consul, consul_server: false, consul_start_join: [\"192.168.77.129\"]} - hosts: all vars: supervisor_name: consul supervisor_stopsignal: INT supervisor_program: - { name: 'consul', command: 'consul agent -config-file /consul_data/conf/basic_config.json', user: 'consul' } roles: - { role: python2.7 } - { role: supervisor }","title":"consul"},{"location":"roles/kv/consul/#ansible-role-consul","text":"\u5b89\u88c5consul","title":"Ansible Role: consul"},{"location":"roles/kv/consul/#_1","text":"consul\u662fHashiCorp\u516c\u53f8\u63a8\u51fa\u7684\u4e00\u6b3e\u5f00\u6e90\u5de5\u5177\uff0c\u7528\u4e8e\u5b9e\u73b0\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u670d\u52a1\u53d1\u73b0\u4e0e\u914d\u7f6e\u3002\u4e0e\u5176\u4ed6\u7c7b\u4f3c\u4ea7\u54c1\u76f8\u6bd4\uff0c\u63d0\u4f9b\u66f4\u201c\u4e00\u7ad9\u5f0f\u201d\u7684\u89e3\u51b3\u65b9\u6848\u3002consul\u5185\u7f6e\u6709KV\u5b58\u50a8\uff0c\u670d\u52a1\u6ce8\u518c/\u53d1\u73b0\uff0c\u5065\u5eb7\u68c0\u67e5\uff0cHTTP+DNS API\uff0cWeb UI\u7b49\u591a\u79cd\u529f\u80fd\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.consul.io/ github: https://github.com/hashicorp/consul \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.consul.io/docs","title":"\u4ecb\u7ecd"},{"location":"roles/kv/consul/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/kv/consul/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/kv/consul/#_4","text":"software_files_path: \"/opt/software\" consul_version: \"0.7.5\" consul_file: \"consul_{{ consul_version }}_linux_amd64.zip\" consul_file_path: \"{{ software_files_path }}/{{ consul_file }}\" consul_file_url: \"https://releases.hashicorp.com/consul/{{ consul_version }}/{{ consul_file }}\" consul_user: \"consul\" consul_server_port: 8300 consul_rpc_port: 8400 consul_http_port: 8500 consul_dns_port: 8600 consul_ip_bind: \"{{ ansible_default_ipv4.address }}\" consul_client_bind: \"0.0.0.0\" consul_home: \"/consul_data\" consul_datadir: \"{{ consul_home }}/data\" consul_confdir: \"{{ consul_home }}/conf\" consul_dc: \"dc1\" consul_loglevel: \"INFO\" consul_server: true consul_ui: true consul_nodename: \"{{ ansible_hostname }}\" consul_bootstrap_expect: 1 consul_bootstrap: false consul_dev: false consul_encrypt: false consul_start_join: []","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/kv/consul/#_5","text":"supervisor","title":"\u4f9d\u8d56"},{"location":"roles/kv/consul/#github","text":"https://github.com/lework/Ansible-roles/tree/master/consul","title":"github\u5730\u5740"},{"location":"roles/kv/consul/#example-playbook","text":"\u5b89\u88c5consul\uff1a - hosts: 192.168.77.129 vars: supervisor_name: consul supervisor_stopsignal: INT supervisor_program: - { name: 'consul', command: 'consul agent -config-file /consul_data/conf/basic_config.json', user: 'consul' } roles: - { role: consul } - { role: python2.7 } - { role: supervisor } \u5206\u5e03\u5f0f\u5b89\u88c5\uff1a \u7aef\u53e3\u9ed8\u8ba4 - hosts: 192.168.77.129 roles: - { role: consul, consul_bootstrap: true } - hosts: 192.168.77.130 192.168.77.131 roles: - { role: consul, consul_bootstrap_expect: false, consul_start_join: [\"192.168.77.129\"]} - hosts: 192.168.77.132 roles: - { role: consul, consul_server: false, consul_start_join: [\"192.168.77.129\"]} - hosts: all vars: supervisor_name: consul supervisor_stopsignal: INT supervisor_program: - { name: 'consul', command: 'consul agent -config-file /consul_data/conf/basic_config.json', user: 'consul' } roles: - { role: python2.7 } - { role: supervisor }","title":"Example Playbook"},{"location":"roles/kv/etcd/","text":"Ansible Role: etcd \u00b6 \u5b89\u88c5etcd \u4ecb\u7ecd \u00b6 etcd\u662f\u4e00\u4e2a\u9ad8\u53ef\u7528\u7684\u952e\u503c\u5b58\u50a8\u7cfb\u7edf\uff0c\u4e3b\u8981\u7528\u4e8e\u5171\u4eab\u914d\u7f6e\u548c\u670d\u52a1\u53d1\u73b0\u3002etcd\u662f\u7531CoreOS\u5f00\u53d1\u5e76\u7ef4\u62a4\u7684\uff0c\u7075\u611f\u6765\u81ea\u4e8e ZooKeeper \u548c Doozer\uff0c\u5b83\u4f7f\u7528Go\u8bed\u8a00\u7f16\u5199\uff0c\u5e76\u901a\u8fc7Raft\u4e00\u81f4\u6027\u7b97\u6cd5\u5904\u7406\u65e5\u5fd7\u590d\u5236\u4ee5\u4fdd\u8bc1\u5f3a\u4e00\u81f4\u6027\u3002Raft\u662f\u4e00\u4e2a\u6765\u81eaStanford\u7684\u65b0\u7684\u4e00\u81f4\u6027\u7b97\u6cd5\uff0c\u9002\u7528\u4e8e\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u65e5\u5fd7\u590d\u5236\uff0cRaft\u901a\u8fc7\u9009\u4e3e\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u4e00\u81f4\u6027\uff0c\u5728Raft\u4e2d\uff0c\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u90fd\u53ef\u80fd\u6210\u4e3aLeader\u3002Google\u7684\u5bb9\u5668\u96c6\u7fa4\u7ba1\u7406\u7cfb\u7edfKubernetes\u3001\u5f00\u6e90PaaS\u5e73\u53f0Cloud Foundry\u548cCoreOS\u7684Fleet\u90fd\u5e7f\u6cdb\u4f7f\u7528\u4e86etcd\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://coreos.com/etcd/ github: https://github.com/coreos/etcd \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://coreos.com/etcd/docs/latest \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.4.2.0 os Centos 7.4 X64 python 2.7.5 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" etcd_version: \"3.3.2\" etcd_file: \"etcd-v{{ etcd_version }}-linux-amd64.tar.gz\" etcd_file_path: \"{{ software_files_path }}/{{ etcd_file }}\" etcd_file_url: \"https://github.com/coreos/etcd/releases/download/etcd-v{{ etcd_version }}/{{ etcd_file }}\" etcd_port: 2379 etcd_peer_port: 2380 etcd_home: \"/etcd_data\" etcd_datadir: \"{{ etcd_home }}/{{ etcd_port }}/data\" etcd_confdir: \"{{ etcd_home }}/{{ etcd_port }}/conf\" etcd_wardir: \"{{ etcd_home }}/{{ etcd_port }}/war\" etcd_user: \"etcd\" etcd_name: \"infra0\" etcd_service_name: \"etcd{% if etcd_port != 2379 %}{{ etcd_port }}{% endif %}\" etcd_initial_advertise_peer_urls: \"http://{{ ansible_default_ipv4.address }}:{{ etcd_peer_port }}\" etcd_listen_peer_urls: \"http://{{ ansible_default_ipv4.address }}:{{ etcd_peer_port }}\" etcd_listen_client_urls: \"http://0.0.0.0:{{ etcd_port }}\" etcd_advertise_client_urls: \"http://{{ ansible_default_ipv4.address }}:{{ etcd_port }}\" etcd_trusted_ca_file: false etcd_cert_file: false etcd_key_file: false etcd_peer_trusted_ca_file: false etcd_peer_cert_file: false etcd_peer_key_file: false etcd_auto_tls: false etcd_discovery: false etcd_initial_cluster: false etcd_initial_cluster_token: \"etcd_cluster_1\" etcd_proxy: false etcd_force_new_cluster: false etcd_debug: false etcd_gomaxprocs: 1 \u4f9d\u8d56 \u00b6 go github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/etcd Example Playbook \u00b6 \u5b89\u88c5etcd\uff0c\u9ed8\u8ba4\u7aef\u53e32379\uff1a - hosts: node1 roles: - { role: etcd } \u5355\u673a\u4f2a\u96c6\u7fa4\u5b89\u88c5\uff1a - hosts: node1 vars: - etcd_initial_cluster: \"infra0=http://192.168.77.129:2380,infra1=http://192.168.77.129:2480,infra2=http://192.168.77.129:2580\" roles: - { role: etcd, etcd_name: \"infra0\", etcd_port: 2379, etcd_peer_port: 2380} - { role: etcd, etcd_name: \"infra1\", etcd_port: 2479, etcd_peer_port: 2480} - { role: etcd, etcd_name: \"infra2\", etcd_port: 2579, etcd_peer_port: 2580} \u5206\u5e03\u5f0f\u5b89\u88c5\uff1a \u7aef\u53e3\u9ed8\u8ba4 - hosts: node4 vars: - etcd_initial_cluster: \"infra0=http://192.168.77.133:2380,infra1=http://192.168.77.134:2380,infra2=http://192.168.77.135:2380\" roles: - { role: etcd, etcd_name: \"infra0\" } - hosts: node5 vars: - etcd_initial_cluster: \"infra0=http://192.168.77.133:2380,infra1=http://192.168.77.134:2380,infra2=http://192.168.77.135:2380\" roles: - { role: etcd, etcd_name: \"infra1\" } - hosts: node6 vars: - etcd_initial_cluster: \"infra0=http://192.168.77.133:2380,infra1=http://192.168.77.134:2380,infra2=http://192.168.77.135:2380\" roles: - { role: etcd, etcd_name: \"infra2\" } \u4f7f\u7528 \u00b6 \u542f\u52a8\u547d\u4ee4\uff1a systemctl start etcd","title":"etcd"},{"location":"roles/kv/etcd/#ansible-role-etcd","text":"\u5b89\u88c5etcd","title":"Ansible Role: etcd"},{"location":"roles/kv/etcd/#_1","text":"etcd\u662f\u4e00\u4e2a\u9ad8\u53ef\u7528\u7684\u952e\u503c\u5b58\u50a8\u7cfb\u7edf\uff0c\u4e3b\u8981\u7528\u4e8e\u5171\u4eab\u914d\u7f6e\u548c\u670d\u52a1\u53d1\u73b0\u3002etcd\u662f\u7531CoreOS\u5f00\u53d1\u5e76\u7ef4\u62a4\u7684\uff0c\u7075\u611f\u6765\u81ea\u4e8e ZooKeeper \u548c Doozer\uff0c\u5b83\u4f7f\u7528Go\u8bed\u8a00\u7f16\u5199\uff0c\u5e76\u901a\u8fc7Raft\u4e00\u81f4\u6027\u7b97\u6cd5\u5904\u7406\u65e5\u5fd7\u590d\u5236\u4ee5\u4fdd\u8bc1\u5f3a\u4e00\u81f4\u6027\u3002Raft\u662f\u4e00\u4e2a\u6765\u81eaStanford\u7684\u65b0\u7684\u4e00\u81f4\u6027\u7b97\u6cd5\uff0c\u9002\u7528\u4e8e\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u65e5\u5fd7\u590d\u5236\uff0cRaft\u901a\u8fc7\u9009\u4e3e\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u4e00\u81f4\u6027\uff0c\u5728Raft\u4e2d\uff0c\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u90fd\u53ef\u80fd\u6210\u4e3aLeader\u3002Google\u7684\u5bb9\u5668\u96c6\u7fa4\u7ba1\u7406\u7cfb\u7edfKubernetes\u3001\u5f00\u6e90PaaS\u5e73\u53f0Cloud Foundry\u548cCoreOS\u7684Fleet\u90fd\u5e7f\u6cdb\u4f7f\u7528\u4e86etcd\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://coreos.com/etcd/ github: https://github.com/coreos/etcd \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://coreos.com/etcd/docs/latest","title":"\u4ecb\u7ecd"},{"location":"roles/kv/etcd/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/kv/etcd/#_3","text":"ansible 2.4.2.0 os Centos 7.4 X64 python 2.7.5","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/kv/etcd/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" etcd_version: \"3.3.2\" etcd_file: \"etcd-v{{ etcd_version }}-linux-amd64.tar.gz\" etcd_file_path: \"{{ software_files_path }}/{{ etcd_file }}\" etcd_file_url: \"https://github.com/coreos/etcd/releases/download/etcd-v{{ etcd_version }}/{{ etcd_file }}\" etcd_port: 2379 etcd_peer_port: 2380 etcd_home: \"/etcd_data\" etcd_datadir: \"{{ etcd_home }}/{{ etcd_port }}/data\" etcd_confdir: \"{{ etcd_home }}/{{ etcd_port }}/conf\" etcd_wardir: \"{{ etcd_home }}/{{ etcd_port }}/war\" etcd_user: \"etcd\" etcd_name: \"infra0\" etcd_service_name: \"etcd{% if etcd_port != 2379 %}{{ etcd_port }}{% endif %}\" etcd_initial_advertise_peer_urls: \"http://{{ ansible_default_ipv4.address }}:{{ etcd_peer_port }}\" etcd_listen_peer_urls: \"http://{{ ansible_default_ipv4.address }}:{{ etcd_peer_port }}\" etcd_listen_client_urls: \"http://0.0.0.0:{{ etcd_port }}\" etcd_advertise_client_urls: \"http://{{ ansible_default_ipv4.address }}:{{ etcd_port }}\" etcd_trusted_ca_file: false etcd_cert_file: false etcd_key_file: false etcd_peer_trusted_ca_file: false etcd_peer_cert_file: false etcd_peer_key_file: false etcd_auto_tls: false etcd_discovery: false etcd_initial_cluster: false etcd_initial_cluster_token: \"etcd_cluster_1\" etcd_proxy: false etcd_force_new_cluster: false etcd_debug: false etcd_gomaxprocs: 1","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/kv/etcd/#_5","text":"go","title":"\u4f9d\u8d56"},{"location":"roles/kv/etcd/#github","text":"https://github.com/lework/Ansible-roles/tree/master/etcd","title":"github\u5730\u5740"},{"location":"roles/kv/etcd/#example-playbook","text":"\u5b89\u88c5etcd\uff0c\u9ed8\u8ba4\u7aef\u53e32379\uff1a - hosts: node1 roles: - { role: etcd } \u5355\u673a\u4f2a\u96c6\u7fa4\u5b89\u88c5\uff1a - hosts: node1 vars: - etcd_initial_cluster: \"infra0=http://192.168.77.129:2380,infra1=http://192.168.77.129:2480,infra2=http://192.168.77.129:2580\" roles: - { role: etcd, etcd_name: \"infra0\", etcd_port: 2379, etcd_peer_port: 2380} - { role: etcd, etcd_name: \"infra1\", etcd_port: 2479, etcd_peer_port: 2480} - { role: etcd, etcd_name: \"infra2\", etcd_port: 2579, etcd_peer_port: 2580} \u5206\u5e03\u5f0f\u5b89\u88c5\uff1a \u7aef\u53e3\u9ed8\u8ba4 - hosts: node4 vars: - etcd_initial_cluster: \"infra0=http://192.168.77.133:2380,infra1=http://192.168.77.134:2380,infra2=http://192.168.77.135:2380\" roles: - { role: etcd, etcd_name: \"infra0\" } - hosts: node5 vars: - etcd_initial_cluster: \"infra0=http://192.168.77.133:2380,infra1=http://192.168.77.134:2380,infra2=http://192.168.77.135:2380\" roles: - { role: etcd, etcd_name: \"infra1\" } - hosts: node6 vars: - etcd_initial_cluster: \"infra0=http://192.168.77.133:2380,infra1=http://192.168.77.134:2380,infra2=http://192.168.77.135:2380\" roles: - { role: etcd, etcd_name: \"infra2\" }","title":"Example Playbook"},{"location":"roles/kv/etcd/#_6","text":"\u542f\u52a8\u547d\u4ee4\uff1a systemctl start etcd","title":"\u4f7f\u7528"},{"location":"roles/kv/zookeeper/","text":"Ansible Role: zookeeper \u00b6 \u5b89\u88c5zookeeper \u4ecb\u7ecd \u00b6 ZooKeeper\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\uff0c\u5f00\u653e\u6e90\u7801\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u534f\u8c03\u670d\u52a1\uff0c\u662fGoogle\u7684Chubby\u4e00\u4e2a\u5f00\u6e90\u7684\u5b9e\u73b0\uff0c\u662fHadoop\u548cHbase\u7684\u91cd\u8981\u7ec4\u4ef6\u3002\u5b83\u662f\u4e00\u4e2a\u4e3a\u5206\u5e03\u5f0f\u5e94\u7528\u63d0\u4f9b\u4e00\u81f4\u6027\u670d\u52a1\u7684\u8f6f\u4ef6\uff0c\u63d0\u4f9b\u7684\u529f\u80fd\u5305\u62ec\uff1a\u914d\u7f6e\u7ef4\u62a4\u3001\u57df\u540d\u670d\u52a1\u3001\u5206\u5e03\u5f0f\u540c\u6b65\u3001\u7ec4\u670d\u52a1\u7b49\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://zookeeper.apache.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://zookeeper.apache.org/doc/trunk/index.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" zookeeper_version: \"3.4.9\" zookeeper_file: \"zookeeper-{{ zookeeper_version }}.tar.gz\" zookeeper_file_path: \"{{ software_files_path }}/{{ zookeeper_file }}\" zookeeper_file_url: \"http://mirror.bit.edu.cn/apache/zookeeper/zookeeper-{{ zookeeper_version }}/zookeeper-{{ zookeeper_version }}.tar.gz\" zookeeper_user: \"zookeeper\" zookeeper_port: 2181 zookeeper_name: \"zookeeper{{ zookeeper_port if zookeeper_port != 2181 else '' }}\" zookeeper_home: \"/zookeeper_data\" zookeeper_dir: \"{{ zookeeper_home }}/{{ zookeeper_port }}\" zookeeper_datadir: \"{{ zookeeper_home }}/{{ zookeeper_port }}/data\" zookeeper_datalogdir: \"{{ zookeeper_home }}/{{ zookeeper_port }}/logs\" zookeeper_hosts: - {'host': 127.0.0.1, 'port': 2181 ,'id': 1, 'leader_port': '2888:3888'} \u4f9d\u8d56 \u00b6 java github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/zookeeper Example Playbook \u00b6 \u5b89\u88c5zookeeper\uff0c\u9ed8\u8ba4\u7aef\u53e32181\uff1a - hosts: 192.168.77.129 roles: - { role: zookeeper } \u5355\u673a\u4f2a\u96c6\u7fa4\u5b89\u88c5\uff1a - hosts: 192.168.77.129 vars: - zookeeper_hosts: - {'host': 192.168.77.129, 'id': 1, 'port': 2181, 'leader_port': '2888:3888'} - {'host': 192.168.77.129, 'id': 2, 'port': 2182, 'leader_port': '2889:3889'} - {'host': 192.168.77.129, 'id': 3, 'port': 2183, 'leader_port': '2890:3890'} roles: - { role: zookeeper, zookeeper_port: 2181 } - { role: zookeeper, zookeeper_port: 2182 } - { role: zookeeper, zookeeper_port: 2183 } \u5206\u5e03\u5f0f\u5b89\u88c5\uff1a \u5168\u90e8\u9ed8\u8ba4 - hosts: 192.168.77.129 192.168.77.130 192.168.77.131 vars: - zookeeper_hosts: \"{{ play_hosts }}\" roles: - { role: zookeeper } \u6307\u5b9aid - hosts: 192.168.77.129 192.168.77.130 192.168.77.131 vars: - zookeeper_hosts: - {'host': 192.168.77.129, 'id': 1} - {'host': 192.168.77.130, 'id': 2} - {'host': 192.168.77.131, 'id': 3} roles: - { role: zookeeper} \u7aef\u53e3\u81ea\u5b9a\u4e49 - hosts: 192.168.77.129 192.168.77.130 192.168.77.131 vars: - zookeeper_hosts: - {'host': 192.168.77.129, 'id': 1, 'port': 2182, 'leader_port': '2889:3889'} - {'host': 192.168.77.130, 'id': 2, 'port': 2182, 'leader_port': '2889:3889'} - {'host': 192.168.77.131, 'id': 3, 'port': 2182, 'leader_port': '2889:3889'} roles: - { role: zookeeper, zookeeper_port: 2182} \u4f7f\u7528 \u00b6 /etc/init.d/zookeeper Usage: /etc/init.d/zookeeper {start|stop|status|sstatus|restart|condrestart} \u542f\u52a8\u547d\u4ee4\uff1a/etc/init.d/zookeeper start \u5173\u95ed\u547d\u4ee4\uff1a/etc/init.d/zookeeper stop \u67e5\u770b\u72b6\u6001\u547d\u4ee4\uff1a/etc/init.d/zookeeper sstatus \u5ba2\u6237\u7aef\u547d\u4ee4\uff1azkCli.sh -server localhost:2181","title":"zookeeper"},{"location":"roles/kv/zookeeper/#ansible-role-zookeeper","text":"\u5b89\u88c5zookeeper","title":"Ansible Role: zookeeper"},{"location":"roles/kv/zookeeper/#_1","text":"ZooKeeper\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\uff0c\u5f00\u653e\u6e90\u7801\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u534f\u8c03\u670d\u52a1\uff0c\u662fGoogle\u7684Chubby\u4e00\u4e2a\u5f00\u6e90\u7684\u5b9e\u73b0\uff0c\u662fHadoop\u548cHbase\u7684\u91cd\u8981\u7ec4\u4ef6\u3002\u5b83\u662f\u4e00\u4e2a\u4e3a\u5206\u5e03\u5f0f\u5e94\u7528\u63d0\u4f9b\u4e00\u81f4\u6027\u670d\u52a1\u7684\u8f6f\u4ef6\uff0c\u63d0\u4f9b\u7684\u529f\u80fd\u5305\u62ec\uff1a\u914d\u7f6e\u7ef4\u62a4\u3001\u57df\u540d\u670d\u52a1\u3001\u5206\u5e03\u5f0f\u540c\u6b65\u3001\u7ec4\u670d\u52a1\u7b49\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://zookeeper.apache.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://zookeeper.apache.org/doc/trunk/index.html","title":"\u4ecb\u7ecd"},{"location":"roles/kv/zookeeper/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/kv/zookeeper/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/kv/zookeeper/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" zookeeper_version: \"3.4.9\" zookeeper_file: \"zookeeper-{{ zookeeper_version }}.tar.gz\" zookeeper_file_path: \"{{ software_files_path }}/{{ zookeeper_file }}\" zookeeper_file_url: \"http://mirror.bit.edu.cn/apache/zookeeper/zookeeper-{{ zookeeper_version }}/zookeeper-{{ zookeeper_version }}.tar.gz\" zookeeper_user: \"zookeeper\" zookeeper_port: 2181 zookeeper_name: \"zookeeper{{ zookeeper_port if zookeeper_port != 2181 else '' }}\" zookeeper_home: \"/zookeeper_data\" zookeeper_dir: \"{{ zookeeper_home }}/{{ zookeeper_port }}\" zookeeper_datadir: \"{{ zookeeper_home }}/{{ zookeeper_port }}/data\" zookeeper_datalogdir: \"{{ zookeeper_home }}/{{ zookeeper_port }}/logs\" zookeeper_hosts: - {'host': 127.0.0.1, 'port': 2181 ,'id': 1, 'leader_port': '2888:3888'}","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/kv/zookeeper/#_5","text":"java","title":"\u4f9d\u8d56"},{"location":"roles/kv/zookeeper/#github","text":"https://github.com/lework/Ansible-roles/tree/master/zookeeper","title":"github\u5730\u5740"},{"location":"roles/kv/zookeeper/#example-playbook","text":"\u5b89\u88c5zookeeper\uff0c\u9ed8\u8ba4\u7aef\u53e32181\uff1a - hosts: 192.168.77.129 roles: - { role: zookeeper } \u5355\u673a\u4f2a\u96c6\u7fa4\u5b89\u88c5\uff1a - hosts: 192.168.77.129 vars: - zookeeper_hosts: - {'host': 192.168.77.129, 'id': 1, 'port': 2181, 'leader_port': '2888:3888'} - {'host': 192.168.77.129, 'id': 2, 'port': 2182, 'leader_port': '2889:3889'} - {'host': 192.168.77.129, 'id': 3, 'port': 2183, 'leader_port': '2890:3890'} roles: - { role: zookeeper, zookeeper_port: 2181 } - { role: zookeeper, zookeeper_port: 2182 } - { role: zookeeper, zookeeper_port: 2183 } \u5206\u5e03\u5f0f\u5b89\u88c5\uff1a \u5168\u90e8\u9ed8\u8ba4 - hosts: 192.168.77.129 192.168.77.130 192.168.77.131 vars: - zookeeper_hosts: \"{{ play_hosts }}\" roles: - { role: zookeeper } \u6307\u5b9aid - hosts: 192.168.77.129 192.168.77.130 192.168.77.131 vars: - zookeeper_hosts: - {'host': 192.168.77.129, 'id': 1} - {'host': 192.168.77.130, 'id': 2} - {'host': 192.168.77.131, 'id': 3} roles: - { role: zookeeper} \u7aef\u53e3\u81ea\u5b9a\u4e49 - hosts: 192.168.77.129 192.168.77.130 192.168.77.131 vars: - zookeeper_hosts: - {'host': 192.168.77.129, 'id': 1, 'port': 2182, 'leader_port': '2889:3889'} - {'host': 192.168.77.130, 'id': 2, 'port': 2182, 'leader_port': '2889:3889'} - {'host': 192.168.77.131, 'id': 3, 'port': 2182, 'leader_port': '2889:3889'} roles: - { role: zookeeper, zookeeper_port: 2182}","title":"Example Playbook"},{"location":"roles/kv/zookeeper/#_6","text":"/etc/init.d/zookeeper Usage: /etc/init.d/zookeeper {start|stop|status|sstatus|restart|condrestart} \u542f\u52a8\u547d\u4ee4\uff1a/etc/init.d/zookeeper start \u5173\u95ed\u547d\u4ee4\uff1a/etc/init.d/zookeeper stop \u67e5\u770b\u72b6\u6001\u547d\u4ee4\uff1a/etc/init.d/zookeeper sstatus \u5ba2\u6237\u7aef\u547d\u4ee4\uff1azkCli.sh -server localhost:2181","title":"\u4f7f\u7528"},{"location":"roles/log/elasticsearch/","text":"Ansible Role: elasticsearch \u00b6 \u5b89\u88c5elasticsearch\u96c6\u7fa4 \u4ecb\u7ecd \u00b6 ElasticSearch\u662f\u4e00\u4e2a\u57fa\u4e8eLucene\u7684\u641c\u7d22\u670d\u52a1\u5668\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5206\u5e03\u5f0f\u591a\u7528\u6237\u80fd\u529b\u7684\u5168\u6587\u641c\u7d22\u5f15\u64ce\uff0c\u57fa\u4e8eRESTful web\u63a5\u53e3\u3002Elasticsearch\u662f\u7528Java\u5f00\u53d1\u7684\uff0c\u5e76\u4f5c\u4e3aApache\u8bb8\u53ef\u6761\u6b3e\u4e0b\u7684\u5f00\u653e\u6e90\u7801\u53d1\u5e03\uff0c\u662f\u5f53\u524d\u6d41\u884c\u7684\u4f01\u4e1a\u7ea7\u641c\u7d22\u5f15\u64ce\u3002\u8bbe\u8ba1\u7528\u4e8e\u4e91\u8ba1\u7b97\u4e2d\uff0c\u80fd\u591f\u8fbe\u5230\u5b9e\u65f6\u641c\u7d22\uff0c\u7a33\u5b9a\uff0c\u53ef\u9760\uff0c\u5feb\u901f\uff0c\u5b89\u88c5\u4f7f\u7528\u65b9\u4fbf\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.elastic.co/products/elasticsearch github: https://github.com/elastic/elasticsearch \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" es_version: \"5.4.1\" es_file: \"elasticsearch-{{ es_version }}.tar.gz\" es_file_path: \"{{ software_files_path }}/{{ es_file }}\" es_file_url: \"https://artifacts.elastic.co/downloads/elasticsearch/{{ es_file }}\" es_user: elasticsearch es_group: elasticsearch es_http_host: \"0.0.0.0\" es_http_port: 9200 es_transport_port: 9300 es_max_open_files: 165535 es_max_map_count: 262155 es_max_processes: 4096 es_service_name: \"elasticsearch{% if es_http_port != 9200 %}{{ es_http_port }}{% endif %}\" es_service_start: false es_home_dir: \"/usr/local/elasticsearch\" es_pid_dir: \"/var/run/elasticsearch\" es_log_dir: \"/{{ es_service_name }}_data/logs\" es_conf_dir: \"/{{ es_service_name }}_data/config\" es_data_dir: \"/{{ es_service_name }}_data/data\" es_script_dir: \"/{{ es_service_name }}_data/scripts\" es_cluster_name: \"\" es_node_name: \"\" es_node_rack: \"\" es_unicast_hosts: \"\" es_minimum_master_nodes: \"\" es_scripts_fileglob: \"\" es_install_plugins: [] es_config: \"\" es_heap_ms: \"1g\" es_heap_mx: \"1g\" es_jvm_options: \"\" es_java_home: \"\" es_g1gc: false es_node_data: false es_node_master: false es_node_ingest: false es_node_client: false \u4f9d\u8d56 \u00b6 java 1.8 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/elasticsearch Example Playbook \u00b6 #\u5355\u673a\u5355\u5b9e\u4f8b,\u9ed8\u8ba4\u914d\u7f6e - hosts: node1 roles: - { role: java ,java_version: \"1.8\" } - role: elasticsearch #\u5355\u673a\u591a\u5b9e\u4f8b - hosts: node1 vars: - es_cluster_name: \"Testes\" es_unicast_hosts: '[\"192.168.77.129:9301\",\"192.168.77.129:9302\"]' es_minimum_master_nodes: 2 es_heap_ms: \"512m\" es_heap_mx: \"512m\" roles: - { role: java ,java_version: \"1.8\" } - { role: elasticsearch, es_http_port: 9201, es_transport_port: 9301, es_node_name: \"es_node1\" } - { role: elasticsearch, es_http_port: 9202, es_transport_port: 9302, es_node_name: \"es_node2\" } #\u81ea\u5b9a\u4e49\u8282\u70b9\u89d2\u8272 - hosts: node1 vars: - es_cluster_name: \"Testes\" es_unicast_hosts: '[\"192.168.77.129:9301\",\"192.168.77.129:9302\",\"192.168.77.129:9303\"]' es_minimum_master_nodes: 1 es_heap_ms: \"512m\" es_heap_mx: \"512m\" es_install_plugins: - x-pack - ingest-geoip es_service_start: true roles: - { role: java ,java_version: \"1.8\" } - { role: elasticsearch, es_http_port: 9201, es_transport_port: 9301, es_node_name: \"es_node1\", es_node_master: true, es_node_ingest: true } - { role: elasticsearch, es_http_port: 9202, es_transport_port: 9302, es_node_name: \"es_node2\", es_node_data: true } - { role: elasticsearch, es_http_port: 9203, es_transport_port: 9303, es_node_name: \"es_node3\", es_node_data: true } #\u5206\u5e03\u5f0f\u90e8\u7f72 - hosts: node1 node2 node3 vars: - es_cluster_name: \"Testes\" es_unicast_hosts: '[\"192.168.77.129\",\"192.168.77.130\",\"192.168.77.131\"]' es_minimum_master_nodes: 2 es_heap_ms: \"512m\" es_heap_mx: \"512m\" - es_install_plugins: - x-pack - ingest-geoip es_service_start: true roles: - { role: java ,java_version: \"1.8\" } - { role: elasticsearch } \u4f7f\u7528 \u00b6 ~]# service elasticsearch Usage: /etc/init.d/elasticsearch {start|stop|status|restart|condrestart|try-restart|reload|force-reload}","title":"elasticsearch"},{"location":"roles/log/elasticsearch/#ansible-role-elasticsearch","text":"\u5b89\u88c5elasticsearch\u96c6\u7fa4","title":"Ansible Role: elasticsearch"},{"location":"roles/log/elasticsearch/#_1","text":"ElasticSearch\u662f\u4e00\u4e2a\u57fa\u4e8eLucene\u7684\u641c\u7d22\u670d\u52a1\u5668\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5206\u5e03\u5f0f\u591a\u7528\u6237\u80fd\u529b\u7684\u5168\u6587\u641c\u7d22\u5f15\u64ce\uff0c\u57fa\u4e8eRESTful web\u63a5\u53e3\u3002Elasticsearch\u662f\u7528Java\u5f00\u53d1\u7684\uff0c\u5e76\u4f5c\u4e3aApache\u8bb8\u53ef\u6761\u6b3e\u4e0b\u7684\u5f00\u653e\u6e90\u7801\u53d1\u5e03\uff0c\u662f\u5f53\u524d\u6d41\u884c\u7684\u4f01\u4e1a\u7ea7\u641c\u7d22\u5f15\u64ce\u3002\u8bbe\u8ba1\u7528\u4e8e\u4e91\u8ba1\u7b97\u4e2d\uff0c\u80fd\u591f\u8fbe\u5230\u5b9e\u65f6\u641c\u7d22\uff0c\u7a33\u5b9a\uff0c\u53ef\u9760\uff0c\u5feb\u901f\uff0c\u5b89\u88c5\u4f7f\u7528\u65b9\u4fbf\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.elastic.co/products/elasticsearch github: https://github.com/elastic/elasticsearch \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html","title":"\u4ecb\u7ecd"},{"location":"roles/log/elasticsearch/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/log/elasticsearch/#_3","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/log/elasticsearch/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" es_version: \"5.4.1\" es_file: \"elasticsearch-{{ es_version }}.tar.gz\" es_file_path: \"{{ software_files_path }}/{{ es_file }}\" es_file_url: \"https://artifacts.elastic.co/downloads/elasticsearch/{{ es_file }}\" es_user: elasticsearch es_group: elasticsearch es_http_host: \"0.0.0.0\" es_http_port: 9200 es_transport_port: 9300 es_max_open_files: 165535 es_max_map_count: 262155 es_max_processes: 4096 es_service_name: \"elasticsearch{% if es_http_port != 9200 %}{{ es_http_port }}{% endif %}\" es_service_start: false es_home_dir: \"/usr/local/elasticsearch\" es_pid_dir: \"/var/run/elasticsearch\" es_log_dir: \"/{{ es_service_name }}_data/logs\" es_conf_dir: \"/{{ es_service_name }}_data/config\" es_data_dir: \"/{{ es_service_name }}_data/data\" es_script_dir: \"/{{ es_service_name }}_data/scripts\" es_cluster_name: \"\" es_node_name: \"\" es_node_rack: \"\" es_unicast_hosts: \"\" es_minimum_master_nodes: \"\" es_scripts_fileglob: \"\" es_install_plugins: [] es_config: \"\" es_heap_ms: \"1g\" es_heap_mx: \"1g\" es_jvm_options: \"\" es_java_home: \"\" es_g1gc: false es_node_data: false es_node_master: false es_node_ingest: false es_node_client: false","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/log/elasticsearch/#_5","text":"java 1.8","title":"\u4f9d\u8d56"},{"location":"roles/log/elasticsearch/#github","text":"https://github.com/lework/Ansible-roles/tree/master/elasticsearch","title":"github\u5730\u5740"},{"location":"roles/log/elasticsearch/#example-playbook","text":"#\u5355\u673a\u5355\u5b9e\u4f8b,\u9ed8\u8ba4\u914d\u7f6e - hosts: node1 roles: - { role: java ,java_version: \"1.8\" } - role: elasticsearch #\u5355\u673a\u591a\u5b9e\u4f8b - hosts: node1 vars: - es_cluster_name: \"Testes\" es_unicast_hosts: '[\"192.168.77.129:9301\",\"192.168.77.129:9302\"]' es_minimum_master_nodes: 2 es_heap_ms: \"512m\" es_heap_mx: \"512m\" roles: - { role: java ,java_version: \"1.8\" } - { role: elasticsearch, es_http_port: 9201, es_transport_port: 9301, es_node_name: \"es_node1\" } - { role: elasticsearch, es_http_port: 9202, es_transport_port: 9302, es_node_name: \"es_node2\" } #\u81ea\u5b9a\u4e49\u8282\u70b9\u89d2\u8272 - hosts: node1 vars: - es_cluster_name: \"Testes\" es_unicast_hosts: '[\"192.168.77.129:9301\",\"192.168.77.129:9302\",\"192.168.77.129:9303\"]' es_minimum_master_nodes: 1 es_heap_ms: \"512m\" es_heap_mx: \"512m\" es_install_plugins: - x-pack - ingest-geoip es_service_start: true roles: - { role: java ,java_version: \"1.8\" } - { role: elasticsearch, es_http_port: 9201, es_transport_port: 9301, es_node_name: \"es_node1\", es_node_master: true, es_node_ingest: true } - { role: elasticsearch, es_http_port: 9202, es_transport_port: 9302, es_node_name: \"es_node2\", es_node_data: true } - { role: elasticsearch, es_http_port: 9203, es_transport_port: 9303, es_node_name: \"es_node3\", es_node_data: true } #\u5206\u5e03\u5f0f\u90e8\u7f72 - hosts: node1 node2 node3 vars: - es_cluster_name: \"Testes\" es_unicast_hosts: '[\"192.168.77.129\",\"192.168.77.130\",\"192.168.77.131\"]' es_minimum_master_nodes: 2 es_heap_ms: \"512m\" es_heap_mx: \"512m\" - es_install_plugins: - x-pack - ingest-geoip es_service_start: true roles: - { role: java ,java_version: \"1.8\" } - { role: elasticsearch }","title":"Example Playbook"},{"location":"roles/log/elasticsearch/#_6","text":"~]# service elasticsearch Usage: /etc/init.d/elasticsearch {start|stop|status|restart|condrestart|try-restart|reload|force-reload}","title":"\u4f7f\u7528"},{"location":"roles/log/filebeat/","text":"Ansible Role: filebeat \u00b6 \u5b89\u88c5filebeat\uff0c\u7528\u4e8e\u6536\u96c6\u65e5\u5fd7 \u4ecb\u7ecd \u00b6 filebeat\u6700\u521d\u662f\u57fa\u4e8elogstash-forwarder\u6e90\u7801\u7684\u65e5\u5fd7\u6570\u636eshipper\u3002Filebeat\u5b89\u88c5\u5728\u670d\u52a1\u5668\u4e0a\u4f5c\u4e3a\u4ee3\u7406\u6765\u76d1\u89c6\u65e5\u5fd7\u76ee\u5f55\u6216\u7279\u5b9a\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u53ef\u4ee5\u5c06\u65e5\u5fd7\u8f6c\u53d1\u5230Logstash\u8fdb\u884c\u89e3\u6790\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u53d1\u9001\u5230Elasticsearch\u8fdb\u884c\u7d22\u5f15\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.elastic.co/products/beats/filebeat github: https://github.com/elastic/beats \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.elastic.co/guide/en/beats/filebeat/current/index.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" filebeat_version: \"5.4.1\" filebeat_file: \"filebeat-{{ filebeat_version }}-linux-x86_64.tar.gz\" filebeat_file_path: \"{{ software_files_path }}/{{ filebeat_file }}\" filebeat_file_url: \"https://artifacts.elastic.co/downloads/beats/filebeat/{{ filebeat_file }}\" filebeat_pid_dir: \"/var/run/filebeat\" filebeat_home_dir: \"/usr/local/filebeat\" filebeat_log_dir: \"/var/log/filebeat\" filebeat_conf_dir: \"{{ filebeat_home_dir }}/conf\" filebeat_data_dir: \"{{ filebeat_home_dir }}/data\" filebeat_service_name: \"filebeat\" filebeat_service_start: false filebeat_conf_file: \"{{ filebeat_service_name }}.yml\" filebeat_config : \"\" \u4f9d\u8d56 \u00b6 None github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/filebeat Example Playbook \u00b6 #\u5b89\u88c5filebeat,\u76d1\u542cmysql\u6162\u65e5\u5fd7\uff1a - hosts: node1 vars: - filebeat_config: | 'filebeat.prospectors: - input_type: log paths: - /var/log/mysql/mysql-slow.log.20170301 document_type: mysql-slow tail_file: false output.logstash: hosts: [\"localhost:5044\"] processors: - drop_fields: fields: [\"input_type\", \"beat\", \"offset\", \"source\"] logging.to_files: true logging.files: path: /var/log/filebeat name: filebeat-mysql-slow rotateeverybytes: 104857600 keepfiles: 7' - filebeat_service_start: true roles: - filebeat #\u591a\u5b9e\u4f8b\u90e8\u7f72 - hosts: node1 vars: - filebeat_config_1: | 'filebeat.prospectors: - input_type: log paths: - /var/log/mysql/mysql-slow.log.20170301 document_type: mysql-slow tail_file: false output.logstash: hosts: [\"localhost:5044\"] processors: - drop_fields: fields: [\"input_type\", \"beat\", \"offset\", \"source\"] logging.to_files: true logging.files: path: /var/log/filebeat name: filebeat-mysql-slow rotateeverybytes: 104857600 keepfiles: 7' - filebeat_config_2: | 'filebeat.prospectors: - input_type: log paths: - /var/log/nginx/access.log* document_type: nginx tail_files: true json.keys_under_root: true json.add_error_key: true output.logstash: hosts: [\"localhost:5044\"] processors: - drop_fields: fields: [\"input_type\", \"beat\", \"offset\", \"source\"] logging.to_files: true logging.files: path: /var/log/filebeat-nginx name: filebeat rotateeverybytes: 104857600 keepfiles: 7' - filebeat_service_start: true roles: - { role: filebeat, filebeat_config: \"{{filebeat_config_1}}\", filebeat_service_name: \"filebeat-mysqlslow\" } - { role: filebeat, filebeat_config: \"{{filebeat_config_2}}\", filebeat_service_name: \"filebeat-nginx\" } \u4f7f\u7528 \u00b6 service filebeat-nginx Usage: /etc/init.d/filebeat-nginx {start|stop|status|restart|condrestart}","title":"filebeat"},{"location":"roles/log/filebeat/#ansible-role-filebeat","text":"\u5b89\u88c5filebeat\uff0c\u7528\u4e8e\u6536\u96c6\u65e5\u5fd7","title":"Ansible Role: filebeat"},{"location":"roles/log/filebeat/#_1","text":"filebeat\u6700\u521d\u662f\u57fa\u4e8elogstash-forwarder\u6e90\u7801\u7684\u65e5\u5fd7\u6570\u636eshipper\u3002Filebeat\u5b89\u88c5\u5728\u670d\u52a1\u5668\u4e0a\u4f5c\u4e3a\u4ee3\u7406\u6765\u76d1\u89c6\u65e5\u5fd7\u76ee\u5f55\u6216\u7279\u5b9a\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u53ef\u4ee5\u5c06\u65e5\u5fd7\u8f6c\u53d1\u5230Logstash\u8fdb\u884c\u89e3\u6790\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u53d1\u9001\u5230Elasticsearch\u8fdb\u884c\u7d22\u5f15\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.elastic.co/products/beats/filebeat github: https://github.com/elastic/beats \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.elastic.co/guide/en/beats/filebeat/current/index.html","title":"\u4ecb\u7ecd"},{"location":"roles/log/filebeat/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/log/filebeat/#_3","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/log/filebeat/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" filebeat_version: \"5.4.1\" filebeat_file: \"filebeat-{{ filebeat_version }}-linux-x86_64.tar.gz\" filebeat_file_path: \"{{ software_files_path }}/{{ filebeat_file }}\" filebeat_file_url: \"https://artifacts.elastic.co/downloads/beats/filebeat/{{ filebeat_file }}\" filebeat_pid_dir: \"/var/run/filebeat\" filebeat_home_dir: \"/usr/local/filebeat\" filebeat_log_dir: \"/var/log/filebeat\" filebeat_conf_dir: \"{{ filebeat_home_dir }}/conf\" filebeat_data_dir: \"{{ filebeat_home_dir }}/data\" filebeat_service_name: \"filebeat\" filebeat_service_start: false filebeat_conf_file: \"{{ filebeat_service_name }}.yml\" filebeat_config : \"\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/log/filebeat/#_5","text":"None","title":"\u4f9d\u8d56"},{"location":"roles/log/filebeat/#github","text":"https://github.com/lework/Ansible-roles/tree/master/filebeat","title":"github\u5730\u5740"},{"location":"roles/log/filebeat/#example-playbook","text":"#\u5b89\u88c5filebeat,\u76d1\u542cmysql\u6162\u65e5\u5fd7\uff1a - hosts: node1 vars: - filebeat_config: | 'filebeat.prospectors: - input_type: log paths: - /var/log/mysql/mysql-slow.log.20170301 document_type: mysql-slow tail_file: false output.logstash: hosts: [\"localhost:5044\"] processors: - drop_fields: fields: [\"input_type\", \"beat\", \"offset\", \"source\"] logging.to_files: true logging.files: path: /var/log/filebeat name: filebeat-mysql-slow rotateeverybytes: 104857600 keepfiles: 7' - filebeat_service_start: true roles: - filebeat #\u591a\u5b9e\u4f8b\u90e8\u7f72 - hosts: node1 vars: - filebeat_config_1: | 'filebeat.prospectors: - input_type: log paths: - /var/log/mysql/mysql-slow.log.20170301 document_type: mysql-slow tail_file: false output.logstash: hosts: [\"localhost:5044\"] processors: - drop_fields: fields: [\"input_type\", \"beat\", \"offset\", \"source\"] logging.to_files: true logging.files: path: /var/log/filebeat name: filebeat-mysql-slow rotateeverybytes: 104857600 keepfiles: 7' - filebeat_config_2: | 'filebeat.prospectors: - input_type: log paths: - /var/log/nginx/access.log* document_type: nginx tail_files: true json.keys_under_root: true json.add_error_key: true output.logstash: hosts: [\"localhost:5044\"] processors: - drop_fields: fields: [\"input_type\", \"beat\", \"offset\", \"source\"] logging.to_files: true logging.files: path: /var/log/filebeat-nginx name: filebeat rotateeverybytes: 104857600 keepfiles: 7' - filebeat_service_start: true roles: - { role: filebeat, filebeat_config: \"{{filebeat_config_1}}\", filebeat_service_name: \"filebeat-mysqlslow\" } - { role: filebeat, filebeat_config: \"{{filebeat_config_2}}\", filebeat_service_name: \"filebeat-nginx\" }","title":"Example Playbook"},{"location":"roles/log/filebeat/#_6","text":"service filebeat-nginx Usage: /etc/init.d/filebeat-nginx {start|stop|status|restart|condrestart}","title":"\u4f7f\u7528"},{"location":"roles/log/grokdebug/","text":"Ansible Role: grokdebug \u00b6 \u5b89\u88c5grokdebug \u4ecb\u7ecd \u00b6 \u7528\u4e8e\u8c03\u8bd5logstash\u4e2dgrok\u8868\u8fbe\u5f0f\u3002 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" grokdebug_file_url: \" https://codeload.github.com/nickethier/grokdebug/zip/master\" grokdebug_logstash: 4.1.0 grokdebug_patterns_url: \"https://github.com/logstash-plugins/logstash-patterns-core/archive/v{{ grokdebug_logstash }}.tar.gz\" grokdebug_gem_package: - { name: \"cabin\", version: \"0.5.0\"} - { name: \"haml\", version: \"3.1.7\"} - { name: \"jls-grok\", version: \"0.10.10\"} - { name: \"json\", version: \"1.7.5\"} - { name: \"kgio\", version: \"2.8.0\"} - { name: \"rack\", version: \"1.4.1\"} - { name: \"rack-protection\", version: \"1.2.0\"} - { name: \"raindrops\", version: \"0.11.0\"} - { name: \"shotgun\", version: \"0.9\"} - { name: \"tilt\", version: \"1.3.3\"} - { name: \"unicorn\", version: \"4.6.3\"} - { name: \"sinatra\", version: \"1.3.3\"} grokdebug_port: 8080 \u4f9d\u8d56 \u00b6 ruby 2.1.7 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/grokdebug Example Playbook \u00b6 - hosts: node1 roles: - { role: ruby, ruby_version: 2.1.7, ruby_install_from_source: true} - grokdebug \u4f7f\u7528 \u00b6 # service grokdebug Usage: {start|stop|force-stop|status|restart}","title":"grokdebug"},{"location":"roles/log/grokdebug/#ansible-role-grokdebug","text":"\u5b89\u88c5grokdebug","title":"Ansible Role: grokdebug"},{"location":"roles/log/grokdebug/#_1","text":"\u7528\u4e8e\u8c03\u8bd5logstash\u4e2dgrok\u8868\u8fbe\u5f0f\u3002","title":"\u4ecb\u7ecd"},{"location":"roles/log/grokdebug/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/log/grokdebug/#_3","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/log/grokdebug/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" grokdebug_file_url: \" https://codeload.github.com/nickethier/grokdebug/zip/master\" grokdebug_logstash: 4.1.0 grokdebug_patterns_url: \"https://github.com/logstash-plugins/logstash-patterns-core/archive/v{{ grokdebug_logstash }}.tar.gz\" grokdebug_gem_package: - { name: \"cabin\", version: \"0.5.0\"} - { name: \"haml\", version: \"3.1.7\"} - { name: \"jls-grok\", version: \"0.10.10\"} - { name: \"json\", version: \"1.7.5\"} - { name: \"kgio\", version: \"2.8.0\"} - { name: \"rack\", version: \"1.4.1\"} - { name: \"rack-protection\", version: \"1.2.0\"} - { name: \"raindrops\", version: \"0.11.0\"} - { name: \"shotgun\", version: \"0.9\"} - { name: \"tilt\", version: \"1.3.3\"} - { name: \"unicorn\", version: \"4.6.3\"} - { name: \"sinatra\", version: \"1.3.3\"} grokdebug_port: 8080","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/log/grokdebug/#_5","text":"ruby 2.1.7","title":"\u4f9d\u8d56"},{"location":"roles/log/grokdebug/#github","text":"https://github.com/lework/Ansible-roles/tree/master/grokdebug","title":"github\u5730\u5740"},{"location":"roles/log/grokdebug/#example-playbook","text":"- hosts: node1 roles: - { role: ruby, ruby_version: 2.1.7, ruby_install_from_source: true} - grokdebug","title":"Example Playbook"},{"location":"roles/log/grokdebug/#_6","text":"# service grokdebug Usage: {start|stop|force-stop|status|restart}","title":"\u4f7f\u7528"},{"location":"roles/log/kibana/","text":"Ansible Role: kibana \u00b6 \u5b89\u88c5kibana \u4ecb\u7ecd \u00b6 Kibana \u662f\u4e00\u4e2a\u4e3a Logstash \u548c ElasticSearch \u63d0\u4f9b\u7684\u65e5\u5fd7\u5206\u6790\u7684 Web \u63a5\u53e3\u3002\u53ef\u4f7f\u7528\u5b83\u5bf9\u65e5\u5fd7\u8fdb\u884c\u9ad8\u6548\u7684\u641c\u7d22\u3001\u53ef\u89c6\u5316\u3001\u5206\u6790\u7b49\u5404\u79cd\u64cd\u4f5c\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.elastic.co/products/kibana github: https://github.com/elastic/kibana \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.elastic.co/guide/en/kibana/current/index.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" kibana_version: \"5.4.1\" kibana_file: \"kibana-{{ kibana_version }}-linux-x86_64.tar.gz\" kibana_file_path: \"{{ software_files_path }}/{{ kibana_file }}\" kibana_file_url: \"https://artifacts.elastic.co/downloads/kibana/{{ kibana_file }}\" kibana_user: kibana kibana_group: kibana kibana_home_dir: \"/usr/local/kibana\" kibana_log_dir: \"/var/log/kibana\" kibana_pid_dir: \"/var/run/kibana\" kibana_conf_dir: \"{{ kibana_home_dir }}/config\" kibana_data_dir: \"{{ kibana_home_dir }}/data\" kibana_service_name: \"kibana\" kibana_service_start: false kibana_conf_file: \"{{ kibana_service_name }}.yml\" kibana_server_port: \"5601\" kibana_server_host: \"0.0.0.0\" kibana_elasticsearch_url: \"\" kibana_elasticsearch_username: \"\" kibana_elasticsearch_password: \"\" kibana_elasticsearch_pingTimeout: \"\" kibana_elasticsearch_requestTimeout: \"\" kibana_elasticsearch_startupTimeout: \"\" kibana_tilemap_gaode: true kibana_install_plugins: [] kibana_config: {} \u4f9d\u8d56 \u00b6 elasticsearch github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/kibana Example Playbook \u00b6 - hosts: node1 vars: - kibana_elasticsearch_url: \"http://localhost:9200\" kibana_elasticsearch_username: \"kibana\" kibana_elasticsearch_password: \"123456\" kibana_install_plugins: - \"x-pack\" kibana_service_start: true roles: - kibana \u4f7f\u7528 \u00b6 service kibana Usage: {start|stop|force-stop|status|restart}","title":"kibana"},{"location":"roles/log/kibana/#ansible-role-kibana","text":"\u5b89\u88c5kibana","title":"Ansible Role: kibana"},{"location":"roles/log/kibana/#_1","text":"Kibana \u662f\u4e00\u4e2a\u4e3a Logstash \u548c ElasticSearch \u63d0\u4f9b\u7684\u65e5\u5fd7\u5206\u6790\u7684 Web \u63a5\u53e3\u3002\u53ef\u4f7f\u7528\u5b83\u5bf9\u65e5\u5fd7\u8fdb\u884c\u9ad8\u6548\u7684\u641c\u7d22\u3001\u53ef\u89c6\u5316\u3001\u5206\u6790\u7b49\u5404\u79cd\u64cd\u4f5c\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.elastic.co/products/kibana github: https://github.com/elastic/kibana \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.elastic.co/guide/en/kibana/current/index.html","title":"\u4ecb\u7ecd"},{"location":"roles/log/kibana/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/log/kibana/#_3","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/log/kibana/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" kibana_version: \"5.4.1\" kibana_file: \"kibana-{{ kibana_version }}-linux-x86_64.tar.gz\" kibana_file_path: \"{{ software_files_path }}/{{ kibana_file }}\" kibana_file_url: \"https://artifacts.elastic.co/downloads/kibana/{{ kibana_file }}\" kibana_user: kibana kibana_group: kibana kibana_home_dir: \"/usr/local/kibana\" kibana_log_dir: \"/var/log/kibana\" kibana_pid_dir: \"/var/run/kibana\" kibana_conf_dir: \"{{ kibana_home_dir }}/config\" kibana_data_dir: \"{{ kibana_home_dir }}/data\" kibana_service_name: \"kibana\" kibana_service_start: false kibana_conf_file: \"{{ kibana_service_name }}.yml\" kibana_server_port: \"5601\" kibana_server_host: \"0.0.0.0\" kibana_elasticsearch_url: \"\" kibana_elasticsearch_username: \"\" kibana_elasticsearch_password: \"\" kibana_elasticsearch_pingTimeout: \"\" kibana_elasticsearch_requestTimeout: \"\" kibana_elasticsearch_startupTimeout: \"\" kibana_tilemap_gaode: true kibana_install_plugins: [] kibana_config: {}","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/log/kibana/#_5","text":"elasticsearch","title":"\u4f9d\u8d56"},{"location":"roles/log/kibana/#github","text":"https://github.com/lework/Ansible-roles/tree/master/kibana","title":"github\u5730\u5740"},{"location":"roles/log/kibana/#example-playbook","text":"- hosts: node1 vars: - kibana_elasticsearch_url: \"http://localhost:9200\" kibana_elasticsearch_username: \"kibana\" kibana_elasticsearch_password: \"123456\" kibana_install_plugins: - \"x-pack\" kibana_service_start: true roles: - kibana","title":"Example Playbook"},{"location":"roles/log/kibana/#_6","text":"service kibana Usage: {start|stop|force-stop|status|restart}","title":"\u4f7f\u7528"},{"location":"roles/log/logstash/","text":"Ansible Role: logstash \u00b6 \u5b89\u88c5logstash \u4ecb\u7ecd \u00b6 Logstash \u662f\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\u3001\u4e8b\u4ef6\u7684\u4f20\u8f93\u3001\u5904\u7406\u3001\u7ba1\u7406\u548c\u641c\u7d22\u7684\u5e73\u53f0\u3002\u4f60\u53ef\u4ee5\u7528\u5b83\u6765\u7edf\u4e00\u5bf9\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\u8fdb\u884c\u6536\u96c6\u7ba1\u7406\uff0c\u63d0\u4f9b Web \u63a5\u53e3\u7528\u4e8e\u67e5\u8be2\u548c\u7edf\u8ba1\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.elastic.co/products/logstash github: https://github.com/elastic/logstash \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.elastic.co/guide/en/logstash/current/index.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" logstash_version: \"5.4.1\" logstash_file: \"logstash-{{ logstash_version }}.tar.gz\" logstash_file_path: \"{{ software_files_path }}/{{ logstash_file }}\" logstash_file_url: \"https://artifacts.elastic.co/downloads/logstash/{{ logstash_file }}\" logstash_user: logstash logstash_group: logstash logstash_home_dir: \"/usr/local/logstash\" logstash_log_dir: \"/var/log/logstash\" logstash_pid_dir: \"/var/run/logstash\" logstash_conf_dir: \"{{ logstash_home_dir }}/config\" logstash_data_dir: \"{{ logstash_home_dir }}/data\" logstash_pipeline_dir: \"{{ logstash_home_dir }}/pipeline\" logstash_pipeline_file: \"{{ logstash_service_name }}.conf\" logstash_node_name: \"\" logstash_service_name: \"logstash\" logstash_service_start: false logstash_install_plugins: [] logstash_config: \"\" logstash_heap_ms: \"256m\" logstash_heap_mx: \"1g\" logstash_jvm_options: \"\" logstash_java_home: \"\" \u4f9d\u8d56 \u00b6 java 1.8 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/logstash Example Playbook \u00b6 #\u5355\u673a\u5355\u5b9e\u4f8b - hosts: node1 vars: - logstash_config: | 'input { beats { port => 5045 codec => multiline{ pattern => \"^^# User@Host:\" negate => true what => previous } } } filter { grok { match => [ \"message\", \"^# User@Host: %{USER:user}(?>\\[[^\\]]+\\])? @ (%{HOSTNAME:hostname})? \\[%{IP:ip}?\\](\\s+)Id:(\\s+)%{INT:id:int}(\\n)?# Query_time: %{NUMBER:query_time:float}\\s+Lock_time: %{NUMBER:lock_time:scaled_float}\\s+Rows_sent: %{NUMBER:rows_sent:int}\\s+Rows_examined: %{NUMBER:rows_examined:int}(\\n)?(?:use %{DATA:database};\\s*)?(\\n)?SET timestamp=%{NUMBER:timestamp};(\\n)?(?<query>(?<action>\\w+)(\\s+.*)?)?;(\\n# Time: .*$)?\" ] } date { match => [ \"timestamp\", \"UNIX\" ] remove_field => [ \"timestamp\" ] } mutate { lowercase => [\"action\"] } } output { stdout { codec => rubydebug } }' - logstash_heap_mx: \"256m\" logstash_service_start: true roles: - { role: logstash } #\u5355\u673a\u591a\u5b9e\u4f8b - hosts: node1 vars: - logstash_config_1: | 'input { beats { port => 5044 codec => multiline{ pattern => \"^^# User@Host:\" negate => true what => previous } } } filter { grok { match => [ \"message\", \"^# User@Host: %{USER:user}(?>\\[[^\\]]+\\])? @ (%{HOSTNAME:hostname})? \\[%{IP:ip}?\\](\\s+)Id:(\\s+)%{INT:id:int}(\\n)?# Query_time: %{NUMBER:query_time:float}\\s+Lock_time: %{NUMBER:lock_time:scaled_float}\\s+Rows_sent: %{NUMBER:rows_sent:int}\\s+Rows_examined: %{NUMBER:rows_examined:int}(\\n)?(?:use %{DATA:database};\\s*)?(\\n)?SET timestamp=%{NUMBER:timestamp};(\\n)?(?<query>(?<action>\\w+)(\\s+.*)?)?;(\\n# Time: .*$)?\" ] } date { match => [ \"timestamp\", \"UNIX\" ] remove_field => [ \"timestamp\" ] } mutate { lowercase => [\"action\"] } } output { stdout { codec => rubydebug } }' - logstash_config_2: | 'input { beats { port => 5045 codec => multiline{ pattern => \"^^# User@Host:\" negate => true what => previous } } } filter { grok { match => [ \"message\", \"^# User@Host: %{USER:user}(?>\\[[^\\]]+\\])? @ (%{HOSTNAME:hostname})? \\[%{IP:ip}?\\](\\s+)Id:(\\s+)%{INT:id:int}(\\n)?# Query_time: %{NUMBER:query_time:float}\\s+Lock_time: %{NUMBER:lock_time:scaled_float}\\s+Rows_sent: %{NUMBER:rows_sent:int}\\s+Rows_examined: %{NUMBER:rows_examined:int}(\\n)?(?:use %{DATA:database};\\s*)?(\\n)?SET timestamp=%{NUMBER:timestamp};(\\n)?(?<query>(?<action>\\w+)(\\s+.*)?)?;(\\n# Time: .*$)?\" ] } date { match => [ \"timestamp\", \"UNIX\" ] remove_field => [ \"timestamp\" ] } mutate { lowercase => [\"action\"] } } output { stdout { codec => rubydebug } }' - logstash_heap_mx: \"256m\" logstash_service_start: true roles: - { role: logstash, logstash_service_name: logstash-mysqlslow, logstash_config: \"{{logstash_config_1}}\"} - { role: logstash, logstash_service_name: logstash-mysqlslow2, logstash_config: \"{{logstash_config_2}}\"} \u4f7f\u7528 \u00b6 service logstash-mysqlslow Usage: {start|stop|force-stop|status|restart}","title":"logstash"},{"location":"roles/log/logstash/#ansible-role-logstash","text":"\u5b89\u88c5logstash","title":"Ansible Role: logstash"},{"location":"roles/log/logstash/#_1","text":"Logstash \u662f\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\u3001\u4e8b\u4ef6\u7684\u4f20\u8f93\u3001\u5904\u7406\u3001\u7ba1\u7406\u548c\u641c\u7d22\u7684\u5e73\u53f0\u3002\u4f60\u53ef\u4ee5\u7528\u5b83\u6765\u7edf\u4e00\u5bf9\u5e94\u7528\u7a0b\u5e8f\u65e5\u5fd7\u8fdb\u884c\u6536\u96c6\u7ba1\u7406\uff0c\u63d0\u4f9b Web \u63a5\u53e3\u7528\u4e8e\u67e5\u8be2\u548c\u7edf\u8ba1\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.elastic.co/products/logstash github: https://github.com/elastic/logstash \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.elastic.co/guide/en/logstash/current/index.html","title":"\u4ecb\u7ecd"},{"location":"roles/log/logstash/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/log/logstash/#_3","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/log/logstash/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" logstash_version: \"5.4.1\" logstash_file: \"logstash-{{ logstash_version }}.tar.gz\" logstash_file_path: \"{{ software_files_path }}/{{ logstash_file }}\" logstash_file_url: \"https://artifacts.elastic.co/downloads/logstash/{{ logstash_file }}\" logstash_user: logstash logstash_group: logstash logstash_home_dir: \"/usr/local/logstash\" logstash_log_dir: \"/var/log/logstash\" logstash_pid_dir: \"/var/run/logstash\" logstash_conf_dir: \"{{ logstash_home_dir }}/config\" logstash_data_dir: \"{{ logstash_home_dir }}/data\" logstash_pipeline_dir: \"{{ logstash_home_dir }}/pipeline\" logstash_pipeline_file: \"{{ logstash_service_name }}.conf\" logstash_node_name: \"\" logstash_service_name: \"logstash\" logstash_service_start: false logstash_install_plugins: [] logstash_config: \"\" logstash_heap_ms: \"256m\" logstash_heap_mx: \"1g\" logstash_jvm_options: \"\" logstash_java_home: \"\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/log/logstash/#_5","text":"java 1.8","title":"\u4f9d\u8d56"},{"location":"roles/log/logstash/#github","text":"https://github.com/lework/Ansible-roles/tree/master/logstash","title":"github\u5730\u5740"},{"location":"roles/log/logstash/#example-playbook","text":"#\u5355\u673a\u5355\u5b9e\u4f8b - hosts: node1 vars: - logstash_config: | 'input { beats { port => 5045 codec => multiline{ pattern => \"^^# User@Host:\" negate => true what => previous } } } filter { grok { match => [ \"message\", \"^# User@Host: %{USER:user}(?>\\[[^\\]]+\\])? @ (%{HOSTNAME:hostname})? \\[%{IP:ip}?\\](\\s+)Id:(\\s+)%{INT:id:int}(\\n)?# Query_time: %{NUMBER:query_time:float}\\s+Lock_time: %{NUMBER:lock_time:scaled_float}\\s+Rows_sent: %{NUMBER:rows_sent:int}\\s+Rows_examined: %{NUMBER:rows_examined:int}(\\n)?(?:use %{DATA:database};\\s*)?(\\n)?SET timestamp=%{NUMBER:timestamp};(\\n)?(?<query>(?<action>\\w+)(\\s+.*)?)?;(\\n# Time: .*$)?\" ] } date { match => [ \"timestamp\", \"UNIX\" ] remove_field => [ \"timestamp\" ] } mutate { lowercase => [\"action\"] } } output { stdout { codec => rubydebug } }' - logstash_heap_mx: \"256m\" logstash_service_start: true roles: - { role: logstash } #\u5355\u673a\u591a\u5b9e\u4f8b - hosts: node1 vars: - logstash_config_1: | 'input { beats { port => 5044 codec => multiline{ pattern => \"^^# User@Host:\" negate => true what => previous } } } filter { grok { match => [ \"message\", \"^# User@Host: %{USER:user}(?>\\[[^\\]]+\\])? @ (%{HOSTNAME:hostname})? \\[%{IP:ip}?\\](\\s+)Id:(\\s+)%{INT:id:int}(\\n)?# Query_time: %{NUMBER:query_time:float}\\s+Lock_time: %{NUMBER:lock_time:scaled_float}\\s+Rows_sent: %{NUMBER:rows_sent:int}\\s+Rows_examined: %{NUMBER:rows_examined:int}(\\n)?(?:use %{DATA:database};\\s*)?(\\n)?SET timestamp=%{NUMBER:timestamp};(\\n)?(?<query>(?<action>\\w+)(\\s+.*)?)?;(\\n# Time: .*$)?\" ] } date { match => [ \"timestamp\", \"UNIX\" ] remove_field => [ \"timestamp\" ] } mutate { lowercase => [\"action\"] } } output { stdout { codec => rubydebug } }' - logstash_config_2: | 'input { beats { port => 5045 codec => multiline{ pattern => \"^^# User@Host:\" negate => true what => previous } } } filter { grok { match => [ \"message\", \"^# User@Host: %{USER:user}(?>\\[[^\\]]+\\])? @ (%{HOSTNAME:hostname})? \\[%{IP:ip}?\\](\\s+)Id:(\\s+)%{INT:id:int}(\\n)?# Query_time: %{NUMBER:query_time:float}\\s+Lock_time: %{NUMBER:lock_time:scaled_float}\\s+Rows_sent: %{NUMBER:rows_sent:int}\\s+Rows_examined: %{NUMBER:rows_examined:int}(\\n)?(?:use %{DATA:database};\\s*)?(\\n)?SET timestamp=%{NUMBER:timestamp};(\\n)?(?<query>(?<action>\\w+)(\\s+.*)?)?;(\\n# Time: .*$)?\" ] } date { match => [ \"timestamp\", \"UNIX\" ] remove_field => [ \"timestamp\" ] } mutate { lowercase => [\"action\"] } } output { stdout { codec => rubydebug } }' - logstash_heap_mx: \"256m\" logstash_service_start: true roles: - { role: logstash, logstash_service_name: logstash-mysqlslow, logstash_config: \"{{logstash_config_1}}\"} - { role: logstash, logstash_service_name: logstash-mysqlslow2, logstash_config: \"{{logstash_config_2}}\"}","title":"Example Playbook"},{"location":"roles/log/logstash/#_6","text":"service logstash-mysqlslow Usage: {start|stop|force-stop|status|restart}","title":"\u4f7f\u7528"},{"location":"roles/monitor/grafana/","text":"Ansible Role: grafana \u00b6 \u5b89\u88c5grafana \u4ecb\u7ecd \u00b6 Grafana \u662f Graphite \u548c InfluxDB \u4eea\u8868\u76d8\u548c\u56fe\u5f62\u7f16\u8f91\u5668\u3002Grafana \u662f\u5f00\u6e90\u7684\uff0c\u529f\u80fd\u9f50\u5168\u7684\u5ea6\u91cf\u4eea\u8868\u76d8\u548c\u56fe\u5f62\u7f16\u8f91\u5668\uff0c\u652f\u6301 Graphite\uff0cInfluxDB \u548c OpenTSDB\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://grafana.com/ github: https://github.com/grafana/grafana \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://docs.grafana.org/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" grafana_version: \"4.4.1\" grafana_package_url: \"https://s3-us-west-2.amazonaws.com/grafana-releases/release/grafana-{{ grafana_version }}-1.x86_64.rpm\" grafana_plugins: [] grafana_http_port: 3000 grafana_admin_user: \"admin\" grafana_admin_password: \"admin\" \u4f9d\u8d56 \u00b6 None github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/grafana Example Playbook \u00b6 - hosts: node1 roles: - grafana - hosts: node1 vars: - grafana_plugins: - alexanderzobnin-zabbix-app - grafana_admin_password: '123456' roles: - { role: grafana } - { role: iptables, iptables_allowed_tcp_ports: [ \"3000\"]} \u4f7f\u7528 \u00b6 ~]# /etc/init.d/grafana-server Usage: /etc/init.d/grafana-server {start|stop|restart|force-reload|status}","title":"grafana"},{"location":"roles/monitor/grafana/#ansible-role-grafana","text":"\u5b89\u88c5grafana","title":"Ansible Role: grafana"},{"location":"roles/monitor/grafana/#_1","text":"Grafana \u662f Graphite \u548c InfluxDB \u4eea\u8868\u76d8\u548c\u56fe\u5f62\u7f16\u8f91\u5668\u3002Grafana \u662f\u5f00\u6e90\u7684\uff0c\u529f\u80fd\u9f50\u5168\u7684\u5ea6\u91cf\u4eea\u8868\u76d8\u548c\u56fe\u5f62\u7f16\u8f91\u5668\uff0c\u652f\u6301 Graphite\uff0cInfluxDB \u548c OpenTSDB\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://grafana.com/ github: https://github.com/grafana/grafana \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://docs.grafana.org/","title":"\u4ecb\u7ecd"},{"location":"roles/monitor/grafana/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/monitor/grafana/#_3","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/monitor/grafana/#_4","text":"software_files_path: \"/opt/software\" grafana_version: \"4.4.1\" grafana_package_url: \"https://s3-us-west-2.amazonaws.com/grafana-releases/release/grafana-{{ grafana_version }}-1.x86_64.rpm\" grafana_plugins: [] grafana_http_port: 3000 grafana_admin_user: \"admin\" grafana_admin_password: \"admin\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/monitor/grafana/#_5","text":"None","title":"\u4f9d\u8d56"},{"location":"roles/monitor/grafana/#github","text":"https://github.com/lework/Ansible-roles/tree/master/grafana","title":"github\u5730\u5740"},{"location":"roles/monitor/grafana/#example-playbook","text":"- hosts: node1 roles: - grafana - hosts: node1 vars: - grafana_plugins: - alexanderzobnin-zabbix-app - grafana_admin_password: '123456' roles: - { role: grafana } - { role: iptables, iptables_allowed_tcp_ports: [ \"3000\"]}","title":"Example Playbook"},{"location":"roles/monitor/grafana/#_6","text":"~]# /etc/init.d/grafana-server Usage: /etc/init.d/grafana-server {start|stop|restart|force-reload|status}","title":"\u4f7f\u7528"},{"location":"roles/monitor/zabbix-agent/","text":"Ansible Role: zabbix-agent \u00b6 \u5b89\u88c5zabbix\u5ba2\u6237\u7aef \u4ecb\u7ecd \u00b6 zabbix\uff08\u97f3\u540c z?bix\uff09\u662f\u4e00\u4e2a\u57fa\u4e8eWEB\u754c\u9762\u7684\u63d0\u4f9b\u5206\u5e03\u5f0f\u7cfb\u7edf\u76d1\u89c6\u4ee5\u53ca\u7f51\u7edc\u76d1\u89c6\u529f\u80fd\u7684\u4f01\u4e1a\u7ea7\u7684\u5f00\u6e90\u89e3\u51b3\u65b9\u6848\u3002 zabbix agent\u9700\u8981\u5b89\u88c5\u5728\u88ab\u76d1\u89c6\u7684\u76ee\u6807\u670d\u52a1\u5668\u4e0a\uff0c\u5b83\u4e3b\u8981\u5b8c\u6210\u5bf9\u786c\u4ef6\u4fe1\u606f\u6216\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u6709\u5173\u7684\u5185\u5b58\uff0cCPU\u7b49\u4fe1\u606f\u7684\u6536\u96c6\u3002zabbix agent\u53ef\u4ee5\u8fd0\u884c\u5728Linux,Solaris,HP-UX,AIX,Free BSD,Open BSD, OS X, Tru64/OSF1, Windows NT4.0, Windows (2000/2003/XP/Vista)\u7b49\u7cfb\u7edf\u4e4b\u4e0a\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.zabbix.com \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.zabbix.com/documentation/3.2/manual \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.5.1 os Centos 7.2.1511 X64 python 2.7.5 supervisor 3.3.4 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" zabbix_agent_version: \"3.4.8\" zabbix_agent_file: \"zabbix-{{ zabbix_agent_version }}.tar.gz\" zabbix_agent_file_path: \"{{ software_files_path }}/{{ zabbix_agent_file }}\" zabbix_agent_file_url: \"https://phoenixnap.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/{{ zabbix_agent_version }}/{{ zabbix_agent_file }}\" zabbix_agent_packages: - \"zabbix-agent-{{ zabbix_agent_version }}\" zabbix_agent_user: zabbix zabbix_agent_group: zabbix zabbix_agent_install_from_source: false zabbix_agent_source_dir: \"/tmp/{{ zabbix_agent_file | replace('.tar.gz','') }}\" zabbix_agent_source_configure_command: > ./configure --prefix={{ software_install_path }}/zabbix-{{ zabbix_agent_version }} --enable-agent zabbix_agent_conf_path: \"/etc/zabbix\" zabbix_agent_logs_path: \"/var/log/zabbix\" zabbix_agent_hostname: \"{{ ansible_hostname | d() }}\" zabbix_agent_server_host: \"127.0.0.1\" \u4f9d\u8d56 \u00b6 zabbix server github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/zabbix-agent Example Playbook \u00b6 --- # \u6e90\u7801\u5b89\u88c5 - hosts: node2 roles: - { role: zabbix-agent, zabbix_agent_install_from_source: true, zabbix_agent_server_host: \"192.168.77.130\" } # rpm\u5305\u5b89\u88c5 - hosts: node3 roles: - { role: zabbix-agent, zabbix_agent_server_host: \"192.168.77.130\" } \u4f7f\u7528 \u00b6 ~]# /etc/init.d/zabbix-agent Usage: /etc/init.d/zabbix-agent {start|stop|status|restart|help} start - start zabbix_agentd stop - stop zabbix_agentd status - show current status of zabbix_agentd restart - restart zabbix_agentd if running by sending a SIGHUP or start if not running help - this screen ~]# systemctl status zabbix-agent","title":"zabbix-agent"},{"location":"roles/monitor/zabbix-agent/#ansible-role-zabbix-agent","text":"\u5b89\u88c5zabbix\u5ba2\u6237\u7aef","title":"Ansible Role: zabbix-agent"},{"location":"roles/monitor/zabbix-agent/#_1","text":"zabbix\uff08\u97f3\u540c z?bix\uff09\u662f\u4e00\u4e2a\u57fa\u4e8eWEB\u754c\u9762\u7684\u63d0\u4f9b\u5206\u5e03\u5f0f\u7cfb\u7edf\u76d1\u89c6\u4ee5\u53ca\u7f51\u7edc\u76d1\u89c6\u529f\u80fd\u7684\u4f01\u4e1a\u7ea7\u7684\u5f00\u6e90\u89e3\u51b3\u65b9\u6848\u3002 zabbix agent\u9700\u8981\u5b89\u88c5\u5728\u88ab\u76d1\u89c6\u7684\u76ee\u6807\u670d\u52a1\u5668\u4e0a\uff0c\u5b83\u4e3b\u8981\u5b8c\u6210\u5bf9\u786c\u4ef6\u4fe1\u606f\u6216\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u6709\u5173\u7684\u5185\u5b58\uff0cCPU\u7b49\u4fe1\u606f\u7684\u6536\u96c6\u3002zabbix agent\u53ef\u4ee5\u8fd0\u884c\u5728Linux,Solaris,HP-UX,AIX,Free BSD,Open BSD, OS X, Tru64/OSF1, Windows NT4.0, Windows (2000/2003/XP/Vista)\u7b49\u7cfb\u7edf\u4e4b\u4e0a\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.zabbix.com \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.zabbix.com/documentation/3.2/manual","title":"\u4ecb\u7ecd"},{"location":"roles/monitor/zabbix-agent/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/monitor/zabbix-agent/#_3","text":"ansible 2.5.1 os Centos 7.2.1511 X64 python 2.7.5 supervisor 3.3.4","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/monitor/zabbix-agent/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" zabbix_agent_version: \"3.4.8\" zabbix_agent_file: \"zabbix-{{ zabbix_agent_version }}.tar.gz\" zabbix_agent_file_path: \"{{ software_files_path }}/{{ zabbix_agent_file }}\" zabbix_agent_file_url: \"https://phoenixnap.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/{{ zabbix_agent_version }}/{{ zabbix_agent_file }}\" zabbix_agent_packages: - \"zabbix-agent-{{ zabbix_agent_version }}\" zabbix_agent_user: zabbix zabbix_agent_group: zabbix zabbix_agent_install_from_source: false zabbix_agent_source_dir: \"/tmp/{{ zabbix_agent_file | replace('.tar.gz','') }}\" zabbix_agent_source_configure_command: > ./configure --prefix={{ software_install_path }}/zabbix-{{ zabbix_agent_version }} --enable-agent zabbix_agent_conf_path: \"/etc/zabbix\" zabbix_agent_logs_path: \"/var/log/zabbix\" zabbix_agent_hostname: \"{{ ansible_hostname | d() }}\" zabbix_agent_server_host: \"127.0.0.1\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/monitor/zabbix-agent/#_5","text":"zabbix server","title":"\u4f9d\u8d56"},{"location":"roles/monitor/zabbix-agent/#github","text":"https://github.com/lework/Ansible-roles/tree/master/zabbix-agent","title":"github\u5730\u5740"},{"location":"roles/monitor/zabbix-agent/#example-playbook","text":"--- # \u6e90\u7801\u5b89\u88c5 - hosts: node2 roles: - { role: zabbix-agent, zabbix_agent_install_from_source: true, zabbix_agent_server_host: \"192.168.77.130\" } # rpm\u5305\u5b89\u88c5 - hosts: node3 roles: - { role: zabbix-agent, zabbix_agent_server_host: \"192.168.77.130\" }","title":"Example Playbook"},{"location":"roles/monitor/zabbix-agent/#_6","text":"~]# /etc/init.d/zabbix-agent Usage: /etc/init.d/zabbix-agent {start|stop|status|restart|help} start - start zabbix_agentd stop - stop zabbix_agentd status - show current status of zabbix_agentd restart - restart zabbix_agentd if running by sending a SIGHUP or start if not running help - this screen ~]# systemctl status zabbix-agent","title":"\u4f7f\u7528"},{"location":"roles/monitor/zabbix-server/","text":"Ansible Role: zabbix-server \u00b6 \u5b89\u88c5zabbix server \u4ecb\u7ecd \u00b6 zabbix\uff08\u97f3\u540c z?bix\uff09\u662f\u4e00\u4e2a\u57fa\u4e8eWEB\u754c\u9762\u7684\u63d0\u4f9b\u5206\u5e03\u5f0f\u7cfb\u7edf\u76d1\u89c6\u4ee5\u53ca\u7f51\u7edc\u76d1\u89c6\u529f\u80fd\u7684\u4f01\u4e1a\u7ea7\u7684\u5f00\u6e90\u89e3\u51b3\u65b9\u6848\u3002 zabbix server\u53ef\u4ee5\u901a\u8fc7SNMP\uff0czabbix agent\uff0cping\uff0c\u7aef\u53e3\u76d1\u89c6\u7b49\u65b9\u6cd5\u63d0\u4f9b\u5bf9\u8fdc\u7a0b\u670d\u52a1\u5668/\u7f51\u7edc\u72b6\u6001\u7684\u76d1\u89c6\uff0c\u6570\u636e\u6536\u96c6\u7b49\u529f\u80fd\uff0c\u5b83\u53ef\u4ee5\u8fd0\u884c\u5728Linux\uff0cSolaris\uff0cHP-UX\uff0cAIX\uff0cFree BSD\uff0cOpen BSD\uff0cOS X\u7b49\u5e73\u53f0\u4e0a\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.zabbix.com \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.zabbix.com/documentation/3.2/manual \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.5.1 os Centos 7.2.1511 X64 python 2.7.5 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" zabbix_server_version: \"3.4.8\" zabbix_server_file: \"zabbix-{{ zabbix_server_version }}.tar.gz\" zabbix_server_file_path: \"{{ software_files_path }}/{{ zabbix_server_file }}\" zabbix_server_file_url: \"https://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/{{ zabbix_server_version }}/{{ zabbix_server_file }}\" zabbix_server_packages: - \"zabbix-server-mysql-{{ zabbix_server_version }}\" - \"zabbix-web-mysql-{{ zabbix_server_version }}\" - \"zabbix-agent-{{ zabbix_server_version }}\" zabbix_server_user: zabbix zabbix_server_group: zabbix zabbix_server_hostanme: \"Zabbix server\" zabbix_server_install_from_source: false zabbix_server_source_dir: \"/tmp/{{ zabbix_server_file | replace('.tar.gz','') }}\" zabbix_server_source_configure_command: > ./configure --prefix={{ software_install_path }}/zabbix-{{ zabbix_server_version }} --enable-server --enable-agent --with-mysql --enable-ipv6 --with-net-snmp --with-libcurl --with-libxml2 zabbix_server_conf_path: \"/etc/zabbix\" zabbix_server_logs_path: \"/var/log/zabbix\" zabbix_server_webroot: \"/var/www/html/zabbix\" zabbix_server_webserver: \"httpd\" zabbix_server_webserver_user: \"apache\" zabbix_server_db: zabbix zabbix_server_db_host: \"127.0.0.1\" zabbix_server_db_port: \"3306\" zabbix_server_db_user: \"zabbix\" zabbix_server_db_password: \"zabbix\" \u4f9d\u8d56 \u00b6 Mysql, Httpd, PHP github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/zabbix-server Example Playbook \u00b6 \u6e90\u7801\u5b89\u88c5 --- # \u914d\u7f6eweb\u670d\u52a1\u5668\u548cmysql\u670d\u52a1\u5668 - hosts: node4 vars: - zabbix_server_db: zabbix - zabbix_server_db_user: zabbix - zabbix_server_db_password: zabbix - zabbix_server_db_host: 127.0.0.1 roles: - { role: mysql57 , mysql57_password: \"123456\" } - { role: php, php_httpd_enable: true, php_install_from_source: true } tasks: - name: configure_db | Create zabbix database. shell: source /etc/profile; mysql -uroot -p123456 -h192.168.77.133 -P3306 -e \"{{ item }}\" with_items: - \"create database {{ zabbix_server_db }} character set utf8 collate utf8_bin;\" - \"grant all privileges on {{ zabbix_server_db }}.* to '{{ zabbix_server_db_user }}'@'{{ zabbix_server_db_host }}' identified by '{{ zabbix_server_db_password }}';\" # \u914d\u7f6ezabbix-server - hosts: node4 vars: - zabbix_server_db: zabbix - zabbix_server_db_user: zabbix - zabbix_server_db_password: zabbix - zabbix_server_db_host: 127.0.0.1 - zabbix_server_install_from_source: true roles: - zabbix-server rpm\u65b9\u5f0f\u5b89\u88c5 --- # \u914d\u7f6eweb\u670d\u52a1\u5668\u548cmysql\u670d\u52a1\u5668 - hosts: node4 vars: - zabbix_server_db: zabbix - zabbix_server_db_user: zabbix - zabbix_server_db_password: zabbix - zabbix_server_db_host: 127.0.0.1 roles: - { role: mysql57 , mysql57_password: \"123456\" } tasks: - name: configure_db | Create zabbix database. shell: source /etc/profile; mysql -uroot -p123456 -h192.168.77.133 -P3306 -e \"{{ item }}\" with_items: - \"create database {{ zabbix_server_db }} character set utf8 collate utf8_bin;\" - \"grant all privileges on {{ zabbix_server_db }}.* to '{{ zabbix_server_db_user }}'@'{{ zabbix_server_db_host }}' identified by '{{ zabbix_server_db_password }}';\" # \u914d\u7f6ezabbix-server - hosts: node4 vars: - zabbix_server_db: zabbix - zabbix_server_db_user: zabbix - zabbix_server_db_password: zabbix - zabbix_server_db_host: 127.0.0.1 roles: - zabbix-server \u4f7f\u7528 \u00b6 ~]# /etc/init.d/zabbix-server Usage: /etc/init.d/zabbix-server {start|stop|status|restart|try-restart|force-reload} systemctl status zabbix-server","title":"zabbix-server"},{"location":"roles/monitor/zabbix-server/#ansible-role-zabbix-server","text":"\u5b89\u88c5zabbix server","title":"Ansible Role: zabbix-server"},{"location":"roles/monitor/zabbix-server/#_1","text":"zabbix\uff08\u97f3\u540c z?bix\uff09\u662f\u4e00\u4e2a\u57fa\u4e8eWEB\u754c\u9762\u7684\u63d0\u4f9b\u5206\u5e03\u5f0f\u7cfb\u7edf\u76d1\u89c6\u4ee5\u53ca\u7f51\u7edc\u76d1\u89c6\u529f\u80fd\u7684\u4f01\u4e1a\u7ea7\u7684\u5f00\u6e90\u89e3\u51b3\u65b9\u6848\u3002 zabbix server\u53ef\u4ee5\u901a\u8fc7SNMP\uff0czabbix agent\uff0cping\uff0c\u7aef\u53e3\u76d1\u89c6\u7b49\u65b9\u6cd5\u63d0\u4f9b\u5bf9\u8fdc\u7a0b\u670d\u52a1\u5668/\u7f51\u7edc\u72b6\u6001\u7684\u76d1\u89c6\uff0c\u6570\u636e\u6536\u96c6\u7b49\u529f\u80fd\uff0c\u5b83\u53ef\u4ee5\u8fd0\u884c\u5728Linux\uff0cSolaris\uff0cHP-UX\uff0cAIX\uff0cFree BSD\uff0cOpen BSD\uff0cOS X\u7b49\u5e73\u53f0\u4e0a\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.zabbix.com \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.zabbix.com/documentation/3.2/manual","title":"\u4ecb\u7ecd"},{"location":"roles/monitor/zabbix-server/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/monitor/zabbix-server/#_3","text":"ansible 2.5.1 os Centos 7.2.1511 X64 python 2.7.5","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/monitor/zabbix-server/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" zabbix_server_version: \"3.4.8\" zabbix_server_file: \"zabbix-{{ zabbix_server_version }}.tar.gz\" zabbix_server_file_path: \"{{ software_files_path }}/{{ zabbix_server_file }}\" zabbix_server_file_url: \"https://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/{{ zabbix_server_version }}/{{ zabbix_server_file }}\" zabbix_server_packages: - \"zabbix-server-mysql-{{ zabbix_server_version }}\" - \"zabbix-web-mysql-{{ zabbix_server_version }}\" - \"zabbix-agent-{{ zabbix_server_version }}\" zabbix_server_user: zabbix zabbix_server_group: zabbix zabbix_server_hostanme: \"Zabbix server\" zabbix_server_install_from_source: false zabbix_server_source_dir: \"/tmp/{{ zabbix_server_file | replace('.tar.gz','') }}\" zabbix_server_source_configure_command: > ./configure --prefix={{ software_install_path }}/zabbix-{{ zabbix_server_version }} --enable-server --enable-agent --with-mysql --enable-ipv6 --with-net-snmp --with-libcurl --with-libxml2 zabbix_server_conf_path: \"/etc/zabbix\" zabbix_server_logs_path: \"/var/log/zabbix\" zabbix_server_webroot: \"/var/www/html/zabbix\" zabbix_server_webserver: \"httpd\" zabbix_server_webserver_user: \"apache\" zabbix_server_db: zabbix zabbix_server_db_host: \"127.0.0.1\" zabbix_server_db_port: \"3306\" zabbix_server_db_user: \"zabbix\" zabbix_server_db_password: \"zabbix\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/monitor/zabbix-server/#_5","text":"Mysql, Httpd, PHP","title":"\u4f9d\u8d56"},{"location":"roles/monitor/zabbix-server/#github","text":"https://github.com/lework/Ansible-roles/tree/master/zabbix-server","title":"github\u5730\u5740"},{"location":"roles/monitor/zabbix-server/#example-playbook","text":"\u6e90\u7801\u5b89\u88c5 --- # \u914d\u7f6eweb\u670d\u52a1\u5668\u548cmysql\u670d\u52a1\u5668 - hosts: node4 vars: - zabbix_server_db: zabbix - zabbix_server_db_user: zabbix - zabbix_server_db_password: zabbix - zabbix_server_db_host: 127.0.0.1 roles: - { role: mysql57 , mysql57_password: \"123456\" } - { role: php, php_httpd_enable: true, php_install_from_source: true } tasks: - name: configure_db | Create zabbix database. shell: source /etc/profile; mysql -uroot -p123456 -h192.168.77.133 -P3306 -e \"{{ item }}\" with_items: - \"create database {{ zabbix_server_db }} character set utf8 collate utf8_bin;\" - \"grant all privileges on {{ zabbix_server_db }}.* to '{{ zabbix_server_db_user }}'@'{{ zabbix_server_db_host }}' identified by '{{ zabbix_server_db_password }}';\" # \u914d\u7f6ezabbix-server - hosts: node4 vars: - zabbix_server_db: zabbix - zabbix_server_db_user: zabbix - zabbix_server_db_password: zabbix - zabbix_server_db_host: 127.0.0.1 - zabbix_server_install_from_source: true roles: - zabbix-server rpm\u65b9\u5f0f\u5b89\u88c5 --- # \u914d\u7f6eweb\u670d\u52a1\u5668\u548cmysql\u670d\u52a1\u5668 - hosts: node4 vars: - zabbix_server_db: zabbix - zabbix_server_db_user: zabbix - zabbix_server_db_password: zabbix - zabbix_server_db_host: 127.0.0.1 roles: - { role: mysql57 , mysql57_password: \"123456\" } tasks: - name: configure_db | Create zabbix database. shell: source /etc/profile; mysql -uroot -p123456 -h192.168.77.133 -P3306 -e \"{{ item }}\" with_items: - \"create database {{ zabbix_server_db }} character set utf8 collate utf8_bin;\" - \"grant all privileges on {{ zabbix_server_db }}.* to '{{ zabbix_server_db_user }}'@'{{ zabbix_server_db_host }}' identified by '{{ zabbix_server_db_password }}';\" # \u914d\u7f6ezabbix-server - hosts: node4 vars: - zabbix_server_db: zabbix - zabbix_server_db_user: zabbix - zabbix_server_db_password: zabbix - zabbix_server_db_host: 127.0.0.1 roles: - zabbix-server","title":"Example Playbook"},{"location":"roles/monitor/zabbix-server/#_6","text":"~]# /etc/init.d/zabbix-server Usage: /etc/init.d/zabbix-server {start|stop|status|restart|try-restart|force-reload} systemctl status zabbix-server","title":"\u4f7f\u7528"},{"location":"roles/mq/kafka-manager/","text":"Ansible Role: Kafka Manager \u00b6 \u5b89\u88c5Kafka Manager\u670d\u52a1 \u4ecb\u7ecd \u00b6 Kafka Manager \u662f Yahoo \u63a8\u51fa\u7684 Kafka \u7ba1\u7406\u5de5\u5177\uff0c\u652f\u6301\uff1a \u7ba1\u7406\u591a\u4e2a\u96c6\u7fa4 \u8f7b\u677e\u68c0\u67e5\u96c6\u7fa4\u72b6\u6001 (topics, brokers, replica distribution, partition distribution) \u6267\u884c\u590d\u5236\u9009\u4e3e \u751f\u6210\u5206\u533a\u6307\u6d3e\uff0c\u57fa\u4e8e\u96c6\u7fa4\u7684\u72b6\u6001 \u5206\u533a\u7684\u91cd\u65b0\u6307\u6d3e \u8be5\u9879\u76ee\u57fa\u4e8e Play Framework \u6846\u67b6\u5f00\u53d1\u3002 github: https://github.com/yahoo/kafka-manager \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" kafka_manager_version: \"1.3.3.6\" kafka_manager_file: \"kafka-manager-{{ kafka_manager_version }}.tar.gz\" kafka_manager_file_path: \"{{ software_files_path }}/{{ kafka_manager_file }}\" kafka_manager_file_url: \"https://github.com/yahoo/kafka-manager/archive/{{ kafka_manager_version }}.tar.gz\" kafka_manager_build_file: \"kafka-manager-{{ kafka_manager_version }}.zip\" kafka_manager_build_file_path: \"{{ software_files_path }}/{{ kafka_manager_build_file }}\" kafka_manager_user: \"kafka-manager\" kafka_manager_port: 9000 kafka_manager_zk: 'localhost:2181' kafka_manager_auth: false kafka_manager_auth_user: \"admin\" kafka_manager_auth_pass: \"password\" kafka_manager_javahome: \"\" \u4f9d\u8d56 \u00b6 Kafka 0.8.1.1 or 0.8.2.* or 0.9.0.* or 0.10.0.* Java 8+ sbt github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/kafka-manager Example Playbook \u00b6 - hosts: node1 roles: - kafka-manager \u81ea\u5b9a\u4e49\u53c2\u6570 - hosts: node1 vars: - kafka_manager_javahome: \" /usr/java/jdk1.8.0_121\" - kafka_manager_zk: \"node1:2181,node2:2181,node3:2181\" - kafka_manager_port: \"8080\" roles: - { role: kafka-manager } \u4f7f\u7528 \u00b6 service kafka-manager Usage: /etc/init.d/kafka-manager {start|stop|status|restart|reload|force-reload|condrestart}","title":"kafka-manager"},{"location":"roles/mq/kafka-manager/#ansible-role-kafka-manager","text":"\u5b89\u88c5Kafka Manager\u670d\u52a1","title":"Ansible Role: Kafka Manager"},{"location":"roles/mq/kafka-manager/#_1","text":"Kafka Manager \u662f Yahoo \u63a8\u51fa\u7684 Kafka \u7ba1\u7406\u5de5\u5177\uff0c\u652f\u6301\uff1a \u7ba1\u7406\u591a\u4e2a\u96c6\u7fa4 \u8f7b\u677e\u68c0\u67e5\u96c6\u7fa4\u72b6\u6001 (topics, brokers, replica distribution, partition distribution) \u6267\u884c\u590d\u5236\u9009\u4e3e \u751f\u6210\u5206\u533a\u6307\u6d3e\uff0c\u57fa\u4e8e\u96c6\u7fa4\u7684\u72b6\u6001 \u5206\u533a\u7684\u91cd\u65b0\u6307\u6d3e \u8be5\u9879\u76ee\u57fa\u4e8e Play Framework \u6846\u67b6\u5f00\u53d1\u3002 github: https://github.com/yahoo/kafka-manager","title":"\u4ecb\u7ecd"},{"location":"roles/mq/kafka-manager/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/mq/kafka-manager/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/mq/kafka-manager/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" kafka_manager_version: \"1.3.3.6\" kafka_manager_file: \"kafka-manager-{{ kafka_manager_version }}.tar.gz\" kafka_manager_file_path: \"{{ software_files_path }}/{{ kafka_manager_file }}\" kafka_manager_file_url: \"https://github.com/yahoo/kafka-manager/archive/{{ kafka_manager_version }}.tar.gz\" kafka_manager_build_file: \"kafka-manager-{{ kafka_manager_version }}.zip\" kafka_manager_build_file_path: \"{{ software_files_path }}/{{ kafka_manager_build_file }}\" kafka_manager_user: \"kafka-manager\" kafka_manager_port: 9000 kafka_manager_zk: 'localhost:2181' kafka_manager_auth: false kafka_manager_auth_user: \"admin\" kafka_manager_auth_pass: \"password\" kafka_manager_javahome: \"\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/mq/kafka-manager/#_5","text":"Kafka 0.8.1.1 or 0.8.2.* or 0.9.0.* or 0.10.0.* Java 8+ sbt","title":"\u4f9d\u8d56"},{"location":"roles/mq/kafka-manager/#github","text":"https://github.com/lework/Ansible-roles/tree/master/kafka-manager","title":"github\u5730\u5740"},{"location":"roles/mq/kafka-manager/#example-playbook","text":"- hosts: node1 roles: - kafka-manager \u81ea\u5b9a\u4e49\u53c2\u6570 - hosts: node1 vars: - kafka_manager_javahome: \" /usr/java/jdk1.8.0_121\" - kafka_manager_zk: \"node1:2181,node2:2181,node3:2181\" - kafka_manager_port: \"8080\" roles: - { role: kafka-manager }","title":"Example Playbook"},{"location":"roles/mq/kafka-manager/#_6","text":"service kafka-manager Usage: /etc/init.d/kafka-manager {start|stop|status|restart|reload|force-reload|condrestart}","title":"\u4f7f\u7528"},{"location":"roles/mq/kafka/","text":"Ansible Role: kafka \u00b6 \u5b89\u88c5kafka\u96c6\u7fa4 \u4ecb\u7ecd \u00b6 kafka\u662fHashiCorp\u516c\u53f8\u63a8\u51fa\u7684\u4e00\u6b3e\u5f00\u6e90\u5de5\u5177\uff0c\u7528\u4e8e\u5b9e\u73b0\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u670d\u52a1\u53d1\u73b0\u4e0e\u914d\u7f6e\u3002\u4e0e\u5176\u4ed6\u7c7b\u4f3c\u4ea7\u54c1\u76f8\u6bd4\uff0c\u63d0\u4f9b\u66f4\u201c\u4e00\u7ad9\u5f0f\u201d\u7684\u89e3\u51b3\u65b9\u6848\u3002kafka\u5185\u7f6e\u6709KV\u5b58\u50a8\uff0c\u670d\u52a1\u6ce8\u518c/\u53d1\u73b0\uff0c\u5065\u5eb7\u68c0\u67e5\uff0cHTTP+DNS API\uff0cWeb UI\u7b49\u591a\u79cd\u529f\u80fd\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.kafka.io/ github: https://github.com/hashicorp/kafka \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.kafka.io/docs \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 kafka_file: \"kafka_{{ scala_version }}-{{ kafka_version }}.tgz\" kafka_file_path: \"{{ software_files_path }}/{{ kafka_file }}\" kafka_file_url: \"http://mirrors.tuna.tsinghua.edu.cn/apache/kafka/{{ kafka_version }}/{{ kafka_file }}\" kafka_user: \"kafka\" kafka_home: \"{{ software_install_path }}/kafka\" kafka_brokerid: \"{{ 300 | random(start=200) }}\" kafka_port: 9092 kafka_jmx_port: kafka_ssl_port: '' kafka_name: \"kafka{{ kafka_port if kafka_port != 9092 else '' }}\" kafka_logdirs: \"/kafka_data/logs{% if kafka_port != 9092 %}-{{ kafka_port }}{% endif %}\" kafka_conf: \"{{ kafka_home }}/config/server{% if kafka_port != 9092 %}-{{ kafka_port }}{% endif %}.properties\" kafka_zk_quorum: \"localhost:2181/kafka\" kafka_server_logsdir: \"/var/log/{{ kafka_name }}\" kafka_heap_opts: \"-Xmx1G -Xms1G\" kafka_standalone: false \u4f9d\u8d56 \u00b6 java zookeeper github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/kafka Example Playbook \u00b6 \u4ee5standalone\u65b9\u5f0f\u5b89\u88c5\u96c6\u7fa4 - hosts: node1 vars: - kafka_standalone: true roles: - { role: kafka } - { role: kafka, kafka_port: 9093 } \u5206\u5e03\u5f0f\u5b89\u88c5\u96c6\u7fa4 - hosts: node1 node2 node3 vars: - kafka_zk_quorum: \"node1:2181,node2:2181,node3:2181/kafka\" roles: - { role: kafka } \u4f7f\u7528 \u00b6 service kafka Usage: /etc/init.d/kafka {start|stop|status|restart|reload|force-reload|condrestart}","title":"kafka"},{"location":"roles/mq/kafka/#ansible-role-kafka","text":"\u5b89\u88c5kafka\u96c6\u7fa4","title":"Ansible Role: kafka"},{"location":"roles/mq/kafka/#_1","text":"kafka\u662fHashiCorp\u516c\u53f8\u63a8\u51fa\u7684\u4e00\u6b3e\u5f00\u6e90\u5de5\u5177\uff0c\u7528\u4e8e\u5b9e\u73b0\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u670d\u52a1\u53d1\u73b0\u4e0e\u914d\u7f6e\u3002\u4e0e\u5176\u4ed6\u7c7b\u4f3c\u4ea7\u54c1\u76f8\u6bd4\uff0c\u63d0\u4f9b\u66f4\u201c\u4e00\u7ad9\u5f0f\u201d\u7684\u89e3\u51b3\u65b9\u6848\u3002kafka\u5185\u7f6e\u6709KV\u5b58\u50a8\uff0c\u670d\u52a1\u6ce8\u518c/\u53d1\u73b0\uff0c\u5065\u5eb7\u68c0\u67e5\uff0cHTTP+DNS API\uff0cWeb UI\u7b49\u591a\u79cd\u529f\u80fd\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://www.kafka.io/ github: https://github.com/hashicorp/kafka \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://www.kafka.io/docs","title":"\u4ecb\u7ecd"},{"location":"roles/mq/kafka/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/mq/kafka/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/mq/kafka/#_4","text":"kafka_file: \"kafka_{{ scala_version }}-{{ kafka_version }}.tgz\" kafka_file_path: \"{{ software_files_path }}/{{ kafka_file }}\" kafka_file_url: \"http://mirrors.tuna.tsinghua.edu.cn/apache/kafka/{{ kafka_version }}/{{ kafka_file }}\" kafka_user: \"kafka\" kafka_home: \"{{ software_install_path }}/kafka\" kafka_brokerid: \"{{ 300 | random(start=200) }}\" kafka_port: 9092 kafka_jmx_port: kafka_ssl_port: '' kafka_name: \"kafka{{ kafka_port if kafka_port != 9092 else '' }}\" kafka_logdirs: \"/kafka_data/logs{% if kafka_port != 9092 %}-{{ kafka_port }}{% endif %}\" kafka_conf: \"{{ kafka_home }}/config/server{% if kafka_port != 9092 %}-{{ kafka_port }}{% endif %}.properties\" kafka_zk_quorum: \"localhost:2181/kafka\" kafka_server_logsdir: \"/var/log/{{ kafka_name }}\" kafka_heap_opts: \"-Xmx1G -Xms1G\" kafka_standalone: false","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/mq/kafka/#_5","text":"java zookeeper","title":"\u4f9d\u8d56"},{"location":"roles/mq/kafka/#github","text":"https://github.com/lework/Ansible-roles/tree/master/kafka","title":"github\u5730\u5740"},{"location":"roles/mq/kafka/#example-playbook","text":"\u4ee5standalone\u65b9\u5f0f\u5b89\u88c5\u96c6\u7fa4 - hosts: node1 vars: - kafka_standalone: true roles: - { role: kafka } - { role: kafka, kafka_port: 9093 } \u5206\u5e03\u5f0f\u5b89\u88c5\u96c6\u7fa4 - hosts: node1 node2 node3 vars: - kafka_zk_quorum: \"node1:2181,node2:2181,node3:2181/kafka\" roles: - { role: kafka }","title":"Example Playbook"},{"location":"roles/mq/kafka/#_6","text":"service kafka Usage: /etc/init.d/kafka {start|stop|status|restart|reload|force-reload|condrestart}","title":"\u4f7f\u7528"},{"location":"roles/mq/rabbitmq/","text":"Ansible Role: rabbitmq \u00b6 \u5b89\u88c5rabbitmq\u670d\u52a1 \u4ecb\u7ecd \u00b6 RabbitMQ\u662f\u4e00\u4e2a\u5728AMQP\u57fa\u7840\u4e0a\u5b8c\u6210\u7684\uff0c\u53ef\u590d\u7528\u7684\u4f01\u4e1a\u6d88\u606f\u7cfb\u7edf\u3002\u4ed6\u9075\u5faaMozilla Public License\u5f00\u6e90\u534f\u8bae\u3002 \u5b98\u65b9\u5730\u5740\uff1a http://www.rabbitmq.com/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://www.rabbitmq.com/documentation.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 7.4 X64 Debian 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" rabbitmq_version: \"3.8.2\" rabbitmq_file: \"rabbitmq-server-generic-unix-{{ rabbitmq_version }}.tar.xz\" rabbitmq_file_path: \"{{ software_files_path }}/{{ rabbitmq_file }}\" rabbitmq_file_url: \"https://github.com/rabbitmq/rabbitmq-server/releases/download/v{{ rabbitmq_version }}/rabbitmq-server-generic-unix-{{ rabbitmq_version }}.tar.xz\" rabbitmq_user: rabbitmq rabbitmq_nodename: \"rabbit@{{ ansible_hostname }}\" rabbitmq_bindip: 0.0.0.0 rabbitmq_nodeport: 5672 rabbitmq_management_port: 15672 rabbitmq_logdir: /var/log/rabbitmq rabbitmq_mnesiadir: /var/lib/rabbitmq/mnesia rabbitmq_vm: 512MiB rabbitmq_plugins: [] #rabbitmq_plugins: ['rabbitmq_top', 'rabbitmq_mqtt'] rabbitmq_server_users: [] #rabbitmq_server_users: [{user: 'test', pass: '123456', role: 'administrator'}] rabbitmq_vhost: \"/\" rabbitmq_vhost_permission : \"'.*' '.*' '.*'\" rabbitmq_policy: - \"all '^.*' '{\\\"ha-mode\\\": \\\"all\\\"}'\" rabbitmq_cluster: false rabbitmq_cluster_ram: false rabbitmq_cluster_name: rabbitmq-cluster rabbitmq_cluster_discovery_classic: false rabbitmq_cookie: \"rabbitmq-{% if rabbitmq_cluster %}cluster{% else %}sigle{% endif %}\" \u4f9d\u8d56 \u00b6 hostnames role erlang role github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/rabbitmq Example Playbook \u00b6 # \u5355\u5b9e\u4f8b\u5b89\u88c5rabbitmq --- - hosts : 192.168.77.130 roles : - erlang - rabbitmq # \u5355\u5b9e\u4f8b\u5b89\u88c5rabbitmq, \u5e76\u6307\u5b9a\u7248\u672c\u548c\u542f\u7528\u63d2\u4ef6\u548c\u6dfb\u52a0\u7528\u6237 - hosts : node1 vars : - rabbitmq_version : \"3.7.23\" - rabbitmq_plugins : [ 'rabbitmq_top' , 'rabbitmq_mqtt' ] - rabbitmq_server_users : [{ user : 'test' , pass : '123456' , role : 'administrator' }] roles : - erlang - rabbitmq # \u96c6\u7fa4\u5b89\u88c5rabbitmq, \u91c7\u7528\u955c\u50cf\u7b56\u7565 --- - hosts : 192.168.77.130 192.168.77.131 192.168.77.132 vars : - ipnames : '192.168.77.130' : 'node1' '192.168.77.131' : 'node2' '192.168.77.132' : 'node3' - rabbitmq_plugins : [ 'rabbitmq_top' , 'rabbitmq_mqtt' ] - rabbitmq_server_users : [{ user : 'test' , pass : '123456' , role : 'administrator' }] - rabbitmq_cluster : true roles : - hostnames - erlang - rabbitmq # \u96c6\u7fa4\u5b89\u88c5rabbitmq, \u91c7\u7528\u955c\u50cf\u7b56\u7565, \u4f7f\u7528\u9759\u6001\u96c6\u7fa4\u914d\u7f6e --- - hosts : 192.168.77.140 192.168.77.141 192.168.77.142 vars : - ipnames : '192.168.77.140' : 'node1' '192.168.77.141' : 'node2' '192.168.77.142' : 'node3' - rabbitmq_plugins : [ 'rabbitmq_top' , 'rabbitmq_mqtt' ] - rabbitmq_server_users : [{ user : 'test' , pass : '123456' , role : 'administrator' }] - rabbitmq_cluster : true - rabbitmq_cluster_discovery_classic : true roles : - hostnames - erlang - rabbitmq \u4f7f\u7528 \u00b6 rabbitmq-server\u7ba1\u7406 systemctl status rabbimq-server systemctl stop rabbimq-server systemctl start rabbimq-server rabbitmqctl\u7ba1\u7406 # \u5173\u95edapp su -l rabbitmq -s /bin/sh -c 'rabbitmqctl stop_app' # \u52a0\u5165\u96c6\u7fa4 su -l rabbitmq -s /bin/sh -c 'rabbitmqctl join_cluster rabbit@node1' # \u542f\u52a8app su -l rabbitmq -s /bin/sh -c 'rabbitmqctl start_app' # \u67e5\u770b\u96c6\u7fa4\u72b6\u6001 su -l rabbitmq -s /bin/sh -c 'rabbitmqctl cluster_status'","title":"rabbitmq"},{"location":"roles/mq/rabbitmq/#ansible-role-rabbitmq","text":"\u5b89\u88c5rabbitmq\u670d\u52a1","title":"Ansible Role: rabbitmq"},{"location":"roles/mq/rabbitmq/#_1","text":"RabbitMQ\u662f\u4e00\u4e2a\u5728AMQP\u57fa\u7840\u4e0a\u5b8c\u6210\u7684\uff0c\u53ef\u590d\u7528\u7684\u4f01\u4e1a\u6d88\u606f\u7cfb\u7edf\u3002\u4ed6\u9075\u5faaMozilla Public License\u5f00\u6e90\u534f\u8bae\u3002 \u5b98\u65b9\u5730\u5740\uff1a http://www.rabbitmq.com/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://www.rabbitmq.com/documentation.html","title":"\u4ecb\u7ecd"},{"location":"roles/mq/rabbitmq/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/mq/rabbitmq/#_3","text":"ansible 2.2.1.0 os Centos 7.4 X64 Debian 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/mq/rabbitmq/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" rabbitmq_version: \"3.8.2\" rabbitmq_file: \"rabbitmq-server-generic-unix-{{ rabbitmq_version }}.tar.xz\" rabbitmq_file_path: \"{{ software_files_path }}/{{ rabbitmq_file }}\" rabbitmq_file_url: \"https://github.com/rabbitmq/rabbitmq-server/releases/download/v{{ rabbitmq_version }}/rabbitmq-server-generic-unix-{{ rabbitmq_version }}.tar.xz\" rabbitmq_user: rabbitmq rabbitmq_nodename: \"rabbit@{{ ansible_hostname }}\" rabbitmq_bindip: 0.0.0.0 rabbitmq_nodeport: 5672 rabbitmq_management_port: 15672 rabbitmq_logdir: /var/log/rabbitmq rabbitmq_mnesiadir: /var/lib/rabbitmq/mnesia rabbitmq_vm: 512MiB rabbitmq_plugins: [] #rabbitmq_plugins: ['rabbitmq_top', 'rabbitmq_mqtt'] rabbitmq_server_users: [] #rabbitmq_server_users: [{user: 'test', pass: '123456', role: 'administrator'}] rabbitmq_vhost: \"/\" rabbitmq_vhost_permission : \"'.*' '.*' '.*'\" rabbitmq_policy: - \"all '^.*' '{\\\"ha-mode\\\": \\\"all\\\"}'\" rabbitmq_cluster: false rabbitmq_cluster_ram: false rabbitmq_cluster_name: rabbitmq-cluster rabbitmq_cluster_discovery_classic: false rabbitmq_cookie: \"rabbitmq-{% if rabbitmq_cluster %}cluster{% else %}sigle{% endif %}\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/mq/rabbitmq/#_5","text":"hostnames role erlang role","title":"\u4f9d\u8d56"},{"location":"roles/mq/rabbitmq/#github","text":"https://github.com/lework/Ansible-roles/tree/master/rabbitmq","title":"github\u5730\u5740"},{"location":"roles/mq/rabbitmq/#example-playbook","text":"# \u5355\u5b9e\u4f8b\u5b89\u88c5rabbitmq --- - hosts : 192.168.77.130 roles : - erlang - rabbitmq # \u5355\u5b9e\u4f8b\u5b89\u88c5rabbitmq, \u5e76\u6307\u5b9a\u7248\u672c\u548c\u542f\u7528\u63d2\u4ef6\u548c\u6dfb\u52a0\u7528\u6237 - hosts : node1 vars : - rabbitmq_version : \"3.7.23\" - rabbitmq_plugins : [ 'rabbitmq_top' , 'rabbitmq_mqtt' ] - rabbitmq_server_users : [{ user : 'test' , pass : '123456' , role : 'administrator' }] roles : - erlang - rabbitmq # \u96c6\u7fa4\u5b89\u88c5rabbitmq, \u91c7\u7528\u955c\u50cf\u7b56\u7565 --- - hosts : 192.168.77.130 192.168.77.131 192.168.77.132 vars : - ipnames : '192.168.77.130' : 'node1' '192.168.77.131' : 'node2' '192.168.77.132' : 'node3' - rabbitmq_plugins : [ 'rabbitmq_top' , 'rabbitmq_mqtt' ] - rabbitmq_server_users : [{ user : 'test' , pass : '123456' , role : 'administrator' }] - rabbitmq_cluster : true roles : - hostnames - erlang - rabbitmq # \u96c6\u7fa4\u5b89\u88c5rabbitmq, \u91c7\u7528\u955c\u50cf\u7b56\u7565, \u4f7f\u7528\u9759\u6001\u96c6\u7fa4\u914d\u7f6e --- - hosts : 192.168.77.140 192.168.77.141 192.168.77.142 vars : - ipnames : '192.168.77.140' : 'node1' '192.168.77.141' : 'node2' '192.168.77.142' : 'node3' - rabbitmq_plugins : [ 'rabbitmq_top' , 'rabbitmq_mqtt' ] - rabbitmq_server_users : [{ user : 'test' , pass : '123456' , role : 'administrator' }] - rabbitmq_cluster : true - rabbitmq_cluster_discovery_classic : true roles : - hostnames - erlang - rabbitmq","title":"Example Playbook"},{"location":"roles/mq/rabbitmq/#_6","text":"rabbitmq-server\u7ba1\u7406 systemctl status rabbimq-server systemctl stop rabbimq-server systemctl start rabbimq-server rabbitmqctl\u7ba1\u7406 # \u5173\u95edapp su -l rabbitmq -s /bin/sh -c 'rabbitmqctl stop_app' # \u52a0\u5165\u96c6\u7fa4 su -l rabbitmq -s /bin/sh -c 'rabbitmqctl join_cluster rabbit@node1' # \u542f\u52a8app su -l rabbitmq -s /bin/sh -c 'rabbitmqctl start_app' # \u67e5\u770b\u96c6\u7fa4\u72b6\u6001 su -l rabbitmq -s /bin/sh -c 'rabbitmqctl cluster_status'","title":"\u4f7f\u7528"},{"location":"roles/mq/rocketmq/","text":"rocketmq \u00b6 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/rocketmq \u670d\u52a1\u5668\u73af\u5883\u8bf4\u660e\uff1a \u00b6 ansible\u7248\u672c\uff1a2.9.3 \u7cfb\u7edf\u7248\u672c\uff1aCentOS Linux release 7.6.1810 rocketmq\u7248\u672c\uff1a4.5.2 \u670d\u52a1\u5668\u540d\u79f0 IP\u5730\u5740 \u5b89\u88c5\u89d2\u8272 rocketmq-nameserver1 192.168.60.94 nameserver\uff0cconsole rocketmq-nameserver2 192.168.60.95 nameserver rocketmq-master1 192.168.60.96 master rocketmq-master2 192.168.60.97 master rocketmq-slave1 192.168.60.98 slave rocketmq-slave2 192.168.60.99 slave Ansible\u73af\u5883\u8bf4\u660e\uff1a \u00b6 inventory\u6587\u4ef6\u8def\u5f84\u53ca\u5185\u5bb9\uff1a \u00b6 /home/floyd/devops/pv105-ansible/hosts_pve105.conf \uff08\u5907\u6ce8\uff1a\u786e\u4fddansible_user\u6307\u5b9a\u7684\u7528\u6237\u5df2\u7ecf\u6dfb\u52a0\u4e86\u65e0\u5bc6\u767b\u5f55\uff0c\u5e76\u4e14\u914d\u7f6e\u4e86\u514d\u5bc6sudo\uff09 roles\u8bf4\u660e\uff1a /home/floyd/devops/ansible/roles/rocketmq rocketmq \u251c\u2500\u2500 defaults \u2502 \u2514\u2500\u2500 main . yml \u251c\u2500\u2500 meta \u2502 \u2514\u2500\u2500 main . yml \u251c\u2500\u2500 tasks \u2502 \u251c\u2500\u2500 configure_broker . yml \u2502 \u251c\u2500\u2500 configure_nameserver . yml \u2502 \u251c\u2500\u2500 configure_os . yml \u2502 \u251c\u2500\u2500 install . yml \u2502 \u2514\u2500\u2500 main . yml \u2514\u2500\u2500 templates \u251c\u2500\u2500 mqadmin . j2 \u251c\u2500\u2500 rocketmq_broker . conf . j2 \u251c\u2500\u2500 rocketmq_broker . systemd . j2 \u251c\u2500\u2500 rocketmq_nameserver . conf . j2 \u251c\u2500\u2500 rocketmq_nameserver . systemd . j2 \u251c\u2500\u2500 runbroker . sh . j2 \u251c\u2500\u2500 runserver . sh . j2 \u251c\u2500\u2500 service_broker . sh . j2 \u2514\u2500\u2500 service_nameserver . sh . j2 /home/floyd/devops/ansible/roles/rocketmq_console rocketmq_console / \u251c\u2500\u2500 defaults \u2502 \u2514\u2500\u2500 main . yml \u251c\u2500\u2500 meta \u2502 \u2514\u2500\u2500 main . yml \u251c\u2500\u2500 tasks \u2502 \u2514\u2500\u2500 main . yml \u2514\u2500\u2500 templates \u251c\u2500\u2500 rocketmq_console . systemd . j2 \u251c\u2500\u2500 runconsole . sh . j2 \u2514\u2500\u2500 service . sh . j2 \u5176\u4e2ddefaults\u76ee\u5f55\u7684main.yml\u4fdd\u5b58\u7684\u662f\u6240\u6709\u53d8\u91cf\u7684\u9ed8\u8ba4\u503c\uff1bmeta\u76ee\u5f55\u5b58\u653e\u7684\u5f53\u524d\u89d2\u8272\u7d22\u8981\u4f9d\u8d56\u7684\u89d2\u8272\u914d\u7f6e\uff1btasks\u76ee\u5f55\u4fdd\u5b58\u7684\u662f\u5404\u7c7b\u6267\u884c\u4efb\u52a1\u7684tasks\u6587\u4ef6\uff1btemplates\u76ee\u5f55\u4fdd\u5b58\u7684\u662f\u914d\u7f6e\u6587\u4ef6\u6a21\u677f\u4ee5\u53ca\u670d\u52a1\u542f\u52a8\u811a\u672c\u6a21\u677f\uff1b playbook\u8bf4\u660e\uff1a \u00b6 /home/floyd/devops/pv105-ansible/pve105-kafka.yml \uff08\u5907\u6ce8\uff1a\u786e\u4fddsoftware_files_path\u53d8\u91cf\u5b9a\u4e49\u7684\u76ee\u5f55\u5df2\u7ecf\u5b58\u5728\uff0c\u5e76\u4e14\u5f53\u524d\u767b\u5f55\u7528\u6237\u5177\u6709\u76ee\u5f55\u7684\u8bfb\u5199\u6743\u9650\u3002\u540c\u65f6\u786e\u4fdd\u76ee\u5f55\u4e2d\u4e2d\u5b58\u5728\u5bf9\u5e94\u7248\u672c\u7684\u5b89\u88c5\u5305\u6587\u4ef6\u3001\u5bf9\u5e94\u4f9d\u8d56\u7684\u7279\u5b9a\u7248\u672c\u7684jdk\u5b89\u88c5\u5305\u6587\u4ef6\u3002\uff09 #deploy rocketmq master slave nameserver - hosts : rocketmq_test gather_facts : yes become : true vars : - software_files_path : '/home/floyd/ansible/software' - software_install_path : '/data' - rocketmq_user : 'cash' - create_user : false - rocketmq_brokerClusterName : 'rocketmq-cluster' # - rocketmq_flushDiskType: 'SYNC_FLUSH' - rocketmq_flushDiskType : 'ASYNC_FLUSH' - rocketmq_namesrvAddr : \"192.168.60.94:9876;192.168.60.95:9876\" - rocketmq_autoCreateTopicEnable : true - rocketmq_autoCreateSubscriptionGroup : true roles : - role : rocketmq rocketmq_brokerRole : 'SYNC_MASTER' rocketmq_listenPort : '10911' rocketmq_haListenPort : '10912' when : rocketmq_play == 'master' - role : rocketmq rocketmq_brokerRole : 'SLAVE' rocketmq_listenPort : '10921' rocketmq_haListenPort : '10922' when : rocketmq_play == 'slave' - role : rocketmq rocketmq_nameserver_port : 9876 when : rocketmq_play == 'nameserver' #deploy rocketmq console nameserver - hosts : rocketmq_console_test gather_facts : yes become : true vars : - software_files_path : '/home/floyd/ansible/software' - software_install_path : '/data' - rocketmq_console_user : 'cash' - createuser : false - rocketmq_namesrvAddr : \"192.168.60.94:9876;192.168.60.95:9876\" - rocketmq_console_listen_port : \"8080\" roles : - role : rocketmq_console \u5b89\u88c5\u90e8\u7f72\uff1a \u00b6 cd /home/floyd/devops/pv105-ansible/ ansible-playbook -i hosts_pve105.conf pve105-rocketmq.yml \u6267\u884c\u5b8c\u6210\uff1a \u68c0\u67e5\u5b89\u88c5\uff1a nameserver: master: console: console web\u754c\u9762\uff1a","title":"rocketmq"},{"location":"roles/mq/rocketmq/#rocketmq","text":"","title":"rocketmq"},{"location":"roles/mq/rocketmq/#github","text":"https://github.com/lework/Ansible-roles/tree/master/rocketmq","title":"github\u5730\u5740"},{"location":"roles/mq/rocketmq/#_1","text":"ansible\u7248\u672c\uff1a2.9.3 \u7cfb\u7edf\u7248\u672c\uff1aCentOS Linux release 7.6.1810 rocketmq\u7248\u672c\uff1a4.5.2 \u670d\u52a1\u5668\u540d\u79f0 IP\u5730\u5740 \u5b89\u88c5\u89d2\u8272 rocketmq-nameserver1 192.168.60.94 nameserver\uff0cconsole rocketmq-nameserver2 192.168.60.95 nameserver rocketmq-master1 192.168.60.96 master rocketmq-master2 192.168.60.97 master rocketmq-slave1 192.168.60.98 slave rocketmq-slave2 192.168.60.99 slave","title":"\u670d\u52a1\u5668\u73af\u5883\u8bf4\u660e\uff1a"},{"location":"roles/mq/rocketmq/#ansible","text":"","title":"Ansible\u73af\u5883\u8bf4\u660e\uff1a"},{"location":"roles/mq/rocketmq/#inventory","text":"/home/floyd/devops/pv105-ansible/hosts_pve105.conf \uff08\u5907\u6ce8\uff1a\u786e\u4fddansible_user\u6307\u5b9a\u7684\u7528\u6237\u5df2\u7ecf\u6dfb\u52a0\u4e86\u65e0\u5bc6\u767b\u5f55\uff0c\u5e76\u4e14\u914d\u7f6e\u4e86\u514d\u5bc6sudo\uff09 roles\u8bf4\u660e\uff1a /home/floyd/devops/ansible/roles/rocketmq rocketmq \u251c\u2500\u2500 defaults \u2502 \u2514\u2500\u2500 main . yml \u251c\u2500\u2500 meta \u2502 \u2514\u2500\u2500 main . yml \u251c\u2500\u2500 tasks \u2502 \u251c\u2500\u2500 configure_broker . yml \u2502 \u251c\u2500\u2500 configure_nameserver . yml \u2502 \u251c\u2500\u2500 configure_os . yml \u2502 \u251c\u2500\u2500 install . yml \u2502 \u2514\u2500\u2500 main . yml \u2514\u2500\u2500 templates \u251c\u2500\u2500 mqadmin . j2 \u251c\u2500\u2500 rocketmq_broker . conf . j2 \u251c\u2500\u2500 rocketmq_broker . systemd . j2 \u251c\u2500\u2500 rocketmq_nameserver . conf . j2 \u251c\u2500\u2500 rocketmq_nameserver . systemd . j2 \u251c\u2500\u2500 runbroker . sh . j2 \u251c\u2500\u2500 runserver . sh . j2 \u251c\u2500\u2500 service_broker . sh . j2 \u2514\u2500\u2500 service_nameserver . sh . j2 /home/floyd/devops/ansible/roles/rocketmq_console rocketmq_console / \u251c\u2500\u2500 defaults \u2502 \u2514\u2500\u2500 main . yml \u251c\u2500\u2500 meta \u2502 \u2514\u2500\u2500 main . yml \u251c\u2500\u2500 tasks \u2502 \u2514\u2500\u2500 main . yml \u2514\u2500\u2500 templates \u251c\u2500\u2500 rocketmq_console . systemd . j2 \u251c\u2500\u2500 runconsole . sh . j2 \u2514\u2500\u2500 service . sh . j2 \u5176\u4e2ddefaults\u76ee\u5f55\u7684main.yml\u4fdd\u5b58\u7684\u662f\u6240\u6709\u53d8\u91cf\u7684\u9ed8\u8ba4\u503c\uff1bmeta\u76ee\u5f55\u5b58\u653e\u7684\u5f53\u524d\u89d2\u8272\u7d22\u8981\u4f9d\u8d56\u7684\u89d2\u8272\u914d\u7f6e\uff1btasks\u76ee\u5f55\u4fdd\u5b58\u7684\u662f\u5404\u7c7b\u6267\u884c\u4efb\u52a1\u7684tasks\u6587\u4ef6\uff1btemplates\u76ee\u5f55\u4fdd\u5b58\u7684\u662f\u914d\u7f6e\u6587\u4ef6\u6a21\u677f\u4ee5\u53ca\u670d\u52a1\u542f\u52a8\u811a\u672c\u6a21\u677f\uff1b","title":"inventory\u6587\u4ef6\u8def\u5f84\u53ca\u5185\u5bb9\uff1a"},{"location":"roles/mq/rocketmq/#playbook","text":"/home/floyd/devops/pv105-ansible/pve105-kafka.yml \uff08\u5907\u6ce8\uff1a\u786e\u4fddsoftware_files_path\u53d8\u91cf\u5b9a\u4e49\u7684\u76ee\u5f55\u5df2\u7ecf\u5b58\u5728\uff0c\u5e76\u4e14\u5f53\u524d\u767b\u5f55\u7528\u6237\u5177\u6709\u76ee\u5f55\u7684\u8bfb\u5199\u6743\u9650\u3002\u540c\u65f6\u786e\u4fdd\u76ee\u5f55\u4e2d\u4e2d\u5b58\u5728\u5bf9\u5e94\u7248\u672c\u7684\u5b89\u88c5\u5305\u6587\u4ef6\u3001\u5bf9\u5e94\u4f9d\u8d56\u7684\u7279\u5b9a\u7248\u672c\u7684jdk\u5b89\u88c5\u5305\u6587\u4ef6\u3002\uff09 #deploy rocketmq master slave nameserver - hosts : rocketmq_test gather_facts : yes become : true vars : - software_files_path : '/home/floyd/ansible/software' - software_install_path : '/data' - rocketmq_user : 'cash' - create_user : false - rocketmq_brokerClusterName : 'rocketmq-cluster' # - rocketmq_flushDiskType: 'SYNC_FLUSH' - rocketmq_flushDiskType : 'ASYNC_FLUSH' - rocketmq_namesrvAddr : \"192.168.60.94:9876;192.168.60.95:9876\" - rocketmq_autoCreateTopicEnable : true - rocketmq_autoCreateSubscriptionGroup : true roles : - role : rocketmq rocketmq_brokerRole : 'SYNC_MASTER' rocketmq_listenPort : '10911' rocketmq_haListenPort : '10912' when : rocketmq_play == 'master' - role : rocketmq rocketmq_brokerRole : 'SLAVE' rocketmq_listenPort : '10921' rocketmq_haListenPort : '10922' when : rocketmq_play == 'slave' - role : rocketmq rocketmq_nameserver_port : 9876 when : rocketmq_play == 'nameserver' #deploy rocketmq console nameserver - hosts : rocketmq_console_test gather_facts : yes become : true vars : - software_files_path : '/home/floyd/ansible/software' - software_install_path : '/data' - rocketmq_console_user : 'cash' - createuser : false - rocketmq_namesrvAddr : \"192.168.60.94:9876;192.168.60.95:9876\" - rocketmq_console_listen_port : \"8080\" roles : - role : rocketmq_console","title":"playbook\u8bf4\u660e\uff1a"},{"location":"roles/mq/rocketmq/#_2","text":"cd /home/floyd/devops/pv105-ansible/ ansible-playbook -i hosts_pve105.conf pve105-rocketmq.yml \u6267\u884c\u5b8c\u6210\uff1a \u68c0\u67e5\u5b89\u88c5\uff1a nameserver: master: console: console web\u754c\u9762\uff1a","title":"\u5b89\u88c5\u90e8\u7f72\uff1a"},{"location":"roles/other/chrony/","text":"Ansible Role: chrony \u00b6 \u5b89\u88c5chrony,\u5b9e\u73b0\u65f6\u95f4\u540c\u6b65. \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.8.5 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/chrony Example Playbook \u00b6 - hosts: servers roles: - chrony \u9a8c\u8bc1 \u00b6 chronyc sourcestats 210 Number of sources = 6 Name/IP Address NP NR Span Frequency Freq Skew Offset Std Dev ============================================================================== 119.28.206.193 4 4 6 -45.185 2425.458 -9572us 309us de-user.deepinid.deepin.> 4 3 8 +530.643 32458.904 -1419us 4953us ntp-b2.nict.go.jp 4 3 7 -216.268 20531.617 +24ms 2677us 149.28.28.160.vultr.com 4 3 7 +11.863 22120.141 +24ms 2745us ntp.wdc1.us.leaseweb.net 0 0 0 +0.000 2000.000 +0ns 4000ms sv1.ggsrv.de 0 0 0 +0.000 2000.000 +0ns 4000m chronyc sources -v chronyc tracking","title":"chrony"},{"location":"roles/other/chrony/#ansible-role-chrony","text":"\u5b89\u88c5chrony,\u5b9e\u73b0\u65f6\u95f4\u540c\u6b65.","title":"Ansible Role: chrony"},{"location":"roles/other/chrony/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/other/chrony/#_2","text":"ansible 2.8.5 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/other/chrony/#_3","text":"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/other/chrony/#_4","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/other/chrony/#github","text":"https://github.com/lework/Ansible-roles/tree/master/chrony","title":"github\u5730\u5740"},{"location":"roles/other/chrony/#example-playbook","text":"- hosts: servers roles: - chrony","title":"Example Playbook"},{"location":"roles/other/chrony/#_5","text":"chronyc sourcestats 210 Number of sources = 6 Name/IP Address NP NR Span Frequency Freq Skew Offset Std Dev ============================================================================== 119.28.206.193 4 4 6 -45.185 2425.458 -9572us 309us de-user.deepinid.deepin.> 4 3 8 +530.643 32458.904 -1419us 4953us ntp-b2.nict.go.jp 4 3 7 -216.268 20531.617 +24ms 2677us 149.28.28.160.vultr.com 4 3 7 +11.863 22120.141 +24ms 2745us ntp.wdc1.us.leaseweb.net 0 0 0 +0.000 2000.000 +0ns 4000ms sv1.ggsrv.de 0 0 0 +0.000 2000.000 +0ns 4000m chronyc sources -v chronyc tracking","title":"\u9a8c\u8bc1"},{"location":"roles/other/confd/","text":"Ansible Role: confd \u00b6 \u5b89\u88c5confd confd\u662f\u4e00\u4e2a\u7edf\u4e00\u914d\u7f6e\u7ba1\u7406\u5de5\u5177\uff0c\u76ee\u524d\u4ecd\u5728\u5f00\u53d1\u4e2d\uff0c\u57fa\u4e8e\u672c\u5730\u6587\u4ef6\u5b58\u50a8\u7684\u90e8\u7f72\u65b9\u5f0f\u5df2\u7ecf\u53ef\u4ee5\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u4e2d\u3002 github: https://github.com/kelseyhightower/confd \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" confd_version: \"0.15.0\" confd_file: \"confd-{{ confd_version }}-linux-amd64\" confd_path: \"{{ software_install_path }}/confd\" confd_file_path: \"{{ software_files_path }}/{{ confd_file }}\" confd_file_url: \"https://github.com/kelseyhightower/confd/releases/download/v{{ confd_version }}/{{ confd_file }}\" confd_manager_app: \"nginx\" confd_backend: \"etcd\" confd_backend_node: \"http://127.0.0.1:2379\" confd_interval: 3 confd_run_opts: > -interval {{ confd_interval }} -confdir {{ confd_path }} -backend {{ confd_backend}} -node {{ confd_backend_node}} \u4f9d\u8d56 \u00b6 etcd nginx github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/confd Example Playbook \u00b6 \u4f7f\u7528etcd\u6765\u6765\u914d\u7f6enginx - hosts: node1 roles: - confd \u4f7f\u7528 \u00b6 \u914d\u7f6e \u00b6 etcdctl set /nginx_app/domain www.myapp.com etcdctl set /nginx_app/upstream/app0 '10.0.1.100:80' etcdctl set /nginx_app/upstream/app1 '10.0.1.101:80' nginx\u914d\u7f6e \u00b6 nginx\u5bb6\u76ee\u5f55\u5730\u5740\uff1a /usr/local/nginx \u5728 nginx.conf \u91cc\u589e\u52a0 include app.conf \u542f\u52a8 \u00b6 systemctl start confd","title":"confd"},{"location":"roles/other/confd/#ansible-role-confd","text":"\u5b89\u88c5confd confd\u662f\u4e00\u4e2a\u7edf\u4e00\u914d\u7f6e\u7ba1\u7406\u5de5\u5177\uff0c\u76ee\u524d\u4ecd\u5728\u5f00\u53d1\u4e2d\uff0c\u57fa\u4e8e\u672c\u5730\u6587\u4ef6\u5b58\u50a8\u7684\u90e8\u7f72\u65b9\u5f0f\u5df2\u7ecf\u53ef\u4ee5\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u4e2d\u3002 github: https://github.com/kelseyhightower/confd","title":"Ansible Role: confd"},{"location":"roles/other/confd/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/other/confd/#_2","text":"ansible 2.4.2.0 python 2.7.5 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/other/confd/#_3","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" confd_version: \"0.15.0\" confd_file: \"confd-{{ confd_version }}-linux-amd64\" confd_path: \"{{ software_install_path }}/confd\" confd_file_path: \"{{ software_files_path }}/{{ confd_file }}\" confd_file_url: \"https://github.com/kelseyhightower/confd/releases/download/v{{ confd_version }}/{{ confd_file }}\" confd_manager_app: \"nginx\" confd_backend: \"etcd\" confd_backend_node: \"http://127.0.0.1:2379\" confd_interval: 3 confd_run_opts: > -interval {{ confd_interval }} -confdir {{ confd_path }} -backend {{ confd_backend}} -node {{ confd_backend_node}}","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/other/confd/#_4","text":"etcd nginx","title":"\u4f9d\u8d56"},{"location":"roles/other/confd/#github","text":"https://github.com/lework/Ansible-roles/tree/master/confd","title":"github\u5730\u5740"},{"location":"roles/other/confd/#example-playbook","text":"\u4f7f\u7528etcd\u6765\u6765\u914d\u7f6enginx - hosts: node1 roles: - confd","title":"Example Playbook"},{"location":"roles/other/confd/#_5","text":"","title":"\u4f7f\u7528"},{"location":"roles/other/confd/#_6","text":"etcdctl set /nginx_app/domain www.myapp.com etcdctl set /nginx_app/upstream/app0 '10.0.1.100:80' etcdctl set /nginx_app/upstream/app1 '10.0.1.101:80'","title":"\u914d\u7f6e"},{"location":"roles/other/confd/#nginx","text":"nginx\u5bb6\u76ee\u5f55\u5730\u5740\uff1a /usr/local/nginx \u5728 nginx.conf \u91cc\u589e\u52a0 include app.conf","title":"nginx\u914d\u7f6e"},{"location":"roles/other/confd/#_7","text":"systemctl start confd","title":"\u542f\u52a8"},{"location":"roles/other/iptables/","text":"Ansible Role: iptables \u00b6 \u7ba1\u7406CentOS\u7684iptables \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 iptables_allowed_tcp_ports: '' iptables_allowed_udp_ports: '' iptables_deny_tcp_ports: '' iptables_deny_udp_ports: '' iptables_forwarded_tcp_ports: '' iptables_forwarded_udp_ports: '' iptables_additional_rules: '' iptables_action: 'insert' iptables_state: 'present' \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/iptables Example Playbook \u00b6 - hosts: server roles: - { role: iptables, iptables_allowed_tcp_ports: [ \"22\", \"80\"]} - hosts: server roles: - { role: iptables, iptables_allowed_tcp_ports: [ \"22\", \"80\"], iptables_state: 'absent'} - hosts: server roles: - { role: iptables, iptables_forwarded_tcp_ports: [{ src: \"80\", dest: \"8080\" }, { src: \"11\", dest: \"1111\" }]} - hosts: server roles: - { role: iptables, iptables_additional_rules: \"iptables -A INPUT -j DROP\", iptables_action: \"append\"} \u4f7f\u7528 \u00b6 ~]# /etc/init.d/iptables Usage: iptables {start|stop|reload|restart|condrestart|status|panic|save}","title":"iptables"},{"location":"roles/other/iptables/#ansible-role-iptables","text":"\u7ba1\u7406CentOS\u7684iptables","title":"Ansible Role: iptables"},{"location":"roles/other/iptables/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/other/iptables/#_2","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/other/iptables/#_3","text":"iptables_allowed_tcp_ports: '' iptables_allowed_udp_ports: '' iptables_deny_tcp_ports: '' iptables_deny_udp_ports: '' iptables_forwarded_tcp_ports: '' iptables_forwarded_udp_ports: '' iptables_additional_rules: '' iptables_action: 'insert' iptables_state: 'present'","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/other/iptables/#_4","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/other/iptables/#github","text":"https://github.com/lework/Ansible-roles/tree/master/iptables","title":"github\u5730\u5740"},{"location":"roles/other/iptables/#example-playbook","text":"- hosts: server roles: - { role: iptables, iptables_allowed_tcp_ports: [ \"22\", \"80\"]} - hosts: server roles: - { role: iptables, iptables_allowed_tcp_ports: [ \"22\", \"80\"], iptables_state: 'absent'} - hosts: server roles: - { role: iptables, iptables_forwarded_tcp_ports: [{ src: \"80\", dest: \"8080\" }, { src: \"11\", dest: \"1111\" }]} - hosts: server roles: - { role: iptables, iptables_additional_rules: \"iptables -A INPUT -j DROP\", iptables_action: \"append\"}","title":"Example Playbook"},{"location":"roles/other/iptables/#_5","text":"~]# /etc/init.d/iptables Usage: iptables {start|stop|reload|restart|condrestart|status|panic|save}","title":"\u4f7f\u7528"},{"location":"roles/other/ntp/","text":"Ansible Role: ntp \u00b6 \u5b89\u88c5ntp\u5ba2\u6237\u7aef,\u5b9e\u73b0\u65f6\u95f4\u540c\u6b65. \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.8.1 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/ntp Example Playbook \u00b6 - hosts: servers roles: - ntp \u9a8c\u8bc1 \u00b6 ntpq -p remote refid st t when poll reach delay offset jitter ============================================================================== ntp7.flashdance 77.40.226.114 2 u 25 64 1 286.685 3.939 0.000 crimson.en.kku. .PPS. 1 u 24 64 1 123.759 -24.300 0.000 202-65-114-202. .INIT. 16 u - 64 0 0.000 0.000 0.000","title":"ntp"},{"location":"roles/other/ntp/#ansible-role-ntp","text":"\u5b89\u88c5ntp\u5ba2\u6237\u7aef,\u5b9e\u73b0\u65f6\u95f4\u540c\u6b65.","title":"Ansible Role: ntp"},{"location":"roles/other/ntp/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/other/ntp/#_2","text":"ansible 2.8.1 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/other/ntp/#_3","text":"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/other/ntp/#_4","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/other/ntp/#github","text":"https://github.com/lework/Ansible-roles/tree/master/ntp","title":"github\u5730\u5740"},{"location":"roles/other/ntp/#example-playbook","text":"- hosts: servers roles: - ntp","title":"Example Playbook"},{"location":"roles/other/ntp/#_5","text":"ntpq -p remote refid st t when poll reach delay offset jitter ============================================================================== ntp7.flashdance 77.40.226.114 2 u 25 64 1 286.685 3.939 0.000 crimson.en.kku. .PPS. 1 u 24 64 1 123.759 -24.300 0.000 202-65-114-202. .INIT. 16 u - 64 0 0.000 0.000 0.000","title":"\u9a8c\u8bc1"},{"location":"roles/other/os-check/","text":"Ansible Role: os-check \u00b6 \u9488\u5bf9linux\u7cfb\u7edf\u8fdb\u884c\u8d44\u6e90\u5de1\u68c0\uff0c\u751f\u6210\u5de1\u68c0\u62a5\u544a\u540e\u901a\u8fc7\u90ae\u4ef6\u53d1\u9001\u7ed9\u63a5\u6536\u4eba \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728linux\u7cfb\u7edf\u4e0a\u6267\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.7.0 os Centos 7 X64 python 2.7.5 \u89d2\u8272\u53d8\u91cf \u00b6 check_day: \"{{ '%Y-%m-%d' | strftime }}\" # \u8bbe\u7f6e\u62a5\u544a\u5b58\u50a8\u7684\u76ee\u5f55 check_report_path: /tmp check_report_file_suffix: \"-{{ check_day }}\" # \u8bbe\u7f6esmtp\u8d26\u53f7\u4fe1\u606f check_mail_host: \"\" check_mail_port: \"\" check_mail_username: \"\" check_mail_password: \"\" check_mail_to: [] check_mail_subject: \"System Check Report [{{ check_day }}]\" \u4f9d\u8d56 \u00b6 \u8fc7\u6ee4\u5668\u63d2\u4ef6 filter_plugins/os-check.py [get_check_data] \u76ee\u6807\u673a bash Github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/os-check Example Playbook \u00b6 --- - hosts: all gather_facts: false vars: check_report_path: /tmp check_mail_host: \"smtp.lework.com\" check_mail_port: \"465\" check_mail_username: \"ops@lework.com\" check_mail_password: \"le123456\" check_mail_to: [\"ops@lework.com\"] roles: - os-check \u8fd9\u91cc\u6ce8\u610f\u4e0b\uff0ccheck_mail_*\u7684\u914d\u7f6e\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684\u662fssl\u52a0\u5bc6\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u5982\u679c\u8981\u5176\u4ed6\u7684\u65b9\u5f0f\u914d\u7f6e\u8bf7\u4f7f\u7528 ansible-doc mail \u67e5\u770b\u4f7f\u7528\u65b9\u6cd5\uff0c\u9488\u5bf9\u81ea\u8eab\u60c5\u51b5\u914d\u7f6email\u3002 \u6267\u884c\u6d41\u7a0b \u00b6 \u4f7f\u7528\u811a\u672c files\\check_linux.sh \u5728\u8fdc\u7aef\u6267\u884c\u83b7\u53d6\u8d44\u6e90\u6570\u636e\uff0c\u5e76\u4ee5json\u7ed3\u6784\u4f53\u8fd4\u56de\u3002 \u4f7f\u7528 jinja2 \u6a21\u677f\u5c06\u83b7\u53d6\u7684\u6570\u636e\u6e32\u67d3\u5230\u6a21\u677f\u6587\u4ef6\u4e2d templates\\report-cssinline.html ,\u751f\u6210\u7684\u6587\u4ef6\u5b58\u653e\u5728\u6307\u5b9a\u7684\u76ee\u5f55\u4e2d\u3002 report-cssinline.html \u662f\u5c06css\u8bbe\u7f6e\u4ee5 inline \u7684\u65b9\u5f0f\u5b58\u50a8\u7684html\u6587\u4ef6, report.html \u624d\u662f\u6e90\u6a21\u677f\u6587\u4ef6\uff0c\u4fee\u6539\u5b8c\u6e90\u6a21\u677f\u6587\u4ef6\u540e\uff0c\u4f7f\u7528 Responsive Email CSS Inliner \u8fdb\u884c\u8f6c\u6362\u4e0b\uff0c\u624d\u80fd\u66f4\u597d\u7684\u517c\u5bb9\u90ae\u4ef6\u663e\u793a\u3002 \u5176\u4e2d\u6a21\u677f\u4e2d\u4f7f\u7528\u7684 get_check_data \u8fc7\u6ee4\u5668\u662f\u4ece hostvars \u4e2d\u83b7\u53d6\u6bcf\u53f0\u4e3b\u673a\u7684\u811a\u672c\u6267\u884c\u7ed3\u679c\uff0c\u8fdb\u884c\u5206\u6790\u6574\u7406\u4f20\u9012\u7ed9\u6a21\u677f\uff0c\u4f7f\u7528\u4f20\u9012\u56de\u6765\u7684\u6570\u636e\u8fdb\u884c\u6e32\u67d3\u3002 \u83b7\u53d6\u751f\u6210\u7684\u6a21\u677f\u6587\u4ef6\u5185\u5bb9\uff0c\u5e76\u901a\u8fc7smtp\u53d1\u9001\u7ed9\u63a5\u6536\u4eba\u3002 \u7edf\u8ba1\u7684\u7cfb\u7edf\u8d44\u6e90 \u00b6 Hostname Main IP OS CPU Used CPU LoadAvg Mem Used Swap Used Disk Size Used Disk Inode Used Tcp Connection Used Timestamp","title":"os-check"},{"location":"roles/other/os-check/#ansible-role-os-check","text":"\u9488\u5bf9linux\u7cfb\u7edf\u8fdb\u884c\u8d44\u6e90\u5de1\u68c0\uff0c\u751f\u6210\u5de1\u68c0\u62a5\u544a\u540e\u901a\u8fc7\u90ae\u4ef6\u53d1\u9001\u7ed9\u63a5\u6536\u4eba","title":"Ansible Role: os-check"},{"location":"roles/other/os-check/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728linux\u7cfb\u7edf\u4e0a\u6267\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/other/os-check/#_2","text":"ansible 2.7.0 os Centos 7 X64 python 2.7.5","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/other/os-check/#_3","text":"check_day: \"{{ '%Y-%m-%d' | strftime }}\" # \u8bbe\u7f6e\u62a5\u544a\u5b58\u50a8\u7684\u76ee\u5f55 check_report_path: /tmp check_report_file_suffix: \"-{{ check_day }}\" # \u8bbe\u7f6esmtp\u8d26\u53f7\u4fe1\u606f check_mail_host: \"\" check_mail_port: \"\" check_mail_username: \"\" check_mail_password: \"\" check_mail_to: [] check_mail_subject: \"System Check Report [{{ check_day }}]\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/other/os-check/#_4","text":"\u8fc7\u6ee4\u5668\u63d2\u4ef6 filter_plugins/os-check.py [get_check_data] \u76ee\u6807\u673a bash","title":"\u4f9d\u8d56"},{"location":"roles/other/os-check/#github","text":"https://github.com/lework/Ansible-roles/tree/master/os-check","title":"Github\u5730\u5740"},{"location":"roles/other/os-check/#example-playbook","text":"--- - hosts: all gather_facts: false vars: check_report_path: /tmp check_mail_host: \"smtp.lework.com\" check_mail_port: \"465\" check_mail_username: \"ops@lework.com\" check_mail_password: \"le123456\" check_mail_to: [\"ops@lework.com\"] roles: - os-check \u8fd9\u91cc\u6ce8\u610f\u4e0b\uff0ccheck_mail_*\u7684\u914d\u7f6e\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684\u662fssl\u52a0\u5bc6\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u5982\u679c\u8981\u5176\u4ed6\u7684\u65b9\u5f0f\u914d\u7f6e\u8bf7\u4f7f\u7528 ansible-doc mail \u67e5\u770b\u4f7f\u7528\u65b9\u6cd5\uff0c\u9488\u5bf9\u81ea\u8eab\u60c5\u51b5\u914d\u7f6email\u3002","title":"Example Playbook"},{"location":"roles/other/os-check/#_5","text":"\u4f7f\u7528\u811a\u672c files\\check_linux.sh \u5728\u8fdc\u7aef\u6267\u884c\u83b7\u53d6\u8d44\u6e90\u6570\u636e\uff0c\u5e76\u4ee5json\u7ed3\u6784\u4f53\u8fd4\u56de\u3002 \u4f7f\u7528 jinja2 \u6a21\u677f\u5c06\u83b7\u53d6\u7684\u6570\u636e\u6e32\u67d3\u5230\u6a21\u677f\u6587\u4ef6\u4e2d templates\\report-cssinline.html ,\u751f\u6210\u7684\u6587\u4ef6\u5b58\u653e\u5728\u6307\u5b9a\u7684\u76ee\u5f55\u4e2d\u3002 report-cssinline.html \u662f\u5c06css\u8bbe\u7f6e\u4ee5 inline \u7684\u65b9\u5f0f\u5b58\u50a8\u7684html\u6587\u4ef6, report.html \u624d\u662f\u6e90\u6a21\u677f\u6587\u4ef6\uff0c\u4fee\u6539\u5b8c\u6e90\u6a21\u677f\u6587\u4ef6\u540e\uff0c\u4f7f\u7528 Responsive Email CSS Inliner \u8fdb\u884c\u8f6c\u6362\u4e0b\uff0c\u624d\u80fd\u66f4\u597d\u7684\u517c\u5bb9\u90ae\u4ef6\u663e\u793a\u3002 \u5176\u4e2d\u6a21\u677f\u4e2d\u4f7f\u7528\u7684 get_check_data \u8fc7\u6ee4\u5668\u662f\u4ece hostvars \u4e2d\u83b7\u53d6\u6bcf\u53f0\u4e3b\u673a\u7684\u811a\u672c\u6267\u884c\u7ed3\u679c\uff0c\u8fdb\u884c\u5206\u6790\u6574\u7406\u4f20\u9012\u7ed9\u6a21\u677f\uff0c\u4f7f\u7528\u4f20\u9012\u56de\u6765\u7684\u6570\u636e\u8fdb\u884c\u6e32\u67d3\u3002 \u83b7\u53d6\u751f\u6210\u7684\u6a21\u677f\u6587\u4ef6\u5185\u5bb9\uff0c\u5e76\u901a\u8fc7smtp\u53d1\u9001\u7ed9\u63a5\u6536\u4eba\u3002","title":"\u6267\u884c\u6d41\u7a0b"},{"location":"roles/other/os-check/#_6","text":"Hostname Main IP OS CPU Used CPU LoadAvg Mem Used Swap Used Disk Size Used Disk Inode Used Tcp Connection Used Timestamp","title":"\u7edf\u8ba1\u7684\u7cfb\u7edf\u8d44\u6e90"},{"location":"roles/other/supervisor/","text":"Ansible Role: supervisor \u00b6 \u5b89\u88c5supervisor \u4ecb\u7ecd \u00b6 Supervisor\u662f\u4e00\u4e2a\u8fdb\u7a0b\u76d1\u63a7\u7a0b\u5e8f\u3002 \u6ee1\u8db3\u7684\u9700\u6c42\u662f\uff1a\u6211\u73b0\u5728\u6709\u4e00\u4e2a\u8fdb\u7a0b\u9700\u8981\u6bcf\u65f6\u6bcf\u523b\u4e0d\u65ad\u7684\u8dd1\uff0c\u4f46\u662f\u8fd9\u4e2a\u8fdb\u7a0b\u53c8\u6709\u53ef\u80fd\u7531\u4e8e\u5404\u79cd\u539f\u56e0\u6709\u53ef\u80fd\u4e2d\u65ad\u3002\u5f53\u8fdb\u7a0b\u4e2d\u65ad\u7684\u65f6\u5019\u6211\u5e0c\u671b\u80fd\u81ea\u52a8\u91cd\u65b0\u542f\u52a8\u5b83\uff0c\u6b64\u65f6\uff0c\u6211\u5c31\u9700\u8981\u4f7f\u7528\u5230\u4e86Supervisor. Supervisor\u7684\u4e24\u4e2a\u547d\u4ee4: supervisord\uff1a supervisor\u7684\u670d\u52a1\u5668\u7aef\u90e8\u5206\uff0c\u542f\u52a8supervisor\u5c31\u662f\u8fd0\u884c\u8fd9\u4e2a\u547d\u4ee4 supervisorctl\uff1a\u542f\u52a8supervisor\u7684\u547d\u4ee4\u884c\u7a97\u53e3\u3002 github\u5730\u5740\uff1a https://github.com/Supervisor/supervisor \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://supervisord.org/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.9.1 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 --- # pip \u56fd\u5185\u6e90 supervisor_package_index : https://pypi.tuna.tsinghua.edu.cn/simple # supervisor\u7248\u672c, \u9ed8\u8ba4\u662f\u6700\u65b0\u7248\u672c supervisor_version : null supervisor_pip_package : - \"{%if ansible_python.version.major == 3%}python3-pip{%else%}python-pip{%endif%}\" # supervisor\u7684\u4f9d\u8d56\u5305 supervisor_supervisor_package : - name : supervisor version : \"{% if not supervisor_version and ansible_python.version.major == 2 and ansible_python.version.micro < 7 %}3.4.0{%else%}{{supervisor_version}}{%endif%}\" - \"{%- if ansible_python.version.major == 2 and ansible_python.version.micro < 7 -%}{{ '{\\\"name\\\": \\\"meld3\\\", \\\"version\\\": \\\"0.6.10\\\"}' | from_json }}{%- endif -%}\" # \u662f\u5426\u542f\u52a8supervisor supervisor_started : true supervisor_enabled : true supervisor_config_path : /etc/supervisor supervisor_log_path : /var/log/supervisor supervisor_nodaemon : false # supervisor\u7684\u8fd0\u884c\u7528\u6237\u548c\u5bc6\u7801 supervisor_user : root supervisor_password : '' # socket\u65b9\u5f0f supervisor_unix_http_server_enable : true supervisor_unix_http_server_socket_path : /var/run/supervisor.sock # http\u65b9\u5f0f supervisor_inet_http_server_enable : false supervisor_inet_http_server_port : '127.0.0.1:9001' # \u5b9a\u4e49supervisor\u7ba1\u7406\u7684program supervisor_programs : [] # - name: 'example' # command: java -jar /tmp/example.jar # - name: 'apache' # command: apache2ctl -c \"ErrorLog /dev/stdout\" -DFOREGROUND # configuration: | # autostart=true # autorestart=true # startretries=1 # startsecs=1 # redirect_stderr=true # stderr_logfile=/var/log/apache-err.log # stdout_logfile=/var/log/apache-out.log # user=root # killasgroup=true # stopasgroup=true # \u5f00\u542fsupervisor\u7684\u5065\u5eb7\u68c0\u67e5, \u8be6\u7ec6config\u89c1\u811a\u672c supervisor_healthCheck_enable : false supervisor_healthCheck_config : | config: # supervisordUrl: http://localhost:9001/RPC2 mail: # host: 'smtp.test.com' # port: '465' # user: 'ops@test.com' # pass: '123415' # to_list: ['test@test.com'] wechat: corpid: \"\" secret: \"\" agentid: \"\" toparty: \"\" example: type: HTTP method: GET host: 127.0.0.1 port: 80 path: /test periodSeconds: 5 timeoutSeconds: 5 failureThreshold: 2 successThreshold: 1 action: restart,wechat # \u5f00\u542fsupervisor\u7684Prometheus\u7684metrics\u6307\u6807 supervisor_exporter_enable : false supervisor_exporter_port : 8081 \u4f9d\u8d56 \u00b6 facts epel pip python github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/supervisor Example Playbook \u00b6 # \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - supervisor # \u5b9a\u4e49supervisor\u7ba1\u7406\u7684program - hosts : node1 vars : - supervisor_unix_http_server_enable : false - supervisor_inet_http_server_enable : true - supervisor_programs : - name : 'example' command : python -m SimpleHTTPServer - name : 'example2' command : python -m SimpleHTTPServer 8082 configuration : | process_name=%(program_name)s numprocs=1 autostart=true startsecs=2 startretries=5 autorestart=true stopsignal=TERM stopwaitsecs=3 stopasgroup=true killasgroup=true user=root redirect_stderr=true stdout_logfile=/var/log/supervisor/example2.log stdout_logfile_maxbytes=200MB stdout_logfile_backups=10 roles : - supervisor # \u5f00\u542fsupervisor\u7684\u5065\u5eb7\u68c0\u67e5\u548cmetrics\u6307\u6807 - hosts : node1 vars : - supervisor_password : 123456 - supervisor_unix_http_server_enable : ture - supervisor_inet_http_server_enable : false - supervisor_programs : - name : 'example' command : python -m SimpleHTTPServer - name : 'example2' command : python -m SimpleHTTPServer 8082 configuration : | process_name=%(program_name)s numprocs=1 autostart=true startsecs=2 startretries=5 autorestart=true stopsignal=TERM stopwaitsecs=3 stopasgroup=true killasgroup=true user=root redirect_stderr=true stdout_logfile=/var/log/supervisor/example2.log stdout_logfile_maxbytes=200MB stdout_logfile_backups=10 - supervisor_healthCheck_enable : true - supervisor_healthCheck_config : | config: supervisordUrl: unix:///var/run/supervisor.sock supervisordUser: root supervisordPass: 123456 mail: host: 'smtp.test.com' port: '465' user: 'ops@test.com' pass: '123456' to_list: ['test@test.com'] wechat: corpid: \"\" secret: \"\" agentid: \"\" touser: \"\" example: type: HTTP method: GET host: 127.0.0.1 port: 8000 path: / periodSeconds: 5 timeoutSeconds: 5 failureThreshold: 2 successThreshold: 1 action: restart,wechat sendResolved: True example2: type: HTTP method: GET host: 127.0.0.1 port: 8082 path: / periodSeconds: 5 timeoutSeconds: 5 failureThreshold: 2 successThreshold: 1 action: restart,email sendResolved: True - supervisor_exporter_enable : true - supervisor_exporter_port : 8081 roles : - supervisor \u4f7f\u7528 \u00b6 supervisord -v supervisorctl status supervisorctl stop example supervisorctl start example #systemd systemctl status supervisord systemctl start supervisord systemctl stop supervisord systemctl reload supervisord #non-systemd /etc/init.d/supervisord status /etc/init.d/supervisord start /etc/init.d/supervisord stop supervisor: [conf] /etc/supervisord.conf [log] /var/log/supervisor/ exporter: [http] http://node1:8081/metrics [script] /etc/supervisord.d/scripts/supervisor_exporter.py healthCheck: [script] /etc/supervisord.d/scripts/healthCheck.py [config] /etc/supervisord.d/scripts/config.yaml [log] /var/log/supervisor/healthCheck.log","title":"supervisor"},{"location":"roles/other/supervisor/#ansible-role-supervisor","text":"\u5b89\u88c5supervisor","title":"Ansible Role: supervisor"},{"location":"roles/other/supervisor/#_1","text":"Supervisor\u662f\u4e00\u4e2a\u8fdb\u7a0b\u76d1\u63a7\u7a0b\u5e8f\u3002 \u6ee1\u8db3\u7684\u9700\u6c42\u662f\uff1a\u6211\u73b0\u5728\u6709\u4e00\u4e2a\u8fdb\u7a0b\u9700\u8981\u6bcf\u65f6\u6bcf\u523b\u4e0d\u65ad\u7684\u8dd1\uff0c\u4f46\u662f\u8fd9\u4e2a\u8fdb\u7a0b\u53c8\u6709\u53ef\u80fd\u7531\u4e8e\u5404\u79cd\u539f\u56e0\u6709\u53ef\u80fd\u4e2d\u65ad\u3002\u5f53\u8fdb\u7a0b\u4e2d\u65ad\u7684\u65f6\u5019\u6211\u5e0c\u671b\u80fd\u81ea\u52a8\u91cd\u65b0\u542f\u52a8\u5b83\uff0c\u6b64\u65f6\uff0c\u6211\u5c31\u9700\u8981\u4f7f\u7528\u5230\u4e86Supervisor. Supervisor\u7684\u4e24\u4e2a\u547d\u4ee4: supervisord\uff1a supervisor\u7684\u670d\u52a1\u5668\u7aef\u90e8\u5206\uff0c\u542f\u52a8supervisor\u5c31\u662f\u8fd0\u884c\u8fd9\u4e2a\u547d\u4ee4 supervisorctl\uff1a\u542f\u52a8supervisor\u7684\u547d\u4ee4\u884c\u7a97\u53e3\u3002 github\u5730\u5740\uff1a https://github.com/Supervisor/supervisor \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://supervisord.org/","title":"\u4ecb\u7ecd"},{"location":"roles/other/supervisor/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/other/supervisor/#_3","text":"ansible 2.9.1 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/other/supervisor/#_4","text":"--- # pip \u56fd\u5185\u6e90 supervisor_package_index : https://pypi.tuna.tsinghua.edu.cn/simple # supervisor\u7248\u672c, \u9ed8\u8ba4\u662f\u6700\u65b0\u7248\u672c supervisor_version : null supervisor_pip_package : - \"{%if ansible_python.version.major == 3%}python3-pip{%else%}python-pip{%endif%}\" # supervisor\u7684\u4f9d\u8d56\u5305 supervisor_supervisor_package : - name : supervisor version : \"{% if not supervisor_version and ansible_python.version.major == 2 and ansible_python.version.micro < 7 %}3.4.0{%else%}{{supervisor_version}}{%endif%}\" - \"{%- if ansible_python.version.major == 2 and ansible_python.version.micro < 7 -%}{{ '{\\\"name\\\": \\\"meld3\\\", \\\"version\\\": \\\"0.6.10\\\"}' | from_json }}{%- endif -%}\" # \u662f\u5426\u542f\u52a8supervisor supervisor_started : true supervisor_enabled : true supervisor_config_path : /etc/supervisor supervisor_log_path : /var/log/supervisor supervisor_nodaemon : false # supervisor\u7684\u8fd0\u884c\u7528\u6237\u548c\u5bc6\u7801 supervisor_user : root supervisor_password : '' # socket\u65b9\u5f0f supervisor_unix_http_server_enable : true supervisor_unix_http_server_socket_path : /var/run/supervisor.sock # http\u65b9\u5f0f supervisor_inet_http_server_enable : false supervisor_inet_http_server_port : '127.0.0.1:9001' # \u5b9a\u4e49supervisor\u7ba1\u7406\u7684program supervisor_programs : [] # - name: 'example' # command: java -jar /tmp/example.jar # - name: 'apache' # command: apache2ctl -c \"ErrorLog /dev/stdout\" -DFOREGROUND # configuration: | # autostart=true # autorestart=true # startretries=1 # startsecs=1 # redirect_stderr=true # stderr_logfile=/var/log/apache-err.log # stdout_logfile=/var/log/apache-out.log # user=root # killasgroup=true # stopasgroup=true # \u5f00\u542fsupervisor\u7684\u5065\u5eb7\u68c0\u67e5, \u8be6\u7ec6config\u89c1\u811a\u672c supervisor_healthCheck_enable : false supervisor_healthCheck_config : | config: # supervisordUrl: http://localhost:9001/RPC2 mail: # host: 'smtp.test.com' # port: '465' # user: 'ops@test.com' # pass: '123415' # to_list: ['test@test.com'] wechat: corpid: \"\" secret: \"\" agentid: \"\" toparty: \"\" example: type: HTTP method: GET host: 127.0.0.1 port: 80 path: /test periodSeconds: 5 timeoutSeconds: 5 failureThreshold: 2 successThreshold: 1 action: restart,wechat # \u5f00\u542fsupervisor\u7684Prometheus\u7684metrics\u6307\u6807 supervisor_exporter_enable : false supervisor_exporter_port : 8081","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/other/supervisor/#_5","text":"facts epel pip python","title":"\u4f9d\u8d56"},{"location":"roles/other/supervisor/#github","text":"https://github.com/lework/Ansible-roles/tree/master/supervisor","title":"github\u5730\u5740"},{"location":"roles/other/supervisor/#example-playbook","text":"# \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - supervisor # \u5b9a\u4e49supervisor\u7ba1\u7406\u7684program - hosts : node1 vars : - supervisor_unix_http_server_enable : false - supervisor_inet_http_server_enable : true - supervisor_programs : - name : 'example' command : python -m SimpleHTTPServer - name : 'example2' command : python -m SimpleHTTPServer 8082 configuration : | process_name=%(program_name)s numprocs=1 autostart=true startsecs=2 startretries=5 autorestart=true stopsignal=TERM stopwaitsecs=3 stopasgroup=true killasgroup=true user=root redirect_stderr=true stdout_logfile=/var/log/supervisor/example2.log stdout_logfile_maxbytes=200MB stdout_logfile_backups=10 roles : - supervisor # \u5f00\u542fsupervisor\u7684\u5065\u5eb7\u68c0\u67e5\u548cmetrics\u6307\u6807 - hosts : node1 vars : - supervisor_password : 123456 - supervisor_unix_http_server_enable : ture - supervisor_inet_http_server_enable : false - supervisor_programs : - name : 'example' command : python -m SimpleHTTPServer - name : 'example2' command : python -m SimpleHTTPServer 8082 configuration : | process_name=%(program_name)s numprocs=1 autostart=true startsecs=2 startretries=5 autorestart=true stopsignal=TERM stopwaitsecs=3 stopasgroup=true killasgroup=true user=root redirect_stderr=true stdout_logfile=/var/log/supervisor/example2.log stdout_logfile_maxbytes=200MB stdout_logfile_backups=10 - supervisor_healthCheck_enable : true - supervisor_healthCheck_config : | config: supervisordUrl: unix:///var/run/supervisor.sock supervisordUser: root supervisordPass: 123456 mail: host: 'smtp.test.com' port: '465' user: 'ops@test.com' pass: '123456' to_list: ['test@test.com'] wechat: corpid: \"\" secret: \"\" agentid: \"\" touser: \"\" example: type: HTTP method: GET host: 127.0.0.1 port: 8000 path: / periodSeconds: 5 timeoutSeconds: 5 failureThreshold: 2 successThreshold: 1 action: restart,wechat sendResolved: True example2: type: HTTP method: GET host: 127.0.0.1 port: 8082 path: / periodSeconds: 5 timeoutSeconds: 5 failureThreshold: 2 successThreshold: 1 action: restart,email sendResolved: True - supervisor_exporter_enable : true - supervisor_exporter_port : 8081 roles : - supervisor","title":"Example Playbook"},{"location":"roles/other/supervisor/#_6","text":"supervisord -v supervisorctl status supervisorctl stop example supervisorctl start example #systemd systemctl status supervisord systemctl start supervisord systemctl stop supervisord systemctl reload supervisord #non-systemd /etc/init.d/supervisord status /etc/init.d/supervisord start /etc/init.d/supervisord stop supervisor: [conf] /etc/supervisord.conf [log] /var/log/supervisor/ exporter: [http] http://node1:8081/metrics [script] /etc/supervisord.d/scripts/supervisor_exporter.py healthCheck: [script] /etc/supervisord.d/scripts/healthCheck.py [config] /etc/supervisord.d/scripts/config.yaml [log] /var/log/supervisor/healthCheck.log","title":"\u4f7f\u7528"},{"location":"roles/proxy/haproxy/","text":"Ansible Role: haproxy \u00b6 \u5b89\u88c5haproxy \u4ecb\u7ecd \u00b6 HAProxy\u662f\u4e00\u79cd\u514d\u8d39\u7684\uff0c\u975e\u5e38\u5feb\u901f\u548c\u53ef\u9760\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4e3a\u57fa\u4e8eTCP\u548cHTTP\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u9ad8\u53ef\u7528\u6027\uff0c\u8d1f\u8f7d\u5e73\u8861\u548c\u4ee3\u7406\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a http://www.haproxy.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://cbonte.github.io/haproxy-dconv/ \u914d\u7f6e\u6587\u4ef6\u8bf4\u660e\uff1a https://www.haproxy.org/download/1.7/doc/management.txt \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" haproxy_version: \"1.7.5\" haproxy_file: \"haproxy-{{ haproxy_version }}.tar.gz\" haproxy_file_path: \"{{ software_files_path }}/{{ haproxy_file }}\" haproxy_file_url: \"http://www.haproxy.org/download/{{ haproxy_version | splitext | first }}/src/{{ haproxy_file }}\" haproxy_user: \"haproxy\" haproxy_chroot: \"{{ software_install_path }}/haproxy\" haproxy_conf_path: \"{{ haproxy_chroot }}/conf\" haproxy_logspath: \"/var/log/haproxy\" haproxy_socket: \"/var/run/haproxy.sock\" haproxy_pid_file: \"/var/run/haproxy.pid\" haproxy_build_target: 'linux26{{ \"28\" if ( ansible_kernel.split(\"-\")[0] | version_compare(\"2.6.28\",\">=\", strict=True)) else \"\" }}' haproxy_build_arch: \"{{ ansible_machine }}\" haproxy_configure_command: \"make TARGET={{ haproxy_build_target }} ARCH={{ haproxy_build_arch }} USE_PCRE=1 USE_OPENSSL=1 USE_ZLIB=1 PREFIX={{ haproxy_chroot }}\" haproxy_maxconn: 60000 haproxy_ulimit: 200000 haproxy_nbproc: \"{{ ansible_processor_vcpus | default(ansible_processor_count) }}\" # Frontend settings. haproxy_frontend_name: \"hafrontend\" haproxy_frontend_bind_address: \"*\" haproxy_frontend_port: 80 haproxy_frontend_mode: \"http\" haproxy_frontend_vars: [] # haproxy_frontend_vars: | # - 'option httpchk GET /ok.html' # - 'http-check expect status 200' # Backend settings. haproxy_backend_name: \"habackend\" haproxy_backend_mode: \"http\" haproxy_backend_balance_method: \"roundrobin\" haproxy_backend_httpchk: \"HEAD / HTTP/1.1\\\\r\\\\nHost:localhost\" # List of backend servers. haproxy_backend_servers: [] # - name: app1 # address: 192.168.0.1:80 # - name: app2 # address: 192.168.0.2:80 # check: \"inter 5000 rise 2 fall 3\" # backup: true # extra: \"on-marked-down shutdown-sessions\" haproxy_backend_vars: [] # haproxy_backend_vars: | # - 'option httpchk GET /ok.html' # - 'http-check expect status 200' haproxy_global_vars: [] # haproxy_global_vars: # - 'ssl-default-bind-ciphers ABCD+KLMJ:...' # - 'ssl-default-bind-options no-sslv3' haproxy_defaults_vars: [] # haproxy_defaults_vars: | # - 'timeout client 1m' # - 'timeout server 1m' haproxy_conf_extra: \"\" # haproxy_conf_vars: | # frontend mysql # bind *:3306 # mode tcp # log global # default_backend mysqlservers haproxy_stats: true haproxy_stats_bindport: 18080 haproxy_stats_auth: \"admin:admin\" haproxy_stats_realm: \"Haproxy\\ Statistics\" haproxy_stats_allow_src: \"{{ ansible_default_ipv4.network }}/{{ ansible_default_ipv4.netmask }}\" haproxy_stats_uri: \"/admin?status\" \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/haproxy Example Playbook \u00b6 tcp\u4ee3\u7406rabbitmq - hosts: node2 vars: - haproxy_frontend_port: 55672 - haproxy_frontend_mode: \"tcp\" - haproxy_frontend_vars: - \"option tcplog\" - haproxy_backend_mode: \"tcp\" - haproxy_backend_servers: - name: \"rabbitmq1\" address: \"192.168.77.129:5672\" - name: \"rabbitmq2\" address: \"192.168.77.130:5672\" - name: \"rabbitmq3\" address: \"192.168.77.131:5672\" roles: - haproxy http\u4ee3\u7406rabbitmq - hosts: node2 vars: - haproxy_frontend_port: 45672 - haproxy_backend_servers: - name: \"rabbitmq1\" address: \"192.168.77.129:15672\" - name: \"rabbitmq2\" address: \"192.168.77.130:15672\" - name: \"rabbitmq3\" address: \"192.168.77.131:15672\" roles: - haproxy \u4f7f\u7528 \u00b6 /etc/init.d/haproxy Usage: haproxy {start|stop|restart|reload|condrestart|status|check}","title":"haproxy"},{"location":"roles/proxy/haproxy/#ansible-role-haproxy","text":"\u5b89\u88c5haproxy","title":"Ansible Role: haproxy"},{"location":"roles/proxy/haproxy/#_1","text":"HAProxy\u662f\u4e00\u79cd\u514d\u8d39\u7684\uff0c\u975e\u5e38\u5feb\u901f\u548c\u53ef\u9760\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4e3a\u57fa\u4e8eTCP\u548cHTTP\u7684\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u9ad8\u53ef\u7528\u6027\uff0c\u8d1f\u8f7d\u5e73\u8861\u548c\u4ee3\u7406\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a http://www.haproxy.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://cbonte.github.io/haproxy-dconv/ \u914d\u7f6e\u6587\u4ef6\u8bf4\u660e\uff1a https://www.haproxy.org/download/1.7/doc/management.txt","title":"\u4ecb\u7ecd"},{"location":"roles/proxy/haproxy/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/proxy/haproxy/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/proxy/haproxy/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" haproxy_version: \"1.7.5\" haproxy_file: \"haproxy-{{ haproxy_version }}.tar.gz\" haproxy_file_path: \"{{ software_files_path }}/{{ haproxy_file }}\" haproxy_file_url: \"http://www.haproxy.org/download/{{ haproxy_version | splitext | first }}/src/{{ haproxy_file }}\" haproxy_user: \"haproxy\" haproxy_chroot: \"{{ software_install_path }}/haproxy\" haproxy_conf_path: \"{{ haproxy_chroot }}/conf\" haproxy_logspath: \"/var/log/haproxy\" haproxy_socket: \"/var/run/haproxy.sock\" haproxy_pid_file: \"/var/run/haproxy.pid\" haproxy_build_target: 'linux26{{ \"28\" if ( ansible_kernel.split(\"-\")[0] | version_compare(\"2.6.28\",\">=\", strict=True)) else \"\" }}' haproxy_build_arch: \"{{ ansible_machine }}\" haproxy_configure_command: \"make TARGET={{ haproxy_build_target }} ARCH={{ haproxy_build_arch }} USE_PCRE=1 USE_OPENSSL=1 USE_ZLIB=1 PREFIX={{ haproxy_chroot }}\" haproxy_maxconn: 60000 haproxy_ulimit: 200000 haproxy_nbproc: \"{{ ansible_processor_vcpus | default(ansible_processor_count) }}\" # Frontend settings. haproxy_frontend_name: \"hafrontend\" haproxy_frontend_bind_address: \"*\" haproxy_frontend_port: 80 haproxy_frontend_mode: \"http\" haproxy_frontend_vars: [] # haproxy_frontend_vars: | # - 'option httpchk GET /ok.html' # - 'http-check expect status 200' # Backend settings. haproxy_backend_name: \"habackend\" haproxy_backend_mode: \"http\" haproxy_backend_balance_method: \"roundrobin\" haproxy_backend_httpchk: \"HEAD / HTTP/1.1\\\\r\\\\nHost:localhost\" # List of backend servers. haproxy_backend_servers: [] # - name: app1 # address: 192.168.0.1:80 # - name: app2 # address: 192.168.0.2:80 # check: \"inter 5000 rise 2 fall 3\" # backup: true # extra: \"on-marked-down shutdown-sessions\" haproxy_backend_vars: [] # haproxy_backend_vars: | # - 'option httpchk GET /ok.html' # - 'http-check expect status 200' haproxy_global_vars: [] # haproxy_global_vars: # - 'ssl-default-bind-ciphers ABCD+KLMJ:...' # - 'ssl-default-bind-options no-sslv3' haproxy_defaults_vars: [] # haproxy_defaults_vars: | # - 'timeout client 1m' # - 'timeout server 1m' haproxy_conf_extra: \"\" # haproxy_conf_vars: | # frontend mysql # bind *:3306 # mode tcp # log global # default_backend mysqlservers haproxy_stats: true haproxy_stats_bindport: 18080 haproxy_stats_auth: \"admin:admin\" haproxy_stats_realm: \"Haproxy\\ Statistics\" haproxy_stats_allow_src: \"{{ ansible_default_ipv4.network }}/{{ ansible_default_ipv4.netmask }}\" haproxy_stats_uri: \"/admin?status\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/proxy/haproxy/#_5","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/proxy/haproxy/#github","text":"https://github.com/lework/Ansible-roles/tree/master/haproxy","title":"github\u5730\u5740"},{"location":"roles/proxy/haproxy/#example-playbook","text":"tcp\u4ee3\u7406rabbitmq - hosts: node2 vars: - haproxy_frontend_port: 55672 - haproxy_frontend_mode: \"tcp\" - haproxy_frontend_vars: - \"option tcplog\" - haproxy_backend_mode: \"tcp\" - haproxy_backend_servers: - name: \"rabbitmq1\" address: \"192.168.77.129:5672\" - name: \"rabbitmq2\" address: \"192.168.77.130:5672\" - name: \"rabbitmq3\" address: \"192.168.77.131:5672\" roles: - haproxy http\u4ee3\u7406rabbitmq - hosts: node2 vars: - haproxy_frontend_port: 45672 - haproxy_backend_servers: - name: \"rabbitmq1\" address: \"192.168.77.129:15672\" - name: \"rabbitmq2\" address: \"192.168.77.130:15672\" - name: \"rabbitmq3\" address: \"192.168.77.131:15672\" roles: - haproxy","title":"Example Playbook"},{"location":"roles/proxy/haproxy/#_6","text":"/etc/init.d/haproxy Usage: haproxy {start|stop|restart|reload|condrestart|status|check}","title":"\u4f7f\u7528"},{"location":"roles/storage/gluster/","text":"Ansible Role: gluster \u00b6 \u5b89\u88c5gluster \u5206\u5e03\u5f0f\u5b58\u50a8\u96c6\u7fa4 \u4ecb\u7ecd \u00b6 Gluster\u662f\u4e00\u6b3e\u514d\u8d39\u7684\u5f00\u6e90\u8f6f\u4ef6\u53ef\u6269\u5c55\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://www.gluster.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://docs.gluster.org/en/latest/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.5.2 python 2.7.5 os Centos 7.4 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" gluster_version: \"4.1\" gluster_packages: - xfsprogs gluster_volume_name: \"gluster_data\" gluster_volume_replica: \"{{ ansible_play_hosts.__len__() }}\" gluster_volume_brick: \"/gluster_brick\" gluster_volume_create: > gluster volume create {{ gluster_volume_name}} replica {{ gluster_volume_replica }} {% for h in play_hosts %}{{ hostvars[h].ansible_hostname }}:{{ gluster_volume_brick }} {% endfor %} gluster_volume_start: > gluster volume start {{ gluster_volume_name}} gluster_hostnames: true gluster_epel: true gluster_init: true gluster_client: false gluster_client_mount_src: '' gluster_client_mount_dest: '' \u4f9d\u8d56 \u00b6 hostnames repo-epel github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/gluster Example Playbook \u00b6 \u5b89\u88c5\u96c6\u7fa4 - hosts: node1 node2 node3 vars: - ipnames: '192.168.77.133': 'data-node1' '192.168.77.134': 'data-node2' '192.168.77.135': 'data-node3' roles: - gluster \u5b89\u88c5\u96c6\u7fa4, \u81ea\u5b9a\u4e49\u526f\u672c - hosts: node1 node2 node3 vars: - ipnames: '192.168.77.133': 'data-node1' '192.168.77.134': 'data-node2' '192.168.77.135': 'data-node3' - gluster_volume_brick: '/export/sdb1/brick' - gluster_volume_create: > gluster volume create replvol repl 2 data-node1:/export/sdb1/brick data-node2:/export/sdb1/brick - gluster_volume_start: > gluster volume start replvol roles: - gluster \u5ba2\u6237\u7aef\u6302\u8f7d - hosts: node4 vars: - ipnames: '192.168.77.133': 'data-node1' '192.168.77.134': 'data-node2' '192.168.77.135': 'data-node3' - gluster_client: true - gluster_client_mount_src: 'data-node1:/gluster_data' - gluster_client_mount_dest: '/mnt' roles: - gluster \u4f7f\u7528 \u00b6 yum -y install glusterfs-fuse mount -t glusterfs data-node1:/gluster_data /mnt","title":"gluster"},{"location":"roles/storage/gluster/#ansible-role-gluster","text":"\u5b89\u88c5gluster \u5206\u5e03\u5f0f\u5b58\u50a8\u96c6\u7fa4","title":"Ansible Role: gluster"},{"location":"roles/storage/gluster/#_1","text":"Gluster\u662f\u4e00\u6b3e\u514d\u8d39\u7684\u5f00\u6e90\u8f6f\u4ef6\u53ef\u6269\u5c55\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://www.gluster.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a https://docs.gluster.org/en/latest/","title":"\u4ecb\u7ecd"},{"location":"roles/storage/gluster/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/storage/gluster/#_3","text":"ansible 2.5.2 python 2.7.5 os Centos 7.4 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/storage/gluster/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" gluster_version: \"4.1\" gluster_packages: - xfsprogs gluster_volume_name: \"gluster_data\" gluster_volume_replica: \"{{ ansible_play_hosts.__len__() }}\" gluster_volume_brick: \"/gluster_brick\" gluster_volume_create: > gluster volume create {{ gluster_volume_name}} replica {{ gluster_volume_replica }} {% for h in play_hosts %}{{ hostvars[h].ansible_hostname }}:{{ gluster_volume_brick }} {% endfor %} gluster_volume_start: > gluster volume start {{ gluster_volume_name}} gluster_hostnames: true gluster_epel: true gluster_init: true gluster_client: false gluster_client_mount_src: '' gluster_client_mount_dest: ''","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/storage/gluster/#_5","text":"hostnames repo-epel","title":"\u4f9d\u8d56"},{"location":"roles/storage/gluster/#github","text":"https://github.com/lework/Ansible-roles/tree/master/gluster","title":"github\u5730\u5740"},{"location":"roles/storage/gluster/#example-playbook","text":"\u5b89\u88c5\u96c6\u7fa4 - hosts: node1 node2 node3 vars: - ipnames: '192.168.77.133': 'data-node1' '192.168.77.134': 'data-node2' '192.168.77.135': 'data-node3' roles: - gluster \u5b89\u88c5\u96c6\u7fa4, \u81ea\u5b9a\u4e49\u526f\u672c - hosts: node1 node2 node3 vars: - ipnames: '192.168.77.133': 'data-node1' '192.168.77.134': 'data-node2' '192.168.77.135': 'data-node3' - gluster_volume_brick: '/export/sdb1/brick' - gluster_volume_create: > gluster volume create replvol repl 2 data-node1:/export/sdb1/brick data-node2:/export/sdb1/brick - gluster_volume_start: > gluster volume start replvol roles: - gluster \u5ba2\u6237\u7aef\u6302\u8f7d - hosts: node4 vars: - ipnames: '192.168.77.133': 'data-node1' '192.168.77.134': 'data-node2' '192.168.77.135': 'data-node3' - gluster_client: true - gluster_client_mount_src: 'data-node1:/gluster_data' - gluster_client_mount_dest: '/mnt' roles: - gluster","title":"Example Playbook"},{"location":"roles/storage/gluster/#_6","text":"yum -y install glusterfs-fuse mount -t glusterfs data-node1:/gluster_data /mnt","title":"\u4f7f\u7528"},{"location":"roles/storage/nfs/","text":"Ansible Role: nfs \u00b6 \u914d\u7f6enfs\u670d\u52a1\u7aef \u4ecb\u7ecd \u00b6 NFS\uff08Network File System\uff09\u5373\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\uff0c\u662fFreeBSD\u652f\u6301\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u4e00\u79cd\uff0c\u5b83\u5141\u8bb8\u7f51\u7edc\u4e2d\u7684\u8ba1\u7b97\u673a\u4e4b\u95f4\u901a\u8fc7TCP/IP\u7f51\u7edc\u5171\u4eab\u8d44\u6e90\u3002\u5728NFS\u7684\u5e94\u7528\u4e2d\uff0c\u672c\u5730NFS\u7684\u5ba2\u6237\u7aef\u5e94\u7528\u53ef\u4ee5\u900f\u660e\u5730\u8bfb\u5199\u4f4d\u4e8e\u8fdc\u7aefNFS\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\uff0c\u5c31\u50cf\u8bbf\u95ee\u672c\u5730\u6587\u4ef6\u4e00\u6837\u3002 RFC 1094: http://www.faqs.org/rfcs/rfc1094.html Linux NFS-HOWTO: http://www.tldp.org/HOWTO/NFS-HOWTO/index.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 nfs_exports: - /nfs_data *(rw,all_squash,async) \u4f9d\u8d56 \u00b6 rpcbind github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/nfs Example Playbook \u00b6 - hosts: node1 vars: - nfs_exports: - /nfs_data *(rw,all_squash,async) - /nfs_data2 *(rw,all_squash,async) - /nfs_data3 *(rw,all_squash,async) roles: - role: nfs \u7aef\u53e3 \u00b6 rpcbind 111 mountd 892 rquotad 875 nfs 2049 lockd udp 32769 lockd tcp 32803 \u4f7f\u7528 \u00b6 ~]# /etc/init.d/rpcbind Usage: /etc/init.d/rpcbind {start|stop|status|restart|reload|force-reload|condrestart|try-restart} ~]# /etc/init.d/nfs Usage: nfs {start|stop|status|restart|reload|force-reload|condrestart|try-restart|condstop}","title":"nfs"},{"location":"roles/storage/nfs/#ansible-role-nfs","text":"\u914d\u7f6enfs\u670d\u52a1\u7aef","title":"Ansible Role: nfs"},{"location":"roles/storage/nfs/#_1","text":"NFS\uff08Network File System\uff09\u5373\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\uff0c\u662fFreeBSD\u652f\u6301\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u4e00\u79cd\uff0c\u5b83\u5141\u8bb8\u7f51\u7edc\u4e2d\u7684\u8ba1\u7b97\u673a\u4e4b\u95f4\u901a\u8fc7TCP/IP\u7f51\u7edc\u5171\u4eab\u8d44\u6e90\u3002\u5728NFS\u7684\u5e94\u7528\u4e2d\uff0c\u672c\u5730NFS\u7684\u5ba2\u6237\u7aef\u5e94\u7528\u53ef\u4ee5\u900f\u660e\u5730\u8bfb\u5199\u4f4d\u4e8e\u8fdc\u7aefNFS\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\uff0c\u5c31\u50cf\u8bbf\u95ee\u672c\u5730\u6587\u4ef6\u4e00\u6837\u3002 RFC 1094: http://www.faqs.org/rfcs/rfc1094.html Linux NFS-HOWTO: http://www.tldp.org/HOWTO/NFS-HOWTO/index.html","title":"\u4ecb\u7ecd"},{"location":"roles/storage/nfs/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/storage/nfs/#_3","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/storage/nfs/#_4","text":"nfs_exports: - /nfs_data *(rw,all_squash,async)","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/storage/nfs/#_5","text":"rpcbind","title":"\u4f9d\u8d56"},{"location":"roles/storage/nfs/#github","text":"https://github.com/lework/Ansible-roles/tree/master/nfs","title":"github\u5730\u5740"},{"location":"roles/storage/nfs/#example-playbook","text":"- hosts: node1 vars: - nfs_exports: - /nfs_data *(rw,all_squash,async) - /nfs_data2 *(rw,all_squash,async) - /nfs_data3 *(rw,all_squash,async) roles: - role: nfs","title":"Example Playbook"},{"location":"roles/storage/nfs/#_6","text":"rpcbind 111 mountd 892 rquotad 875 nfs 2049 lockd udp 32769 lockd tcp 32803","title":"\u7aef\u53e3"},{"location":"roles/storage/nfs/#_7","text":"~]# /etc/init.d/rpcbind Usage: /etc/init.d/rpcbind {start|stop|status|restart|reload|force-reload|condrestart|try-restart} ~]# /etc/init.d/nfs Usage: nfs {start|stop|status|restart|reload|force-reload|condrestart|try-restart|condstop}","title":"\u4f7f\u7528"},{"location":"roles/storage/samba/","text":"Ansible Role: samba \u00b6 \u914d\u7f6eSamba\u670d\u52a1\u7aef \u4ecb\u7ecd \u00b6 Samba\u662f\u5728Linux\u548cUNIX\u7cfb\u7edf\u4e0a\u5b9e\u73b0SMB\u534f\u8bae\u7684\u4e00\u4e2a\u514d\u8d39\u8f6f\u4ef6\uff0c\u7531\u670d\u52a1\u5668\u53ca\u5ba2\u6237\u7aef\u7a0b\u5e8f\u6784\u6210\u3002SMB\uff08Server Messages Block\uff0c\u4fe1\u606f\u670d\u52a1\u5757\uff09\u662f\u4e00\u79cd\u5728\u5c40\u57df\u7f51\u4e0a\u5171\u4eab\u6587\u4ef6\u548c\u6253\u5370\u673a\u7684\u4e00\u79cd\u901a\u4fe1\u534f\u8bae\uff0c\u5b83\u4e3a\u5c40\u57df\u7f51\u5185\u7684\u4e0d\u540c\u8ba1\u7b97\u673a\u4e4b\u95f4\u63d0\u4f9b\u6587\u4ef6\u53ca\u6253\u5370\u673a\u7b49\u8d44\u6e90\u7684\u5171\u4eab\u670d\u52a1\u3002SMB\u534f\u8bae\u662f\u5ba2\u6237\u673a/\u670d\u52a1\u5668\u578b\u534f\u8bae\uff0c\u5ba2\u6237\u673a\u901a\u8fc7\u8be5\u534f\u8bae\u53ef\u4ee5\u8bbf\u95ee\u670d\u52a1\u5668\u4e0a\u7684\u5171\u4eab\u6587\u4ef6\u7cfb\u7edf\u3001\u6253\u5370\u673a\u53ca\u5176\u4ed6\u8d44\u6e90\u3002\u901a\u8fc7\u8bbe\u7f6e\u201cNetBIOS over TCP/IP\u201d\u4f7f\u5f97Samba\u4e0d\u4f46\u80fd\u4e0e\u5c40\u57df\u7f51\u7edc\u4e3b\u673a\u5206\u4eab\u8d44\u6e90\uff0c\u8fd8\u80fd\u4e0e\u5168\u4e16\u754c\u7684\u7535\u8111\u5206\u4eab\u8d44\u6e90\u3002 \u5b98\u65b9\uff1a https://www.samba.org \u914d\u7f6e\u6587\u4ef6\uff1a https://www.samba.org/samba/docs/man/manpages-3/smb.conf.5.html \u6587\u6863: https://www.samba.org/samba/docs/Samba-Guide.pdf HOWTO: https://www.samba.org/samba/docs/Samba-HOWTO-Collection.pdf \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 samba_packages: - samba-common - samba - samba-client - cifs-utils - libselinux-python samba_services: - smb - nmb samba_workgroup: 'WORKGROUP' samba_server_string: 'Fileserver %m' samba_netbios_name: \"{{ ansible_hostname | d() }}\" samba_log_size: 50000 samba_log_file: '/var/log/samba/log' samba_interfaces: [] samba_security: 'user' samba_passdb_backend: 'tdbsam' samba_map_to_guest: 'bad user' samba_guest_account: 'nobody' samba_load_printers: false samba_load_homes: false samba_full_audit: true samba_shares_path: '/samba_shares' samba_users: [] # samba_users: # - name: alice # password: ecila samba_shares: - name: default comment: 'default share' guest_ok: yes directory_mode: 777 recycle: true \u4f9d\u8d56 \u00b6 None github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/samba Example Playbook \u00b6 # \u9ed8\u8ba4\u914d\u7f6e\uff0c\u533f\u540d\u8bbf\u95ee/samba_shares\u76ee\u5f55 - hosts: node1 roles: - role: samba # \u5b9a\u4e49\u8bbf\u95ee\u7528\u6237\u548c\u5171\u4eab\u76ee\u5f55 - hosts: node1 vars: - samba_users: - name: alice password: 123 - samba_shares: - name: customize_share comment: 'customize share' path: /customize_share valid_users: alice owner: alice roles: - samba \u7aef\u53e3 \u00b6 139 445 \u4f7f\u7528 \u00b6 ~]# /etc/init.d/smb Usage: /etc/init.d/smb {start|stop|restart|reload|configtest|status|condrestart} ~]# /etc/init.d/nmb Usage\uff1a/etc/init.d/nmb {start|stop|restart|reload|status|condrestart}","title":"samba"},{"location":"roles/storage/samba/#ansible-role-samba","text":"\u914d\u7f6eSamba\u670d\u52a1\u7aef","title":"Ansible Role: samba"},{"location":"roles/storage/samba/#_1","text":"Samba\u662f\u5728Linux\u548cUNIX\u7cfb\u7edf\u4e0a\u5b9e\u73b0SMB\u534f\u8bae\u7684\u4e00\u4e2a\u514d\u8d39\u8f6f\u4ef6\uff0c\u7531\u670d\u52a1\u5668\u53ca\u5ba2\u6237\u7aef\u7a0b\u5e8f\u6784\u6210\u3002SMB\uff08Server Messages Block\uff0c\u4fe1\u606f\u670d\u52a1\u5757\uff09\u662f\u4e00\u79cd\u5728\u5c40\u57df\u7f51\u4e0a\u5171\u4eab\u6587\u4ef6\u548c\u6253\u5370\u673a\u7684\u4e00\u79cd\u901a\u4fe1\u534f\u8bae\uff0c\u5b83\u4e3a\u5c40\u57df\u7f51\u5185\u7684\u4e0d\u540c\u8ba1\u7b97\u673a\u4e4b\u95f4\u63d0\u4f9b\u6587\u4ef6\u53ca\u6253\u5370\u673a\u7b49\u8d44\u6e90\u7684\u5171\u4eab\u670d\u52a1\u3002SMB\u534f\u8bae\u662f\u5ba2\u6237\u673a/\u670d\u52a1\u5668\u578b\u534f\u8bae\uff0c\u5ba2\u6237\u673a\u901a\u8fc7\u8be5\u534f\u8bae\u53ef\u4ee5\u8bbf\u95ee\u670d\u52a1\u5668\u4e0a\u7684\u5171\u4eab\u6587\u4ef6\u7cfb\u7edf\u3001\u6253\u5370\u673a\u53ca\u5176\u4ed6\u8d44\u6e90\u3002\u901a\u8fc7\u8bbe\u7f6e\u201cNetBIOS over TCP/IP\u201d\u4f7f\u5f97Samba\u4e0d\u4f46\u80fd\u4e0e\u5c40\u57df\u7f51\u7edc\u4e3b\u673a\u5206\u4eab\u8d44\u6e90\uff0c\u8fd8\u80fd\u4e0e\u5168\u4e16\u754c\u7684\u7535\u8111\u5206\u4eab\u8d44\u6e90\u3002 \u5b98\u65b9\uff1a https://www.samba.org \u914d\u7f6e\u6587\u4ef6\uff1a https://www.samba.org/samba/docs/man/manpages-3/smb.conf.5.html \u6587\u6863: https://www.samba.org/samba/docs/Samba-Guide.pdf HOWTO: https://www.samba.org/samba/docs/Samba-HOWTO-Collection.pdf","title":"\u4ecb\u7ecd"},{"location":"roles/storage/samba/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/storage/samba/#_3","text":"ansible 2.3.0.0 os Centos 6.7 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/storage/samba/#_4","text":"samba_packages: - samba-common - samba - samba-client - cifs-utils - libselinux-python samba_services: - smb - nmb samba_workgroup: 'WORKGROUP' samba_server_string: 'Fileserver %m' samba_netbios_name: \"{{ ansible_hostname | d() }}\" samba_log_size: 50000 samba_log_file: '/var/log/samba/log' samba_interfaces: [] samba_security: 'user' samba_passdb_backend: 'tdbsam' samba_map_to_guest: 'bad user' samba_guest_account: 'nobody' samba_load_printers: false samba_load_homes: false samba_full_audit: true samba_shares_path: '/samba_shares' samba_users: [] # samba_users: # - name: alice # password: ecila samba_shares: - name: default comment: 'default share' guest_ok: yes directory_mode: 777 recycle: true","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/storage/samba/#_5","text":"None","title":"\u4f9d\u8d56"},{"location":"roles/storage/samba/#github","text":"https://github.com/lework/Ansible-roles/tree/master/samba","title":"github\u5730\u5740"},{"location":"roles/storage/samba/#example-playbook","text":"# \u9ed8\u8ba4\u914d\u7f6e\uff0c\u533f\u540d\u8bbf\u95ee/samba_shares\u76ee\u5f55 - hosts: node1 roles: - role: samba # \u5b9a\u4e49\u8bbf\u95ee\u7528\u6237\u548c\u5171\u4eab\u76ee\u5f55 - hosts: node1 vars: - samba_users: - name: alice password: 123 - samba_shares: - name: customize_share comment: 'customize share' path: /customize_share valid_users: alice owner: alice roles: - samba","title":"Example Playbook"},{"location":"roles/storage/samba/#_6","text":"139 445","title":"\u7aef\u53e3"},{"location":"roles/storage/samba/#_7","text":"~]# /etc/init.d/smb Usage: /etc/init.d/smb {start|stop|restart|reload|configtest|status|condrestart} ~]# /etc/init.d/nmb Usage\uff1a/etc/init.d/nmb {start|stop|restart|reload|status|condrestart}","title":"\u4f7f\u7528"},{"location":"roles/storage/vsftpd/","text":"Ansible Role: vsftp \u00b6 \u914d\u7f6eftp\u670d\u52a1\u7aef \u4ecb\u7ecd \u00b6 vsftpd \u662f\u201cvery secure FTP daemon\u201d\u7684\u7f29\u5199\uff0c\u5b89\u5168\u6027\u662f\u5b83\u7684\u4e00\u4e2a\u6700\u5927\u7684\u7279\u70b9\u3002vsftpd \u662f\u4e00\u4e2a UNIX \u7c7b\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u8fd0\u884c\u7684\u670d\u52a1\u5668\u7684\u540d\u5b57\uff0c\u5b83\u53ef\u4ee5\u8fd0\u884c\u5728\u8bf8\u5982 Linux\u3001BSD\u3001Solaris\u3001 HP-UNIX\u7b49\u7cfb\u7edf\u4e0a\u9762\uff0c\u662f\u4e00\u4e2a\u5b8c\u5168\u514d\u8d39\u7684\u3001\u5f00\u653e\u6e90\u4ee3\u7801\u7684ftp\u670d\u52a1\u5668\u8f6f\u4ef6\uff0c\u652f\u6301\u5f88\u591a\u5176\u4ed6\u7684 FTP \u670d\u52a1\u5668\u6240\u4e0d\u652f\u6301\u7684\u7279\u5f81\u3002 \u5b98\u65b9\uff1a http://vsftpd.beasts.org/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.3.0.0 os Centos 6.7 X64 Centos 7.2 X64 python 2.6.6 \u89d2\u8272\u53d8\u91cf \u00b6 vsftpd_packages: - vsftpd - libsemanage-python - libselinux-python - pam - db4-utils vsftpd_listen_port: 21 vsftpd_data_port: 20 vsftpd_pasv_min_port: 30000 vsftpd_pasv_max_port: 31000 vsftpd_local_umask: '022' vsftpd_share_path: '/ftp_share' vsftpd_banner: \"Welcome to Ftp Server!\" vsftpd_syslog_enable: false vsftpd_log_file: '/var/log/vsftpd.log' vsftpd_xferlog_file: '/var/log/xferlog' vsftpd_options: \"\" # vsftpd_options: | # max_per_ip: 5 # max_clients: 100 vsftpd_anon: true vsftpd_local_users: [] # vsftpd_users: # - name: alice # password: \"ecila\" # home: /ftp_alice vsftpd_vusers: [] # vsftpd_vusers: # - name: alice # password: ecila # local_root: '/alice_share' # conf: | # local_umask=011 vsftpd_userfile: \"/etc/vsftpd/vuser\" vsftpd_userdb: \"/etc/vsftpd/vuser.db\" vsftpd_userconf: \"/etc/vsftpd/vuser_conf\" \u4f9d\u8d56 \u00b6 None github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/vsftpd Example Playbook \u00b6 # \u9ed8\u8ba4\u914d\u7f6e\uff0c\u533f\u540d\u767b\u5f55 - hosts: node1 roles: - role: vsftpd # \u672c\u5730\u7528\u6237\u767b\u5f55 - hosts: node1 vars: - vsftpd_local_users: - name: alice password: \"123\" home: /ftp_alice - name: lili password: \"123\" roles: - vsftpd # \u865a\u62df\u7528\u6237\u767b\u5f55 - hosts: node1 vars: - vsftpd_share_path: '/ftp_vuser_share' - vsftpd_vusers: - name: test1 password: 123 - name: test2 password: 123 local_root: '/ftp_test2_home' conf: | local_root=/ftp_test2_home local_umask=011 roles: - vsftpd \u7aef\u53e3 \u00b6 21 20 \u4f7f\u7528 \u00b6 ~]# service vsftpd Usage: /etc/init.d/vsftpd {start|stop|restart|try-restart|force-reload|status}","title":"vsftpd"},{"location":"roles/storage/vsftpd/#ansible-role-vsftp","text":"\u914d\u7f6eftp\u670d\u52a1\u7aef","title":"Ansible Role: vsftp"},{"location":"roles/storage/vsftpd/#_1","text":"vsftpd \u662f\u201cvery secure FTP daemon\u201d\u7684\u7f29\u5199\uff0c\u5b89\u5168\u6027\u662f\u5b83\u7684\u4e00\u4e2a\u6700\u5927\u7684\u7279\u70b9\u3002vsftpd \u662f\u4e00\u4e2a UNIX \u7c7b\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u8fd0\u884c\u7684\u670d\u52a1\u5668\u7684\u540d\u5b57\uff0c\u5b83\u53ef\u4ee5\u8fd0\u884c\u5728\u8bf8\u5982 Linux\u3001BSD\u3001Solaris\u3001 HP-UNIX\u7b49\u7cfb\u7edf\u4e0a\u9762\uff0c\u662f\u4e00\u4e2a\u5b8c\u5168\u514d\u8d39\u7684\u3001\u5f00\u653e\u6e90\u4ee3\u7801\u7684ftp\u670d\u52a1\u5668\u8f6f\u4ef6\uff0c\u652f\u6301\u5f88\u591a\u5176\u4ed6\u7684 FTP \u670d\u52a1\u5668\u6240\u4e0d\u652f\u6301\u7684\u7279\u5f81\u3002 \u5b98\u65b9\uff1a http://vsftpd.beasts.org/","title":"\u4ecb\u7ecd"},{"location":"roles/storage/vsftpd/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/storage/vsftpd/#_3","text":"ansible 2.3.0.0 os Centos 6.7 X64 Centos 7.2 X64 python 2.6.6","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/storage/vsftpd/#_4","text":"vsftpd_packages: - vsftpd - libsemanage-python - libselinux-python - pam - db4-utils vsftpd_listen_port: 21 vsftpd_data_port: 20 vsftpd_pasv_min_port: 30000 vsftpd_pasv_max_port: 31000 vsftpd_local_umask: '022' vsftpd_share_path: '/ftp_share' vsftpd_banner: \"Welcome to Ftp Server!\" vsftpd_syslog_enable: false vsftpd_log_file: '/var/log/vsftpd.log' vsftpd_xferlog_file: '/var/log/xferlog' vsftpd_options: \"\" # vsftpd_options: | # max_per_ip: 5 # max_clients: 100 vsftpd_anon: true vsftpd_local_users: [] # vsftpd_users: # - name: alice # password: \"ecila\" # home: /ftp_alice vsftpd_vusers: [] # vsftpd_vusers: # - name: alice # password: ecila # local_root: '/alice_share' # conf: | # local_umask=011 vsftpd_userfile: \"/etc/vsftpd/vuser\" vsftpd_userdb: \"/etc/vsftpd/vuser.db\" vsftpd_userconf: \"/etc/vsftpd/vuser_conf\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/storage/vsftpd/#_5","text":"None","title":"\u4f9d\u8d56"},{"location":"roles/storage/vsftpd/#github","text":"https://github.com/lework/Ansible-roles/tree/master/vsftpd","title":"github\u5730\u5740"},{"location":"roles/storage/vsftpd/#example-playbook","text":"# \u9ed8\u8ba4\u914d\u7f6e\uff0c\u533f\u540d\u767b\u5f55 - hosts: node1 roles: - role: vsftpd # \u672c\u5730\u7528\u6237\u767b\u5f55 - hosts: node1 vars: - vsftpd_local_users: - name: alice password: \"123\" home: /ftp_alice - name: lili password: \"123\" roles: - vsftpd # \u865a\u62df\u7528\u6237\u767b\u5f55 - hosts: node1 vars: - vsftpd_share_path: '/ftp_vuser_share' - vsftpd_vusers: - name: test1 password: 123 - name: test2 password: 123 local_root: '/ftp_test2_home' conf: | local_root=/ftp_test2_home local_umask=011 roles: - vsftpd","title":"Example Playbook"},{"location":"roles/storage/vsftpd/#_6","text":"21 20","title":"\u7aef\u53e3"},{"location":"roles/storage/vsftpd/#_7","text":"~]# service vsftpd Usage: /etc/init.d/vsftpd {start|stop|restart|try-restart|force-reload|status}","title":"\u4f7f\u7528"},{"location":"roles/sync/rsync/","text":"Ansible Role: rsync \u00b6 \u5b89\u88c5rsync\u670d\u52a1 \u4ecb\u7ecd \u00b6 rsync\u662f\u7c7bunix\u7cfb\u7edf\u4e0b\u7684\u6570\u636e\u955c\u50cf\u5907\u4efd\u5de5\u5177\u2014\u2014remote sync\u3002\u4e00\u6b3e\u5feb\u901f\u589e\u91cf\u5907\u4efd\u5de5\u5177 Remote Sync\uff0c\u8fdc\u7a0b\u540c\u6b65 \u652f\u6301\u672c\u5730\u590d\u5236\uff0c\u6216\u8005\u4e0e\u5176\u4ed6SSH\u3001rsync\u4e3b\u673a\u540c\u6b65\u3002 \u5b98\u65b9\u5730\u5740\uff1a http://rsync.samba.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://rsync.samba.org/documentation.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 rsync_user: \"rsync\" rsync_logdir: \"/var/log/rsyncd\" rsync_conf: \"/etc/rsyncd.conf\" rsync_authusers: [] # [\"test:123456\"] rsync_passfile: \"/etc/rsyncd.password\" rsync_port: 873 rsync_maxconn: 200 rsync_timeout: 300 rsync_chroot: no rsync_shares: {} \u4f9d\u8d56 \u00b6 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/rsync Example Playbook \u00b6 - hosts: node1 roles: - role: rsync rsync_authusers: [\"t1:123456\",\"t2:1234567\"] rsync_shares: - name: data1 comment: Public data1 path: /data/1 authuser: t1 passfile: /etc/rsyncd.password readonly: false list: false excludes: [\"test.txt\",\"*.h\"] - name: data2 comment: Public data2 path: /data/2 \u4f7f\u7528 \u00b6 \u542f\u52a8 rsync --daemon --config=/etc/rsyncd.conf","title":"rsync"},{"location":"roles/sync/rsync/#ansible-role-rsync","text":"\u5b89\u88c5rsync\u670d\u52a1","title":"Ansible Role: rsync"},{"location":"roles/sync/rsync/#_1","text":"rsync\u662f\u7c7bunix\u7cfb\u7edf\u4e0b\u7684\u6570\u636e\u955c\u50cf\u5907\u4efd\u5de5\u5177\u2014\u2014remote sync\u3002\u4e00\u6b3e\u5feb\u901f\u589e\u91cf\u5907\u4efd\u5de5\u5177 Remote Sync\uff0c\u8fdc\u7a0b\u540c\u6b65 \u652f\u6301\u672c\u5730\u590d\u5236\uff0c\u6216\u8005\u4e0e\u5176\u4ed6SSH\u3001rsync\u4e3b\u673a\u540c\u6b65\u3002 \u5b98\u65b9\u5730\u5740\uff1a http://rsync.samba.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://rsync.samba.org/documentation.html","title":"\u4ecb\u7ecd"},{"location":"roles/sync/rsync/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/sync/rsync/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/sync/rsync/#_4","text":"rsync_user: \"rsync\" rsync_logdir: \"/var/log/rsyncd\" rsync_conf: \"/etc/rsyncd.conf\" rsync_authusers: [] # [\"test:123456\"] rsync_passfile: \"/etc/rsyncd.password\" rsync_port: 873 rsync_maxconn: 200 rsync_timeout: 300 rsync_chroot: no rsync_shares: {}","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/sync/rsync/#_5","text":"","title":"\u4f9d\u8d56"},{"location":"roles/sync/rsync/#github","text":"https://github.com/lework/Ansible-roles/tree/master/rsync","title":"github\u5730\u5740"},{"location":"roles/sync/rsync/#example-playbook","text":"- hosts: node1 roles: - role: rsync rsync_authusers: [\"t1:123456\",\"t2:1234567\"] rsync_shares: - name: data1 comment: Public data1 path: /data/1 authuser: t1 passfile: /etc/rsyncd.password readonly: false list: false excludes: [\"test.txt\",\"*.h\"] - name: data2 comment: Public data2 path: /data/2","title":"Example Playbook"},{"location":"roles/sync/rsync/#_6","text":"\u542f\u52a8 rsync --daemon --config=/etc/rsyncd.conf","title":"\u4f7f\u7528"},{"location":"roles/sync/sersync/","text":"Ansible Role: sersync \u00b6 \u5b89\u88c5sersync \u4ecb\u7ecd \u00b6 sersync\u4e3b\u8981\u7528\u4e8e\u670d\u52a1\u5668\u540c\u6b65\uff0cweb\u955c\u50cf\u7b49\u529f\u80fd\u3002\u57fa\u4e8eboost1.43.0,inotify api,rsync command.\u5f00\u53d1\u3002\u7531\u91d1\u5c71\u516c\u53f8\u5f00\u53d1\u5e76\u5f00\u6e90\u7684\u540c\u6b65\u8f6f\u4ef6\u3002sersync\u90e8\u7f72\u5728\u6e90\u670d\u52a1\u5668\u4e0a\uff0c\u5728\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u90e8\u7f72\u597d\u666e\u901a\u7684rsync\u670d\u52a1\u540e\uff0c\u5728\u6e90\u670d\u52a1\u5668\u4e0a\u542f\u52a8sersync\u5373\u53ef\uff0csersync\u901a\u8fc7\u89e3\u6790xml\u914d\u7f6e\u6587\u4ef6\u6765\u83b7\u53d6\u76f8\u5173rsync\u65f6\u7684\u4e00\u4e9b\u7b56\u7565\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://code.google.com/archive/p/sersync/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.2.1.0 os Centos 6.7 X64 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" sersync_version: \"2.5.4\" sersync_file: \"sersync{{ sersync_version }}_64bit_binary_stable_final.tar.gz\" sersync_file_path: \"{{ software_files_path }}/{{ sersync_file }}\" sersync_file_url: \"https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/sersync/{{ sersync_file }}\" sersync_xfs: \"false\" sersync_exclude: [] # [\"*.ini\",\"*.txt\"] sersync_logpath: /var/log/sersync sersync_home: \"{{ software_install_path }}/sersync\" sersync_conf: \"{{ sersync_home }}/conf\" sersync_watch: \"\" # /data/ sersync_rsync: {} # {\"ip\":192.168.77.130, \"port\":873, \"name\":data1, \"user\":t1, \"pass\":123456,\"params\":\"-artuz\"} sersync_rsync_logfile: \"{{ sersync_logpath }}/sersync_rsync_exec.log\" sersync_rsync_passwordfile: \"{{ sersync_conf }}/sersync_rsync.password\" sersync_rsync_timeout: 100 sersync_rsync_ssh: \"false\" sersync_failLog: \"{{ sersync_logpath }}/rsync_fail_log.sh\" sersync_inotify_delete: true sersync_inotify_createFolder: true sersync_inotify_createFile: false sersync_inotify_closeWrite: true sersync_inotify_moveFrom: true sersync_inotify_moveTo: true sersync_inotify_attrib: false sersync_inotify_modify: false sersync_crontab: false sersync_schedule: 600 \u4f9d\u8d56 \u00b6 rsync github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/sersync Example Playbook \u00b6 \u5b89\u88c5sersync\uff1a - hosts: node2 vars: - sersync_watch: /data/d1 - sersync_rsync: \"ip\": 192.168.77.129 \"port\": 873 \"name\": data1 \"user\": t1 \"pass\": 123456 \"params\": -artuz roles: - role: sersync \u4f7f\u7528 \u00b6 /usr/local/sersync/bin/sersync -r -d -o /usr/local/sersync/conf/confxml.xml","title":"sersync"},{"location":"roles/sync/sersync/#ansible-role-sersync","text":"\u5b89\u88c5sersync","title":"Ansible Role: sersync"},{"location":"roles/sync/sersync/#_1","text":"sersync\u4e3b\u8981\u7528\u4e8e\u670d\u52a1\u5668\u540c\u6b65\uff0cweb\u955c\u50cf\u7b49\u529f\u80fd\u3002\u57fa\u4e8eboost1.43.0,inotify api,rsync command.\u5f00\u53d1\u3002\u7531\u91d1\u5c71\u516c\u53f8\u5f00\u53d1\u5e76\u5f00\u6e90\u7684\u540c\u6b65\u8f6f\u4ef6\u3002sersync\u90e8\u7f72\u5728\u6e90\u670d\u52a1\u5668\u4e0a\uff0c\u5728\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u90e8\u7f72\u597d\u666e\u901a\u7684rsync\u670d\u52a1\u540e\uff0c\u5728\u6e90\u670d\u52a1\u5668\u4e0a\u542f\u52a8sersync\u5373\u53ef\uff0csersync\u901a\u8fc7\u89e3\u6790xml\u914d\u7f6e\u6587\u4ef6\u6765\u83b7\u53d6\u76f8\u5173rsync\u65f6\u7684\u4e00\u4e9b\u7b56\u7565\u3002 \u5b98\u65b9\u5730\u5740\uff1a https://code.google.com/archive/p/sersync/","title":"\u4ecb\u7ecd"},{"location":"roles/sync/sersync/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/sync/sersync/#_3","text":"ansible 2.2.1.0 os Centos 6.7 X64","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/sync/sersync/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" sersync_version: \"2.5.4\" sersync_file: \"sersync{{ sersync_version }}_64bit_binary_stable_final.tar.gz\" sersync_file_path: \"{{ software_files_path }}/{{ sersync_file }}\" sersync_file_url: \"https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/sersync/{{ sersync_file }}\" sersync_xfs: \"false\" sersync_exclude: [] # [\"*.ini\",\"*.txt\"] sersync_logpath: /var/log/sersync sersync_home: \"{{ software_install_path }}/sersync\" sersync_conf: \"{{ sersync_home }}/conf\" sersync_watch: \"\" # /data/ sersync_rsync: {} # {\"ip\":192.168.77.130, \"port\":873, \"name\":data1, \"user\":t1, \"pass\":123456,\"params\":\"-artuz\"} sersync_rsync_logfile: \"{{ sersync_logpath }}/sersync_rsync_exec.log\" sersync_rsync_passwordfile: \"{{ sersync_conf }}/sersync_rsync.password\" sersync_rsync_timeout: 100 sersync_rsync_ssh: \"false\" sersync_failLog: \"{{ sersync_logpath }}/rsync_fail_log.sh\" sersync_inotify_delete: true sersync_inotify_createFolder: true sersync_inotify_createFile: false sersync_inotify_closeWrite: true sersync_inotify_moveFrom: true sersync_inotify_moveTo: true sersync_inotify_attrib: false sersync_inotify_modify: false sersync_crontab: false sersync_schedule: 600","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/sync/sersync/#_5","text":"rsync","title":"\u4f9d\u8d56"},{"location":"roles/sync/sersync/#github","text":"https://github.com/lework/Ansible-roles/tree/master/sersync","title":"github\u5730\u5740"},{"location":"roles/sync/sersync/#example-playbook","text":"\u5b89\u88c5sersync\uff1a - hosts: node2 vars: - sersync_watch: /data/d1 - sersync_rsync: \"ip\": 192.168.77.129 \"port\": 873 \"name\": data1 \"user\": t1 \"pass\": 123456 \"params\": -artuz roles: - role: sersync","title":"Example Playbook"},{"location":"roles/sync/sersync/#_6","text":"/usr/local/sersync/bin/sersync -r -d -o /usr/local/sersync/conf/confxml.xml","title":"\u4f7f\u7528"},{"location":"roles/web/nginx/","text":"Ansible Role: Nginx \u00b6 \u5b89\u88c5Nginx \u4ecb\u7ecd \u00b6 Nginx (\"engine x\") \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684HTTP\u548c\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u4e5f\u662f\u4e00\u4e2aIMAP/POP3/SMTP\u670d\u52a1\u5668\u3002Nginx\u662f\u7531Igor Sysoev\u4e3a\u4fc4\u7f57\u65af\u8bbf\u95ee\u91cf\u7b2c\u4e8c\u7684Rambler.ru\u7ad9\u70b9\u5f00\u53d1\u7684\uff0c\u7b2c\u4e00\u4e2a\u516c\u5f00\u7248\u672c0.1.0\u53d1\u5e03\u4e8e2004\u5e7410\u67084\u65e5\u3002\u5176\u5c06\u6e90\u4ee3\u7801\u4ee5\u7c7bBSD\u8bb8\u53ef\u8bc1\u7684\u5f62\u5f0f\u53d1\u5e03\uff0c\u56e0\u5b83\u7684\u7a33\u5b9a\u6027\u3001\u4e30\u5bcc\u7684\u529f\u80fd\u96c6\u3001\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\u548c\u4f4e\u7cfb\u7edf\u8d44\u6e90\u7684\u6d88\u8017\u800c\u95fb\u540d\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a http://nginx.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://nginx.org/en/docs/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible\u4e3b\u673a ansible: `2.3.1.0` os: `Centos 7.2 X64` python: `2.7.5` ansible\u7ba1\u7406\u4e3b\u673a os: `Centos 6.7 X64, Centos 7.2 X64` \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" nginx_version: \"1.12.1\" nginx_file: \"nginx-{{ nginx_version }}.tar.gz\" nginx_file_path: \"{{ software_files_path }}/{{ nginx_file }}\" nginx_file_url: \"http://nginx.org/download/nginx-{{ nginx_version }}.tar.gz\" nginx_temp_path: \"/var/tmp/nginx\" nginx_conf_path: \"{{ software_install_path }}/nginx-{{ nginx_version }}/conf/\" nginx_conf_file_path: \"{{ software_install_path }}/nginx-{{ nginx_version }}/conf/nginx.conf\" nginx_user: 'nginx' nginx_group: 'nginx' nginx_build_options: '' nginx_configure_command: > ./configure --prefix={{ software_install_path }}/nginx-{{ nginx_version }} --user={{ nginx_user }} --group={{ nginx_group }} --with-stream --with-http_ssl_module --with-http_flv_module --with-http_stub_status_module --with-http_gzip_static_module --with-http_realip_module --http-client-body-temp-path={{ nginx_temp_path }}/client/ --http-proxy-temp-path={{ nginx_temp_path }}/proxy/ --http-fastcgi-temp-path={{ nginx_temp_path }}/fcgi/ --http-uwsgi-temp-path={{ nginx_temp_path }}/uwsgi --http-scgi-temp-path={{ nginx_temp_path }}/scgi --with-pcre {{ nginx_build_options }} nginx_pidfile: '/var/run/nginx.pid' nginx_worker_processes: \"{{ ansible_processor_vcpus | default(ansible_processor_count) }}\" nginx_worker_connections: \"1024\" nginx_multi_accept: \"off\" nginx_pid_file: \"/var/run/nginx.pid\" nginx_logpath: \"/var/log/nginx\" nginx_error_log: \"{{ nginx_logpath }}/error.log\" nginx_access_log: \"{{ nginx_logpath }}/access.log\" nginx_mime_file_path: \"mime.types\" nginx_sendfile: \"on\" nginx_tcp_nopush: \"on\" nginx_tcp_nodelay: \"off\" nginx_keepalive_timeout: \"65\" nginx_keepalive_requests: \"100\" nginx_client_max_body_size: \"64m\" nginx_server_names_hash_bucket_size: \"64\" nginx_proxy_cache_path: \"\" nginx_extra_conf_options: \"\" nginx_extra_http_options: \"\" nginx_remove_default_vhost: false nginx_vhosts: [] nginx_upstreams: '' nginx_proxys: false nginx_gzip: false nginx_stub_status: false nginx_stream: false \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/nginx Example Playbook \u00b6 \u9ed8\u8ba4\u5b89\u88c5nginx - hosts: node1 roles: - nginx \u53cd\u5411\u4ee3\u7406 - hosts: node1 vars: - nginx_vhosts: - listen: 80 locations: - name: / proxy_pass: http://192.168.77.135:8080 proxy_set_headers: Host: $host X-Real-IP: $remote_addr X-Forwarded-For: $proxy_add_x_forwarded_for roles: - { role: nginx } \u53cd\u5411\u4ee3\u7406\u7f13\u5b58,\u91c7\u7528\u6269\u5c55\u9009\u9879 - hosts: node1 vars: - nginx_proxy_cache_path: /data/nginx/cache levels=1:2 keys_zone=STATIC:10m inactive=24h max_size=5g - nginx_vhosts: - listen: 80 extra_parameters: | location / { proxy_pass http://192.168.77.135:8080; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_cache STATIC; proxy_cache_valid 200 1d; proxy_cache_use_stale error timeout invalid_header updating http_500 http_502 http_503 http_504; } roles: - { role: nginx } \u53cd\u5411\u8d1f\u8f7d\u5747\u8861 - hosts: node1 vars: - nginx_upstreams: - name: upstremtest servers: - 127.0.0.1:8000 weight=3 max_fails=2 fail_timeout=2 - 127.0.0.1:8001 - 127.0.0.1:8002 - 127.0.0.1:8003 backup - nginx_vhosts: - listen: 80 locations: - name: / proxy_pass: http://upstremtest roles: - { role: nginx } tcp \u7aef\u53e3\u53cd\u5411\u4ee3\u7406 - hosts: node1 vars: - nginx_stream: true - nginx_upstreams: - name: upstremtest servers: - 127.0.0.1:3306 weight=3 max_fails=2 fail_timeout=2 - 127.0.0.1:3307 - nginx_vhosts: - listen: 3306 proxy_pass: upstremtest roles: - { role: nginx } \u4f7f\u7528 \u00b6 /etc/init.d/nginx Usage: /etc/init.d/nginx {start|stop|reload|configtest|status|force-reload|upgrade|restart|reopen_logs}","title":"nginx"},{"location":"roles/web/nginx/#ansible-role-nginx","text":"\u5b89\u88c5Nginx","title":"Ansible Role: Nginx"},{"location":"roles/web/nginx/#_1","text":"Nginx (\"engine x\") \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684HTTP\u548c\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u4e5f\u662f\u4e00\u4e2aIMAP/POP3/SMTP\u670d\u52a1\u5668\u3002Nginx\u662f\u7531Igor Sysoev\u4e3a\u4fc4\u7f57\u65af\u8bbf\u95ee\u91cf\u7b2c\u4e8c\u7684Rambler.ru\u7ad9\u70b9\u5f00\u53d1\u7684\uff0c\u7b2c\u4e00\u4e2a\u516c\u5f00\u7248\u672c0.1.0\u53d1\u5e03\u4e8e2004\u5e7410\u67084\u65e5\u3002\u5176\u5c06\u6e90\u4ee3\u7801\u4ee5\u7c7bBSD\u8bb8\u53ef\u8bc1\u7684\u5f62\u5f0f\u53d1\u5e03\uff0c\u56e0\u5b83\u7684\u7a33\u5b9a\u6027\u3001\u4e30\u5bcc\u7684\u529f\u80fd\u96c6\u3001\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\u548c\u4f4e\u7cfb\u7edf\u8d44\u6e90\u7684\u6d88\u8017\u800c\u95fb\u540d\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a http://nginx.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://nginx.org/en/docs/","title":"\u4ecb\u7ecd"},{"location":"roles/web/nginx/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/web/nginx/#_3","text":"ansible\u4e3b\u673a ansible: `2.3.1.0` os: `Centos 7.2 X64` python: `2.7.5` ansible\u7ba1\u7406\u4e3b\u673a os: `Centos 6.7 X64, Centos 7.2 X64`","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/web/nginx/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" nginx_version: \"1.12.1\" nginx_file: \"nginx-{{ nginx_version }}.tar.gz\" nginx_file_path: \"{{ software_files_path }}/{{ nginx_file }}\" nginx_file_url: \"http://nginx.org/download/nginx-{{ nginx_version }}.tar.gz\" nginx_temp_path: \"/var/tmp/nginx\" nginx_conf_path: \"{{ software_install_path }}/nginx-{{ nginx_version }}/conf/\" nginx_conf_file_path: \"{{ software_install_path }}/nginx-{{ nginx_version }}/conf/nginx.conf\" nginx_user: 'nginx' nginx_group: 'nginx' nginx_build_options: '' nginx_configure_command: > ./configure --prefix={{ software_install_path }}/nginx-{{ nginx_version }} --user={{ nginx_user }} --group={{ nginx_group }} --with-stream --with-http_ssl_module --with-http_flv_module --with-http_stub_status_module --with-http_gzip_static_module --with-http_realip_module --http-client-body-temp-path={{ nginx_temp_path }}/client/ --http-proxy-temp-path={{ nginx_temp_path }}/proxy/ --http-fastcgi-temp-path={{ nginx_temp_path }}/fcgi/ --http-uwsgi-temp-path={{ nginx_temp_path }}/uwsgi --http-scgi-temp-path={{ nginx_temp_path }}/scgi --with-pcre {{ nginx_build_options }} nginx_pidfile: '/var/run/nginx.pid' nginx_worker_processes: \"{{ ansible_processor_vcpus | default(ansible_processor_count) }}\" nginx_worker_connections: \"1024\" nginx_multi_accept: \"off\" nginx_pid_file: \"/var/run/nginx.pid\" nginx_logpath: \"/var/log/nginx\" nginx_error_log: \"{{ nginx_logpath }}/error.log\" nginx_access_log: \"{{ nginx_logpath }}/access.log\" nginx_mime_file_path: \"mime.types\" nginx_sendfile: \"on\" nginx_tcp_nopush: \"on\" nginx_tcp_nodelay: \"off\" nginx_keepalive_timeout: \"65\" nginx_keepalive_requests: \"100\" nginx_client_max_body_size: \"64m\" nginx_server_names_hash_bucket_size: \"64\" nginx_proxy_cache_path: \"\" nginx_extra_conf_options: \"\" nginx_extra_http_options: \"\" nginx_remove_default_vhost: false nginx_vhosts: [] nginx_upstreams: '' nginx_proxys: false nginx_gzip: false nginx_stub_status: false nginx_stream: false","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/web/nginx/#_5","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/web/nginx/#github","text":"https://github.com/lework/Ansible-roles/tree/master/nginx","title":"github\u5730\u5740"},{"location":"roles/web/nginx/#example-playbook","text":"\u9ed8\u8ba4\u5b89\u88c5nginx - hosts: node1 roles: - nginx \u53cd\u5411\u4ee3\u7406 - hosts: node1 vars: - nginx_vhosts: - listen: 80 locations: - name: / proxy_pass: http://192.168.77.135:8080 proxy_set_headers: Host: $host X-Real-IP: $remote_addr X-Forwarded-For: $proxy_add_x_forwarded_for roles: - { role: nginx } \u53cd\u5411\u4ee3\u7406\u7f13\u5b58,\u91c7\u7528\u6269\u5c55\u9009\u9879 - hosts: node1 vars: - nginx_proxy_cache_path: /data/nginx/cache levels=1:2 keys_zone=STATIC:10m inactive=24h max_size=5g - nginx_vhosts: - listen: 80 extra_parameters: | location / { proxy_pass http://192.168.77.135:8080; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_cache STATIC; proxy_cache_valid 200 1d; proxy_cache_use_stale error timeout invalid_header updating http_500 http_502 http_503 http_504; } roles: - { role: nginx } \u53cd\u5411\u8d1f\u8f7d\u5747\u8861 - hosts: node1 vars: - nginx_upstreams: - name: upstremtest servers: - 127.0.0.1:8000 weight=3 max_fails=2 fail_timeout=2 - 127.0.0.1:8001 - 127.0.0.1:8002 - 127.0.0.1:8003 backup - nginx_vhosts: - listen: 80 locations: - name: / proxy_pass: http://upstremtest roles: - { role: nginx } tcp \u7aef\u53e3\u53cd\u5411\u4ee3\u7406 - hosts: node1 vars: - nginx_stream: true - nginx_upstreams: - name: upstremtest servers: - 127.0.0.1:3306 weight=3 max_fails=2 fail_timeout=2 - 127.0.0.1:3307 - nginx_vhosts: - listen: 3306 proxy_pass: upstremtest roles: - { role: nginx }","title":"Example Playbook"},{"location":"roles/web/nginx/#_6","text":"/etc/init.d/nginx Usage: /etc/init.d/nginx {start|stop|reload|configtest|status|force-reload|upgrade|restart|reopen_logs}","title":"\u4f7f\u7528"},{"location":"roles/web/openresty/","text":"Ansible Role: openresty \u00b6 \u5b89\u88c5openresty \u4ecb\u7ecd \u00b6 OpenResty\u00ae \u662f\u4e00\u4e2a\u57fa\u4e8e Nginx \u4e0e Lua \u7684\u9ad8\u6027\u80fd Web \u5e73\u53f0\uff0c\u5176\u5185\u90e8\u96c6\u6210\u4e86\u5927\u91cf\u7cbe\u826f\u7684 Lua \u5e93\u3001\u7b2c\u4e09\u65b9\u6a21\u5757\u4ee5\u53ca\u5927\u591a\u6570\u7684\u4f9d\u8d56\u9879\u3002\u7528\u4e8e\u65b9\u4fbf\u5730\u642d\u5efa\u80fd\u591f\u5904\u7406\u8d85\u9ad8\u5e76\u53d1\u3001\u6269\u5c55\u6027\u6781\u9ad8\u7684\u52a8\u6001 Web \u5e94\u7528\u3001Web \u670d\u52a1\u548c\u52a8\u6001\u7f51\u5173\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://openresty.org/cn/ \u6700\u4f73\u5b9e\u8df5\uff1a https://moonbingbing.gitbooks.io/openresty-best-practices/content/ \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible\u4e3b\u673a ansible: `2.4.2.0` os: `Centos 7.2 X64` python: `2.7.5` ansible\u7ba1\u7406\u4e3b\u673a os: `Centos 6.7 X64, Centos 7.2 X64` \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" openresty_version: \"1.13.6.1\" openresty_file: \"openresty-{{ openresty_version }}.tar.gz\" openresty_file_path: \"{{ software_files_path }}/{{ openresty_file }}\" openresty_file_url: \"https://openresty.org/download/openresty-{{ openresty_version }}.tar.gz\" openresty_conf_path: \"{{ software_install_path }}/openresty/nginx/conf\" openresty_conf_d_path: \"{{ openresty_conf_path }}/conf.d\" openresty_conf_file_path: \"{{ openresty_conf_path }}/nginx.conf\" openresty_user: 'openresty' openresty_group: 'openresty' openresty_build_options: '' openresty_configure_command: > ./configure --prefix={{ software_install_path }}/openresty-{{ openresty_version }} --user={{ openresty_user }} --group={{ openresty_user }} --with-http_realip_module --with-http_sub_module --with-http_auth_request_module --with-http_stub_status_module --with-stream --with-http_gunzip_module --with-http_gzip_static_module --with-http_iconv_module {{ openresty_build_options }} openresty_pidfile: '/var/run/nginx.pid' openresty_worker_processes: \"{{ ansible_processor_vcpus | default(ansible_processor_count) }}\" openresty_worker_connections: \"102400\" openresty_multi_accept: \"off\" openresty_logpath: \"/var/log/openresty\" openresty_error_log: \"{{ openresty_logpath }}/error.log\" openresty_access_log: \"{{ openresty_logpath }}/access.log\" openresty_mime_file_path: \"mime.types\" openresty_sendfile: \"on\" openresty_tcp_nopush: \"on\" openresty_tcp_nodelay: \"off\" openresty_keepalive_timeout: \"65\" openresty_keepalive_requests: \"100\" openresty_client_max_body_size: \"64m\" openresty_server_names_hash_bucket_size: \"64\" openresty_proxy_cache_path: \"\" openresty_extra_conf_options: \"\" openresty_extra_http_options: \"\" openresty_remove_default_vhost: false openresty_vhosts: [] openresty_upstreams: '' openresty_proxys: false openresty_gzip: false openresty_stub_status: false openresty_stream: false \u4f9d\u8d56 \u00b6 \u6ca1\u6709 github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/openresty Example Playbook \u00b6 #\u9ed8\u8ba4\u5b89\u88c5openresty - hosts: node1 roles: - openresty #\u6d4b\u8bd5lua\u811a\u672c - hosts: node1 vars: - openresty_vhosts: - listen: 80 locations: - name: / extra_parameters: | content_by_lua ' ngx.say(\"<p>hello, world</p>\") '; roles: - openresty #\u53cd\u5411\u4ee3\u7406 - hosts: node1 vars: - openresty_vhosts: - listen: 80 locations: - name: / proxy_pass: http://192.168.77.135:8080 proxy_set_headers: Host: $host X-Real-IP: $remote_addr X-Forwarded-For: $proxy_add_x_forwarded_for roles: - openresty #\u53cd\u5411\u4ee3\u7406\u7f13\u5b58,\u91c7\u7528\u6269\u5c55\u9009\u9879 - hosts: node1 vars: - openresty_proxy_cache_path: /usr/local/openresty/nginx/proxy_temp levels=1:2 keys_zone=STATIC:10m inactive=24h max_size=5g - openresty_vhosts: - listen: 80 extra_parameters: | location / { proxy_pass http://192.168.77.135:8080; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_cache STATIC; proxy_cache_valid 200 1d; proxy_cache_use_stale error timeout invalid_header updating http_500 http_502 http_503 http_504; } roles: - openresty #\u53cd\u5411\u8d1f\u8f7d\u5747\u8861 - hosts: node1 vars: - openresty_upstreams: - name: upstremtest servers: - 127.0.0.1:8000 weight=3 max_fails=2 fail_timeout=2 - 127.0.0.1:8001 - 127.0.0.1:8002 - 127.0.0.1:8003 backup - openresty_vhosts: - listen: 80 locations: - name: / proxy_pass: http://upstremtest roles: - openresty #tcp \u7aef\u53e3\u53cd\u5411\u4ee3\u7406 - hosts: node1 vars: - openresty_stream: true - openresty_upstreams: - name: upstremtest servers: - 127.0.0.1:3306 weight=3 max_fails=2 fail_timeout=2 - 127.0.0.1:3307 - openresty_vhosts: - listen: 23306 proxy_pass: upstremtest roles: - openresty \u4f7f\u7528 \u00b6 /etc/init.d/openresty Usage: /etc/init.d/openresty {start|stop|reload|configtest|status|force-reload|upgrade|restart|reopen_logs}","title":"openresty"},{"location":"roles/web/openresty/#ansible-role-openresty","text":"\u5b89\u88c5openresty","title":"Ansible Role: openresty"},{"location":"roles/web/openresty/#_1","text":"OpenResty\u00ae \u662f\u4e00\u4e2a\u57fa\u4e8e Nginx \u4e0e Lua \u7684\u9ad8\u6027\u80fd Web \u5e73\u53f0\uff0c\u5176\u5185\u90e8\u96c6\u6210\u4e86\u5927\u91cf\u7cbe\u826f\u7684 Lua \u5e93\u3001\u7b2c\u4e09\u65b9\u6a21\u5757\u4ee5\u53ca\u5927\u591a\u6570\u7684\u4f9d\u8d56\u9879\u3002\u7528\u4e8e\u65b9\u4fbf\u5730\u642d\u5efa\u80fd\u591f\u5904\u7406\u8d85\u9ad8\u5e76\u53d1\u3001\u6269\u5c55\u6027\u6781\u9ad8\u7684\u52a8\u6001 Web \u5e94\u7528\u3001Web \u670d\u52a1\u548c\u52a8\u6001\u7f51\u5173\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://openresty.org/cn/ \u6700\u4f73\u5b9e\u8df5\uff1a https://moonbingbing.gitbooks.io/openresty-best-practices/content/","title":"\u4ecb\u7ecd"},{"location":"roles/web/openresty/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/web/openresty/#_3","text":"ansible\u4e3b\u673a ansible: `2.4.2.0` os: `Centos 7.2 X64` python: `2.7.5` ansible\u7ba1\u7406\u4e3b\u673a os: `Centos 6.7 X64, Centos 7.2 X64`","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/web/openresty/#_4","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" openresty_version: \"1.13.6.1\" openresty_file: \"openresty-{{ openresty_version }}.tar.gz\" openresty_file_path: \"{{ software_files_path }}/{{ openresty_file }}\" openresty_file_url: \"https://openresty.org/download/openresty-{{ openresty_version }}.tar.gz\" openresty_conf_path: \"{{ software_install_path }}/openresty/nginx/conf\" openresty_conf_d_path: \"{{ openresty_conf_path }}/conf.d\" openresty_conf_file_path: \"{{ openresty_conf_path }}/nginx.conf\" openresty_user: 'openresty' openresty_group: 'openresty' openresty_build_options: '' openresty_configure_command: > ./configure --prefix={{ software_install_path }}/openresty-{{ openresty_version }} --user={{ openresty_user }} --group={{ openresty_user }} --with-http_realip_module --with-http_sub_module --with-http_auth_request_module --with-http_stub_status_module --with-stream --with-http_gunzip_module --with-http_gzip_static_module --with-http_iconv_module {{ openresty_build_options }} openresty_pidfile: '/var/run/nginx.pid' openresty_worker_processes: \"{{ ansible_processor_vcpus | default(ansible_processor_count) }}\" openresty_worker_connections: \"102400\" openresty_multi_accept: \"off\" openresty_logpath: \"/var/log/openresty\" openresty_error_log: \"{{ openresty_logpath }}/error.log\" openresty_access_log: \"{{ openresty_logpath }}/access.log\" openresty_mime_file_path: \"mime.types\" openresty_sendfile: \"on\" openresty_tcp_nopush: \"on\" openresty_tcp_nodelay: \"off\" openresty_keepalive_timeout: \"65\" openresty_keepalive_requests: \"100\" openresty_client_max_body_size: \"64m\" openresty_server_names_hash_bucket_size: \"64\" openresty_proxy_cache_path: \"\" openresty_extra_conf_options: \"\" openresty_extra_http_options: \"\" openresty_remove_default_vhost: false openresty_vhosts: [] openresty_upstreams: '' openresty_proxys: false openresty_gzip: false openresty_stub_status: false openresty_stream: false","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/web/openresty/#_5","text":"\u6ca1\u6709","title":"\u4f9d\u8d56"},{"location":"roles/web/openresty/#github","text":"https://github.com/lework/Ansible-roles/tree/master/openresty","title":"github\u5730\u5740"},{"location":"roles/web/openresty/#example-playbook","text":"#\u9ed8\u8ba4\u5b89\u88c5openresty - hosts: node1 roles: - openresty #\u6d4b\u8bd5lua\u811a\u672c - hosts: node1 vars: - openresty_vhosts: - listen: 80 locations: - name: / extra_parameters: | content_by_lua ' ngx.say(\"<p>hello, world</p>\") '; roles: - openresty #\u53cd\u5411\u4ee3\u7406 - hosts: node1 vars: - openresty_vhosts: - listen: 80 locations: - name: / proxy_pass: http://192.168.77.135:8080 proxy_set_headers: Host: $host X-Real-IP: $remote_addr X-Forwarded-For: $proxy_add_x_forwarded_for roles: - openresty #\u53cd\u5411\u4ee3\u7406\u7f13\u5b58,\u91c7\u7528\u6269\u5c55\u9009\u9879 - hosts: node1 vars: - openresty_proxy_cache_path: /usr/local/openresty/nginx/proxy_temp levels=1:2 keys_zone=STATIC:10m inactive=24h max_size=5g - openresty_vhosts: - listen: 80 extra_parameters: | location / { proxy_pass http://192.168.77.135:8080; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_cache STATIC; proxy_cache_valid 200 1d; proxy_cache_use_stale error timeout invalid_header updating http_500 http_502 http_503 http_504; } roles: - openresty #\u53cd\u5411\u8d1f\u8f7d\u5747\u8861 - hosts: node1 vars: - openresty_upstreams: - name: upstremtest servers: - 127.0.0.1:8000 weight=3 max_fails=2 fail_timeout=2 - 127.0.0.1:8001 - 127.0.0.1:8002 - 127.0.0.1:8003 backup - openresty_vhosts: - listen: 80 locations: - name: / proxy_pass: http://upstremtest roles: - openresty #tcp \u7aef\u53e3\u53cd\u5411\u4ee3\u7406 - hosts: node1 vars: - openresty_stream: true - openresty_upstreams: - name: upstremtest servers: - 127.0.0.1:3306 weight=3 max_fails=2 fail_timeout=2 - 127.0.0.1:3307 - openresty_vhosts: - listen: 23306 proxy_pass: upstremtest roles: - openresty","title":"Example Playbook"},{"location":"roles/web/openresty/#_6","text":"/etc/init.d/openresty Usage: /etc/init.d/openresty {start|stop|reload|configtest|status|force-reload|upgrade|restart|reopen_logs}","title":"\u4f7f\u7528"},{"location":"roles/web/tengine/","text":"Ansible Role: tengine \u00b6 \u5b89\u88c5tengine \u4ecb\u7ecd \u00b6 Tengine\u662f\u7531\u6dd8\u5b9d\u7f51\u53d1\u8d77\u7684Web\u670d\u52a1\u5668\u9879\u76ee\u3002\u5b83\u5728Nginx\u7684\u57fa\u7840\u4e0a\uff0c\u9488\u5bf9\u5927\u8bbf\u95ee\u91cf\u7f51\u7ad9\u7684\u9700\u6c42\uff0c\u6dfb\u52a0\u4e86\u5f88\u591a\u9ad8\u7ea7\u529f\u80fd\u548c\u7279\u6027\u3002Tengine\u7684\u6027\u80fd\u548c\u7a33\u5b9a\u6027\u5df2\u7ecf\u5728\u5927\u578b\u7684\u7f51\u7ad9\u5982\u6dd8\u5b9d\u7f51\uff0c\u5929\u732b\u5546\u57ce\u7b49\u5f97\u5230\u4e86\u5f88\u597d\u7684\u68c0\u9a8c\u3002\u5b83\u7684\u6700\u7ec8\u76ee\u6807\u662f\u6253\u9020\u4e00\u4e2a\u9ad8\u6548\u3001\u7a33\u5b9a\u3001\u5b89\u5168\u3001\u6613\u7528\u7684Web\u5e73\u53f0\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a http://tengine.taobao.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://tengine.taobao.org/documentation.html \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 6, Centos 7, Debian 9 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path : \"/opt/software\" software_install_path : \"/usr/local\" tengine_version : \"2.3.2\" tengine_file : \"tengine-{{ tengine_version }}.tar.gz\" tengine_file_path : \"{{ software_files_path }}/{{ tengine_file }}\" tengine_file_url : \"http://tengine.taobao.org/download/tengine-{{ tengine_version }}.tar.gz\" tengine_started : true tengine_enabled : true tengine_daemon : /usr/local/sbin/nginx tengine_temp_path : \"/var/tmp/tengine\" tengine_conf_path : \"{{ software_install_path }}/tengine-{{ tengine_version }}/conf/\" tengine_conf_file : \"{{ tengine_conf_path }}/nginx.conf\" tengine_user : 'tengine' tengine_group : 'tengine' tengine_build_options : '' tengine_configure_command : > ./configure --prefix={{ software_install_path }}/tengine-{{ tengine_version }} --user={{ tengine_user }} --group={{ tengine_group }} --with-select_module --without-select_module --with-poll_module --without-poll_module --without-procs --with-threads --with-file-aio --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_xslt_module --with-http_image_filter_module --with-http_geoip_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_degradation_module --with-http_slice_module --with-http_stub_status_module --http-client-body-temp-path={{ tengine_temp_path }}/client --http-proxy-temp-path={{ tengine_temp_path }}/proxy --http-fastcgi-temp-path={{ tengine_temp_path }}/fcgi --http-uwsgi-temp-path={{ tengine_temp_path }}/uwsgi --http-scgi-temp-path={{ tengine_temp_path }}/scgi --with-stream --with-stream_ssl_module --with-stream_realip_module --with-stream_geoip_module --with-stream_ssl_preread_module --with-stream_sni --with-pcre --with-debug --without-http_upstream_keepalive_module --add-module=modules/ngx_http_footer_filter_module --add-module=modules/ngx_http_reqstat_module --add-module=modules/ngx_http_slice_module --add-module=modules/ngx_http_trim_filter_module --add-module=modules/ngx_http_upstream_check_module --add-module=modules/ngx_http_upstream_consistent_hash_module --add-module=modules/ngx_http_upstream_keepalive_module --add-module=modules/ngx_http_upstream_session_sticky_module --add-module=modules/ngx_http_upstream_dynamic_module --add-module=modules/ngx_http_upstream_dyups_module --add-module=modules/ngx_http_upstream_vnswrr_module --add-module=modules/ngx_http_user_agent_module --add-module=modules/ngx_multi_upstream_module {{ tengine_build_options }} tengine_pid_file : '/var/run/tengine.pid' tengine_worker_processes : \"{{ ansible_processor_vcpus | default(ansible_processor_count) }}\" tengine_worker_connections : \"10240\" tengine_multi_accept : \"off\" tengine_log_path : \"/var/log/tengine\" tengine_error_log : \"{{ tengine_log_path }}/error.log\" tengine_access_log : \"{{ tengine_log_path }}/access.log\" tengine_mime_file_path : \"mime.types\" tengine_sendfile : \"on\" tengine_tcp_nopush : \"on\" tengine_tcp_nodelay : \"off\" tengine_keepalive_timeout : \"65\" tengine_keepalive_requests : \"1000\" tengine_client_max_body_size : \"64m\" tengine_server_names_hash_bucket_size : \"64\" tengine_proxy_cache_path : \"\" tengine_extra_conf_options : \"\" # tengine_extra_conf_options: | # env VARIABLE; tengine_extra_http_options : \"\" # tengine_extra_http_options: | # proxy_buffering off; # proxy_set_header X-Real-IP $remote_addr; # proxy_set_header X-Scheme $scheme; # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # proxy_set_header Host $http_host; tengine_remove_default_vhost : false tengine_vhosts : [] #- listen: 80 # locations: # - name: / # server_name: test.com # proxy_pass: http://127.0.0.1:8080 # proxy_set_headers: # Host: $host # X-Real-IP: $remote_addr # X-Forwarded-For: $proxy_add_x_forwarded_for tengine_upstreams : '' #- name: upstremtest # servers: # - 127.0.0.1:8000 weight=3 max_fails=2 fail_timeout=2 # - 127.0.0.1:8001 # - 127.0.0.1:8002 # - 127.0.0.1:8003 backup nginx_stream : {} # upstreams: # - name: streamtest # servers: # - 127.0.0.1:22 # servers: # - listen: 2222 # proxy_pass: streamtest tengine_proxys : false tengine_gzip : false tengine_stub_status : false \u4f9d\u8d56 \u00b6 epel github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/tengine Example Playbook \u00b6 # \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - tengine # \u5b9a\u4e49\u865a\u62df\u4e3b\u673a - hosts : node1 vars : - tengine_vhosts : - listen : 80 locations : - name : / proxy_pass : http://192.168.77.135:8080 proxy_set_headers : Host : $host X-Real-IP : $remote_addr X-Forwarded-For : $proxy_add_x_forwarded_for roles : - tengine # \u5b9a\u4e49\u865a\u62df\u4e3b\u673a\u5e76\u8bbe\u7f6e\u4ee3\u7406\u7f13\u5b58 - hosts : node1 vars : - tengine_proxy_cache_path : /tmp levels=1:2 keys_zone=STATIC:10m inactive=24h max_size=5g - tengine_vhosts : - listen : 80 extra_parameters : | location / { proxy_pass http://192.168.77.135:8080; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_cache STATIC; proxy_cache_valid 200 1d; proxy_cache_use_stale error timeout invalid_header updating http_500 http_502 http_503 http_504; } roles : - tengine # \u8bbe\u7f6eupstream - hosts : node1 vars : - tengine_upstreams : - name : upstremtest servers : - 127.0.0.1:8000 weight=3 max_fails=2 fail_timeout=2 - 127.0.0.1:8001 - 127.0.0.1:8002 - 127.0.0.1:8003 backup - tengine_vhosts : - listen : 80 server_name : test.com locations : - name : / proxy_pass : http://upstremtest - listen : 80 server_name : test2.com locations : - name : / proxy_pass : http://upstremtest roles : - tengine # \u5b9a\u4e49stream - hosts : 192.168.77.131 vars : - nginx_stream : upstreams : - name : streamtest servers : - 127.0.0.1:22 servers : - listen : 2222 proxy_pass : streamtest roles : - tengine \u4f7f\u7528 \u00b6 # non systemd /etc/init.d/tengine Usage: /etc/init.d/tengine {start|stop|reload|configtest|status|force-reload|upgrade|restart|reopen_logs} # systemd systemctl status tengine systemctl start tengine systemctl stop tengine","title":"tengine"},{"location":"roles/web/tengine/#ansible-role-tengine","text":"\u5b89\u88c5tengine","title":"Ansible Role: tengine"},{"location":"roles/web/tengine/#_1","text":"Tengine\u662f\u7531\u6dd8\u5b9d\u7f51\u53d1\u8d77\u7684Web\u670d\u52a1\u5668\u9879\u76ee\u3002\u5b83\u5728Nginx\u7684\u57fa\u7840\u4e0a\uff0c\u9488\u5bf9\u5927\u8bbf\u95ee\u91cf\u7f51\u7ad9\u7684\u9700\u6c42\uff0c\u6dfb\u52a0\u4e86\u5f88\u591a\u9ad8\u7ea7\u529f\u80fd\u548c\u7279\u6027\u3002Tengine\u7684\u6027\u80fd\u548c\u7a33\u5b9a\u6027\u5df2\u7ecf\u5728\u5927\u578b\u7684\u7f51\u7ad9\u5982\u6dd8\u5b9d\u7f51\uff0c\u5929\u732b\u5546\u57ce\u7b49\u5f97\u5230\u4e86\u5f88\u597d\u7684\u68c0\u9a8c\u3002\u5b83\u7684\u6700\u7ec8\u76ee\u6807\u662f\u6253\u9020\u4e00\u4e2a\u9ad8\u6548\u3001\u7a33\u5b9a\u3001\u5b89\u5168\u3001\u6613\u7528\u7684Web\u5e73\u53f0\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a http://tengine.taobao.org/ \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a http://tengine.taobao.org/documentation.html","title":"\u4ecb\u7ecd"},{"location":"roles/web/tengine/#_2","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c\u3002","title":"\u8981\u6c42"},{"location":"roles/web/tengine/#_3","text":"ansible\u4e3b\u673a ansible: 2.9.1 os: Centos 7.4 X64 python: 2.7.5 ansible\u7ba1\u7406\u4e3b\u673a os: Centos 6, Centos 7, Debian 9","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/web/tengine/#_4","text":"software_files_path : \"/opt/software\" software_install_path : \"/usr/local\" tengine_version : \"2.3.2\" tengine_file : \"tengine-{{ tengine_version }}.tar.gz\" tengine_file_path : \"{{ software_files_path }}/{{ tengine_file }}\" tengine_file_url : \"http://tengine.taobao.org/download/tengine-{{ tengine_version }}.tar.gz\" tengine_started : true tengine_enabled : true tengine_daemon : /usr/local/sbin/nginx tengine_temp_path : \"/var/tmp/tengine\" tengine_conf_path : \"{{ software_install_path }}/tengine-{{ tengine_version }}/conf/\" tengine_conf_file : \"{{ tengine_conf_path }}/nginx.conf\" tengine_user : 'tengine' tengine_group : 'tengine' tengine_build_options : '' tengine_configure_command : > ./configure --prefix={{ software_install_path }}/tengine-{{ tengine_version }} --user={{ tengine_user }} --group={{ tengine_group }} --with-select_module --without-select_module --with-poll_module --without-poll_module --without-procs --with-threads --with-file-aio --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_xslt_module --with-http_image_filter_module --with-http_geoip_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_degradation_module --with-http_slice_module --with-http_stub_status_module --http-client-body-temp-path={{ tengine_temp_path }}/client --http-proxy-temp-path={{ tengine_temp_path }}/proxy --http-fastcgi-temp-path={{ tengine_temp_path }}/fcgi --http-uwsgi-temp-path={{ tengine_temp_path }}/uwsgi --http-scgi-temp-path={{ tengine_temp_path }}/scgi --with-stream --with-stream_ssl_module --with-stream_realip_module --with-stream_geoip_module --with-stream_ssl_preread_module --with-stream_sni --with-pcre --with-debug --without-http_upstream_keepalive_module --add-module=modules/ngx_http_footer_filter_module --add-module=modules/ngx_http_reqstat_module --add-module=modules/ngx_http_slice_module --add-module=modules/ngx_http_trim_filter_module --add-module=modules/ngx_http_upstream_check_module --add-module=modules/ngx_http_upstream_consistent_hash_module --add-module=modules/ngx_http_upstream_keepalive_module --add-module=modules/ngx_http_upstream_session_sticky_module --add-module=modules/ngx_http_upstream_dynamic_module --add-module=modules/ngx_http_upstream_dyups_module --add-module=modules/ngx_http_upstream_vnswrr_module --add-module=modules/ngx_http_user_agent_module --add-module=modules/ngx_multi_upstream_module {{ tengine_build_options }} tengine_pid_file : '/var/run/tengine.pid' tengine_worker_processes : \"{{ ansible_processor_vcpus | default(ansible_processor_count) }}\" tengine_worker_connections : \"10240\" tengine_multi_accept : \"off\" tengine_log_path : \"/var/log/tengine\" tengine_error_log : \"{{ tengine_log_path }}/error.log\" tengine_access_log : \"{{ tengine_log_path }}/access.log\" tengine_mime_file_path : \"mime.types\" tengine_sendfile : \"on\" tengine_tcp_nopush : \"on\" tengine_tcp_nodelay : \"off\" tengine_keepalive_timeout : \"65\" tengine_keepalive_requests : \"1000\" tengine_client_max_body_size : \"64m\" tengine_server_names_hash_bucket_size : \"64\" tengine_proxy_cache_path : \"\" tengine_extra_conf_options : \"\" # tengine_extra_conf_options: | # env VARIABLE; tengine_extra_http_options : \"\" # tengine_extra_http_options: | # proxy_buffering off; # proxy_set_header X-Real-IP $remote_addr; # proxy_set_header X-Scheme $scheme; # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # proxy_set_header Host $http_host; tengine_remove_default_vhost : false tengine_vhosts : [] #- listen: 80 # locations: # - name: / # server_name: test.com # proxy_pass: http://127.0.0.1:8080 # proxy_set_headers: # Host: $host # X-Real-IP: $remote_addr # X-Forwarded-For: $proxy_add_x_forwarded_for tengine_upstreams : '' #- name: upstremtest # servers: # - 127.0.0.1:8000 weight=3 max_fails=2 fail_timeout=2 # - 127.0.0.1:8001 # - 127.0.0.1:8002 # - 127.0.0.1:8003 backup nginx_stream : {} # upstreams: # - name: streamtest # servers: # - 127.0.0.1:22 # servers: # - listen: 2222 # proxy_pass: streamtest tengine_proxys : false tengine_gzip : false tengine_stub_status : false","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/web/tengine/#_5","text":"epel","title":"\u4f9d\u8d56"},{"location":"roles/web/tengine/#github","text":"https://github.com/lework/Ansible-roles/tree/master/tengine","title":"github\u5730\u5740"},{"location":"roles/web/tengine/#example-playbook","text":"# \u9ed8\u8ba4\u5b89\u88c5 - hosts : node1 roles : - tengine # \u5b9a\u4e49\u865a\u62df\u4e3b\u673a - hosts : node1 vars : - tengine_vhosts : - listen : 80 locations : - name : / proxy_pass : http://192.168.77.135:8080 proxy_set_headers : Host : $host X-Real-IP : $remote_addr X-Forwarded-For : $proxy_add_x_forwarded_for roles : - tengine # \u5b9a\u4e49\u865a\u62df\u4e3b\u673a\u5e76\u8bbe\u7f6e\u4ee3\u7406\u7f13\u5b58 - hosts : node1 vars : - tengine_proxy_cache_path : /tmp levels=1:2 keys_zone=STATIC:10m inactive=24h max_size=5g - tengine_vhosts : - listen : 80 extra_parameters : | location / { proxy_pass http://192.168.77.135:8080; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_cache STATIC; proxy_cache_valid 200 1d; proxy_cache_use_stale error timeout invalid_header updating http_500 http_502 http_503 http_504; } roles : - tengine # \u8bbe\u7f6eupstream - hosts : node1 vars : - tengine_upstreams : - name : upstremtest servers : - 127.0.0.1:8000 weight=3 max_fails=2 fail_timeout=2 - 127.0.0.1:8001 - 127.0.0.1:8002 - 127.0.0.1:8003 backup - tengine_vhosts : - listen : 80 server_name : test.com locations : - name : / proxy_pass : http://upstremtest - listen : 80 server_name : test2.com locations : - name : / proxy_pass : http://upstremtest roles : - tengine # \u5b9a\u4e49stream - hosts : 192.168.77.131 vars : - nginx_stream : upstreams : - name : streamtest servers : - 127.0.0.1:22 servers : - listen : 2222 proxy_pass : streamtest roles : - tengine","title":"Example Playbook"},{"location":"roles/web/tengine/#_6","text":"# non systemd /etc/init.d/tengine Usage: /etc/init.d/tengine {start|stop|reload|configtest|status|force-reload|upgrade|restart|reopen_logs} # systemd systemctl status tengine systemctl start tengine systemctl stop tengine","title":"\u4f7f\u7528"},{"location":"roles/web/tomcat/","text":"Ansible Role: Tomcat \u00b6 \u5b89\u88c5tomcat\u5e94\u7528 \u8981\u6c42 \u00b6 \u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c, \u652f\u6301Centos6\\7\u3002 \u6d4b\u8bd5\u73af\u5883 \u00b6 ansible 2.6.4.0 os Centos 7.2 X64 python 2.7.5 \u89d2\u8272\u53d8\u91cf \u00b6 software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" java_home: \"{{ ansible_env.JAVA_HOME | default('/usr/java/jdk1.7.0_80') }}\" tomcat_version: \"7.0.90\" tomcat_file: \"apache-tomcat-{{ tomcat_version }}.tar.gz\" tomcat_path: \"{{ software_install_path }}/apache-tomcat-{{ tomcat_version }}\" tomcat_file_path: \"{{ software_files_path }}/{{ tomcat_file }}\" tomcat_file_url: \"http://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-7/v{{ tomcat_version }}/bin/apache-tomcat-{{ tomcat_version }}.tar.gz\" tomcat_enabled: true tomcat_server_active: false tomcat_ajp_active: false tomcat_hostname: localhost tomcat_user: tomcat tomcat_server_port: 8005 tomcat_catalina_port: 8080 tomcat_catalina_ajp_port: 8009 tomcat_catalina_redirect_port: 8443 tomcat_unpackWARs: true tomcat_autoDeploy: true tomcat_services_name: \"tomcat{% if tomcat_catalina_port != 8080 %}{{ tomcat_catalina_port }}{% endif %}\" tomcat_work_path: \"{{ software_install_path }}/{{ tomcat_services_name }}\" tomcat_daemon_native_path: \"{{ tomcat_work_path }}/bin/commons-daemon-1.1.0-native-src\" tomcat_native_path: \"{{ tomcat_work_path }}/bin/tomcat-native-1.2.17-src\" tomcat_apr: false tomcat_clear_webapps: true tomcat_catalina_opts: \"-server -Xms1G -Xmx1G -XX:PermSize=256m -XX:MaxPermSize=256m -XX:NewSize=256m -XX:MaxNewSize=256m -Dfile.encoding=UTF-8 -Dsun.jnu.encoding=UTF-8 -Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom{% if tomcat_apr %} -Djava.library.path=/usr/local/apr/lib {% endif %}-XX:SurvivorRatio=10 -XX:+UseParNewGC -XX:ParallelGCThreads=4 -XX:MaxTenuringThreshold=13 -XX:+UseConcMarkSweepGC -XX:+DisableExplicitGC -XX:+UseCMSInitiatingOccupancyOnly -XX:+ScavengeBeforeFullGC -XX:+UseCMSCompactAtFullCollection -XX:+CMSParallelRemarkEnabled -XX:CMSFullGCsBeforeCompaction=9 -XX:CMSInitiatingOccupancyFraction=60 -XX:+CMSClassUnloadingEnabled -XX:SoftRefLRUPolicyMSPerMB=0 -XX:-ReduceInitialCardMarks -XX:+CMSPermGenSweepingEnabled -XX:CMSInitiatingPermOccupancyFraction=70 -XX:+ExplicitGCInvokesConcurrent -Djava.nio.channels.spi.SelectorProvider=sun.nio.ch.EPollSelectorProvider -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCApplicationConcurrentTime -XX:+PrintHeapAtGC -Xloggc:{{ tomcat_work_path }}/logs/heap_trace.txt -XX:-HeapDumpOnOutOfMemoryError -XX:HeapDumpPath={{ tomcat_work_path }}/logs/HeapDumpOnOutOfMemoryError -Djava.util.Arrays.useLegacyMergeSort=true\" \u4f9d\u8d56 \u00b6 java github\u5730\u5740 \u00b6 https://github.com/lework/Ansible-roles/tree/master/tomcat Example Playbook \u00b6 \u5b89\u88c5tomcat7 - hosts: node1 roles: - tomcat - hosts: node1 roles: - { role: tomcat, tomcat_catalina_port: 8081, tomcat_server_port: 8005} - { role: tomcat, tomcat_catalina_port: 8082, tomcat_server_port: 8006} \u5b89\u88c5tomcat7\uff0c\u4f7f\u7528apr - hosts: node1 roles: - { role: tomcat, tomcat_apr: true, tomcat_catalina_port: 8007} \u5b89\u88c5tomcat8 - hosts: node1 vars: - java_version: \"1.8\" - tomcat_version: \"8.5.28\" roles: - java - tomcat \u4f7f\u7528 \u00b6 centos 6 service tomcat Usage: tomcat ( commands ... ) commands: run Start Tomcat without detaching from console start Start Tomcat stop Stop Tomcat version What version of commons daemon and Tomcat are you running? centos 7 systemctl start tomcat systemctl status tomcat systemctl stop tomcat","title":"tomcat"},{"location":"roles/web/tomcat/#ansible-role-tomcat","text":"\u5b89\u88c5tomcat\u5e94\u7528","title":"Ansible Role: Tomcat"},{"location":"roles/web/tomcat/#_1","text":"\u6b64\u89d2\u8272\u4ec5\u5728RHEL\u53ca\u5176\u884d\u751f\u4ea7\u54c1\u4e0a\u8fd0\u884c, \u652f\u6301Centos6\\7\u3002","title":"\u8981\u6c42"},{"location":"roles/web/tomcat/#_2","text":"ansible 2.6.4.0 os Centos 7.2 X64 python 2.7.5","title":"\u6d4b\u8bd5\u73af\u5883"},{"location":"roles/web/tomcat/#_3","text":"software_files_path: \"/opt/software\" software_install_path: \"/usr/local\" java_home: \"{{ ansible_env.JAVA_HOME | default('/usr/java/jdk1.7.0_80') }}\" tomcat_version: \"7.0.90\" tomcat_file: \"apache-tomcat-{{ tomcat_version }}.tar.gz\" tomcat_path: \"{{ software_install_path }}/apache-tomcat-{{ tomcat_version }}\" tomcat_file_path: \"{{ software_files_path }}/{{ tomcat_file }}\" tomcat_file_url: \"http://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-7/v{{ tomcat_version }}/bin/apache-tomcat-{{ tomcat_version }}.tar.gz\" tomcat_enabled: true tomcat_server_active: false tomcat_ajp_active: false tomcat_hostname: localhost tomcat_user: tomcat tomcat_server_port: 8005 tomcat_catalina_port: 8080 tomcat_catalina_ajp_port: 8009 tomcat_catalina_redirect_port: 8443 tomcat_unpackWARs: true tomcat_autoDeploy: true tomcat_services_name: \"tomcat{% if tomcat_catalina_port != 8080 %}{{ tomcat_catalina_port }}{% endif %}\" tomcat_work_path: \"{{ software_install_path }}/{{ tomcat_services_name }}\" tomcat_daemon_native_path: \"{{ tomcat_work_path }}/bin/commons-daemon-1.1.0-native-src\" tomcat_native_path: \"{{ tomcat_work_path }}/bin/tomcat-native-1.2.17-src\" tomcat_apr: false tomcat_clear_webapps: true tomcat_catalina_opts: \"-server -Xms1G -Xmx1G -XX:PermSize=256m -XX:MaxPermSize=256m -XX:NewSize=256m -XX:MaxNewSize=256m -Dfile.encoding=UTF-8 -Dsun.jnu.encoding=UTF-8 -Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom{% if tomcat_apr %} -Djava.library.path=/usr/local/apr/lib {% endif %}-XX:SurvivorRatio=10 -XX:+UseParNewGC -XX:ParallelGCThreads=4 -XX:MaxTenuringThreshold=13 -XX:+UseConcMarkSweepGC -XX:+DisableExplicitGC -XX:+UseCMSInitiatingOccupancyOnly -XX:+ScavengeBeforeFullGC -XX:+UseCMSCompactAtFullCollection -XX:+CMSParallelRemarkEnabled -XX:CMSFullGCsBeforeCompaction=9 -XX:CMSInitiatingOccupancyFraction=60 -XX:+CMSClassUnloadingEnabled -XX:SoftRefLRUPolicyMSPerMB=0 -XX:-ReduceInitialCardMarks -XX:+CMSPermGenSweepingEnabled -XX:CMSInitiatingPermOccupancyFraction=70 -XX:+ExplicitGCInvokesConcurrent -Djava.nio.channels.spi.SelectorProvider=sun.nio.ch.EPollSelectorProvider -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCApplicationConcurrentTime -XX:+PrintHeapAtGC -Xloggc:{{ tomcat_work_path }}/logs/heap_trace.txt -XX:-HeapDumpOnOutOfMemoryError -XX:HeapDumpPath={{ tomcat_work_path }}/logs/HeapDumpOnOutOfMemoryError -Djava.util.Arrays.useLegacyMergeSort=true\"","title":"\u89d2\u8272\u53d8\u91cf"},{"location":"roles/web/tomcat/#_4","text":"java","title":"\u4f9d\u8d56"},{"location":"roles/web/tomcat/#github","text":"https://github.com/lework/Ansible-roles/tree/master/tomcat","title":"github\u5730\u5740"},{"location":"roles/web/tomcat/#example-playbook","text":"\u5b89\u88c5tomcat7 - hosts: node1 roles: - tomcat - hosts: node1 roles: - { role: tomcat, tomcat_catalina_port: 8081, tomcat_server_port: 8005} - { role: tomcat, tomcat_catalina_port: 8082, tomcat_server_port: 8006} \u5b89\u88c5tomcat7\uff0c\u4f7f\u7528apr - hosts: node1 roles: - { role: tomcat, tomcat_apr: true, tomcat_catalina_port: 8007} \u5b89\u88c5tomcat8 - hosts: node1 vars: - java_version: \"1.8\" - tomcat_version: \"8.5.28\" roles: - java - tomcat","title":"Example Playbook"},{"location":"roles/web/tomcat/#_5","text":"centos 6 service tomcat Usage: tomcat ( commands ... ) commands: run Start Tomcat without detaching from console start Start Tomcat stop Stop Tomcat version What version of commons daemon and Tomcat are you running? centos 7 systemctl start tomcat systemctl status tomcat systemctl stop tomcat","title":"\u4f7f\u7528"},{"location":"ui/","text":"Ansible UI \u00b6 AWX \u00b6 AWX \u662f\u4e00\u4e2a\u7531Red Hat\u8d5e\u52a9\u7684\u5f00\u6e90\u793e\u533a\u9879\u76ee\uff0c\u5b83\u4f7f\u7528\u6237\u80fd\u591f\u66f4\u597d\u5730\u63a7\u5236\u4ed6\u4eec\u7684Ansible\u9879\u76ee\u5728IT\u73af\u5883\u4e2d\u7684\u4f7f\u7528\u3002AWX\u662fRed Hat Ansible Tower\u4ea7\u54c1\u6700\u7ec8\u884d\u751f\u7684\u4e0a\u6e38\u9879\u76ee\u3002\u4f7f\u7528python\u8bed\u8a00\u7f16\u5199\u3002 Ansible Tower \u00b6 Ansible Tower \u662f\u4e00\u4e2a\u7531Red Hat\u8d5e\u52a9\u7684\u5f00\u6e90\u793e\u533a\u9879\u76ee\uff0c\u5b83\u4f7f\u7528\u6237\u80fd\u591f\u66f4\u597d\u5730\u63a7\u5236\u4ed6\u4eec\u7684Ansible\u9879\u76ee\u5728IT\u73af\u5883\u4e2d\u7684\u4f7f\u7528\u3002Ansible Tower\u63d0\u4f9b\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff0c\u5305\u62ec\u5bf9SSH\u548c\u5176\u4ed6\u670d\u52a1\u4f7f\u7528\u5b89\u5168\u5b58\u50a8\u7684\u51ed\u8bc1\u7684\u63a7\u5236\u3002\u4f60\u53ef\u4ee5\u540c\u6b65\u4f60\u7684Ansible Tower\u5e93\u5b58\u4e0e\u5404\u79cd\u5404\u6837\u7684\u4e91\u8d44\u6e90\uff0c\u548c\u5f3a\u5927\u7684\u591a\u5267\u672c\u5de5\u4f5c\u6d41\u5141\u8bb8\u4f60\u5efa\u6a21\u590d\u6742\u7684\u8fc7\u7a0b\u3002\u4f7f\u7528python\u8bed\u8a00\u7f16\u5199\u3002 Semaphore \u00b6 semaphore \u662f\u4e00\u6b3e\u57fa\u4e8eGO\u8bed\u8a00\u7f16\u5199\u7684 Ansible-Web UI\u7cfb\u7edf\u3002 Dogpro \u00b6 Dogpro \u662f\u57fa\u4e8eWeb\u7684ansible\u90e8\u7f72UI, \u7531php\u5f00\u53d1\u8bed\u8a00\u7f16\u5199\u3002 nci-ansible-ui \u00b6 nci-ansible-ui \u662f\u4e00\u4e2a\u7b80\u5355\u7684web\u754c\u9762\uff0c\u53ef\u4ee5\u5728\u4e0a\u9762\u8fd0\u884cansible playbook\uff0c\u4f7f\u7528node.js\u7f16\u5199\u3002","title":"Ansible UI \u8bf4\u660e"},{"location":"ui/#ansible-ui","text":"","title":"Ansible UI"},{"location":"ui/#awx","text":"AWX \u662f\u4e00\u4e2a\u7531Red Hat\u8d5e\u52a9\u7684\u5f00\u6e90\u793e\u533a\u9879\u76ee\uff0c\u5b83\u4f7f\u7528\u6237\u80fd\u591f\u66f4\u597d\u5730\u63a7\u5236\u4ed6\u4eec\u7684Ansible\u9879\u76ee\u5728IT\u73af\u5883\u4e2d\u7684\u4f7f\u7528\u3002AWX\u662fRed Hat Ansible Tower\u4ea7\u54c1\u6700\u7ec8\u884d\u751f\u7684\u4e0a\u6e38\u9879\u76ee\u3002\u4f7f\u7528python\u8bed\u8a00\u7f16\u5199\u3002","title":"AWX"},{"location":"ui/#ansible-tower","text":"Ansible Tower \u662f\u4e00\u4e2a\u7531Red Hat\u8d5e\u52a9\u7684\u5f00\u6e90\u793e\u533a\u9879\u76ee\uff0c\u5b83\u4f7f\u7528\u6237\u80fd\u591f\u66f4\u597d\u5730\u63a7\u5236\u4ed6\u4eec\u7684Ansible\u9879\u76ee\u5728IT\u73af\u5883\u4e2d\u7684\u4f7f\u7528\u3002Ansible Tower\u63d0\u4f9b\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff0c\u5305\u62ec\u5bf9SSH\u548c\u5176\u4ed6\u670d\u52a1\u4f7f\u7528\u5b89\u5168\u5b58\u50a8\u7684\u51ed\u8bc1\u7684\u63a7\u5236\u3002\u4f60\u53ef\u4ee5\u540c\u6b65\u4f60\u7684Ansible Tower\u5e93\u5b58\u4e0e\u5404\u79cd\u5404\u6837\u7684\u4e91\u8d44\u6e90\uff0c\u548c\u5f3a\u5927\u7684\u591a\u5267\u672c\u5de5\u4f5c\u6d41\u5141\u8bb8\u4f60\u5efa\u6a21\u590d\u6742\u7684\u8fc7\u7a0b\u3002\u4f7f\u7528python\u8bed\u8a00\u7f16\u5199\u3002","title":"Ansible Tower"},{"location":"ui/#semaphore","text":"semaphore \u662f\u4e00\u6b3e\u57fa\u4e8eGO\u8bed\u8a00\u7f16\u5199\u7684 Ansible-Web UI\u7cfb\u7edf\u3002","title":"Semaphore"},{"location":"ui/#dogpro","text":"Dogpro \u662f\u57fa\u4e8eWeb\u7684ansible\u90e8\u7f72UI, \u7531php\u5f00\u53d1\u8bed\u8a00\u7f16\u5199\u3002","title":"Dogpro"},{"location":"ui/#nci-ansible-ui","text":"nci-ansible-ui \u662f\u4e00\u4e2a\u7b80\u5355\u7684web\u754c\u9762\uff0c\u53ef\u4ee5\u5728\u4e0a\u9762\u8fd0\u884cansible playbook\uff0c\u4f7f\u7528node.js\u7f16\u5199\u3002","title":"nci-ansible-ui"},{"location":"ui/awx/","text":"AWX \u00b6 AWX \u662f\u4e00\u4e2a\u5f00\u6e90\u793e\u533a\u9879\u76ee\uff0c\u63d0\u4f9b\u7528\u4e8e\u7ba1\u7406 Ansible \u9879\u76ee\u7684\u8f6f\u4ef6\u3002AWX \u6258\u7ba1\u5728 GitHub \u4e0a\uff0c\u5e76\u63d0\u4f9b\u57fa\u4e8e Web \u7684\u7528\u6237\u754c\u9762\u3001REST API \u548c\u9002\u7528\u4e8e Ansible \u7684\u4efb\u52a1\u5f15\u64ce\u3002 Ansible \u662f\u4e00\u6b3e\u5f00\u53d1\u8fd0\u8425\u5de5\u5177\uff0c\u53ef\u81ea\u52a8\u6267\u884c\u9884\u7f6e\u3001\u914d\u7f6e\u7ba1\u7406\u3001\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u3001\u5185\u90e8\u670d\u52a1\u7f16\u6392\u3001\u6301\u7eed\u4ea4\u4ed8\u548c\u8bb8\u591a\u5176\u4ed6 IT \u6d41\u7a0b\u3002\u76f4\u89c2\u7684 AWX \u63a7\u5236\u9762\u677f\u8ba9\u60a8\u80fd\u591f\u5b89\u6392\u548c\u90e8\u7f72 Ansible Playbook\uff0c\u5e76\u63d0\u4f9b\u96c6\u4e2d\u7684\u65e5\u5fd7\u8bb0\u5f55\u3001\u5ba1\u8ba1\u548c\u7cfb\u7edf\u8ddf\u8e2a\u3002AWX \u53ef\u63d0\u4f9b Ansible Tower \u7684\u6e90\u4ee3\u7801\uff0cAnsible Tower \u662f AWX \u7684\u5546\u4e1a\u7248\u672c\u3002 \u6b64\u5feb\u901f\u5165\u95e8\u4ece AWX \u7684 GitHub \u5b58\u50a8\u5e93 \u7684\u4e3b\u5206\u652f\u90e8\u7f72\u4ee3\u7801\u3002\u60a8\u8fd8\u53ef\u4ee5\u9009\u62e9\u4ece\u8be5\u5b58\u50a8\u5e93\u7684\u5176\u4ed6\u5206\u652f\u90e8\u7f72\u4ee3\u7801\u3002 Awx install \u00b6 \u7cfb\u7edf\u73af\u5883 \u00b6 OS: centos 7.7 x64 IP: 192.168.77.130 \u5b89\u88c5\u4f9d\u8d56 \u00b6 yum -y install git gcc gcc-c++ ansible nodejs gettext device-mapper-persistent-data lvm2 bzip2 python-pip python-devel \u5b89\u88c5docker\u73af\u5883 \u00b6 curl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo sed -i 's#download.docker.com#mirrors.ustc.edu.cn/docker-ce#g' /etc/yum.repos.d/docker-ce.repo yum -y install docker-ce bash-completion pip install docker-compose -r http://mirrors.aliyun.com/pypi/simple curl -L https://raw.githubusercontent.com/docker/compose/master/contrib/completion/bash/docker-compose -o /etc/bash_completion.d/docker-compose cp /usr/share/bash-completion/completions/docker /etc/bash_completion.d/ mkdir /etc/docker cat > /etc/docker/daemon.json <<EOF { \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"100m\", \"max-file\": \"3\" }, \"default-ulimits\": { \"nofile\": { \"Name\": \"nofile\", \"Hard\": 64000, \"Soft\": 64000 } }, \"live-restore\": true, \"max-concurrent-downloads\": 10, \"max-concurrent-uploads\": 10, \"storage-driver\": \"overlay2\", \"storage-opts\": [ \"overlay2.override_kernel_check=true\" ], \"registry-mirrors\": [ \"http://hub-mirror.c.163.com\" ] } EOF systemctl enable --now docker \u7248\u672c\u4fe1\u606f # python -V Python 2 .7.5 # docker version ' Client: Version: 18 .09.6 API version: 1 .39 Go version: go1.10.8 Git commit: 481bc77156 Built: Sat May 4 02 :34:58 2019 OS/Arch: linux/amd64 Experimental: false Server: Docker Engine - Community Engine: Version: 19 .03.8 API version: 1 .40 ( minimum version 1 .12 ) Go version: go1.12.17 Git commit: afacb8b Built: Wed Mar 11 01 :25:42 2020 OS/Arch: linux/amd64 Experimental: false containerd: Version: 1 .2.5 GitCommit: bb71b10fd8f58240ca47fbb579b9d1028eea7c84 runc: Version: 1 .0.0-rc6+dev GitCommit: 2b18fe1d885ee5083ef9f0838fee39b62d653e30 docker-init: Version: 0 .18.0 GitCommit: fec3683 # docker-compose version docker-compose version 1 .25.5, build unknown docker-py version: 4 .2.0 CPython version: 2 .7.5 OpenSSL version: OpenSSL 1 .0.2k-fips 26 Jan 2017 \u5b89\u88c5 awx \u00b6 # wget https://github.com/ansible/awx/archive/11.2.0.tar.gz # tar zxf 11.2.0.tar.gz # cd awx-11.2.0/ \u751f\u6210\u52a0\u5bc6\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u7684\u5bc6\u94a5 # openssl rand -base64 30 nir4yYx6Bb4uN/ow98f2tD9Wktm8A/cwgqTgzHLg \u914d\u7f6e\u4e3b\u673a\u6e05\u5355\u6587\u4ef6 installer/inventory localhost ansible_connection = local ansible_python_interpreter=\"/usr/bin/env python3\" [all:vars] dockerhub_base = ansible docker_compose_dir = \"~/.awx/awxcompose\" awx_task_hostname = awx awx_web_hostname = awxweb host_port = 80 host_port_ssl = 443 pg_username = awx pg_password = awxpass pg_database = awx pg_port = 5432 postgres_data_dir = \"~/.awx/pgdocker\" admin_user = admin admin_password = password create_preload_data = True secret_key = nir4yYx6Bb4uN/ow98f2tD9Wktm8A/cwgqTgzHLg awx_alternate_dns_servers = \"8.8.8.8,8.8.4.4\" project_data_dir = \"~/.awx/projects\" \u6267\u884c\u5b89\u88c5 plyabook # cd installer # ansible-playbook -i inventory install.yml PLAY [ Build and deploy AWX ] ****************************************************************************************** TASK [ Gathering Facts ] *********************************************************************************************** ok: [ localhost ] TASK [ check_vars : include_tasks ] ************************************************************************************ included: /root/awx-11.2.0/installer/roles/check_vars/tasks/check_docker.yml for localhost TASK [ check_vars : postgres_data_dir should be defined ] ************************************************************** ok: [ localhost ] = > { \"changed\" : false, \"msg\" : \"All assertions passed\" } TASK [ check_vars : host_port should be defined ] ********************************************************************** ok: [ localhost ] = > { \"changed\" : false, \"msg\" : \"All assertions passed\" } TASK [ local_docker : Generate broadcast websocket secret ] ************************************************************ ok: [ localhost ] TASK [ local_docker : Check for existing Postgres data ] *************************************************************** ok: [ localhost ] TASK [ local_docker : Determine whether to upgrade postgres ] ********************************************************** ok: [ localhost ] TASK [ local_docker : Remove old data directory ] ********************************************************************** ok: [ localhost ] TASK [ local_docker : Set DockerHub Image Paths ] ********************************************************************** ok: [ localhost ] TASK [ local_docker : Create ~/.awx/awxcompose directory ] ************************************************************* changed: [ localhost ] TASK [ local_docker : Create Redis socket directory ] ****************************************************************** changed: [ localhost ] TASK [ local_docker : Create Memcached socket directory ] ************************************************************** changed: [ localhost ] TASK [ local_docker : Create Docker Compose Configuration ] ************************************************************ changed: [ localhost ] = > ( item = environment.sh ) changed: [ localhost ] = > ( item = credentials.py ) changed: [ localhost ] = > ( item = docker-compose.yml ) changed: [ localhost ] = > ( item = nginx.conf ) changed: [ localhost ] = > ( item = redis.conf ) TASK [ local_docker : Set redis config to other group readable to satisfy redis-server ] ******************************** changed: [ localhost ] TASK [ local_docker : Render SECRET_KEY file ] ************************************************************************** ok: [ localhost ] TASK [ local_docker : Start the containers ] **************************************************************************** changed: [ localhost ] TASK [ local_docker : Update CA trust in awx_web container ] ************************************************************ changed: [ localhost ] TASK [ local_docker : Update CA trust in awx_task container ] *********************************************************** changed: [ localhost ] PLAY RECAP ************************************************************************************************************ localhost : ok = 18 changed = 5 unreachable = 0 failed = 0 skipped = 97 rescued = 0 ignored = 0 \u542f\u52a8\u7684\u5bb9\u5668 # docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES df5f7cb15da0 ansible/awx_task:11.2.0 \"tini -- /bin/sh -c \u2026\" About a minute ago Up About a minute 8052 /tcp awx_task 5b774471f6e3 ansible/awx_web:11.2.0 \"tini -- /bin/sh -c \u2026\" About a minute ago Up About a minute 0 .0.0.0:80->8052/tcp awx_web ad4c005ac0e9 memcached:alpine \"docker-entrypoint.s\u2026\" About a minute ago Up About a minute 11211 /tcp awx_memcached f73edd420c15 postgres:10 \"docker-entrypoint.s\u2026\" About a minute ago Up About a minute 5432 /tcp awx_postgres c006d3e473bd redis \"docker-entrypoint.s\u2026\" About a minute ago Up About a minute 6379 /tcp awx_redis WEB \u754c\u9762 \u00b6 \u8bbf\u95ee\u5730\u5740 http://192.168.77.130 \u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\u767b\u5f55\u540e\uff0c\u5c31\u80fd\u770b\u5230awx\u7684\u754c\u9762\u4e86\u3002 Awx \u4f7f\u7528 \u00b6 \u6dfb\u52a0\u4e3b\u673a \u00b6 \u5728 \"\u8d44\u6e90\" >> \"\u6e05\u5355\" \u9875\u9762\u4e2d\u70b9\u51fb\u53f3\u8fb9\u7684 \"+\" \u6dfb\u52a0\u6e05\u5355 \u4fdd\u5b58\u4e4b\u540e\uff0c\u70b9\u51fb\u6e05\u5355\u91cc\u7684 \"\u4e3b\u673a\" \u6dfb\u52a0\u4e3b\u673a\u4fe1\u606f \u5982\u679c\u8bf4\u4e0d\u8bbe\u7f6e\u8d26\u53f7\u5bc6\u7801, \u53ef\u4ee5\u6dfb\u52a0\u4e0b \u51ed\u8bc1 \uff0c\u5e76\u5728\u6a21\u677f\u4e2d\u9009\u62e9\u51ed\u8bc1\u5373\u53ef\u3002 \u6dfb\u52a0\u9879\u76ee \u00b6 \u9879\u76ee\u7528\u4e8e\u7ba1\u7406playbook\u5b58\u653e\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u5b58\u5728 \u672c\u5730 \uff0c git\u4ed3\u5e93 \uff0c svn\u4ed3\u5e93 \u7b49\u7248\u672c\u5de5\u5177\u4e2d\u3002 \u672c\u6b21\u5728 \u672c\u5730 \u521b\u5efa\u4e00\u4e2a\u793a\u4f8b\u9879\u76ee\u3002 \u9996\u5148\uff0c\u5728\u672c\u5730\u9879\u76ee\u8def\u5f84\u4e0b\u521b\u5efa\u4e00\u4e2a example-playbooks \u76ee\u5f55\uff0c\u5728\u76ee\u5f55\u4e2d\u521b\u5efa helloWorld.yml playbook mkdir -p ~/.awx/projects/example-playbooks cat <<EOF >>.awx/projects/example-playbooks/ --- - hosts: all tasks: - name: hello debug: msg=\"hello,world\" EOF \u7136\u540e\uff0c\u5728web\u9875\u9762\u4e2d\uff0c\u5728 \"\u9879\u76ee\" \u521b\u5efa\u4e00\u4e2a\u793a\u4f8b\u9879\u76ee\u3002 \u6dfb\u52a0\u6a21\u677f \u00b6 \u5728awx\u4e2d\uff0c\u6a21\u677f\u5373\u662f\u5bf9playbook\u7684\u5f15\u7528\u3002\u6267\u884c\u6a21\u677f\uff0c\u5c31\u662f\u6267\u884cplaybook\u3002 \u5728\u793a\u4f8b\u9879\u76ee\u4e2d\uff0c\u6dfb\u52a0\u4e00\u4e2a\u4efb\u52a1\u6a21\u677f\u3002 \u5728\u6a21\u677f\u4e2d\uff0c\u542f\u52a8\u4efb\u52a1 \u4efb\u52a1\u6267\u884c\u5b8c\uff0c\u5c31\u80fd\u770b\u5230\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f \u8fd0\u884c\u547d\u4ee4 \u00b6 \u5728 \"\u6e05\u5355\" >> \"\u793a\u4f8b\u6e05\u5355\" >> \"\u4e3b\u673a\" \u4e2d \u9009\u62e9\u8981\u6267\u884c\u7684\u4e3b\u673a\uff0c\u70b9\u51fb \"\u8fd0\u884c\u547d\u4ee4\" \u5728 \"\u8fd0\u884c\u547d\u4ee4\" \u754c\u9762\u8bbe\u7f6e\u8fd0\u884c\u7684\u53c2\u6570 \u6267\u884c\u5b8c\uff0c\u5c31\u80fd\u770b\u5230\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f","title":"Ansible Awx"},{"location":"ui/awx/#awx","text":"AWX \u662f\u4e00\u4e2a\u5f00\u6e90\u793e\u533a\u9879\u76ee\uff0c\u63d0\u4f9b\u7528\u4e8e\u7ba1\u7406 Ansible \u9879\u76ee\u7684\u8f6f\u4ef6\u3002AWX \u6258\u7ba1\u5728 GitHub \u4e0a\uff0c\u5e76\u63d0\u4f9b\u57fa\u4e8e Web \u7684\u7528\u6237\u754c\u9762\u3001REST API \u548c\u9002\u7528\u4e8e Ansible \u7684\u4efb\u52a1\u5f15\u64ce\u3002 Ansible \u662f\u4e00\u6b3e\u5f00\u53d1\u8fd0\u8425\u5de5\u5177\uff0c\u53ef\u81ea\u52a8\u6267\u884c\u9884\u7f6e\u3001\u914d\u7f6e\u7ba1\u7406\u3001\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u3001\u5185\u90e8\u670d\u52a1\u7f16\u6392\u3001\u6301\u7eed\u4ea4\u4ed8\u548c\u8bb8\u591a\u5176\u4ed6 IT \u6d41\u7a0b\u3002\u76f4\u89c2\u7684 AWX \u63a7\u5236\u9762\u677f\u8ba9\u60a8\u80fd\u591f\u5b89\u6392\u548c\u90e8\u7f72 Ansible Playbook\uff0c\u5e76\u63d0\u4f9b\u96c6\u4e2d\u7684\u65e5\u5fd7\u8bb0\u5f55\u3001\u5ba1\u8ba1\u548c\u7cfb\u7edf\u8ddf\u8e2a\u3002AWX \u53ef\u63d0\u4f9b Ansible Tower \u7684\u6e90\u4ee3\u7801\uff0cAnsible Tower \u662f AWX \u7684\u5546\u4e1a\u7248\u672c\u3002 \u6b64\u5feb\u901f\u5165\u95e8\u4ece AWX \u7684 GitHub \u5b58\u50a8\u5e93 \u7684\u4e3b\u5206\u652f\u90e8\u7f72\u4ee3\u7801\u3002\u60a8\u8fd8\u53ef\u4ee5\u9009\u62e9\u4ece\u8be5\u5b58\u50a8\u5e93\u7684\u5176\u4ed6\u5206\u652f\u90e8\u7f72\u4ee3\u7801\u3002","title":"AWX"},{"location":"ui/awx/#awx-install","text":"","title":"Awx install"},{"location":"ui/awx/#_1","text":"OS: centos 7.7 x64 IP: 192.168.77.130","title":"\u7cfb\u7edf\u73af\u5883"},{"location":"ui/awx/#_2","text":"yum -y install git gcc gcc-c++ ansible nodejs gettext device-mapper-persistent-data lvm2 bzip2 python-pip python-devel","title":"\u5b89\u88c5\u4f9d\u8d56"},{"location":"ui/awx/#docker","text":"curl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo sed -i 's#download.docker.com#mirrors.ustc.edu.cn/docker-ce#g' /etc/yum.repos.d/docker-ce.repo yum -y install docker-ce bash-completion pip install docker-compose -r http://mirrors.aliyun.com/pypi/simple curl -L https://raw.githubusercontent.com/docker/compose/master/contrib/completion/bash/docker-compose -o /etc/bash_completion.d/docker-compose cp /usr/share/bash-completion/completions/docker /etc/bash_completion.d/ mkdir /etc/docker cat > /etc/docker/daemon.json <<EOF { \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"100m\", \"max-file\": \"3\" }, \"default-ulimits\": { \"nofile\": { \"Name\": \"nofile\", \"Hard\": 64000, \"Soft\": 64000 } }, \"live-restore\": true, \"max-concurrent-downloads\": 10, \"max-concurrent-uploads\": 10, \"storage-driver\": \"overlay2\", \"storage-opts\": [ \"overlay2.override_kernel_check=true\" ], \"registry-mirrors\": [ \"http://hub-mirror.c.163.com\" ] } EOF systemctl enable --now docker \u7248\u672c\u4fe1\u606f # python -V Python 2 .7.5 # docker version ' Client: Version: 18 .09.6 API version: 1 .39 Go version: go1.10.8 Git commit: 481bc77156 Built: Sat May 4 02 :34:58 2019 OS/Arch: linux/amd64 Experimental: false Server: Docker Engine - Community Engine: Version: 19 .03.8 API version: 1 .40 ( minimum version 1 .12 ) Go version: go1.12.17 Git commit: afacb8b Built: Wed Mar 11 01 :25:42 2020 OS/Arch: linux/amd64 Experimental: false containerd: Version: 1 .2.5 GitCommit: bb71b10fd8f58240ca47fbb579b9d1028eea7c84 runc: Version: 1 .0.0-rc6+dev GitCommit: 2b18fe1d885ee5083ef9f0838fee39b62d653e30 docker-init: Version: 0 .18.0 GitCommit: fec3683 # docker-compose version docker-compose version 1 .25.5, build unknown docker-py version: 4 .2.0 CPython version: 2 .7.5 OpenSSL version: OpenSSL 1 .0.2k-fips 26 Jan 2017","title":"\u5b89\u88c5docker\u73af\u5883"},{"location":"ui/awx/#awx_1","text":"# wget https://github.com/ansible/awx/archive/11.2.0.tar.gz # tar zxf 11.2.0.tar.gz # cd awx-11.2.0/ \u751f\u6210\u52a0\u5bc6\u4e3b\u673a\u6e05\u5355\u6587\u4ef6\u7684\u5bc6\u94a5 # openssl rand -base64 30 nir4yYx6Bb4uN/ow98f2tD9Wktm8A/cwgqTgzHLg \u914d\u7f6e\u4e3b\u673a\u6e05\u5355\u6587\u4ef6 installer/inventory localhost ansible_connection = local ansible_python_interpreter=\"/usr/bin/env python3\" [all:vars] dockerhub_base = ansible docker_compose_dir = \"~/.awx/awxcompose\" awx_task_hostname = awx awx_web_hostname = awxweb host_port = 80 host_port_ssl = 443 pg_username = awx pg_password = awxpass pg_database = awx pg_port = 5432 postgres_data_dir = \"~/.awx/pgdocker\" admin_user = admin admin_password = password create_preload_data = True secret_key = nir4yYx6Bb4uN/ow98f2tD9Wktm8A/cwgqTgzHLg awx_alternate_dns_servers = \"8.8.8.8,8.8.4.4\" project_data_dir = \"~/.awx/projects\" \u6267\u884c\u5b89\u88c5 plyabook # cd installer # ansible-playbook -i inventory install.yml PLAY [ Build and deploy AWX ] ****************************************************************************************** TASK [ Gathering Facts ] *********************************************************************************************** ok: [ localhost ] TASK [ check_vars : include_tasks ] ************************************************************************************ included: /root/awx-11.2.0/installer/roles/check_vars/tasks/check_docker.yml for localhost TASK [ check_vars : postgres_data_dir should be defined ] ************************************************************** ok: [ localhost ] = > { \"changed\" : false, \"msg\" : \"All assertions passed\" } TASK [ check_vars : host_port should be defined ] ********************************************************************** ok: [ localhost ] = > { \"changed\" : false, \"msg\" : \"All assertions passed\" } TASK [ local_docker : Generate broadcast websocket secret ] ************************************************************ ok: [ localhost ] TASK [ local_docker : Check for existing Postgres data ] *************************************************************** ok: [ localhost ] TASK [ local_docker : Determine whether to upgrade postgres ] ********************************************************** ok: [ localhost ] TASK [ local_docker : Remove old data directory ] ********************************************************************** ok: [ localhost ] TASK [ local_docker : Set DockerHub Image Paths ] ********************************************************************** ok: [ localhost ] TASK [ local_docker : Create ~/.awx/awxcompose directory ] ************************************************************* changed: [ localhost ] TASK [ local_docker : Create Redis socket directory ] ****************************************************************** changed: [ localhost ] TASK [ local_docker : Create Memcached socket directory ] ************************************************************** changed: [ localhost ] TASK [ local_docker : Create Docker Compose Configuration ] ************************************************************ changed: [ localhost ] = > ( item = environment.sh ) changed: [ localhost ] = > ( item = credentials.py ) changed: [ localhost ] = > ( item = docker-compose.yml ) changed: [ localhost ] = > ( item = nginx.conf ) changed: [ localhost ] = > ( item = redis.conf ) TASK [ local_docker : Set redis config to other group readable to satisfy redis-server ] ******************************** changed: [ localhost ] TASK [ local_docker : Render SECRET_KEY file ] ************************************************************************** ok: [ localhost ] TASK [ local_docker : Start the containers ] **************************************************************************** changed: [ localhost ] TASK [ local_docker : Update CA trust in awx_web container ] ************************************************************ changed: [ localhost ] TASK [ local_docker : Update CA trust in awx_task container ] *********************************************************** changed: [ localhost ] PLAY RECAP ************************************************************************************************************ localhost : ok = 18 changed = 5 unreachable = 0 failed = 0 skipped = 97 rescued = 0 ignored = 0 \u542f\u52a8\u7684\u5bb9\u5668 # docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES df5f7cb15da0 ansible/awx_task:11.2.0 \"tini -- /bin/sh -c \u2026\" About a minute ago Up About a minute 8052 /tcp awx_task 5b774471f6e3 ansible/awx_web:11.2.0 \"tini -- /bin/sh -c \u2026\" About a minute ago Up About a minute 0 .0.0.0:80->8052/tcp awx_web ad4c005ac0e9 memcached:alpine \"docker-entrypoint.s\u2026\" About a minute ago Up About a minute 11211 /tcp awx_memcached f73edd420c15 postgres:10 \"docker-entrypoint.s\u2026\" About a minute ago Up About a minute 5432 /tcp awx_postgres c006d3e473bd redis \"docker-entrypoint.s\u2026\" About a minute ago Up About a minute 6379 /tcp awx_redis","title":"\u5b89\u88c5 awx"},{"location":"ui/awx/#web","text":"\u8bbf\u95ee\u5730\u5740 http://192.168.77.130 \u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\u767b\u5f55\u540e\uff0c\u5c31\u80fd\u770b\u5230awx\u7684\u754c\u9762\u4e86\u3002","title":"WEB \u754c\u9762"},{"location":"ui/awx/#awx_2","text":"","title":"Awx \u4f7f\u7528"},{"location":"ui/awx/#_3","text":"\u5728 \"\u8d44\u6e90\" >> \"\u6e05\u5355\" \u9875\u9762\u4e2d\u70b9\u51fb\u53f3\u8fb9\u7684 \"+\" \u6dfb\u52a0\u6e05\u5355 \u4fdd\u5b58\u4e4b\u540e\uff0c\u70b9\u51fb\u6e05\u5355\u91cc\u7684 \"\u4e3b\u673a\" \u6dfb\u52a0\u4e3b\u673a\u4fe1\u606f \u5982\u679c\u8bf4\u4e0d\u8bbe\u7f6e\u8d26\u53f7\u5bc6\u7801, \u53ef\u4ee5\u6dfb\u52a0\u4e0b \u51ed\u8bc1 \uff0c\u5e76\u5728\u6a21\u677f\u4e2d\u9009\u62e9\u51ed\u8bc1\u5373\u53ef\u3002","title":"\u6dfb\u52a0\u4e3b\u673a"},{"location":"ui/awx/#_4","text":"\u9879\u76ee\u7528\u4e8e\u7ba1\u7406playbook\u5b58\u653e\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u5b58\u5728 \u672c\u5730 \uff0c git\u4ed3\u5e93 \uff0c svn\u4ed3\u5e93 \u7b49\u7248\u672c\u5de5\u5177\u4e2d\u3002 \u672c\u6b21\u5728 \u672c\u5730 \u521b\u5efa\u4e00\u4e2a\u793a\u4f8b\u9879\u76ee\u3002 \u9996\u5148\uff0c\u5728\u672c\u5730\u9879\u76ee\u8def\u5f84\u4e0b\u521b\u5efa\u4e00\u4e2a example-playbooks \u76ee\u5f55\uff0c\u5728\u76ee\u5f55\u4e2d\u521b\u5efa helloWorld.yml playbook mkdir -p ~/.awx/projects/example-playbooks cat <<EOF >>.awx/projects/example-playbooks/ --- - hosts: all tasks: - name: hello debug: msg=\"hello,world\" EOF \u7136\u540e\uff0c\u5728web\u9875\u9762\u4e2d\uff0c\u5728 \"\u9879\u76ee\" \u521b\u5efa\u4e00\u4e2a\u793a\u4f8b\u9879\u76ee\u3002","title":"\u6dfb\u52a0\u9879\u76ee"},{"location":"ui/awx/#_5","text":"\u5728awx\u4e2d\uff0c\u6a21\u677f\u5373\u662f\u5bf9playbook\u7684\u5f15\u7528\u3002\u6267\u884c\u6a21\u677f\uff0c\u5c31\u662f\u6267\u884cplaybook\u3002 \u5728\u793a\u4f8b\u9879\u76ee\u4e2d\uff0c\u6dfb\u52a0\u4e00\u4e2a\u4efb\u52a1\u6a21\u677f\u3002 \u5728\u6a21\u677f\u4e2d\uff0c\u542f\u52a8\u4efb\u52a1 \u4efb\u52a1\u6267\u884c\u5b8c\uff0c\u5c31\u80fd\u770b\u5230\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f","title":"\u6dfb\u52a0\u6a21\u677f"},{"location":"ui/awx/#_6","text":"\u5728 \"\u6e05\u5355\" >> \"\u793a\u4f8b\u6e05\u5355\" >> \"\u4e3b\u673a\" \u4e2d \u9009\u62e9\u8981\u6267\u884c\u7684\u4e3b\u673a\uff0c\u70b9\u51fb \"\u8fd0\u884c\u547d\u4ee4\" \u5728 \"\u8fd0\u884c\u547d\u4ee4\" \u754c\u9762\u8bbe\u7f6e\u8fd0\u884c\u7684\u53c2\u6570 \u6267\u884c\u5b8c\uff0c\u5c31\u80fd\u770b\u5230\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f","title":"\u8fd0\u884c\u547d\u4ee4"},{"location":"ui/tower/","text":"Ansible Tower \u00b6 Ansible Tower \u662f\u4e00\u4e2a\u7531Red Hat\u8d5e\u52a9\u7684\u5f00\u6e90\u793e\u533a\u9879\u76ee\uff0c\u5b83\u4f7f\u7528\u6237\u80fd\u591f\u66f4\u597d\u5730\u63a7\u5236\u4ed6\u4eec\u7684Ansible\u9879\u76ee\u5728IT\u73af\u5883\u4e2d\u7684\u4f7f\u7528\u3002Ansible Tower\u63d0\u4f9b\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff0c\u5305\u62ec\u5bf9SSH\u548c\u5176\u4ed6\u670d\u52a1\u4f7f\u7528\u5b89\u5168\u5b58\u50a8\u7684\u51ed\u8bc1\u7684\u63a7\u5236\u3002\u4f60\u53ef\u4ee5\u540c\u6b65\u4f60\u7684Ansible Tower\u5e93\u5b58\u4e0e\u5404\u79cd\u5404\u6837\u7684\u4e91\u8d44\u6e90\uff0c\u548c\u5f3a\u5927\u7684\u591a\u5267\u672c\u5de5\u4f5c\u6d41\u5141\u8bb8\u4f60\u5efa\u6a21\u590d\u6742\u7684\u8fc7\u7a0b\u3002\u4f7f\u7528python\u8bed\u8a00\u7f16\u5199\u3002 \u5b89\u88c5 \u00b6 \u7cfb\u7edf\u8981\u6c42 \u00b6 RHEL 7, CentOS 7\u6216\u66f4\u9ad8\u7248\u672c\uff0c\u5e76\u4e14\u662f64\u4f4d\u64cd\u4f5c\u7cfb\u7edf\u3002 \u7cfb\u7edf\u8d44\u6e90\u6700\u5c112\u4e2aCPU\uff0c4GB RAM\u3002 /var \u5206\u533a\u6700\u5c0f 10GB\u3001IOPS\u6700\u5c0f\u4e3a750, \u7528\u4e8e\u5b58\u50a8Tower\u6587\u4ef6\u548c\u5de5\u4f5c\u76ee\u5f55\u3002 \u6570\u636e\u5e93\u5b58\u50a8\u76ee\u5f55\u6700\u5c11\u4f4d 20GB\u3001IOPS\u6700\u5c11\u5e94\u4e3a1000\uff0c\u7528\u4e8e\u5b58\u50a8pgsql\u7684\u6570\u636e\u3002 Ansible Tower 3.6\u53ca\u4ee5\u4e0a\u7248\u672c\u624d\u652f\u6301 PostgreSQL 10\u3002 Ansible Tower 3.2\u53ca\u4ee5\u4e0a\u7248\u672c\u9700\u8981\u6700\u4f4e ansible 2.2\u7684\u7248\u672c\u3002 Note \u4eceTower 3.6 \u7248\u672c\u4e4b\u4e0a\u4e0d\u518d\u652f\u6301ubuntu\u7cfb\u7edf\u3002 \u7cfb\u7edf\u73af\u5883 \u00b6 # cat /etc/centos-release CentOS Linux release 7 .6.1810 ( Core ) # python -V Python 2 .7.5 \u4e0b\u8f7d\u5305 \u00b6 \u4e0b\u8f7d el7 \u6807\u5fd7\u7684\u5305\uff0c\u4ee3\u8868\u662fcentos 7\u7cfb\u5217\u7cfb\u7edf\u4f7f\u7528\u7684\u5305 wget https://releases.ansible.com/ansible-tower/setup-bundle/ansible-tower-setup-bundle-3.6.4-1.el7.tar.gz tar zxf ansible-tower-setup-bundle-3.6.4-1.el7.tar.gz cd ansible-tower-setup-bundle-3.6.4-1 \u914d\u7f6e Tower \u4e3b\u673a\u6e05\u5355 \u00b6 \u672c\u6b21\u4f7f\u7528\u5355\u5b9e\u4f8b\u7684\u65b9\u5f0f\u5b89\u88c5tower \u5728 inventory \u6587\u4ef6\u4e2d\u914d\u7f6e\u5bc6\u7801\u4fe1\u606f ```ini hl_lines=\"7,12,15\" [tower] localhost ansible_connection=local [database] [all:vars] admin_password='admin' pg_host='' pg_port='' pg_database='awx' pg_username='awx' pg_password='awx' pg_sslmode='prefer' # set to 'verify-full' for client-side enforced SSL rabbitmq_username=tower rabbitmq_password='awx' rabbitmq_cookie=cookiemonster ### \u5b89\u88c5 Tower \u5b89\u88c5\u4f9d\u8d56 ```bash yum -y install rsync \u6267\u884c setup.sh \u811a\u672c\u8fdb\u884c\u5b89\u88c5 Tower\u3002 ./setup.sh \u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u5b89\u88c5\u5373\u53ef\u5b8c\u6210\uff0c\u5b89\u88c5\u7684\u65e5\u5fd7\u4f1a\u5b58\u653e /var/log/tower/setup-[\u5b89\u88c5\u65f6\u95f4].log \u6587\u4ef6\u4e2d\u3002 \u8bbf\u95ee\u8282\u70b9 80 \u7aef\u53e3\u5373\u53ef\u8bbf\u95ee tower web\u9875\u9762 Tower \u4f7f\u7528 \u00b6 \u8bbf\u95ee https://192.168.77.130 \u5730\u5740\uff0c\u4f7f\u7528\u8d26\u53f7\u5bc6\u7801( admin/admin )\u767b\u5f55 Tower \u767b\u5f55\u540e\uff0c\u9700\u8981\u8fdb\u884c\u7533\u8bf7\u8bb8\u53ef\u3002 Note \u8fd9\u91cc\u5206\u4eab\u7f51\u53cb\u4e00\u4e2a\u8bb8\u53ef\uff0c\u5927\u5bb6\u5207\u52ff\u5728\u751f\u4ea7\u4e2d\u4f7f\u7528\uff0c\u4ec5\u4f9b\u6d4b\u8bd5\u5b66\u4e60Tower\u3002 { \"company_name\" : \"VzerZhang\" , \"contact_email\" : \"vzer.zhang@gmail.com\" , \"contact_name\" : \"zhang vzer\" , \"hostname\" : \"cd82342fe4d840dc89437f1a2aa54934\" , \"instance_count\" : 1000 , \"license_date\" : 2121936571 , \"license_key\" : \"059aa45908d9989056a212c944781ca398df23ca86d7565f9949c243d64a75f1\" , \"license_type\" : \"enterprise\" , \"subscription_name\" : \"Ansible Tower by Red Hat, Standard (1000 Managed Nodes)\" } \u786e\u8ba4\u597d\u8bb8\u53ef\uff0c\u5c31\u80fd\u8fdb\u5165 Tower \u4e86\u3002 Tower \u9875\u9762 \u8ddf awx \u57fa\u672c\u4e0a\u4e00\u81f4\uff0c\u64cd\u4f5c\u8bf7\u770b awx \u4f7f\u7528\u6587\u6863","title":"Ansible Tower"},{"location":"ui/tower/#ansible-tower","text":"Ansible Tower \u662f\u4e00\u4e2a\u7531Red Hat\u8d5e\u52a9\u7684\u5f00\u6e90\u793e\u533a\u9879\u76ee\uff0c\u5b83\u4f7f\u7528\u6237\u80fd\u591f\u66f4\u597d\u5730\u63a7\u5236\u4ed6\u4eec\u7684Ansible\u9879\u76ee\u5728IT\u73af\u5883\u4e2d\u7684\u4f7f\u7528\u3002Ansible Tower\u63d0\u4f9b\u57fa\u4e8e\u89d2\u8272\u7684\u8bbf\u95ee\u63a7\u5236\uff0c\u5305\u62ec\u5bf9SSH\u548c\u5176\u4ed6\u670d\u52a1\u4f7f\u7528\u5b89\u5168\u5b58\u50a8\u7684\u51ed\u8bc1\u7684\u63a7\u5236\u3002\u4f60\u53ef\u4ee5\u540c\u6b65\u4f60\u7684Ansible Tower\u5e93\u5b58\u4e0e\u5404\u79cd\u5404\u6837\u7684\u4e91\u8d44\u6e90\uff0c\u548c\u5f3a\u5927\u7684\u591a\u5267\u672c\u5de5\u4f5c\u6d41\u5141\u8bb8\u4f60\u5efa\u6a21\u590d\u6742\u7684\u8fc7\u7a0b\u3002\u4f7f\u7528python\u8bed\u8a00\u7f16\u5199\u3002","title":"Ansible Tower"},{"location":"ui/tower/#_1","text":"","title":"\u5b89\u88c5"},{"location":"ui/tower/#_2","text":"RHEL 7, CentOS 7\u6216\u66f4\u9ad8\u7248\u672c\uff0c\u5e76\u4e14\u662f64\u4f4d\u64cd\u4f5c\u7cfb\u7edf\u3002 \u7cfb\u7edf\u8d44\u6e90\u6700\u5c112\u4e2aCPU\uff0c4GB RAM\u3002 /var \u5206\u533a\u6700\u5c0f 10GB\u3001IOPS\u6700\u5c0f\u4e3a750, \u7528\u4e8e\u5b58\u50a8Tower\u6587\u4ef6\u548c\u5de5\u4f5c\u76ee\u5f55\u3002 \u6570\u636e\u5e93\u5b58\u50a8\u76ee\u5f55\u6700\u5c11\u4f4d 20GB\u3001IOPS\u6700\u5c11\u5e94\u4e3a1000\uff0c\u7528\u4e8e\u5b58\u50a8pgsql\u7684\u6570\u636e\u3002 Ansible Tower 3.6\u53ca\u4ee5\u4e0a\u7248\u672c\u624d\u652f\u6301 PostgreSQL 10\u3002 Ansible Tower 3.2\u53ca\u4ee5\u4e0a\u7248\u672c\u9700\u8981\u6700\u4f4e ansible 2.2\u7684\u7248\u672c\u3002 Note \u4eceTower 3.6 \u7248\u672c\u4e4b\u4e0a\u4e0d\u518d\u652f\u6301ubuntu\u7cfb\u7edf\u3002","title":"\u7cfb\u7edf\u8981\u6c42"},{"location":"ui/tower/#_3","text":"# cat /etc/centos-release CentOS Linux release 7 .6.1810 ( Core ) # python -V Python 2 .7.5","title":"\u7cfb\u7edf\u73af\u5883"},{"location":"ui/tower/#_4","text":"\u4e0b\u8f7d el7 \u6807\u5fd7\u7684\u5305\uff0c\u4ee3\u8868\u662fcentos 7\u7cfb\u5217\u7cfb\u7edf\u4f7f\u7528\u7684\u5305 wget https://releases.ansible.com/ansible-tower/setup-bundle/ansible-tower-setup-bundle-3.6.4-1.el7.tar.gz tar zxf ansible-tower-setup-bundle-3.6.4-1.el7.tar.gz cd ansible-tower-setup-bundle-3.6.4-1","title":"\u4e0b\u8f7d\u5305"},{"location":"ui/tower/#tower","text":"\u672c\u6b21\u4f7f\u7528\u5355\u5b9e\u4f8b\u7684\u65b9\u5f0f\u5b89\u88c5tower \u5728 inventory \u6587\u4ef6\u4e2d\u914d\u7f6e\u5bc6\u7801\u4fe1\u606f ```ini hl_lines=\"7,12,15\" [tower] localhost ansible_connection=local [database] [all:vars] admin_password='admin' pg_host='' pg_port='' pg_database='awx' pg_username='awx' pg_password='awx' pg_sslmode='prefer' # set to 'verify-full' for client-side enforced SSL rabbitmq_username=tower rabbitmq_password='awx' rabbitmq_cookie=cookiemonster ### \u5b89\u88c5 Tower \u5b89\u88c5\u4f9d\u8d56 ```bash yum -y install rsync \u6267\u884c setup.sh \u811a\u672c\u8fdb\u884c\u5b89\u88c5 Tower\u3002 ./setup.sh \u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u5b89\u88c5\u5373\u53ef\u5b8c\u6210\uff0c\u5b89\u88c5\u7684\u65e5\u5fd7\u4f1a\u5b58\u653e /var/log/tower/setup-[\u5b89\u88c5\u65f6\u95f4].log \u6587\u4ef6\u4e2d\u3002 \u8bbf\u95ee\u8282\u70b9 80 \u7aef\u53e3\u5373\u53ef\u8bbf\u95ee tower web\u9875\u9762","title":"\u914d\u7f6e Tower \u4e3b\u673a\u6e05\u5355"},{"location":"ui/tower/#tower_1","text":"\u8bbf\u95ee https://192.168.77.130 \u5730\u5740\uff0c\u4f7f\u7528\u8d26\u53f7\u5bc6\u7801( admin/admin )\u767b\u5f55 Tower \u767b\u5f55\u540e\uff0c\u9700\u8981\u8fdb\u884c\u7533\u8bf7\u8bb8\u53ef\u3002 Note \u8fd9\u91cc\u5206\u4eab\u7f51\u53cb\u4e00\u4e2a\u8bb8\u53ef\uff0c\u5927\u5bb6\u5207\u52ff\u5728\u751f\u4ea7\u4e2d\u4f7f\u7528\uff0c\u4ec5\u4f9b\u6d4b\u8bd5\u5b66\u4e60Tower\u3002 { \"company_name\" : \"VzerZhang\" , \"contact_email\" : \"vzer.zhang@gmail.com\" , \"contact_name\" : \"zhang vzer\" , \"hostname\" : \"cd82342fe4d840dc89437f1a2aa54934\" , \"instance_count\" : 1000 , \"license_date\" : 2121936571 , \"license_key\" : \"059aa45908d9989056a212c944781ca398df23ca86d7565f9949c243d64a75f1\" , \"license_type\" : \"enterprise\" , \"subscription_name\" : \"Ansible Tower by Red Hat, Standard (1000 Managed Nodes)\" } \u786e\u8ba4\u597d\u8bb8\u53ef\uff0c\u5c31\u80fd\u8fdb\u5165 Tower \u4e86\u3002 Tower \u9875\u9762 \u8ddf awx \u57fa\u672c\u4e0a\u4e00\u81f4\uff0c\u64cd\u4f5c\u8bf7\u770b awx \u4f7f\u7528\u6587\u6863","title":"Tower \u4f7f\u7528"}]}